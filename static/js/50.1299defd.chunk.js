(this.webpackJsonpgenerative=this.webpackJsonpgenerative||[]).push([[50,137,138],{258:function(z,x,d){"use strict";d.r(x),x.default=`#define GLSLIFY 1
attribute vec3 position;
attribute vec2 uv;

varying vec2 vUv;
varying vec3 oPos;
varying vec3 pPos;
varying float mFactor;

uniform float iTime;
uniform float pSize;

uniform mat4 worldViewProjection;
uniform mat4 world;

#define MOD3 vec3(.1031,.11369,.13787)

vec3 hash33(vec3 p3)
{
  p3 = fract(p3 * MOD3);
  p3 += dot(p3, p3.yxz+19.19);
  return -1.0 + 2.0 * fract(vec3((p3.x + p3.y)*p3.z, (p3.x+p3.z)*p3.y, (p3.y+p3.z)*p3.x));
}

float noise(vec3 p)
{
  const float K1 = 0.333333333;
  const float K2 = 0.166666667;

  vec3 i = floor(p + (p.x + p.y + p.z) * K1);
  vec3 d0 = p - (i - (i.x + i.y + i.z) * K2);

  vec3 e = step(vec3(0.0), d0 - d0.yzx);
  vec3 i1 = e * (1.0 - e.zxy);
  vec3 i2 = 1.0 - e.zxy * (1.0 - e);

  vec3 d1 = d0 - (i1 - 1.0 * K2);
  vec3 d2 = d0 - (i2 - 2.0 * K2);
  vec3 d3 = d0 - (1.0 - 3.0 * K2);

  vec4 h = max(0.6 - vec4(dot(d0, d0), dot(d1, d1), dot(d2, d2), dot(d3, d3)), 0.0);
  vec4 n = h * h * h * h * vec4(dot(d0, hash33(i)), dot(d1, hash33(i + i1)), dot(d2, hash33(i + i2)), dot(d3, hash33(i + 1.0)));

  return dot(vec4(31.316), n);
}

void main()
{
  vUv = uv;

  oPos = position;
  pPos = position;

  float t = fract(iTime/5.)*5.;
  float f = noise(oPos*.5);

  float moveFactor = (oPos.z*.02-(t*.5 + f*.3))*(10. + (pPos.y - oPos.y +50.)*1.)*t*step(pPos.z*.02, t*.5 + f*.3);
  pPos.y += moveFactor;

  mFactor = moveFactor;

  gl_PointSize = pSize;

  gl_Position = worldViewProjection * vec4( pPos, 1.0 );
}
`},259:function(z,x,d){"use strict";d.r(x),x.default=`#define GLSLIFY 1
varying vec3 oPos;
varying vec3 pPos;

varying vec2 vUv;
varying float mFactor;

uniform vec2 iResolution;
uniform float iTime;

#define hue(h) clamp( abs( fract(h + vec4(3,2,1,0)/3.) * 6. - 3.) -1. , 0., 1.)

void mainImage( out vec4 fragColor, in vec2 fragCoord)
{
  vec2 uv = (vec3(gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1)).xy - .5;

  vec3 col = hue(oPos.z*.01 + .1).rgb;

  fragColor = vec4(col, 1.- length(uv) + mFactor*.01);
}

void main()
{
  mainImage(gl_FragColor, vUv * iResolution.xy);
}
`},444:function(z,x,d){"use strict";d.d(x,"a",function(){return i});var v=d(434),T=d(490),M=d(438),m=d(436),y=d(534),O=d(445),c=d(500),l=d(439),e=d(437),i=function(){function o(n,s,t,r,a,u,h,f,p,_,g,P,E,R,b){h===void 0&&(h=1),_===void 0&&(_=null),g===void 0&&(g=0),P===void 0&&(P="postprocess"),R===void 0&&(R=!1),b===void 0&&(b=5),this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.autoClear=!0,this.alphaMode=0,this.animations=new Array,this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._reusable=!1,this._renderId=0,this._textures=new T.a(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new m.d(1,1),this._texelSize=m.d.Zero(),this.onActivateObservable=new M.c,this.onSizeChangedObservable=new M.c,this.onApplyObservable=new M.c,this.onBeforeRenderObservable=new M.c,this.onAfterRenderObservable=new M.c,this.name=n,u!=null?(this._camera=u,this._scene=u.getScene(),u.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):f&&(this._engine=f,this._engine.postProcesses.push(this)),this._options=a,this.renderTargetSamplingMode=h||1,this._reusable=p||!1,this._textureType=g,this._textureFormat=b,this._samplers=r||[],this._samplers.push("textureSampler"),this._fragmentUrl=s,this._vertexUrl=P,this._parameters=t||[],this._parameters.push("scale"),this._indexParameters=E,R||this.updateEffect(_)}return Object.defineProperty(o.prototype,"samples",{get:function(){return this._samples},set:function(n){var s=this;this._samples=Math.min(n,this._engine.getCaps().maxMSAASamples),this._textures.forEach(function(t){t.samples!==s._samples&&s._engine.updateRenderTargetTextureSampleCount(t,s._samples)})},enumerable:!1,configurable:!0}),o.prototype.getEffectName=function(){return this._fragmentUrl},Object.defineProperty(o.prototype,"onActivate",{set:function(n){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),n&&(this._onActivateObserver=this.onActivateObservable.add(n))},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onSizeChanged",{set:function(n){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(n)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onApply",{set:function(n){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(n)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onBeforeRender",{set:function(n){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(n)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"onAfterRender",{set:function(n){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(n)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"inputTexture",{get:function(){return this._textures.data[this._currentRenderTextureInd]},set:function(n){this._forcedOutputTexture=n},enumerable:!1,configurable:!0}),o.prototype.restoreDefaultInputTexture=function(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())},o.prototype.getCamera=function(){return this._camera},Object.defineProperty(o.prototype,"texelSize",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.copyFromFloats(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)},enumerable:!1,configurable:!0}),o.prototype.getClassName=function(){return"PostProcess"},o.prototype.getEngine=function(){return this._engine},o.prototype.getEffect=function(){return this._effect},o.prototype.shareOutputWith=function(n){return this._disposeTextures(),this._shareOutputWithPostProcess=n,this},o.prototype.useOwnOutput=function(){this._textures.length==0&&(this._textures=new T.a(2)),this._shareOutputWithPostProcess=null},o.prototype.updateEffect=function(n,s,t,r,a,u,h,f){n===void 0&&(n=null),s===void 0&&(s=null),t===void 0&&(t=null),this._postProcessDefines=n,this._effect=this._engine.createEffect({vertex:h!=null?h:this._vertexUrl,fragment:f!=null?f:this._fragmentUrl},["position"],s||this._parameters,t||this._samplers,n!==null?n:"",void 0,a,u,r||this._indexParameters)},o.prototype.isReusable=function(){return this._reusable},o.prototype.markTextureDirty=function(){this.width=-1},o.prototype._createRenderTargetTexture=function(n,s,t){t===void 0&&(t=0);for(var r=0;r<this._textureCache.length;r++)if(this._textureCache[r].texture.width===n.width&&this._textureCache[r].texture.height===n.height&&this._textureCache[r].postProcessChannel===t)return this._textureCache[r].texture;var a=this._engine.createRenderTargetTexture(n,s);return this._textureCache.push({texture:a,postProcessChannel:t,lastUsedRenderId:-1}),a},o.prototype._flushTextureCache=function(){for(var n=this._renderId,s=this._textureCache.length-1;s>=0;s--)if(n-this._textureCache[s].lastUsedRenderId>100){for(var t=!1,r=0;r<this._textures.length;r++)if(this._textures.data[r]===this._textureCache[s].texture){t=!0;break}t||(this._engine._releaseTexture(this._textureCache[s].texture),this._textureCache.splice(s,1))}},o.prototype._resize=function(n,s,t,r,a){this._textures.length>0&&this._textures.reset(),this.width=n,this.height=s;var u={width:this.width,height:this.height},h={generateMipMaps:r,generateDepthBuffer:a||t._postProcesses.indexOf(this)===0,generateStencilBuffer:(a||t._postProcesses.indexOf(this)===0)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat};this._textures.push(this._createRenderTargetTexture(u,h,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(u,h,1)),this._texelSize.copyFromFloats(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)},o.prototype.activate=function(n,s,t){var r=this;s===void 0&&(s=null),n=n||this._camera;var a=n.getScene(),u=a.getEngine(),h=u.getCaps().maxTextureSize,f=(s?s.width:this._engine.getRenderWidth(!0))*this._options|0,p=(s?s.height:this._engine.getRenderHeight(!0))*this._options|0,_=n.parent;_&&(_.leftCamera==n||_.rightCamera==n)&&(f/=2);var g=this._options.width||f,P=this._options.height||p,E=this.renderTargetSamplingMode!==7&&this.renderTargetSamplingMode!==1&&this.renderTargetSamplingMode!==2;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){var R=u.currentViewport;R&&(g*=R.width,P*=R.height)}(E||this.alwaysForcePOT)&&(this._options.width||(g=u.needPOTTextures?O.a.GetExponentOfTwo(g,h,this.scaleMode):g),this._options.height||(P=u.needPOTTextures?O.a.GetExponentOfTwo(P,h,this.scaleMode):P)),(this.width!==g||this.height!==P)&&this._resize(g,P,n,E,t),this._textures.forEach(function(A){A.samples!==r.samples&&r._engine.updateRenderTargetTextureSampleCount(A,r.samples)}),this._flushTextureCache(),this._renderId++}var b;if(this._shareOutputWithPostProcess)b=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)b=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{b=this.inputTexture;for(var C=void 0,B=0;B<this._textureCache.length;B++)if(this._textureCache[B].texture===b){C=this._textureCache[B];break}C&&(C.lastUsedRenderId=this._renderId)}return this.enablePixelPerfectMode?(this._scaleRatio.copyFromFloats(f/g,p/P),this._engine.bindFramebuffer(b,0,f,p,this.forceFullscreenViewport)):(this._scaleRatio.copyFromFloats(1,1),this._engine.bindFramebuffer(b,0,void 0,void 0,this.forceFullscreenViewport)),this._engine._debugInsertMarker("post process "+this.name+" input"),this.onActivateObservable.notifyObservers(n),this.autoClear&&this.alphaMode===0&&this._engine.clear(this.clearColor?this.clearColor:a.clearColor,a._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),b},Object.defineProperty(o.prototype,"isSupported",{get:function(){return this._effect.isSupported},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"aspectRatio",{get:function(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height},enumerable:!1,configurable:!0}),o.prototype.isReady=function(){return this._effect&&this._effect.isReady()},o.prototype.apply=function(){if(!this._effect||!this._effect.isReady())return null;this._engine.enableEffect(this._effect),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this._engine.setAlphaMode(this.alphaMode),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a);var n;return this._shareOutputWithPostProcess?n=this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?n=this._forcedOutputTexture:n=this.inputTexture,this._effect._bindTexture("textureSampler",n),this._effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effect),this._effect},o.prototype._disposeTextures=function(){if(this._shareOutputWithPostProcess||this._forcedOutputTexture){this._disposeTextureCache();return}this._disposeTextureCache(),this._textures.dispose()},o.prototype._disposeTextureCache=function(){for(var n=this._textureCache.length-1;n>=0;n--)this._engine._releaseTexture(this._textureCache[n].texture);this._textureCache.length=0},o.prototype.setPrePassRenderer=function(n){return this._prePassEffectConfiguration?(this._prePassEffectConfiguration=n.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0):!1},o.prototype.dispose=function(n){n=n||this._camera,this._disposeTextures();var s;if(this._scene&&(s=this._scene.postProcesses.indexOf(this),s!==-1&&this._scene.postProcesses.splice(s,1)),s=this._engine.postProcesses.indexOf(this),s!==-1&&this._engine.postProcesses.splice(s,1),!!n){if(n.detachPostProcess(this),s=n._postProcesses.indexOf(this),s===0&&n._postProcesses.length>0){var t=this._camera._getFirstPostProcess();t&&t.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear()}},o.prototype.serialize=function(){var n=l.a.Serialize(this),s=this.getCamera()||this._scene&&this._scene.activeCamera;return n.customType="BABYLON."+this.getClassName(),n.cameraId=s?s.id:null,n.reusable=this._reusable,n.textureType=this._textureType,n.fragmentUrl=this._fragmentUrl,n.parameters=this._parameters,n.samplers=this._samplers,n.options=this._options,n.defines=this._postProcessDefines,n.textureFormat=this._textureFormat,n.vertexUrl=this._vertexUrl,n.indexParameters=this._indexParameters,n},o.prototype.clone=function(){var n=this.serialize();n._engine=this._engine,n.cameraId=null;var s=o.Parse(n,this._scene,"");return s?(s.onActivateObservable=this.onActivateObservable.clone(),s.onSizeChangedObservable=this.onSizeChangedObservable.clone(),s.onApplyObservable=this.onApplyObservable.clone(),s.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),s.onAfterRenderObservable=this.onAfterRenderObservable.clone(),s._prePassEffectConfiguration=this._prePassEffectConfiguration,s):null},o.Parse=function(n,s,t){var r=e.a.GetClass(n.customType);if(!r||!r._Parse)return null;var a=s?s.getCameraByID(n.cameraId):null;return r._Parse(n,a,s,t)},o._Parse=function(n,s,t,r){return l.a.Parse(function(){return new o(n.name,n.fragmentUrl,n.parameters,n.samplers,n.options,s,n.renderTargetSamplingMode,n._engine,n.reusable,n.defines,n.textureType,n.vertexUrl,n.indexParameters,!1,n.textureFormat)},n,t,r)},Object(v.c)([Object(l.c)()],o.prototype,"uniqueId",void 0),Object(v.c)([Object(l.c)()],o.prototype,"name",void 0),Object(v.c)([Object(l.c)()],o.prototype,"width",void 0),Object(v.c)([Object(l.c)()],o.prototype,"height",void 0),Object(v.c)([Object(l.c)()],o.prototype,"renderTargetSamplingMode",void 0),Object(v.c)([Object(l.f)()],o.prototype,"clearColor",void 0),Object(v.c)([Object(l.c)()],o.prototype,"autoClear",void 0),Object(v.c)([Object(l.c)()],o.prototype,"alphaMode",void 0),Object(v.c)([Object(l.c)()],o.prototype,"alphaConstants",void 0),Object(v.c)([Object(l.c)()],o.prototype,"enablePixelPerfectMode",void 0),Object(v.c)([Object(l.c)()],o.prototype,"forceFullscreenViewport",void 0),Object(v.c)([Object(l.c)()],o.prototype,"scaleMode",void 0),Object(v.c)([Object(l.c)()],o.prototype,"alwaysForcePOT",void 0),Object(v.c)([Object(l.c)("samples")],o.prototype,"_samples",void 0),Object(v.c)([Object(l.c)()],o.prototype,"adaptScaleToCurrentViewport",void 0),o}();e.a.RegisteredTypes["BABYLON.PostProcess"]=i},458:function(z,x,d){"use strict";d.d(x,"a",function(){return o});var v=d(434),T=d(438),M=d(443),m=d(436),y=d(442),O=d(590),c=d(591),l=d(500),e=d(522),i=d(445),o=function(n){Object(v.d)(s,n);function s(t,r,a,u,h,f,p,_,g,P,E,R,b,C){h===void 0&&(h=!0),f===void 0&&(f=0),p===void 0&&(p=!1),_===void 0&&(_=y.a.TRILINEAR_SAMPLINGMODE),g===void 0&&(g=!0),P===void 0&&(P=!1),E===void 0&&(E=!1),R===void 0&&(R=5),b===void 0&&(b=!1);var B,A=n.call(this,null,a,!u,void 0,_,void 0,void 0,void 0,void 0,R)||this;return A.renderParticles=!0,A.renderSprites=!1,A.ignoreCameraViewport=!1,A.onBeforeBindObservable=new T.c,A.onAfterUnbindObservable=new T.c,A.onBeforeRenderObservable=new T.c,A.onAfterRenderObservable=new T.c,A.onClearObservable=new T.c,A.onResizeObservable=new T.c,A._currentRefreshId=-1,A._refreshRate=1,A._samples=1,A.boundingBoxPosition=m.e.Zero(),a=A.getScene(),!a||(A._coordinatesMode=y.a.PROJECTION_MODE,A.renderList=new Array,A.name=t,A.isRenderTarget=!0,A._initialSizeParameter=r,A._processSizeParameter(r),A._resizeObserver=A.getScene().getEngine().onResizeObservable.add(function(){}),A._generateMipMaps=!!u,A._doNotChangeAspectRatio=h,A._renderingManager=new c.b(a),A._renderingManager._useSceneAutoClearSetup=!0,E)||(A._renderTargetOptions={generateMipMaps:u,type:f,format:(B=A._format)!==null&&B!==void 0?B:void 0,samplingMode:A.samplingMode,generateDepthBuffer:g,generateStencilBuffer:P,samples:C},A.samplingMode===y.a.NEAREST_SAMPLINGMODE&&(A.wrapU=y.a.CLAMP_ADDRESSMODE,A.wrapV=y.a.CLAMP_ADDRESSMODE),b||(p?(A._texture=a.getEngine().createRenderTargetCubeTexture(A.getRenderSize(),A._renderTargetOptions),A.coordinatesMode=y.a.INVCUBIC_MODE,A._textureMatrix=m.a.Identity()):A._texture=a.getEngine().createRenderTargetTexture(A._size,A._renderTargetOptions),C!==void 0&&(A.samples=C))),A}return Object.defineProperty(s.prototype,"renderList",{get:function(){return this._renderList},set:function(t){this._renderList=t,this._renderList&&this._hookArray(this._renderList)},enumerable:!1,configurable:!0}),s.prototype._hookArray=function(t){var r=this,a=t.push;t.push=function(){for(var h=[],f=0;f<arguments.length;f++)h[f]=arguments[f];var p=t.length===0,_=a.apply(t,h);return p&&r.getScene()&&r.getScene().meshes.forEach(function(g){g._markSubMeshesAsLightDirty()}),_};var u=t.splice;t.splice=function(h,f){var p=u.apply(t,[h,f]);return t.length===0&&r.getScene().meshes.forEach(function(_){_._markSubMeshesAsLightDirty()}),p}},Object.defineProperty(s.prototype,"postProcesses",{get:function(){return this._postProcesses},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"_prePassEnabled",{get:function(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"onAfterUnbind",{set:function(t){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"onBeforeRender",{set:function(t){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"onAfterRender",{set:function(t){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"onClear",{set:function(t){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"renderTargetOptions",{get:function(){return this._renderTargetOptions},enumerable:!1,configurable:!0}),s.prototype._onRatioRescale=function(){this._sizeRatio&&this.resize(this._initialSizeParameter)},Object.defineProperty(s.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(t){if(!(this._boundingBoxSize&&this._boundingBoxSize.equals(t))){this._boundingBoxSize=t;var r=this.getScene();r&&r.markAllMaterialsAsDirty(1)}},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"depthStencilTexture",{get:function(){var t;return((t=this.getInternalTexture())===null||t===void 0?void 0:t._depthStencilTexture)||null},enumerable:!1,configurable:!0}),s.prototype.createDepthStencilTexture=function(t,r,a,u){var h;t===void 0&&(t=0),r===void 0&&(r=!0),a===void 0&&(a=!1),u===void 0&&(u=1);var f=this.getInternalTexture();if(!(!this.getScene()||!f)){(h=f._depthStencilTexture)===null||h===void 0||h.dispose();var p=this.getScene().getEngine();f._depthStencilTexture=p.createDepthStencilTexture(this._size,{bilinearFiltering:r,comparisonFunction:t,generateStencil:a,isCube:this.isCube,samples:u})}},s.prototype._processSizeParameter=function(t){if(t.ratio){this._sizeRatio=t.ratio;var r=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(r.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(r.getRenderHeight(),this._sizeRatio)}}else this._size=t},Object.defineProperty(s.prototype,"samples",{get:function(){return this._samples},set:function(t){if(this._samples!==t){var r=this.getScene();!r||(this._samples=r.getEngine().updateRenderTargetTextureSampleCount(this._texture,t))}},enumerable:!1,configurable:!0}),s.prototype.resetRefreshCounter=function(){this._currentRefreshId=-1},Object.defineProperty(s.prototype,"refreshRate",{get:function(){return this._refreshRate},set:function(t){this._refreshRate=t,this.resetRefreshCounter()},enumerable:!1,configurable:!0}),s.prototype.addPostProcess=function(t){if(!this._postProcessManager){var r=this.getScene();if(!r)return;this._postProcessManager=new O.a(r),this._postProcesses=new Array}this._postProcesses.push(t),this._postProcesses[0].autoClear=!1},s.prototype.clearPostProcesses=function(t){if(t===void 0&&(t=!1),!!this._postProcesses){if(t)for(var r=0,a=this._postProcesses;r<a.length;r++){var u=a[r];u.dispose()}this._postProcesses=[]}},s.prototype.removePostProcess=function(t){if(!!this._postProcesses){var r=this._postProcesses.indexOf(t);r!==-1&&(this._postProcesses.splice(r,1),this._postProcesses.length>0&&(this._postProcesses[0].autoClear=!1))}},s.prototype._shouldRender=function(){return this._currentRefreshId===-1?(this._currentRefreshId=1,!0):this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)},s.prototype.getRenderSize=function(){return this.getRenderWidth()},s.prototype.getRenderWidth=function(){return this._size.width?this._size.width:this._size},s.prototype.getRenderHeight=function(){return this._size.width?this._size.height:this._size},s.prototype.getRenderLayers=function(){var t=this._size.layers;return t||0},Object.defineProperty(s.prototype,"canRescale",{get:function(){return!0},enumerable:!1,configurable:!0}),s.prototype.scale=function(t){var r=Math.max(1,this.getRenderSize()*t);this.resize(r)},s.prototype.getReflectionTextureMatrix=function(){return this.isCube?this._textureMatrix:n.prototype.getReflectionTextureMatrix.call(this)},s.prototype.resize=function(t){var r=this.isCube;this.releaseInternalTexture();var a=this.getScene();!a||(this._processSizeParameter(t),r?this._texture=a.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):this._texture=a.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._renderTargetOptions.samples!==void 0&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))},s.prototype.render=function(t,r){t===void 0&&(t=!1),r===void 0&&(r=!1);var a=this.getScene();if(!!a){var u=a.getEngine();if(this.useCameraPostProcesses!==void 0&&(t=this.useCameraPostProcesses),this._waitingRenderList){this.renderList=[];for(var h=0;h<this._waitingRenderList.length;h++){var f=this._waitingRenderList[h],p=a.getMeshByID(f);p&&this.renderList.push(p)}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];var a=this.getScene();if(!a)return;for(var _=a.meshes,h=0;h<_.length;h++){var g=_[h];this.renderListPredicate(g)&&this.renderList.push(g)}}this.onBeforeBindObservable.notifyObservers(this);var P;if(this.activeCamera?(P=this.activeCamera,u.setViewport(this.activeCamera.viewport,this.getRenderWidth(),this.getRenderHeight()),this.activeCamera!==a.activeCamera&&a.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(!0))):(P=a.activeCamera,P&&u.setViewport(P.viewport,this.getRenderWidth(),this.getRenderHeight())),this._defaultRenderListPrepared=!1,this.is2DArray)for(var E=0;E<this.getRenderLayers();E++)this.renderToTarget(0,t,r,E,P),a.incrementRenderId(),a.resetCachedMaterial();else if(this.isCube)for(var R=0;R<6;R++)this.renderToTarget(R,t,r,void 0,P),a.incrementRenderId(),a.resetCachedMaterial();else this.renderToTarget(0,t,r,void 0,P);this.onAfterUnbindObservable.notifyObservers(this),a.activeCamera&&((a.getEngine().scenes.length>1||this.activeCamera&&this.activeCamera!==a.activeCamera)&&a.setTransformMatrix(a.activeCamera.getViewMatrix(),a.activeCamera.getProjectionMatrix(!0)),u.setViewport(a.activeCamera.viewport)),a.resetCachedMaterial()}},s.prototype._bestReflectionRenderTargetDimension=function(t,r){var a=128,u=t*r,h=i.a.NearestPOT(u+a*a/(a+u));return Math.min(i.a.FloorPOT(t),h)},s.prototype._prepareRenderingManager=function(t,r,a,u){var h=this.getScene();if(!!h){this._renderingManager.reset();for(var f=h.getRenderId(),p=0;p<r;p++){var _=t[p];if(_&&!_.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(_,this.refreshRate)){this.resetRefreshCounter();continue}}else if(!_.isReady(this.refreshRate===0)){this.resetRefreshCounter();continue}if(!_._internalAbstractMeshDataInfo._currentLODIsUpToDate&&h.activeCamera&&(_._internalAbstractMeshDataInfo._currentLOD=h.customLODSelector?h.customLODSelector(_,h.activeCamera):_.getLOD(h.activeCamera),_._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0),!_._internalAbstractMeshDataInfo._currentLOD)continue;var g=_._internalAbstractMeshDataInfo._currentLOD;g._preActivateForIntermediateRendering(f);var P=void 0;if(u&&a?P=(_.layerMask&a.layerMask)==0:P=!1,_.isEnabled()&&_.isVisible&&_.subMeshes&&!P&&(g!==_&&g._activate(f,!0),_._activate(f,!0)&&_.subMeshes.length)){_.isAnInstance?_._internalAbstractMeshDataInfo._actAsRegularMesh&&(g=_):g._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,g._internalAbstractMeshDataInfo._isActiveIntermediate=!0;for(var E=0;E<g.subMeshes.length;E++){var R=g.subMeshes[E];this._renderingManager.dispatch(R,g)}}}}for(var b=0;b<h.particleSystems.length;b++){var C=h.particleSystems[b],B=C.emitter;!C.isStarted()||!B||!B.position||!B.isEnabled()||t.indexOf(B)>=0&&this._renderingManager.dispatchParticles(C)}}},s.prototype._bindFrameBuffer=function(t,r){t===void 0&&(t=0),r===void 0&&(r=0);var a=this.getScene();if(!!a){var u=a.getEngine();this._texture&&u.bindFramebuffer(this._texture,this.isCube?t:void 0,void 0,void 0,this.ignoreCameraViewport,0,r)}},s.prototype.unbindFrameBuffer=function(t,r){var a=this;!this._texture||t.unBindFramebuffer(this._texture,this.isCube,function(){a.onAfterRenderObservable.notifyObservers(r)})},s.prototype._prepareFrame=function(t,r,a,u){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses):(!u||!t.postProcessManager._prepareFrame(this._texture))&&this._bindFrameBuffer(r,a)},s.prototype.renderToTarget=function(t,r,a,u,h){u===void 0&&(u=0),h===void 0&&(h=null);var f=this.getScene();if(!!f){var p=f.getEngine();if(!!this._texture){p._debugPushGroup("render to face #"+t+" layer #"+u,1),this._prepareFrame(f,t,u,r),this.is2DArray?this.onBeforeRenderObservable.notifyObservers(u):this.onBeforeRenderObservable.notifyObservers(t);var _=null,g=this.renderList?this.renderList:f.getActiveMeshes().data,P=this.renderList?this.renderList.length:f.getActiveMeshes().length;this.getCustomRenderList&&(_=this.getCustomRenderList(this.is2DArray?u:t,g,P)),_?this._prepareRenderingManager(_,_.length,h,!1):(this._defaultRenderListPrepared||(this._prepareRenderingManager(g,P,h,!this.renderList),this._defaultRenderListPrepared=!0),_=g);for(var E=0,R=f._beforeRenderTargetClearStage;E<R.length;E++){var b=R[E];b.action(this,t,u)}this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(p):p.clear(this.clearColor||f.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||f.updateTransformMatrix(!0);for(var C=0,B=f._beforeRenderTargetDrawStage;C<B.length;C++){var b=B[C];b.action(this,t,u)}this._renderingManager.render(this.customRenderFunction,_,this.renderParticles,this.renderSprites);for(var A=0,F=f._afterRenderTargetDrawStage;A<F.length;A++){var b=F[A];b.action(this,t,u)}var N=this._texture.generateMipMaps;this._texture.generateMipMaps=!1,this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._texture,t,this._postProcesses,this.ignoreCameraViewport):r&&f.postProcessManager._finalizeFrame(!1,this._texture,t),this._texture.generateMipMaps=N,this._doNotChangeAspectRatio||f.updateTransformMatrix(!0),a&&M.b.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),p),this.unbindFrameBuffer(p,t),this.isCube&&t===5&&p.generateMipMapsForCubemap(this._texture),p._debugPopGroup(1)}}},s.prototype.setRenderingOrder=function(t,r,a,u){r===void 0&&(r=null),a===void 0&&(a=null),u===void 0&&(u=null),this._renderingManager.setRenderingOrder(t,r,a,u)},s.prototype.setRenderingAutoClearDepthStencil=function(t,r){this._renderingManager.setRenderingAutoClearDepthStencil(t,r),this._renderingManager._useSceneAutoClearSetup=!1},s.prototype.clone=function(){var t=this.getSize(),r=new s(this.name,t,this.getScene(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return r.hasAlpha=this.hasAlpha,r.level=this.level,r.coordinatesMode=this.coordinatesMode,this.renderList&&(r.renderList=this.renderList.slice(0)),r},s.prototype.serialize=function(){if(!this.name)return null;var t=n.prototype.serialize.call(this);if(t.renderTargetSize=this.getRenderSize(),t.renderList=[],this.renderList)for(var r=0;r<this.renderList.length;r++)t.renderList.push(this.renderList[r].id);return t},s.prototype.disposeFramebufferObjects=function(){var t=this.getInternalTexture(),r=this.getScene();t&&r&&r.getEngine()._releaseFramebufferObjects(t)},s.prototype.dispose=function(){this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this.clearPostProcesses(!0),this._resizeObserver&&(this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;var t=this.getScene();if(!!t){var r=t.customRenderTargets.indexOf(this);r>=0&&t.customRenderTargets.splice(r,1);for(var a=0,u=t.cameras;a<u.length;a++){var h=u[a];r=h.customRenderTargets.indexOf(this),r>=0&&h.customRenderTargets.splice(r,1)}this.depthStencilTexture&&this.getScene().getEngine()._releaseTexture(this.depthStencilTexture),n.prototype.dispose.call(this)}},s.prototype._rebuild=function(){this.refreshRate===s.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=s.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()},s.prototype.freeRenderingGroups=function(){this._renderingManager&&this._renderingManager.freeRenderingGroups()},s.prototype.getViewCount=function(){return 1},s.REFRESHRATE_RENDER_ONCE=0,s.REFRESHRATE_RENDER_ONEVERYFRAME=1,s.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,s}(y.a);y.a._CreateRenderTargetTexture=function(n,s,t,r){return new o(n,s,t,r)}},463:function(z,x,d){"use strict";d.d(x,"b",function(){return i}),d.d(x,"a",function(){return o});var v=d(443),T=d(438),M=d(611),m=d(449),y=d(445),O=d(448),c=d(440),l=d(668),e=d(473),i;(function(n){n[n.Clean=0]="Clean",n[n.Stop=1]="Stop",n[n.Sync=2]="Sync",n[n.NoSync=3]="NoSync"})(i||(i={}));var o=function(){function n(){}return Object.defineProperty(n,"ForceFullSceneLoadingForIncremental",{get:function(){return l.a.ForceFullSceneLoadingForIncremental},set:function(s){l.a.ForceFullSceneLoadingForIncremental=s},enumerable:!1,configurable:!0}),Object.defineProperty(n,"ShowLoadingScreen",{get:function(){return l.a.ShowLoadingScreen},set:function(s){l.a.ShowLoadingScreen=s},enumerable:!1,configurable:!0}),Object.defineProperty(n,"loggingLevel",{get:function(){return l.a.loggingLevel},set:function(s){l.a.loggingLevel=s},enumerable:!1,configurable:!0}),Object.defineProperty(n,"CleanBoneMatrixWeights",{get:function(){return l.a.CleanBoneMatrixWeights},set:function(s){l.a.CleanBoneMatrixWeights=s},enumerable:!1,configurable:!0}),n.GetDefaultPlugin=function(){return n._registeredPlugins[".babylon"]},n._GetPluginForExtension=function(s){var t=n._registeredPlugins[s];return t||(c.a.Warn("Unable to find a plugin to load "+s+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/how_to/load_from_any_file_type"),n.GetDefaultPlugin())},n._GetPluginForDirectLoad=function(s){for(var t in n._registeredPlugins){var r=n._registeredPlugins[t].plugin;if(r.canDirectLoad&&r.canDirectLoad(s))return n._registeredPlugins[t]}return n.GetDefaultPlugin()},n._GetPluginForFilename=function(s){var t=s.indexOf("?");t!==-1&&(s=s.substring(0,t));var r=s.lastIndexOf("."),a=s.substring(r,s.length).toLowerCase();return n._GetPluginForExtension(a)},n._GetDirectLoad=function(s){return s.substr(0,5)==="data:"?s.substr(5):null},n._LoadData=function(s,t,r,a,u,h,f){var p=n._GetDirectLoad(s.url),_=f?n._GetPluginForExtension(f):p?n._GetPluginForDirectLoad(s.url):n._GetPluginForFilename(s.url),g;if(_.plugin.createPlugin!==void 0?g=_.plugin.createPlugin():g=_.plugin,!g)throw"The loader plugin corresponding to the file type you are trying to load has not been found. If using es6, please import the plugin you wish to use before.";if(n.OnPluginActivatedObservable.notifyObservers(g),p){if(g.directLoad){var P=g.directLoad(t,p);P.then?P.then(function(W){r(g,W)}).catch(function(W){u("Error in directLoad of _loadData: "+W,W)}):r(g,P)}else r(g,p);return g}var E=_.isBinary,R=function(W,J){if(t.isDisposed){u("Scene has been disposed");return}r(g,W,J)},b=null,C=!1,B=g.onDisposeObservable;B&&B.add(function(){C=!0,b&&(b.abort(),b=null),h()});var A=function(){if(!C){var W=function(Q,G){R(Q,G?G.responseURL:void 0)},J=function(Q){u(Q.message,Q)};b=g.requestFile?g.requestFile(t,s.url,W,a,E,J):t._requestFile(s.url,W,a,!0,E,J)}};if(e.a.StartsWith(s.url,"file:"))if(s.file){var F=function(W){u(W.message,W)};b=g.readFile?g.readFile(t,s.file,R,a,E,F):t._readFile(s.file,R,a,E,F)}else u("Unable to find file named "+s.name);else{var N=t.getEngine(),w=N.enableOfflineSupport;if(w){for(var U=!1,j=0,H=t.disableOfflineSupportExceptionRules;j<H.length;j++){var D=H[j];if(D.test(s.url)){U=!0;break}}w=!U}w&&y.a.OfflineProviderFactory?t.offlineProvider=y.a.OfflineProviderFactory(s.url,A,N.disableManifestCheck):A()}return g},n._GetFileInfo=function(s,t){var r,a,u=null;if(!t)r=s,a=v.b.GetFilename(s),s=v.b.GetFolderPath(s);else if(t.name){var h=t;r=s+h.name,a=h.name,u=h}else if(typeof t=="string"&&e.a.StartsWith(t,"data:"))r=t,a="";else{var f=t;if(f.substr(0,1)==="/")return v.b.Error("Wrong sceneFilename parameter"),null;r=s+f,a=f}return!u&&a&&e.a.StartsWith(r,"file:")&&(u=M.a.FilesToLoad[a.toLowerCase()]||null),{url:r,rootUrl:s,name:a,file:u}},n.GetPluginForExtension=function(s){return n._GetPluginForExtension(s).plugin},n.IsPluginForExtensionAvailable=function(s){return!!n._registeredPlugins[s]},n.RegisterPlugin=function(s){if(typeof s.extensions=="string"){var t=s.extensions;n._registeredPlugins[t.toLowerCase()]={plugin:s,isBinary:!1}}else{var r=s.extensions;Object.keys(r).forEach(function(a){n._registeredPlugins[a.toLowerCase()]={plugin:s,isBinary:r[a].isBinary}})}},n.ImportMesh=function(s,t,r,a,u,h,f,p){if(r===void 0&&(r=""),a===void 0&&(a=O.a.LastCreatedScene),u===void 0&&(u=null),h===void 0&&(h=null),f===void 0&&(f=null),p===void 0&&(p=null),!a)return c.a.Error("No scene available to import mesh to"),null;var _=n._GetFileInfo(t,r);if(!_)return null;var g={};a._addPendingData(g);var P=function(){a._removePendingData(g)},E=function(C,B){var A="Unable to import meshes from "+_.url+": "+C;f?f(a,A,B):c.a.Error(A),P()},R=h?function(C){try{h(C)}catch(B){E("Error in onProgress callback: "+B,B)}}:void 0,b=function(C,B,A,F,N,w,U){if(a.importedMeshesFiles.push(_.url),u)try{u(C,B,A,F,N,w,U)}catch(j){E("Error in onSuccess callback: "+j,j)}a._removePendingData(g)};return n._LoadData(_,a,function(C,B,A){if(C.rewriteRootURL&&(_.rootUrl=C.rewriteRootURL(_.rootUrl,A)),C.importMesh){var F=C,N=new Array,w=new Array,U=new Array;if(!F.importMesh(s,a,B,_.rootUrl,N,w,U,E))return;a.loadingPluginName=C.name,b(N,w,U,[],[],[],[])}else{var j=C;j.importMeshAsync(s,a,B,_.rootUrl,R,_.name).then(function(H){a.loadingPluginName=C.name,b(H.meshes,H.particleSystems,H.skeletons,H.animationGroups,H.transformNodes,H.geometries,H.lights)}).catch(function(H){E(H.message,H)})}},R,E,P,p)},n.ImportMeshAsync=function(s,t,r,a,u,h){return r===void 0&&(r=""),a===void 0&&(a=O.a.LastCreatedScene),u===void 0&&(u=null),h===void 0&&(h=null),new Promise(function(f,p){n.ImportMesh(s,t,r,a,function(_,g,P,E,R,b,C){f({meshes:_,particleSystems:g,skeletons:P,animationGroups:E,transformNodes:R,geometries:b,lights:C})},u,function(_,g,P){p(P||new Error(g))},h)})},n.Load=function(s,t,r,a,u,h,f){return t===void 0&&(t=""),r===void 0&&(r=O.a.LastCreatedEngine),a===void 0&&(a=null),u===void 0&&(u=null),h===void 0&&(h=null),f===void 0&&(f=null),r?n.Append(s,t,new m.a(r),a,u,h,f):(v.b.Error("No engine available"),null)},n.LoadAsync=function(s,t,r,a,u){return t===void 0&&(t=""),r===void 0&&(r=O.a.LastCreatedEngine),a===void 0&&(a=null),u===void 0&&(u=null),new Promise(function(h,f){n.Load(s,t,r,function(p){h(p)},a,function(p,_,g){f(g||new Error(_))},u)})},n.Append=function(s,t,r,a,u,h,f){var p=this;if(t===void 0&&(t=""),r===void 0&&(r=O.a.LastCreatedScene),a===void 0&&(a=null),u===void 0&&(u=null),h===void 0&&(h=null),f===void 0&&(f=null),!r)return c.a.Error("No scene available to append to"),null;var _=n._GetFileInfo(s,t);if(!_)return null;n.ShowLoadingScreen&&!this._showingLoadingScreen&&(this._showingLoadingScreen=!0,r.getEngine().displayLoadingUI(),r.executeWhenReady(function(){r.getEngine().hideLoadingUI(),p._showingLoadingScreen=!1}));var g={};r._addPendingData(g);var P=function(){r._removePendingData(g)},E=function(C,B){var A="Unable to load from "+_.url+(C?": "+C:"");h?h(r,A,B):c.a.Error(A),P()},R=u?function(C){try{u(C)}catch(B){E("Error in onProgress callback",B)}}:void 0,b=function(){if(a)try{a(r)}catch(C){E("Error in onSuccess callback",C)}r._removePendingData(g)};return n._LoadData(_,r,function(C,B){if(C.load){var A=C;if(!A.load(r,B,_.rootUrl,E))return;r.loadingPluginName=C.name,b()}else{var F=C;F.loadAsync(r,B,_.rootUrl,R,_.name).then(function(){r.loadingPluginName=C.name,b()}).catch(function(N){E(N.message,N)})}},R,E,P,f)},n.AppendAsync=function(s,t,r,a,u){return t===void 0&&(t=""),r===void 0&&(r=O.a.LastCreatedScene),a===void 0&&(a=null),u===void 0&&(u=null),new Promise(function(h,f){n.Append(s,t,r,function(p){h(p)},a,function(p,_,g){f(g||new Error(_))},u)})},n.LoadAssetContainer=function(s,t,r,a,u,h,f){if(t===void 0&&(t=""),r===void 0&&(r=O.a.LastCreatedScene),a===void 0&&(a=null),u===void 0&&(u=null),h===void 0&&(h=null),f===void 0&&(f=null),!r)return c.a.Error("No scene available to load asset container to"),null;var p=n._GetFileInfo(s,t);if(!p)return null;var _={};r._addPendingData(_);var g=function(){r._removePendingData(_)},P=function(b,C){var B="Unable to load assets from "+p.url+(b?": "+b:"");C&&C.message&&(B+=" ("+C.message+")"),h?h(r,B,C):c.a.Error(B),g()},E=u?function(b){try{u(b)}catch(C){P("Error in onProgress callback",C)}}:void 0,R=function(b){if(a)try{a(b)}catch(C){P("Error in onSuccess callback",C)}r._removePendingData(_)};return n._LoadData(p,r,function(b,C){if(b.loadAssetContainer){var B=b,A=B.loadAssetContainer(r,C,p.rootUrl,P);if(!A)return;r.loadingPluginName=b.name,R(A)}else if(b.loadAssetContainerAsync){var F=b;F.loadAssetContainerAsync(r,C,p.rootUrl,E,p.name).then(function(N){r.loadingPluginName=b.name,R(N)}).catch(function(N){P(N.message,N)})}else P("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")},E,P,g,f)},n.LoadAssetContainerAsync=function(s,t,r,a,u){return t===void 0&&(t=""),r===void 0&&(r=O.a.LastCreatedScene),a===void 0&&(a=null),u===void 0&&(u=null),new Promise(function(h,f){n.LoadAssetContainer(s,t,r,function(p){h(p)},a,function(p,_,g){f(g||new Error(_))},u)})},n.ImportAnimations=function(s,t,r,a,u,h,f,p,_,g){if(t===void 0&&(t=""),r===void 0&&(r=O.a.LastCreatedScene),a===void 0&&(a=!0),u===void 0&&(u=i.Clean),h===void 0&&(h=null),f===void 0&&(f=null),p===void 0&&(p=null),_===void 0&&(_=null),g===void 0&&(g=null),!r){c.a.Error("No scene available to load animations to");return}if(a){for(var P=0,E=r.animatables;P<E.length;P++){var R=E[P];R.reset()}r.stopAllAnimations(),r.animationGroups.slice().forEach(function(A){A.dispose()});var b=r.getNodes();b.forEach(function(A){A.animations&&(A.animations=[])})}else switch(u){case i.Clean:r.animationGroups.slice().forEach(function(A){A.dispose()});break;case i.Stop:r.animationGroups.forEach(function(A){A.stop()});break;case i.Sync:r.animationGroups.forEach(function(A){A.reset(),A.restart()});break;case i.NoSync:break;default:c.a.Error("Unknown animation group loading mode value '"+u+"'");return}var C=r.animatables.length,B=function(A){A.mergeAnimationsTo(r,r.animatables.slice(C),h),A.dispose(),r.onAnimationFileImportedObservable.notifyObservers(r),f&&f(r)};this.LoadAssetContainer(s,t,r,B,p,_,g)},n.ImportAnimationsAsync=function(s,t,r,a,u,h,f,p,_,g){return t===void 0&&(t=""),r===void 0&&(r=O.a.LastCreatedScene),a===void 0&&(a=!0),u===void 0&&(u=i.Clean),h===void 0&&(h=null),f===void 0&&(f=null),p===void 0&&(p=null),_===void 0&&(_=null),g===void 0&&(g=null),new Promise(function(P,E){n.ImportAnimations(s,t,r,a,u,h,function(R){P(R)},p,function(R,b,C){E(C||new Error(b))},g)})},n.NO_LOGGING=0,n.MINIMAL_LOGGING=1,n.SUMMARY_LOGGING=2,n.DETAILED_LOGGING=3,n.OnPluginActivatedObservable=new T.c,n._registeredPlugins={},n._showingLoadingScreen=!1,n}()},492:function(z,x,d){"use strict";var v=d(456),T=d(440),M=d(443),m=d(467);m.a.prototype.updateRawTexture=function(l,e,i,o,n,s){if(n===void 0&&(n=null),s===void 0&&(s=0),!!l){var t=this._getRGBABufferInternalSizedFormat(s,i),r=this._getInternalFormat(i),a=this._getWebGLTextureType(s);this._bindTextureDirectly(this._gl.TEXTURE_2D,l,!0),this._unpackFlipY(o===void 0?!0:!!o),this._doNotHandleContextLost||(l._bufferView=e,l.format=i,l.type=s,l.invertY=o,l._compression=n),l.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),n&&e?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[n],l.width,l.height,0,e):this._gl.texImage2D(this._gl.TEXTURE_2D,0,t,l.width,l.height,0,r,a,e),l.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),l.isReady=!0}},m.a.prototype.createRawTexture=function(l,e,i,o,n,s,t,r,a){r===void 0&&(r=null),a===void 0&&(a=0);var u=new v.a(this,v.b.Raw);u.baseWidth=e,u.baseHeight=i,u.width=e,u.height=i,u.format=o,u.generateMipMaps=n,u.samplingMode=t,u.invertY=s,u._compression=r,u.type=a,this._doNotHandleContextLost||(u._bufferView=l),this.updateRawTexture(u,l,o,s,r,a),this._bindTextureDirectly(this._gl.TEXTURE_2D,u,!0);var h=this._getSamplingParameters(t,n);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,h.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,h.min),n&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(u),u},m.a.prototype.createRawCubeTexture=function(l,e,i,o,n,s,t,r){r===void 0&&(r=null);var a=this._gl,u=new v.a(this,v.b.CubeRaw);u.isCube=!0,u.format=i,u.type=o,this._doNotHandleContextLost||(u._bufferViewArray=l);var h=this._getWebGLTextureType(o),f=this._getInternalFormat(i);f===a.RGB&&(f=a.RGBA),h===a.FLOAT&&!this._caps.textureFloatLinearFiltering?(n=!1,t=1,T.a.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):h===this._gl.HALF_FLOAT_OES&&!this._caps.textureHalfFloatLinearFiltering?(n=!1,t=1,T.a.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):h===a.FLOAT&&!this._caps.textureFloatRender?(n=!1,T.a.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):h===a.HALF_FLOAT&&!this._caps.colorBufferFloat&&(n=!1,T.a.Warn("Render to half float textures is not supported. Mipmap generation forced to false."));var p=e,_=p;u.width=p,u.height=_;var g=!this.needPOTTextures||M.b.IsExponentOfTwo(u.width)&&M.b.IsExponentOfTwo(u.height);g||(n=!1),l&&this.updateRawCubeTexture(u,l,i,o,s,r),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,u,!0),l&&n&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);var P=this._getSamplingParameters(t,n);return a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,P.mag),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,P.min),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,null),u.generateMipMaps=n,u.samplingMode=t,u},m.a.prototype.updateRawCubeTexture=function(l,e,i,o,n,s,t){s===void 0&&(s=null),t===void 0&&(t=0),l._bufferViewArray=e,l.format=i,l.type=o,l.invertY=n,l._compression=s;var r=this._gl,a=this._getWebGLTextureType(o),u=this._getInternalFormat(i),h=this._getRGBABufferInternalSizedFormat(o),f=!1;u===r.RGB&&(u=r.RGBA,f=!0),this._bindTextureDirectly(r.TEXTURE_CUBE_MAP,l,!0),this._unpackFlipY(n===void 0?!0:!!n),l.width%4!=0&&r.pixelStorei(r.UNPACK_ALIGNMENT,1);for(var p=0;p<6;p++){var _=e[p];s?r.compressedTexImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+p,t,this.getCaps().s3tc[s],l.width,l.height,0,_):(f&&(_=y(_,l.width,l.height,o)),r.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+p,t,h,l.width,l.height,0,u,a,_))}var g=!this.needPOTTextures||M.b.IsExponentOfTwo(l.width)&&M.b.IsExponentOfTwo(l.height);g&&l.generateMipMaps&&t===0&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),l.isReady=!0},m.a.prototype.createRawCubeTextureFromUrl=function(l,e,i,o,n,s,t,r,a,u,h,f){var p=this;a===void 0&&(a=null),u===void 0&&(u=null),h===void 0&&(h=3),f===void 0&&(f=!1);var _=this._gl,g=this.createRawCubeTexture(null,i,o,n,!s,f,h,null);e==null||e._addPendingData(g),g.url=l,this._internalTexturesCache.push(g);var P=function(R,b){e==null||e._removePendingData(g),u&&R&&u(R.status+" "+R.statusText,b)},E=function(R){var b=g.width,C=t(R);if(!!C){if(r){var B=p._getWebGLTextureType(n),A=p._getInternalFormat(o),F=p._getRGBABufferInternalSizedFormat(n),N=!1;A===_.RGB&&(A=_.RGBA,N=!0),p._bindTextureDirectly(_.TEXTURE_CUBE_MAP,g,!0),p._unpackFlipY(!1);for(var w=r(C),U=0;U<w.length;U++)for(var j=b>>U,H=0;H<6;H++){var D=w[U][H];N&&(D=y(D,j,j,n)),_.texImage2D(H,U,F,j,j,0,A,B,D)}p._bindTextureDirectly(_.TEXTURE_CUBE_MAP,null)}else p.updateRawCubeTexture(g,C,o,n,f);g.isReady=!0,e==null||e._removePendingData(g),a&&a()}};return this._loadFile(l,function(R){E(R)},void 0,e==null?void 0:e.offlineProvider,!0,P),g};function y(l,e,i,o){var n;o===1?n=new Float32Array(e*i*4):n=new Uint32Array(e*i*4);for(var s=0;s<e;s++)for(var t=0;t<i;t++){var r=(t*e+s)*3,a=(t*e+s)*4;n[a+0]=l[r+0],n[a+1]=l[r+1],n[a+2]=l[r+2],n[a+3]=1}return n}function O(l){return function(e,i,o,n,s,t,r,a,u,h){u===void 0&&(u=null),h===void 0&&(h=0);var f=l?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,p=l?v.b.Raw3D:v.b.Raw2DArray,_=new v.a(this,p);_.baseWidth=i,_.baseHeight=o,_.baseDepth=n,_.width=i,_.height=o,_.depth=n,_.format=s,_.type=h,_.generateMipMaps=t,_.samplingMode=a,l?_.is3D=!0:_.is2DArray=!0,this._doNotHandleContextLost||(_._bufferView=e),l?this.updateRawTexture3D(_,e,s,r,u,h):this.updateRawTexture2DArray(_,e,s,r,u,h),this._bindTextureDirectly(f,_,!0);var g=this._getSamplingParameters(a,t);return this._gl.texParameteri(f,this._gl.TEXTURE_MAG_FILTER,g.mag),this._gl.texParameteri(f,this._gl.TEXTURE_MIN_FILTER,g.min),t&&this._gl.generateMipmap(f),this._bindTextureDirectly(f,null),this._internalTexturesCache.push(_),_}}m.a.prototype.createRawTexture2DArray=O(!1),m.a.prototype.createRawTexture3D=O(!0);function c(l){return function(e,i,o,n,s,t){s===void 0&&(s=null),t===void 0&&(t=0);var r=l?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,a=this._getWebGLTextureType(t),u=this._getInternalFormat(o),h=this._getRGBABufferInternalSizedFormat(t,o);this._bindTextureDirectly(r,e,!0),this._unpackFlipY(n===void 0?!0:!!n),this._doNotHandleContextLost||(e._bufferView=i,e.format=o,e.invertY=n,e._compression=s),e.width%4!=0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),s&&i?this._gl.compressedTexImage3D(r,0,this.getCaps().s3tc[s],e.width,e.height,e.depth,0,i):this._gl.texImage3D(r,0,h,e.width,e.height,e.depth,0,u,a,i),e.generateMipMaps&&this._gl.generateMipmap(r),this._bindTextureDirectly(r,null),e.isReady=!0}}m.a.prototype.updateRawTexture2DArray=c(!1),m.a.prototype.updateRawTexture3D=c(!0)},498:function(z,x,d){"use strict";d.d(x,"a",function(){return c});var v=d(434),T=d(439),M=d(436),m=d(441),y=d(453),O=d(484);y.a.AddNodeConstructor("Light_Type_3",function(l,e){return function(){return new c(l,M.e.Zero(),e)}});var c=function(l){Object(v.d)(e,l);function e(i,o,n){var s=l.call(this,i,n)||this;return s.groundColor=new m.a(0,0,0),s.direction=o||M.e.Up(),s}return e.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()},e.prototype.getClassName=function(){return"HemisphericLight"},e.prototype.setDirectionToTarget=function(i){return this.direction=M.e.Normalize(i.subtract(M.e.Zero())),this.direction},e.prototype.getShadowGenerator=function(){return null},e.prototype.transferToEffect=function(i,o){var n=M.e.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",n.x,n.y,n.z,0,o),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.intensity),o),this},e.prototype.transferToNodeMaterialEffect=function(i,o){var n=M.e.Normalize(this.direction);return i.setFloat3(o,n.x,n.y,n.z),this},e.prototype.computeWorldMatrix=function(){return this._worldMatrix||(this._worldMatrix=M.a.Identity()),this._worldMatrix},e.prototype.getTypeID=function(){return O.a.LIGHTTYPEID_HEMISPHERICLIGHT},e.prototype.prepareLightSpecificDefines=function(i,o){i["HEMILIGHT"+o]=!0},Object(v.c)([Object(T.e)()],e.prototype,"groundColor",void 0),Object(v.c)([Object(T.o)()],e.prototype,"direction",void 0),e}(O.a)},500:function(z,x,d){"use strict";var v=d(434),T=d(456),M=d(440),m=d(595),y=d(467);y.a.prototype.createRenderTargetTexture=function(O,c){var l=new m.a;c!==void 0&&typeof c=="object"?(l.generateMipMaps=c.generateMipMaps,l.generateDepthBuffer=!!c.generateDepthBuffer,l.generateStencilBuffer=!!c.generateStencilBuffer,l.type=c.type===void 0?0:c.type,l.samplingMode=c.samplingMode===void 0?3:c.samplingMode,l.format=c.format===void 0?5:c.format):(l.generateMipMaps=c,l.generateDepthBuffer=!0,l.generateStencilBuffer=!1,l.type=0,l.samplingMode=3,l.format=5),(l.type===1&&!this._caps.textureFloatLinearFiltering||l.type===2&&!this._caps.textureHalfFloatLinearFiltering)&&(l.samplingMode=1),l.type===1&&!this._caps.textureFloat&&(l.type=0,M.a.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));var e=this._gl,i=new T.a(this,T.b.RenderTarget),o=O.width||O,n=O.height||O,s=O.layers||0,t=this._getSamplingParameters(l.samplingMode,!!l.generateMipMaps),r=s!==0?e.TEXTURE_2D_ARRAY:e.TEXTURE_2D,a=this._getRGBABufferInternalSizedFormat(l.type,l.format),u=this._getInternalFormat(l.format),h=this._getWebGLTextureType(l.type);this._bindTextureDirectly(r,i),s!==0?(i.is2DArray=!0,e.texImage3D(r,0,a,o,n,s,0,u,h,null)):e.texImage2D(r,0,a,o,n,0,u,h,null),e.texParameteri(r,e.TEXTURE_MAG_FILTER,t.mag),e.texParameteri(r,e.TEXTURE_MIN_FILTER,t.min),e.texParameteri(r,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(r,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),l.generateMipMaps&&this._gl.generateMipmap(r),this._bindTextureDirectly(r,null);var f=this._currentFramebuffer,p=e.createFramebuffer();return this._bindUnboundFramebuffer(p),i._depthStencilBuffer=this._setupFramebufferDepthAttachments(!!l.generateStencilBuffer,l.generateDepthBuffer,o,n),i.is2DArray||e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,i._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(f),i._framebuffer=p,i.baseWidth=o,i.baseHeight=n,i.width=o,i.height=n,i.depth=s,i.isReady=!0,i.samples=1,i.generateMipMaps=!!l.generateMipMaps,i.samplingMode=l.samplingMode,i.type=l.type,i.format=l.format,i._generateDepthBuffer=l.generateDepthBuffer,i._generateStencilBuffer=!!l.generateStencilBuffer,this._internalTexturesCache.push(i),i},y.a.prototype.createDepthStencilTexture=function(O,c){if(c.isCube){var l=O.width||O;return this._createDepthStencilCubeTexture(l,c)}else return this._createDepthStencilTexture(O,c)},y.a.prototype._createDepthStencilTexture=function(O,c){var l=this._gl,e=O.layers||0,i=e!==0?l.TEXTURE_2D_ARRAY:l.TEXTURE_2D,o=new T.a(this,T.b.Depth);if(!this._caps.depthTextureExtension)return M.a.Error("Depth texture is not supported by your browser or hardware."),o;var n=Object(v.a)({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},c);this._bindTextureDirectly(i,o,!0),this._setupDepthStencilTexture(o,O,n.generateStencil,n.bilinearFiltering,n.comparisonFunction);var s=n.generateStencil?l.UNSIGNED_INT_24_8:l.UNSIGNED_INT,t=n.generateStencil?l.DEPTH_STENCIL:l.DEPTH_COMPONENT,r=t;return this.webGLVersion>1&&(r=n.generateStencil?l.DEPTH24_STENCIL8:l.DEPTH_COMPONENT24),o.is2DArray?l.texImage3D(i,0,r,o.width,o.height,e,0,t,s,null):l.texImage2D(i,0,r,o.width,o.height,0,t,s,null),this._bindTextureDirectly(i,null),o}},503:function(z,x,d){"use strict";d.d(x,"a",function(){return l});var v=d(440),T=d(588),M=d(436),m=d(462),y=d(446),O=d(510),c=d(465);y.a._PhysicsImpostorParser=function(e,i,o){return new l(i,o.physicsImpostor,{mass:o.physicsMass,friction:o.physicsFriction,restitution:o.physicsRestitution},e)};var l=function(){function e(i,o,n,s){var t=this;if(n===void 0&&(n={mass:0}),this.object=i,this.type=o,this._options=n,this._scene=s,this._pluginData={},this._bodyUpdateRequired=!1,this._onBeforePhysicsStepCallbacks=new Array,this._onAfterPhysicsStepCallbacks=new Array,this._onPhysicsCollideCallbacks=[],this._deltaPosition=M.e.Zero(),this._isDisposed=!1,this.soft=!1,this.segments=0,this._tmpQuat=new M.b,this._tmpQuat2=new M.b,this.beforeStep=function(){!t._physicsEngine||(t.object.translate(t._deltaPosition,-1),t._deltaRotationConjugated&&t.object.rotationQuaternion&&t.object.rotationQuaternion.multiplyToRef(t._deltaRotationConjugated,t.object.rotationQuaternion),t.object.computeWorldMatrix(!1),t.object.parent&&t.object.rotationQuaternion?(t.getParentsRotation(),t._tmpQuat.multiplyToRef(t.object.rotationQuaternion,t._tmpQuat)):t._tmpQuat.copyFrom(t.object.rotationQuaternion||new M.b),t._options.disableBidirectionalTransformation||t.object.rotationQuaternion&&t._physicsEngine.getPhysicsPlugin().setPhysicsBodyTransformation(t,t.object.getAbsolutePosition(),t._tmpQuat),t._onBeforePhysicsStepCallbacks.forEach(function(r){r(t)}))},this.afterStep=function(){!t._physicsEngine||(t._onAfterPhysicsStepCallbacks.forEach(function(r){r(t)}),t._physicsEngine.getPhysicsPlugin().setTransformationFromPhysicsBody(t),t.object.parent&&t.object.rotationQuaternion&&(t.getParentsRotation(),t._tmpQuat.conjugateInPlace(),t._tmpQuat.multiplyToRef(t.object.rotationQuaternion,t.object.rotationQuaternion)),t.object.setAbsolutePosition(t.object.position),t._deltaRotation&&t.object.rotationQuaternion&&t.object.rotationQuaternion.multiplyToRef(t._deltaRotation,t.object.rotationQuaternion),t.object.translate(t._deltaPosition,1))},this.onCollideEvent=null,this.onCollide=function(r){if(!(!t._onPhysicsCollideCallbacks.length&&!t.onCollideEvent)&&!!t._physicsEngine){var a=t._physicsEngine.getImpostorWithPhysicsBody(r.body);a&&(t.onCollideEvent&&t.onCollideEvent(t,a),t._onPhysicsCollideCallbacks.filter(function(u){return u.otherImpostors.indexOf(a)!==-1}).forEach(function(u){u.callback(t,a,r.point)}))}},!this.object){v.a.Error("No object was provided. A physics object is obligatory");return}this.object.parent&&n.mass!==0&&v.a.Warn("A physics impostor has been created for an object which has a parent. Babylon physics currently works in local space so unexpected issues may occur."),!this._scene&&i.getScene&&(this._scene=i.getScene()),!!this._scene&&(this.type>100&&(this.soft=!0),this._physicsEngine=this._scene.getPhysicsEngine(),this._physicsEngine?(this.object.rotationQuaternion||(this.object.rotation?this.object.rotationQuaternion=M.b.RotationYawPitchRoll(this.object.rotation.y,this.object.rotation.x,this.object.rotation.z):this.object.rotationQuaternion=new M.b),this._options.mass=n.mass===void 0?0:n.mass,this._options.friction=n.friction===void 0?.2:n.friction,this._options.restitution=n.restitution===void 0?.2:n.restitution,this.soft&&(this._options.mass=this._options.mass>0?this._options.mass:1,this._options.pressure=n.pressure===void 0?200:n.pressure,this._options.stiffness=n.stiffness===void 0?1:n.stiffness,this._options.velocityIterations=n.velocityIterations===void 0?20:n.velocityIterations,this._options.positionIterations=n.positionIterations===void 0?20:n.positionIterations,this._options.fixedPoints=n.fixedPoints===void 0?0:n.fixedPoints,this._options.margin=n.margin===void 0?0:n.margin,this._options.damping=n.damping===void 0?0:n.damping,this._options.path=n.path===void 0?null:n.path,this._options.shape=n.shape===void 0?null:n.shape),this._joints=[],!this.object.parent||this._options.ignoreParent?this._init():this.object.parent.physicsImpostor&&v.a.Warn("You must affect impostors to children before affecting impostor to parent.")):v.a.Error("Physics not enabled. Please use scene.enablePhysics(...) before creating impostors."))}return Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mass",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyMass(this):0},set:function(i){this.setMass(i)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"friction",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyFriction(this):0},set:function(i){!this._physicsEngine||this._physicsEngine.getPhysicsPlugin().setBodyFriction(this,i)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"restitution",{get:function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getBodyRestitution(this):0},set:function(i){!this._physicsEngine||this._physicsEngine.getPhysicsPlugin().setBodyRestitution(this,i)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pressure",{get:function(){if(!this._physicsEngine)return 0;var i=this._physicsEngine.getPhysicsPlugin();return i.setBodyPressure?i.getBodyPressure(this):0},set:function(i){if(!!this._physicsEngine){var o=this._physicsEngine.getPhysicsPlugin();!o.setBodyPressure||o.setBodyPressure(this,i)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"stiffness",{get:function(){if(!this._physicsEngine)return 0;var i=this._physicsEngine.getPhysicsPlugin();return i.getBodyStiffness?i.getBodyStiffness(this):0},set:function(i){if(!!this._physicsEngine){var o=this._physicsEngine.getPhysicsPlugin();!o.setBodyStiffness||o.setBodyStiffness(this,i)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"velocityIterations",{get:function(){if(!this._physicsEngine)return 0;var i=this._physicsEngine.getPhysicsPlugin();return i.getBodyVelocityIterations?i.getBodyVelocityIterations(this):0},set:function(i){if(!!this._physicsEngine){var o=this._physicsEngine.getPhysicsPlugin();!o.setBodyVelocityIterations||o.setBodyVelocityIterations(this,i)}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"positionIterations",{get:function(){if(!this._physicsEngine)return 0;var i=this._physicsEngine.getPhysicsPlugin();return i.getBodyPositionIterations?i.getBodyPositionIterations(this):0},set:function(i){if(!!this._physicsEngine){var o=this._physicsEngine.getPhysicsPlugin();!o.setBodyPositionIterations||o.setBodyPositionIterations(this,i)}},enumerable:!1,configurable:!0}),e.prototype._init=function(){!this._physicsEngine||(this._physicsEngine.removeImpostor(this),this.physicsBody=null,this._parent=this._parent||this._getPhysicsParent(),!this._isDisposed&&(!this.parent||this._options.ignoreParent)&&this._physicsEngine.addImpostor(this))},e.prototype._getPhysicsParent=function(){if(this.object.parent instanceof m.a){var i=this.object.parent;return i.physicsImpostor}return null},e.prototype.isBodyInitRequired=function(){return this._bodyUpdateRequired||!this._physicsBody&&!this._parent},e.prototype.setScalingUpdated=function(){this.forceUpdate()},e.prototype.forceUpdate=function(){this._init(),this.parent&&!this._options.ignoreParent&&this.parent.forceUpdate()},Object.defineProperty(e.prototype,"physicsBody",{get:function(){return this._parent&&!this._options.ignoreParent?this._parent.physicsBody:this._physicsBody},set:function(i){this._physicsBody&&this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().removePhysicsBody(this),this._physicsBody=i,this.resetUpdateFlags()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return!this._options.ignoreParent&&this._parent?this._parent:null},set:function(i){this._parent=i},enumerable:!1,configurable:!0}),e.prototype.resetUpdateFlags=function(){this._bodyUpdateRequired=!1},e.prototype.getObjectExtendSize=function(){if(this.object.getBoundingInfo){var i=this.object.rotationQuaternion,o=this.object.scaling.clone();this.object.rotationQuaternion=e.IDENTITY_QUATERNION;var n=this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0);n&&n.decompose(o,void 0,void 0);var s=this.object.getBoundingInfo(),t=s.boundingBox.extendSize.scale(2).multiplyInPlace(o);return this.object.rotationQuaternion=i,this.object.computeWorldMatrix&&this.object.computeWorldMatrix(!0),t}else return e.DEFAULT_OBJECT_SIZE},e.prototype.getObjectCenter=function(){if(this.object.getBoundingInfo){var i=this.object.getBoundingInfo();return i.boundingBox.centerWorld}else return this.object.position},e.prototype.getParam=function(i){return this._options[i]},e.prototype.setParam=function(i,o){this._options[i]=o,this._bodyUpdateRequired=!0},e.prototype.setMass=function(i){this.getParam("mass")!==i&&this.setParam("mass",i),this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setBodyMass(this,i)},e.prototype.getLinearVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getLinearVelocity(this):M.e.Zero()},e.prototype.setLinearVelocity=function(i){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setLinearVelocity(this,i)},e.prototype.getAngularVelocity=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getAngularVelocity(this):M.e.Zero()},e.prototype.setAngularVelocity=function(i){this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().setAngularVelocity(this,i)},e.prototype.executeNativeFunction=function(i){this._physicsEngine&&i(this._physicsEngine.getPhysicsPlugin().world,this.physicsBody)},e.prototype.registerBeforePhysicsStep=function(i){this._onBeforePhysicsStepCallbacks.push(i)},e.prototype.unregisterBeforePhysicsStep=function(i){var o=this._onBeforePhysicsStepCallbacks.indexOf(i);o>-1?this._onBeforePhysicsStepCallbacks.splice(o,1):v.a.Warn("Function to remove was not found")},e.prototype.registerAfterPhysicsStep=function(i){this._onAfterPhysicsStepCallbacks.push(i)},e.prototype.unregisterAfterPhysicsStep=function(i){var o=this._onAfterPhysicsStepCallbacks.indexOf(i);o>-1?this._onAfterPhysicsStepCallbacks.splice(o,1):v.a.Warn("Function to remove was not found")},e.prototype.registerOnPhysicsCollide=function(i,o){var n=i instanceof Array?i:[i];this._onPhysicsCollideCallbacks.push({callback:o,otherImpostors:n})},e.prototype.unregisterOnPhysicsCollide=function(i,o){var n=i instanceof Array?i:[i],s=-1,t=this._onPhysicsCollideCallbacks.some(function(r,a){if(r.callback===o&&r.otherImpostors.length===n.length){var u=r.otherImpostors.every(function(h){return n.indexOf(h)>-1});return u&&(s=a),u}return!1});t?this._onPhysicsCollideCallbacks.splice(s,1):v.a.Warn("Function to remove was not found")},e.prototype.getParentsRotation=function(){var i=this.object.parent;for(this._tmpQuat.copyFromFloats(0,0,0,1);i;)i.rotationQuaternion?this._tmpQuat2.copyFrom(i.rotationQuaternion):M.b.RotationYawPitchRollToRef(i.rotation.y,i.rotation.x,i.rotation.z,this._tmpQuat2),this._tmpQuat.multiplyToRef(this._tmpQuat2,this._tmpQuat),i=i.parent;return this._tmpQuat},e.prototype.applyForce=function(i,o){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyForce(this,i,o),this},e.prototype.applyImpulse=function(i,o){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().applyImpulse(this,i,o),this},e.prototype.createJoint=function(i,o,n){var s=new O.e(o,n);return this.addJoint(i,s),this},e.prototype.addJoint=function(i,o){return this._joints.push({otherImpostor:i,joint:o}),this._physicsEngine&&this._physicsEngine.addJoint(this,i,o),this},e.prototype.addAnchor=function(i,o,n,s,t){if(!this._physicsEngine)return this;var r=this._physicsEngine.getPhysicsPlugin();return r.appendAnchor?(this._physicsEngine&&r.appendAnchor(this,i,o,n,s,t),this):this},e.prototype.addHook=function(i,o,n,s){if(!this._physicsEngine)return this;var t=this._physicsEngine.getPhysicsPlugin();return t.appendAnchor?(this._physicsEngine&&t.appendHook(this,i,o,n,s),this):this},e.prototype.sleep=function(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().sleepBody(this),this},e.prototype.wakeUp=function(){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().wakeUpBody(this),this},e.prototype.clone=function(i){return i?new e(i,this.type,this._options,this._scene):null},e.prototype.dispose=function(){var i=this;!this._physicsEngine||(this._joints.forEach(function(o){i._physicsEngine&&i._physicsEngine.removeJoint(i,o.otherImpostor,o.joint)}),this._physicsEngine.removeImpostor(this),this.parent&&this.parent.forceUpdate(),this._isDisposed=!0)},e.prototype.setDeltaPosition=function(i){this._deltaPosition.copyFrom(i)},e.prototype.setDeltaRotation=function(i){this._deltaRotation||(this._deltaRotation=new M.b),this._deltaRotation.copyFrom(i),this._deltaRotationConjugated=this._deltaRotation.conjugate()},e.prototype.getBoxSizeToRef=function(i){return this._physicsEngine&&this._physicsEngine.getPhysicsPlugin().getBoxSizeToRef(this,i),this},e.prototype.getRadius=function(){return this._physicsEngine?this._physicsEngine.getPhysicsPlugin().getRadius(this):0},e.prototype.syncBoneWithImpostor=function(i,o,n,s,t){var r=e._tmpVecs[0],a=this.object;if(a.rotationQuaternion)if(t){var u=e._tmpQuat;a.rotationQuaternion.multiplyToRef(t,u),i.setRotationQuaternion(u,c.c.WORLD,o)}else i.setRotationQuaternion(a.rotationQuaternion,c.c.WORLD,o);r.x=0,r.y=0,r.z=0,n&&(r.x=n.x,r.y=n.y,r.z=n.z,i.getDirectionToRef(r,o,r),s==null&&(s=n.length()),r.x*=s,r.y*=s,r.z*=s),i.getParent()?(r.addInPlace(a.getAbsolutePosition()),i.setAbsolutePosition(r,o)):(o.setAbsolutePosition(a.getAbsolutePosition()),o.position.x-=r.x,o.position.y-=r.y,o.position.z-=r.z)},e.prototype.syncImpostorWithBone=function(i,o,n,s,t,r){var a=this.object;if(a.rotationQuaternion)if(t){var u=e._tmpQuat;i.getRotationQuaternionToRef(c.c.WORLD,o,u),u.multiplyToRef(t,a.rotationQuaternion)}else i.getRotationQuaternionToRef(c.c.WORLD,o,a.rotationQuaternion);var h=e._tmpVecs[0],f=e._tmpVecs[1];r||(r=e._tmpVecs[2],r.x=0,r.y=1,r.z=0),i.getDirectionToRef(r,o,f),i.getAbsolutePositionToRef(o,h),s==null&&n&&(s=n.length()),s!=null&&(h.x+=f.x*s,h.y+=f.y*s,h.z+=f.z*s),a.setAbsolutePosition(h)},e.DEFAULT_OBJECT_SIZE=new M.e(1,1,1),e.IDENTITY_QUATERNION=M.b.Identity(),e._tmpVecs=T.a.BuildArray(3,M.e.Zero),e._tmpQuat=M.b.Identity(),e.NoImpostor=0,e.SphereImpostor=1,e.BoxImpostor=2,e.PlaneImpostor=3,e.MeshImpostor=4,e.CapsuleImpostor=6,e.CylinderImpostor=7,e.ParticleImpostor=8,e.HeightmapImpostor=9,e.ConvexHullImpostor=10,e.CustomImpostor=100,e.RopeImpostor=101,e.ClothImpostor=102,e.SoftbodyImpostor=103,e}()},504:function(z,x,d){"use strict";d.d(x,"a",function(){return o});var v=d(434),T=d(439),M=d(443),m=d(436),y=d(477),O=d(442),c=d(437),l=d(565),e=d(473),i=d(438),o=function(n){Object(v.d)(s,n);function s(t,r,a,u,h,f,p,_,g,P,E,R,b,C){a===void 0&&(a=null),u===void 0&&(u=!1),h===void 0&&(h=null),f===void 0&&(f=null),p===void 0&&(p=null),_===void 0&&(_=5),g===void 0&&(g=!1),P===void 0&&(P=null),E===void 0&&(E=!1),R===void 0&&(R=.8),b===void 0&&(b=0);var B,A=n.call(this,r)||this;if(A.onLoadObservable=new i.c,A.boundingBoxPosition=m.e.Zero(),A._rotationY=0,A._files=null,A._forcedExtension=null,A._extensions=null,A.name=t,A.url=t,A._noMipmap=u,A.hasAlpha=!1,A._format=_,A.isCube=!0,A._textureMatrix=m.a.Identity(),A._createPolynomials=E,A.coordinatesMode=O.a.CUBIC_MODE,A._extensions=a,A._files=h,A._forcedExtension=P,A._loaderOptions=C,!t&&!h)return A;var F=t.lastIndexOf("."),N=P||(F>-1?t.substring(F).toLowerCase():""),w=N.indexOf(".dds")===0,U=N.indexOf(".env")===0;if(U?(A.gammaSpace=!1,A._prefiltered=!1,A.anisotropicFilteringLevel=1):(A._prefiltered=g,g&&(A.gammaSpace=!1,A.anisotropicFilteringLevel=1)),A._texture=A._getFromCache(t,u),!h&&(!U&&!w&&!a&&(a=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),h=[],a))for(var j=0;j<a.length;j++)h.push(t+a[j]);A._files=h;var H=function(){A.onLoadObservable.notifyObservers(A),f&&f()};if(A._texture)A._texture.isReady?M.b.SetImmediate(function(){return H()}):A._texture.onLoadedObservable.add(function(){return H()});else{var D=A.getScene();(D==null?void 0:D.useDelayedTextureLoading)?A.delayLoadState=4:(g?A._texture=A._getEngine().createPrefilteredCubeTexture(t,D,R,b,f,p,_,P,A._createPolynomials):A._texture=A._getEngine().createCubeTexture(t,D,h,u,f,p,A._format,P,!1,R,b,null,C),(B=A._texture)===null||B===void 0||B.onLoadedObservable.add(function(){return A.onLoadObservable.notifyObservers(A)}))}return A}return Object.defineProperty(s.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(t){if(!(this._boundingBoxSize&&this._boundingBoxSize.equals(t))){this._boundingBoxSize=t;var r=this.getScene();r&&r.markAllMaterialsAsDirty(1)}},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"rotationY",{get:function(){return this._rotationY},set:function(t){this._rotationY=t,this.setReflectionTextureMatrix(m.a.RotationY(this._rotationY))},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"forcedExtension",{get:function(){return this._forcedExtension},enumerable:!1,configurable:!0}),s.CreateFromImages=function(t,r,a){var u="";return t.forEach(function(h){return u+=h}),new s(u,r,null,a,t)},s.CreateFromPrefilteredData=function(t,r,a,u){a===void 0&&(a=null),u===void 0&&(u=!0);var h=r.useDelayedTextureLoading;r.useDelayedTextureLoading=!1;var f=new s(t,r,null,!1,null,null,null,void 0,!0,a,u);return r.useDelayedTextureLoading=h,f},s.prototype.getClassName=function(){return"CubeTexture"},s.prototype.updateURL=function(t,r,a,u){var h;u===void 0&&(u=!1),this.url&&(this.releaseInternalTexture(),(h=this.getScene())===null||h===void 0||h.markAllMaterialsAsDirty(1)),(!this.name||e.a.StartsWith(this.name,"data:"))&&(this.name=t),this.url=t,this.delayLoadState=4,this._prefiltered=u,this._prefiltered&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1),this._forcedExtension=r||null,a&&(this._delayedOnLoad=a),this.delayLoad(r)},s.prototype.delayLoad=function(t){var r=this,a;if(this.delayLoadState===4&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap),!this._texture)){var u=this.getScene();this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,u,.8,0,this._delayedOnLoad,void 0,this._format,t,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,u,this._files,this._noMipmap,this._delayedOnLoad,null,this._format,t,!1,0,0,null,this._loaderOptions),(a=this._texture)===null||a===void 0||a.onLoadedObservable.add(function(){return r.onLoadObservable.notifyObservers(r)})}},s.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},s.prototype.setReflectionTextureMatrix=function(t){var r=this,a;t.updateFlag!==this._textureMatrix.updateFlag&&(t.isIdentity()!==this._textureMatrix.isIdentity()&&((a=this.getScene())===null||a===void 0||a.markAllMaterialsAsDirty(1,function(u){return u.getActiveTextures().indexOf(r)!==-1})),this._textureMatrix=t)},s.Parse=function(t,r,a){var u=T.a.Parse(function(){var _=!1;return t.prefiltered&&(_=t.prefiltered),new s(a+t.name,r,t.extensions,!1,t.files||null,null,null,void 0,_,t.forcedExtension)},t,r);if(t.boundingBoxPosition&&(u.boundingBoxPosition=m.e.FromArray(t.boundingBoxPosition)),t.boundingBoxSize&&(u.boundingBoxSize=m.e.FromArray(t.boundingBoxSize)),t.animations)for(var h=0;h<t.animations.length;h++){var f=t.animations[h],p=c.a.GetClass("BABYLON.Animation");p&&u.animations.push(p.Parse(f))}return u},s.prototype.clone=function(){var t=this,r=0,a=T.a.Clone(function(){var u=new s(t.url,t.getScene()||t._getEngine(),t._extensions,t._noMipmap,t._files);return r=u.uniqueId,u},this);return a.uniqueId=r,a},Object(v.c)([Object(T.c)()],s.prototype,"url",void 0),Object(v.c)([Object(T.c)("rotationY")],s.prototype,"rotationY",null),Object(v.c)([Object(T.c)("files")],s.prototype,"_files",void 0),Object(v.c)([Object(T.c)("forcedExtension")],s.prototype,"_forcedExtension",void 0),Object(v.c)([Object(T.c)("extensions")],s.prototype,"_extensions",void 0),Object(v.c)([Object(T.j)("textureMatrix")],s.prototype,"_textureMatrix",void 0),s}(y.a);O.a._CubeTextureParser=o.Parse,c.a.RegisteredTypes["BABYLON.CubeTexture"]=o},510:function(z,x,d){"use strict";d.d(x,"e",function(){return T}),d.d(x,"a",function(){return M}),d.d(x,"d",function(){return m}),d.d(x,"c",function(){return y}),d.d(x,"b",function(){return O});var v=d(434),T=function(){function c(l,e){this.type=l,this.jointData=e,e.nativeParams=e.nativeParams||{}}return Object.defineProperty(c.prototype,"physicsJoint",{get:function(){return this._physicsJoint},set:function(l){this._physicsJoint,this._physicsJoint=l},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"physicsPlugin",{set:function(l){this._physicsPlugin=l},enumerable:!1,configurable:!0}),c.prototype.executeNativeFunction=function(l){l(this._physicsPlugin.world,this._physicsJoint)},c.DistanceJoint=0,c.HingeJoint=1,c.BallAndSocketJoint=2,c.WheelJoint=3,c.SliderJoint=4,c.PrismaticJoint=5,c.UniversalJoint=6,c.Hinge2Joint=c.WheelJoint,c.PointToPointJoint=8,c.SpringJoint=9,c.LockJoint=10,c}(),M=function(c){Object(v.d)(l,c);function l(e){return c.call(this,T.DistanceJoint,e)||this}return l.prototype.updateDistance=function(e,i){this._physicsPlugin.updateDistanceJoint(this,e,i)},l}(T),m=function(c){Object(v.d)(l,c);function l(e,i){return c.call(this,e,i)||this}return l.prototype.setMotor=function(e,i){this._physicsPlugin.setMotor(this,e||0,i)},l.prototype.setLimit=function(e,i){this._physicsPlugin.setLimit(this,e,i)},l}(T),y=function(c){Object(v.d)(l,c);function l(e){return c.call(this,T.HingeJoint,e)||this}return l.prototype.setMotor=function(e,i){this._physicsPlugin.setMotor(this,e||0,i)},l.prototype.setLimit=function(e,i){this._physicsPlugin.setLimit(this,e,i)},l}(m),O=function(c){Object(v.d)(l,c);function l(e){return c.call(this,T.Hinge2Joint,e)||this}return l.prototype.setMotor=function(e,i,o){o===void 0&&(o=0),this._physicsPlugin.setMotor(this,e||0,i,o)},l.prototype.setLimit=function(e,i,o){o===void 0&&(o=0),this._physicsPlugin.setLimit(this,e,i,o)},l}(m)},511:function(z,x,d){"use strict";d.d(x,"a",function(){return y});var v=d(438),T=d(436),M=d(441),m=d(437),y=function(){function O(c,l){this.triggerOptions=c,this.onBeforeExecuteObservable=new v.c,c.parameter?(this.trigger=c.trigger,this._triggerParameter=c.parameter):c.trigger?this.trigger=c.trigger:this.trigger=c,this._nextActiveAction=this,this._condition=l}return O.prototype._prepare=function(){},O.prototype.getTriggerParameter=function(){return this._triggerParameter},O.prototype.setTriggerParameter=function(c){this._triggerParameter=c},O.prototype._executeCurrent=function(c){if(this._nextActiveAction._condition){var l=this._nextActiveAction._condition,e=this._actionManager.getScene().getRenderId();if(l._evaluationId===e){if(!l._currentResult)return}else{if(l._evaluationId=e,!l.isValid()){l._currentResult=!1;return}l._currentResult=!0}}this.onBeforeExecuteObservable.notifyObservers(this),this._nextActiveAction.execute(c),this.skipToNextActiveAction()},O.prototype.execute=function(c){},O.prototype.skipToNextActiveAction=function(){this._nextActiveAction._child?(this._nextActiveAction._child._actionManager||(this._nextActiveAction._child._actionManager=this._actionManager),this._nextActiveAction=this._nextActiveAction._child):this._nextActiveAction=this},O.prototype.then=function(c){return this._child=c,c._actionManager=this._actionManager,c._prepare(),c},O.prototype._getProperty=function(c){return this._actionManager._getProperty(c)},O.prototype._getEffectiveTarget=function(c,l){return this._actionManager._getEffectiveTarget(c,l)},O.prototype.serialize=function(c){},O.prototype._serialize=function(c,l){var e={type:1,children:[],name:c.name,properties:c.properties||[]};if(this._child&&this._child.serialize(e),this._condition){var i=this._condition.serialize();return i.children.push(e),l&&l.children.push(i),i}return l&&l.children.push(e),e},O._SerializeValueAsString=function(c){return typeof c=="number"?c.toString():typeof c=="boolean"?c?"true":"false":c instanceof T.d?c.x+", "+c.y:c instanceof T.e?c.x+", "+c.y+", "+c.z:c instanceof M.a?c.r+", "+c.g+", "+c.b:c instanceof M.b?c.r+", "+c.g+", "+c.b+", "+c.a:c},O._GetTargetProperty=function(c){return{name:"target",targetType:c._isMesh?"MeshProperties":c._isLight?"LightProperties":c._isCamera?"CameraProperties":"SceneProperties",value:c._isScene?"Scene":c.name}},O}();m.a.RegisteredTypes["BABYLON.Action"]=y},513:function(z,x,d){"use strict";d.d(x,"a",function(){return O}),d.d(x,"b",function(){return c});var v=d(436),T=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],M=[function(l){return 1},function(l){return l.y},function(l){return l.z},function(l){return l.x},function(l){return l.x*l.y},function(l){return l.y*l.z},function(l){return 3*l.z*l.z-1},function(l){return l.x*l.z},function(l){return l.x*l.x-l.y*l.y}],m=function(l,e){return T[l]*M[l](e)},y=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4],O=function(){function l(){this.preScaled=!1,this.l00=v.e.Zero(),this.l1_1=v.e.Zero(),this.l10=v.e.Zero(),this.l11=v.e.Zero(),this.l2_2=v.e.Zero(),this.l2_1=v.e.Zero(),this.l20=v.e.Zero(),this.l21=v.e.Zero(),this.l22=v.e.Zero()}return l.prototype.addLight=function(e,i,o){var n=new v.e(i.r,i.g,i.b),s=n.scale(o);this.l00=this.l00.add(s.scale(m(0,e))),this.l1_1=this.l1_1.add(s.scale(m(1,e))),this.l10=this.l10.add(s.scale(m(2,e))),this.l11=this.l11.add(s.scale(m(3,e))),this.l2_2=this.l2_2.add(s.scale(m(4,e))),this.l2_1=this.l2_1.add(s.scale(m(5,e))),this.l20=this.l20.add(s.scale(m(6,e))),this.l21=this.l21.add(s.scale(m(7,e))),this.l22=this.l22.add(s.scale(m(8,e)))},l.prototype.scaleInPlace=function(e){this.l00.scaleInPlace(e),this.l1_1.scaleInPlace(e),this.l10.scaleInPlace(e),this.l11.scaleInPlace(e),this.l2_2.scaleInPlace(e),this.l2_1.scaleInPlace(e),this.l20.scaleInPlace(e),this.l21.scaleInPlace(e),this.l22.scaleInPlace(e)},l.prototype.convertIncidentRadianceToIrradiance=function(){this.l00.scaleInPlace(y[0]),this.l1_1.scaleInPlace(y[1]),this.l10.scaleInPlace(y[2]),this.l11.scaleInPlace(y[3]),this.l2_2.scaleInPlace(y[4]),this.l2_1.scaleInPlace(y[5]),this.l20.scaleInPlace(y[6]),this.l21.scaleInPlace(y[7]),this.l22.scaleInPlace(y[8])},l.prototype.convertIrradianceToLambertianRadiance=function(){this.scaleInPlace(1/Math.PI)},l.prototype.preScaleForRendering=function(){this.preScaled=!0,this.l00.scaleInPlace(T[0]),this.l1_1.scaleInPlace(T[1]),this.l10.scaleInPlace(T[2]),this.l11.scaleInPlace(T[3]),this.l2_2.scaleInPlace(T[4]),this.l2_1.scaleInPlace(T[5]),this.l20.scaleInPlace(T[6]),this.l21.scaleInPlace(T[7]),this.l22.scaleInPlace(T[8])},l.FromArray=function(e){var i=new l;return v.e.FromArrayToRef(e[0],0,i.l00),v.e.FromArrayToRef(e[1],0,i.l1_1),v.e.FromArrayToRef(e[2],0,i.l10),v.e.FromArrayToRef(e[3],0,i.l11),v.e.FromArrayToRef(e[4],0,i.l2_2),v.e.FromArrayToRef(e[5],0,i.l2_1),v.e.FromArrayToRef(e[6],0,i.l20),v.e.FromArrayToRef(e[7],0,i.l21),v.e.FromArrayToRef(e[8],0,i.l22),i},l.FromPolynomial=function(e){var i=new l;return i.l00=e.xx.scale(.376127).add(e.yy.scale(.376127)).add(e.zz.scale(.376126)),i.l1_1=e.y.scale(.977204),i.l10=e.z.scale(.977204),i.l11=e.x.scale(.977204),i.l2_2=e.xy.scale(1.16538),i.l2_1=e.yz.scale(1.16538),i.l20=e.zz.scale(1.34567).subtract(e.xx.scale(.672834)).subtract(e.yy.scale(.672834)),i.l21=e.zx.scale(1.16538),i.l22=e.xx.scale(1.16538).subtract(e.yy.scale(1.16538)),i.l1_1.scaleInPlace(-1),i.l11.scaleInPlace(-1),i.l2_1.scaleInPlace(-1),i.l21.scaleInPlace(-1),i.scaleInPlace(Math.PI),i},l}(),c=function(){function l(){this.x=v.e.Zero(),this.y=v.e.Zero(),this.z=v.e.Zero(),this.xx=v.e.Zero(),this.yy=v.e.Zero(),this.zz=v.e.Zero(),this.xy=v.e.Zero(),this.yz=v.e.Zero(),this.zx=v.e.Zero()}return Object.defineProperty(l.prototype,"preScaledHarmonics",{get:function(){return this._harmonics||(this._harmonics=O.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics},enumerable:!1,configurable:!0}),l.prototype.addAmbient=function(e){var i=new v.e(e.r,e.g,e.b);this.xx=this.xx.add(i),this.yy=this.yy.add(i),this.zz=this.zz.add(i)},l.prototype.scaleInPlace=function(e){this.x.scaleInPlace(e),this.y.scaleInPlace(e),this.z.scaleInPlace(e),this.xx.scaleInPlace(e),this.yy.scaleInPlace(e),this.zz.scaleInPlace(e),this.yz.scaleInPlace(e),this.zx.scaleInPlace(e),this.xy.scaleInPlace(e)},l.FromHarmonics=function(e){var i=new l;return i._harmonics=e,i.x=e.l11.scale(1.02333).scale(-1),i.y=e.l1_1.scale(1.02333).scale(-1),i.z=e.l10.scale(1.02333),i.xx=e.l00.scale(.886277).subtract(e.l20.scale(.247708)).add(e.l22.scale(.429043)),i.yy=e.l00.scale(.886277).subtract(e.l20.scale(.247708)).subtract(e.l22.scale(.429043)),i.zz=e.l00.scale(.886277).add(e.l20.scale(.495417)),i.yz=e.l2_1.scale(.858086).scale(-1),i.zx=e.l21.scale(.858086).scale(-1),i.xy=e.l2_2.scale(.858086),i.scaleInPlace(1/Math.PI),i},l.FromArray=function(e){var i=new l;return v.e.FromArrayToRef(e[0],0,i.x),v.e.FromArrayToRef(e[1],0,i.y),v.e.FromArrayToRef(e[2],0,i.z),v.e.FromArrayToRef(e[3],0,i.xx),v.e.FromArrayToRef(e[4],0,i.yy),v.e.FromArrayToRef(e[5],0,i.zz),v.e.FromArrayToRef(e[6],0,i.yz),v.e.FromArrayToRef(e[7],0,i.zx),v.e.FromArrayToRef(e[8],0,i.xy),i},l}()},521:function(z,x,d){"use strict";d.d(x,"a",function(){return c});var v=d(436),T=d(450),M=d(513),m=d(515),y=d(441),O=function(){function l(e,i,o,n){this.name=e,this.worldAxisForNormal=i,this.worldAxisForFileX=o,this.worldAxisForFileY=n}return l}(),c=function(){function l(){}return l.ConvertCubeMapTextureToSphericalPolynomial=function(e){var i=this,o;if(!e.isCube)return null;(o=e.getScene())===null||o===void 0||o.getEngine().flushFramebuffer();var n=e.getSize().width,s=e.readPixels(0,void 0,void 0,!1),t=e.readPixels(1,void 0,void 0,!1),r,a;e.isRenderTarget?(r=e.readPixels(3,void 0,void 0,!1),a=e.readPixels(2,void 0,void 0,!1)):(r=e.readPixels(2,void 0,void 0,!1),a=e.readPixels(3,void 0,void 0,!1));var u=e.readPixels(4,void 0,void 0,!1),h=e.readPixels(5,void 0,void 0,!1),f=e.gammaSpace,p=5,_=0;return(e.textureType==1||e.textureType==2)&&(_=1),new Promise(function(g,P){Promise.all([t,s,r,a,u,h]).then(function(E){var R=E[0],b=E[1],C=E[2],B=E[3],A=E[4],F=E[5],N={size:n,right:b,left:R,up:C,down:B,front:A,back:F,format:p,type:_,gammaSpace:f};g(i.ConvertCubeMapToSphericalPolynomial(N))})})},l.ConvertCubeMapToSphericalPolynomial=function(e){for(var i=new M.a,o=0,n=2/e.size,s=n,t=n*.5-1,r=0;r<6;r++)for(var a=this.FileFaces[r],u=e[a.name],h=t,f=e.format===5?4:3,p=0;p<e.size;p++){for(var _=t,g=0;g<e.size;g++){var P=a.worldAxisForFileX.scale(_).add(a.worldAxisForFileY.scale(h)).add(a.worldAxisForNormal);P.normalize();var E=Math.pow(1+_*_+h*h,-3/2),R=u[p*e.size*f+g*f+0],b=u[p*e.size*f+g*f+1],C=u[p*e.size*f+g*f+2];isNaN(R)&&(R=0),isNaN(b)&&(b=0),isNaN(C)&&(C=0),e.type===0&&(R/=255,b/=255,C/=255),e.gammaSpace&&(R=Math.pow(T.a.Clamp(R),m.c),b=Math.pow(T.a.Clamp(b),m.c),C=Math.pow(T.a.Clamp(C),m.c));var B=4096;R=T.a.Clamp(R,0,B),b=T.a.Clamp(b,0,B),C=T.a.Clamp(C,0,B);var A=new y.a(R,b,C);i.addLight(P,A,E),o+=E,_+=n}h+=s}var F=4*Math.PI,N=6,w=F*N/6,U=w/o;return i.scaleInPlace(U),i.convertIncidentRadianceToIrradiance(),i.convertIrradianceToLambertianRadiance(),M.b.FromHarmonics(i)},l.FileFaces=[new O("right",new v.e(1,0,0),new v.e(0,0,-1),new v.e(0,-1,0)),new O("left",new v.e(-1,0,0),new v.e(0,0,1),new v.e(0,-1,0)),new O("up",new v.e(0,1,0),new v.e(1,0,0),new v.e(0,0,1)),new O("down",new v.e(0,-1,0),new v.e(1,0,0),new v.e(0,0,-1)),new O("front",new v.e(0,0,1),new v.e(1,0,0),new v.e(0,-1,0)),new O("back",new v.e(0,0,-1),new v.e(-1,0,0),new v.e(0,-1,0))],l}()},522:function(z,x,d){"use strict";var v=d(434),T=d(456),M=d(440),m=d(467);m.a.prototype.createRenderTargetCubeTexture=function(y,O){var c=Object(v.a)({generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5},O);c.generateStencilBuffer=c.generateDepthBuffer&&c.generateStencilBuffer,(c.type===1&&!this._caps.textureFloatLinearFiltering||c.type===2&&!this._caps.textureHalfFloatLinearFiltering)&&(c.samplingMode=1);var l=this._gl,e=new T.a(this,T.b.RenderTarget);this._bindTextureDirectly(l.TEXTURE_CUBE_MAP,e,!0);var i=this._getSamplingParameters(c.samplingMode,c.generateMipMaps);c.type===1&&!this._caps.textureFloat&&(c.type=0,M.a.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MAG_FILTER,i.mag),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_MIN_FILTER,i.min),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_CUBE_MAP,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE);for(var o=0;o<6;o++)l.texImage2D(l.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,this._getRGBABufferInternalSizedFormat(c.type,c.format),y,y,0,this._getInternalFormat(c.format),this._getWebGLTextureType(c.type),null);var n=l.createFramebuffer();return this._bindUnboundFramebuffer(n),e._depthStencilBuffer=this._setupFramebufferDepthAttachments(c.generateStencilBuffer,c.generateDepthBuffer,y,y),c.generateMipMaps&&l.generateMipmap(l.TEXTURE_CUBE_MAP),this._bindTextureDirectly(l.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),e._framebuffer=n,e.width=y,e.height=y,e.isReady=!0,e.isCube=!0,e.samples=1,e.generateMipMaps=c.generateMipMaps,e.samplingMode=c.samplingMode,e.type=c.type,e.format=c.format,e._generateDepthBuffer=c.generateDepthBuffer,e._generateStencilBuffer=c.generateStencilBuffer,this._internalTexturesCache.push(e),e}},523:function(z,x,d){"use strict";var v=d(521),T=d(477);Object.defineProperty(T.a.prototype,"sphericalPolynomial",{get:function(){var M=this;if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=v.a.ConvertCubeMapTextureToSphericalPolynomial(this),this._texture._sphericalPolynomialPromise===null?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then(function(m){M._texture._sphericalPolynomial=m,M._texture._sphericalPolynomialComputed=!0})),null}return null},set:function(M){this._texture&&(this._texture._sphericalPolynomial=M)},enumerable:!0,configurable:!0})},527:function(z,x,d){"use strict";d.d(x,"a",function(){return m});var v=d(434),T=d(442),M=d(492),m=function(y){Object(v.d)(O,y);function O(c,l,e,i,o,n,s,t,r){n===void 0&&(n=!0),s===void 0&&(s=!1),t===void 0&&(t=3),r===void 0&&(r=0);var a=y.call(this,null,o,!n,s)||this;return a.format=i,a._engine&&(a._texture=a._engine.createRawTexture(c,l,e,i,n,s,t,null,r),a.wrapU=T.a.CLAMP_ADDRESSMODE,a.wrapV=T.a.CLAMP_ADDRESSMODE),a}return O.prototype.update=function(c){this._getEngine().updateRawTexture(this._texture,c,this._texture.format,this._texture.invertY,null,this._texture.type)},O.CreateLuminanceTexture=function(c,l,e,i,o,n,s){return o===void 0&&(o=!0),n===void 0&&(n=!1),s===void 0&&(s=3),new O(c,l,e,1,i,o,n,s)},O.CreateLuminanceAlphaTexture=function(c,l,e,i,o,n,s){return o===void 0&&(o=!0),n===void 0&&(n=!1),s===void 0&&(s=3),new O(c,l,e,2,i,o,n,s)},O.CreateAlphaTexture=function(c,l,e,i,o,n,s){return o===void 0&&(o=!0),n===void 0&&(n=!1),s===void 0&&(s=3),new O(c,l,e,0,i,o,n,s)},O.CreateRGBTexture=function(c,l,e,i,o,n,s,t){return o===void 0&&(o=!0),n===void 0&&(n=!1),s===void 0&&(s=3),t===void 0&&(t=0),new O(c,l,e,4,i,o,n,s,t)},O.CreateRGBATexture=function(c,l,e,i,o,n,s,t){return o===void 0&&(o=!0),n===void 0&&(n=!1),s===void 0&&(s=3),t===void 0&&(t=0),new O(c,l,e,5,i,o,n,s,t)},O.CreateRTexture=function(c,l,e,i,o,n,s,t){return o===void 0&&(o=!0),n===void 0&&(n=!1),s===void 0&&(s=T.a.TRILINEAR_SAMPLINGMODE),t===void 0&&(t=1),new O(c,l,e,6,i,o,n,s,t)},O}(T.a)},530:function(z,x,d){"use strict";d.d(x,"a",function(){return l});var v=d(483),T=d(572),M=d(438),m=d(449),y=d(436),O=d(589),c=d(542),l=function(){function e(i,o,n,s,t,r,a,u,h,f){n===void 0&&(n=0),s===void 0&&(s=100),t===void 0&&(t=!1),r===void 0&&(r=1),f===void 0&&(f=!1),this.target=o,this.fromFrame=n,this.toFrame=s,this.loopAnimation=t,this.onAnimationEnd=a,this.onAnimationLoop=h,this.isAdditive=f,this._localDelayOffset=null,this._pausedDelay=null,this._runtimeAnimations=new Array,this._paused=!1,this._speedRatio=1,this._weight=-1,this._syncRoot=null,this.disposeOnEnd=!0,this.animationStarted=!1,this.onAnimationEndObservable=new M.c,this.onAnimationLoopObservable=new M.c,this._scene=i,u&&this.appendAnimations(o,u),this._speedRatio=r,i._activeAnimatables.push(this)}return Object.defineProperty(e.prototype,"syncRoot",{get:function(){return this._syncRoot},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"masterFrame",{get:function(){return this._runtimeAnimations.length===0?0:this._runtimeAnimations[0].currentFrame},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"weight",{get:function(){return this._weight},set:function(i){if(i===-1){this._weight=-1;return}this._weight=Math.min(Math.max(i,0),1)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"speedRatio",{get:function(){return this._speedRatio},set:function(i){for(var o=0;o<this._runtimeAnimations.length;o++){var n=this._runtimeAnimations[o];n._prepareForSpeedRatioChange(i)}this._speedRatio=i},enumerable:!1,configurable:!0}),e.prototype.syncWith=function(i){if(this._syncRoot=i,i){var o=this._scene._activeAnimatables.indexOf(this);o>-1&&(this._scene._activeAnimatables.splice(o,1),this._scene._activeAnimatables.push(this))}return this},e.prototype.getAnimations=function(){return this._runtimeAnimations},e.prototype.appendAnimations=function(i,o){for(var n=this,s=0;s<o.length;s++){var t=o[s],r=new T.a(i,t,this._scene,this);r._onLoop=function(){n.onAnimationLoopObservable.notifyObservers(n),n.onAnimationLoop&&n.onAnimationLoop()},this._runtimeAnimations.push(r)}},e.prototype.getAnimationByTargetProperty=function(i){for(var o=this._runtimeAnimations,n=0;n<o.length;n++)if(o[n].animation.targetProperty===i)return o[n].animation;return null},e.prototype.getRuntimeAnimationByTargetProperty=function(i){for(var o=this._runtimeAnimations,n=0;n<o.length;n++)if(o[n].animation.targetProperty===i)return o[n];return null},e.prototype.reset=function(){for(var i=this._runtimeAnimations,o=0;o<i.length;o++)i[o].reset(!0);this._localDelayOffset=null,this._pausedDelay=null},e.prototype.enableBlending=function(i){for(var o=this._runtimeAnimations,n=0;n<o.length;n++)o[n].animation.enableBlending=!0,o[n].animation.blendingSpeed=i},e.prototype.disableBlending=function(){for(var i=this._runtimeAnimations,o=0;o<i.length;o++)i[o].animation.enableBlending=!1},e.prototype.goToFrame=function(i){var o=this._runtimeAnimations;if(o[0]){var n=o[0].animation.framePerSecond,s=o[0].currentFrame,t=this.speedRatio===0?0:(i-s)/n*1e3/this.speedRatio;this._localDelayOffset===null&&(this._localDelayOffset=0),this._localDelayOffset-=t}for(var r=0;r<o.length;r++)o[r].goToFrame(i)},e.prototype.pause=function(){this._paused||(this._paused=!0)},e.prototype.restart=function(){this._paused=!1},e.prototype._raiseOnAnimationEnd=function(){this.onAnimationEnd&&this.onAnimationEnd(),this.onAnimationEndObservable.notifyObservers(this)},e.prototype.stop=function(i,o){if(i||o){var n=this._scene._activeAnimatables.indexOf(this);if(n>-1){for(var s=this._runtimeAnimations,t=s.length-1;t>=0;t--){var r=s[t];i&&r.animation.name!=i||o&&!o(r.target)||(r.dispose(),s.splice(t,1))}s.length==0&&(this._scene._activeAnimatables.splice(n,1),this._raiseOnAnimationEnd())}}else{var t=this._scene._activeAnimatables.indexOf(this);if(t>-1){this._scene._activeAnimatables.splice(t,1);for(var s=this._runtimeAnimations,t=0;t<s.length;t++)s[t].dispose();this._raiseOnAnimationEnd()}}},e.prototype.waitAsync=function(){var i=this;return new Promise(function(o,n){i.onAnimationEndObservable.add(function(){o(i)},void 0,void 0,i,!0)})},e.prototype._animate=function(i){if(this._paused)return this.animationStarted=!1,this._pausedDelay===null&&(this._pausedDelay=i),!0;if(this._localDelayOffset===null?(this._localDelayOffset=i,this._pausedDelay=null):this._pausedDelay!==null&&(this._localDelayOffset+=i-this._pausedDelay,this._pausedDelay=null),this._weight===0)return!0;var o=!1,n=this._runtimeAnimations,s;for(s=0;s<n.length;s++){var t=n[s],r=t.animate(i-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this._speedRatio,this._weight);o=o||r}if(this.animationStarted=o,!o){if(this.disposeOnEnd)for(s=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(s,1),s=0;s<n.length;s++)n[s].dispose();this._raiseOnAnimationEnd(),this.disposeOnEnd&&(this.onAnimationEnd=null,this.onAnimationLoop=null,this.onAnimationLoopObservable.clear(),this.onAnimationEndObservable.clear())}return o},e}();m.a.prototype._animate=function(){if(!!this.animationsEnabled){var e=O.a.Now;if(!this._animationTimeLast){if(this._pendingData.length>0)return;this._animationTimeLast=e}this.deltaTime=this.useConstantAnimationDeltaTime?16:(e-this._animationTimeLast)*this.animationTimeScale,this._animationTimeLast=e;var i=this._activeAnimatables;if(i.length!==0){this._animationTime+=this.deltaTime;for(var o=this._animationTime,n=0;n<i.length;n++){var s=i[n];!s._animate(o)&&s.disposeOnEnd&&n--}this._processLateAnimationBindings()}}},m.a.prototype.beginWeightedAnimation=function(e,i,o,n,s,t,r,a,u,h,f){n===void 0&&(n=1),t===void 0&&(t=1),f===void 0&&(f=!1);var p=this.beginAnimation(e,i,o,s,t,r,a,!1,u,h,f);return p.weight=n,p},m.a.prototype.beginAnimation=function(e,i,o,n,s,t,r,a,u,h,f){s===void 0&&(s=1),a===void 0&&(a=!0),f===void 0&&(f=!1),i>o&&s>0&&(s*=-1),a&&this.stopAnimation(e,void 0,u),r||(r=new l(this,e,i,o,n,s,t,void 0,h,f));var p=u?u(e):!0;if(e.animations&&p&&r.appendAnimations(e,e.animations),e.getAnimatables)for(var _=e.getAnimatables(),g=0;g<_.length;g++)this.beginAnimation(_[g],i,o,n,s,t,r,a,u,h);return r.reset(),r},m.a.prototype.beginHierarchyAnimation=function(e,i,o,n,s,t,r,a,u,h,f,p){t===void 0&&(t=1),u===void 0&&(u=!0),p===void 0&&(p=!1);var _=e.getDescendants(i),g=[];g.push(this.beginAnimation(e,o,n,s,t,r,a,u,h,void 0,p));for(var P=0,E=_;P<E.length;P++){var R=E[P];g.push(this.beginAnimation(R,o,n,s,t,r,a,u,h,void 0,p))}return g},m.a.prototype.beginDirectAnimation=function(e,i,o,n,s,t,r,a,u){u===void 0&&(u=!1),t===void 0&&(t=1),o>n&&t>0&&(t*=-1);var h=new l(this,e,o,n,s,t,r,i,a,u);return h},m.a.prototype.beginDirectHierarchyAnimation=function(e,i,o,n,s,t,r,a,u,h){h===void 0&&(h=!1);var f=e.getDescendants(i),p=[];p.push(this.beginDirectAnimation(e,o,n,s,t,r,a,u,h));for(var _=0,g=f;_<g.length;_++){var P=g[_];p.push(this.beginDirectAnimation(P,o,n,s,t,r,a,u,h))}return p},m.a.prototype.getAnimatableByTarget=function(e){for(var i=0;i<this._activeAnimatables.length;i++)if(this._activeAnimatables[i].target===e)return this._activeAnimatables[i];return null},m.a.prototype.getAllAnimatablesByTarget=function(e){for(var i=[],o=0;o<this._activeAnimatables.length;o++)this._activeAnimatables[o].target===e&&i.push(this._activeAnimatables[o]);return i},m.a.prototype.stopAnimation=function(e,i,o){for(var n=this.getAllAnimatablesByTarget(e),s=0,t=n;s<t.length;s++){var r=t[s];r.stop(i,o)}},m.a.prototype.stopAllAnimations=function(){if(this._activeAnimatables){for(var e=0;e<this._activeAnimatables.length;e++)this._activeAnimatables[e].stop();this._activeAnimatables=[]}for(var i=0,o=this.animationGroups;i<o.length;i++){var n=o[i];n.stop()}},m.a.prototype._registerTargetForLateAnimationBinding=function(e,i){var o=e.target;this._registeredForLateAnimationBindings.pushNoDuplicate(o),o._lateAnimationHolders||(o._lateAnimationHolders={}),o._lateAnimationHolders[e.targetPath]||(o._lateAnimationHolders[e.targetPath]={totalWeight:0,totalAdditiveWeight:0,animations:[],additiveAnimations:[],originalValue:i}),e.isAdditive?(o._lateAnimationHolders[e.targetPath].additiveAnimations.push(e),o._lateAnimationHolders[e.targetPath].totalAdditiveWeight+=e.weight):(o._lateAnimationHolders[e.targetPath].animations.push(e),o._lateAnimationHolders[e.targetPath].totalWeight+=e.weight)},m.a.prototype._processLateAnimationBindingsForMatrices=function(e){if(e.totalWeight===0&&e.totalAdditiveWeight===0)return e.originalValue;var i=1,o=y.c.Vector3[0],n=y.c.Vector3[1],s=y.c.Quaternion[0],t=0,r=e.animations[0],a=e.originalValue,u=1,h=!1;if(e.totalWeight<1)u=1-e.totalWeight,a.decompose(n,s,o);else{if(t=1,i=e.totalWeight,u=r.weight/i,u==1)if(e.totalAdditiveWeight)h=!0;else return r.currentValue;r.currentValue.decompose(n,s,o)}if(!h){n.scaleInPlace(u),o.scaleInPlace(u),s.scaleInPlace(u);for(var f=t;f<e.animations.length;f++){var p=e.animations[f];if(p.weight!==0){var u=p.weight/i,_=y.c.Vector3[2],g=y.c.Vector3[3],P=y.c.Quaternion[1];p.currentValue.decompose(g,P,_),g.scaleAndAddToRef(u,n),P.scaleAndAddToRef(u,s),_.scaleAndAddToRef(u,o)}}}for(var E=0;E<e.additiveAnimations.length;E++){var p=e.additiveAnimations[E];if(p.weight!==0){var _=y.c.Vector3[2],g=y.c.Vector3[3],P=y.c.Quaternion[1];p.currentValue.decompose(g,P,_),g.multiplyToRef(n,g),y.e.LerpToRef(n,g,p.weight,n),s.multiplyToRef(P,P),y.b.SlerpToRef(s,P,p.weight,s),_.scaleAndAddToRef(p.weight,o)}}var R=r?r._animationState.workValue:y.c.Matrix[0].clone();return y.a.ComposeToRef(n,s,o,R),R},m.a.prototype._processLateAnimationBindingsForQuaternions=function(e,i){if(e.totalWeight===0&&e.totalAdditiveWeight===0)return i;var o=e.animations[0],n=e.originalValue,s=i;if(e.totalWeight===0&&e.totalAdditiveWeight>0)s.copyFrom(n);else if(e.animations.length===1){if(y.b.SlerpToRef(n,o.currentValue,Math.min(1,e.totalWeight),s),e.totalAdditiveWeight===0)return s}else if(e.animations.length>1){var t=1,r=void 0,a=void 0;if(e.totalWeight<1){var u=1-e.totalWeight;r=[],a=[],r.push(n),a.push(u)}else{if(e.animations.length===2&&(y.b.SlerpToRef(e.animations[0].currentValue,e.animations[1].currentValue,e.animations[1].weight/e.totalWeight,i),e.totalAdditiveWeight===0))return i;r=[],a=[],t=e.totalWeight}for(var h=0;h<e.animations.length;h++){var f=e.animations[h];r.push(f.currentValue),a.push(f.weight/t)}for(var p=0,_=0;_<r.length;){if(!_){y.b.SlerpToRef(r[_],r[_+1],a[_+1]/(a[_]+a[_+1]),i),s=i,p=a[_]+a[_+1],_+=2;continue}p+=a[_],y.b.SlerpToRef(s,r[_],a[_]/p,s),_++}}for(var g=0;g<e.additiveAnimations.length;g++){var f=e.additiveAnimations[g];f.weight!==0&&(s.multiplyToRef(f.currentValue,y.c.Quaternion[0]),y.b.SlerpToRef(s,y.c.Quaternion[0],f.weight,s))}return s},m.a.prototype._processLateAnimationBindings=function(){if(!!this._registeredForLateAnimationBindings.length){for(var e=0;e<this._registeredForLateAnimationBindings.length;e++){var i=this._registeredForLateAnimationBindings.data[e];for(var o in i._lateAnimationHolders){var n=i._lateAnimationHolders[o],s=n.animations[0],t=n.originalValue,r=v.a.AllowMatrixDecomposeForInterpolation&&t.m,a=i[o];if(r)a=this._processLateAnimationBindingsForMatrices(n);else{var u=t.w!==void 0;if(u)a=this._processLateAnimationBindingsForQuaternions(n,a||y.b.Identity());else{var h=0,f=1;if(n.totalWeight<1)s&&t.scale?a=t.scale(1-n.totalWeight):s?a=t*(1-n.totalWeight):t.clone?a=t.clone():a=t;else if(s){f=n.totalWeight;var p=s.weight/f;p!==1?s.currentValue.scale?a=s.currentValue.scale(p):a=s.currentValue*p:a=s.currentValue,h=1}for(var _=h;_<n.animations.length;_++){var g=n.animations[_],P=g.weight/f;if(P)g.currentValue.scaleAndAddToRef?g.currentValue.scaleAndAddToRef(P,a):a+=g.currentValue*P;else continue}for(var E=0;E<n.additiveAnimations.length;E++){var g=n.additiveAnimations[E],P=g.weight;if(P)g.currentValue.scaleAndAddToRef?g.currentValue.scaleAndAddToRef(P,a):a+=g.currentValue*P;else continue}}}i[o]=a}i._lateAnimationHolders={}}this._registeredForLateAnimationBindings.reset()}},c.a.prototype.copyAnimationRange=function(e,i,o,n,s){n===void 0&&(n=!1),s===void 0&&(s=null),this.animations.length===0&&(this.animations.push(new v.a(this.name,"_matrix",e.animations[0].framePerSecond,v.a.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));var t=e.animations[0].getRange(i);if(!t)return!1;for(var r=t.from,a=t.to,u=e.animations[0].getKeys(),h=e.length,f=e.getParent(),p=this.getParent(),_=n&&f&&h&&this.length&&h!==this.length,g=_&&p&&f?p.length/f.length:1,P=n&&!p&&s&&(s.x!==1||s.y!==1||s.z!==1),E=this.animations[0].getKeys(),R,b,C,B=0,A=u.length;B<A;B++)R=u[B],R.frame>=r&&R.frame<=a&&(n?(C=R.value.clone(),_?(b=C.getTranslation(),C.setTranslation(b.scaleInPlace(g))):P&&s?(b=C.getTranslation(),C.setTranslation(b.multiplyInPlace(s))):C=R.value):C=R.value,E.push({frame:R.frame+o,value:C}));return this.animations[0].createRange(i,r+o,a+o),!0}},534:function(z,x,d){"use strict";var v=d(435),T="postprocessVertexShader",M=`
attribute vec2 position;
uniform vec2 scale;

varying vec2 vUV;
const vec2 madd=vec2(0.5,0.5);
void main(void) {
vUV=(position*madd+madd)*scale;
gl_Position=vec4(position,0.0,1.0);
}`;v.a.ShadersStore[T]=M;var m={name:T,shader:M}},540:function(z,x,d){"use strict";d.d(x,"b",function(){return y}),d.d(x,"a",function(){return O});var v=d(483),T=d(438),M=d(448),m=d(530),y=function(){function c(){}return c.prototype.getClassName=function(){return"TargetedAnimation"},c.prototype.serialize=function(){var l={};return l.animation=this.animation.serialize(),l.targetId=this.target.id,l},c}(),O=function(){function c(l,e){e===void 0&&(e=null),this.name=l,this._targetedAnimations=new Array,this._animatables=new Array,this._from=Number.MAX_VALUE,this._to=-Number.MAX_VALUE,this._speedRatio=1,this._loopAnimation=!1,this._isAdditive=!1,this.onAnimationEndObservable=new T.c,this.onAnimationLoopObservable=new T.c,this.onAnimationGroupLoopObservable=new T.c,this.onAnimationGroupEndObservable=new T.c,this.onAnimationGroupPauseObservable=new T.c,this.onAnimationGroupPlayObservable=new T.c,this._scene=e||M.a.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._scene.addAnimationGroup(this)}return Object.defineProperty(c.prototype,"from",{get:function(){return this._from},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"to",{get:function(){return this._to},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isStarted",{get:function(){return this._isStarted},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isPlaying",{get:function(){return this._isStarted&&!this._isPaused},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"speedRatio",{get:function(){return this._speedRatio},set:function(l){if(this._speedRatio!==l){this._speedRatio=l;for(var e=0;e<this._animatables.length;e++){var i=this._animatables[e];i.speedRatio=this._speedRatio}}},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"loopAnimation",{get:function(){return this._loopAnimation},set:function(l){if(this._loopAnimation!==l){this._loopAnimation=l;for(var e=0;e<this._animatables.length;e++){var i=this._animatables[e];i.loopAnimation=this._loopAnimation}}},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isAdditive",{get:function(){return this._isAdditive},set:function(l){if(this._isAdditive!==l){this._isAdditive=l;for(var e=0;e<this._animatables.length;e++){var i=this._animatables[e];i.isAdditive=this._isAdditive}}},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"targetedAnimations",{get:function(){return this._targetedAnimations},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"animatables",{get:function(){return this._animatables},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"children",{get:function(){return this._targetedAnimations},enumerable:!1,configurable:!0}),c.prototype.addTargetedAnimation=function(l,e){var i=new y;i.animation=l,i.target=e;var o=l.getKeys();return this._from>o[0].frame&&(this._from=o[0].frame),this._to<o[o.length-1].frame&&(this._to=o[o.length-1].frame),this._targetedAnimations.push(i),i},c.prototype.normalize=function(l,e){l===void 0&&(l=null),e===void 0&&(e=null),l==null&&(l=this._from),e==null&&(e=this._to);for(var i=0;i<this._targetedAnimations.length;i++){var o=this._targetedAnimations[i],n=o.animation.getKeys(),s=n[0],t=n[n.length-1];if(s.frame>l){var r={frame:l,value:s.value,inTangent:s.inTangent,outTangent:s.outTangent,interpolation:s.interpolation};n.splice(0,0,r)}if(t.frame<e){var r={frame:e,value:t.value,inTangent:t.inTangent,outTangent:t.outTangent,interpolation:t.interpolation};n.push(r)}}return this._from=l,this._to=e,this},c.prototype._processLoop=function(l,e,i){var o=this;l.onAnimationLoop=function(){o.onAnimationLoopObservable.notifyObservers(e),!o._animationLoopFlags[i]&&(o._animationLoopFlags[i]=!0,o._animationLoopCount++,o._animationLoopCount===o._targetedAnimations.length&&(o.onAnimationGroupLoopObservable.notifyObservers(o),o._animationLoopCount=0,o._animationLoopFlags=[]))}},c.prototype.start=function(l,e,i,o,n){var s=this;if(l===void 0&&(l=!1),e===void 0&&(e=1),this._isStarted||this._targetedAnimations.length===0)return this;this._loopAnimation=l,this._animationLoopCount=0,this._animationLoopFlags=[];for(var t=function(){var h=r._targetedAnimations[a],f=r._scene.beginDirectAnimation(h.target,[h.animation],i!==void 0?i:r._from,o!==void 0?o:r._to,l,e,void 0,void 0,n!==void 0?n:r._isAdditive);f.onAnimationEnd=function(){s.onAnimationEndObservable.notifyObservers(h),s._checkAnimationGroupEnded(f)},r._processLoop(f,h,a),r._animatables.push(f)},r=this,a=0;a<this._targetedAnimations.length;a++)t();if(this._speedRatio=e,i!==void 0&&o!==void 0)if(i<o&&this._speedRatio<0){var u=o;o=i,i=u}else i>o&&this._speedRatio>0&&(this._speedRatio=-e);return this._isStarted=!0,this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this},c.prototype.pause=function(){if(!this._isStarted)return this;this._isPaused=!0;for(var l=0;l<this._animatables.length;l++){var e=this._animatables[l];e.pause()}return this.onAnimationGroupPauseObservable.notifyObservers(this),this},c.prototype.play=function(l){return this.isStarted&&this._animatables.length===this._targetedAnimations.length?(l!==void 0&&(this.loopAnimation=l),this.restart()):(this.stop(),this.start(l,this._speedRatio)),this._isPaused=!1,this},c.prototype.reset=function(){if(!this._isStarted)return this.play(),this.goToFrame(0),this.stop(),this;for(var l=0;l<this._animatables.length;l++){var e=this._animatables[l];e.reset()}return this},c.prototype.restart=function(){if(!this._isStarted)return this;for(var l=0;l<this._animatables.length;l++){var e=this._animatables[l];e.restart()}return this.onAnimationGroupPlayObservable.notifyObservers(this),this},c.prototype.stop=function(){if(!this._isStarted)return this;for(var l=this._animatables.slice(),e=0;e<l.length;e++)l[e].stop();return this._isStarted=!1,this},c.prototype.setWeightForAllAnimatables=function(l){for(var e=0;e<this._animatables.length;e++){var i=this._animatables[e];i.weight=l}return this},c.prototype.syncAllAnimationsWith=function(l){for(var e=0;e<this._animatables.length;e++){var i=this._animatables[e];i.syncWith(l)}return this},c.prototype.goToFrame=function(l){if(!this._isStarted)return this;for(var e=0;e<this._animatables.length;e++){var i=this._animatables[e];i.goToFrame(l)}return this},c.prototype.dispose=function(){this._targetedAnimations=[],this._animatables=[];var l=this._scene.animationGroups.indexOf(this);l>-1&&this._scene.animationGroups.splice(l,1),this.onAnimationEndObservable.clear(),this.onAnimationGroupEndObservable.clear(),this.onAnimationGroupPauseObservable.clear(),this.onAnimationGroupPlayObservable.clear(),this.onAnimationLoopObservable.clear(),this.onAnimationGroupLoopObservable.clear()},c.prototype._checkAnimationGroupEnded=function(l){var e=this._animatables.indexOf(l);e>-1&&this._animatables.splice(e,1),this._animatables.length===0&&(this._isStarted=!1,this.onAnimationGroupEndObservable.notifyObservers(this))},c.prototype.clone=function(l,e){for(var i=new c(l||this.name,this._scene),o=0,n=this._targetedAnimations;o<n.length;o++){var s=n[o];i.addTargetedAnimation(s.animation.clone(),e?e(s.target):s.target)}return i},c.prototype.serialize=function(){var l={};l.name=this.name,l.from=this.from,l.to=this.to,l.targetedAnimations=[];for(var e=0;e<this.targetedAnimations.length;e++){var i=this.targetedAnimations[e];l.targetedAnimations[e]=i.serialize()}return l},c.Parse=function(l,e){for(var i=new c(l.name,e),o=0;o<l.targetedAnimations.length;o++){var n=l.targetedAnimations[o],s=v.a.Parse(n.animation),t=n.targetId;if(n.animation.property==="influence"){var r=e.getMorphTargetById(t);r&&i.addTargetedAnimation(s,r)}else{var a=e.getNodeByID(t);a!=null&&i.addTargetedAnimation(s,a)}}return l.from!==null&&l.to!==null&&i.normalize(l.from,l.to),i},c.MakeAnimationAdditive=function(l,e,i,o,n){e===void 0&&(e=0),o===void 0&&(o=!1);var s=l;o&&(s=l.clone(n||s.name));for(var t=s.targetedAnimations,r=0;r<t.length;r++){var a=t[r];v.a.MakeAnimationAdditive(a.animation,e,i)}return s.isAdditive=!0,s},c.prototype.getClassName=function(){return"AnimationGroup"},c.prototype.toString=function(l){var e="Name: "+this.name;return e+=", type: "+this.getClassName(),l&&(e+=", from: "+this._from,e+=", to: "+this._to,e+=", isStarted: "+this._isStarted,e+=", speedRatio: "+this._speedRatio,e+=", targetedAnimations length: "+this._targetedAnimations.length,e+=", animatables length: "+this._animatables),e},c}()},542:function(z,x,d){"use strict";d.d(x,"a",function(){return O});var v=d(434),T=d(436),M=d(588),m=d(453),y=d(465),O=function(c){Object(v.d)(l,c);function l(e,i,o,n,s,t,r){o===void 0&&(o=null),n===void 0&&(n=null),s===void 0&&(s=null),t===void 0&&(t=null),r===void 0&&(r=null);var a=c.call(this,e,i.getScene())||this;return a.name=e,a.children=new Array,a.animations=new Array,a._index=null,a._absoluteTransform=new T.a,a._invertedAbsoluteTransform=new T.a,a._scalingDeterminant=1,a._worldTransform=new T.a,a._needToDecompose=!0,a._needToCompose=!1,a._linkedTransformNode=null,a._waitingTransformNodeId=null,a._skeleton=i,a._localMatrix=n?n.clone():T.a.Identity(),a._restPose=s||a._localMatrix.clone(),a._bindPose=a._localMatrix.clone(),a._baseMatrix=t||a._localMatrix.clone(),a._index=r,i.bones.push(a),a.setParent(o,!1),(t||n)&&a._updateDifferenceMatrix(),a}return Object.defineProperty(l.prototype,"_matrix",{get:function(){return this._compose(),this._localMatrix},set:function(e){this._localMatrix.copyFrom(e),this._needToDecompose=!0},enumerable:!1,configurable:!0}),l.prototype.getClassName=function(){return"Bone"},l.prototype.getSkeleton=function(){return this._skeleton},l.prototype.getParent=function(){return this._parent},l.prototype.getChildren=function(){return this.children},l.prototype.getIndex=function(){return this._index===null?this.getSkeleton().bones.indexOf(this):this._index},l.prototype.setParent=function(e,i){if(i===void 0&&(i=!0),this._parent!==e){if(this._parent){var o=this._parent.children.indexOf(this);o!==-1&&this._parent.children.splice(o,1)}this._parent=e,this._parent&&this._parent.children.push(this),i&&this._updateDifferenceMatrix(),this.markAsDirty()}},l.prototype.getLocalMatrix=function(){return this._compose(),this._localMatrix},l.prototype.getBaseMatrix=function(){return this._baseMatrix},l.prototype.getRestPose=function(){return this._restPose},l.prototype.setRestPose=function(e){this._restPose.copyFrom(e)},l.prototype.getBindPose=function(){return this._bindPose},l.prototype.setBindPose=function(e){this._bindPose.copyFrom(e)},l.prototype.getWorldMatrix=function(){return this._worldTransform},l.prototype.returnToRest=function(){this._skeleton._numBonesWithLinkedTransformNode>0?this.updateMatrix(this._restPose,!1,!1):this.updateMatrix(this._restPose,!1,!0)},l.prototype.getInvertedAbsoluteTransform=function(){return this._invertedAbsoluteTransform},l.prototype.getAbsoluteTransform=function(){return this._absoluteTransform},l.prototype.linkTransformNode=function(e){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=e,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++},l.prototype.getTransformNode=function(){return this._linkedTransformNode},Object.defineProperty(l.prototype,"position",{get:function(){return this._decompose(),this._localPosition},set:function(e){this._decompose(),this._localPosition.copyFrom(e),this._markAsDirtyAndCompose()},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"rotation",{get:function(){return this.getRotation()},set:function(e){this.setRotation(e)},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"rotationQuaternion",{get:function(){return this._decompose(),this._localRotation},set:function(e){this.setRotationQuaternion(e)},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"scaling",{get:function(){return this.getScale()},set:function(e){this.setScale(e)},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"animationPropertiesOverride",{get:function(){return this._skeleton.animationPropertiesOverride},enumerable:!1,configurable:!0}),l.prototype._decompose=function(){!this._needToDecompose||(this._needToDecompose=!1,this._localScaling||(this._localScaling=T.e.Zero(),this._localRotation=T.b.Zero(),this._localPosition=T.e.Zero()),this._localMatrix.decompose(this._localScaling,this._localRotation,this._localPosition))},l.prototype._compose=function(){if(!!this._needToCompose){if(!this._localScaling){this._needToCompose=!1;return}this._needToCompose=!1,T.a.ComposeToRef(this._localScaling,this._localRotation,this._localPosition,this._localMatrix)}},l.prototype.updateMatrix=function(e,i,o){i===void 0&&(i=!0),o===void 0&&(o=!0),this._baseMatrix.copyFrom(e),i&&this._updateDifferenceMatrix(),o?(this._needToCompose=!1,this._localMatrix.copyFrom(e),this._markAsDirtyAndDecompose()):this.markAsDirty()},l.prototype._updateDifferenceMatrix=function(e,i){if(i===void 0&&(i=!0),e||(e=this._baseMatrix),this._parent?e.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform):this._absoluteTransform.copyFrom(e),this._absoluteTransform.invertToRef(this._invertedAbsoluteTransform),i)for(var o=0;o<this.children.length;o++)this.children[o]._updateDifferenceMatrix();this._scalingDeterminant=this._absoluteTransform.determinant()<0?-1:1},l.prototype.markAsDirty=function(){this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty()},l.prototype._markAsDirtyAndCompose=function(){this.markAsDirty(),this._needToCompose=!0},l.prototype._markAsDirtyAndDecompose=function(){this.markAsDirty(),this._needToDecompose=!0},l.prototype.translate=function(e,i,o){i===void 0&&(i=y.c.LOCAL);var n=this.getLocalMatrix();if(i==y.c.LOCAL)n.addAtIndex(12,e.x),n.addAtIndex(13,e.y),n.addAtIndex(14,e.z);else{var s=null;o&&(s=o.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var t=l._tmpMats[0],r=l._tmpVecs[0];this._parent?o&&s?(t.copyFrom(this._parent.getAbsoluteTransform()),t.multiplyToRef(s,t)):t.copyFrom(this._parent.getAbsoluteTransform()):T.a.IdentityToRef(t),t.setTranslationFromFloats(0,0,0),t.invert(),T.e.TransformCoordinatesToRef(e,t,r),n.addAtIndex(12,r.x),n.addAtIndex(13,r.y),n.addAtIndex(14,r.z)}this._markAsDirtyAndDecompose()},l.prototype.setPosition=function(e,i,o){i===void 0&&(i=y.c.LOCAL);var n=this.getLocalMatrix();if(i==y.c.LOCAL)n.setTranslationFromFloats(e.x,e.y,e.z);else{var s=null;o&&(s=o.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var t=l._tmpMats[0],r=l._tmpVecs[0];this._parent?(o&&s?(t.copyFrom(this._parent.getAbsoluteTransform()),t.multiplyToRef(s,t)):t.copyFrom(this._parent.getAbsoluteTransform()),t.invert()):T.a.IdentityToRef(t),T.e.TransformCoordinatesToRef(e,t,r),n.setTranslationFromFloats(r.x,r.y,r.z)}this._markAsDirtyAndDecompose()},l.prototype.setAbsolutePosition=function(e,i){this.setPosition(e,y.c.WORLD,i)},l.prototype.scale=function(e,i,o,n){n===void 0&&(n=!1);var s=this.getLocalMatrix(),t=l._tmpMats[0];T.a.ScalingToRef(e,i,o,t),t.multiplyToRef(s,s),t.invert();for(var r=0,a=this.children;r<a.length;r++){var u=a[r],h=u.getLocalMatrix();h.multiplyToRef(t,h),h.multiplyAtIndex(12,e),h.multiplyAtIndex(13,i),h.multiplyAtIndex(14,o),u._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),n)for(var f=0,p=this.children;f<p.length;f++){var u=p[f];u.scale(e,i,o,n)}},l.prototype.setScale=function(e){this._decompose(),this._localScaling.copyFrom(e),this._markAsDirtyAndCompose()},l.prototype.getScale=function(){return this._decompose(),this._localScaling},l.prototype.getScaleToRef=function(e){this._decompose(),e.copyFrom(this._localScaling)},l.prototype.setYawPitchRoll=function(e,i,o,n,s){if(n===void 0&&(n=y.c.LOCAL),n===y.c.LOCAL){var t=l._tmpQuat;T.b.RotationYawPitchRollToRef(e,i,o,t),this.setRotationQuaternion(t,n,s);return}var r=l._tmpMats[0];if(!!this._getNegativeRotationToRef(r,s)){var a=l._tmpMats[1];T.a.RotationYawPitchRollToRef(e,i,o,a),r.multiplyToRef(a,a),this._rotateWithMatrix(a,n,s)}},l.prototype.rotate=function(e,i,o,n){o===void 0&&(o=y.c.LOCAL);var s=l._tmpMats[0];s.setTranslationFromFloats(0,0,0),T.a.RotationAxisToRef(e,i,s),this._rotateWithMatrix(s,o,n)},l.prototype.setAxisAngle=function(e,i,o,n){if(o===void 0&&(o=y.c.LOCAL),o===y.c.LOCAL){var s=l._tmpQuat;T.b.RotationAxisToRef(e,i,s),this.setRotationQuaternion(s,o,n);return}var t=l._tmpMats[0];if(!!this._getNegativeRotationToRef(t,n)){var r=l._tmpMats[1];T.a.RotationAxisToRef(e,i,r),t.multiplyToRef(r,r),this._rotateWithMatrix(r,o,n)}},l.prototype.setRotation=function(e,i,o){i===void 0&&(i=y.c.LOCAL),this.setYawPitchRoll(e.y,e.x,e.z,i,o)},l.prototype.setRotationQuaternion=function(e,i,o){if(i===void 0&&(i=y.c.LOCAL),i===y.c.LOCAL){this._decompose(),this._localRotation.copyFrom(e),this._markAsDirtyAndCompose();return}var n=l._tmpMats[0];if(!!this._getNegativeRotationToRef(n,o)){var s=l._tmpMats[1];T.a.FromQuaternionToRef(e,s),n.multiplyToRef(s,s),this._rotateWithMatrix(s,i,o)}},l.prototype.setRotationMatrix=function(e,i,o){if(i===void 0&&(i=y.c.LOCAL),i===y.c.LOCAL){var n=l._tmpQuat;T.b.FromRotationMatrixToRef(e,n),this.setRotationQuaternion(n,i,o);return}var s=l._tmpMats[0];if(!!this._getNegativeRotationToRef(s,o)){var t=l._tmpMats[1];t.copyFrom(e),s.multiplyToRef(e,t),this._rotateWithMatrix(t,i,o)}},l.prototype._rotateWithMatrix=function(e,i,o){i===void 0&&(i=y.c.LOCAL);var n=this.getLocalMatrix(),s=n.m[12],t=n.m[13],r=n.m[14],a=this.getParent(),u=l._tmpMats[3],h=l._tmpMats[4];a&&i==y.c.WORLD?(o?(u.copyFrom(o.getWorldMatrix()),a.getAbsoluteTransform().multiplyToRef(u,u)):u.copyFrom(a.getAbsoluteTransform()),h.copyFrom(u),h.invert(),n.multiplyToRef(u,n),n.multiplyToRef(e,n),n.multiplyToRef(h,n)):i==y.c.WORLD&&o?(u.copyFrom(o.getWorldMatrix()),h.copyFrom(u),h.invert(),n.multiplyToRef(u,n),n.multiplyToRef(e,n),n.multiplyToRef(h,n)):n.multiplyToRef(e,n),n.setTranslationFromFloats(s,t,r),this.computeAbsoluteTransforms(),this._markAsDirtyAndDecompose()},l.prototype._getNegativeRotationToRef=function(e,i){var o=l._tmpMats[2];return e.copyFrom(this.getAbsoluteTransform()),i&&(e.multiplyToRef(i.getWorldMatrix(),e),T.a.ScalingToRef(i.scaling.x,i.scaling.y,i.scaling.z,o)),e.invert(),isNaN(e.m[0])?!1:(o.multiplyAtIndex(0,this._scalingDeterminant),e.multiplyToRef(o,e),!0)},l.prototype.getPosition=function(e,i){e===void 0&&(e=y.c.LOCAL),i===void 0&&(i=null);var o=T.e.Zero();return this.getPositionToRef(e,i,o),o},l.prototype.getPositionToRef=function(e,i,o){if(e===void 0&&(e=y.c.LOCAL),e==y.c.LOCAL){var n=this.getLocalMatrix();o.x=n.m[12],o.y=n.m[13],o.z=n.m[14]}else{var s=null;i&&(s=i.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var t=l._tmpMats[0];i&&s?(t.copyFrom(this.getAbsoluteTransform()),t.multiplyToRef(s,t)):t=this.getAbsoluteTransform(),o.x=t.m[12],o.y=t.m[13],o.z=t.m[14]}},l.prototype.getAbsolutePosition=function(e){e===void 0&&(e=null);var i=T.e.Zero();return this.getPositionToRef(y.c.WORLD,e,i),i},l.prototype.getAbsolutePositionToRef=function(e,i){this.getPositionToRef(y.c.WORLD,e,i)},l.prototype.computeAbsoluteTransforms=function(){if(this._compose(),this._parent)this._localMatrix.multiplyToRef(this._parent._absoluteTransform,this._absoluteTransform);else{this._absoluteTransform.copyFrom(this._localMatrix);var e=this._skeleton.getPoseMatrix();e&&this._absoluteTransform.multiplyToRef(e,this._absoluteTransform)}for(var i=this.children,o=i.length,n=0;n<o;n++)i[n].computeAbsoluteTransforms()},l.prototype.getDirection=function(e,i){i===void 0&&(i=null);var o=T.e.Zero();return this.getDirectionToRef(e,i,o),o},l.prototype.getDirectionToRef=function(e,i,o){i===void 0&&(i=null);var n=null;i&&(n=i.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var s=l._tmpMats[0];s.copyFrom(this.getAbsoluteTransform()),i&&n&&s.multiplyToRef(n,s),T.e.TransformNormalToRef(e,s,o),o.normalize()},l.prototype.getRotation=function(e,i){e===void 0&&(e=y.c.LOCAL),i===void 0&&(i=null);var o=T.e.Zero();return this.getRotationToRef(e,i,o),o},l.prototype.getRotationToRef=function(e,i,o){e===void 0&&(e=y.c.LOCAL),i===void 0&&(i=null);var n=l._tmpQuat;this.getRotationQuaternionToRef(e,i,n),n.toEulerAnglesToRef(o)},l.prototype.getRotationQuaternion=function(e,i){e===void 0&&(e=y.c.LOCAL),i===void 0&&(i=null);var o=T.b.Identity();return this.getRotationQuaternionToRef(e,i,o),o},l.prototype.getRotationQuaternionToRef=function(e,i,o){if(e===void 0&&(e=y.c.LOCAL),i===void 0&&(i=null),e==y.c.LOCAL)this._decompose(),o.copyFrom(this._localRotation);else{var n=l._tmpMats[0],s=this.getAbsoluteTransform();i?s.multiplyToRef(i.getWorldMatrix(),n):n.copyFrom(s),n.multiplyAtIndex(0,this._scalingDeterminant),n.multiplyAtIndex(1,this._scalingDeterminant),n.multiplyAtIndex(2,this._scalingDeterminant),n.decompose(void 0,o,void 0)}},l.prototype.getRotationMatrix=function(e,i){e===void 0&&(e=y.c.LOCAL);var o=T.a.Identity();return this.getRotationMatrixToRef(e,i,o),o},l.prototype.getRotationMatrixToRef=function(e,i,o){if(e===void 0&&(e=y.c.LOCAL),e==y.c.LOCAL)this.getLocalMatrix().getRotationMatrixToRef(o);else{var n=l._tmpMats[0],s=this.getAbsoluteTransform();i?s.multiplyToRef(i.getWorldMatrix(),n):n.copyFrom(s),n.multiplyAtIndex(0,this._scalingDeterminant),n.multiplyAtIndex(1,this._scalingDeterminant),n.multiplyAtIndex(2,this._scalingDeterminant),n.getRotationMatrixToRef(o)}},l.prototype.getAbsolutePositionFromLocal=function(e,i){i===void 0&&(i=null);var o=T.e.Zero();return this.getAbsolutePositionFromLocalToRef(e,i,o),o},l.prototype.getAbsolutePositionFromLocalToRef=function(e,i,o){i===void 0&&(i=null);var n=null;i&&(n=i.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var s=l._tmpMats[0];i&&n?(s.copyFrom(this.getAbsoluteTransform()),s.multiplyToRef(n,s)):s=this.getAbsoluteTransform(),T.e.TransformCoordinatesToRef(e,s,o)},l.prototype.getLocalPositionFromAbsolute=function(e,i){i===void 0&&(i=null);var o=T.e.Zero();return this.getLocalPositionFromAbsoluteToRef(e,i,o),o},l.prototype.getLocalPositionFromAbsoluteToRef=function(e,i,o){i===void 0&&(i=null);var n=null;i&&(n=i.getWorldMatrix()),this._skeleton.computeAbsoluteTransforms();var s=l._tmpMats[0];s.copyFrom(this.getAbsoluteTransform()),i&&n&&s.multiplyToRef(n,s),s.invert(),T.e.TransformCoordinatesToRef(e,s,o)},l.prototype.setCurrentPoseAsRest=function(){this.setRestPose(this.getLocalMatrix())},l._tmpVecs=M.a.BuildArray(2,T.e.Zero),l._tmpQuat=T.b.Identity(),l._tmpMats=M.a.BuildArray(5,T.a.Identity),l}(m.a)},544:function(z,x,d){"use strict";d.d(x,"a",function(){return M});var v=d(436),T=d(476),M=function(){function m(y,O){if(O===void 0&&(O=m.DefaultPluginFactory()),this._physicsPlugin=O,this._impostors=[],this._joints=[],this._subTimeStep=0,!this._physicsPlugin.isSupported())throw new Error("Physics Engine "+this._physicsPlugin.name+" cannot be found. Please make sure it is included.");y=y||new v.e(0,-9.807,0),this.setGravity(y),this.setTimeStep()}return m.DefaultPluginFactory=function(){throw T.a.WarnImport("CannonJSPlugin")},m.prototype.setGravity=function(y){this.gravity=y,this._physicsPlugin.setGravity(this.gravity)},m.prototype.setTimeStep=function(y){y===void 0&&(y=1/60),this._physicsPlugin.setTimeStep(y)},m.prototype.getTimeStep=function(){return this._physicsPlugin.getTimeStep()},m.prototype.setSubTimeStep=function(y){y===void 0&&(y=0),this._subTimeStep=y},m.prototype.getSubTimeStep=function(){return this._subTimeStep},m.prototype.dispose=function(){this._impostors.forEach(function(y){y.dispose()}),this._physicsPlugin.dispose()},m.prototype.getPhysicsPluginName=function(){return this._physicsPlugin.name},m.prototype.addImpostor=function(y){y.uniqueId=this._impostors.push(y),y.parent||this._physicsPlugin.generatePhysicsBody(y)},m.prototype.removeImpostor=function(y){var O=this._impostors.indexOf(y);if(O>-1){var c=this._impostors.splice(O,1);c.length&&this.getPhysicsPlugin().removePhysicsBody(y)}},m.prototype.addJoint=function(y,O,c){var l={mainImpostor:y,connectedImpostor:O,joint:c};c.physicsPlugin=this._physicsPlugin,this._joints.push(l),this._physicsPlugin.generateJoint(l)},m.prototype.removeJoint=function(y,O,c){var l=this._joints.filter(function(e){return e.connectedImpostor===O&&e.joint===c&&e.mainImpostor===y});l.length&&this._physicsPlugin.removeJoint(l[0])},m.prototype._step=function(y){var O=this;this._impostors.forEach(function(c){c.isBodyInitRequired()&&O._physicsPlugin.generatePhysicsBody(c)}),y>.1?y=.1:y<=0&&(y=1/60),this._physicsPlugin.executeStep(y,this._impostors)},m.prototype.getPhysicsPlugin=function(){return this._physicsPlugin},m.prototype.getImpostors=function(){return this._impostors},m.prototype.getImpostorForPhysicsObject=function(y){for(var O=0;O<this._impostors.length;++O)if(this._impostors[O].object===y)return this._impostors[O];return null},m.prototype.getImpostorWithPhysicsBody=function(y){for(var O=0;O<this._impostors.length;++O)if(this._impostors[O].physicsBody===y)return this._impostors[O];return null},m.prototype.raycast=function(y,O){return this._physicsPlugin.raycast(y,O)},m.Epsilon=.001,m}()},549:function(z,x,d){"use strict";d.d(x,"a",function(){return T});const v=()=>!!document.createElement("canvas").getContext("webgl2"),T=()=>v()?"webgl2":"webgl"},560:function(z,x,d){"use strict";d.d(x,"a",function(){return i});var v=d(542),T=d(438),M=d(436),m=d(527),y=d(483),O=d(672),c=d(448),l=d(440),e=d(474),i=function(){function o(n,s,t){this.name=n,this.id=s,this.bones=new Array,this.needInitialSkinMatrix=!1,this.overrideMesh=null,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=M.a.Identity(),this._ranges={},this._lastAbsoluteTransformsUpdateId=-1,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._waitingOverrideMeshId=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new T.c,this.bones=[],this._scene=t||c.a.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;var r=this._scene.getEngine().getCaps();this._canUseTextureForBones=r.textureFloat&&r.maxVertexTextureImageUnits>0}return Object.defineProperty(o.prototype,"useTextureToStoreBoneMatrices",{get:function(){return this._useTextureToStoreBoneMatrices},set:function(n){this._useTextureToStoreBoneMatrices=n,this._markAsDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(n){this._animationPropertiesOverride=n},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"isUsingTextureForMatrices",{get:function(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),o.prototype.getClassName=function(){return"Skeleton"},o.prototype.getChildren=function(){return this.bones.filter(function(n){return!n.getParent()})},o.prototype.getTransformMatrices=function(n){return this.needInitialSkinMatrix&&n._bonesTransformMatrices?n._bonesTransformMatrices:(this._transformMatrices||this.prepare(),this._transformMatrices)},o.prototype.getTransformMatrixTexture=function(n){return this.needInitialSkinMatrix&&n._transformMatrixTexture?n._transformMatrixTexture:this._transformMatrixTexture},o.prototype.getScene=function(){return this._scene},o.prototype.toString=function(n){var s="Name: "+this.name+", nBones: "+this.bones.length;if(s+=", nAnimationRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),n){s+=", Ranges: {";var t=!0;for(var r in this._ranges)t&&(s+=", ",t=!1),s+=r;s+="}"}return s},o.prototype.getBoneIndexByName=function(n){for(var s=0,t=this.bones.length;s<t;s++)if(this.bones[s].name===n)return s;return-1},o.prototype.createAnimationRange=function(n,s,t){if(!this._ranges[n]){this._ranges[n]=new O.a(n,s,t);for(var r=0,a=this.bones.length;r<a;r++)this.bones[r].animations[0]&&this.bones[r].animations[0].createRange(n,s,t)}},o.prototype.deleteAnimationRange=function(n,s){s===void 0&&(s=!0);for(var t=0,r=this.bones.length;t<r;t++)this.bones[t].animations[0]&&this.bones[t].animations[0].deleteRange(n,s);this._ranges[n]=null},o.prototype.getAnimationRange=function(n){return this._ranges[n]||null},o.prototype.getAnimationRanges=function(){var n=[],s;for(s in this._ranges)n.push(this._ranges[s]);return n},o.prototype.copyAnimationRange=function(n,s,t){if(t===void 0&&(t=!1),this._ranges[s]||!n.getAnimationRange(s))return!1;var r=!0,a=this._getHighestAnimationFrame()+1,u={},h=n.bones,f,p;for(p=0,f=h.length;p<f;p++)u[h[p].name]=h[p];this.bones.length!==h.length&&(l.a.Warn("copyAnimationRange: this rig has "+this.bones.length+" bones, while source as "+h.length),r=!1);var _=t&&this.dimensionsAtRest&&n.dimensionsAtRest?this.dimensionsAtRest.divide(n.dimensionsAtRest):null;for(p=0,f=this.bones.length;p<f;p++){var g=this.bones[p].name,P=u[g];P?r=r&&this.bones[p].copyAnimationRange(P,s,a,t,_):(l.a.Warn("copyAnimationRange: not same rig, missing source bone "+g),r=!1)}var E=n.getAnimationRange(s);return E&&(this._ranges[s]=new O.a(s,E.from+a,E.to+a)),r},o.prototype.returnToRest=function(){for(var n=M.c.Vector3[0],s=M.c.Quaternion[0],t=M.c.Vector3[1],r=0;r<this.bones.length;r++){var a=this.bones[r];a._index!==-1&&(a.returnToRest(),a._linkedTransformNode&&(a.getRestPose().decompose(n,s,t),a._linkedTransformNode.position=t.clone(),a._linkedTransformNode.rotationQuaternion=s.clone(),a._linkedTransformNode.scaling=n.clone()))}},o.prototype._getHighestAnimationFrame=function(){for(var n=0,s=0,t=this.bones.length;s<t;s++)if(this.bones[s].animations[0]){var r=this.bones[s].animations[0].getHighestFrame();n<r&&(n=r)}return n},o.prototype.beginAnimation=function(n,s,t,r){var a=this.getAnimationRange(n);return a?this._scene.beginAnimation(this,a.from,a.to,s,t,r):null},o.MakeAnimationAdditive=function(n,s,t){s===void 0&&(s=0);var r=n.getAnimationRange(t);if(!r)return null;for(var a=n._scene.getAllAnimatablesByTarget(n),u=null,h=0;h<a.length;h++){var f=a[h];if(f.fromFrame===(r==null?void 0:r.from)&&f.toFrame===(r==null?void 0:r.to)){u=f;break}}for(var p=n.getAnimatables(),h=0;h<p.length;h++){var _=p[h],g=_.animations;if(!!g)for(var P=0;P<g.length;P++)y.a.MakeAnimationAdditive(g[P],s,t)}return u&&(u.isAdditive=!0),n},o.prototype._markAsDirty=function(){this._isDirty=!0},o.prototype._registerMeshWithPoseMatrix=function(n){this._meshesWithPoseMatrix.push(n)},o.prototype._unregisterMeshWithPoseMatrix=function(n){var s=this._meshesWithPoseMatrix.indexOf(n);s>-1&&this._meshesWithPoseMatrix.splice(s,1)},o.prototype._computeTransformMatrices=function(n,s){this.onBeforeComputeObservable.notifyObservers(this);for(var t=0;t<this.bones.length;t++){var r=this.bones[t];r._childUpdateId++;var a=r.getParent();if(a?r.getLocalMatrix().multiplyToRef(a.getWorldMatrix(),r.getWorldMatrix()):s?r.getLocalMatrix().multiplyToRef(s,r.getWorldMatrix()):r.getWorldMatrix().copyFrom(r.getLocalMatrix()),r._index!==-1){var u=r._index===null?t:r._index;r.getInvertedAbsoluteTransform().multiplyToArray(r.getWorldMatrix(),n,u*16)}}this._identity.copyToArray(n,this.bones.length*16)},o.prototype.prepare=function(){if(this._numBonesWithLinkedTransformNode>0)for(var n=0,s=this.bones;n<s.length;n++){var t=s[n];t._linkedTransformNode&&(t._linkedTransformNode.computeWorldMatrix(),t._matrix=t._linkedTransformNode._localMatrix,t.markAsDirty())}if(!!this._isDirty){if(this.needInitialSkinMatrix)for(var r=0;r<this._meshesWithPoseMatrix.length;r++){var a=this._meshesWithPoseMatrix[r],u=a.getPoseMatrix();if((!a._bonesTransformMatrices||a._bonesTransformMatrices.length!==16*(this.bones.length+1))&&(a._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1))),this._synchronizedWithMesh!==a){this._synchronizedWithMesh=a;for(var h=0;h<this.bones.length;h++){var f=this.bones[h];if(!f.getParent()){var p=f.getBaseMatrix();p.multiplyToRef(u,M.c.Matrix[1]),f._updateDifferenceMatrix(M.c.Matrix[1])}}if(this.isUsingTextureForMatrices){var _=(this.bones.length+1)*4;(!a._transformMatrixTexture||a._transformMatrixTexture.getSize().width!==_)&&(a._transformMatrixTexture&&a._transformMatrixTexture.dispose(),a._transformMatrixTexture=m.a.CreateRGBATexture(a._bonesTransformMatrices,(this.bones.length+1)*4,1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(a._bonesTransformMatrices,u),this.isUsingTextureForMatrices&&a._transformMatrixTexture&&a._transformMatrixTexture.update(a._bonesTransformMatrices)}else(!this._transformMatrices||this._transformMatrices.length!==16*(this.bones.length+1))&&(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=m.a.CreateRGBATexture(this._transformMatrices,(this.bones.length+1)*4,1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices);this._isDirty=!1,this._scene._activeBones.addCount(this.bones.length,!1)}},o.prototype.getAnimatables=function(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(var n=0;n<this.bones.length;n++)this._animatables.push(this.bones[n])}return this._animatables},o.prototype.clone=function(n,s){var t=new o(n,s||n,this._scene);t.needInitialSkinMatrix=this.needInitialSkinMatrix,t.overrideMesh=this.overrideMesh;for(var r=0;r<this.bones.length;r++){var a=this.bones[r],u=null,h=a.getParent();if(h){var f=this.bones.indexOf(h);u=t.bones[f]}var p=new v.a(a.name,t,u,a.getBaseMatrix().clone(),a.getRestPose().clone());p._index=a._index,a._linkedTransformNode&&p.linkTransformNode(a._linkedTransformNode),e.a.DeepCopy(a.animations,p.animations)}if(this._ranges){t._ranges={};for(var _ in this._ranges){var g=this._ranges[_];g&&(t._ranges[_]=g.clone())}}return this._isDirty=!0,t},o.prototype.enableBlending=function(n){n===void 0&&(n=.01),this.bones.forEach(function(s){s.animations.forEach(function(t){t.enableBlending=!0,t.blendingSpeed=n})})},o.prototype.dispose=function(){this._meshesWithPoseMatrix=[],this.getScene().stopAnimation(this),this.getScene().removeSkeleton(this),this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)},o.prototype.serialize=function(){var n,s,t={};t.name=this.name,t.id=this.id,this.dimensionsAtRest&&(t.dimensionsAtRest=this.dimensionsAtRest.asArray()),t.bones=[],t.needInitialSkinMatrix=this.needInitialSkinMatrix,t.overrideMeshId=(n=this.overrideMesh)===null||n===void 0?void 0:n.id;for(var r=0;r<this.bones.length;r++){var a=this.bones[r],u=a.getParent(),h={parentBoneIndex:u?this.bones.indexOf(u):-1,index:a.getIndex(),name:a.name,id:a.id,matrix:a.getBaseMatrix().toArray(),rest:a.getRestPose().toArray(),linkedTransformNodeId:(s=a.getTransformNode())===null||s===void 0?void 0:s.id};t.bones.push(h),a.length&&(h.length=a.length),a.metadata&&(h.metadata=a.metadata),a.animations&&a.animations.length>0&&(h.animation=a.animations[0].serialize()),t.ranges=[];for(var f in this._ranges){var p=this._ranges[f];if(!!p){var _={};_.name=f,_.from=p.from,_.to=p.to,t.ranges.push(_)}}}return t},o.Parse=function(n,s){var t=new o(n.name,n.id,s);n.dimensionsAtRest&&(t.dimensionsAtRest=M.e.FromArray(n.dimensionsAtRest)),t.needInitialSkinMatrix=n.needInitialSkinMatrix,n.overrideMeshId&&(t._hasWaitingData=!0,t._waitingOverrideMeshId=n.overrideMeshId);var r;for(r=0;r<n.bones.length;r++){var a=n.bones[r],u=n.bones[r].index,h=null;a.parentBoneIndex>-1&&(h=t.bones[a.parentBoneIndex]);var f=a.rest?M.a.FromArray(a.rest):null,p=new v.a(a.name,t,h,M.a.FromArray(a.matrix),f,null,u);a.id!==void 0&&a.id!==null&&(p.id=a.id),a.length&&(p.length=a.length),a.metadata&&(p.metadata=a.metadata),a.animation&&p.animations.push(y.a.Parse(a.animation)),a.linkedTransformNodeId!==void 0&&a.linkedTransformNodeId!==null&&(t._hasWaitingData=!0,p._waitingTransformNodeId=a.linkedTransformNodeId)}if(n.ranges)for(r=0;r<n.ranges.length;r++){var _=n.ranges[r];t.createAnimationRange(_.name,_.from,_.to)}return t},o.prototype.computeAbsoluteTransforms=function(n){n===void 0&&(n=!1);var s=this._scene.getRenderId();(this._lastAbsoluteTransformsUpdateId!=s||n)&&(this.bones[0].computeAbsoluteTransforms(),this._lastAbsoluteTransformsUpdateId=s)},o.prototype.getPoseMatrix=function(){var n=null;return this._meshesWithPoseMatrix.length>0&&(n=this._meshesWithPoseMatrix[0].getPoseMatrix()),n},o.prototype.sortBones=function(){for(var n=new Array,s=new Array(this.bones.length),t=0;t<this.bones.length;t++)this._sortBones(t,n,s);this.bones=n},o.prototype._sortBones=function(n,s,t){if(!t[n]){t[n]=!0;var r=this.bones[n];r._index===void 0&&(r._index=n);var a=r.getParent();a&&this._sortBones(this.bones.indexOf(a),s,t),s.push(r)}},o.prototype.setCurrentPoseAsRest=function(){this.bones.forEach(function(n){n.setCurrentPoseAsRest()})},o}()},561:function(z,x,d){"use strict";d.d(x,"a",function(){return O});var v=d(490),T=d(440),M=d(448),m=d(608),y=d(631),O=function(){function c(l){if(l===void 0&&(l=null),this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new v.a(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this.optimizeInfluencers=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this._useTextureToStoreTargets=!0,l||(l=M.a.LastCreatedScene),this._scene=l,this._scene){this._scene.morphTargetManagers.push(this),this._uniqueId=this._scene.getUniqueId();var e=this._scene.getEngine().getCaps();this._canUseTextureForTargets=e.canUseGLVertexID&&e.textureFloat&&e.maxVertexTextureImageUnits>0}}return Object.defineProperty(c.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"vertexCount",{get:function(){return this._vertexCount},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"supportsNormals",{get:function(){return this._supportsNormals&&this.enableNormalMorphing},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"supportsTangents",{get:function(){return this._supportsTangents&&this.enableTangentMorphing},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"supportsUVs",{get:function(){return this._supportsUVs&&this.enableUVMorphing},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"numTargets",{get:function(){return this._targets.length},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"numInfluencers",{get:function(){return this._activeTargets.length},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"influences",{get:function(){return this._influences},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"useTextureToStoreTargets",{get:function(){return this._useTextureToStoreTargets},set:function(l){this._useTextureToStoreTargets=l},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"isUsingTextureForTargets",{get:function(){return this.useTextureToStoreTargets&&this._canUseTextureForTargets},enumerable:!1,configurable:!0}),c.prototype.getActiveTarget=function(l){return this._activeTargets.data[l]},c.prototype.getTarget=function(l){return this._targets[l]},c.prototype.addTarget=function(l){var e=this;this._targets.push(l),this._targetInfluenceChangedObservers.push(l.onInfluenceChanged.add(function(i){e._syncActiveTargets(i)})),this._targetDataLayoutChangedObservers.push(l._onDataLayoutChanged.add(function(){e._syncActiveTargets(!0)})),this._syncActiveTargets(!0)},c.prototype.removeTarget=function(l){var e=this._targets.indexOf(l);e>=0&&(this._targets.splice(e,1),l.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(e,1)[0]),l._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(e,1)[0]),this._syncActiveTargets(!0))},c.prototype._bind=function(l){l.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),l.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),l.setTexture("morphTargets",this._targetStoreTexture)},c.prototype.clone=function(){for(var l=new c(this._scene),e=0,i=this._targets;e<i.length;e++){var o=i[e];l.addTarget(o.clone())}return l.enableNormalMorphing=this.enableNormalMorphing,l.enableTangentMorphing=this.enableTangentMorphing,l.enableUVMorphing=this.enableUVMorphing,l},c.prototype.serialize=function(){var l={};l.id=this.uniqueId,l.targets=[];for(var e=0,i=this._targets;e<i.length;e++){var o=i[e];l.targets.push(o.serialize())}return l},c.prototype._syncActiveTargets=function(l){var e=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0,(!this._morphTargetTextureIndices||this._morphTargetTextureIndices.length!==this._targets.length)&&(this._morphTargetTextureIndices=new Float32Array(this._targets.length));for(var i=-1,o=0,n=this._targets;o<n.length;o++){var s=n[o];if(i++,!(s.influence===0&&this.optimizeInfluencers)){this._activeTargets.push(s),this._morphTargetTextureIndices[e]=i,this._tempInfluences[e++]=s.influence,this._supportsNormals=this._supportsNormals&&s.hasNormals,this._supportsTangents=this._supportsTangents&&s.hasTangents,this._supportsUVs=this._supportsUVs&&s.hasUVs;var t=s.getPositions();if(t){var r=t.length/3;if(this._vertexCount===0)this._vertexCount=r;else if(this._vertexCount!==r){T.a.Error("Incompatible target. Targets must all have the same vertices count.");return}}}}(!this._influences||this._influences.length!==e)&&(this._influences=new Float32Array(e));for(var a=0;a<e;a++)this._influences[a]=this._tempInfluences[a];l&&this.synchronize()},c.prototype.synchronize=function(){if(!!this._scene){if(this.isUsingTextureForTargets&&this._vertexCount){this._textureVertexStride=1,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride,this._textureHeight=1;var l=this._scene.getEngine().getCaps().maxTextureSize;this._textureWidth>l&&(this._textureHeight=Math.ceil(this._textureWidth/l),this._textureWidth=l);var e=!0;if(this._targetStoreTexture){var i=this._targetStoreTexture.getSize();i.width===this._textureWidth&&i.height===this._textureHeight&&this._targetStoreTexture.depth===this._targets.length&&(e=!1)}if(e){this._targetStoreTexture&&this._targetStoreTexture.dispose();for(var o=this._targets.length,n=new Float32Array(o*this._textureWidth*this._textureHeight*4),s=0,t=0;t<o;t++){var r=this._targets[t],a=r.getPositions(),u=r.getNormals(),h=r.getUVs(),f=r.getTangents();if(!a){t===0&&T.a.Error("Invalid morph target. Target must have positions.");return}s=t*this._textureWidth*this._textureHeight*4;for(var p=0;p<this._vertexCount;p++)n[s]=a[p*3],n[s+1]=a[p*3+1],n[s+2]=a[p*3+2],s+=4,u&&(n[s]=u[p*3],n[s+1]=u[p*3+1],n[s+2]=u[p*3+2],s+=4),h&&(n[s]=h[p*2],n[s+1]=h[p*2+1],s+=4),f&&(n[s]=f[p*3],n[s+1]=f[p*3+1],n[s+2]=f[p*3+2],s+=4)}this._targetStoreTexture=y.a.CreateRGBATexture(n,this._textureWidth,this._textureHeight,o,this._scene,!1,!1,1,1)}}for(var _=0,g=this._scene.meshes;_<g.length;_++){var P=g[_];P.morphTargetManager===this&&P._syncGeometryWithMorphTargetManager()}}},c.prototype.dispose=function(){this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null},c.Parse=function(l,e){var i=new c(e);i._uniqueId=l.id;for(var o=0,n=l.targets;o<n.length;o++){var s=n[o];i.addTarget(m.a.Parse(s))}return i},c}()},565:function(z,x,d){"use strict";var v=d(434),T=d(467),M=d(456),m=d(440),y=d(662),O=d(709);T.a.prototype._createDepthStencilCubeTexture=function(c,l){var e=new M.a(this,M.b.Unknown);if(e.isCube=!0,this.webGLVersion===1)return m.a.Error("Depth cube texture is not supported by WebGL 1."),e;var i=Object(v.a)({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},l),o=this._gl;this._bindTextureDirectly(o.TEXTURE_CUBE_MAP,e,!0),this._setupDepthStencilTexture(e,c,i.generateStencil,i.bilinearFiltering,i.comparisonFunction);for(var n=0;n<6;n++)i.generateStencil?o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,o.DEPTH24_STENCIL8,c,c,0,o.DEPTH_STENCIL,o.UNSIGNED_INT_24_8,null):o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,o.DEPTH_COMPONENT24,c,c,0,o.DEPTH_COMPONENT,o.UNSIGNED_INT,null);return this._bindTextureDirectly(o.TEXTURE_CUBE_MAP,null),e},T.a.prototype._partialLoadFile=function(c,l,e,i,o){o===void 0&&(o=null);var n=function(t){e[l]=t,e._internalCount++,e._internalCount===6&&i(e)},s=function(t,r){o&&t&&o(t.status+" "+t.statusText,r)};this._loadFile(c,n,void 0,void 0,!0,s)},T.a.prototype._cascadeLoadFiles=function(c,l,e,i){i===void 0&&(i=null);var o=[];o._internalCount=0;for(var n=0;n<6;n++)this._partialLoadFile(e[n],n,o,l,i)},T.a.prototype._cascadeLoadImgs=function(c,l,e,i,o,n){o===void 0&&(o=null);var s=[];s._internalCount=0;for(var t=0;t<6;t++)this._partialLoadImg(i[t],t,s,c,l,e,o,n)},T.a.prototype._partialLoadImg=function(c,l,e,i,o,n,s,t){s===void 0&&(s=null);var r=O.a.RandomId(),a=function(h){e[l]=h,e._internalCount++,i&&i._removePendingData(r),e._internalCount===6&&n&&n(o,e)},u=function(h,f){i&&i._removePendingData(r),s&&s(h,f)};y.a.LoadImage(c,a,u,i?i.offlineProvider:null,t),i&&i._addPendingData(r)},T.a.prototype._setCubeMapTextureParams=function(c,l){var e=this._gl;e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,l?e.LINEAR_MIPMAP_LINEAR:e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),c.samplingMode=l?3:2,this._bindTextureDirectly(e.TEXTURE_CUBE_MAP,null)},T.a.prototype.createCubeTextureBase=function(c,l,e,i,o,n,s,t,r,a,u,h,f,p){var _=this;o===void 0&&(o=null),n===void 0&&(n=null),t===void 0&&(t=null),r===void 0&&(r=!1),a===void 0&&(a=0),u===void 0&&(u=0),h===void 0&&(h=null),f===void 0&&(f=null),p===void 0&&(p=null);var g=h||new M.a(this,M.b.Cube);g.isCube=!0,g.url=c,g.generateMipMaps=!i,g._lodGenerationScale=a,g._lodGenerationOffset=u,this._doNotHandleContextLost||(g._extension=t,g._files=e);var P=c;this._transformTextureUrl&&!h&&(c=this._transformTextureUrl(c));for(var E=c.lastIndexOf("."),R=t||(E>-1?c.substring(E).toLowerCase():""),b=null,C=0,B=T.a._TextureLoaders;C<B.length;C++){var A=B[C];if(A.canLoad(R)){b=A;break}}var F=function(w,U){c===P?n&&w&&n(w.status+" "+w.statusText,U):(m.a.Warn("Failed to load "+c+", falling back to the "+P),_.createCubeTextureBase(P,l,e,!!i,o,n,s,t,r,a,u,g,f,p))};if(b){var N=function(w){f&&f(g,w),b.loadCubeData(w,g,r,o,n)};e&&e.length===6?b.supportCascades?this._cascadeLoadFiles(l,function(w){return N(w.map(function(U){return new Uint8Array(U)}))},e,n):n?n("Textures type does not support cascades."):m.a.Warn("Texture loader does not support cascades."):this._loadFile(c,function(w){return N(new Uint8Array(w))},void 0,void 0,!0,F)}else{if(!e)throw new Error("Cannot load cubemap because files were not defined");this._cascadeLoadImgs(l,g,function(w,U){p&&p(w,U)},e,n)}return this._internalTexturesCache.push(g),g},T.a.prototype.createCubeTexture=function(c,l,e,i,o,n,s,t,r,a,u,h){var f=this;o===void 0&&(o=null),n===void 0&&(n=null),t===void 0&&(t=null),r===void 0&&(r=!1),a===void 0&&(a=0),u===void 0&&(u=0),h===void 0&&(h=null);var p=this._gl;return this.createCubeTextureBase(c,l,e,!!i,o,n,s,t,r,a,u,h,function(_,g){return f._bindTextureDirectly(p.TEXTURE_CUBE_MAP,_,!0)},function(_,g){var P=f.needPOTTextures?T.a.GetExponentOfTwo(g[0].width,f._caps.maxCubemapTextureSize):g[0].width,E=P,R=[p.TEXTURE_CUBE_MAP_POSITIVE_X,p.TEXTURE_CUBE_MAP_POSITIVE_Y,p.TEXTURE_CUBE_MAP_POSITIVE_Z,p.TEXTURE_CUBE_MAP_NEGATIVE_X,p.TEXTURE_CUBE_MAP_NEGATIVE_Y,p.TEXTURE_CUBE_MAP_NEGATIVE_Z];f._bindTextureDirectly(p.TEXTURE_CUBE_MAP,_,!0),f._unpackFlipY(!1);for(var b=s?f._getInternalFormat(s):f._gl.RGBA,C=0;C<R.length;C++)if(g[C].width!==P||g[C].height!==E){if(f._prepareWorkingCanvas(),!f._workingCanvas||!f._workingContext){m.a.Warn("Cannot create canvas to resize texture.");return}f._workingCanvas.width=P,f._workingCanvas.height=E,f._workingContext.drawImage(g[C],0,0,g[C].width,g[C].height,0,0,P,E),p.texImage2D(R[C],0,b,b,p.UNSIGNED_BYTE,f._workingCanvas)}else p.texImage2D(R[C],0,b,b,p.UNSIGNED_BYTE,g[C]);i||p.generateMipmap(p.TEXTURE_CUBE_MAP),f._setCubeMapTextureParams(_,!i),_.width=P,_.height=E,_.isReady=!0,s&&(_.format=s),_.onLoadedObservable.notifyObservers(_),_.onLoadedObservable.clear(),o&&o()})}},567:function(z,x,d){"use strict";d.d(x,"a",function(){return s});var v=d(434),T=d(436),M=d(477),m=d(442),y=d(568),O=d(521),c=d(437),l=d(443),e=d(515),i=d(637),o=d(492),n=d(523),s=function(t){Object(v.d)(r,t);function r(a,u,h,f,p,_,g,P,E){f===void 0&&(f=!1),p===void 0&&(p=!0),_===void 0&&(_=!1),g===void 0&&(g=!1),P===void 0&&(P=null),E===void 0&&(E=null);var R,b=t.call(this,u)||this;return b._generateHarmonics=!0,b._onLoad=null,b._onError=null,b._isBlocking=!0,b._rotationY=0,b.boundingBoxPosition=T.e.Zero(),a&&(b._coordinatesMode=m.a.CUBIC_MODE,b.name=a,b.url=a,b.hasAlpha=!1,b.isCube=!0,b._textureMatrix=T.a.Identity(),b._prefilterOnLoad=g,b._onLoad=P,b._onError=E,b.gammaSpace=_,b._noMipmap=f,b._size=h,b._generateHarmonics=p,b._texture=b._getFromCache(a,b._noMipmap),b._texture?P&&(b._texture.isReady?l.b.SetImmediate(function(){return P()}):b._texture.onLoadedObservable.add(P)):((R=b.getScene())===null||R===void 0?void 0:R.useDelayedTextureLoading)?b.delayLoadState=4:b.loadTexture()),b}return Object.defineProperty(r.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(a){this._isBlocking=a},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"rotationY",{get:function(){return this._rotationY},set:function(a){this._rotationY=a,this.setReflectionTextureMatrix(T.a.RotationY(this._rotationY))},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"boundingBoxSize",{get:function(){return this._boundingBoxSize},set:function(a){if(!(this._boundingBoxSize&&this._boundingBoxSize.equals(a))){this._boundingBoxSize=a;var u=this.getScene();u&&u.markAllMaterialsAsDirty(1)}},enumerable:!1,configurable:!0}),r.prototype.getClassName=function(){return"HDRCubeTexture"},r.prototype.loadTexture=function(){var a=this,u=this._getEngine(),h=function(_){a.lodGenerationOffset=0,a.lodGenerationScale=.8;var g=y.a.GetCubeMapTextureData(_,a._size);if(a._generateHarmonics){var P=O.a.ConvertCubeMapToSphericalPolynomial(g);a.sphericalPolynomial=P}for(var E=[],R=null,b=0;b<6;b++){if(!u.getCaps().textureFloat){var C=new ArrayBuffer(a._size*a._size*3);R=new Uint8Array(C)}var B=g[r._facesMapping[b]];if(a.gammaSpace||R){for(var A=0;A<a._size*a._size;A++)if(a.gammaSpace&&(B[A*3+0]=Math.pow(B[A*3+0],e.b),B[A*3+1]=Math.pow(B[A*3+1],e.b),B[A*3+2]=Math.pow(B[A*3+2],e.b)),R){var F=Math.max(B[A*3+0]*255,0),N=Math.max(B[A*3+1]*255,0),w=Math.max(B[A*3+2]*255,0),U=Math.max(Math.max(F,N),w);if(U>255){var j=255/U;F*=j,N*=j,w*=j}R[A*3+0]=F,R[A*3+1]=N,R[A*3+2]=w}}R?E.push(R):E.push(B)}return E};if(u._features.allowTexturePrefiltering&&this._prefilterOnLoad){var f=this._onLoad,p=new i.a(u);this._onLoad=function(){p.prefilter(a,f)}}this._texture=u.createRawCubeTextureFromUrl(this.url,this.getScene(),this._size,4,u.getCaps().textureFloat?1:0,this._noMipmap,h,null,this._onLoad,this._onError)},r.prototype.clone=function(){var a=new r(this.url,this.getScene()||this._getEngine(),this._size,this._noMipmap,this._generateHarmonics,this.gammaSpace);return a.level=this.level,a.wrapU=this.wrapU,a.wrapV=this.wrapV,a.coordinatesIndex=this.coordinatesIndex,a.coordinatesMode=this.coordinatesMode,a},r.prototype.delayLoad=function(){this.delayLoadState===4&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap),this._texture||this.loadTexture())},r.prototype.getReflectionTextureMatrix=function(){return this._textureMatrix},r.prototype.setReflectionTextureMatrix=function(a){var u=this,h;this._textureMatrix=a,a.updateFlag!==this._textureMatrix.updateFlag&&a.isIdentity()!==this._textureMatrix.isIdentity()&&((h=this.getScene())===null||h===void 0||h.markAllMaterialsAsDirty(1,function(f){return f.getActiveTextures().indexOf(u)!==-1}))},r.Parse=function(a,u,h){var f=null;return a.name&&!a.isRenderTarget&&(f=new r(h+a.name,u,a.size,a.noMipmap,a.generateHarmonics,a.useInGammaSpace),f.name=a.name,f.hasAlpha=a.hasAlpha,f.level=a.level,f.coordinatesMode=a.coordinatesMode,f.isBlocking=a.isBlocking),f&&(a.boundingBoxPosition&&(f.boundingBoxPosition=T.e.FromArray(a.boundingBoxPosition)),a.boundingBoxSize&&(f.boundingBoxSize=T.e.FromArray(a.boundingBoxSize)),a.rotationY&&(f.rotationY=a.rotationY)),f},r.prototype.serialize=function(){if(!this.name)return null;var a={};return a.name=this.name,a.hasAlpha=this.hasAlpha,a.isCube=!0,a.level=this.level,a.size=this._size,a.coordinatesMode=this.coordinatesMode,a.useInGammaSpace=this.gammaSpace,a.generateHarmonics=this._generateHarmonics,a.customType="BABYLON.HDRCubeTexture",a.noMipmap=this._noMipmap,a.isBlocking=this._isBlocking,a.rotationY=this._rotationY,a},r._facesMapping=["right","left","up","down","front","back"],r}(M.a);c.a.RegisteredTypes["BABYLON.HDRCubeTexture"]=s},568:function(z,x,d){"use strict";d.d(x,"a",function(){return T});var v=d(569),T=function(){function M(){}return M.Ldexp=function(m,y){return y>1023?m*Math.pow(2,1023)*Math.pow(2,y-1023):y<-1074?m*Math.pow(2,-1074)*Math.pow(2,y+1074):m*Math.pow(2,y)},M.Rgbe2float=function(m,y,O,c,l,e){l>0?(l=this.Ldexp(1,l-(128+8)),m[e+0]=y*l,m[e+1]=O*l,m[e+2]=c*l):(m[e+0]=0,m[e+1]=0,m[e+2]=0)},M.readStringLine=function(m,y){for(var O="",c="",l=y;l<m.length-y&&(c=String.fromCharCode(m[l]),c!=`
`);l++)O+=c;return O},M.RGBE_ReadHeader=function(m){var y=0,O=0,c=this.readStringLine(m,0);if(c[0]!="#"||c[1]!="?")throw"Bad HDR Format.";var l=!1,e=!1,i=0;do i+=c.length+1,c=this.readStringLine(m,i),c=="FORMAT=32-bit_rle_rgbe"?e=!0:c.length==0&&(l=!0);while(!l);if(!e)throw"HDR Bad header format, unsupported FORMAT";i+=c.length+1,c=this.readStringLine(m,i);var o=/^\-Y (.*) \+X (.*)$/g,n=o.exec(c);if(!n||n.length<3)throw"HDR Bad header format, no size";if(O=parseInt(n[2]),y=parseInt(n[1]),O<8||O>32767)throw"HDR Bad header format, unsupported size";return i+=c.length+1,{height:y,width:O,dataPosition:i}},M.GetCubeMapTextureData=function(m,y){var O=new Uint8Array(m),c=this.RGBE_ReadHeader(O),l=this.RGBE_ReadPixels(O,c),e=v.a.ConvertPanoramaToCubemap(l,c.width,c.height,y);return e},M.RGBE_ReadPixels=function(m,y){return this.RGBE_ReadPixels_RLE(m,y)},M.RGBE_ReadPixels_RLE=function(m,y){for(var O=y.height,c=y.width,l,e,i,o,n,s=y.dataPosition,t=0,r=0,a=0,u=new ArrayBuffer(c*4),h=new Uint8Array(u),f=new ArrayBuffer(y.width*y.height*4*3),p=new Float32Array(f);O>0;){if(l=m[s++],e=m[s++],i=m[s++],o=m[s++],l!=2||e!=2||i&128||y.width<8||y.width>32767)return this.RGBE_ReadPixels_NOT_RLE(m,y);if((i<<8|o)!=c)throw"HDR Bad header format, wrong scan line width";for(t=0,a=0;a<4;a++)for(r=(a+1)*c;t<r;)if(l=m[s++],e=m[s++],l>128){if(n=l-128,n==0||n>r-t)throw"HDR Bad Format, bad scanline data (run)";for(;n-- >0;)h[t++]=e}else{if(n=l,n==0||n>r-t)throw"HDR Bad Format, bad scanline data (non-run)";if(h[t++]=e,--n>0)for(var _=0;_<n;_++)h[t++]=m[s++]}for(a=0;a<c;a++)l=h[a],e=h[a+c],i=h[a+2*c],o=h[a+3*c],this.Rgbe2float(p,l,e,i,o,(y.height-O)*c*3+a*3);O--}return p},M.RGBE_ReadPixels_NOT_RLE=function(m,y){for(var O=y.height,c=y.width,l,e,i,o,n,s=y.dataPosition,t=new ArrayBuffer(y.width*y.height*4*3),r=new Float32Array(t);O>0;){for(n=0;n<y.width;n++)l=m[s++],e=m[s++],i=m[s++],o=m[s++],this.Rgbe2float(r,l,e,i,o,(y.height-O)*c*3+n*3);O--}return r},M}()},569:function(z,x,d){"use strict";d.d(x,"a",function(){return T});var v=d(436),T=function(){function M(){}return M.ConvertPanoramaToCubemap=function(m,y,O,c){if(!m)throw"ConvertPanoramaToCubemap: input cannot be null";if(m.length!=y*O*3)throw"ConvertPanoramaToCubemap: input size is wrong";var l=this.CreateCubemapTexture(c,this.FACE_FRONT,m,y,O),e=this.CreateCubemapTexture(c,this.FACE_BACK,m,y,O),i=this.CreateCubemapTexture(c,this.FACE_LEFT,m,y,O),o=this.CreateCubemapTexture(c,this.FACE_RIGHT,m,y,O),n=this.CreateCubemapTexture(c,this.FACE_UP,m,y,O),s=this.CreateCubemapTexture(c,this.FACE_DOWN,m,y,O);return{front:l,back:e,left:i,right:o,up:n,down:s,size:c,type:1,format:4,gammaSpace:!1}},M.CreateCubemapTexture=function(m,y,O,c,l){for(var e=new ArrayBuffer(m*m*4*3),i=new Float32Array(e),o=y[1].subtract(y[0]).scale(1/m),n=y[3].subtract(y[2]).scale(1/m),s=1/m,t=0,r=0;r<m;r++){for(var a=y[0],u=y[2],h=0;h<m;h++){var f=u.subtract(a).scale(t).add(a);f.normalize();var p=this.CalcProjectionSpherical(f,O,c,l);i[r*m*3+h*3+0]=p.r,i[r*m*3+h*3+1]=p.g,i[r*m*3+h*3+2]=p.b,a=a.add(o),u=u.add(n)}t+=s}return i},M.CalcProjectionSpherical=function(m,y,O,c){for(var l=Math.atan2(m.z,m.x),e=Math.acos(m.y);l<-Math.PI;)l+=2*Math.PI;for(;l>Math.PI;)l-=2*Math.PI;var i=l/Math.PI,o=e/Math.PI;i=i*.5+.5;var n=Math.round(i*O);n<0?n=0:n>=O&&(n=O-1);var s=Math.round(o*c);s<0?s=0:s>=c&&(s=c-1);var t=c-s-1,r=y[t*O*3+n*3+0],a=y[t*O*3+n*3+1],u=y[t*O*3+n*3+2];return{r,g:a,b:u}},M.FACE_LEFT=[new v.e(-1,-1,-1),new v.e(1,-1,-1),new v.e(-1,1,-1),new v.e(1,1,-1)],M.FACE_RIGHT=[new v.e(1,-1,1),new v.e(-1,-1,1),new v.e(1,1,1),new v.e(-1,1,1)],M.FACE_FRONT=[new v.e(1,-1,-1),new v.e(1,-1,1),new v.e(1,1,-1),new v.e(1,1,1)],M.FACE_BACK=[new v.e(-1,-1,1),new v.e(-1,-1,-1),new v.e(-1,1,1),new v.e(-1,1,-1)],M.FACE_DOWN=[new v.e(1,1,-1),new v.e(1,1,1),new v.e(-1,1,-1),new v.e(-1,1,1)],M.FACE_UP=[new v.e(-1,-1,-1),new v.e(-1,-1,1),new v.e(1,-1,-1),new v.e(1,-1,1)],M}()},57:function(z,x,d){"use strict";d.r(x);var v=d(445),T=d(449),M=d(475),m=d(435),y=d(441),O=d(506),c=d(498),l=d(677),e=d(463),i=d(665),o=d(509),n=d(549),s=d(258),t=d(259),r=(h,f,p)=>new Promise((_,g)=>{var P=b=>{try{R(p.next(b))}catch(C){g(C)}},E=b=>{try{R(p.throw(b))}catch(C){g(C)}},R=b=>b.done?_(b.value):Promise.resolve(b.value).then(P,E);R((p=p.apply(h,f)).next())});const a={animate:!0,context:Object(n.a)()},u=h=>r(void 0,[h],function*({canvas:f,width:p,height:_}){const g=new v.a(f,!0,{preserveDrawingBuffer:!0,stencil:!0}),P=new T.a(g);P.clearColor=y.a.FromHexString("#182026"),m.a.ShadersStore.particlesVertexShader=s.default,m.a.ShadersStore.particlesFragmentShader=t.default;const E=new O.a("camera1",-Math.PI/3,Math.PI/2,100,new M.z(0,0,0),P);E.setTarget(M.z.Zero()),E.attachControl(f,!0);const R=new c.a("light",new M.z(0,1,0),P);R.intensity=.75;const{meshes:b}=yield e.a.ImportMeshAsync("","static/assets/models/","skull.babylon",P),C=b[0];E.target=C;const B=new i.b("pcs",0,P);B.addSurfacePoints(C,5e4,i.a.Stated,new y.a(1,0,0),.25);const A=yield B.buildMeshAsync(),F=new o.a("shader",P,{vertex:"particles",fragment:"particles"},{attributes:["position","normal","uv"],uniforms:["world","worldView","worldViewProjection","view","iTime","iResolution","pSize"],needAlphaBlending:!0});return F.pointsCloud=!0,F.alphaMode=v.a.ALPHA_ADD,F.setFloat("iResolution",new M.y(1,1)),F.setFloat("pSize",2),A.material=F,C.dispose(),{render({time:N}){E.alpha+=.00125,F.setFloat("iTime",N);const w=P.getEngine().getAspectRatio(E);F.setVector2("iResolution",new M.y(w,1)),P.render()},resize({pixelRatio:N,width:w,height:U}){g.resize()},unload(){g.dispose()}}});x.default={sketch:u,settings:a}},572:function(z,x,d){"use strict";d.d(x,"a",function(){return i});var v=d(436),T=d(441),M=d(483),m=d(700),y=Object.freeze(new v.b(0,0,0,0)),O=Object.freeze(v.e.Zero()),c=Object.freeze(v.d.Zero()),l=Object.freeze(m.a.Zero()),e=Object.freeze(T.a.Black()),i=function(){function o(n,s,t,r){var a=this;if(this._events=new Array,this._currentFrame=0,this._originalValue=new Array,this._originalBlendValue=null,this._offsetsCache={},this._highLimitsCache={},this._stopped=!1,this._blendingFactor=0,this._currentValue=null,this._currentActiveTarget=null,this._directTarget=null,this._targetPath="",this._weight=1,this._ratioOffset=0,this._previousDelay=0,this._previousRatio=0,this._targetIsArray=!1,this._animation=s,this._target=n,this._scene=t,this._host=r,this._activeTargets=[],s._runtimeAnimations.push(this),this._animationState={key:0,repeatCount:0,loopMode:this._getCorrectLoopMode()},this._animation.dataType===M.a.ANIMATIONTYPE_MATRIX&&(this._animationState.workValue=v.a.Zero()),this._keys=this._animation.getKeys(),this._minFrame=this._keys[0].frame,this._maxFrame=this._keys[this._keys.length-1].frame,this._minValue=this._keys[0].value,this._maxValue=this._keys[this._keys.length-1].value,this._minFrame!==0){var u={frame:0,value:this._minValue};this._keys.splice(0,0,u)}if(this._target instanceof Array){for(var h=0,f=0,p=this._target;f<p.length;f++){var _=p[f];this._preparePath(_,h),this._getOriginalValues(h),h++}this._targetIsArray=!0}else this._preparePath(this._target),this._getOriginalValues(),this._targetIsArray=!1,this._directTarget=this._activeTargets[0];var g=s.getEvents();g&&g.length>0&&g.forEach(function(P){a._events.push(P._clone())}),this._enableBlending=n&&n.animationPropertiesOverride?n.animationPropertiesOverride.enableBlending:this._animation.enableBlending}return Object.defineProperty(o.prototype,"currentFrame",{get:function(){return this._currentFrame},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"weight",{get:function(){return this._weight},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"currentValue",{get:function(){return this._currentValue},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"targetPath",{get:function(){return this._targetPath},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"target",{get:function(){return this._currentActiveTarget},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"isAdditive",{get:function(){return this._host&&this._host.isAdditive},enumerable:!1,configurable:!0}),o.prototype._preparePath=function(n,s){s===void 0&&(s=0);var t=this._animation.targetPropertyPath;if(t.length>1){for(var r=n[t[0]],a=1;a<t.length-1;a++)r=r[t[a]];this._targetPath=t[t.length-1],this._activeTargets[s]=r}else this._targetPath=t[0],this._activeTargets[s]=n},Object.defineProperty(o.prototype,"animation",{get:function(){return this._animation},enumerable:!1,configurable:!0}),o.prototype.reset=function(n){if(n===void 0&&(n=!1),n)if(this._target instanceof Array)for(var s=0,t=0,r=this._target;t<r.length;t++){var a=r[t];this._originalValue[s]!==void 0&&this._setValue(a,this._activeTargets[s],this._originalValue[s],-1,s),s++}else this._originalValue[0]!==void 0&&this._setValue(this._target,this._directTarget,this._originalValue[0],-1,0);this._offsetsCache={},this._highLimitsCache={},this._currentFrame=0,this._blendingFactor=0;for(var s=0;s<this._events.length;s++)this._events[s].isDone=!1},o.prototype.isStopped=function(){return this._stopped},o.prototype.dispose=function(){var n=this._animation.runtimeAnimations.indexOf(this);n>-1&&this._animation.runtimeAnimations.splice(n,1)},o.prototype.setValue=function(n,s){if(this._targetIsArray){for(var t=0;t<this._target.length;t++){var r=this._target[t];this._setValue(r,this._activeTargets[t],n,s,t)}return}this._setValue(this._target,this._directTarget,n,s,0)},o.prototype._getOriginalValues=function(n){n===void 0&&(n=0);var s,t=this._activeTargets[n];t.getRestPose&&this._targetPath==="_matrix"?s=t.getRestPose():s=t[this._targetPath],s&&s.clone?this._originalValue[n]=s.clone():this._originalValue[n]=s},o.prototype._setValue=function(n,s,t,r,a){if(this._currentActiveTarget=s,this._weight=r,this._enableBlending&&this._blendingFactor<=1){if(!this._originalBlendValue){var u=s[this._targetPath];u.clone?this._originalBlendValue=u.clone():this._originalBlendValue=u}this._originalBlendValue.m?M.a.AllowMatrixDecomposeForInterpolation?this._currentValue?v.a.DecomposeLerpToRef(this._originalBlendValue,t,this._blendingFactor,this._currentValue):this._currentValue=v.a.DecomposeLerp(this._originalBlendValue,t,this._blendingFactor):this._currentValue?v.a.LerpToRef(this._originalBlendValue,t,this._blendingFactor,this._currentValue):this._currentValue=v.a.Lerp(this._originalBlendValue,t,this._blendingFactor):this._currentValue=M.a._UniversalLerp(this._originalBlendValue,t,this._blendingFactor);var h=n&&n.animationPropertiesOverride?n.animationPropertiesOverride.blendingSpeed:this._animation.blendingSpeed;this._blendingFactor+=h}else this._currentValue=t;r!==-1?this._scene._registerTargetForLateAnimationBinding(this,this._originalValue[a]):s[this._targetPath]=this._currentValue,n.markAsDirty&&n.markAsDirty(this._animation.targetProperty)},o.prototype._getCorrectLoopMode=function(){return this._target&&this._target.animationPropertiesOverride?this._target.animationPropertiesOverride.loopMode:this._animation.loopMode},o.prototype.goToFrame=function(n){var s=this._animation.getKeys();n<s[0].frame?n=s[0].frame:n>s[s.length-1].frame&&(n=s[s.length-1].frame);var t=this._events;if(t.length)for(var r=0;r<t.length;r++)t[r].onlyOnce||(t[r].isDone=t[r].frame<n);this._currentFrame=n;var a=this._animation._interpolate(n,this._animationState);this.setValue(a,-1)},o.prototype._prepareForSpeedRatioChange=function(n){var s=this._previousDelay*(this._animation.framePerSecond*n)/1e3;this._ratioOffset=this._previousRatio-s},o.prototype.animate=function(n,s,t,r,a,u){u===void 0&&(u=-1);var h=this._animation,f=h.targetPropertyPath;if(!f||f.length<1)return this._stopped=!0,!1;var p=!0;(s<this._minFrame||s>this._maxFrame)&&(s=this._minFrame),(t<this._minFrame||t>this._maxFrame)&&(t=this._maxFrame);var _=t-s,g,P=n*(h.framePerSecond*a)/1e3+this._ratioOffset,E=0;if(this._previousDelay=n,this._previousRatio=P,!r&&t>=s&&P>=_)p=!1,E=h._getKeyValue(this._maxValue);else if(!r&&s>=t&&P<=_)p=!1,E=h._getKeyValue(this._minValue);else if(this._animationState.loopMode!==M.a.ANIMATIONLOOPMODE_CYCLE){var R=t.toString()+s.toString();if(!this._offsetsCache[R]){this._animationState.repeatCount=0,this._animationState.loopMode=M.a.ANIMATIONLOOPMODE_CYCLE;var b=h._interpolate(s,this._animationState),C=h._interpolate(t,this._animationState);switch(this._animationState.loopMode=this._getCorrectLoopMode(),h.dataType){case M.a.ANIMATIONTYPE_FLOAT:this._offsetsCache[R]=C-b;break;case M.a.ANIMATIONTYPE_QUATERNION:this._offsetsCache[R]=C.subtract(b);break;case M.a.ANIMATIONTYPE_VECTOR3:this._offsetsCache[R]=C.subtract(b);break;case M.a.ANIMATIONTYPE_VECTOR2:this._offsetsCache[R]=C.subtract(b);break;case M.a.ANIMATIONTYPE_SIZE:this._offsetsCache[R]=C.subtract(b);break;case M.a.ANIMATIONTYPE_COLOR3:this._offsetsCache[R]=C.subtract(b);break;default:break}this._highLimitsCache[R]=C}E=this._highLimitsCache[R],g=this._offsetsCache[R]}if(g===void 0)switch(h.dataType){case M.a.ANIMATIONTYPE_FLOAT:g=0;break;case M.a.ANIMATIONTYPE_QUATERNION:g=y;break;case M.a.ANIMATIONTYPE_VECTOR3:g=O;break;case M.a.ANIMATIONTYPE_VECTOR2:g=c;break;case M.a.ANIMATIONTYPE_SIZE:g=l;break;case M.a.ANIMATIONTYPE_COLOR3:g=e}var B;if(this._host&&this._host.syncRoot){var A=this._host.syncRoot,F=(A.masterFrame-A.fromFrame)/(A.toFrame-A.fromFrame);B=s+(t-s)*F}else B=p&&_!==0?s+P%_:t;var N=this._events;if((_>0&&this.currentFrame>B||_<0&&this.currentFrame<B)&&(this._onLoop(),N.length))for(var w=0;w<N.length;w++)N[w].onlyOnce||(N[w].isDone=!1);this._currentFrame=B,this._animationState.repeatCount=_===0?0:P/_>>0,this._animationState.highLimitValue=E,this._animationState.offsetValue=g;var U=h._interpolate(B,this._animationState);if(this.setValue(U,u),N.length){for(var w=0;w<N.length;w++)if(_>0&&B>=N[w].frame&&N[w].frame>=s||_<0&&B<=N[w].frame&&N[w].frame<=s){var j=N[w];j.isDone||(j.onlyOnce&&(N.splice(w,1),w--),j.isDone=!0,j.action(B))}}return p||(this._stopped=!0),p},o}()},604:function(z,x,d){"use strict";d.d(x,"c",function(){return O}),d.d(x,"b",function(){return c}),d.d(x,"a",function(){return l});var v=d(434),T=d(468),M=d(446),m=d(440),y=d(448),O=function(e){Object(v.d)(i,e);function i(){return e!==null&&e.apply(this,arguments)||this}return i}(T.a),c=function(){function e(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}return e}(),l=function(e){Object(v.d)(i,e);function i(o){var n=e.call(this)||this;return n._wasAddedToScene=!1,n.scene=o,n.sounds=[],n.effectLayers=[],n.layers=[],n.lensFlareSystems=[],n.proceduralTextures=[],n.reflectionProbes=[],o.onDisposeObservable.add(function(){n._wasAddedToScene||n.dispose()}),n}return i.prototype.instantiateModelsToScene=function(o,n,s){var t=this;n===void 0&&(n=!1);var r={},a={},u=new c,h=[],f=[];s||(s={doNotInstantiate:!1});var p=function(_,g){if(r[_.uniqueId]=g.uniqueId,a[g.uniqueId]=g,o&&(g.name=o(_.name)),g instanceof M.a){var P=g;if(P.morphTargetManager){var E=_.morphTargetManager;P.morphTargetManager=E.clone();for(var R=0;R<E.numTargets;R++){var b=E.getTarget(R),C=P.morphTargetManager.getTarget(R);r[b.uniqueId]=C.uniqueId,a[C.uniqueId]=C}}}};return this.transformNodes.forEach(function(_){if(!_.parent){var g=_.instantiateHierarchy(null,s,function(P,E){p(P,E)});g&&u.rootNodes.push(g)}}),this.meshes.forEach(function(_){if(!_.parent){var g=_.instantiateHierarchy(null,s,function(P,E){if(p(P,E),E.material){var R=E;if(R.material)if(n){var b=P.material;if(f.indexOf(b)===-1){var C=b.clone(o?o(b.name):"Clone of "+b.name);if(f.push(b),r[b.uniqueId]=C.uniqueId,a[C.uniqueId]=C,b.getClassName()==="MultiMaterial"){for(var B=b,A=0,F=B.subMaterials;A<F.length;A++){var N=F[A];!N||(C=N.clone(o?o(N.name):"Clone of "+N.name),f.push(N),r[N.uniqueId]=C.uniqueId,a[C.uniqueId]=C)}B.subMaterials=B.subMaterials.map(function(w){return w&&a[r[w.uniqueId]]})}}R.getClassName()!=="InstancedMesh"&&(R.material=a[r[b.uniqueId]])}else R.material.getClassName()==="MultiMaterial"?t.scene.multiMaterials.indexOf(R.material)===-1&&t.scene.addMultiMaterial(R.material):t.scene.materials.indexOf(R.material)===-1&&t.scene.addMaterial(R.material)}});g&&u.rootNodes.push(g)}}),this.skeletons.forEach(function(_){var g=_.clone(o?o(_.name):"Clone of "+_.name);_.overrideMesh&&(g.overrideMesh=a[r[_.overrideMesh.uniqueId]]);for(var P=0,E=t.meshes;P<E.length;P++){var R=E[P];if(R.skeleton===_&&!R.isAnInstance){var b=a[r[R.uniqueId]];if(b.skeleton=g,h.indexOf(g)!==-1)continue;h.push(g);for(var C=0,B=g.bones;C<B.length;C++){var A=B[C];A._linkedTransformNode&&(A._linkedTransformNode=a[r[A._linkedTransformNode.uniqueId]])}}}u.skeletons.push(g)}),this.animationGroups.forEach(function(_){var g=_.clone(_.name,function(P){var E=a[r[P.uniqueId]];return E||P});u.animationGroups.push(g)}),u},i.prototype.addAllToScene=function(){var o=this;this._wasAddedToScene=!0,this.cameras.forEach(function(r){o.scene.addCamera(r)}),this.lights.forEach(function(r){o.scene.addLight(r)}),this.meshes.forEach(function(r){o.scene.addMesh(r)}),this.skeletons.forEach(function(r){o.scene.addSkeleton(r)}),this.animations.forEach(function(r){o.scene.addAnimation(r)}),this.animationGroups.forEach(function(r){o.scene.addAnimationGroup(r)}),this.multiMaterials.forEach(function(r){o.scene.addMultiMaterial(r)}),this.materials.forEach(function(r){o.scene.addMaterial(r)}),this.morphTargetManagers.forEach(function(r){o.scene.addMorphTargetManager(r)}),this.geometries.forEach(function(r){o.scene.addGeometry(r)}),this.transformNodes.forEach(function(r){o.scene.addTransformNode(r)}),this.actionManagers.forEach(function(r){o.scene.addActionManager(r)}),this.textures.forEach(function(r){o.scene.addTexture(r)}),this.reflectionProbes.forEach(function(r){o.scene.addReflectionProbe(r)}),this.environmentTexture&&(this.scene.environmentTexture=this.environmentTexture);for(var n=0,s=this.scene._serializableComponents;n<s.length;n++){var t=s[n];t.addFromContainer(this)}},i.prototype.removeAllFromScene=function(){var o=this;this._wasAddedToScene=!1,this.cameras.forEach(function(r){o.scene.removeCamera(r)}),this.lights.forEach(function(r){o.scene.removeLight(r)}),this.meshes.forEach(function(r){o.scene.removeMesh(r)}),this.skeletons.forEach(function(r){o.scene.removeSkeleton(r)}),this.animations.forEach(function(r){o.scene.removeAnimation(r)}),this.animationGroups.forEach(function(r){o.scene.removeAnimationGroup(r)}),this.multiMaterials.forEach(function(r){o.scene.removeMultiMaterial(r)}),this.materials.forEach(function(r){o.scene.removeMaterial(r)}),this.morphTargetManagers.forEach(function(r){o.scene.removeMorphTargetManager(r)}),this.geometries.forEach(function(r){o.scene.removeGeometry(r)}),this.transformNodes.forEach(function(r){o.scene.removeTransformNode(r)}),this.actionManagers.forEach(function(r){o.scene.removeActionManager(r)}),this.textures.forEach(function(r){o.scene.removeTexture(r)}),this.reflectionProbes.forEach(function(r){o.scene.removeReflectionProbe(r)}),this.environmentTexture===this.scene.environmentTexture&&(this.scene.environmentTexture=null);for(var n=0,s=this.scene._serializableComponents;n<s.length;n++){var t=s[n];t.removeFromContainer(this)}},i.prototype.dispose=function(){this.cameras.forEach(function(t){t.dispose()}),this.cameras=[],this.lights.forEach(function(t){t.dispose()}),this.lights=[],this.meshes.forEach(function(t){t.dispose()}),this.meshes=[],this.skeletons.forEach(function(t){t.dispose()}),this.skeletons=[],this.animationGroups.forEach(function(t){t.dispose()}),this.animationGroups=[],this.multiMaterials.forEach(function(t){t.dispose()}),this.multiMaterials=[],this.materials.forEach(function(t){t.dispose()}),this.materials=[],this.geometries.forEach(function(t){t.dispose()}),this.geometries=[],this.transformNodes.forEach(function(t){t.dispose()}),this.transformNodes=[],this.actionManagers.forEach(function(t){t.dispose()}),this.actionManagers=[],this.textures.forEach(function(t){t.dispose()}),this.textures=[],this.reflectionProbes.forEach(function(t){t.dispose()}),this.reflectionProbes=[],this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(var o=0,n=this.scene._serializableComponents;o<n.length;o++){var s=n[o];s.removeFromContainer(this,!0)}},i.prototype._moveAssets=function(o,n,s){if(!!o)for(var t=0,r=o;t<r.length;t++){var a=r[t],u=!0;if(s)for(var h=0,f=s;h<f.length;h++){var p=f[h];if(a===p){u=!1;break}}u&&n.push(a)}},i.prototype.moveAllFromScene=function(o){this._wasAddedToScene=!1,o===void 0&&(o=new O);for(var n in this)this.hasOwnProperty(n)&&(this[n]=this[n]||(n==="environmentTexture"?null:[]),this._moveAssets(this.scene[n],this[n],o[n]));this.environmentTexture=this.scene.environmentTexture,this.removeAllFromScene()},i.prototype.createRootMesh=function(){var o=new M.a("assetContainerRootMesh",this.scene);return this.meshes.forEach(function(n){n.parent||o.addChild(n)}),this.meshes.unshift(o),o},i.prototype.mergeAnimationsTo=function(o,n,s){if(o===void 0&&(o=y.a.LastCreatedScene),s===void 0&&(s=null),!o)return m.a.Error("No scene available to merge animations to"),[];var t=s||function(u){var h=null,f=u.animations.length?u.animations[0].targetProperty:"",p=u.name.split(".").join("").split("_primitive")[0];switch(f){case"position":case"rotationQuaternion":h=o.getTransformNodeByName(u.name)||o.getTransformNodeByName(p);break;case"influence":h=o.getMorphTargetByName(u.name)||o.getMorphTargetByName(p);break;default:h=o.getNodeByName(u.name)||o.getNodeByName(p)}return h},r=this.getNodes();r.forEach(function(u){var h=t(u);if(h!==null){for(var f=function(P){for(var E=h.animations.filter(function(A){return A.targetProperty===P.targetProperty}),R=0,b=E;R<b.length;R++){var C=b[R],B=h.animations.indexOf(C,0);B>-1&&h.animations.splice(B,1)}},p=0,_=u.animations;p<_.length;p++){var g=_[p];f(g)}h.animations=h.animations.concat(u.animations)}});var a=new Array;return this.animationGroups.slice().forEach(function(u){a.push(u.clone(u.name,t)),u.animatables.forEach(function(h){h.stop()})}),n.forEach(function(u){var h=t(u.target);h&&(o.beginAnimation(h,u.fromFrame,u.toFrame,u.loopAnimation,u.speedRatio,u.onAnimationEnd?u.onAnimationEnd:void 0,void 0,!0,void 0,u.onAnimationLoop?u.onAnimationLoop:void 0),o.stopAnimation(u.target))}),a},i}(T.a)},605:function(z,x,d){"use strict";var v=d(435),T="importanceSampling",M=`




























vec3 hemisphereCosSample(vec2 u) {

float phi=2.*PI*u.x;
float cosTheta2=1.-u.y;
float cosTheta=sqrt(cosTheta2);
float sinTheta=sqrt(1.-cosTheta2);
return vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);
}





































vec3 hemisphereImportanceSampleDggx(vec2 u,float a) {

float phi=2.*PI*u.x;

float cosTheta2=(1.-u.y)/(1.+(a+1.)*((a-1.)*u.y));
float cosTheta=sqrt(cosTheta2);
float sinTheta=sqrt(1.-cosTheta2);
return vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);
}

























































vec3 hemisphereImportanceSampleDCharlie(vec2 u,float a) {

float phi=2.*PI*u.x;
float sinTheta=pow(u.y,a/(2.*a+1.));
float cosTheta=sqrt(1.-sinTheta*sinTheta);
return vec3(sinTheta*cos(phi),sinTheta*sin(phi),cosTheta);
}`;v.a.IncludesShadersStore[T]=M;var m={name:T,shader:M}},606:function(z,x,d){"use strict";var v=d(435),T="pbrBRDFFunctions",M=`
#define FRESNEL_MAXIMUM_ON_ROUGH 0.25




#ifdef MS_BRDF_ENERGY_CONSERVATION


vec3 getEnergyConservationFactor(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {
return 1.0+specularEnvironmentR0*(1.0/environmentBrdf.y-1.0);
}
#endif
#ifdef ENVIRONMENTBRDF
vec3 getBRDFLookup(float NdotV,float perceptualRoughness) {

vec2 UV=vec2(NdotV,perceptualRoughness);

vec4 brdfLookup=texture2D(environmentBrdfSampler,UV);
#ifdef ENVIRONMENTBRDF_RGBD
brdfLookup.rgb=fromRGBD(brdfLookup.rgba);
#endif
return brdfLookup.rgb;
}
vec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 specularEnvironmentR90,const vec3 environmentBrdf) {
#ifdef BRDF_V_HEIGHT_CORRELATED
vec3 reflectance=(specularEnvironmentR90-specularEnvironmentR0)*environmentBrdf.x+specularEnvironmentR0*environmentBrdf.y;

#else
vec3 reflectance=specularEnvironmentR0*environmentBrdf.x+specularEnvironmentR90*environmentBrdf.y;
#endif
return reflectance;
}
vec3 getReflectanceFromBRDFLookup(const vec3 specularEnvironmentR0,const vec3 environmentBrdf) {
#ifdef BRDF_V_HEIGHT_CORRELATED
vec3 reflectance=mix(environmentBrdf.xxx,environmentBrdf.yyy,specularEnvironmentR0);
#else
vec3 reflectance=specularEnvironmentR0*environmentBrdf.x+environmentBrdf.y;
#endif
return reflectance;
}
#endif

#if !defined(ENVIRONMENTBRDF) || defined(REFLECTIONMAP_SKYBOX) || defined(ALPHAFRESNEL)
vec3 getReflectanceFromAnalyticalBRDFLookup_Jones(float VdotN,vec3 reflectance0,vec3 reflectance90,float smoothness)
{

float weight=mix(FRESNEL_MAXIMUM_ON_ROUGH,1.0,smoothness);
return reflectance0+weight*(reflectance90-reflectance0)*pow5(saturate(1.0-VdotN));
}
#endif
#if defined(SHEEN) && defined(ENVIRONMENTBRDF)

vec3 getSheenReflectanceFromBRDFLookup(const vec3 reflectance0,const vec3 environmentBrdf) {
vec3 sheenEnvironmentReflectance=reflectance0*environmentBrdf.b;
return sheenEnvironmentReflectance;
}
#endif
























vec3 fresnelSchlickGGX(float VdotH,vec3 reflectance0,vec3 reflectance90)
{
return reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);
}
float fresnelSchlickGGX(float VdotH,float reflectance0,float reflectance90)
{
return reflectance0+(reflectance90-reflectance0)*pow5(1.0-VdotH);
}
#ifdef CLEARCOAT





vec3 getR0RemappedForClearCoat(vec3 f0) {
#ifdef CLEARCOAT_DEFAULTIOR
#ifdef MOBILE
return saturate(f0*(f0*0.526868+0.529324)-0.0482256);
#else
return saturate(f0*(f0*(0.941892-0.263008*f0)+0.346479)-0.0285998);
#endif
#else
vec3 s=sqrt(f0);
vec3 t=(vClearCoatRefractionParams.z+vClearCoatRefractionParams.w*s)/(vClearCoatRefractionParams.w+vClearCoatRefractionParams.z*s);
return t*t;
#endif
}
#endif






float normalDistributionFunction_TrowbridgeReitzGGX(float NdotH,float alphaG)
{



float a2=square(alphaG);
float d=NdotH*NdotH*(a2-1.0)+1.0;
return a2/(PI*d*d);
}
#ifdef SHEEN


float normalDistributionFunction_CharlieSheen(float NdotH,float alphaG)
{
float invR=1./alphaG;
float cos2h=NdotH*NdotH;
float sin2h=1.-cos2h;
return (2.+invR)*pow(sin2h,invR*.5)/(2.*PI);
}
#endif
#ifdef ANISOTROPIC


float normalDistributionFunction_BurleyGGX_Anisotropic(float NdotH,float TdotH,float BdotH,const vec2 alphaTB) {
float a2=alphaTB.x*alphaTB.y;
vec3 v=vec3(alphaTB.y*TdotH,alphaTB.x*BdotH,a2*NdotH);
float v2=dot(v,v);
float w2=a2/v2;
return a2*w2*w2*RECIPROCAL_PI;
}
#endif




#ifdef BRDF_V_HEIGHT_CORRELATED



float smithVisibility_GGXCorrelated(float NdotL,float NdotV,float alphaG) {
#ifdef MOBILE

float GGXV=NdotL*(NdotV*(1.0-alphaG)+alphaG);
float GGXL=NdotV*(NdotL*(1.0-alphaG)+alphaG);
return 0.5/(GGXV+GGXL);
#else
float a2=alphaG*alphaG;
float GGXV=NdotL*sqrt(NdotV*(NdotV-a2*NdotV)+a2);
float GGXL=NdotV*sqrt(NdotL*(NdotL-a2*NdotL)+a2);
return 0.5/(GGXV+GGXL);
#endif
}
#else















float smithVisibilityG1_TrowbridgeReitzGGXFast(float dot,float alphaG)
{
#ifdef MOBILE

return 1.0/(dot+alphaG+(1.0-alphaG)*dot ));
#else
float alphaSquared=alphaG*alphaG;
return 1.0/(dot+sqrt(alphaSquared+(1.0-alphaSquared)*dot*dot));
#endif
}
float smithVisibility_TrowbridgeReitzGGXFast(float NdotL,float NdotV,float alphaG)
{
float visibility=smithVisibilityG1_TrowbridgeReitzGGXFast(NdotL,alphaG)*smithVisibilityG1_TrowbridgeReitzGGXFast(NdotV,alphaG);

return visibility;
}
#endif
#ifdef ANISOTROPIC


float smithVisibility_GGXCorrelated_Anisotropic(float NdotL,float NdotV,float TdotV,float BdotV,float TdotL,float BdotL,const vec2 alphaTB) {
float lambdaV=NdotL*length(vec3(alphaTB.x*TdotV,alphaTB.y*BdotV,NdotV));
float lambdaL=NdotV*length(vec3(alphaTB.x*TdotL,alphaTB.y*BdotL,NdotL));
float v=0.5/(lambdaV+lambdaL);
return v;
}
#endif
#ifdef CLEARCOAT
float visibility_Kelemen(float VdotH) {



return 0.25/(VdotH*VdotH);
}
#endif
#ifdef SHEEN



float visibility_Ashikhmin(float NdotL,float NdotV)
{
return 1./(4.*(NdotL+NdotV-NdotL*NdotV));
}

#endif







float diffuseBRDF_Burley(float NdotL,float NdotV,float VdotH,float roughness) {


float diffuseFresnelNV=pow5(saturateEps(1.0-NdotL));
float diffuseFresnelNL=pow5(saturateEps(1.0-NdotV));
float diffuseFresnel90=0.5+2.0*VdotH*VdotH*roughness;
float fresnel =
(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNL) *
(1.0+(diffuseFresnel90-1.0)*diffuseFresnelNV);
return fresnel/PI;
}
#ifdef SS_TRANSLUCENCY


vec3 transmittanceBRDF_Burley(const vec3 tintColor,const vec3 diffusionDistance,float thickness) {
vec3 S=1./maxEps(diffusionDistance);
vec3 temp=exp((-0.333333333*thickness)*S);
return tintColor.rgb*0.25*(temp*temp*temp+3.0*temp);
}


float computeWrappedDiffuseNdotL(float NdotL,float w) {
float t=1.0+w;
float invt2=1.0/square(t);
return saturate((NdotL+w)*invt2);
}
#endif
`;v.a.IncludesShadersStore[T]=M;var m={name:T,shader:M}},607:function(z,x,d){"use strict";var v=d(435),T="hdrFilteringFunctions",M=`#ifdef NUM_SAMPLES
#if NUM_SAMPLES>0
#if defined(WEBGL2) || defined(WEBGPU)


float radicalInverse_VdC(uint bits)
{
bits=(bits << 16u) | (bits >> 16u);
bits=((bits & 0x55555555u) << 1u) | ((bits & 0xAAAAAAAAu) >> 1u);
bits=((bits & 0x33333333u) << 2u) | ((bits & 0xCCCCCCCCu) >> 2u);
bits=((bits & 0x0F0F0F0Fu) << 4u) | ((bits & 0xF0F0F0F0u) >> 4u);
bits=((bits & 0x00FF00FFu) << 8u) | ((bits & 0xFF00FF00u) >> 8u);
return float(bits)*2.3283064365386963e-10;
}
vec2 hammersley(uint i,uint N)
{
return vec2(float(i)/float(N),radicalInverse_VdC(i));
}
#else
float vanDerCorpus(int n,int base)
{
float invBase=1.0/float(base);
float denom=1.0;
float result=0.0;
for(int i=0; i<32; ++i)
{
if(n>0)
{
denom=mod(float(n),2.0);
result+=denom*invBase;
invBase=invBase/2.0;
n=int(float(n)/2.0);
}
}
return result;
}
vec2 hammersley(int i,int N)
{
return vec2(float(i)/float(N),vanDerCorpus(i,2));
}
#endif
float log4(float x) {
return log2(x)/2.;
}
const float NUM_SAMPLES_FLOAT=float(NUM_SAMPLES);
const float NUM_SAMPLES_FLOAT_INVERSED=1./NUM_SAMPLES_FLOAT;
const float K=4.;



















































































































#define inline
vec3 irradiance(samplerCube inputTexture,vec3 inputN,vec2 filteringInfo)
{
vec3 n=normalize(inputN);
vec3 result=vec3(0.0);
vec3 tangent=abs(n.z)<0.999 ? vec3(0.,0.,1.) : vec3(1.,0.,0.);
tangent=normalize(cross(tangent,n));
vec3 bitangent=cross(n,tangent);
mat3 tbn=mat3(tangent,bitangent,n);
float maxLevel=filteringInfo.y;
float dim0=filteringInfo.x;
float omegaP=(4.*PI)/(6.*dim0*dim0);
#if defined(WEBGL2) || defined(WEBGPU)
for(uint i=0u; i<NUM_SAMPLES; ++i)
#else
for(int i=0; i<NUM_SAMPLES; ++i)
#endif
{
vec2 Xi=hammersley(i,NUM_SAMPLES);
vec3 Ls=hemisphereCosSample(Xi);
Ls=normalize(Ls);
vec3 Ns=vec3(0.,0.,1.);
float NoL=dot(Ns,Ls);
if (NoL>0.) {
float pdf_inversed=PI/NoL;
float omegaS=NUM_SAMPLES_FLOAT_INVERSED*pdf_inversed;
float l=log4(omegaS)-log4(omegaP)+log4(K);
float mipLevel=clamp(l,0.0,maxLevel);
vec3 c=textureCubeLodEXT(inputTexture,tbn*Ls,mipLevel).rgb;
#ifdef GAMMA_INPUT
c=toLinearSpace(c);
#endif
result+=c;
}
}
result=result*NUM_SAMPLES_FLOAT_INVERSED;
return result;
}
#define inline
vec3 radiance(float alphaG,samplerCube inputTexture,vec3 inputN,vec2 filteringInfo)
{
vec3 n=normalize(inputN);
if (alphaG == 0.) {
vec3 c=textureCube(inputTexture,n).rgb;
#ifdef GAMMA_INPUT
c=toLinearSpace(c);
#endif
return c;
} else {
vec3 result=vec3(0.);
vec3 tangent=abs(n.z)<0.999 ? vec3(0.,0.,1.) : vec3(1.,0.,0.);
tangent=normalize(cross(tangent,n));
vec3 bitangent=cross(n,tangent);
mat3 tbn=mat3(tangent,bitangent,n);
float maxLevel=filteringInfo.y;
float dim0=filteringInfo.x;
float omegaP=(4.*PI)/(6.*dim0*dim0);
float weight=0.;
#if defined(WEBGL2) || defined(WEBGPU)
for(uint i=0u; i<NUM_SAMPLES; ++i)
#else
for(int i=0; i<NUM_SAMPLES; ++i)
#endif
{
vec2 Xi=hammersley(i,NUM_SAMPLES);
vec3 H=hemisphereImportanceSampleDggx(Xi,alphaG);
float NoV=1.;
float NoH=H.z;
float NoH2=H.z*H.z;
float NoL=2.*NoH2-1.;
vec3 L=vec3(2.*NoH*H.x,2.*NoH*H.y,NoL);
L=normalize(L);
if (NoL>0.) {
float pdf_inversed=4./normalDistributionFunction_TrowbridgeReitzGGX(NoH,alphaG);
float omegaS=NUM_SAMPLES_FLOAT_INVERSED*pdf_inversed;
float l=log4(omegaS)-log4(omegaP)+log4(K);
float mipLevel=clamp(float(l),0.0,maxLevel);
weight+=NoL;
vec3 c=textureCubeLodEXT(inputTexture,tbn*L,mipLevel).rgb;
#ifdef GAMMA_INPUT
c=toLinearSpace(c);
#endif
result+=c*NoL;
}
}
result=result/weight;
return result;
}
}
#endif
#endif`;v.a.IncludesShadersStore[T]=M;var m={name:T,shader:M}},608:function(z,x,d){"use strict";d.d(x,"a",function(){return c});var v=d(434),T=d(438),M=d(448),m=d(447),y=d(439),O=d(437),c=function(){function l(e,i,o){i===void 0&&(i=0),o===void 0&&(o=null),this.name=e,this.animations=new Array,this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new T.c,this._onDataLayoutChanged=new T.c,this._animationPropertiesOverride=null,this._scene=o||M.a.LastCreatedScene,this.influence=i,this._scene&&(this._uniqueId=this._scene.getUniqueId())}return Object.defineProperty(l.prototype,"influence",{get:function(){return this._influence},set:function(e){if(this._influence!==e){var i=this._influence;this._influence=e,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(i===0||e===0)}},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"animationPropertiesOverride",{get:function(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride},set:function(e){this._animationPropertiesOverride=e},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"hasPositions",{get:function(){return!!this._positions},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"hasNormals",{get:function(){return!!this._normals},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"hasTangents",{get:function(){return!!this._tangents},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"hasUVs",{get:function(){return!!this._uvs},enumerable:!1,configurable:!0}),l.prototype.setPositions=function(e){var i=this.hasPositions;this._positions=e,i!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)},l.prototype.getPositions=function(){return this._positions},l.prototype.setNormals=function(e){var i=this.hasNormals;this._normals=e,i!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)},l.prototype.getNormals=function(){return this._normals},l.prototype.setTangents=function(e){var i=this.hasTangents;this._tangents=e,i!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)},l.prototype.getTangents=function(){return this._tangents},l.prototype.setUVs=function(e){var i=this.hasUVs;this._uvs=e,i!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)},l.prototype.getUVs=function(){return this._uvs},l.prototype.clone=function(){var e=this,i=y.a.Clone(function(){return new l(e.name,e.influence,e._scene)},this);return i._positions=this._positions,i._normals=this._normals,i._tangents=this._tangents,i._uvs=this._uvs,i},l.prototype.serialize=function(){var e={};return e.name=this.name,e.influence=this.influence,e.positions=Array.prototype.slice.call(this.getPositions()),this.id!=null&&(e.id=this.id),this.hasNormals&&(e.normals=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(e.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(e.uvs=Array.prototype.slice.call(this.getUVs())),y.a.AppendSerializedAnimations(this,e),e},l.prototype.getClassName=function(){return"MorphTarget"},l.Parse=function(e){var i=new l(e.name,e.influence);if(i.setPositions(e.positions),e.id!=null&&(i.id=e.id),e.normals&&i.setNormals(e.normals),e.tangents&&i.setTangents(e.tangents),e.uvs&&i.setUVs(e.uvs),e.animations)for(var o=0;o<e.animations.length;o++){var n=e.animations[o],s=O.a.GetClass("BABYLON.Animation");s&&i.animations.push(s.Parse(n))}return i},l.FromMesh=function(e,i,o){i||(i=e.name);var n=new l(i,o,e.getScene());return n.setPositions(e.getVerticesData(m.b.PositionKind)),e.isVerticesDataPresent(m.b.NormalKind)&&n.setNormals(e.getVerticesData(m.b.NormalKind)),e.isVerticesDataPresent(m.b.TangentKind)&&n.setTangents(e.getVerticesData(m.b.TangentKind)),e.isVerticesDataPresent(m.b.UVKind)&&n.setUVs(e.getVerticesData(m.b.UVKind)),n},Object(v.c)([Object(y.c)()],l.prototype,"id",void 0),l}()},609:function(z,x,d){"use strict";d.d(x,"a",function(){return T});var v=d(436),T=function(){function M(){this._hasHit=!1,this._hitDistance=0,this._hitNormalWorld=v.e.Zero(),this._hitPointWorld=v.e.Zero(),this._rayFromWorld=v.e.Zero(),this._rayToWorld=v.e.Zero()}return Object.defineProperty(M.prototype,"hasHit",{get:function(){return this._hasHit},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"hitDistance",{get:function(){return this._hitDistance},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"hitNormalWorld",{get:function(){return this._hitNormalWorld},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"hitPointWorld",{get:function(){return this._hitPointWorld},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"rayFromWorld",{get:function(){return this._rayFromWorld},enumerable:!1,configurable:!0}),Object.defineProperty(M.prototype,"rayToWorld",{get:function(){return this._rayToWorld},enumerable:!1,configurable:!0}),M.prototype.setHitData=function(m,y){this._hasHit=!0,this._hitNormalWorld=new v.e(m.x,m.y,m.z),this._hitPointWorld=new v.e(y.x,y.y,y.z)},M.prototype.setHitDistance=function(m){this._hitDistance=m},M.prototype.calculateHitDistance=function(){this._hitDistance=v.e.Distance(this._rayFromWorld,this._hitPointWorld)},M.prototype.reset=function(m,y){m===void 0&&(m=v.e.Zero()),y===void 0&&(y=v.e.Zero()),this._rayFromWorld=m,this._rayToWorld=y,this._hasHit=!1,this._hitDistance=0,this._hitNormalWorld=v.e.Zero(),this._hitPointWorld=v.e.Zero()},M}()},618:function(z,x,d){"use strict";d.d(x,"a",function(){return n});var v=d(434),T=d(436),M=d(441),m=d(619),y=d(511),O=d(620),c=d(448),l=d(440),e=d(474),i=d(437),o=d(669),n=function(s){Object(v.d)(t,s);function t(r){var a=s.call(this)||this;return a._scene=r||c.a.LastCreatedScene,r.actionManagers.push(a),a}return t.prototype.dispose=function(){for(var r=this._scene.actionManagers.indexOf(this),a=0;a<this.actions.length;a++){var u=this.actions[a];t.Triggers[u.trigger]--,t.Triggers[u.trigger]===0&&delete t.Triggers[u.trigger]}r>-1&&this._scene.actionManagers.splice(r,1)},t.prototype.getScene=function(){return this._scene},t.prototype.hasSpecificTriggers=function(r){for(var a=0;a<this.actions.length;a++){var u=this.actions[a];if(r.indexOf(u.trigger)>-1)return!0}return!1},t.prototype.hasSpecificTriggers2=function(r,a){for(var u=0;u<this.actions.length;u++){var h=this.actions[u];if(r==h.trigger||a==h.trigger)return!0}return!1},t.prototype.hasSpecificTrigger=function(r,a){for(var u=0;u<this.actions.length;u++){var h=this.actions[u];if(h.trigger===r)if(a){if(a(h.getTriggerParameter()))return!0}else return!0}return!1},Object.defineProperty(t.prototype,"hasPointerTriggers",{get:function(){for(var r=0;r<this.actions.length;r++){var a=this.actions[r];if(a.trigger>=t.OnPickTrigger&&a.trigger<=t.OnPointerOutTrigger)return!0}return!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPickTriggers",{get:function(){for(var r=0;r<this.actions.length;r++){var a=this.actions[r];if(a.trigger>=t.OnPickTrigger&&a.trigger<=t.OnPickUpTrigger)return!0}return!1},enumerable:!1,configurable:!0}),t.prototype.registerAction=function(r){return r.trigger===t.OnEveryFrameTrigger&&this.getScene().actionManager!==this?(l.a.Warn("OnEveryFrameTrigger can only be used with scene.actionManager"),null):(this.actions.push(r),t.Triggers[r.trigger]?t.Triggers[r.trigger]++:t.Triggers[r.trigger]=1,r._actionManager=this,r._prepare(),r)},t.prototype.unregisterAction=function(r){var a=this.actions.indexOf(r);return a!==-1?(this.actions.splice(a,1),t.Triggers[r.trigger]-=1,t.Triggers[r.trigger]===0&&delete t.Triggers[r.trigger],r._actionManager=null,!0):!1},t.prototype.processTrigger=function(r,a){for(var u=0;u<this.actions.length;u++){var h=this.actions[u];if(h.trigger===r){if(a&&(r===t.OnKeyUpTrigger||r===t.OnKeyDownTrigger)){var f=h.getTriggerParameter();if(f&&f!==a.sourceEvent.keyCode){if(!f.toLowerCase)continue;var p=f.toLowerCase();if(p!==a.sourceEvent.key){var _=a.sourceEvent.charCode?a.sourceEvent.charCode:a.sourceEvent.keyCode,g=String.fromCharCode(_).toLowerCase();if(g!==p)continue}}}h._executeCurrent(a)}}},t.prototype._getEffectiveTarget=function(r,a){for(var u=a.split("."),h=0;h<u.length-1;h++)r=r[u[h]];return r},t.prototype._getProperty=function(r){var a=r.split(".");return a[a.length-1]},t.prototype.serialize=function(r){for(var a={children:new Array,name:r,type:3,properties:new Array},u=0;u<this.actions.length;u++){var h={type:0,children:new Array,name:t.GetTriggerName(this.actions[u].trigger),properties:new Array},f=this.actions[u].triggerOptions;if(f&&typeof f!="number")if(f.parameter instanceof Node)h.properties.push(y.a._GetTargetProperty(f.parameter));else{var p={};e.a.DeepCopy(f.parameter,p,["mesh"]),f.parameter&&f.parameter.mesh&&(p._meshId=f.parameter.mesh.id),h.properties.push({name:"parameter",targetType:null,value:p})}this.actions[u].serialize(h),a.children.push(h)}return a},t.Parse=function(r,a,u){var h=new t(u);a===null?u.actionManager=h:a.actionManager=h;for(var f=function(B,A){var F=i.a.GetClass("BABYLON."+B);if(F){var N=Object.create(F.prototype);return N.constructor.apply(N,A),N}},p=function(B,A,F,N){if(N===null){var w=parseFloat(A);return A==="true"||A==="false"?A==="true":isNaN(w)?A:w}for(var U=N.split("."),j=A.split(","),H=0;H<U.length;H++)F=F[U[H]];if(typeof F=="boolean")return j[0]==="true";if(typeof F=="string")return j[0];for(var D=new Array,H=0;H<j.length;H++)D.push(parseFloat(j[H]));return F instanceof T.e?T.e.FromArray(D):F instanceof T.f?T.f.FromArray(D):F instanceof M.a?M.a.FromArray(D):F instanceof M.b?M.b.FromArray(D):parseFloat(j[0])},_=function(B,A,F,N,w){if(w===void 0&&(w=null),!B.detached){var U=new Array,j=null,H=null,D=B.combine&&B.combine.length>0;if(B.type===2?U.push(h):U.push(A),D){for(var W=new Array,J=0;J<B.combine.length;J++)_(B.combine[J],t.NothingTrigger,F,N,W);U.push(W)}else for(var Q=0;Q<B.properties.length;Q++){var G=B.properties[Q].value,L=B.properties[Q].name,K=B.properties[Q].targetType;L==="target"?K!==null&&K==="SceneProperties"?G=j=u:G=j=u.getNodeByName(G):L==="parent"?G=u.getNodeByName(G):L==="sound"?u.getSoundByName&&(G=u.getSoundByName(G)):L!=="propertyPath"?B.type===2&&L==="operator"?G=m.d[G]:G=p(L,G,j,L==="value"?H:null):H=G,U.push(G)}if(w===null?U.push(F):U.push(null),B.name==="InterpolateValueAction"){var S=U[U.length-2];U[U.length-1]=S,U[U.length-2]=F}var X=f(B.name,U);if(X instanceof m.a&&F!==null){var I=new O.b(A,F);N?N.then(I):h.registerAction(I),N=I}w===null?X instanceof m.a?(F=X,X=N):(F=null,N?N.then(X):h.registerAction(X)):w.push(X);for(var Q=0;Q<B.children.length;Q++)_(B.children[Q],A,F,X,null)}},g=0;g<r.children.length;g++){var P,E=r.children[g];if(E.properties.length>0){var R=E.properties[0].value,b=E.properties[0].targetType===null?R:u.getMeshByName(R);b._meshId&&(b.mesh=u.getMeshByID(b._meshId)),P={trigger:t[E.name],parameter:b}}else P=t[E.name];for(var C=0;C<E.children.length;C++)E.detached||_(E.children[C],P,null,null)}},t.GetTriggerName=function(r){switch(r){case 0:return"NothingTrigger";case 1:return"OnPickTrigger";case 2:return"OnLeftPickTrigger";case 3:return"OnRightPickTrigger";case 4:return"OnCenterPickTrigger";case 5:return"OnPickDownTrigger";case 6:return"OnPickUpTrigger";case 7:return"OnLongPressTrigger";case 8:return"OnPointerOverTrigger";case 9:return"OnPointerOutTrigger";case 10:return"OnEveryFrameTrigger";case 11:return"OnIntersectionEnterTrigger";case 12:return"OnIntersectionExitTrigger";case 13:return"OnKeyDownTrigger";case 14:return"OnKeyUpTrigger";case 15:return"OnPickOutTrigger";default:return""}},t.NothingTrigger=0,t.OnPickTrigger=1,t.OnLeftPickTrigger=2,t.OnRightPickTrigger=3,t.OnCenterPickTrigger=4,t.OnPickDownTrigger=5,t.OnDoublePickTrigger=6,t.OnPickUpTrigger=7,t.OnPickOutTrigger=16,t.OnLongPressTrigger=8,t.OnPointerOverTrigger=9,t.OnPointerOutTrigger=10,t.OnEveryFrameTrigger=11,t.OnIntersectionEnterTrigger=12,t.OnIntersectionExitTrigger=13,t.OnKeyDownTrigger=14,t.OnKeyUpTrigger=15,t}(o.a)},619:function(z,x,d){"use strict";d.d(x,"a",function(){return m}),d.d(x,"d",function(){return y}),d.d(x,"b",function(){return O}),d.d(x,"c",function(){return c});var v=d(434),T=d(511),M=d(437),m=function(){function l(e){this._actionManager=e}return l.prototype.isValid=function(){return!0},l.prototype._getProperty=function(e){return this._actionManager._getProperty(e)},l.prototype._getEffectiveTarget=function(e,i){return this._actionManager._getEffectiveTarget(e,i)},l.prototype.serialize=function(){},l.prototype._serialize=function(e){return{type:2,children:[],name:e.name,properties:e.properties}},l}(),y=function(l){Object(v.d)(e,l);function e(i,o,n,s,t){t===void 0&&(t=e.IsEqual);var r=l.call(this,i)||this;return r.propertyPath=n,r.value=s,r.operator=t,r._target=o,r._effectiveTarget=r._getEffectiveTarget(o,r.propertyPath),r._property=r._getProperty(r.propertyPath),r}return Object.defineProperty(e,"IsEqual",{get:function(){return e._IsEqual},enumerable:!1,configurable:!0}),Object.defineProperty(e,"IsDifferent",{get:function(){return e._IsDifferent},enumerable:!1,configurable:!0}),Object.defineProperty(e,"IsGreater",{get:function(){return e._IsGreater},enumerable:!1,configurable:!0}),Object.defineProperty(e,"IsLesser",{get:function(){return e._IsLesser},enumerable:!1,configurable:!0}),e.prototype.isValid=function(){switch(this.operator){case e.IsGreater:return this._effectiveTarget[this._property]>this.value;case e.IsLesser:return this._effectiveTarget[this._property]<this.value;case e.IsEqual:case e.IsDifferent:var i;return this.value.equals?i=this.value.equals(this._effectiveTarget[this._property]):i=this.value===this._effectiveTarget[this._property],this.operator===e.IsEqual?i:!i}return!1},e.prototype.serialize=function(){return this._serialize({name:"ValueCondition",properties:[T.a._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:T.a._SerializeValueAsString(this.value)},{name:"operator",value:e.GetOperatorName(this.operator)}]})},e.GetOperatorName=function(i){switch(i){case e._IsEqual:return"IsEqual";case e._IsDifferent:return"IsDifferent";case e._IsGreater:return"IsGreater";case e._IsLesser:return"IsLesser";default:return""}},e._IsEqual=0,e._IsDifferent=1,e._IsGreater=2,e._IsLesser=3,e}(m),O=function(l){Object(v.d)(e,l);function e(i,o){var n=l.call(this,i)||this;return n.predicate=o,n}return e.prototype.isValid=function(){return this.predicate()},e}(m),c=function(l){Object(v.d)(e,l);function e(i,o,n){var s=l.call(this,i)||this;return s.value=n,s._target=o,s}return e.prototype.isValid=function(){return this._target.state===this.value},e.prototype.serialize=function(){return this._serialize({name:"StateCondition",properties:[T.a._GetTargetProperty(this._target),{name:"value",value:this.value}]})},e}(m);M.a.RegisteredTypes["BABYLON.ValueCondition"]=y,M.a.RegisteredTypes["BABYLON.PredicateCondition"]=O,M.a.RegisteredTypes["BABYLON.StateCondition"]=c},620:function(z,x,d){"use strict";d.d(x,"j",function(){return O}),d.d(x,"g",function(){return c}),d.d(x,"h",function(){return l}),d.d(x,"d",function(){return e}),d.d(x,"e",function(){return i}),d.d(x,"i",function(){return o}),d.d(x,"b",function(){return n}),d.d(x,"a",function(){return s}),d.d(x,"c",function(){return t}),d.d(x,"f",function(){return r});var v=d(434),T=d(440),M=d(436),m=d(511),y=d(437),O=function(a){Object(v.d)(u,a);function u(h,f,p,_){var g=a.call(this,h,_)||this;return g.propertyPath=p,g._target=g._effectiveTarget=f,g}return u.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},u.prototype.execute=function(){this._effectiveTarget[this._property]=!this._effectiveTarget[this._property]},u.prototype.serialize=function(h){return a.prototype._serialize.call(this,{name:"SwitchBooleanAction",properties:[m.a._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath}]},h)},u}(m.a),c=function(a){Object(v.d)(u,a);function u(h,f,p,_){var g=a.call(this,h,_)||this;return g.value=p,g._target=f,g}return u.prototype.execute=function(){this._target.state=this.value},u.prototype.serialize=function(h){return a.prototype._serialize.call(this,{name:"SetStateAction",properties:[m.a._GetTargetProperty(this._target),{name:"value",value:this.value}]},h)},u}(m.a),l=function(a){Object(v.d)(u,a);function u(h,f,p,_,g){var P=a.call(this,h,g)||this;return P.propertyPath=p,P.value=_,P._target=P._effectiveTarget=f,P}return u.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath)},u.prototype.execute=function(){this._effectiveTarget[this._property]=this.value,this._target.markAsDirty&&this._target.markAsDirty(this._property)},u.prototype.serialize=function(h){return a.prototype._serialize.call(this,{name:"SetValueAction",properties:[m.a._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:m.a._SerializeValueAsString(this.value)}]},h)},u}(m.a),e=function(a){Object(v.d)(u,a);function u(h,f,p,_,g){var P=a.call(this,h,g)||this;return P.propertyPath=p,P.value=_,P._target=P._effectiveTarget=f,P}return u.prototype._prepare=function(){this._effectiveTarget=this._getEffectiveTarget(this._effectiveTarget,this.propertyPath),this._property=this._getProperty(this.propertyPath),typeof this._effectiveTarget[this._property]!="number"&&T.a.Warn("Warning: IncrementValueAction can only be used with number values")},u.prototype.execute=function(){this._effectiveTarget[this._property]+=this.value,this._target.markAsDirty&&this._target.markAsDirty(this._property)},u.prototype.serialize=function(h){return a.prototype._serialize.call(this,{name:"IncrementValueAction",properties:[m.a._GetTargetProperty(this._target),{name:"propertyPath",value:this.propertyPath},{name:"value",value:m.a._SerializeValueAsString(this.value)}]},h)},u}(m.a),i=function(a){Object(v.d)(u,a);function u(h,f,p,_,g,P){var E=a.call(this,h,P)||this;return E.from=p,E.to=_,E.loop=g,E._target=f,E}return u.prototype._prepare=function(){},u.prototype.execute=function(){var h=this._actionManager.getScene();h.beginAnimation(this._target,this.from,this.to,this.loop)},u.prototype.serialize=function(h){return a.prototype._serialize.call(this,{name:"PlayAnimationAction",properties:[m.a._GetTargetProperty(this._target),{name:"from",value:String(this.from)},{name:"to",value:String(this.to)},{name:"loop",value:m.a._SerializeValueAsString(this.loop)||!1}]},h)},u}(m.a),o=function(a){Object(v.d)(u,a);function u(h,f,p){var _=a.call(this,h,p)||this;return _._target=f,_}return u.prototype._prepare=function(){},u.prototype.execute=function(){var h=this._actionManager.getScene();h.stopAnimation(this._target)},u.prototype.serialize=function(h){return a.prototype._serialize.call(this,{name:"StopAnimationAction",properties:[m.a._GetTargetProperty(this._target)]},h)},u}(m.a),n=function(a){Object(v.d)(u,a);function u(h,f){return h===void 0&&(h=0),a.call(this,h,f)||this}return u.prototype.execute=function(){},u.prototype.serialize=function(h){return a.prototype._serialize.call(this,{name:"DoNothingAction",properties:[]},h)},u}(m.a),s=function(a){Object(v.d)(u,a);function u(h,f,p){var _=a.call(this,h,p)||this;return _.children=f,_}return u.prototype._prepare=function(){for(var h=0;h<this.children.length;h++)this.children[h]._actionManager=this._actionManager,this.children[h]._prepare()},u.prototype.execute=function(h){for(var f=0;f<this.children.length;f++)this.children[f].execute(h)},u.prototype.serialize=function(h){for(var f=a.prototype._serialize.call(this,{name:"CombineAction",properties:[],combine:[]},h),p=0;p<this.children.length;p++)f.combine.push(this.children[p].serialize(null));return f},u}(m.a),t=function(a){Object(v.d)(u,a);function u(h,f,p){var _=a.call(this,h,p)||this;return _.func=f,_}return u.prototype.execute=function(h){this.func(h)},u}(m.a),r=function(a){Object(v.d)(u,a);function u(h,f,p,_){var g=a.call(this,h,_)||this;return g._target=f,g._parent=p,g}return u.prototype._prepare=function(){},u.prototype.execute=function(){if(this._target.parent!==this._parent){var h=this._parent.getWorldMatrix().clone();h.invert(),this._target.position=M.e.TransformCoordinates(this._target.position,h),this._target.parent=this._parent}},u.prototype.serialize=function(h){return a.prototype._serialize.call(this,{name:"SetParentAction",properties:[m.a._GetTargetProperty(this._target),m.a._GetTargetProperty(this._parent)]},h)},u}(m.a);y.a.RegisteredTypes["BABYLON.SetParentAction"]=r,y.a.RegisteredTypes["BABYLON.ExecuteCodeAction"]=t,y.a.RegisteredTypes["BABYLON.DoNothingAction"]=n,y.a.RegisteredTypes["BABYLON.StopAnimationAction"]=o,y.a.RegisteredTypes["BABYLON.PlayAnimationAction"]=i,y.a.RegisteredTypes["BABYLON.IncrementValueAction"]=e,y.a.RegisteredTypes["BABYLON.SetValueAction"]=l,y.a.RegisteredTypes["BABYLON.SetStateAction"]=c,y.a.RegisteredTypes["BABYLON.SetParentAction"]=r},630:function(z,x,d){"use strict";d.d(x,"a",function(){return c}),d.d(x,"b",function(){return l});var v=d(434),T=d(447),M=d(520),m=d(438),y=d(435),O=d(534),c=function(){function e(i,o){var n;o===void 0&&(o=e._DefaultOptions),this.engine=i,this._fullscreenViewport=new M.a(0,0,1,1),o=Object(v.a)(Object(v.a)({},e._DefaultOptions),o),this._vertexBuffers=(n={},n[T.b.PositionKind]=new T.b(i,o.positions,T.b.PositionKind,!1,!1,2),n),this._indexBuffer=i.createIndexBuffer(o.indices)}return e.prototype.setViewport=function(i){i===void 0&&(i=this._fullscreenViewport),this.engine.setViewport(i)},e.prototype.bindBuffers=function(i){this.engine.bindBuffers(this._vertexBuffers,this._indexBuffer,i)},e.prototype.applyEffectWrapper=function(i){this.engine.depthCullingState.depthTest=!1,this.engine.stencilState.stencilTest=!1,this.engine.enableEffect(i.effect),this.bindBuffers(i.effect),i.onApplyObservable.notifyObservers({})},e.prototype.restoreStates=function(){this.engine.depthCullingState.depthTest=!0,this.engine.stencilState.stencilTest=!0},e.prototype.draw=function(){this.engine.drawElementsType(0,0,6)},e.prototype.isRenderTargetTexture=function(i){return i.renderList!==void 0},e.prototype.render=function(i,o){if(o===void 0&&(o=null),!!i.effect.isReady()){this.setViewport();var n=o===null?null:this.isRenderTargetTexture(o)?o.getInternalTexture():o;n&&this.engine.bindFramebuffer(n),this.applyEffectWrapper(i),this.draw(),n&&this.engine.unBindFramebuffer(n),this.restoreStates()}},e.prototype.dispose=function(){var i=this._vertexBuffers[T.b.PositionKind];i&&(i.dispose(),delete this._vertexBuffers[T.b.PositionKind]),this._indexBuffer&&this.engine._releaseBuffer(this._indexBuffer)},e._DefaultOptions={positions:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]},e}(),l=function(){function e(i){var o=this;this.onApplyObservable=new m.c;var n,s=i.uniformNames||[];i.vertexShader?n={fragmentSource:i.fragmentShader,vertexSource:i.vertexShader,spectorName:i.name||"effectWrapper"}:(s.push("scale"),n={fragmentSource:i.fragmentShader,vertex:"postprocess",spectorName:i.name||"effectWrapper"},this.onApplyObservable.add(function(){o.effect.setFloat2("scale",1,1)}));var t=i.defines?i.defines.join(`
`):"";i.useShaderStore?(n.fragment=n.fragmentSource,n.vertex||(n.vertex=n.vertexSource),delete n.fragmentSource,delete n.vertexSource,this.effect=i.engine.createEffect(n.spectorName,i.attributeNames||["position"],s,i.samplerNames,t,void 0,i.onCompiled)):this.effect=new y.a(n,i.attributeNames||["position"],s,i.samplerNames,i.engine,t,void 0,i.onCompiled)}return e.prototype.dispose=function(){this.effect.dispose()},e}()},631:function(z,x,d){"use strict";d.d(x,"a",function(){return m});var v=d(434),T=d(442),M=d(492),m=function(y){Object(v.d)(O,y);function O(c,l,e,i,o,n,s,t,r,a){s===void 0&&(s=!0),t===void 0&&(t=!1),r===void 0&&(r=T.a.TRILINEAR_SAMPLINGMODE),a===void 0&&(a=0);var u=y.call(this,null,n,!s,t)||this;return u.format=o,u._texture=n.getEngine().createRawTexture2DArray(c,l,e,i,o,s,t,r,null,a),u._depth=i,u.is2DArray=!0,u}return Object.defineProperty(O.prototype,"depth",{get:function(){return this._depth},enumerable:!1,configurable:!0}),O.prototype.update=function(c){!this._texture||this._getEngine().updateRawTexture2DArray(this._texture,c,this._texture.format,this._texture.invertY,null,this._texture.type)},O.CreateRGBATexture=function(c,l,e,i,o,n,s,t,r){return n===void 0&&(n=!0),s===void 0&&(s=!1),t===void 0&&(t=3),r===void 0&&(r=0),new O(c,l,e,i,5,o,n,s,t,r)},O}(T.a)},632:function(z,x,d){"use strict";d.d(x,"a",function(){return l});var v=d(440),T=d(436),M=d(447),m=d(503),y=d(510),O=d(544),c=d(609),l=function(){function e(i,o,n){if(i===void 0&&(i=!0),o===void 0&&(o=10),n===void 0&&(n=CANNON),this._useDeltaForWorldStep=i,this.name="CannonJSPlugin",this._physicsMaterials=new Array,this._fixedTimeStep=1/60,this._physicsBodysToRemoveAfterStep=new Array,this._firstFrame=!0,this._minus90X=new T.b(-.7071067811865475,0,0,.7071067811865475),this._plus90X=new T.b(.7071067811865475,0,0,.7071067811865475),this._tmpPosition=T.e.Zero(),this._tmpDeltaPosition=T.e.Zero(),this._tmpUnityRotation=new T.b,this.BJSCANNON=n,!this.isSupported()){v.a.Error("CannonJS is not available. Please make sure you included the js file.");return}this._extendNamespace(),this.world=new this.BJSCANNON.World,this.world.broadphase=new this.BJSCANNON.NaiveBroadphase,this.world.solver.iterations=o,this._cannonRaycastResult=new this.BJSCANNON.RaycastResult,this._raycastResult=new c.a}return e.prototype.setGravity=function(i){var o=i;this.world.gravity.set(o.x,o.y,o.z)},e.prototype.setTimeStep=function(i){this._fixedTimeStep=i},e.prototype.getTimeStep=function(){return this._fixedTimeStep},e.prototype.executeStep=function(i,o){if(this._firstFrame){this._firstFrame=!1;for(var n=0,s=o;n<s.length;n++){var t=s[n];t.type==m.a.HeightmapImpostor||t.type===m.a.PlaneImpostor||t.beforeStep()}}this.world.step(this._useDeltaForWorldStep?i:this._fixedTimeStep),this._removeMarkedPhysicsBodiesFromWorld()},e.prototype._removeMarkedPhysicsBodiesFromWorld=function(){var i=this;this._physicsBodysToRemoveAfterStep.length>0&&(this._physicsBodysToRemoveAfterStep.forEach(function(o){i.world.remove(o)}),this._physicsBodysToRemoveAfterStep=[])},e.prototype.applyImpulse=function(i,o,n){var s=new this.BJSCANNON.Vec3(n.x,n.y,n.z),t=new this.BJSCANNON.Vec3(o.x,o.y,o.z);i.physicsBody.applyImpulse(t,s)},e.prototype.applyForce=function(i,o,n){var s=new this.BJSCANNON.Vec3(n.x,n.y,n.z),t=new this.BJSCANNON.Vec3(o.x,o.y,o.z);i.physicsBody.applyForce(t,s)},e.prototype.generatePhysicsBody=function(i){if(this._removeMarkedPhysicsBodiesFromWorld(),i.parent){i.physicsBody&&(this.removePhysicsBody(i),i.forceUpdate());return}if(i.isBodyInitRequired()){var o=this._createShape(i),n=i.physicsBody;n&&this.removePhysicsBody(i);var s=this._addMaterial("mat-"+i.uniqueId,i.getParam("friction"),i.getParam("restitution")),t={mass:i.getParam("mass"),material:s},r=i.getParam("nativeOptions");for(var a in r)r.hasOwnProperty(a)&&(t[a]=r[a]);i.physicsBody=new this.BJSCANNON.Body(t),i.physicsBody.addEventListener("collide",i.onCollide),this.world.addEventListener("preStep",i.beforeStep),this.world.addEventListener("postStep",i.afterStep),i.physicsBody.addShape(o),this.world.add(i.physicsBody),n&&["force","torque","velocity","angularVelocity"].forEach(function(u){var h=n[u];i.physicsBody[u].set(h.x,h.y,h.z)}),this._processChildMeshes(i)}this._updatePhysicsBodyTransformation(i)},e.prototype._processChildMeshes=function(i){var o=this,n=i.object.getChildMeshes?i.object.getChildMeshes(!0):[],s=i.object.rotationQuaternion;if(n.length){var t=function(r){if(!(!s||!r.rotationQuaternion)){var a=r.getPhysicsImpostor();if(a){var u=a.parent;if(u!==i){var h=r.getAbsolutePosition().subtract(r.parent.getAbsolutePosition()),f=r.rotationQuaternion;a.physicsBody&&(o.removePhysicsBody(a),a.physicsBody=null),a.parent=i,a.resetUpdateFlags(),i.physicsBody.addShape(o._createShape(a),new o.BJSCANNON.Vec3(h.x,h.y,h.z),new o.BJSCANNON.Quaternion(f.x,f.y,f.z,f.w)),i.physicsBody.mass+=a.getParam("mass")}}s.multiplyInPlace(r.rotationQuaternion),r.getChildMeshes(!0).filter(function(p){return!!p.physicsImpostor}).forEach(t)}};n.filter(function(r){return!!r.physicsImpostor}).forEach(t)}},e.prototype.removePhysicsBody=function(i){i.physicsBody.removeEventListener("collide",i.onCollide),this.world.removeEventListener("preStep",i.beforeStep),this.world.removeEventListener("postStep",i.afterStep),this._physicsBodysToRemoveAfterStep.indexOf(i.physicsBody)===-1&&this._physicsBodysToRemoveAfterStep.push(i.physicsBody)},e.prototype.generateJoint=function(i){var o=i.mainImpostor.physicsBody,n=i.connectedImpostor.physicsBody;if(!(!o||!n)){var s,t=i.joint.jointData,r={pivotA:t.mainPivot?new this.BJSCANNON.Vec3().set(t.mainPivot.x,t.mainPivot.y,t.mainPivot.z):null,pivotB:t.connectedPivot?new this.BJSCANNON.Vec3().set(t.connectedPivot.x,t.connectedPivot.y,t.connectedPivot.z):null,axisA:t.mainAxis?new this.BJSCANNON.Vec3().set(t.mainAxis.x,t.mainAxis.y,t.mainAxis.z):null,axisB:t.connectedAxis?new this.BJSCANNON.Vec3().set(t.connectedAxis.x,t.connectedAxis.y,t.connectedAxis.z):null,maxForce:t.nativeParams.maxForce,collideConnected:!!t.collision};switch(i.joint.type){case y.e.HingeJoint:case y.e.Hinge2Joint:s=new this.BJSCANNON.HingeConstraint(o,n,r);break;case y.e.DistanceJoint:s=new this.BJSCANNON.DistanceConstraint(o,n,t.maxDistance||2);break;case y.e.SpringJoint:var a=t;s=new this.BJSCANNON.Spring(o,n,{restLength:a.length,stiffness:a.stiffness,damping:a.damping,localAnchorA:r.pivotA,localAnchorB:r.pivotB});break;case y.e.LockJoint:s=new this.BJSCANNON.LockConstraint(o,n,r);break;case y.e.PointToPointJoint:case y.e.BallAndSocketJoint:default:s=new this.BJSCANNON.PointToPointConstraint(o,r.pivotA,n,r.pivotB,r.maxForce);break}s.collideConnected=!!t.collision,i.joint.physicsJoint=s,i.joint.type!==y.e.SpringJoint?this.world.addConstraint(s):(i.joint.jointData.forceApplicationCallback=i.joint.jointData.forceApplicationCallback||function(){s.applyForce()},i.mainImpostor.registerAfterPhysicsStep(i.joint.jointData.forceApplicationCallback))}},e.prototype.removeJoint=function(i){i.joint.type!==y.e.SpringJoint?this.world.removeConstraint(i.joint.physicsJoint):i.mainImpostor.unregisterAfterPhysicsStep(i.joint.jointData.forceApplicationCallback)},e.prototype._addMaterial=function(i,o,n){var s,t;for(s=0;s<this._physicsMaterials.length;s++)if(t=this._physicsMaterials[s],t.friction===o&&t.restitution===n)return t;var r=new this.BJSCANNON.Material(i);return r.friction=o,r.restitution=n,this._physicsMaterials.push(r),r},e.prototype._checkWithEpsilon=function(i){return i<O.a.Epsilon?O.a.Epsilon:i},e.prototype._createShape=function(i){var o=i.object,n,s=i.getObjectExtendSize();switch(i.type){case m.a.SphereImpostor:var t=s.x,r=s.y,a=s.z;n=new this.BJSCANNON.Sphere(Math.max(this._checkWithEpsilon(t),this._checkWithEpsilon(r),this._checkWithEpsilon(a))/2);break;case m.a.CylinderImpostor:var u=i.getParam("nativeOptions");u||(u={});var h=u.radiusTop!==void 0?u.radiusTop:this._checkWithEpsilon(s.x)/2,f=u.radiusBottom!==void 0?u.radiusBottom:this._checkWithEpsilon(s.x)/2,p=u.height!==void 0?u.height:this._checkWithEpsilon(s.y),_=u.numSegments!==void 0?u.numSegments:16;n=new this.BJSCANNON.Cylinder(h,f,p,_);var g=new this.BJSCANNON.Quaternion;g.setFromAxisAngle(new this.BJSCANNON.Vec3(1,0,0),-Math.PI/2);var P=new this.BJSCANNON.Vec3(0,0,0);n.transformAllPoints(P,g);break;case m.a.BoxImpostor:var E=s.scale(.5);n=new this.BJSCANNON.Box(new this.BJSCANNON.Vec3(this._checkWithEpsilon(E.x),this._checkWithEpsilon(E.y),this._checkWithEpsilon(E.z)));break;case m.a.PlaneImpostor:v.a.Warn("Attention, PlaneImposter might not behave as you expect. Consider using BoxImposter instead"),n=new this.BJSCANNON.Plane;break;case m.a.MeshImpostor:var R=o.getVerticesData?o.getVerticesData(M.b.PositionKind):[],b=o.getIndices?o.getIndices():[];if(!R)return;var C=o.position.clone(),B=o.rotation&&o.rotation.clone(),A=o.rotationQuaternion&&o.rotationQuaternion.clone();o.position.copyFromFloats(0,0,0),o.rotation&&o.rotation.copyFromFloats(0,0,0),o.rotationQuaternion&&o.rotationQuaternion.copyFrom(i.getParentsRotation()),o.rotationQuaternion&&o.parent&&o.rotationQuaternion.conjugateInPlace();var F=o.computeWorldMatrix(!0),N=new Array,w;for(w=0;w<R.length;w+=3)T.e.TransformCoordinates(T.e.FromArray(R,w),F).toArray(N,w);v.a.Warn("MeshImpostor only collides against spheres."),n=new this.BJSCANNON.Trimesh(N,b),o.position.copyFrom(C),B&&o.rotation&&o.rotation.copyFrom(B),A&&o.rotationQuaternion&&o.rotationQuaternion.copyFrom(A);break;case m.a.HeightmapImpostor:var U=o.position.clone(),j=o.rotation&&o.rotation.clone(),H=o.rotationQuaternion&&o.rotationQuaternion.clone();o.position.copyFromFloats(0,0,0),o.rotation&&o.rotation.copyFromFloats(0,0,0),o.rotationQuaternion&&o.rotationQuaternion.copyFrom(i.getParentsRotation()),o.rotationQuaternion&&o.parent&&o.rotationQuaternion.conjugateInPlace(),o.rotationQuaternion&&o.rotationQuaternion.multiplyInPlace(this._minus90X),n=this._createHeightmap(o),o.position.copyFrom(U),j&&o.rotation&&o.rotation.copyFrom(j),H&&o.rotationQuaternion&&o.rotationQuaternion.copyFrom(H),o.computeWorldMatrix(!0);break;case m.a.ParticleImpostor:n=new this.BJSCANNON.Particle;break;case m.a.NoImpostor:n=new this.BJSCANNON.Box(new this.BJSCANNON.Vec3(0,0,0));break}return n},e.prototype._createHeightmap=function(i,o){var n=i.getVerticesData(M.b.PositionKind),s=i.computeWorldMatrix(!0),t=new Array,r;for(r=0;r<n.length;r+=3)T.e.TransformCoordinates(T.e.FromArray(n,r),s).toArray(t,r);n=t;for(var a=new Array,u=o||~~(Math.sqrt(n.length/3)-1),h=i.getBoundingInfo(),f=Math.min(h.boundingBox.extendSizeWorld.x,h.boundingBox.extendSizeWorld.y),p=h.boundingBox.extendSizeWorld.z,_=f*2/u,g=0;g<n.length;g=g+3){var P=Math.round(n[g+0]/_+u/2),E=Math.round((n[g+1]/_-u/2)*-1),R=-n[g+2]+p;a[P]||(a[P]=[]),a[P][E]||(a[P][E]=R),a[P][E]=Math.max(R,a[P][E])}for(var P=0;P<=u;++P){if(!a[P]){for(var b=1;!a[(P+b)%u];)b++;a[P]=a[(P+b)%u].slice()}for(var E=0;E<=u;++E)if(!a[P][E]){for(var b=1,C;C===void 0;)C=a[P][(E+b++)%u];a[P][E]=C}}var B=new this.BJSCANNON.Heightfield(a,{elementSize:_});return B.minY=p,B},e.prototype._updatePhysicsBodyTransformation=function(i){var o=i.object;if(o.computeWorldMatrix&&o.computeWorldMatrix(!0),!!o.getBoundingInfo()){var n=i.getObjectCenter();this._tmpDeltaPosition.copyFrom(o.getAbsolutePivotPoint().subtract(n)),this._tmpDeltaPosition.divideInPlace(i.object.scaling),this._tmpPosition.copyFrom(n);var s=o.rotationQuaternion;if(!!s){if((i.type===m.a.PlaneImpostor||i.type===m.a.HeightmapImpostor)&&(s=s.multiply(this._minus90X),i.setDeltaRotation(this._plus90X)),i.type===m.a.HeightmapImpostor){var t=o,r=t.getBoundingInfo(),a=t.rotationQuaternion;t.rotationQuaternion=this._tmpUnityRotation,t.computeWorldMatrix(!0);var u=n.clone(),h=t.getPivotMatrix();h?h=h.clone():h=T.a.Identity();var f=T.a.Translation(r.boundingBox.extendSizeWorld.x,0,-r.boundingBox.extendSizeWorld.z);t.setPreTransformMatrix(f),t.computeWorldMatrix(!0);var p=r.boundingBox.centerWorld.subtract(n).subtract(t.position).negate();this._tmpPosition.copyFromFloats(p.x,p.y-r.boundingBox.extendSizeWorld.y,p.z),this._tmpDeltaPosition.copyFrom(r.boundingBox.centerWorld.subtract(u)),this._tmpDeltaPosition.y+=r.boundingBox.extendSizeWorld.y,t.rotationQuaternion=a,t.setPreTransformMatrix(h),t.computeWorldMatrix(!0)}else i.type===m.a.MeshImpostor&&this._tmpDeltaPosition.copyFromFloats(0,0,0);i.setDeltaPosition(this._tmpDeltaPosition),i.physicsBody.position.set(this._tmpPosition.x,this._tmpPosition.y,this._tmpPosition.z),i.physicsBody.quaternion.set(s.x,s.y,s.z,s.w)}}},e.prototype.setTransformationFromPhysicsBody=function(i){if(i.object.position.set(i.physicsBody.position.x,i.physicsBody.position.y,i.physicsBody.position.z),i.object.rotationQuaternion){var o=i.physicsBody.quaternion;i.object.rotationQuaternion.set(o.x,o.y,o.z,o.w)}},e.prototype.setPhysicsBodyTransformation=function(i,o,n){i.physicsBody.position.set(o.x,o.y,o.z),i.physicsBody.quaternion.set(n.x,n.y,n.z,n.w)},e.prototype.isSupported=function(){return this.BJSCANNON!==void 0},e.prototype.setLinearVelocity=function(i,o){i.physicsBody.velocity.set(o.x,o.y,o.z)},e.prototype.setAngularVelocity=function(i,o){i.physicsBody.angularVelocity.set(o.x,o.y,o.z)},e.prototype.getLinearVelocity=function(i){var o=i.physicsBody.velocity;return o?new T.e(o.x,o.y,o.z):null},e.prototype.getAngularVelocity=function(i){var o=i.physicsBody.angularVelocity;return o?new T.e(o.x,o.y,o.z):null},e.prototype.setBodyMass=function(i,o){i.physicsBody.mass=o,i.physicsBody.updateMassProperties()},e.prototype.getBodyMass=function(i){return i.physicsBody.mass},e.prototype.getBodyFriction=function(i){return i.physicsBody.material.friction},e.prototype.setBodyFriction=function(i,o){i.physicsBody.material.friction=o},e.prototype.getBodyRestitution=function(i){return i.physicsBody.material.restitution},e.prototype.setBodyRestitution=function(i,o){i.physicsBody.material.restitution=o},e.prototype.sleepBody=function(i){i.physicsBody.sleep()},e.prototype.wakeUpBody=function(i){i.physicsBody.wakeUp()},e.prototype.updateDistanceJoint=function(i,o){i.physicsJoint.distance=o},e.prototype.setMotor=function(i,o,n,s){s||(i.physicsJoint.enableMotor(),i.physicsJoint.setMotorSpeed(o),n&&this.setLimit(i,n))},e.prototype.setLimit=function(i,o,n){i.physicsJoint.motorEquation.maxForce=o,i.physicsJoint.motorEquation.minForce=n===void 0?-o:n},e.prototype.syncMeshWithImpostor=function(i,o){var n=o.physicsBody;i.position.x=n.position.x,i.position.y=n.position.y,i.position.z=n.position.z,i.rotationQuaternion&&(i.rotationQuaternion.x=n.quaternion.x,i.rotationQuaternion.y=n.quaternion.y,i.rotationQuaternion.z=n.quaternion.z,i.rotationQuaternion.w=n.quaternion.w)},e.prototype.getRadius=function(i){var o=i.physicsBody.shapes[0];return o.boundingSphereRadius},e.prototype.getBoxSizeToRef=function(i,o){var n=i.physicsBody.shapes[0];o.x=n.halfExtents.x*2,o.y=n.halfExtents.y*2,o.z=n.halfExtents.z*2},e.prototype.dispose=function(){},e.prototype._extendNamespace=function(){var i=new this.BJSCANNON.Vec3,o=this.BJSCANNON;this.BJSCANNON.World.prototype.step=function(n,s,t){if(t=t||10,s=s||0,s===0)this.internalStep(n),this.time+=n;else{var r=Math.floor((this.time+s)/n)-Math.floor(this.time/n);r=Math.min(r,t)||1;for(var a=performance.now(),u=0;u!==r&&(this.internalStep(n),!(performance.now()-a>n*1e3));u++);this.time+=s;for(var h=this.time%n,f=h/n,p=i,_=this.bodies,g=0;g!==_.length;g++){var P=_[g];P.type!==o.Body.STATIC&&P.sleepState!==o.Body.SLEEPING?(P.position.vsub(P.previousPosition,p),p.scale(f,p),P.position.vadd(p,P.interpolatedPosition)):(P.interpolatedPosition.set(P.position.x,P.position.y,P.position.z),P.interpolatedQuaternion.set(P.quaternion.x,P.quaternion.y,P.quaternion.z,P.quaternion.w))}}}},e.prototype.raycast=function(i,o){return this._cannonRaycastResult.reset(),this.world.raycastClosest(i,o,{},this._cannonRaycastResult),this._raycastResult.reset(i,o),this._cannonRaycastResult.hasHit&&(this._raycastResult.setHitData({x:this._cannonRaycastResult.hitNormalWorld.x,y:this._cannonRaycastResult.hitNormalWorld.y,z:this._cannonRaycastResult.hitNormalWorld.z},{x:this._cannonRaycastResult.hitPointWorld.x,y:this._cannonRaycastResult.hitPointWorld.y,z:this._cannonRaycastResult.hitPointWorld.z}),this._raycastResult.setHitDistance(this._cannonRaycastResult.distance)),this._raycastResult},e}();O.a.DefaultPluginFactory=function(){return new l}},633:function(z,x,d){"use strict";d.d(x,"a",function(){return c});var v=d(503),T=d(510),M=d(544),m=d(436),y=d(440),O=d(609),c=function(){function l(e,i,o){e===void 0&&(e=!0),o===void 0&&(o=OIMO),this._useDeltaForWorldStep=e,this.name="OimoJSPlugin",this._fixedTimeStep=1/60,this._tmpImpostorsArray=[],this._tmpPositionVector=m.e.Zero(),this.BJSOIMO=o,this.world=new this.BJSOIMO.World({iterations:i}),this.world.clear(),this._raycastResult=new O.a}return l.prototype.setGravity=function(e){this.world.gravity.set(e.x,e.y,e.z)},l.prototype.setTimeStep=function(e){this.world.timeStep=e},l.prototype.getTimeStep=function(){return this.world.timeStep},l.prototype.executeStep=function(e,i){var o=this;i.forEach(function(r){r.beforeStep()}),this.world.timeStep=this._useDeltaForWorldStep?e:this._fixedTimeStep,this.world.step(),i.forEach(function(r){r.afterStep(),o._tmpImpostorsArray[r.uniqueId]=r});for(var n=this.world.contacts;n!==null;){if(n.touching&&!n.body1.sleeping&&!n.body2.sleeping){n=n.next;continue}var s=this._tmpImpostorsArray[+n.body1.name],t=this._tmpImpostorsArray[+n.body2.name];if(!s||!t){n=n.next;continue}s.onCollide({body:t.physicsBody,point:null}),t.onCollide({body:s.physicsBody,point:null}),n=n.next}},l.prototype.applyImpulse=function(e,i,o){var n=e.physicsBody.mass;e.physicsBody.applyImpulse(o.scale(this.world.invScale),i.scale(this.world.invScale*n))},l.prototype.applyForce=function(e,i,o){y.a.Warn("Oimo doesn't support applying force. Using impule instead."),this.applyImpulse(e,i,o)},l.prototype.generatePhysicsBody=function(e){var i=this;if(e.parent){e.physicsBody&&(this.removePhysicsBody(e),e.forceUpdate());return}if(e.isBodyInitRequired()){var o={name:e.uniqueId,config:[e.getParam("mass")||.001,e.getParam("friction"),e.getParam("restitution")],size:[],type:[],pos:[],posShape:[],rot:[],rotShape:[],move:e.getParam("mass")!==0,density:e.getParam("mass"),friction:e.getParam("friction"),restitution:e.getParam("restitution"),world:this.world},n=[e],s=function(a){!a.getChildMeshes||a.getChildMeshes().forEach(function(u){u.physicsImpostor&&n.push(u.physicsImpostor)})};s(e.object);var t=function(a){return Math.max(a,M.a.Epsilon)},r=new m.b;n.forEach(function(a){if(!!a.object.rotationQuaternion){var u=a.object.rotationQuaternion;r.copyFrom(u),a.object.rotationQuaternion.set(0,0,0,1),a.object.computeWorldMatrix(!0);var h=r.toEulerAngles(),f=a.getObjectExtendSize(),p=57.29577951308232;if(a===e){var _=e.getObjectCenter();e.object.getAbsolutePivotPoint().subtractToRef(_,i._tmpPositionVector),i._tmpPositionVector.divideInPlace(e.object.scaling),o.pos.push(_.x),o.pos.push(_.y),o.pos.push(_.z),o.posShape.push(0,0,0),o.rotShape.push(0,0,0)}else{var g=a.object.position.clone();o.posShape.push(g.x),o.posShape.push(g.y),o.posShape.push(g.z),o.rotShape.push(h.x*p,h.y*p,h.z*p)}switch(a.object.rotationQuaternion.copyFrom(r),a.type){case v.a.ParticleImpostor:y.a.Warn("No Particle support in OIMO.js. using SphereImpostor instead");case v.a.SphereImpostor:var P=f.x,E=f.y,R=f.z,b=Math.max(t(P),t(E),t(R))/2;o.type.push("sphere"),o.size.push(b),o.size.push(b),o.size.push(b);break;case v.a.CylinderImpostor:var C=t(f.x)/2,B=t(f.y);o.type.push("cylinder"),o.size.push(C),o.size.push(B),o.size.push(B);break;case v.a.PlaneImpostor:case v.a.BoxImpostor:default:var C=t(f.x),B=t(f.y),A=t(f.z);o.type.push("box"),o.size.push(C),o.size.push(B),o.size.push(A);break}a.object.rotationQuaternion=u}}),e.physicsBody=this.world.add(o),e.physicsBody.resetQuaternion(r),e.physicsBody.updatePosition(0)}else this._tmpPositionVector.copyFromFloats(0,0,0);e.setDeltaPosition(this._tmpPositionVector)},l.prototype.removePhysicsBody=function(e){this.world.removeRigidBody(e.physicsBody)},l.prototype.generateJoint=function(e){var i=e.mainImpostor.physicsBody,o=e.connectedImpostor.physicsBody;if(!(!i||!o)){var n=e.joint.jointData,s=n.nativeParams||{},t,r={body1:i,body2:o,axe1:s.axe1||(n.mainAxis?n.mainAxis.asArray():null),axe2:s.axe2||(n.connectedAxis?n.connectedAxis.asArray():null),pos1:s.pos1||(n.mainPivot?n.mainPivot.asArray():null),pos2:s.pos2||(n.connectedPivot?n.connectedPivot.asArray():null),min:s.min,max:s.max,collision:s.collision||n.collision,spring:s.spring,world:this.world};switch(e.joint.type){case T.e.BallAndSocketJoint:t="jointBall";break;case T.e.SpringJoint:y.a.Warn("OIMO.js doesn't support Spring Constraint. Simulating using DistanceJoint instead");var a=n;r.min=a.length||r.min,r.max=Math.max(r.min,r.max);case T.e.DistanceJoint:t="jointDistance",r.max=n.maxDistance;break;case T.e.PrismaticJoint:t="jointPrisme";break;case T.e.SliderJoint:t="jointSlide";break;case T.e.WheelJoint:t="jointWheel";break;case T.e.HingeJoint:default:t="jointHinge";break}r.type=t,e.joint.physicsJoint=this.world.add(r)}},l.prototype.removeJoint=function(e){try{this.world.removeJoint(e.joint.physicsJoint)}catch(i){y.a.Warn(i)}},l.prototype.isSupported=function(){return this.BJSOIMO!==void 0},l.prototype.setTransformationFromPhysicsBody=function(e){if(!e.physicsBody.sleeping){if(e.physicsBody.shapes.next){for(var i=e.physicsBody.shapes;i.next;)i=i.next;e.object.position.set(i.position.x,i.position.y,i.position.z)}else{var o=e.physicsBody.getPosition();e.object.position.set(o.x,o.y,o.z)}if(e.object.rotationQuaternion){var n=e.physicsBody.getQuaternion();e.object.rotationQuaternion.set(n.x,n.y,n.z,n.w)}}},l.prototype.setPhysicsBodyTransformation=function(e,i,o){var n=e.physicsBody;e.physicsBody.shapes.next||(n.position.set(i.x,i.y,i.z),n.orientation.set(o.x,o.y,o.z,o.w),n.syncShapes(),n.awake())},l.prototype.setLinearVelocity=function(e,i){e.physicsBody.linearVelocity.set(i.x,i.y,i.z)},l.prototype.setAngularVelocity=function(e,i){e.physicsBody.angularVelocity.set(i.x,i.y,i.z)},l.prototype.getLinearVelocity=function(e){var i=e.physicsBody.linearVelocity;return i?new m.e(i.x,i.y,i.z):null},l.prototype.getAngularVelocity=function(e){var i=e.physicsBody.angularVelocity;return i?new m.e(i.x,i.y,i.z):null},l.prototype.setBodyMass=function(e,i){var o=i===0;e.physicsBody.shapes.density=o?1:i,e.physicsBody.setupMass(o?2:1)},l.prototype.getBodyMass=function(e){return e.physicsBody.shapes.density},l.prototype.getBodyFriction=function(e){return e.physicsBody.shapes.friction},l.prototype.setBodyFriction=function(e,i){e.physicsBody.shapes.friction=i},l.prototype.getBodyRestitution=function(e){return e.physicsBody.shapes.restitution},l.prototype.setBodyRestitution=function(e,i){e.physicsBody.shapes.restitution=i},l.prototype.sleepBody=function(e){e.physicsBody.sleep()},l.prototype.wakeUpBody=function(e){e.physicsBody.awake()},l.prototype.updateDistanceJoint=function(e,i,o){e.physicsJoint.limitMotor.upperLimit=i,o!==void 0&&(e.physicsJoint.limitMotor.lowerLimit=o)},l.prototype.setMotor=function(e,i,o,n){o!==void 0?y.a.Warn("OimoJS plugin currently has unexpected behavior when using setMotor with force parameter"):o=1e6,i*=-1;var s=n?e.physicsJoint.rotationalLimitMotor2:e.physicsJoint.rotationalLimitMotor1||e.physicsJoint.rotationalLimitMotor||e.physicsJoint.limitMotor;s&&s.setMotor(i,o)},l.prototype.setLimit=function(e,i,o,n){var s=n?e.physicsJoint.rotationalLimitMotor2:e.physicsJoint.rotationalLimitMotor1||e.physicsJoint.rotationalLimitMotor||e.physicsJoint.limitMotor;s&&s.setLimit(i,o===void 0?-i:o)},l.prototype.syncMeshWithImpostor=function(e,i){var o=i.physicsBody;e.position.x=o.position.x,e.position.y=o.position.y,e.position.z=o.position.z,e.rotationQuaternion&&(e.rotationQuaternion.x=o.orientation.x,e.rotationQuaternion.y=o.orientation.y,e.rotationQuaternion.z=o.orientation.z,e.rotationQuaternion.w=o.orientation.s)},l.prototype.getRadius=function(e){return e.physicsBody.shapes.radius},l.prototype.getBoxSizeToRef=function(e,i){var o=e.physicsBody.shapes;i.x=o.halfWidth*2,i.y=o.halfHeight*2,i.z=o.halfDepth*2},l.prototype.dispose=function(){this.world.clear()},l.prototype.raycast=function(e,i){return y.a.Warn("raycast is not currently supported by the Oimo physics plugin"),this._raycastResult.reset(e,i),this._raycastResult},l}()},634:function(z,x,d){"use strict";d.d(x,"a",function(){return n});var v=d(436),T=d(440),M=d(503),m=d(510),y=d(447),O=d(485),c=d(617),l=d(493),e=d(609),i=d(450),o=d(515),n=function(){function s(t,r,a){var u=this;if(t===void 0&&(t=!0),r===void 0&&(r=Ammo),a===void 0&&(a=null),this._useDeltaForWorldStep=t,this.bjsAMMO={},this.name="AmmoJSPlugin",this._timeStep=1/60,this._fixedTimeStep=1/60,this._maxSteps=5,this._tmpQuaternion=new v.b,this._tmpContactCallbackResult=!1,this._tmpContactPoint=new v.e,this._tmpMatrix=new v.a,typeof r=="function"){T.a.Error("AmmoJS is not ready. Please make sure you await Ammo() before using the plugin.");return}else this.bjsAMMO=r;if(!this.isSupported()){T.a.Error("AmmoJS is not available. Please make sure you included the js file.");return}this._collisionConfiguration=new this.bjsAMMO.btSoftBodyRigidBodyCollisionConfiguration,this._dispatcher=new this.bjsAMMO.btCollisionDispatcher(this._collisionConfiguration),this._overlappingPairCache=a||new this.bjsAMMO.btDbvtBroadphase,this._solver=new this.bjsAMMO.btSequentialImpulseConstraintSolver,this._softBodySolver=new this.bjsAMMO.btDefaultSoftBodySolver,this.world=new this.bjsAMMO.btSoftRigidDynamicsWorld(this._dispatcher,this._overlappingPairCache,this._solver,this._collisionConfiguration,this._softBodySolver),this._tmpAmmoConcreteContactResultCallback=new this.bjsAMMO.ConcreteContactResultCallback,this._tmpAmmoConcreteContactResultCallback.addSingleResult=function(h,f,p,_){h=u.bjsAMMO.wrapPointer(h,Ammo.btManifoldPoint);var g=h.getPositionWorldOnA();u._tmpContactPoint.x=g.x(),u._tmpContactPoint.y=g.y(),u._tmpContactPoint.z=g.z(),u._tmpContactCallbackResult=!0},this._raycastResult=new e.a,this._tmpAmmoTransform=new this.bjsAMMO.btTransform,this._tmpAmmoTransform.setIdentity(),this._tmpAmmoQuaternion=new this.bjsAMMO.btQuaternion(0,0,0,1),this._tmpAmmoVectorA=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorB=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorC=new this.bjsAMMO.btVector3(0,0,0),this._tmpAmmoVectorD=new this.bjsAMMO.btVector3(0,0,0)}return s.prototype.setGravity=function(t){this._tmpAmmoVectorA.setValue(t.x,t.y,t.z),this.world.setGravity(this._tmpAmmoVectorA),this.world.getWorldInfo().set_m_gravity(this._tmpAmmoVectorA)},s.prototype.setTimeStep=function(t){this._timeStep=t},s.prototype.setFixedTimeStep=function(t){this._fixedTimeStep=t},s.prototype.setMaxSteps=function(t){this._maxSteps=t},s.prototype.getTimeStep=function(){return this._timeStep},s.prototype._isImpostorInContact=function(t){return this._tmpContactCallbackResult=!1,this.world.contactTest(t.physicsBody,this._tmpAmmoConcreteContactResultCallback),this._tmpContactCallbackResult},s.prototype._isImpostorPairInContact=function(t,r){return this._tmpContactCallbackResult=!1,this.world.contactPairTest(t.physicsBody,r.physicsBody,this._tmpAmmoConcreteContactResultCallback),this._tmpContactCallbackResult},s.prototype._stepSimulation=function(t,r,a){if(t===void 0&&(t=1/60),r===void 0&&(r=10),a===void 0&&(a=1/60),r==0)this.world.stepSimulation(t,0);else for(;r>0&&t>0;)t-a<a?(this.world.stepSimulation(t,0),t=0):(t-=a,this.world.stepSimulation(a,0)),r--},s.prototype.executeStep=function(t,r){for(var a=0,u=r;a<u.length;a++){var h=u[a];h.soft||h.beforeStep()}this._stepSimulation(this._useDeltaForWorldStep?t:this._timeStep,this._maxSteps,this._fixedTimeStep);for(var f=0,p=r;f<p.length;f++){var _=p[f];if(_.soft?this._afterSoftStep(_):_.afterStep(),_._onPhysicsCollideCallbacks.length>0&&this._isImpostorInContact(_))for(var g=0,P=_._onPhysicsCollideCallbacks;g<P.length;g++)for(var E=P[g],R=0,b=E.otherImpostors;R<b.length;R++){var C=b[R];(_.physicsBody.isActive()||C.physicsBody.isActive())&&this._isImpostorPairInContact(_,C)&&(_.onCollide({body:C.physicsBody,point:this._tmpContactPoint}),C.onCollide({body:_.physicsBody,point:this._tmpContactPoint}))}}},s.prototype._afterSoftStep=function(t){t.type===M.a.RopeImpostor?this._ropeStep(t):this._softbodyOrClothStep(t)},s.prototype._ropeStep=function(t){for(var r=t.physicsBody.get_m_nodes(),a=r.size(),u,h,f,p,_,g=new Array,P=0;P<a;P++)u=r.at(P),h=u.get_m_x(),f=h.x(),p=h.y(),_=h.z(),g.push(new v.e(f,p,_));var E=t.object,R=t.getParam("shape");t._isFromLine?t.object=l.a.CreateLines("lines",{points:g,instance:E}):t.object=c.a.ExtrudeShape("ext",{shape:R,path:g,instance:E})},s.prototype._softbodyOrClothStep=function(t){var r=t.type===M.a.ClothImpostor?1:-1,a=t.object,u=a.getVerticesData(y.b.PositionKind);u||(u=[]);var h=a.getVerticesData(y.b.NormalKind);h||(h=[]);for(var f=u.length/3,p=t.physicsBody.get_m_nodes(),_,g,P,E,R,b,C,B,A,F=0;F<f;F++){_=p.at(F),g=_.get_m_x(),E=g.x(),R=g.y(),b=g.z()*r;var P=_.get_m_n();C=P.x(),B=P.y(),A=P.z()*r,u[3*F]=E,u[3*F+1]=R,u[3*F+2]=b,h[3*F]=C,h[3*F+1]=B,h[3*F+2]=A}var N=new O.a;N.positions=u,N.normals=h,N.uvs=a.getVerticesData(y.b.UVKind),N.colors=a.getVerticesData(y.b.ColorKind),a&&a.getIndices&&(N.indices=a.getIndices()),N.applyToMesh(a)},s.prototype.applyImpulse=function(t,r,a){if(t.soft)T.a.Warn("Cannot be applied to a soft body");else{t.physicsBody.activate();var u=this._tmpAmmoVectorA,h=this._tmpAmmoVectorB;t.object&&t.object.getWorldMatrix&&a.subtractInPlace(t.object.getWorldMatrix().getTranslation()),u.setValue(a.x,a.y,a.z),h.setValue(r.x,r.y,r.z),t.physicsBody.applyImpulse(h,u)}},s.prototype.applyForce=function(t,r,a){if(t.soft)T.a.Warn("Cannot be applied to a soft body");else{t.physicsBody.activate();var u=this._tmpAmmoVectorA,h=this._tmpAmmoVectorB;if(u.setValue(a.x,a.y,a.z),t.object&&t.object.getWorldMatrix){var f=t.object.getWorldMatrix().getTranslation();u.x-=f.x,u.y-=f.y,u.z-=f.z}h.setValue(r.x,r.y,r.z),t.physicsBody.applyForce(h,u)}},s.prototype.generatePhysicsBody=function(t){if(t._pluginData.toDispose=[],t.parent){t.physicsBody&&(this.removePhysicsBody(t),t.forceUpdate());return}if(t.isBodyInitRequired()){var r=this._createShape(t),a=t.getParam("mass");if(t._pluginData.mass=a,t.soft)r.get_m_cfg().set_collisions(17),r.get_m_cfg().set_kDP(t.getParam("damping")),this.bjsAMMO.castObject(r,this.bjsAMMO.btCollisionObject).getCollisionShape().setMargin(t.getParam("margin")),r.setActivationState(s.DISABLE_DEACTIVATION_FLAG),this.world.addSoftBody(r,1,-1),t.physicsBody=r,t._pluginData.toDispose.push(r),this.setBodyPressure(t,0),t.type===M.a.SoftbodyImpostor&&this.setBodyPressure(t,t.getParam("pressure")),this.setBodyStiffness(t,t.getParam("stiffness")),this.setBodyVelocityIterations(t,t.getParam("velocityIterations")),this.setBodyPositionIterations(t,t.getParam("positionIterations"));else{var u=new this.bjsAMMO.btVector3(0,0,0),h=new this.bjsAMMO.btTransform;h.setIdentity(),a!==0&&r.calculateLocalInertia(a,u),this._tmpAmmoVectorA.setValue(t.object.position.x,t.object.position.y,t.object.position.z),this._tmpAmmoQuaternion.setValue(t.object.rotationQuaternion.x,t.object.rotationQuaternion.y,t.object.rotationQuaternion.z,t.object.rotationQuaternion.w),h.setOrigin(this._tmpAmmoVectorA),h.setRotation(this._tmpAmmoQuaternion);var f=new this.bjsAMMO.btDefaultMotionState(h),p=new this.bjsAMMO.btRigidBodyConstructionInfo(a,f,r,u),_=new this.bjsAMMO.btRigidBody(p);a===0&&(_.setCollisionFlags(_.getCollisionFlags()|s.KINEMATIC_FLAG),_.setActivationState(s.DISABLE_DEACTIVATION_FLAG)),t.type==M.a.NoImpostor&&!r.getChildShape&&_.setCollisionFlags(_.getCollisionFlags()|s.DISABLE_COLLISION_FLAG);var g=t.getParam("group"),P=t.getParam("mask");g&&P?this.world.addRigidBody(_,g,P):this.world.addRigidBody(_),t.physicsBody=_,t._pluginData.toDispose=t._pluginData.toDispose.concat([_,p,f,h,u,r])}this.setBodyRestitution(t,t.getParam("restitution")),this.setBodyFriction(t,t.getParam("friction"))}},s.prototype.removePhysicsBody=function(t){var r=this;this.world&&(t.soft?this.world.removeSoftBody(t.physicsBody):this.world.removeRigidBody(t.physicsBody),t._pluginData&&(t._pluginData.toDispose.forEach(function(a){r.bjsAMMO.destroy(a)}),t._pluginData.toDispose=[]))},s.prototype.generateJoint=function(t){var r=t.mainImpostor.physicsBody,a=t.connectedImpostor.physicsBody;if(!(!r||!a)){var u=t.joint.jointData;u.mainPivot||(u.mainPivot=new v.e(0,0,0)),u.connectedPivot||(u.connectedPivot=new v.e(0,0,0));var h;switch(t.joint.type){case m.e.DistanceJoint:var f=u.maxDistance;f&&(u.mainPivot=new v.e(0,-f/2,0),u.connectedPivot=new v.e(0,f/2,0)),h=new this.bjsAMMO.btPoint2PointConstraint(r,a,new this.bjsAMMO.btVector3(u.mainPivot.x,u.mainPivot.y,u.mainPivot.z),new this.bjsAMMO.btVector3(u.connectedPivot.x,u.connectedPivot.y,u.connectedPivot.z));break;case m.e.HingeJoint:u.mainAxis||(u.mainAxis=new v.e(0,0,0)),u.connectedAxis||(u.connectedAxis=new v.e(0,0,0));var p=new this.bjsAMMO.btVector3(u.mainAxis.x,u.mainAxis.y,u.mainAxis.z),_=new this.bjsAMMO.btVector3(u.connectedAxis.x,u.connectedAxis.y,u.connectedAxis.z);h=new this.bjsAMMO.btHingeConstraint(r,a,new this.bjsAMMO.btVector3(u.mainPivot.x,u.mainPivot.y,u.mainPivot.z),new this.bjsAMMO.btVector3(u.connectedPivot.x,u.connectedPivot.y,u.connectedPivot.z),p,_);break;case m.e.BallAndSocketJoint:h=new this.bjsAMMO.btPoint2PointConstraint(r,a,new this.bjsAMMO.btVector3(u.mainPivot.x,u.mainPivot.y,u.mainPivot.z),new this.bjsAMMO.btVector3(u.connectedPivot.x,u.connectedPivot.y,u.connectedPivot.z));break;default:T.a.Warn("JointType not currently supported by the Ammo plugin, falling back to PhysicsJoint.BallAndSocketJoint"),h=new this.bjsAMMO.btPoint2PointConstraint(r,a,new this.bjsAMMO.btVector3(u.mainPivot.x,u.mainPivot.y,u.mainPivot.z),new this.bjsAMMO.btVector3(u.connectedPivot.x,u.connectedPivot.y,u.connectedPivot.z));break}this.world.addConstraint(h,!t.joint.jointData.collision),t.joint.physicsJoint=h}},s.prototype.removeJoint=function(t){this.world&&this.world.removeConstraint(t.joint.physicsJoint)},s.prototype._addMeshVerts=function(t,r,a){var u=this,h=0;if(a&&a.getIndices&&a.getWorldMatrix&&a.getChildMeshes){var f=a.getIndices();f||(f=[]);var p=a.getVerticesData(y.b.PositionKind);p||(p=[]),a.computeWorldMatrix(!1);for(var _=f.length/3,g=0;g<_;g++){for(var P=[],E=0;E<3;E++){var R=new v.e(p[f[g*3+E]*3+0],p[f[g*3+E]*3+1],p[f[g*3+E]*3+2]);v.a.ScalingToRef(a.scaling.x,a.scaling.y,a.scaling.z,this._tmpMatrix),R=v.e.TransformCoordinates(R,this._tmpMatrix);var b;E==0?b=this._tmpAmmoVectorA:E==1?b=this._tmpAmmoVectorB:b=this._tmpAmmoVectorC,b.setValue(R.x,R.y,R.z),P.push(b)}t.addTriangle(P[0],P[1],P[2]),h++}a.getChildMeshes().forEach(function(C){h+=u._addMeshVerts(t,r,C)})}return h},s.prototype._softVertexData=function(t){var r=t.object;if(r&&r.getIndices&&r.getWorldMatrix&&r.getChildMeshes){var a=r.getIndices();a||(a=[]);var u=r.getVerticesData(y.b.PositionKind);u||(u=[]);var h=r.getVerticesData(y.b.NormalKind);h||(h=[]),r.computeWorldMatrix(!1);for(var f=[],p=[],_=0;_<u.length;_+=3){var g=new v.e(u[_],u[_+1],u[_+2]),P=new v.e(h[_],h[_+1],h[_+2]);g=v.e.TransformCoordinates(g,r.getWorldMatrix()),P=v.e.TransformNormal(P,r.getWorldMatrix()),f.push(g.x,g.y,g.z),p.push(P.x,P.y,P.z)}var E=new O.a;return E.positions=f,E.normals=p,E.uvs=r.getVerticesData(y.b.UVKind),E.colors=r.getVerticesData(y.b.ColorKind),r&&r.getIndices&&(E.indices=r.getIndices()),E.applyToMesh(r),r.position=v.e.Zero(),r.rotationQuaternion=null,r.rotation=v.e.Zero(),r.computeWorldMatrix(!0),E}return O.a.ExtractFromMesh(r)},s.prototype._createSoftbody=function(t){var r=t.object;if(r&&r.getIndices){var a=r.getIndices();a||(a=[]);var u=this._softVertexData(t),h=u.positions,f=u.normals;if(h===null||f===null)return new this.bjsAMMO.btCompoundShape;for(var p=[],_=[],g=0;g<h.length;g+=3){var P=new v.e(h[g],h[g+1],h[g+2]),E=new v.e(f[g],f[g+1],f[g+2]);p.push(P.x,P.y,-P.z),_.push(E.x,E.y,-E.z)}for(var R=new this.bjsAMMO.btSoftBodyHelpers().CreateFromTriMesh(this.world.getWorldInfo(),p,r.getIndices(),a.length/3,!0),b=h.length/3,C=R.get_m_nodes(),B,A,g=0;g<b;g++){B=C.at(g);var A=B.get_m_n();A.setX(_[3*g]),A.setY(_[3*g+1]),A.setZ(_[3*g+2])}return R}},s.prototype._createCloth=function(t){var r=t.object;if(r&&r.getIndices){var a=r.getIndices();a||(a=[]);var u=this._softVertexData(t),h=u.positions,f=u.normals;if(h===null||f===null)return new this.bjsAMMO.btCompoundShape;var p=h.length,_=Math.sqrt(p/3);t.segments=_;var g=_-1;this._tmpAmmoVectorA.setValue(h[0],h[1],h[2]),this._tmpAmmoVectorB.setValue(h[3*g],h[3*g+1],h[3*g+2]),this._tmpAmmoVectorD.setValue(h[p-3],h[p-2],h[p-1]),this._tmpAmmoVectorC.setValue(h[p-3-3*g],h[p-2-3*g],h[p-1-3*g]);var P=new this.bjsAMMO.btSoftBodyHelpers().CreatePatch(this.world.getWorldInfo(),this._tmpAmmoVectorA,this._tmpAmmoVectorB,this._tmpAmmoVectorC,this._tmpAmmoVectorD,_,_,t.getParam("fixedPoints"),!0);return P}},s.prototype._createRope=function(t){var r,a,u=this._softVertexData(t),h=u.positions,f=u.normals;if(h===null||f===null)return new this.bjsAMMO.btCompoundShape;u.applyToMesh(t.object,!0),t._isFromLine=!0;var p=f.map(function(C){return C*C}),_=function(C,B){return C+B},g=p.reduce(_);if(g===0)r=h.length,a=r/3-1,this._tmpAmmoVectorA.setValue(h[0],h[1],h[2]),this._tmpAmmoVectorB.setValue(h[r-3],h[r-2],h[r-1]);else{t._isFromLine=!1;var P=t.getParam("path"),E=t.getParam("shape");if(E===null)return T.a.Warn("No shape available for extruded mesh"),new this.bjsAMMO.btCompoundShape;r=P.length,a=r-1,this._tmpAmmoVectorA.setValue(P[0].x,P[0].y,P[0].z),this._tmpAmmoVectorB.setValue(P[r-1].x,P[r-1].y,P[r-1].z)}t.segments=a;var R=t.getParam("fixedPoints");R=R>3?3:R;var b=new this.bjsAMMO.btSoftBodyHelpers().CreateRope(this.world.getWorldInfo(),this._tmpAmmoVectorA,this._tmpAmmoVectorB,a-1,R);return b.get_m_cfg().set_collisions(17),b},s.prototype._createCustom=function(t){var r=null;return this.onCreateCustomShape&&(r=this.onCreateCustomShape(t)),r==null&&(r=new this.bjsAMMO.btCompoundShape),r},s.prototype._addHullVerts=function(t,r,a){var u=this,h=0;if(a&&a.getIndices&&a.getWorldMatrix&&a.getChildMeshes){var f=a.getIndices();f||(f=[]);var p=a.getVerticesData(y.b.PositionKind);p||(p=[]),a.computeWorldMatrix(!1);for(var _=f.length/3,g=0;g<_;g++){for(var P=[],E=0;E<3;E++){var R=new v.e(p[f[g*3+E]*3+0],p[f[g*3+E]*3+1],p[f[g*3+E]*3+2]);v.a.ScalingToRef(a.scaling.x,a.scaling.y,a.scaling.z,this._tmpMatrix),R=v.e.TransformCoordinates(R,this._tmpMatrix);var b;E==0?b=this._tmpAmmoVectorA:E==1?b=this._tmpAmmoVectorB:b=this._tmpAmmoVectorC,b.setValue(R.x,R.y,R.z),P.push(b)}t.addPoint(P[0],!0),t.addPoint(P[1],!0),t.addPoint(P[2],!0),h++}a.getChildMeshes().forEach(function(C){h+=u._addHullVerts(t,r,C)})}return h},s.prototype._createShape=function(t,r){var a=this;r===void 0&&(r=!1);var u=t.object,h,f=t.getObjectExtendSize();if(!r){var p=t.object.getChildMeshes?t.object.getChildMeshes(!0):[];h=new this.bjsAMMO.btCompoundShape;var _=0;if(p.forEach(function(A){var F=A.getPhysicsImpostor();if(F){if(F.type==M.a.MeshImpostor)throw"A child MeshImpostor is not supported. Only primitive impostors are supported as children (eg. box or sphere)";var N=a._createShape(F),w=A.parent.getWorldMatrix().clone(),U=new v.e;w.decompose(U),a._tmpAmmoTransform.getOrigin().setValue(A.position.x*U.x,A.position.y*U.y,A.position.z*U.z),a._tmpAmmoQuaternion.setValue(A.rotationQuaternion.x,A.rotationQuaternion.y,A.rotationQuaternion.z,A.rotationQuaternion.w),a._tmpAmmoTransform.setRotation(a._tmpAmmoQuaternion),h.addChildShape(a._tmpAmmoTransform,N),F.dispose(),_++}}),_>0){if(t.type!=M.a.NoImpostor){var g=this._createShape(t,!0);g&&(this._tmpAmmoTransform.getOrigin().setValue(0,0,0),this._tmpAmmoQuaternion.setValue(0,0,0,1),this._tmpAmmoTransform.setRotation(this._tmpAmmoQuaternion),h.addChildShape(this._tmpAmmoTransform,g))}return h}else this.bjsAMMO.destroy(h),h=null}switch(t.type){case M.a.SphereImpostor:if(i.a.WithinEpsilon(f.x,f.y,1e-4)&&i.a.WithinEpsilon(f.x,f.z,1e-4))h=new this.bjsAMMO.btSphereShape(f.x/2);else{var P=[new this.bjsAMMO.btVector3(0,0,0)],E=[1];h=new this.bjsAMMO.btMultiSphereShape(P,E,1),h.setLocalScaling(new this.bjsAMMO.btVector3(f.x/2,f.y/2,f.z/2))}break;case M.a.CapsuleImpostor:var R=f.x/2;h=new this.bjsAMMO.btCapsuleShape(R,f.y-R*2);break;case M.a.CylinderImpostor:this._tmpAmmoVectorA.setValue(f.x/2,f.y/2,f.z/2),h=new this.bjsAMMO.btCylinderShape(this._tmpAmmoVectorA);break;case M.a.PlaneImpostor:case M.a.BoxImpostor:this._tmpAmmoVectorA.setValue(f.x/2,f.y/2,f.z/2),h=new this.bjsAMMO.btBoxShape(this._tmpAmmoVectorA);break;case M.a.MeshImpostor:if(t.getParam("mass")==0){var b=new this.bjsAMMO.btTriangleMesh;t._pluginData.toDispose.push(b);var B=this._addMeshVerts(b,u,u);B==0?h=new this.bjsAMMO.btCompoundShape:h=new this.bjsAMMO.btBvhTriangleMeshShape(b);break}case M.a.ConvexHullImpostor:var C=new this.bjsAMMO.btConvexHullShape,B=this._addHullVerts(C,u,u);B==0?(t._pluginData.toDispose.push(C),h=new this.bjsAMMO.btCompoundShape):h=C;break;case M.a.NoImpostor:h=new this.bjsAMMO.btSphereShape(f.x/2);break;case M.a.CustomImpostor:h=this._createCustom(t);break;case M.a.SoftbodyImpostor:h=this._createSoftbody(t);break;case M.a.ClothImpostor:h=this._createCloth(t);break;case M.a.RopeImpostor:h=this._createRope(t);break;default:T.a.Warn("The impostor type is not currently supported by the ammo plugin.");break}return h},s.prototype.setTransformationFromPhysicsBody=function(t){t.physicsBody.getMotionState().getWorldTransform(this._tmpAmmoTransform),t.object.position.set(this._tmpAmmoTransform.getOrigin().x(),this._tmpAmmoTransform.getOrigin().y(),this._tmpAmmoTransform.getOrigin().z()),t.object.rotationQuaternion?t.object.rotationQuaternion.set(this._tmpAmmoTransform.getRotation().x(),this._tmpAmmoTransform.getRotation().y(),this._tmpAmmoTransform.getRotation().z(),this._tmpAmmoTransform.getRotation().w()):t.object.rotation&&(this._tmpQuaternion.set(this._tmpAmmoTransform.getRotation().x(),this._tmpAmmoTransform.getRotation().y(),this._tmpAmmoTransform.getRotation().z(),this._tmpAmmoTransform.getRotation().w()),this._tmpQuaternion.toEulerAnglesToRef(t.object.rotation))},s.prototype.setPhysicsBodyTransformation=function(t,r,a){var u=t.physicsBody.getWorldTransform();if(Math.abs(u.getOrigin().x()-r.x)>o.a||Math.abs(u.getOrigin().y()-r.y)>o.a||Math.abs(u.getOrigin().z()-r.z)>o.a||Math.abs(u.getRotation().x()-a.x)>o.a||Math.abs(u.getRotation().y()-a.y)>o.a||Math.abs(u.getRotation().z()-a.z)>o.a||Math.abs(u.getRotation().w()-a.w)>o.a)if(this._tmpAmmoVectorA.setValue(r.x,r.y,r.z),u.setOrigin(this._tmpAmmoVectorA),this._tmpAmmoQuaternion.setValue(a.x,a.y,a.z,a.w),u.setRotation(this._tmpAmmoQuaternion),t.physicsBody.setWorldTransform(u),t.mass==0){var h=t.physicsBody.getMotionState();h&&h.setWorldTransform(u)}else t.physicsBody.activate()},s.prototype.isSupported=function(){return this.bjsAMMO!==void 0},s.prototype.setLinearVelocity=function(t,r){this._tmpAmmoVectorA.setValue(r.x,r.y,r.z),t.soft?t.physicsBody.linearVelocity(this._tmpAmmoVectorA):t.physicsBody.setLinearVelocity(this._tmpAmmoVectorA)},s.prototype.setAngularVelocity=function(t,r){this._tmpAmmoVectorA.setValue(r.x,r.y,r.z),t.soft?t.physicsBody.angularVelocity(this._tmpAmmoVectorA):t.physicsBody.setAngularVelocity(this._tmpAmmoVectorA)},s.prototype.getLinearVelocity=function(t){if(t.soft)var r=t.physicsBody.linearVelocity();else var r=t.physicsBody.getLinearVelocity();if(!r)return null;var a=new v.e(r.x(),r.y(),r.z());return this.bjsAMMO.destroy(r),a},s.prototype.getAngularVelocity=function(t){if(t.soft)var r=t.physicsBody.angularVelocity();else var r=t.physicsBody.getAngularVelocity();if(!r)return null;var a=new v.e(r.x(),r.y(),r.z());return this.bjsAMMO.destroy(r),a},s.prototype.setBodyMass=function(t,r){t.soft?t.physicsBody.setTotalMass(r,!1):t.physicsBody.setMassProps(r),t._pluginData.mass=r},s.prototype.getBodyMass=function(t){return t._pluginData.mass||0},s.prototype.getBodyFriction=function(t){return t._pluginData.friction||0},s.prototype.setBodyFriction=function(t,r){t.soft?t.physicsBody.get_m_cfg().set_kDF(r):t.physicsBody.setFriction(r),t._pluginData.friction=r},s.prototype.getBodyRestitution=function(t){return t._pluginData.restitution||0},s.prototype.setBodyRestitution=function(t,r){t.physicsBody.setRestitution(r),t._pluginData.restitution=r},s.prototype.getBodyPressure=function(t){return t.soft?t._pluginData.pressure||0:(T.a.Warn("Pressure is not a property of a rigid body"),0)},s.prototype.setBodyPressure=function(t,r){t.soft?t.type===M.a.SoftbodyImpostor?(t.physicsBody.get_m_cfg().set_kPR(r),t._pluginData.pressure=r):(t.physicsBody.get_m_cfg().set_kPR(0),t._pluginData.pressure=0):T.a.Warn("Pressure can only be applied to a softbody")},s.prototype.getBodyStiffness=function(t){return t.soft?t._pluginData.stiffness||0:(T.a.Warn("Stiffness is not a property of a rigid body"),0)},s.prototype.setBodyStiffness=function(t,r){t.soft?(r=r<0?0:r,r=r>1?1:r,t.physicsBody.get_m_materials().at(0).set_m_kLST(r),t._pluginData.stiffness=r):T.a.Warn("Stiffness cannot be applied to a rigid body")},s.prototype.getBodyVelocityIterations=function(t){return t.soft?t._pluginData.velocityIterations||0:(T.a.Warn("Velocity iterations is not a property of a rigid body"),0)},s.prototype.setBodyVelocityIterations=function(t,r){t.soft?(r=r<0?0:r,t.physicsBody.get_m_cfg().set_viterations(r),t._pluginData.velocityIterations=r):T.a.Warn("Velocity iterations cannot be applied to a rigid body")},s.prototype.getBodyPositionIterations=function(t){return t.soft?t._pluginData.positionIterations||0:(T.a.Warn("Position iterations is not a property of a rigid body"),0)},s.prototype.setBodyPositionIterations=function(t,r){t.soft?(r=r<0?0:r,t.physicsBody.get_m_cfg().set_piterations(r),t._pluginData.positionIterations=r):T.a.Warn("Position iterations cannot be applied to a rigid body")},s.prototype.appendAnchor=function(t,r,a,u,h,f){h===void 0&&(h=1),f===void 0&&(f=!1);var p=t.segments,_=Math.round((p-1)*a),g=Math.round((p-1)*u),P=p-1-g,E=_+p*P;t.physicsBody.appendAnchor(E,r.physicsBody,f,h)},s.prototype.appendHook=function(t,r,a,u,h){u===void 0&&(u=1),h===void 0&&(h=!1);var f=Math.round(t.segments*a);t.physicsBody.appendAnchor(f,r.physicsBody,h,u)},s.prototype.sleepBody=function(t){T.a.Warn("sleepBody is not currently supported by the Ammo physics plugin")},s.prototype.wakeUpBody=function(t){t.physicsBody.activate()},s.prototype.updateDistanceJoint=function(t,r,a){T.a.Warn("updateDistanceJoint is not currently supported by the Ammo physics plugin")},s.prototype.setMotor=function(t,r,a,u){t.physicsJoint.enableAngularMotor(!0,r,a)},s.prototype.setLimit=function(t,r,a){T.a.Warn("setLimit is not currently supported by the Ammo physics plugin")},s.prototype.syncMeshWithImpostor=function(t,r){var a=r.physicsBody;a.getMotionState().getWorldTransform(this._tmpAmmoTransform),t.position.x=this._tmpAmmoTransform.getOrigin().x(),t.position.y=this._tmpAmmoTransform.getOrigin().y(),t.position.z=this._tmpAmmoTransform.getOrigin().z(),t.rotationQuaternion&&(t.rotationQuaternion.x=this._tmpAmmoTransform.getRotation().x(),t.rotationQuaternion.y=this._tmpAmmoTransform.getRotation().y(),t.rotationQuaternion.z=this._tmpAmmoTransform.getRotation().z(),t.rotationQuaternion.w=this._tmpAmmoTransform.getRotation().w())},s.prototype.getRadius=function(t){var r=t.getObjectExtendSize();return r.x/2},s.prototype.getBoxSizeToRef=function(t,r){var a=t.getObjectExtendSize();r.x=a.x,r.y=a.y,r.z=a.z},s.prototype.dispose=function(){this.bjsAMMO.destroy(this.world),this.bjsAMMO.destroy(this._solver),this.bjsAMMO.destroy(this._overlappingPairCache),this.bjsAMMO.destroy(this._dispatcher),this.bjsAMMO.destroy(this._collisionConfiguration),this.bjsAMMO.destroy(this._tmpAmmoVectorA),this.bjsAMMO.destroy(this._tmpAmmoVectorB),this.bjsAMMO.destroy(this._tmpAmmoVectorC),this.bjsAMMO.destroy(this._tmpAmmoTransform),this.bjsAMMO.destroy(this._tmpAmmoQuaternion),this.bjsAMMO.destroy(this._tmpAmmoConcreteContactResultCallback),this.world=null},s.prototype.raycast=function(t,r){this._tmpAmmoVectorRCA=new this.bjsAMMO.btVector3(t.x,t.y,t.z),this._tmpAmmoVectorRCB=new this.bjsAMMO.btVector3(r.x,r.y,r.z);var a=new this.bjsAMMO.ClosestRayResultCallback(this._tmpAmmoVectorRCA,this._tmpAmmoVectorRCB);return this.world.rayTest(this._tmpAmmoVectorRCA,this._tmpAmmoVectorRCB,a),this._raycastResult.reset(t,r),a.hasHit()&&(this._raycastResult.setHitData({x:a.get_m_hitNormalWorld().x(),y:a.get_m_hitNormalWorld().y(),z:a.get_m_hitNormalWorld().z()},{x:a.get_m_hitPointWorld().x(),y:a.get_m_hitPointWorld().y(),z:a.get_m_hitPointWorld().z()}),this._raycastResult.calculateHitDistance()),this.bjsAMMO.destroy(a),this.bjsAMMO.destroy(this._tmpAmmoVectorRCA),this.bjsAMMO.destroy(this._tmpAmmoVectorRCB),this._raycastResult},s.DISABLE_COLLISION_FLAG=4,s.KINEMATIC_FLAG=2,s.DISABLE_DEACTIVATION_FLAG=4,s}()},635:function(z,x,d){"use strict";d.d(x,"a",function(){return O});var v=d(434),T=d(439),M=d(458),m=d(436),y=d(468);y.a.prototype.removeReflectionProbe=function(c){if(!this.reflectionProbes)return-1;var l=this.reflectionProbes.indexOf(c);return l!==-1&&this.reflectionProbes.splice(l,1),l},y.a.prototype.addReflectionProbe=function(c){this.reflectionProbes||(this.reflectionProbes=[]),this.reflectionProbes.push(c)};var O=function(){function c(l,e,i,o,n,s){var t=this;o===void 0&&(o=!0),n===void 0&&(n=!1),s===void 0&&(s=!1),this.name=l,this._viewMatrix=m.a.Identity(),this._target=m.e.Zero(),this._add=m.e.Zero(),this._invertYAxis=!1,this.position=m.e.Zero(),this._scene=i,this._scene.reflectionProbes||(this._scene.reflectionProbes=new Array),this._scene.reflectionProbes.push(this);var r=0;if(n){var a=this._scene.getEngine().getCaps();a.textureHalfFloatRender?r=2:a.textureFloatRender&&(r=1)}this._renderTargetTexture=new M.a(l,e,i,o,!0,r,!0),this._renderTargetTexture.gammaSpace=!s,this._renderTargetTexture.onBeforeRenderObservable.add(function(h){switch(h){case 0:t._add.copyFromFloats(1,0,0);break;case 1:t._add.copyFromFloats(-1,0,0);break;case 2:t._add.copyFromFloats(0,t._invertYAxis?1:-1,0);break;case 3:t._add.copyFromFloats(0,t._invertYAxis?-1:1,0);break;case 4:t._add.copyFromFloats(0,0,i.useRightHandedSystem?-1:1);break;case 5:t._add.copyFromFloats(0,0,i.useRightHandedSystem?1:-1);break}t._attachedMesh&&t.position.copyFrom(t._attachedMesh.getAbsolutePosition()),t.position.addToRef(t._add,t._target),i.useRightHandedSystem?(m.a.LookAtRHToRef(t.position,t._target,m.e.Up(),t._viewMatrix),i.activeCamera&&(t._projectionMatrix=m.a.PerspectiveFovRH(Math.PI/2,1,i.activeCamera.minZ,i.activeCamera.maxZ),i.setTransformMatrix(t._viewMatrix,t._projectionMatrix))):(m.a.LookAtLHToRef(t.position,t._target,m.e.Up(),t._viewMatrix),i.activeCamera&&(t._projectionMatrix=m.a.PerspectiveFovLH(Math.PI/2,1,i.activeCamera.minZ,i.activeCamera.maxZ),i.setTransformMatrix(t._viewMatrix,t._projectionMatrix))),i._forcedViewPosition=t.position});var u;this._renderTargetTexture.onBeforeBindObservable.add(function(){i.getEngine()._debugPushGroup("reflection probe generation for "+l,1),u=t._scene.imageProcessingConfiguration.applyByPostProcess,s&&(i.imageProcessingConfiguration.applyByPostProcess=!0)}),this._renderTargetTexture.onAfterUnbindObservable.add(function(){i.imageProcessingConfiguration.applyByPostProcess=u,i._forcedViewPosition=null,i.updateTransformMatrix(!0),i.getEngine()._debugPopGroup(1)})}return Object.defineProperty(c.prototype,"samples",{get:function(){return this._renderTargetTexture.samples},set:function(l){this._renderTargetTexture.samples=l},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"refreshRate",{get:function(){return this._renderTargetTexture.refreshRate},set:function(l){this._renderTargetTexture.refreshRate=l},enumerable:!1,configurable:!0}),c.prototype.getScene=function(){return this._scene},Object.defineProperty(c.prototype,"cubeTexture",{get:function(){return this._renderTargetTexture},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"renderList",{get:function(){return this._renderTargetTexture.renderList},enumerable:!1,configurable:!0}),c.prototype.attachToMesh=function(l){this._attachedMesh=l},c.prototype.setRenderingAutoClearDepthStencil=function(l,e){this._renderTargetTexture.setRenderingAutoClearDepthStencil(l,e)},c.prototype.dispose=function(){var l=this._scene.reflectionProbes.indexOf(this);l!==-1&&this._scene.reflectionProbes.splice(l,1),this._renderTargetTexture&&(this._renderTargetTexture.dispose(),this._renderTargetTexture=null)},c.prototype.toString=function(l){var e="Name: "+this.name;return l&&(e+=", position: "+this.position.toString(),this._attachedMesh&&(e+=", attached mesh: "+this._attachedMesh.name)),e},c.prototype.getClassName=function(){return"ReflectionProbe"},c.prototype.serialize=function(){var l=T.a.Serialize(this,this._renderTargetTexture.serialize());return l.isReflectionProbe=!0,l},c.Parse=function(l,e,i){var o=null;if(e.reflectionProbes)for(var n=0;n<e.reflectionProbes.length;n++){var s=e.reflectionProbes[n];if(s.name===l.name){o=s;break}}return o=T.a.Parse(function(){return o||new c(l.name,l.renderTargetSize,e,l._generateMipMaps)},l,e,i),o.cubeTexture._waitingRenderList=l.renderList,l._attachedMesh&&o.attachToMesh(e.getMeshByID(l._attachedMesh)),o},Object(v.c)([Object(T.k)()],c.prototype,"_attachedMesh",void 0),Object(v.c)([Object(T.o)()],c.prototype,"position",void 0),c}()},637:function(z,x,d){"use strict";d.d(x,"a",function(){return a});var v=d(475),T=d(450),M=d(630),m=d(435),y="hdrFilteringVertexShader",O=`
attribute vec2 position;

varying vec3 direction;

uniform vec3 up;
uniform vec3 right;
uniform vec3 front;
void main(void) {
mat3 view=mat3(up,right,front);
direction=view*vec3(position,1.0);
gl_Position=vec4(position,0.0,1.0);
}`;m.a.ShadersStore[y]=O;var c={name:y,shader:O},l=d(457),e=d(605),i=d(606),o=d(607),n="hdrFilteringPixelShader",s=`#include<helperFunctions>
#include<importanceSampling>
#include<pbrBRDFFunctions>
#include<hdrFilteringFunctions>
uniform float alphaG;
uniform samplerCube inputTexture;
uniform vec2 vFilteringInfo;
uniform float hdrScale;
varying vec3 direction;
void main() {
vec3 color=radiance(alphaG,inputTexture,direction,vFilteringInfo);
gl_FragColor=vec4(color*hdrScale,1.0);
}`;m.a.ShadersStore[n]=s;var t={name:n,shader:s},r=d(440),a=function(){function u(h,f){f===void 0&&(f={}),this._lodGenerationOffset=0,this._lodGenerationScale=.8,this.quality=4096,this.hdrScale=1,this._engine=h,this.hdrScale=f.hdrScale||this.hdrScale,this.quality=f.hdrScale||this.quality}return u.prototype._createRenderTarget=function(h){var f=0;this._engine.getCaps().textureHalfFloatRender?f=2:this._engine.getCaps().textureFloatRender&&(f=1);var p=this._engine.createRenderTargetCubeTexture(h,{format:5,type:f,createMipMaps:!0,generateMipMaps:!1,generateDepthBuffer:!1,generateStencilBuffer:!1,samplingMode:1});return this._engine.updateTextureWrappingMode(p,0,0,0),this._engine.updateTextureSamplingMode(3,p,!0),p},u.prototype._prefilterInternal=function(h){var f=h.getSize().width,p=T.a.ILog2(f)+1,_=this._effectWrapper.effect,g=this._createRenderTarget(f);this._effectRenderer.setViewport();var P=h.getInternalTexture();P&&this._engine.updateTextureSamplingMode(3,P,!0),this._effectRenderer.applyEffectWrapper(this._effectWrapper);var E=[[new v.z(0,0,-1),new v.z(0,-1,0),new v.z(1,0,0)],[new v.z(0,0,1),new v.z(0,-1,0),new v.z(-1,0,0)],[new v.z(1,0,0),new v.z(0,0,1),new v.z(0,1,0)],[new v.z(1,0,0),new v.z(0,0,-1),new v.z(0,-1,0)],[new v.z(1,0,0),new v.z(0,-1,0),new v.z(0,0,1)],[new v.z(-1,0,0),new v.z(0,-1,0),new v.z(0,0,-1)]];_.setFloat("hdrScale",this.hdrScale),_.setFloat2("vFilteringInfo",h.getSize().width,p),_.setTexture("inputTexture",h);for(var R=0;R<6;R++){_.setVector3("up",E[R][0]),_.setVector3("right",E[R][1]),_.setVector3("front",E[R][2]);for(var b=0;b<p;b++){this._engine.bindFramebuffer(g,R,void 0,void 0,!0,b),this._effectRenderer.applyEffectWrapper(this._effectWrapper);var C=Math.pow(2,(b-this._lodGenerationOffset)/this._lodGenerationScale)/f;b===0&&(C=0),_.setFloat("alphaG",C),this._effectRenderer.draw()}}return this._effectRenderer.restoreStates(),this._engine.restoreDefaultFramebuffer(),this._engine._releaseFramebufferObjects(g),this._engine._releaseTexture(h._texture),g._swapAndDie(h._texture),h._prefiltered=!0,h},u.prototype._createEffect=function(h,f){var p=[];h.gammaSpace&&p.push("#define GAMMA_INPUT"),p.push("#define NUM_SAMPLES "+this.quality+"u");var _=new M.b({engine:this._engine,name:"hdrFiltering",vertexShader:"hdrFiltering",fragmentShader:"hdrFiltering",samplerNames:["inputTexture"],uniformNames:["vSampleDirections","vWeights","up","right","front","vFilteringInfo","hdrScale","alphaG"],useShaderStore:!0,defines:p,onCompiled:f});return _},u.prototype.isReady=function(h){return h.isReady()&&this._effectWrapper.effect.isReady()},u.prototype.prefilter=function(h,f){var p=this;return f===void 0&&(f=null),this._engine._features.allowTexturePrefiltering?new Promise(function(_){p._effectRenderer=new M.a(p._engine),p._effectWrapper=p._createEffect(h),p._effectWrapper.effect.executeWhenCompiled(function(){p._prefilterInternal(h),p._effectRenderer.dispose(),p._effectWrapper.dispose(),_(),f&&f()})}):(r.a.Warn("HDR prefiltering is not available in WebGL 1., you can use real time filtering instead."),Promise.reject("HDR prefiltering is not available in WebGL 1., you can use real time filtering instead."))},u}()},677:function(z,x,d){"use strict";d.d(x,"b",function(){return A}),d.d(x,"a",function(){return F});var v=d(440),T=d(451),M=d(436),m=d(441),y=d(446),O=d(661),c=d(499),l=d(459),e=d(543),i=d(504),o=d(567),n=d(540),s=d(484),t=d(452),r=d(463),a=d(468),u=d(604),h=d(618),f=d(560),p=d(561),_=d(632),g=d(633),P=d(634),E=d(635),R=d(437),b=d(443),C=d(473),B=d(444),A=!0,F=function(){function D(){}return D.LoaderInjectedPhysicsEngine=void 0,D}(),N=function(D,W,J,Q){for(var G=0,L=W.materials.length;G<L;G++){var K=W.materials[G];if(K.id===D)return l.a.Parse(K,J,Q)}return null},w=function(D,W,J){for(var Q in W)if(D.name===W[Q])return J.push(D.id),!0;return D.parentId&&J.indexOf(D.parentId)!==-1?(J.push(D.id),!0):!1},U=function(D,W){return D+" of "+(W?W.file+" from "+W.name+" version: "+W.version+", exporter version: "+W.exporter_version:"unknown")},j=function(D,W){var J=W;if(W._waitingData.lods){if(W._waitingData.lods.ids&&W._waitingData.lods.ids.length>0){var Q=W._waitingData.lods.ids,G=J.isEnabled(!1);if(W._waitingData.lods.distances){var L=W._waitingData.lods.distances;if(L.length>=Q.length){var K=L.length>Q.length?L[L.length-1]:0;J.setEnabled(!1);for(var S=0;S<Q.length;S++){var X=Q[S],I=D.getMeshByID(X);I!=null&&J.addLODLevel(L[S],I)}K>0&&J.addLODLevel(K,null),G===!0&&J.setEnabled(!0)}else b.b.Warn("Invalid level of detail distances for "+W.name)}}W._waitingData.lods=null}},H=function(D,W,J,Q,G){G===void 0&&(G=!1);var L=new u.a(D),K="importScene has failed JSON parse";try{var S=JSON.parse(W);K="";var X=r.a.loggingLevel===r.a.DETAILED_LOGGING,I,V;if(S.environmentTexture!==void 0&&S.environmentTexture!==null){var vt=S.isPBR!==void 0?S.isPBR:!0;if(S.environmentTextureType&&S.environmentTextureType==="BABYLON.HDRCubeTexture"){var Ot=S.environmentTextureSize?S.environmentTextureSize:128,at=new o.a((S.environmentTexture.match(/https?:\/\//g)?"":J)+S.environmentTexture,D,Ot,!0,!vt);S.environmentTextureRotationY&&(at.rotationY=S.environmentTextureRotationY),D.environmentTexture=at}else if(C.a.EndsWith(S.environmentTexture,".env")){var Y=new i.a((S.environmentTexture.match(/https?:\/\//g)?"":J)+S.environmentTexture,D);S.environmentTextureRotationY&&(Y.rotationY=S.environmentTextureRotationY),D.environmentTexture=Y}else{var tt=i.a.CreateFromPrefilteredData((S.environmentTexture.match(/https?:\/\//g)?"":J)+S.environmentTexture,D);S.environmentTextureRotationY&&(tt.rotationY=S.environmentTextureRotationY),D.environmentTexture=tt}if(S.createDefaultSkybox===!0){var k=D.activeCamera!==void 0&&D.activeCamera!==null?(D.activeCamera.maxZ-D.activeCamera.minZ)/2:1e3,yt=S.skyboxBlurLevel||0;D.createDefaultSkybox(D.environmentTexture,vt,k,yt)}L.environmentTexture=D.environmentTexture}if(S.environmentIntensity!==void 0&&S.environmentIntensity!==null&&(D.environmentIntensity=S.environmentIntensity),S.lights!==void 0&&S.lights!==null)for(I=0,V=S.lights.length;I<V;I++){var mt=S.lights[I],lt=s.a.Parse(mt,D);lt&&(L.lights.push(lt),K+=I===0?`
	Lights:`:"",K+=`
		`+lt.toString(X))}if(S.reflectionProbes!==void 0&&S.reflectionProbes!==null)for(I=0,V=S.reflectionProbes.length;I<V;I++){var St=S.reflectionProbes[I],nt=E.a.Parse(St,D,J);nt&&(L.reflectionProbes.push(nt),K+=I===0?`
	Reflection Probes:`:"",K+=`
		`+nt.toString(X))}if(S.animations!==void 0&&S.animations!==null)for(I=0,V=S.animations.length;I<V;I++){var Pt=S.animations[I],Rt=R.a.GetClass("BABYLON.Animation");if(Rt){var dt=Rt.Parse(Pt);D.animations.push(dt),L.animations.push(dt),K+=I===0?`
	Animations:`:"",K+=`
		`+dt.toString(X)}}if(S.materials!==void 0&&S.materials!==null)for(I=0,V=S.materials.length;I<V;I++){var ut=S.materials[I],ht=l.a.Parse(ut,D,J);if(ht){L.materials.push(ht),K+=I===0?`
	Materials:`:"",K+=`
		`+ht.toString(X);var Tt=ht.getActiveTextures();Tt.forEach(function(st){L.textures.indexOf(st)==-1&&L.textures.push(st)})}}if(S.multiMaterials!==void 0&&S.multiMaterials!==null)for(I=0,V=S.multiMaterials.length;I<V;I++){var At=S.multiMaterials[I],bt=e.a.ParseMultiMaterial(At,D);L.multiMaterials.push(bt),K+=I===0?`
	MultiMaterials:`:"",K+=`
		`+bt.toString(X);var Tt=bt.getActiveTextures();Tt.forEach(function(pt){L.textures.indexOf(pt)==-1&&L.textures.push(pt)})}if(S.morphTargetManagers!==void 0&&S.morphTargetManagers!==null)for(var ft=0,q=S.morphTargetManagers;ft<q.length;ft++){var Mt=q[ft];L.morphTargetManagers.push(p.a.Parse(Mt,D))}if(S.skeletons!==void 0&&S.skeletons!==null)for(I=0,V=S.skeletons.length;I<V;I++){var Ct=S.skeletons[I],et=f.a.Parse(Ct,D);L.skeletons.push(et),K+=I===0?`
	Skeletons:`:"",K+=`
		`+et.toString(X)}var gt=S.geometries;if(gt!=null){var $=new Array,ct=gt.vertexData;if(ct!=null)for(I=0,V=ct.length;I<V;I++){var Bt=ct[I];$.push(O.a.Parse(Bt,D,J))}$.forEach(function(st){st&&L.geometries.push(st)})}if(S.transformNodes!==void 0&&S.transformNodes!==null)for(I=0,V=S.transformNodes.length;I<V;I++){var It=S.transformNodes[I],rt=c.a.Parse(It,D,J);L.transformNodes.push(rt)}if(S.meshes!==void 0&&S.meshes!==null)for(I=0,V=S.meshes.length;I<V;I++){var ot=S.meshes[I],Z=y.a.Parse(ot,D,J);if(L.meshes.push(Z),Z.hasInstances)for(var Lt=0,Wt=Z.instances;Lt<Wt.length;Lt++){var Kt=Wt[Lt];L.meshes.push(Kt)}K+=I===0?`
	Meshes:`:"",K+=`
		`+Z.toString(X)}if(S.cameras!==void 0&&S.cameras!==null)for(I=0,V=S.cameras.length;I<V;I++){var Ht=S.cameras[I],_t=T.a.Parse(Ht,D);L.cameras.push(_t),K+=I===0?`
	Cameras:`:"",K+=`
		`+_t.toString(X)}if(S.postProcesses!==void 0&&S.postProcesses!==null)for(I=0,V=S.postProcesses.length;I<V;I++){var Qt=S.postProcesses[I],Nt=B.a.Parse(Qt,D,J);Nt&&(L.postProcesses.push(Nt),K+=I===0?`
Postprocesses:`:"",K+=`
		`+Nt.toString())}if(S.animationGroups!==void 0&&S.animationGroups!==null)for(I=0,V=S.animationGroups.length;I<V;I++){var Jt=S.animationGroups[I],Ut=n.a.Parse(Jt,D);L.animationGroups.push(Ut),K+=I===0?`
	AnimationGroups:`:"",K+=`
		`+Ut.toString(X)}for(I=0,V=D.cameras.length;I<V;I++){var _t=D.cameras[I];_t._waitingParentId&&(_t.parent=D.getLastEntryByID(_t._waitingParentId),_t._waitingParentId=null)}for(I=0,V=D.lights.length;I<V;I++){var Et=D.lights[I];Et&&Et._waitingParentId&&(Et.parent=D.getLastEntryByID(Et._waitingParentId),Et._waitingParentId=null)}for(I=0,V=D.transformNodes.length;I<V;I++){var Dt=D.transformNodes[I];Dt._waitingParentId&&(Dt.parent=D.getLastEntryByID(Dt._waitingParentId),Dt._waitingParentId=null)}for(I=0,V=D.meshes.length;I<V;I++){var Z=D.meshes[I];Z._waitingParentId&&(Z.parent=D.getLastEntryByID(Z._waitingParentId),Z._waitingParentId=null),Z._waitingData.lods&&j(D,Z)}for(I=0,V=D.skeletons.length;I<V;I++){var et=D.skeletons[I];et._hasWaitingData&&(et.bones!=null&&et.bones.forEach(function(pt){if(pt._waitingTransformNodeId){var Gt=D.getLastEntryByID(pt._waitingTransformNodeId);Gt&&pt.linkTransformNode(Gt),pt._waitingTransformNodeId=null}}),et._waitingOverrideMeshId&&(et.overrideMesh=D.getMeshByID(et._waitingOverrideMeshId),et._waitingOverrideMeshId=null),et._hasWaitingData=null)}for(I=0,V=D.meshes.length;I<V;I++){var xt=D.meshes[I];xt._waitingData.freezeWorldMatrix?(xt.freezeWorldMatrix(),xt._waitingData.freezeWorldMatrix=null):xt.computeWorldMatrix(!0)}for(I=0,V=D.lights.length;I<V;I++){var it=D.lights[I];if(it._excludedMeshesIds.length>0){for(var Ft=0;Ft<it._excludedMeshesIds.length;Ft++){var Vt=D.getMeshByID(it._excludedMeshesIds[Ft]);Vt&&it.excludedMeshes.push(Vt)}it._excludedMeshesIds=[]}if(it._includedOnlyMeshesIds.length>0){for(var wt=0;wt<it._includedOnlyMeshesIds.length;wt++){var zt=D.getMeshByID(it._includedOnlyMeshesIds[wt]);zt&&it.includedOnlyMeshes.push(zt)}it._includedOnlyMeshesIds=[]}}for(a.a.Parse(S,D,L,J),I=0,V=D.meshes.length;I<V;I++){var Z=D.meshes[I];Z._waitingData.actions&&(h.a.Parse(Z._waitingData.actions,Z,D),Z._waitingData.actions=null)}S.actions!==void 0&&S.actions!==null&&h.a.Parse(S.actions,null,D)}catch(st){var jt=U("loadAssets",S?S.producer:"Unknown")+K;if(Q)Q(jt,st);else throw v.a.Log(jt),st}finally{G||L.removeAllFromScene(),K!==null&&r.a.loggingLevel!==r.a.NO_LOGGING&&v.a.Log(U("loadAssets",S?S.producer:"Unknown")+(r.a.loggingLevel!==r.a.MINIMAL_LOGGING?K:""))}return L};r.a.RegisterPlugin({name:"babylon.js",extensions:".babylon",canDirectLoad:function(D){return D.indexOf("babylon")!==-1},importMesh:function(D,W,J,Q,G,L,K,S){var X="importMesh has failed JSON parse";try{var I=JSON.parse(J);X="";var V=r.a.loggingLevel===r.a.DETAILED_LOGGING;D?Array.isArray(D)||(D=[D]):D=null;var vt=new Array;if(I.meshes!==void 0&&I.meshes!==null){var Ot=[],at=[],Y,tt;for(Y=0,tt=I.meshes.length;Y<tt;Y++){var k=I.meshes[Y];if(D===null||w(k,D,vt)){if(D!==null&&delete D[D.indexOf(k.name)],k.geometryId!==void 0&&k.geometryId!==null&&I.geometries!==void 0&&I.geometries!==null){var yt=!1;["boxes","spheres","cylinders","toruses","grounds","planes","torusKnots","vertexData"].forEach(function(rt){yt===!0||!I.geometries[rt]||!Array.isArray(I.geometries[rt])||I.geometries[rt].forEach(function(ot){if(ot.id===k.geometryId){switch(rt){case"vertexData":O.a.Parse(ot,W,Q);break}yt=!0}})}),yt===!1&&v.a.Warn("Geometry not found for mesh "+k.id)}if(k.materialId){var mt=at.indexOf(k.materialId)!==-1;if(mt===!1&&I.multiMaterials!==void 0&&I.multiMaterials!==null)for(var lt=0,St=I.multiMaterials.length;lt<St;lt++){var nt=I.multiMaterials[lt];if(nt.id===k.materialId){for(var Pt=0,Rt=nt.materials.length;Pt<Rt;Pt++){var dt=nt.materials[Pt];at.push(dt);var ut=N(dt,I,W,Q);ut&&(X+=`
	Material `+ut.toString(V))}at.push(nt.id);var ht=e.a.ParseMultiMaterial(nt,W);ht&&(mt=!0,X+=`
	Multi-Material `+ht.toString(V));break}}if(mt===!1){at.push(k.materialId);var ut=N(k.materialId,I,W,Q);ut?X+=`
	Material `+ut.toString(V):v.a.Warn("Material not found for mesh "+k.id)}}if(k.skeletonId>-1&&I.skeletons!==void 0&&I.skeletons!==null){var Tt=Ot.indexOf(k.skeletonId)>-1;if(Tt===!1)for(var At=0,bt=I.skeletons.length;At<bt;At++){var ft=I.skeletons[At];if(ft.id===k.skeletonId){var q=f.a.Parse(ft,W);K.push(q),Ot.push(ft.id),X+=`
	Skeleton `+q.toString(V)}}}if(I.morphTargetManagers!==void 0&&I.morphTargetManagers!==null)for(var Mt=0,Ct=I.morphTargetManagers;Mt<Ct.length;Mt++){var et=Ct[Mt];p.a.Parse(et,W)}var gt=y.a.Parse(k,W,Q);G.push(gt),X+=`
	Mesh `+gt.toString(V)}}var $;for(Y=0,tt=W.meshes.length;Y<tt;Y++)$=W.meshes[Y],$._waitingParentId&&($.parent=W.getLastEntryByID($._waitingParentId),$._waitingParentId=null),$._waitingData.lods&&j(W,$);for(Y=0,tt=W.skeletons.length;Y<tt;Y++){var q=W.skeletons[Y];q._hasWaitingData&&(q.bones!=null&&q.bones.forEach(function(ot){if(ot._waitingTransformNodeId){var Z=W.getLastEntryByID(ot._waitingTransformNodeId);Z&&ot.linkTransformNode(Z),ot._waitingTransformNodeId=null}}),q._waitingOverrideMeshId&&(q.overrideMesh=W.getMeshByID(q._waitingOverrideMeshId),q._waitingOverrideMeshId=null),q._hasWaitingData=null)}for(Y=0,tt=W.meshes.length;Y<tt;Y++)$=W.meshes[Y],$._waitingData.freezeWorldMatrix?($.freezeWorldMatrix(),$._waitingData.freezeWorldMatrix=null):$.computeWorldMatrix(!0)}if(I.particleSystems!==void 0&&I.particleSystems!==null){var ct=a.a.GetIndividualParser(t.a.NAME_PARTICLESYSTEM);if(ct)for(Y=0,tt=I.particleSystems.length;Y<tt;Y++){var Bt=I.particleSystems[Y];vt.indexOf(Bt.emitterId)!==-1&&L.push(ct(Bt,W,Q))}}return!0}catch(rt){var It=U("importMesh",I?I.producer:"Unknown")+X;if(S)S(It,rt);else throw v.a.Log(It),rt}finally{X!==null&&r.a.loggingLevel!==r.a.NO_LOGGING&&v.a.Log(U("importMesh",I?I.producer:"Unknown")+(r.a.loggingLevel!==r.a.MINIMAL_LOGGING?X:""))}return!1},load:function(D,W,J,Q){var G="importScene has failed JSON parse";try{var L=JSON.parse(W);if(G="",L.useDelayedTextureLoading!==void 0&&L.useDelayedTextureLoading!==null&&(D.useDelayedTextureLoading=L.useDelayedTextureLoading&&!r.a.ForceFullSceneLoadingForIncremental),L.autoClear!==void 0&&L.autoClear!==null&&(D.autoClear=L.autoClear),L.clearColor!==void 0&&L.clearColor!==null&&(D.clearColor=m.b.FromArray(L.clearColor)),L.ambientColor!==void 0&&L.ambientColor!==null&&(D.ambientColor=m.a.FromArray(L.ambientColor)),L.gravity!==void 0&&L.gravity!==null&&(D.gravity=M.e.FromArray(L.gravity)),L.fogMode&&L.fogMode!==0)switch(D.fogMode=L.fogMode,D.fogColor=m.a.FromArray(L.fogColor),D.fogStart=L.fogStart,D.fogEnd=L.fogEnd,D.fogDensity=L.fogDensity,G+="	Fog mode for scene:  ",D.fogMode){case 1:G+=`exp
`;break;case 2:G+=`exp2
`;break;case 3:G+=`linear
`;break}if(L.physicsEnabled){var K;L.physicsEngine==="cannon"?K=new _.a(void 0,void 0,F.LoaderInjectedPhysicsEngine):L.physicsEngine==="oimo"?K=new g.a(void 0,F.LoaderInjectedPhysicsEngine):L.physicsEngine==="ammo"&&(K=new P.a(void 0,F.LoaderInjectedPhysicsEngine,void 0)),G="	Physics engine "+(L.physicsEngine?L.physicsEngine:"oimo")+` enabled
`;var S=L.physicsGravity?M.e.FromArray(L.physicsGravity):null;D.enablePhysics(S,K)}L.metadata!==void 0&&L.metadata!==null&&(D.metadata=L.metadata),L.collisionsEnabled!==void 0&&L.collisionsEnabled!==null&&(D.collisionsEnabled=L.collisionsEnabled);var X=H(D,W,J,Q,!0);return X?(L.autoAnimate&&D.beginAnimation(D,L.autoAnimateFrom,L.autoAnimateTo,L.autoAnimateLoop,L.autoAnimateSpeed||1),L.activeCameraID!==void 0&&L.activeCameraID!==null&&D.setActiveCameraByID(L.activeCameraID),!0):!1}catch(V){var I=U("importScene",L?L.producer:"Unknown")+G;if(Q)Q(I,V);else throw v.a.Log(I),V}finally{G!==null&&r.a.loggingLevel!==r.a.NO_LOGGING&&v.a.Log(U("importScene",L?L.producer:"Unknown")+(r.a.loggingLevel!==r.a.MINIMAL_LOGGING?G:""))}return!1},loadAssetContainer:function(D,W,J,Q){var G=H(D,W,J,Q);return G}})}}]);
