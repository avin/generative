(this.webpackJsonpgenerative=this.webpackJsonpgenerative||[]).push([[7],{469:function(Oe,q,C){"use strict";C.d(q,"a",function(){return O});var x=C(588),n=C(436),S=C(539),F=C(667),p=C(449),B=C(451),O=function(){function o(s,u,t){t===void 0&&(t=Number.MAX_VALUE),this.origin=s,this.direction=u,this.length=t}return o.prototype.intersectsBoxMinMax=function(s,u,t){t===void 0&&(t=0);var a=o._TmpVector3[0].copyFromFloats(s.x-t,s.y-t,s.z-t),i=o._TmpVector3[1].copyFromFloats(u.x+t,u.y+t,u.z+t),c=0,l=Number.MAX_VALUE,f,e,r,h;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<a.x||this.origin.x>i.x)return!1}else if(f=1/this.direction.x,e=(a.x-this.origin.x)*f,r=(i.x-this.origin.x)*f,r===-Infinity&&(r=Infinity),e>r&&(h=e,e=r,r=h),c=Math.max(e,c),l=Math.min(r,l),c>l)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<a.y||this.origin.y>i.y)return!1}else if(f=1/this.direction.y,e=(a.y-this.origin.y)*f,r=(i.y-this.origin.y)*f,r===-Infinity&&(r=Infinity),e>r&&(h=e,e=r,r=h),c=Math.max(e,c),l=Math.min(r,l),c>l)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<a.z||this.origin.z>i.z)return!1}else if(f=1/this.direction.z,e=(a.z-this.origin.z)*f,r=(i.z-this.origin.z)*f,r===-Infinity&&(r=Infinity),e>r&&(h=e,e=r,r=h),c=Math.max(e,c),l=Math.min(r,l),c>l)return!1;return!0},o.prototype.intersectsBox=function(s,u){return u===void 0&&(u=0),this.intersectsBoxMinMax(s.minimum,s.maximum,u)},o.prototype.intersectsSphere=function(s,u){u===void 0&&(u=0);var t=s.center.x-this.origin.x,a=s.center.y-this.origin.y,i=s.center.z-this.origin.z,c=t*t+a*a+i*i,l=s.radius+u,f=l*l;if(c<=f)return!0;var e=t*this.direction.x+a*this.direction.y+i*this.direction.z;if(e<0)return!1;var r=c-e*e;return r<=f},o.prototype.intersectsTriangle=function(s,u,t){var a=o._TmpVector3[0],i=o._TmpVector3[1],c=o._TmpVector3[2],l=o._TmpVector3[3],f=o._TmpVector3[4];u.subtractToRef(s,a),t.subtractToRef(s,i),n.e.CrossToRef(this.direction,i,c);var e=n.e.Dot(a,c);if(e===0)return null;var r=1/e;this.origin.subtractToRef(s,l);var h=n.e.Dot(l,c)*r;if(h<0||h>1)return null;n.e.CrossToRef(l,a,f);var v=n.e.Dot(this.direction,f)*r;if(v<0||h+v>1)return null;var d=n.e.Dot(i,f)*r;return d>this.length?null:new F.a(1-h-v,h,d)},o.prototype.intersectsPlane=function(s){var u,t=n.e.Dot(s.normal,this.direction);if(Math.abs(t)<999999997475243e-21)return null;var a=n.e.Dot(s.normal,this.origin);return u=(-s.d-a)/t,u<0?u<-999999997475243e-21?null:0:u},o.prototype.intersectsAxis=function(s,u){switch(u===void 0&&(u=0),s){case"y":var t=(this.origin.y-u)/this.direction.y;return t>0?null:new n.e(this.origin.x+this.direction.x*-t,u,this.origin.z+this.direction.z*-t);case"x":var t=(this.origin.x-u)/this.direction.x;return t>0?null:new n.e(u,this.origin.y+this.direction.y*-t,this.origin.z+this.direction.z*-t);case"z":var t=(this.origin.z-u)/this.direction.z;return t>0?null:new n.e(this.origin.x+this.direction.x*-t,this.origin.y+this.direction.y*-t,u);default:return null}},o.prototype.intersectsMesh=function(s,u){var t=n.c.Matrix[0];return s.getWorldMatrix().invertToRef(t),this._tmpRay?o.TransformToRef(this,t,this._tmpRay):this._tmpRay=o.Transform(this,t),s.intersects(this._tmpRay,u)},o.prototype.intersectsMeshes=function(s,u,t){t?t.length=0:t=[];for(var a=0;a<s.length;a++){var i=this.intersectsMesh(s[a],u);i.hit&&t.push(i)}return t.sort(this._comparePickingInfo),t},o.prototype._comparePickingInfo=function(s,u){return s.distance<u.distance?-1:s.distance>u.distance?1:0},o.prototype.intersectionSegment=function(s,u,t){var a=this.origin,i=n.c.Vector3[0],c=n.c.Vector3[1],l=n.c.Vector3[2],f=n.c.Vector3[3];u.subtractToRef(s,i),this.direction.scaleToRef(o.rayl,l),a.addToRef(l,c),s.subtractToRef(a,f);var e=n.e.Dot(i,i),r=n.e.Dot(i,l),h=n.e.Dot(l,l),v=n.e.Dot(i,f),d=n.e.Dot(l,f),_=e*h-r*r,P,T,g=_,b,z,M=_;_<o.smallnum?(T=0,g=1,z=d,M=h):(T=r*d-h*v,z=e*d-r*v,T<0?(T=0,z=d,M=h):T>g&&(T=g,z=d+r,M=h)),z<0?(z=0,-v<0?T=0:-v>e?T=g:(T=-v,g=e)):z>M&&(z=M,-v+r<0?T=0:-v+r>e?T=g:(T=-v+r,g=e)),P=Math.abs(T)<o.smallnum?0:T/g,b=Math.abs(z)<o.smallnum?0:z/M;var E=n.c.Vector3[4];l.scaleToRef(b,E);var w=n.c.Vector3[5];i.scaleToRef(P,w),w.addInPlace(f);var V=n.c.Vector3[6];w.subtractToRef(E,V);var Z=b>0&&b<=this.length&&V.lengthSquared()<t*t;return Z?w.length():-1},o.prototype.update=function(s,u,t,a,i,c,l){return this.unprojectRayToRef(s,u,t,a,i,c,l),this},o.Zero=function(){return new o(n.e.Zero(),n.e.Zero())},o.CreateNew=function(s,u,t,a,i,c,l){var f=o.Zero();return f.update(s,u,t,a,i,c,l)},o.CreateNewFromTo=function(s,u,t){t===void 0&&(t=n.a.IdentityReadOnly);var a=u.subtract(s),i=Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z);return a.normalize(),o.Transform(new o(s,a,i),t)},o.Transform=function(s,u){var t=new o(new n.e(0,0,0),new n.e(0,0,0));return o.TransformToRef(s,u,t),t},o.TransformToRef=function(s,u,t){n.e.TransformCoordinatesToRef(s.origin,u,t.origin),n.e.TransformNormalToRef(s.direction,u,t.direction),t.length=s.length;var a=t.direction,i=a.length();if(!(i===0||i===1)){var c=1/i;a.x*=c,a.y*=c,a.z*=c,t.length*=i}},o.prototype.unprojectRayToRef=function(s,u,t,a,i,c,l){var f=n.c.Matrix[0];i.multiplyToRef(c,f),f.multiplyToRef(l,f),f.invert();var e=n.c.Vector3[0];e.x=s/t*2-1,e.y=-(u/a*2-1),e.z=-1;var r=n.c.Vector3[1].copyFromFloats(e.x,e.y,1),h=n.c.Vector3[2],v=n.c.Vector3[3];n.e._UnprojectFromInvertedMatrixToRef(e,f,h),n.e._UnprojectFromInvertedMatrixToRef(r,f,v),this.origin.copyFrom(h),v.subtractToRef(h,this.direction),this.direction.normalize()},o._TmpVector3=x.a.BuildArray(6,n.e.Zero),o.smallnum=1e-8,o.rayl=1e9,o}();p.a.prototype.createPickingRay=function(o,s,u,t,a){a===void 0&&(a=!1);var i=O.Zero();return this.createPickingRayToRef(o,s,u,i,t,a),i},p.a.prototype.createPickingRayToRef=function(o,s,u,t,a,i){i===void 0&&(i=!1);var c=this.getEngine();if(!a){if(!this.activeCamera)return this;a=this.activeCamera}var l=a.viewport,f=l.toGlobal(c.getRenderWidth(),c.getRenderHeight());return o=o/c.getHardwareScalingLevel()-f.x,s=s/c.getHardwareScalingLevel()-(c.getRenderHeight()-f.y-f.height),t.update(o,s,f.width,f.height,u||n.a.IdentityReadOnly,i?n.a.IdentityReadOnly:a.getViewMatrix(),a.getProjectionMatrix()),this},p.a.prototype.createPickingRayInCameraSpace=function(o,s,u){var t=O.Zero();return this.createPickingRayInCameraSpaceToRef(o,s,t,u),t},p.a.prototype.createPickingRayInCameraSpaceToRef=function(o,s,u,t){if(!S.a)return this;var a=this.getEngine();if(!t){if(!this.activeCamera)throw new Error("Active camera not set");t=this.activeCamera}var i=t.viewport,c=i.toGlobal(a.getRenderWidth(),a.getRenderHeight()),l=n.a.Identity();return o=o/a.getHardwareScalingLevel()-c.x,s=s/a.getHardwareScalingLevel()-(a.getRenderHeight()-c.y-c.height),u.update(o,s,c.width,c.height,l,l,t.getProjectionMatrix()),this},p.a.prototype._internalPickForMesh=function(o,s,u,t,a,i,c,l){var f=s(t),e=u.intersects(f,a,c,i,t,l);return!e||!e.hit||!a&&o!=null&&e.distance>=o.distance?null:e},p.a.prototype._internalPick=function(o,s,u,t,a){if(!S.a)return null;for(var i=null,c=0;c<this.meshes.length;c++){var l=this.meshes[c];if(s){if(!s(l))continue}else if(!l.isEnabled()||!l.isVisible||!l.isPickable)continue;var f=l.skeleton&&l.skeleton.overrideMesh?l.skeleton.overrideMesh.getWorldMatrix():l.getWorldMatrix();if(l.hasThinInstances&&l.thinInstanceEnablePicking){var e=this._internalPickForMesh(i,o,l,f,!0,!0,a);if(e){if(t)return i;for(var r=n.c.Matrix[1],h=l.thinInstanceGetWorldMatrices(),v=0;v<h.length;v++){var d=h[v];d.multiplyToRef(f,r);var _=this._internalPickForMesh(i,o,l,r,u,t,a,!0);if(_&&(i=_,i.thinInstanceIndex=v,u))return i}}}else{var e=this._internalPickForMesh(i,o,l,f,u,t,a);if(e&&(i=e,u))return i}}return i||new S.a},p.a.prototype._internalMultiPick=function(o,s,u){if(!S.a)return null;for(var t=new Array,a=0;a<this.meshes.length;a++){var i=this.meshes[a];if(s){if(!s(i))continue}else if(!i.isEnabled()||!i.isVisible||!i.isPickable)continue;var c=i.skeleton&&i.skeleton.overrideMesh?i.skeleton.overrideMesh.getWorldMatrix():i.getWorldMatrix();if(i.hasThinInstances&&i.thinInstanceEnablePicking){var l=this._internalPickForMesh(null,o,i,c,!0,!0,u);if(l)for(var f=n.c.Matrix[1],e=i.thinInstanceGetWorldMatrices(),r=0;r<e.length;r++){var h=e[r];h.multiplyToRef(c,f);var v=this._internalPickForMesh(null,o,i,f,!1,!1,u,!0);v&&(v.thinInstanceIndex=r,t.push(v))}}else{var l=this._internalPickForMesh(null,o,i,c,!1,!1,u);l&&t.push(l)}}return t},p.a.prototype.pickWithBoundingInfo=function(o,s,u,t,a){var i=this;if(!S.a)return null;var c=this._internalPick(function(l){return i._tempPickingRay||(i._tempPickingRay=O.Zero()),i.createPickingRayToRef(o,s,l,i._tempPickingRay,a||null),i._tempPickingRay},u,t,!0);return c&&(c.ray=this.createPickingRay(o,s,n.a.Identity(),a||null)),c},p.a.prototype.pick=function(o,s,u,t,a,i){var c=this;if(!S.a)return null;var l=this._internalPick(function(f){return c._tempPickingRay||(c._tempPickingRay=O.Zero()),c.createPickingRayToRef(o,s,f,c._tempPickingRay,a||null),c._tempPickingRay},u,t,!1,i);return l&&(l.ray=this.createPickingRay(o,s,n.a.Identity(),a||null)),l},p.a.prototype.pickWithRay=function(o,s,u,t){var a=this,i=this._internalPick(function(c){return a._pickWithRayInverseMatrix||(a._pickWithRayInverseMatrix=n.a.Identity()),c.invertToRef(a._pickWithRayInverseMatrix),a._cachedRayForTransform||(a._cachedRayForTransform=O.Zero()),O.TransformToRef(o,a._pickWithRayInverseMatrix,a._cachedRayForTransform),a._cachedRayForTransform},s,u,!1,t);return i&&(i.ray=o),i},p.a.prototype.multiPick=function(o,s,u,t,a){var i=this;return this._internalMultiPick(function(c){return i.createPickingRay(o,s,c,t||null)},u,a)},p.a.prototype.multiPickWithRay=function(o,s,u){var t=this;return this._internalMultiPick(function(a){return t._pickWithRayInverseMatrix||(t._pickWithRayInverseMatrix=n.a.Identity()),a.invertToRef(t._pickWithRayInverseMatrix),t._cachedRayForTransform||(t._cachedRayForTransform=O.Zero()),O.TransformToRef(o,t._pickWithRayInverseMatrix,t._cachedRayForTransform),t._cachedRayForTransform},s,u)},B.a.prototype.getForwardRay=function(o,s,u){return o===void 0&&(o=100),this.getForwardRayToRef(new O(n.e.Zero(),n.e.Zero(),o),o,s,u)},B.a.prototype.getForwardRayToRef=function(o,s,u,t){return s===void 0&&(s=100),u||(u=this.getWorldMatrix()),o.length=s,t?o.origin.copyFrom(t):o.origin.copyFrom(this.position),n.c.Vector3[2].set(0,0,this._scene.useRightHandedSystem?-1:1),n.e.TransformNormalToRef(n.c.Vector3[2],u,n.c.Vector3[3]),n.e.NormalizeToRef(n.c.Vector3[3],o.direction),o}},610:function(Oe,q,C){"use strict";C.d(q,"a",function(){return n}),C.d(q,"b",function(){return S});var x=C(475),n=function(){function F(p,B,O,o,s){this.idx=0,this.color=new x.f(1,1,1,1),this.position=x.z.Zero(),this.rotation=x.z.Zero(),this.uv=new x.y(0,0),this.velocity=x.z.Zero(),this.pivot=x.z.Zero(),this.translateFromPivot=!1,this._pos=0,this._ind=0,this.groupId=0,this.idxInGroup=0,this._stillInvisible=!1,this._rotationMatrix=[1,0,0,0,1,0,0,0,1],this.parentId=null,this._globalPosition=x.z.Zero(),this.idx=p,this._group=B,this.groupId=O,this.idxInGroup=o,this._pcs=s}return Object.defineProperty(F.prototype,"size",{get:function(){return this.size},set:function(p){this.size=p},enumerable:!1,configurable:!0}),Object.defineProperty(F.prototype,"quaternion",{get:function(){return this.rotationQuaternion},set:function(p){this.rotationQuaternion=p},enumerable:!1,configurable:!0}),F.prototype.intersectsMesh=function(p,B){if(!p._boundingInfo)return!1;if(B=B||!1,B)return p.getBoundingInfo().boundingSphere.intersectsPoint(this.position.add(this._pcs.mesh.position));var O=0,o=0,s=0,u=0,t=0,a=0;O=p.getBoundingInfo().boundingBox.maximumWorld.x,o=p.getBoundingInfo().boundingBox.minimumWorld.x,s=p.getBoundingInfo().boundingBox.maximumWorld.y,u=p.getBoundingInfo().boundingBox.minimumWorld.y,t=p.getBoundingInfo().boundingBox.maximumWorld.z,a=p.getBoundingInfo().boundingBox.minimumWorld.z;var i=this.position.x+this._pcs.mesh.position.x,c=this.position.y+this._pcs.mesh.position.y,l=this.position.z+this._pcs.mesh.position.z;return o<=i&&i<=O&&u<=c&&c<=s&&a<=l&&l<=t},F.prototype.getRotationMatrix=function(p){var B;if(this.rotationQuaternion)B=this.rotationQuaternion;else{B=x.v.Quaternion[0];var O=this.rotation;x.r.RotationYawPitchRollToRef(O.y,O.x,O.z,B)}B.toRotationMatrix(p)},F}(),S=function(){function F(p,B){this.groupID=p,this._positionFunction=B}return F}()},665:function(Oe,q,C){"use strict";C.d(q,"a",function(){return c}),C.d(q,"b",function(){return l});var x=C(475),n=C(436),S=C(440),F=C(447),p=C(485),B=C(446),O=C(448),o=C(610),s=C(536),u=C(469),t=C(455),a=C(477),i=C(450),c;(function(f){f[f.Color=2]="Color",f[f.UV=1]="UV",f[f.Random=0]="Random",f[f.Stated=3]="Stated"})(c||(c={}));var l=function(){function f(e,r,h,v){this.particles=new Array,this.nbParticles=0,this.counter=0,this.vars={},this._promises=[],this._positions=new Array,this._indices=new Array,this._normals=new Array,this._colors=new Array,this._uvs=new Array,this._updatable=!0,this._isVisibilityBoxLocked=!1,this._alwaysVisible=!1,this._groups=new Array,this._groupCounter=0,this._computeParticleColor=!0,this._computeParticleTexture=!0,this._computeParticleRotation=!0,this._computeBoundingBox=!1,this._isReady=!1,this.name=e,this._size=r,this._scene=h||O.a.LastCreatedScene,v&&v.updatable!==void 0?this._updatable=v.updatable:this._updatable=!0}return f.prototype.buildMeshAsync=function(){var e=this;return Promise.all(this._promises).then(function(){return e._isReady=!0,e._buildMesh()})},f.prototype._buildMesh=function(){this.nbParticles===0&&this.addPoints(1),this._positions32=new Float32Array(this._positions),this._uvs32=new Float32Array(this._uvs),this._colors32=new Float32Array(this._colors);var e=new p.a;e.set(this._positions32,F.b.PositionKind),this._uvs32.length>0&&e.set(this._uvs32,F.b.UVKind);var r=0;this._colors32.length>0&&(r=1,e.set(this._colors32,F.b.ColorKind));var h=new B.a(this.name,this._scene);e.applyToMesh(h,this._updatable),this.mesh=h,this._positions=null,this._uvs=null,this._colors=null,this._updatable||(this.particles.length=0);var v=new t.a("point cloud material",this._scene);return v.emissiveColor=new x.e(r,r,r),v.disableLighting=!0,v.pointsCloud=!0,v.pointSize=this._size,h.material=v,new Promise(function(d){return d(h)})},f.prototype._addParticle=function(e,r,h,v){var d=new o.a(e,r,h,v,this);return this.particles.push(d),d},f.prototype._randomUnitVector=function(e){e.position=new n.e(Math.random(),Math.random(),Math.random()),e.color=new x.f(1,1,1,1)},f.prototype._getColorIndicesForCoord=function(e,r,h,v){var d=e._groupImageData,_=h*(v*4)+r*4,P=[_,_+1,_+2,_+3],T=P[0],g=P[1],b=P[2],z=P[3],M=d[T],E=d[g],w=d[b],V=d[z];return new x.f(M/255,E/255,w/255,V)},f.prototype._setPointsColorOrUV=function(e,r,h,v,d,_,P){h&&e.updateFacetData();var T=e.getBoundingInfo(),g=2*T.boundingSphere.radius,b=e.getVerticesData(F.b.PositionKind),z=e.getIndices(),M=e.getVerticesData(F.b.UVKind),E=e.getVerticesData(F.b.ColorKind),w=n.e.Zero();e.computeWorldMatrix();var V=e.getWorldMatrix();if(!V.isIdentity())for(var Z=0;Z<b.length/3;Z++)n.e.TransformCoordinatesFromFloatsToRef(b[3*Z],b[3*Z+1],b[3*Z+2],V,w),b[3*Z]=w.x,b[3*Z+1]=w.y,b[3*Z+2]=w.z;var N=0,A=0,W=0,U=0,R=0,I=0,L=0,k=0,J=0,Q=0,y=0,X=0,ee=0,te=0,Y=n.e.Zero(),m=n.e.Zero(),j=n.e.Zero(),H=n.e.Zero(),$=n.e.Zero(),G=0,ue=0,re=0,ie=0,ne=0,_e=0,ce=n.d.Zero(),ve=n.d.Zero(),oe=n.d.Zero(),se=n.d.Zero(),ge=n.d.Zero(),ye=0,we=0,Ae=0,Be=0,We=0,Ue=0,Ze=0,Ve=0,ke=0,Le=0,Ke=0,Se=0,me=n.f.Zero(),Ce=n.f.Zero(),Ne=n.f.Zero(),je=n.f.Zero(),He=n.f.Zero(),ae=0,Pe=0;P=P||0;for(var pe,be,D=new n.f(0,0,0,0),ze=n.e.Zero(),Ee=n.e.Zero(),Xe=n.e.Zero(),fe=0,Ye=n.e.Zero(),Qe=0,Je=0,Ie=new u.a(n.e.Zero(),new n.e(1,0,0)),Me,Re=n.e.Zero(),A=0;A<z.length/3;A++){W=z[3*A],U=z[3*A+1],R=z[3*A+2],I=b[3*W],L=b[3*W+1],k=b[3*W+2],J=b[3*U],Q=b[3*U+1],y=b[3*U+2],X=b[3*R],ee=b[3*R+1],te=b[3*R+2],Y.set(I,L,k),m.set(J,Q,y),j.set(X,ee,te),m.subtractToRef(Y,H),j.subtractToRef(m,$),M&&(G=M[2*W],ue=M[2*W+1],re=M[2*U],ie=M[2*U+1],ne=M[2*R],_e=M[2*R+1],ce.set(G,ue),ve.set(re,ie),oe.set(ne,_e),ve.subtractToRef(ce,se),oe.subtractToRef(ve,ge)),E&&v&&(ye=E[4*W],we=E[4*W+1],Ae=E[4*W+2],Be=E[4*W+3],We=E[4*U],Ue=E[4*U+1],Ze=E[4*U+2],Ve=E[4*U+3],ke=E[4*R],Le=E[4*R+1],Ke=E[4*R+2],Se=E[4*R+3],me.set(ye,we,Ae,Be),Ce.set(We,Ue,Ze,Ve),Ne.set(ke,Le,Ke,Se),Ce.subtractToRef(me,je),Ne.subtractToRef(Ce,He));for(var xe,$e,Ge,qe,et,he,le,Te,tt=new x.e(0,0,0),De=new x.e(0,0,0),de,K,Fe=0;Fe<r._groupDensity[A];Fe++)N=this.particles.length,this._addParticle(N,r,this._groupCounter,A+Fe),K=this.particles[N],ae=i.a.RandomRange(0,1),Pe=i.a.RandomRange(0,1),pe=Y.add(H.scale(ae)).add($.scale(ae*Pe)),h&&(ze=e.getFacetNormal(A).normalize().scale(-1),Ee=H.clone().normalize(),Xe=n.e.Cross(ze,Ee),fe=i.a.RandomRange(0,2*Math.PI),Ye=Ee.scale(Math.cos(fe)).add(Xe.scale(Math.sin(fe))),fe=i.a.RandomRange(.1,Math.PI/2),Re=Ye.scale(Math.cos(fe)).add(ze.scale(Math.sin(fe))),Ie.origin=pe.add(Re.scale(1e-5)),Ie.direction=Re,Ie.length=g,Me=Ie.intersectsMesh(e),Me.hit&&(Je=Me.pickedPoint.subtract(pe).length(),Qe=i.a.RandomRange(0,1)*Je,pe.addInPlace(Re.scale(Qe)))),K.position=pe.clone(),this._positions.push(K.position.x,K.position.y,K.position.z),v!==void 0?M&&(be=ce.add(se.scale(ae)).add(ge.scale(ae*Pe)),v?d&&r._groupImageData!==null?(xe=r._groupImgWidth,$e=r._groupImgHeight,de=this._getColorIndicesForCoord(r,Math.round(be.x*xe),Math.round(be.y*$e),xe),K.color=de,this._colors.push(de.r,de.g,de.b,de.a)):E?(D=me.add(je.scale(ae)).add(He.scale(ae*Pe)),K.color=new x.f(D.x,D.y,D.z,D.w),this._colors.push(D.x,D.y,D.z,D.w)):(D=me.set(Math.random(),Math.random(),Math.random(),1),K.color=new x.f(D.x,D.y,D.z,D.w),this._colors.push(D.x,D.y,D.z,D.w)):(K.uv=be.clone(),this._uvs.push(K.uv.x,K.uv.y))):(_?(tt.set(_.r,_.g,_.b),Ge=i.a.RandomRange(-P,P),qe=i.a.RandomRange(-P,P),Te=tt.toHSV(),et=Te.r,he=Te.g+Ge,le=Te.b+qe,he<0&&(he=0),he>1&&(he=1),le<0&&(le=0),le>1&&(le=1),x.e.HSVtoRGBToRef(et,he,le,De),D.set(De.r,De.g,De.b,1)):D=me.set(Math.random(),Math.random(),Math.random(),1),K.color=new x.f(D.x,D.y,D.z,D.w),this._colors.push(D.x,D.y,D.z,D.w))}},f.prototype._colorFromTexture=function(e,r,h){var v=this;if(e.material===null){S.a.Warn(e.name+"has no material."),r._groupImageData=null,this._setPointsColorOrUV(e,r,h,!0,!1);return}var d=e.material,_=d.getActiveTextures();if(_.length===0){S.a.Warn(e.name+"has no usable texture."),r._groupImageData=null,this._setPointsColorOrUV(e,r,h,!0,!1);return}var P=e.clone();P.setEnabled(!1),this._promises.push(new Promise(function(T){a.a.WhenAllReady(_,function(){var g=r._textureNb;g<0&&(g=0),g>_.length-1&&(g=_.length-1);var b=function(){r._groupImgWidth=_[g].getSize().width,r._groupImgHeight=_[g].getSize().height,v._setPointsColorOrUV(P,r,h,!0,!0),P.dispose(),T()};r._groupImageData=null;var z=_[g].readPixels();z?z.then(function(M){r._groupImageData=M,b()}):b()})}))},f.prototype._calculateDensity=function(e,r,h){for(var v=new Array,d,_,P,T,g,b,z,M,E,w,V,Z,N,A=n.e.Zero(),W=n.e.Zero(),U=n.e.Zero(),R=n.e.Zero(),I=n.e.Zero(),L=n.e.Zero(),k,J,Q,y,X,ee=new Array,te=0,Y=h.length/3,d=0;d<Y;d++)_=h[3*d],P=h[3*d+1],T=h[3*d+2],g=r[3*_],b=r[3*_+1],z=r[3*_+2],M=r[3*P],E=r[3*P+1],w=r[3*P+2],V=r[3*T],Z=r[3*T+1],N=r[3*T+2],A.set(g,b,z),W.set(M,E,w),U.set(V,Z,N),W.subtractToRef(A,R),U.subtractToRef(W,I),U.subtractToRef(A,L),k=R.length(),J=I.length(),Q=L.length(),y=(k+J+Q)/2,X=Math.sqrt(y*(y-k)*(y-J)*(y-Q)),te+=X,ee[d]=X;for(var m=0,d=0;d<Y;d++)v[d]=Math.floor(e*ee[d]/te),m+=v[d];var j=e-m,H=Math.floor(j/Y),$=j%Y;H>0&&(v=v.map(function(G){return G+H}));for(var d=0;d<$;d++)v[d]+=1;return v},f.prototype.addPoints=function(e,r){r===void 0&&(r=this._randomUnitVector);for(var h=new o.b(this._groupCounter,r),v,d=this.nbParticles,_=0;_<e;_++)v=this._addParticle(d,h,this._groupCounter,_),h&&h._positionFunction&&h._positionFunction(v,d,_),this._positions.push(v.position.x,v.position.y,v.position.z),v.color&&this._colors.push(v.color.r,v.color.g,v.color.b,v.color.a),v.uv&&this._uvs.push(v.uv.x,v.uv.y),d++;return this.nbParticles+=e,this._groupCounter++,this._groupCounter},f.prototype.addSurfacePoints=function(e,r,h,v,d){var _=h||c.Random;(isNaN(_)||_<0||_>3)&&(_=c.Random);var P=e.getVerticesData(F.b.PositionKind),T=e.getIndices();this._groups.push(this._groupCounter);var g=new o.b(this._groupCounter,null);switch(g._groupDensity=this._calculateDensity(r,P,T),_===c.Color?g._textureNb=v||0:v=v||new x.f(1,1,1,1),_){case c.Color:this._colorFromTexture(e,g,!1);break;case c.UV:this._setPointsColorOrUV(e,g,!1,!1,!1);break;case c.Random:this._setPointsColorOrUV(e,g,!1);break;case c.Stated:this._setPointsColorOrUV(e,g,!1,void 0,void 0,v,d);break}return this.nbParticles+=r,this._groupCounter++,this._groupCounter-1},f.prototype.addVolumePoints=function(e,r,h,v,d){var _=h||c.Random;(isNaN(_)||_<0||_>3)&&(_=c.Random);var P=e.getVerticesData(F.b.PositionKind),T=e.getIndices();this._groups.push(this._groupCounter);var g=new o.b(this._groupCounter,null);switch(g._groupDensity=this._calculateDensity(r,P,T),_===c.Color?g._textureNb=v||0:v=v||new x.f(1,1,1,1),_){case c.Color:this._colorFromTexture(e,g,!0);break;case c.UV:this._setPointsColorOrUV(e,g,!0,!1,!1);break;case c.Random:this._setPointsColorOrUV(e,g,!0);break;case c.Stated:this._setPointsColorOrUV(e,g,!0,void 0,void 0,v,d);break}return this.nbParticles+=r,this._groupCounter++,this._groupCounter-1},f.prototype.setParticles=function(e,r,h){if(e===void 0&&(e=0),r===void 0&&(r=this.nbParticles-1),h===void 0&&(h=!0),!this._updatable||!this._isReady)return this;this.beforeUpdateParticles(e,r,h);var v=n.c.Matrix[0],d=this.mesh,_=this._colors32,P=this._positions32,T=this._uvs32,g=n.c.Vector3,b=g[5].copyFromFloats(1,0,0),z=g[6].copyFromFloats(0,1,0),M=g[7].copyFromFloats(0,0,1),E=g[8].setAll(Number.MAX_VALUE),w=g[9].setAll(-Number.MAX_VALUE);n.a.IdentityToRef(v);var V=0;if(this.mesh.isFacetDataEnabled&&(this._computeBoundingBox=!0),r=r>=this.nbParticles?this.nbParticles-1:r,this._computeBoundingBox&&(e!=0||r!=this.nbParticles-1)){var Z=this.mesh._boundingInfo;Z&&(E.copyFrom(Z.minimum),w.copyFrom(Z.maximum))}for(var V=0,N=0,A=0,W=0,U=e;U<=r;U++){var R=this.particles[U];V=R.idx,N=3*V,A=4*V,W=2*V,this.updateParticle(R);var I=R._rotationMatrix,L=R.position,k=R._globalPosition;this._computeParticleRotation&&R.getRotationMatrix(v);var J=R.parentId!==null;if(J){var Q=this.particles[R.parentId],y=Q._rotationMatrix,X=Q._globalPosition,ee=L.x*y[1]+L.y*y[4]+L.z*y[7],te=L.x*y[0]+L.y*y[3]+L.z*y[6],Y=L.x*y[2]+L.y*y[5]+L.z*y[8];if(k.x=X.x+te,k.y=X.y+ee,k.z=X.z+Y,this._computeParticleRotation){var m=v.m;I[0]=m[0]*y[0]+m[1]*y[3]+m[2]*y[6],I[1]=m[0]*y[1]+m[1]*y[4]+m[2]*y[7],I[2]=m[0]*y[2]+m[1]*y[5]+m[2]*y[8],I[3]=m[4]*y[0]+m[5]*y[3]+m[6]*y[6],I[4]=m[4]*y[1]+m[5]*y[4]+m[6]*y[7],I[5]=m[4]*y[2]+m[5]*y[5]+m[6]*y[8],I[6]=m[8]*y[0]+m[9]*y[3]+m[10]*y[6],I[7]=m[8]*y[1]+m[9]*y[4]+m[10]*y[7],I[8]=m[8]*y[2]+m[9]*y[5]+m[10]*y[8]}}else if(k.x=0,k.y=0,k.z=0,this._computeParticleRotation){var m=v.m;I[0]=m[0],I[1]=m[1],I[2]=m[2],I[3]=m[4],I[4]=m[5],I[5]=m[6],I[6]=m[8],I[7]=m[9],I[8]=m[10]}var j=g[11];R.translateFromPivot?j.setAll(0):j.copyFrom(R.pivot);var H=g[0];H.copyFrom(R.position);var $=H.x-R.pivot.x,G=H.y-R.pivot.y,ue=H.z-R.pivot.z,re=$*I[0]+G*I[3]+ue*I[6],ie=$*I[1]+G*I[4]+ue*I[7],ne=$*I[2]+G*I[5]+ue*I[8];re+=j.x,ie+=j.y,ne+=j.z;var _e=P[N]=k.x+b.x*re+z.x*ie+M.x*ne,ce=P[N+1]=k.y+b.y*re+z.y*ie+M.y*ne,ve=P[N+2]=k.z+b.z*re+z.z*ie+M.z*ne;if(this._computeBoundingBox&&(E.minimizeInPlaceFromFloats(_e,ce,ve),w.maximizeInPlaceFromFloats(_e,ce,ve)),this._computeParticleColor&&R.color){var oe=R.color,se=this._colors32;se[A]=oe.r,se[A+1]=oe.g,se[A+2]=oe.b,se[A+3]=oe.a}if(this._computeParticleTexture&&R.uv){var ge=R.uv,ye=this._uvs32;ye[W]=ge.x,ye[W+1]=ge.y}}return h&&(this._computeParticleColor&&d.updateVerticesData(F.b.ColorKind,_,!1,!1),this._computeParticleTexture&&d.updateVerticesData(F.b.UVKind,T,!1,!1),d.updateVerticesData(F.b.PositionKind,P,!1,!1)),this._computeBoundingBox&&(d._boundingInfo?d._boundingInfo.reConstruct(E,w,d._worldMatrix):d._boundingInfo=new s.a(E,w,d._worldMatrix)),this.afterUpdateParticles(e,r,h),this},f.prototype.dispose=function(){this.mesh.dispose(),this.vars=null,this._positions=null,this._indices=null,this._normals=null,this._uvs=null,this._colors=null,this._indices32=null,this._positions32=null,this._uvs32=null,this._colors32=null},f.prototype.refreshVisibleSize=function(){return this._isVisibilityBoxLocked||this.mesh.refreshBoundingInfo(),this},f.prototype.setVisibilityBox=function(e){var r=e/2;this.mesh._boundingInfo=new s.a(new n.e(-r,-r,-r),new n.e(r,r,r))},Object.defineProperty(f.prototype,"isAlwaysVisible",{get:function(){return this._alwaysVisible},set:function(e){this._alwaysVisible=e,this.mesh.alwaysSelectAsActiveMesh=e},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"computeParticleRotation",{set:function(e){this._computeParticleRotation=e},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"computeParticleColor",{get:function(){return this._computeParticleColor},set:function(e){this._computeParticleColor=e},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"computeParticleTexture",{get:function(){return this._computeParticleTexture},set:function(e){this._computeParticleTexture=e},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"computeBoundingBox",{get:function(){return this._computeBoundingBox},set:function(e){this._computeBoundingBox=e},enumerable:!1,configurable:!0}),f.prototype.initParticles=function(){},f.prototype.recycleParticle=function(e){return e},f.prototype.updateParticle=function(e){return e},f.prototype.beforeUpdateParticles=function(e,r,h){},f.prototype.afterUpdateParticles=function(e,r,h){},f}()}}]);
