(this.webpackJsonpgenerative=this.webpackJsonpgenerative||[]).push([[0],Array(434).concat([function($,W,M){"use strict";M.d(W,"d",function(){return d}),M.d(W,"a",function(){return m}),M.d(W,"c",function(){return c}),M.d(W,"b",function(){return s}),M.d(W,"e",function(){return u}),M.d(W,"f",function(){return r});/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var P=function(F,x){return P=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(j,V){j.__proto__=V}||function(j,V){for(var z in V)Object.prototype.hasOwnProperty.call(V,z)&&(j[z]=V[z])},P(F,x)};function d(F,x){if(typeof x!="function"&&x!==null)throw new TypeError("Class extends value "+String(x)+" is not a constructor or null");P(F,x);function j(){this.constructor=F}F.prototype=x===null?Object.create(x):(j.prototype=x.prototype,new j)}var m=function(){return m=Object.assign||function(x){for(var j,V=1,z=arguments.length;V<z;V++){j=arguments[V];for(var w in j)Object.prototype.hasOwnProperty.call(j,w)&&(x[w]=j[w])}return x},m.apply(this,arguments)};function n(F,x){var j={};for(var V in F)Object.prototype.hasOwnProperty.call(F,V)&&x.indexOf(V)<0&&(j[V]=F[V]);if(F!=null&&typeof Object.getOwnPropertySymbols=="function")for(var z=0,V=Object.getOwnPropertySymbols(F);z<V.length;z++)x.indexOf(V[z])<0&&Object.prototype.propertyIsEnumerable.call(F,V[z])&&(j[V[z]]=F[V[z]]);return j}function c(F,x,j,V){var z=arguments.length,w=z<3?x:V===null?V=Object.getOwnPropertyDescriptor(x,j):V,R;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")w=Reflect.decorate(F,x,j,V);else for(var L=F.length-1;L>=0;L--)(R=F[L])&&(w=(z<3?R(w):z>3?R(x,j,w):R(x,j))||w);return z>3&&w&&Object.defineProperty(x,j,w),w}function a(F,x){return function(j,V){x(j,V,F)}}function _(F,x){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(F,x)}function s(F,x,j,V){function z(w){return w instanceof j?w:new j(function(R){R(w)})}return new(j||(j=Promise))(function(w,R){function L(X){try{B(V.next(X))}catch(K){R(K)}}function N(X){try{B(V.throw(X))}catch(K){R(K)}}function B(X){X.done?w(X.value):z(X.value).then(L,N)}B((V=V.apply(F,x||[])).next())})}function u(F,x){var j={label:0,sent:function(){if(w[0]&1)throw w[1];return w[1]},trys:[],ops:[]},V,z,w,R;return R={next:L(0),throw:L(1),return:L(2)},typeof Symbol=="function"&&(R[Symbol.iterator]=function(){return this}),R;function L(B){return function(X){return N([B,X])}}function N(B){if(V)throw new TypeError("Generator is already executing.");for(;j;)try{if(V=1,z&&(w=B[0]&2?z.return:B[0]?z.throw||((w=z.return)&&w.call(z),0):z.next)&&!(w=w.call(z,B[1])).done)return w;switch(z=0,w&&(B=[B[0]&2,w.value]),B[0]){case 0:case 1:w=B;break;case 4:return j.label++,{value:B[1],done:!1};case 5:j.label++,z=B[1],B=[0];continue;case 7:B=j.ops.pop(),j.trys.pop();continue;default:if(w=j.trys,!(w=w.length>0&&w[w.length-1])&&(B[0]===6||B[0]===2)){j=0;continue}if(B[0]===3&&(!w||B[1]>w[0]&&B[1]<w[3])){j.label=B[1];break}if(B[0]===6&&j.label<w[1]){j.label=w[1],w=B;break}if(w&&j.label<w[2]){j.label=w[2],j.ops.push(B);break}w[2]&&j.ops.pop(),j.trys.pop();continue}B=x.call(F,j)}catch(X){B=[6,X],z=0}finally{V=w=0}if(B[0]&5)throw B[1];return{value:B[0]?B[1]:void 0,done:!0}}}var p=Object.create?function(F,x,j,V){V===void 0&&(V=j),Object.defineProperty(F,V,{enumerable:!0,get:function(){return x[j]}})}:function(F,x,j,V){V===void 0&&(V=j),F[V]=x[j]};function l(F,x){for(var j in F)j!=="default"&&!Object.prototype.hasOwnProperty.call(x,j)&&p(x,F,j)}function h(F){var x=typeof Symbol=="function"&&Symbol.iterator,j=x&&F[x],V=0;if(j)return j.call(F);if(F&&typeof F.length=="number")return{next:function(){return F&&V>=F.length&&(F=void 0),{value:F&&F[V++],done:!F}}};throw new TypeError(x?"Object is not iterable.":"Symbol.iterator is not defined.")}function t(F,x){var j=typeof Symbol=="function"&&F[Symbol.iterator];if(!j)return F;var V=j.call(F),z,w=[],R;try{for(;(x===void 0||x-- >0)&&!(z=V.next()).done;)w.push(z.value)}catch(L){R={error:L}}finally{try{z&&!z.done&&(j=V.return)&&j.call(V)}finally{if(R)throw R.error}}return w}function e(){for(var F=[],x=0;x<arguments.length;x++)F=F.concat(t(arguments[x]));return F}function i(){for(var F=0,x=0,j=arguments.length;x<j;x++)F+=arguments[x].length;for(var V=Array(F),z=0,x=0;x<j;x++)for(var w=arguments[x],R=0,L=w.length;R<L;R++,z++)V[z]=w[R];return V}function r(F,x){for(var j=0,V=x.length,z=F.length;j<V;j++,z++)F[z]=x[j];return F}function o(F){return this instanceof o?(this.v=F,this):new o(F)}function g(F,x,j){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var V=j.apply(F,x||[]),z,w=[];return z={},R("next"),R("throw"),R("return"),z[Symbol.asyncIterator]=function(){return this},z;function R(G){V[G]&&(z[G]=function(I){return new Promise(function(A,S){w.push([G,I,A,S])>1||L(G,I)})})}function L(G,I){try{N(V[G](I))}catch(A){K(w[0][3],A)}}function N(G){G.value instanceof o?Promise.resolve(G.value.v).then(B,X):K(w[0][2],G)}function B(G){L("next",G)}function X(G){L("throw",G)}function K(G,I){G(I),w.shift(),w.length&&L(w[0][0],w[0][1])}}function y(F){var x,j;return x={},V("next"),V("throw",function(z){throw z}),V("return"),x[Symbol.iterator]=function(){return this},x;function V(z,w){x[z]=F[z]?function(R){return(j=!j)?{value:o(F[z](R)),done:z==="return"}:w?w(R):R}:w}}function v(F){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var x=F[Symbol.asyncIterator],j;return x?x.call(F):(F=typeof h=="function"?h(F):F[Symbol.iterator](),j={},V("next"),V("throw"),V("return"),j[Symbol.asyncIterator]=function(){return this},j);function V(w){j[w]=F[w]&&function(R){return new Promise(function(L,N){R=F[w](R),z(L,N,R.done,R.value)})}}function z(w,R,L,N){Promise.resolve(N).then(function(B){w({value:B,done:L})},R)}}function f(F,x){return Object.defineProperty?Object.defineProperty(F,"raw",{value:x}):F.raw=x,F}var b=Object.create?function(F,x){Object.defineProperty(F,"default",{enumerable:!0,value:x})}:function(F,x){F.default=x};function T(F){if(F&&F.__esModule)return F;var x={};if(F!=null)for(var j in F)j!=="default"&&Object.prototype.hasOwnProperty.call(F,j)&&p(x,F,j);return b(x,F),x}function E(F){return F&&F.__esModule?F:{default:F}}function O(F,x){if(!x.has(F))throw new TypeError("attempted to get private field on non-instance");return x.get(F)}function D(F,x,j){if(!x.has(F))throw new TypeError("attempted to set private field on non-instance");return x.set(F,j),j}},function($,W,M){"use strict";M.d(W,"a",function(){return c});var P=M(438),d=M(660),m=M(440),n=M(800),c=function(){function a(_,s,u,p,l,h,t,e,i,r,o){var g=this;p===void 0&&(p=null),h===void 0&&(h=null),t===void 0&&(t=null),e===void 0&&(e=null),i===void 0&&(i=null),o===void 0&&(o="");var y;this.name=null,this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new P.c,this.onErrorObservable=new P.c,this._onBindObservable=null,this._wasPreviouslyReady=!1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this.name=_,this._key=o;var v=null;if(s.attributes){var f=s;if(this._engine=u,this._attributesNames=f.attributes,this._uniformsNames=f.uniformsNames.concat(f.samplers),this._samplerList=f.samplers.slice(),this.defines=f.defines,this.onError=f.onError,this.onCompiled=f.onCompiled,this._fallbacks=f.fallbacks,this._indexParameters=f.indexParameters,this._transformFeedbackVaryings=f.transformFeedbackVaryings||null,this._multiTarget=!!f.multiTarget,f.uniformBuffersNames){this._uniformBuffersNamesList=f.uniformBuffersNames.slice();for(var b=0;b<f.uniformBuffersNames.length;b++)this._uniformBuffersNames[f.uniformBuffersNames[b]]=b}v=(y=f.processFinalCode)!==null&&y!==void 0?y:null}else this._engine=l,this.defines=h==null?"":h,this._uniformsNames=u.concat(p),this._samplerList=p?p.slice():[],this._attributesNames=s,this._uniformBuffersNamesList=[],this.onError=i,this.onCompiled=e,this._indexParameters=r,this._fallbacks=t;this._attributeLocationByName={},this.uniqueId=a._uniqueIdSeed++;var T,E,O=d.a.IsWindowObjectExist()?this._engine.getHostDocument():null;_.vertexSource?T="source:"+_.vertexSource:_.vertexElement?(T=O?O.getElementById(_.vertexElement):null,T||(T=_.vertexElement)):T=_.vertex||_,_.fragmentSource?E="source:"+_.fragmentSource:_.fragmentElement?(E=O?O.getElementById(_.fragmentElement):null,E||(E=_.fragmentElement)):E=_.fragment||_,this._processingContext=this._engine._getShaderProcessingContext();var D={defines:this.defines.split(`
`),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:this._engine._shaderProcessor,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:a.ShadersRepository,includesShadersStore:a.IncludesShadersStore,version:(this._engine.version*100).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext},F=[void 0,void 0],x=function(){if(F[0]&&F[1]){D.isFragment=!0;var j=F[0],V=F[1];n.a.Process(V,D,function(z){v&&(z=v("fragment",z));var w=n.a.Finalize(j,z,D);g._useFinalCode(w.vertexCode,w.fragmentCode,_)},g._engine)}};this._loadShader(T,"Vertex","",function(j){n.a.Initialize(D),n.a.Process(j,D,function(V){g._rawVertexSourceCode=j,v&&(V=v("vertex",V)),F[0]=V,x()},g._engine)}),this._loadShader(E,"Fragment","Pixel",function(j){g._rawFragmentSourceCode=j,F[1]=j,x()})}return Object.defineProperty(a.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new P.c),this._onBindObservable},enumerable:!1,configurable:!0}),a.prototype._useFinalCode=function(_,s,u){if(u){var p=u.vertexElement||u.vertex||u.spectorName||u,l=u.fragmentElement||u.fragment||u.spectorName||u;this._vertexSourceCode="#define SHADER_NAME vertex:"+p+`
`+_,this._fragmentSourceCode="#define SHADER_NAME fragment:"+l+`
`+s}else this._vertexSourceCode=_,this._fragmentSourceCode=s;this._prepareEffect()},Object.defineProperty(a.prototype,"key",{get:function(){return this._key},enumerable:!1,configurable:!0}),a.prototype.isReady=function(){try{return this._isReadyInternal()}catch(_){return!1}},a.prototype._isReadyInternal=function(){return this._isReady?!0:this._pipelineContext?this._pipelineContext.isReady:!1},a.prototype.getEngine=function(){return this._engine},a.prototype.getPipelineContext=function(){return this._pipelineContext},a.prototype.getAttributesNames=function(){return this._attributesNames},a.prototype.getAttributeLocation=function(_){return this._attributes[_]},a.prototype.getAttributeLocationByName=function(_){return this._attributeLocationByName[_]},a.prototype.getAttributesCount=function(){return this._attributes.length},a.prototype.getUniformIndex=function(_){return this._uniformsNames.indexOf(_)},a.prototype.getUniform=function(_){return this._uniforms[_]},a.prototype.getSamplers=function(){return this._samplerList},a.prototype.getUniformNames=function(){return this._uniformsNames},a.prototype.getUniformBuffersNames=function(){return this._uniformBuffersNamesList},a.prototype.getIndexParameters=function(){return this._indexParameters},a.prototype.getCompilationError=function(){return this._compilationError},a.prototype.allFallbacksProcessed=function(){return this._allFallbacksProcessed},a.prototype.executeWhenCompiled=function(_){var s=this;if(this.isReady()){_(this);return}this.onCompileObservable.add(function(u){_(u)}),(!this._pipelineContext||this._pipelineContext.isAsync)&&setTimeout(function(){s._checkIsReady(null)},16)},a.prototype._checkIsReady=function(_){var s=this;try{if(this._isReadyInternal())return}catch(u){this._processCompilationErrors(u,_);return}setTimeout(function(){s._checkIsReady(_)},16)},a.prototype._loadShader=function(_,s,u,p){if(typeof HTMLElement!="undefined"&&_ instanceof HTMLElement){var l=d.a.GetDOMTextContent(_);p(l);return}if(_.substr(0,7)==="source:"){p(_.substr(7));return}if(_.substr(0,7)==="base64:"){var h=window.atob(_.substr(7));p(h);return}if(a.ShadersStore[_+s+"Shader"]){p(a.ShadersStore[_+s+"Shader"]);return}if(u&&a.ShadersStore[_+u+"Shader"]){p(a.ShadersStore[_+u+"Shader"]);return}var t;_[0]==="."||_[0]==="/"||_.indexOf("http")>-1?t=_:t=a.ShadersRepository+_,this._engine._loadFile(t+"."+s.toLowerCase()+".fx",p)},Object.defineProperty(a.prototype,"vertexSourceCode",{get:function(){var _,s;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(s=(_=this._pipelineContext)===null||_===void 0?void 0:_._getVertexShaderCode())!==null&&s!==void 0?s:this._vertexSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"fragmentSourceCode",{get:function(){var _,s;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(s=(_=this._pipelineContext)===null||_===void 0?void 0:_._getFragmentShaderCode())!==null&&s!==void 0?s:this._fragmentSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"rawVertexSourceCode",{get:function(){return this._rawVertexSourceCode},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"rawFragmentSourceCode",{get:function(){return this._rawFragmentSourceCode},enumerable:!1,configurable:!0}),a.prototype._rebuildProgram=function(_,s,u,p){var l=this;this._isReady=!1,this._vertexSourceCodeOverride=_,this._fragmentSourceCodeOverride=s,this.onError=function(h,t){p&&p(t)},this.onCompiled=function(){var h=l.getEngine().scenes;if(h)for(var t=0;t<h.length;t++)h[t].markAllMaterialsAsDirty(63);l._pipelineContext._handlesSpectorRebuildCallback(u)},this._fallbacks=null,this._prepareEffect()},a.prototype._prepareEffect=function(){var _=this,s=this._attributesNames,u=this.defines,p=this._pipelineContext;try{var l=this._engine;this._pipelineContext=l.createPipelineContext(this._processingContext),this._pipelineContext._name=this._key;var h=this._rebuildProgram.bind(this);this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?l._preparePipelineContext(this._pipelineContext,this._vertexSourceCodeOverride,this._fragmentSourceCodeOverride,!0,this._rawVertexSourceCode,this._rawFragmentSourceCode,h,null,this._transformFeedbackVaryings,this._key):l._preparePipelineContext(this._pipelineContext,this._vertexSourceCode,this._fragmentSourceCode,!1,this._rawVertexSourceCode,this._rawFragmentSourceCode,h,u,this._transformFeedbackVaryings,this._key),l._executeWhenRenderingStateIsCompiled(this._pipelineContext,function(){if(_._attributes=[],_._pipelineContext._fillEffectInformation(_,_._uniformBuffersNames,_._uniformsNames,_._uniforms,_._samplerList,_._samplers,s,_._attributes),s)for(var t=0;t<s.length;t++){var e=s[t];_._attributeLocationByName[e]=_._attributes[t]}l.bindSamplers(_),_._compilationError="",_._isReady=!0,_.onCompiled&&_.onCompiled(_),_.onCompileObservable.notifyObservers(_),_.onCompileObservable.clear(),_._fallbacks&&_._fallbacks.unBindMesh(),p&&_.getEngine()._deletePipelineContext(p)}),this._pipelineContext.isAsync&&this._checkIsReady(p)}catch(t){this._processCompilationErrors(t,p)}},a.prototype._getShaderCodeAndErrorLine=function(_,s,u){var p=u?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/,l=null;if(s&&_){var h=s.match(p);if(h&&h.length===2){var t=parseInt(h[1]),e=_.split(`
`,-1);e.length>=t&&(l="Offending line ["+t+"] in "+(u?"fragment":"vertex")+" code: "+e[t-1])}}return[_,l]},a.prototype._processCompilationErrors=function(_,s){var u,p,l,h,t;s===void 0&&(s=null),this._compilationError=_.message;var e=this._attributesNames,i=this._fallbacks;if(m.a.Error("Unable to compile effect:"),m.a.Error("Uniforms: "+this._uniformsNames.map(function(y){return" "+y})),m.a.Error("Attributes: "+e.map(function(y){return" "+y})),m.a.Error(`Defines:\r
`+this.defines),a.LogShaderCodeOnCompilationError){var r=null,o=null,g=null;((l=this._pipelineContext)===null||l===void 0?void 0:l._getVertexShaderCode())&&(u=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),g=u[0],r=u[1],g&&(m.a.Error("Vertex code:"),m.a.Error(g))),((h=this._pipelineContext)===null||h===void 0?void 0:h._getFragmentShaderCode())&&(p=this._getShaderCodeAndErrorLine((t=this._pipelineContext)===null||t===void 0?void 0:t._getFragmentShaderCode(),this._compilationError,!0),g=p[0],o=p[1],g&&(m.a.Error("Fragment code:"),m.a.Error(g))),r&&m.a.Error(r),o&&m.a.Error(o)}m.a.Error("Error: "+this._compilationError),s&&(this._pipelineContext=s,this._isReady=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)),i?(this._pipelineContext=null,i.hasMoreFallbacks?(this._allFallbacksProcessed=!1,m.a.Error("Trying next fallback."),this.defines=i.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):this._allFallbacksProcessed=!0},Object.defineProperty(a.prototype,"isSupported",{get:function(){return this._compilationError===""},enumerable:!1,configurable:!0}),a.prototype._bindTexture=function(_,s){this._engine._bindTexture(this._samplers[_],s,_)},a.prototype.setTexture=function(_,s){this._engine.setTexture(this._samplers[_],this._uniforms[_],s,_)},a.prototype.setDepthStencilTexture=function(_,s){this._engine.setDepthStencilTexture(this._samplers[_],this._uniforms[_],s,_)},a.prototype.setTextureArray=function(_,s){var u=_+"Ex";if(this._samplerList.indexOf(u+"0")===-1){for(var p=this._samplerList.indexOf(_),l=1;l<s.length;l++){var h=u+(l-1).toString();this._samplerList.splice(p+l,0,h)}for(var t=0,e=0,i=this._samplerList;e<i.length;e++){var r=i[e];this._samplers[r]=t,t+=1}}this._engine.setTextureArray(this._samplers[_],this._uniforms[_],s,_)},a.prototype.setTextureFromPostProcess=function(_,s){this._engine.setTextureFromPostProcess(this._samplers[_],s,_)},a.prototype.setTextureFromPostProcessOutput=function(_,s){this._engine.setTextureFromPostProcessOutput(this._samplers[_],s,_)},a.prototype.bindUniformBuffer=function(_,s){var u=this._uniformBuffersNames[s];u===void 0||a._baseCache[u]===_||(a._baseCache[u]=_,this._engine.bindUniformBufferBase(_,u,s))},a.prototype.bindUniformBlock=function(_,s){this._engine.bindUniformBlock(this._pipelineContext,_,s)},a.prototype.setInt=function(_,s){return this._pipelineContext.setInt(_,s),this},a.prototype.setInt2=function(_,s,u){return this._pipelineContext.setInt2(_,s,u),this},a.prototype.setInt3=function(_,s,u,p){return this._pipelineContext.setInt3(_,s,u,p),this},a.prototype.setInt4=function(_,s,u,p,l){return this._pipelineContext.setInt4(_,s,u,p,l),this},a.prototype.setIntArray=function(_,s){return this._pipelineContext.setIntArray(_,s),this},a.prototype.setIntArray2=function(_,s){return this._pipelineContext.setIntArray2(_,s),this},a.prototype.setIntArray3=function(_,s){return this._pipelineContext.setIntArray3(_,s),this},a.prototype.setIntArray4=function(_,s){return this._pipelineContext.setIntArray4(_,s),this},a.prototype.setFloatArray=function(_,s){return this._pipelineContext.setArray(_,s),this},a.prototype.setFloatArray2=function(_,s){return this._pipelineContext.setArray2(_,s),this},a.prototype.setFloatArray3=function(_,s){return this._pipelineContext.setArray3(_,s),this},a.prototype.setFloatArray4=function(_,s){return this._pipelineContext.setArray4(_,s),this},a.prototype.setArray=function(_,s){return this._pipelineContext.setArray(_,s),this},a.prototype.setArray2=function(_,s){return this._pipelineContext.setArray2(_,s),this},a.prototype.setArray3=function(_,s){return this._pipelineContext.setArray3(_,s),this},a.prototype.setArray4=function(_,s){return this._pipelineContext.setArray4(_,s),this},a.prototype.setMatrices=function(_,s){return this._pipelineContext.setMatrices(_,s),this},a.prototype.setMatrix=function(_,s){return this._pipelineContext.setMatrix(_,s),this},a.prototype.setMatrix3x3=function(_,s){return this._pipelineContext.setMatrix3x3(_,s),this},a.prototype.setMatrix2x2=function(_,s){return this._pipelineContext.setMatrix2x2(_,s),this},a.prototype.setFloat=function(_,s){return this._pipelineContext.setFloat(_,s),this},a.prototype.setBool=function(_,s){return this._pipelineContext.setInt(_,s?1:0),this},a.prototype.setVector2=function(_,s){return this._pipelineContext.setVector2(_,s),this},a.prototype.setFloat2=function(_,s,u){return this._pipelineContext.setFloat2(_,s,u),this},a.prototype.setVector3=function(_,s){return this._pipelineContext.setVector3(_,s),this},a.prototype.setFloat3=function(_,s,u,p){return this._pipelineContext.setFloat3(_,s,u,p),this},a.prototype.setVector4=function(_,s){return this._pipelineContext.setVector4(_,s),this},a.prototype.setFloat4=function(_,s,u,p,l){return this._pipelineContext.setFloat4(_,s,u,p,l),this},a.prototype.setColor3=function(_,s){return this._pipelineContext.setColor3(_,s),this},a.prototype.setColor4=function(_,s,u){return this._pipelineContext.setColor4(_,s,u),this},a.prototype.setDirectColor4=function(_,s){return this._pipelineContext.setDirectColor4(_,s),this},a.prototype.dispose=function(){this._pipelineContext&&this._pipelineContext.dispose(),this._engine._releaseEffect(this)},a.RegisterShader=function(_,s,u){s&&(a.ShadersStore[_+"PixelShader"]=s),u&&(a.ShadersStore[_+"VertexShader"]=u)},a.ResetCache=function(){a._baseCache={}},a.ShadersRepository="src/Shaders/",a.LogShaderCodeOnCompilationError=!0,a._uniqueIdSeed=0,a._baseCache={},a.ShadersStore={},a.IncludesShadersStore={},a}()},function($,W,M){"use strict";M.d(W,"d",function(){return a}),M.d(W,"e",function(){return _}),M.d(W,"f",function(){return s}),M.d(W,"b",function(){return u}),M.d(W,"a",function(){return p}),M.d(W,"c",function(){return h});var P=M(450),d=M(515),m=M(588),n=M(437),c=M(670),a=function(){function t(e,i){e===void 0&&(e=0),i===void 0&&(i=0),this.x=e,this.y=i}return t.prototype.toString=function(){return"{X: "+this.x+" Y: "+this.y+"}"},t.prototype.getClassName=function(){return"Vector2"},t.prototype.getHashCode=function(){var e=this.x|0;return e=e*397^(this.y|0),e},t.prototype.toArray=function(e,i){return i===void 0&&(i=0),e[i]=this.x,e[i+1]=this.y,this},t.prototype.fromArray=function(e,i){return i===void 0&&(i=0),t.FromArrayToRef(e,i,this),this},t.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},t.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this},t.prototype.copyFromFloats=function(e,i){return this.x=e,this.y=i,this},t.prototype.set=function(e,i){return this.copyFromFloats(e,i)},t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.addToRef=function(e,i){return i.x=this.x+e.x,i.y=this.y+e.y,this},t.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this},t.prototype.addVector3=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.subtract=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.subtractToRef=function(e,i){return i.x=this.x-e.x,i.y=this.y-e.y,this},t.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this},t.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this},t.prototype.multiply=function(e){return new t(this.x*e.x,this.y*e.y)},t.prototype.multiplyToRef=function(e,i){return i.x=this.x*e.x,i.y=this.y*e.y,this},t.prototype.multiplyByFloats=function(e,i){return new t(this.x*e,this.y*i)},t.prototype.divide=function(e){return new t(this.x/e.x,this.y/e.y)},t.prototype.divideToRef=function(e,i){return i.x=this.x/e.x,i.y=this.y/e.y,this},t.prototype.divideInPlace=function(e){return this.divideToRef(e,this)},t.prototype.negate=function(){return new t(-this.x,-this.y)},t.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this},t.prototype.negateToRef=function(e){return e.copyFromFloats(this.x*-1,this.y*-1)},t.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this},t.prototype.scale=function(e){var i=new t(0,0);return this.scaleToRef(e,i),i},t.prototype.scaleToRef=function(e,i){return i.x=this.x*e,i.y=this.y*e,this},t.prototype.scaleAndAddToRef=function(e,i){return i.x+=this.x*e,i.y+=this.y*e,this},t.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y},t.prototype.equalsWithEpsilon=function(e,i){return i===void 0&&(i=d.a),e&&P.a.WithinEpsilon(this.x,e.x,i)&&P.a.WithinEpsilon(this.y,e.y,i)},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y))},t.prototype.fract=function(){return new t(this.x-Math.floor(this.x),this.y-Math.floor(this.y))},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},t.prototype.normalize=function(){var e=this.length();return e===0?this:(this.x/=e,this.y/=e,this)},t.prototype.clone=function(){return new t(this.x,this.y)},t.Zero=function(){return new t(0,0)},t.One=function(){return new t(1,1)},t.FromArray=function(e,i){return i===void 0&&(i=0),new t(e[i],e[i+1])},t.FromArrayToRef=function(e,i,r){r.x=e[i],r.y=e[i+1]},t.CatmullRom=function(e,i,r,o,g){var y=g*g,v=g*y,f=.5*(2*i.x+(-e.x+r.x)*g+(2*e.x-5*i.x+4*r.x-o.x)*y+(-e.x+3*i.x-3*r.x+o.x)*v),b=.5*(2*i.y+(-e.y+r.y)*g+(2*e.y-5*i.y+4*r.y-o.y)*y+(-e.y+3*i.y-3*r.y+o.y)*v);return new t(f,b)},t.Clamp=function(e,i,r){var o=e.x;o=o>r.x?r.x:o,o=o<i.x?i.x:o;var g=e.y;return g=g>r.y?r.y:g,g=g<i.y?i.y:g,new t(o,g)},t.Hermite=function(e,i,r,o,g){var y=g*g,v=g*y,f=2*v-3*y+1,b=-2*v+3*y,T=v-2*y+g,E=v-y,O=e.x*f+r.x*b+i.x*T+o.x*E,D=e.y*f+r.y*b+i.y*T+o.y*E;return new t(O,D)},t.Lerp=function(e,i,r){var o=e.x+(i.x-e.x)*r,g=e.y+(i.y-e.y)*r;return new t(o,g)},t.Dot=function(e,i){return e.x*i.x+e.y*i.y},t.Normalize=function(e){var i=e.clone();return i.normalize(),i},t.Minimize=function(e,i){var r=e.x<i.x?e.x:i.x,o=e.y<i.y?e.y:i.y;return new t(r,o)},t.Maximize=function(e,i){var r=e.x>i.x?e.x:i.x,o=e.y>i.y?e.y:i.y;return new t(r,o)},t.Transform=function(e,i){var r=t.Zero();return t.TransformToRef(e,i,r),r},t.TransformToRef=function(e,i,r){var o=i.m,g=e.x*o[0]+e.y*o[4]+o[12],y=e.x*o[1]+e.y*o[5]+o[13];r.x=g,r.y=y},t.PointInTriangle=function(e,i,r,o){var g=1/2*(-r.y*o.x+i.y*(-r.x+o.x)+i.x*(r.y-o.y)+r.x*o.y),y=g<0?-1:1,v=(i.y*o.x-i.x*o.y+(o.y-i.y)*e.x+(i.x-o.x)*e.y)*y,f=(i.x*r.y-i.y*r.x+(i.y-r.y)*e.x+(r.x-i.x)*e.y)*y;return v>0&&f>0&&v+f<2*g*y},t.Distance=function(e,i){return Math.sqrt(t.DistanceSquared(e,i))},t.DistanceSquared=function(e,i){var r=e.x-i.x,o=e.y-i.y;return r*r+o*o},t.Center=function(e,i){return t.CenterToRef(e,i,t.Zero())},t.CenterToRef=function(e,i,r){return r.copyFromFloats((e.x+i.x)/2,(e.y+i.y)/2)},t.DistanceOfPointFromSegment=function(e,i,r){var o=t.DistanceSquared(i,r);if(o===0)return t.Distance(e,i);var g=r.subtract(i),y=Math.max(0,Math.min(1,t.Dot(e.subtract(i),g)/o)),v=i.add(g.multiplyByFloats(y,y));return t.Distance(e,v)},t}(),_=function(){function t(e,i,r){e===void 0&&(e=0),i===void 0&&(i=0),r===void 0&&(r=0),this._isDirty=!0,this._x=e,this._y=i,this._z=r}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this._z},set:function(e){this._z=e,this._isDirty=!0},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return"{X: "+this._x+" Y:"+this._y+" Z:"+this._z+"}"},t.prototype.getClassName=function(){return"Vector3"},t.prototype.getHashCode=function(){var e=this._x|0;return e=e*397^(this._y|0),e=e*397^(this._z|0),e},t.prototype.asArray=function(){var e=[];return this.toArray(e,0),e},t.prototype.toArray=function(e,i){return i===void 0&&(i=0),e[i]=this._x,e[i+1]=this._y,e[i+2]=this._z,this},t.prototype.fromArray=function(e,i){return i===void 0&&(i=0),t.FromArrayToRef(e,i,this),this},t.prototype.toQuaternion=function(){return u.RotationYawPitchRoll(this._y,this._x,this._z)},t.prototype.addInPlace=function(e){return this.addInPlaceFromFloats(e._x,e._y,e._z)},t.prototype.addInPlaceFromFloats=function(e,i,r){return this.x+=e,this.y+=i,this.z+=r,this},t.prototype.add=function(e){return new t(this._x+e._x,this._y+e._y,this._z+e._z)},t.prototype.addToRef=function(e,i){return i.copyFromFloats(this._x+e._x,this._y+e._y,this._z+e._z)},t.prototype.subtractInPlace=function(e){return this.x-=e._x,this.y-=e._y,this.z-=e._z,this},t.prototype.subtract=function(e){return new t(this._x-e._x,this._y-e._y,this._z-e._z)},t.prototype.subtractToRef=function(e,i){return this.subtractFromFloatsToRef(e._x,e._y,e._z,i)},t.prototype.subtractFromFloats=function(e,i,r){return new t(this._x-e,this._y-i,this._z-r)},t.prototype.subtractFromFloatsToRef=function(e,i,r,o){return o.copyFromFloats(this._x-e,this._y-i,this._z-r)},t.prototype.negate=function(){return new t(-this._x,-this._y,-this._z)},t.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},t.prototype.negateToRef=function(e){return e.copyFromFloats(this._x*-1,this._y*-1,this._z*-1)},t.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this},t.prototype.scale=function(e){return new t(this._x*e,this._y*e,this._z*e)},t.prototype.scaleToRef=function(e,i){return i.copyFromFloats(this._x*e,this._y*e,this._z*e)},t.prototype.scaleAndAddToRef=function(e,i){return i.addInPlaceFromFloats(this._x*e,this._y*e,this._z*e)},t.prototype.projectOnPlane=function(e,i){var r=t.Zero();return this.projectOnPlaneToRef(e,i,r),r},t.prototype.projectOnPlaneToRef=function(e,i,r){var o=e.normal,g=e.d,y=l.Vector3[0];this.subtractToRef(i,y),y.normalize();var v=t.Dot(y,o),f=-(t.Dot(i,o)+g)/v,b=y.scaleInPlace(f);i.addToRef(b,r)},t.prototype.equals=function(e){return e&&this._x===e._x&&this._y===e._y&&this._z===e._z},t.prototype.equalsWithEpsilon=function(e,i){return i===void 0&&(i=d.a),e&&P.a.WithinEpsilon(this._x,e._x,i)&&P.a.WithinEpsilon(this._y,e._y,i)&&P.a.WithinEpsilon(this._z,e._z,i)},t.prototype.equalsToFloats=function(e,i,r){return this._x===e&&this._y===i&&this._z===r},t.prototype.multiplyInPlace=function(e){return this.x*=e._x,this.y*=e._y,this.z*=e._z,this},t.prototype.multiply=function(e){return this.multiplyByFloats(e._x,e._y,e._z)},t.prototype.multiplyToRef=function(e,i){return i.copyFromFloats(this._x*e._x,this._y*e._y,this._z*e._z)},t.prototype.multiplyByFloats=function(e,i,r){return new t(this._x*e,this._y*i,this._z*r)},t.prototype.divide=function(e){return new t(this._x/e._x,this._y/e._y,this._z/e._z)},t.prototype.divideToRef=function(e,i){return i.copyFromFloats(this._x/e._x,this._y/e._y,this._z/e._z)},t.prototype.divideInPlace=function(e){return this.divideToRef(e,this)},t.prototype.minimizeInPlace=function(e){return this.minimizeInPlaceFromFloats(e._x,e._y,e._z)},t.prototype.maximizeInPlace=function(e){return this.maximizeInPlaceFromFloats(e._x,e._y,e._z)},t.prototype.minimizeInPlaceFromFloats=function(e,i,r){return e<this._x&&(this.x=e),i<this._y&&(this.y=i),r<this._z&&(this.z=r),this},t.prototype.maximizeInPlaceFromFloats=function(e,i,r){return e>this._x&&(this.x=e),i>this._y&&(this.y=i),r>this._z&&(this.z=r),this},t.prototype.isNonUniformWithinEpsilon=function(e){var i=Math.abs(this._x),r=Math.abs(this._y);if(!P.a.WithinEpsilon(i,r,e))return!0;var o=Math.abs(this._z);return!P.a.WithinEpsilon(i,o,e)||!P.a.WithinEpsilon(r,o,e)},Object.defineProperty(t.prototype,"isNonUniform",{get:function(){var e=Math.abs(this._x),i=Math.abs(this._y);if(e!==i)return!0;var r=Math.abs(this._z);return e!==r},enumerable:!1,configurable:!0}),t.prototype.floor=function(){return new t(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z))},t.prototype.fract=function(){return new t(this._x-Math.floor(this._x),this._y-Math.floor(this._y),this._z-Math.floor(this._z))},t.prototype.length=function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z)},t.prototype.lengthSquared=function(){return this._x*this._x+this._y*this._y+this._z*this._z},t.prototype.normalize=function(){return this.normalizeFromLength(this.length())},t.prototype.reorderInPlace=function(e){var i=this;return e=e.toLowerCase(),e==="xyz"?this:(l.Vector3[0].copyFrom(this),["x","y","z"].forEach(function(r,o){i[r]=l.Vector3[0][e[o]]}),this)},t.prototype.rotateByQuaternionToRef=function(e,i){return e.toRotationMatrix(l.Matrix[0]),t.TransformCoordinatesToRef(this,l.Matrix[0],i),i},t.prototype.rotateByQuaternionAroundPointToRef=function(e,i,r){return this.subtractToRef(i,l.Vector3[0]),l.Vector3[0].rotateByQuaternionToRef(e,l.Vector3[0]),i.addToRef(l.Vector3[0],r),r},t.prototype.cross=function(e){return t.Cross(this,e)},t.prototype.normalizeFromLength=function(e){return e===0||e===1?this:this.scaleInPlace(1/e)},t.prototype.normalizeToNew=function(){var e=new t(0,0,0);return this.normalizeToRef(e),e},t.prototype.normalizeToRef=function(e){var i=this.length();return i===0||i===1?e.copyFromFloats(this._x,this._y,this._z):this.scaleToRef(1/i,e)},t.prototype.clone=function(){return new t(this._x,this._y,this._z)},t.prototype.copyFrom=function(e){return this.copyFromFloats(e._x,e._y,e._z)},t.prototype.copyFromFloats=function(e,i,r){return this.x=e,this.y=i,this.z=r,this},t.prototype.set=function(e,i,r){return this.copyFromFloats(e,i,r)},t.prototype.setAll=function(e){return this.x=this.y=this.z=e,this},t.GetClipFactor=function(e,i,r,o){var g=t.Dot(e,r)-o,y=t.Dot(i,r)-o,v=g/(g-y);return v},t.GetAngleBetweenVectors=function(e,i,r){var o=e.normalizeToRef(l.Vector3[1]),g=i.normalizeToRef(l.Vector3[2]),y=t.Dot(o,g),v=Math.acos(y),f=l.Vector3[3];return t.CrossToRef(o,g,f),t.Dot(f,r)>0?isNaN(v)?0:v:isNaN(v)?-Math.PI:-Math.acos(y)},t.FromArray=function(e,i){return i===void 0&&(i=0),new t(e[i],e[i+1],e[i+2])},t.FromFloatArray=function(e,i){return t.FromArray(e,i)},t.FromArrayToRef=function(e,i,r){r.x=e[i],r.y=e[i+1],r.z=e[i+2]},t.FromFloatArrayToRef=function(e,i,r){return t.FromArrayToRef(e,i,r)},t.FromFloatsToRef=function(e,i,r,o){o.copyFromFloats(e,i,r)},t.Zero=function(){return new t(0,0,0)},t.One=function(){return new t(1,1,1)},t.Up=function(){return new t(0,1,0)},Object.defineProperty(t,"UpReadOnly",{get:function(){return t._UpReadOnly},enumerable:!1,configurable:!0}),Object.defineProperty(t,"ZeroReadOnly",{get:function(){return t._ZeroReadOnly},enumerable:!1,configurable:!0}),t.Down=function(){return new t(0,-1,0)},t.Forward=function(e){return e===void 0&&(e=!1),new t(0,0,e?-1:1)},t.Backward=function(e){return e===void 0&&(e=!1),new t(0,0,e?1:-1)},t.Right=function(){return new t(1,0,0)},t.Left=function(){return new t(-1,0,0)},t.TransformCoordinates=function(e,i){var r=t.Zero();return t.TransformCoordinatesToRef(e,i,r),r},t.TransformCoordinatesToRef=function(e,i,r){t.TransformCoordinatesFromFloatsToRef(e._x,e._y,e._z,i,r)},t.TransformCoordinatesFromFloatsToRef=function(e,i,r,o,g){var y=o.m,v=e*y[0]+i*y[4]+r*y[8]+y[12],f=e*y[1]+i*y[5]+r*y[9]+y[13],b=e*y[2]+i*y[6]+r*y[10]+y[14],T=1/(e*y[3]+i*y[7]+r*y[11]+y[15]);g.x=v*T,g.y=f*T,g.z=b*T},t.TransformNormal=function(e,i){var r=t.Zero();return t.TransformNormalToRef(e,i,r),r},t.TransformNormalToRef=function(e,i,r){this.TransformNormalFromFloatsToRef(e._x,e._y,e._z,i,r)},t.TransformNormalFromFloatsToRef=function(e,i,r,o,g){var y=o.m;g.x=e*y[0]+i*y[4]+r*y[8],g.y=e*y[1]+i*y[5]+r*y[9],g.z=e*y[2]+i*y[6]+r*y[10]},t.CatmullRom=function(e,i,r,o,g){var y=g*g,v=g*y,f=.5*(2*i._x+(-e._x+r._x)*g+(2*e._x-5*i._x+4*r._x-o._x)*y+(-e._x+3*i._x-3*r._x+o._x)*v),b=.5*(2*i._y+(-e._y+r._y)*g+(2*e._y-5*i._y+4*r._y-o._y)*y+(-e._y+3*i._y-3*r._y+o._y)*v),T=.5*(2*i._z+(-e._z+r._z)*g+(2*e._z-5*i._z+4*r._z-o._z)*y+(-e._z+3*i._z-3*r._z+o._z)*v);return new t(f,b,T)},t.Clamp=function(e,i,r){var o=new t;return t.ClampToRef(e,i,r,o),o},t.ClampToRef=function(e,i,r,o){var g=e._x;g=g>r._x?r._x:g,g=g<i._x?i._x:g;var y=e._y;y=y>r._y?r._y:y,y=y<i._y?i._y:y;var v=e._z;v=v>r._z?r._z:v,v=v<i._z?i._z:v,o.copyFromFloats(g,y,v)},t.CheckExtends=function(e,i,r){i.minimizeInPlace(e),r.maximizeInPlace(e)},t.Hermite=function(e,i,r,o,g){var y=g*g,v=g*y,f=2*v-3*y+1,b=-2*v+3*y,T=v-2*y+g,E=v-y,O=e._x*f+r._x*b+i._x*T+o._x*E,D=e._y*f+r._y*b+i._y*T+o._y*E,F=e._z*f+r._z*b+i._z*T+o._z*E;return new t(O,D,F)},t.Lerp=function(e,i,r){var o=new t(0,0,0);return t.LerpToRef(e,i,r,o),o},t.LerpToRef=function(e,i,r,o){o.x=e._x+(i._x-e._x)*r,o.y=e._y+(i._y-e._y)*r,o.z=e._z+(i._z-e._z)*r},t.Dot=function(e,i){return e._x*i._x+e._y*i._y+e._z*i._z},t.Cross=function(e,i){var r=t.Zero();return t.CrossToRef(e,i,r),r},t.CrossToRef=function(e,i,r){var o=e._y*i._z-e._z*i._y,g=e._z*i._x-e._x*i._z,y=e._x*i._y-e._y*i._x;r.copyFromFloats(o,g,y)},t.Normalize=function(e){var i=t.Zero();return t.NormalizeToRef(e,i),i},t.NormalizeToRef=function(e,i){e.normalizeToRef(i)},t.Project=function(e,i,r,o){var g=new t;return t.ProjectToRef(e,i,r,o,g),g},t.ProjectToRef=function(e,i,r,o,g){var y=o.width,v=o.height,f=o.x,b=o.y,T=l.Matrix[1];p.FromValuesToRef(y/2,0,0,0,0,-v/2,0,0,0,0,.5,0,f+y/2,v/2+b,.5,1,T);var E=l.Matrix[0];return i.multiplyToRef(r,E),E.multiplyToRef(T,E),t.TransformCoordinatesToRef(e,E,g),g},t._UnprojectFromInvertedMatrixToRef=function(e,i,r){t.TransformCoordinatesToRef(e,i,r);var o=i.m,g=e._x*o[3]+e._y*o[7]+e._z*o[11]+o[15];P.a.WithinEpsilon(g,1)&&r.scaleInPlace(1/g)},t.UnprojectFromTransform=function(e,i,r,o,g){var y=l.Matrix[0];o.multiplyToRef(g,y),y.invert(),e.x=e._x/i*2-1,e.y=-(e._y/r*2-1);var v=new t;return t._UnprojectFromInvertedMatrixToRef(e,y,v),v},t.Unproject=function(e,i,r,o,g,y){var v=t.Zero();return t.UnprojectToRef(e,i,r,o,g,y,v),v},t.UnprojectToRef=function(e,i,r,o,g,y,v){t.UnprojectFloatsToRef(e._x,e._y,e._z,i,r,o,g,y,v)},t.UnprojectFloatsToRef=function(e,i,r,o,g,y,v,f,b){var T=l.Matrix[0];y.multiplyToRef(v,T),T.multiplyToRef(f,T),T.invert();var E=l.Vector3[0];E.x=e/o*2-1,E.y=-(i/g*2-1),E.z=2*r-1,t._UnprojectFromInvertedMatrixToRef(E,T,b)},t.Minimize=function(e,i){var r=e.clone();return r.minimizeInPlace(i),r},t.Maximize=function(e,i){var r=e.clone();return r.maximizeInPlace(i),r},t.Distance=function(e,i){return Math.sqrt(t.DistanceSquared(e,i))},t.DistanceSquared=function(e,i){var r=e._x-i._x,o=e._y-i._y,g=e._z-i._z;return r*r+o*o+g*g},t.Center=function(e,i){return t.CenterToRef(e,i,t.Zero())},t.CenterToRef=function(e,i,r){return r.copyFromFloats((e._x+i._x)/2,(e._y+i._y)/2,(e._z+i._z)/2)},t.RotationFromAxis=function(e,i,r){var o=t.Zero();return t.RotationFromAxisToRef(e,i,r,o),o},t.RotationFromAxisToRef=function(e,i,r,o){var g=l.Quaternion[0];u.RotationQuaternionFromAxisToRef(e,i,r,g),g.toEulerAnglesToRef(o)},t._UpReadOnly=t.Up(),t._ZeroReadOnly=t.Zero(),t}(),s=function(){function t(e,i,r,o){this.x=e,this.y=i,this.z=r,this.w=o}return t.prototype.toString=function(){return"{X: "+this.x+" Y:"+this.y+" Z:"+this.z+" W:"+this.w+"}"},t.prototype.getClassName=function(){return"Vector4"},t.prototype.getHashCode=function(){var e=this.x|0;return e=e*397^(this.y|0),e=e*397^(this.z|0),e=e*397^(this.w|0),e},t.prototype.asArray=function(){var e=new Array;return this.toArray(e,0),e},t.prototype.toArray=function(e,i){return i===void 0&&(i=0),e[i]=this.x,e[i+1]=this.y,e[i+2]=this.z,e[i+3]=this.w,this},t.prototype.fromArray=function(e,i){return i===void 0&&(i=0),t.FromArrayToRef(e,i,this),this},t.prototype.addInPlace=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this},t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y,this.z+e.z,this.w+e.w)},t.prototype.addToRef=function(e,i){return i.x=this.x+e.x,i.y=this.y+e.y,i.z=this.z+e.z,i.w=this.w+e.w,this},t.prototype.subtractInPlace=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this},t.prototype.subtract=function(e){return new t(this.x-e.x,this.y-e.y,this.z-e.z,this.w-e.w)},t.prototype.subtractToRef=function(e,i){return i.x=this.x-e.x,i.y=this.y-e.y,i.z=this.z-e.z,i.w=this.w-e.w,this},t.prototype.subtractFromFloats=function(e,i,r,o){return new t(this.x-e,this.y-i,this.z-r,this.w-o)},t.prototype.subtractFromFloatsToRef=function(e,i,r,o,g){return g.x=this.x-e,g.y=this.y-i,g.z=this.z-r,g.w=this.w-o,this},t.prototype.negate=function(){return new t(-this.x,-this.y,-this.z,-this.w)},t.prototype.negateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this},t.prototype.negateToRef=function(e){return e.copyFromFloats(this.x*-1,this.y*-1,this.z*-1,this.w*-1)},t.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},t.prototype.scale=function(e){return new t(this.x*e,this.y*e,this.z*e,this.w*e)},t.prototype.scaleToRef=function(e,i){return i.x=this.x*e,i.y=this.y*e,i.z=this.z*e,i.w=this.w*e,this},t.prototype.scaleAndAddToRef=function(e,i){return i.x+=this.x*e,i.y+=this.y*e,i.z+=this.z*e,i.w+=this.w*e,this},t.prototype.equals=function(e){return e&&this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w},t.prototype.equalsWithEpsilon=function(e,i){return i===void 0&&(i=d.a),e&&P.a.WithinEpsilon(this.x,e.x,i)&&P.a.WithinEpsilon(this.y,e.y,i)&&P.a.WithinEpsilon(this.z,e.z,i)&&P.a.WithinEpsilon(this.w,e.w,i)},t.prototype.equalsToFloats=function(e,i,r,o){return this.x===e&&this.y===i&&this.z===r&&this.w===o},t.prototype.multiplyInPlace=function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this},t.prototype.multiply=function(e){return new t(this.x*e.x,this.y*e.y,this.z*e.z,this.w*e.w)},t.prototype.multiplyToRef=function(e,i){return i.x=this.x*e.x,i.y=this.y*e.y,i.z=this.z*e.z,i.w=this.w*e.w,this},t.prototype.multiplyByFloats=function(e,i,r,o){return new t(this.x*e,this.y*i,this.z*r,this.w*o)},t.prototype.divide=function(e){return new t(this.x/e.x,this.y/e.y,this.z/e.z,this.w/e.w)},t.prototype.divideToRef=function(e,i){return i.x=this.x/e.x,i.y=this.y/e.y,i.z=this.z/e.z,i.w=this.w/e.w,this},t.prototype.divideInPlace=function(e){return this.divideToRef(e,this)},t.prototype.minimizeInPlace=function(e){return e.x<this.x&&(this.x=e.x),e.y<this.y&&(this.y=e.y),e.z<this.z&&(this.z=e.z),e.w<this.w&&(this.w=e.w),this},t.prototype.maximizeInPlace=function(e){return e.x>this.x&&(this.x=e.x),e.y>this.y&&(this.y=e.y),e.z>this.z&&(this.z=e.z),e.w>this.w&&(this.w=e.w),this},t.prototype.floor=function(){return new t(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))},t.prototype.fract=function(){return new t(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))},t.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},t.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},t.prototype.normalize=function(){var e=this.length();return e===0?this:this.scaleInPlace(1/e)},t.prototype.toVector3=function(){return new _(this.x,this.y,this.z)},t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},t.prototype.copyFromFloats=function(e,i,r,o){return this.x=e,this.y=i,this.z=r,this.w=o,this},t.prototype.set=function(e,i,r,o){return this.copyFromFloats(e,i,r,o)},t.prototype.setAll=function(e){return this.x=this.y=this.z=this.w=e,this},t.FromArray=function(e,i){return i||(i=0),new t(e[i],e[i+1],e[i+2],e[i+3])},t.FromArrayToRef=function(e,i,r){r.x=e[i],r.y=e[i+1],r.z=e[i+2],r.w=e[i+3]},t.FromFloatArrayToRef=function(e,i,r){t.FromArrayToRef(e,i,r)},t.FromFloatsToRef=function(e,i,r,o,g){g.x=e,g.y=i,g.z=r,g.w=o},t.Zero=function(){return new t(0,0,0,0)},t.One=function(){return new t(1,1,1,1)},t.Normalize=function(e){var i=t.Zero();return t.NormalizeToRef(e,i),i},t.NormalizeToRef=function(e,i){i.copyFrom(e),i.normalize()},t.Minimize=function(e,i){var r=e.clone();return r.minimizeInPlace(i),r},t.Maximize=function(e,i){var r=e.clone();return r.maximizeInPlace(i),r},t.Distance=function(e,i){return Math.sqrt(t.DistanceSquared(e,i))},t.DistanceSquared=function(e,i){var r=e.x-i.x,o=e.y-i.y,g=e.z-i.z,y=e.w-i.w;return r*r+o*o+g*g+y*y},t.Center=function(e,i){return t.CenterToRef(e,i,t.Zero())},t.CenterToRef=function(e,i,r){return r.copyFromFloats((e.x+i.x)/2,(e.y+i.y)/2,(e.z+i.z)/2,(e.w+i.w)/2)},t.TransformNormal=function(e,i){var r=t.Zero();return t.TransformNormalToRef(e,i,r),r},t.TransformNormalToRef=function(e,i,r){var o=i.m,g=e.x*o[0]+e.y*o[4]+e.z*o[8],y=e.x*o[1]+e.y*o[5]+e.z*o[9],v=e.x*o[2]+e.y*o[6]+e.z*o[10];r.x=g,r.y=y,r.z=v,r.w=e.w},t.TransformNormalFromFloatsToRef=function(e,i,r,o,g,y){var v=g.m;y.x=e*v[0]+i*v[4]+r*v[8],y.y=e*v[1]+i*v[5]+r*v[9],y.z=e*v[2]+i*v[6]+r*v[10],y.w=o},t.FromVector3=function(e,i){return i===void 0&&(i=0),new t(e._x,e._y,e._z,i)},t}(),u=function(){function t(e,i,r,o){e===void 0&&(e=0),i===void 0&&(i=0),r===void 0&&(r=0),o===void 0&&(o=1),this._isDirty=!0,this._x=e,this._y=i,this._z=r,this._w=o}return Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"z",{get:function(){return this._z},set:function(e){this._z=e,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"w",{get:function(){return this._w},set:function(e){this._w=e,this._isDirty=!0},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return"{X: "+this._x+" Y:"+this._y+" Z:"+this._z+" W:"+this._w+"}"},t.prototype.getClassName=function(){return"Quaternion"},t.prototype.getHashCode=function(){var e=this._x|0;return e=e*397^(this._y|0),e=e*397^(this._z|0),e=e*397^(this._w|0),e},t.prototype.asArray=function(){return[this._x,this._y,this._z,this._w]},t.prototype.equals=function(e){return e&&this._x===e._x&&this._y===e._y&&this._z===e._z&&this._w===e._w},t.prototype.equalsWithEpsilon=function(e,i){return i===void 0&&(i=d.a),e&&P.a.WithinEpsilon(this._x,e._x,i)&&P.a.WithinEpsilon(this._y,e._y,i)&&P.a.WithinEpsilon(this._z,e._z,i)&&P.a.WithinEpsilon(this._w,e._w,i)},t.prototype.clone=function(){return new t(this._x,this._y,this._z,this._w)},t.prototype.copyFrom=function(e){return this.x=e._x,this.y=e._y,this.z=e._z,this.w=e._w,this},t.prototype.copyFromFloats=function(e,i,r,o){return this.x=e,this.y=i,this.z=r,this.w=o,this},t.prototype.set=function(e,i,r,o){return this.copyFromFloats(e,i,r,o)},t.prototype.add=function(e){return new t(this._x+e._x,this._y+e._y,this._z+e._z,this._w+e._w)},t.prototype.addInPlace=function(e){return this._x+=e._x,this._y+=e._y,this._z+=e._z,this._w+=e._w,this},t.prototype.subtract=function(e){return new t(this._x-e._x,this._y-e._y,this._z-e._z,this._w-e._w)},t.prototype.scale=function(e){return new t(this._x*e,this._y*e,this._z*e,this._w*e)},t.prototype.scaleToRef=function(e,i){return i.x=this._x*e,i.y=this._y*e,i.z=this._z*e,i.w=this._w*e,this},t.prototype.scaleInPlace=function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},t.prototype.scaleAndAddToRef=function(e,i){return i.x+=this._x*e,i.y+=this._y*e,i.z+=this._z*e,i.w+=this._w*e,this},t.prototype.multiply=function(e){var i=new t(0,0,0,1);return this.multiplyToRef(e,i),i},t.prototype.multiplyToRef=function(e,i){var r=this._x*e._w+this._y*e._z-this._z*e._y+this._w*e._x,o=-this._x*e._z+this._y*e._w+this._z*e._x+this._w*e._y,g=this._x*e._y-this._y*e._x+this._z*e._w+this._w*e._z,y=-this._x*e._x-this._y*e._y-this._z*e._z+this._w*e._w;return i.copyFromFloats(r,o,g,y),this},t.prototype.multiplyInPlace=function(e){return this.multiplyToRef(e,this),this},t.prototype.conjugateToRef=function(e){return e.copyFromFloats(-this._x,-this._y,-this._z,this._w),this},t.prototype.conjugateInPlace=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},t.prototype.conjugate=function(){var e=new t(-this._x,-this._y,-this._z,this._w);return e},t.prototype.length=function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},t.prototype.normalize=function(){var e=this.length();if(e===0)return this;var i=1/e;return this.x*=i,this.y*=i,this.z*=i,this.w*=i,this},t.prototype.toEulerAngles=function(e){e===void 0&&(e="YZX");var i=_.Zero();return this.toEulerAnglesToRef(i),i},t.prototype.toEulerAnglesToRef=function(e){var i=this._z,r=this._x,o=this._y,g=this._w,y=g*g,v=i*i,f=r*r,b=o*o,T=o*i-r*g,E=.4999999;return T<-E?(e.y=2*Math.atan2(o,g),e.x=Math.PI/2,e.z=0):T>E?(e.y=2*Math.atan2(o,g),e.x=-Math.PI/2,e.z=0):(e.z=Math.atan2(2*(r*o+i*g),-v-f+b+y),e.x=Math.asin(-2*(i*o-r*g)),e.y=Math.atan2(2*(i*r+o*g),v-f-b+y)),this},t.prototype.toRotationMatrix=function(e){return p.FromQuaternionToRef(this,e),this},t.prototype.fromRotationMatrix=function(e){return t.FromRotationMatrixToRef(e,this),this},t.FromRotationMatrix=function(e){var i=new t;return t.FromRotationMatrixToRef(e,i),i},t.FromRotationMatrixToRef=function(e,i){var r=e.m,o=r[0],g=r[4],y=r[8],v=r[1],f=r[5],b=r[9],T=r[2],E=r[6],O=r[10],D=o+f+O,F;D>0?(F=.5/Math.sqrt(D+1),i.w=.25/F,i.x=(E-b)*F,i.y=(y-T)*F,i.z=(v-g)*F):o>f&&o>O?(F=2*Math.sqrt(1+o-f-O),i.w=(E-b)/F,i.x=.25*F,i.y=(g+v)/F,i.z=(y+T)/F):f>O?(F=2*Math.sqrt(1+f-o-O),i.w=(y-T)/F,i.x=(g+v)/F,i.y=.25*F,i.z=(b+E)/F):(F=2*Math.sqrt(1+O-o-f),i.w=(v-g)/F,i.x=(y+T)/F,i.y=(b+E)/F,i.z=.25*F)},t.Dot=function(e,i){return e._x*i._x+e._y*i._y+e._z*i._z+e._w*i._w},t.AreClose=function(e,i){var r=t.Dot(e,i);return r>=0},t.Zero=function(){return new t(0,0,0,0)},t.Inverse=function(e){return new t(-e._x,-e._y,-e._z,e._w)},t.InverseToRef=function(e,i){return i.set(-e._x,-e._y,-e._z,e._w),i},t.Identity=function(){return new t(0,0,0,1)},t.IsIdentity=function(e){return e&&e._x===0&&e._y===0&&e._z===0&&e._w===1},t.RotationAxis=function(e,i){return t.RotationAxisToRef(e,i,new t)},t.RotationAxisToRef=function(e,i,r){var o=Math.sin(i/2);return e.normalize(),r.w=Math.cos(i/2),r.x=e._x*o,r.y=e._y*o,r.z=e._z*o,r},t.FromArray=function(e,i){return i||(i=0),new t(e[i],e[i+1],e[i+2],e[i+3])},t.FromArrayToRef=function(e,i,r){r.x=e[i],r.y=e[i+1],r.z=e[i+2],r.w=e[i+3]},t.FromEulerAngles=function(e,i,r){var o=new t;return t.RotationYawPitchRollToRef(i,e,r,o),o},t.FromEulerAnglesToRef=function(e,i,r,o){return t.RotationYawPitchRollToRef(i,e,r,o),o},t.FromEulerVector=function(e){var i=new t;return t.RotationYawPitchRollToRef(e._y,e._x,e._z,i),i},t.FromEulerVectorToRef=function(e,i){return t.RotationYawPitchRollToRef(e._y,e._x,e._z,i),i},t.FromUnitVectorsToRef=function(e,i,r){var o=_.Dot(e,i)+1;return o<d.a?Math.abs(e.x)>Math.abs(e.z)?r.set(-e.y,e.x,0,0):r.set(0,-e.z,e.y,0):(_.CrossToRef(e,i,h.Vector3[0]),r.set(h.Vector3[0].x,h.Vector3[0].y,h.Vector3[0].z,o)),r.normalize()},t.RotationYawPitchRoll=function(e,i,r){var o=new t;return t.RotationYawPitchRollToRef(e,i,r,o),o},t.RotationYawPitchRollToRef=function(e,i,r,o){var g=r*.5,y=i*.5,v=e*.5,f=Math.sin(g),b=Math.cos(g),T=Math.sin(y),E=Math.cos(y),O=Math.sin(v),D=Math.cos(v);o.x=D*T*b+O*E*f,o.y=O*E*b-D*T*f,o.z=D*E*f-O*T*b,o.w=D*E*b+O*T*f},t.RotationAlphaBetaGamma=function(e,i,r){var o=new t;return t.RotationAlphaBetaGammaToRef(e,i,r,o),o},t.RotationAlphaBetaGammaToRef=function(e,i,r,o){var g=(r+e)*.5,y=(r-e)*.5,v=i*.5;o.x=Math.cos(y)*Math.sin(v),o.y=Math.sin(y)*Math.sin(v),o.z=Math.sin(g)*Math.cos(v),o.w=Math.cos(g)*Math.cos(v)},t.RotationQuaternionFromAxis=function(e,i,r){var o=new t(0,0,0,0);return t.RotationQuaternionFromAxisToRef(e,i,r,o),o},t.RotationQuaternionFromAxisToRef=function(e,i,r,o){var g=l.Matrix[0];p.FromXYZAxesToRef(e.normalize(),i.normalize(),r.normalize(),g),t.FromRotationMatrixToRef(g,o)},t.FromLookDirectionLH=function(e,i){var r=new t;return t.FromLookDirectionLHToRef(e,i,r),r},t.FromLookDirectionLHToRef=function(e,i,r){var o=l.Matrix[0];p.LookDirectionLHToRef(e,i,o),t.FromRotationMatrixToRef(o,r)},t.FromLookDirectionRH=function(e,i){var r=new t;return t.FromLookDirectionRHToRef(e,i,r),r},t.FromLookDirectionRHToRef=function(e,i,r){var o=l.Matrix[0];return p.LookDirectionRHToRef(e,i,o),t.FromRotationMatrixToRef(o,r)},t.Slerp=function(e,i,r){var o=t.Identity();return t.SlerpToRef(e,i,r,o),o},t.SlerpToRef=function(e,i,r,o){var g,y,v=e._x*i._x+e._y*i._y+e._z*i._z+e._w*i._w,f=!1;if(v<0&&(f=!0,v=-v),v>.999999)y=1-r,g=f?-r:r;else{var b=Math.acos(v),T=1/Math.sin(b);y=Math.sin((1-r)*b)*T,g=f?-Math.sin(r*b)*T:Math.sin(r*b)*T}o.x=y*e._x+g*i._x,o.y=y*e._y+g*i._y,o.z=y*e._z+g*i._z,o.w=y*e._w+g*i._w},t.Hermite=function(e,i,r,o,g){var y=g*g,v=g*y,f=2*v-3*y+1,b=-2*v+3*y,T=v-2*y+g,E=v-y,O=e._x*f+r._x*b+i._x*T+o._x*E,D=e._y*f+r._y*b+i._y*T+o._y*E,F=e._z*f+r._z*b+i._z*T+o._z*E,x=e._w*f+r._w*b+i._w*T+o._w*E;return new t(O,D,F,x)},t}(),p=function(){function t(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,c.a.MatrixTrackPrecisionChange&&c.a.MatrixTrackedMatrices.push(this),this._m=new c.a.MatrixCurrentType(16),this._updateIdentityStatus(!1)}return Object.defineProperty(t,"Use64Bits",{get:function(){return c.a.MatrixUse64Bits},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"m",{get:function(){return this._m},enumerable:!1,configurable:!0}),t.prototype._markAsUpdated=function(){this.updateFlag=t._updateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0},t.prototype._updateIdentityStatus=function(e,i,r,o){i===void 0&&(i=!1),r===void 0&&(r=!1),o===void 0&&(o=!0),this.updateFlag=t._updateFlagSeed++,this._isIdentity=e,this._isIdentity3x2=e||r,this._isIdentityDirty=this._isIdentity?!1:i,this._isIdentity3x2Dirty=this._isIdentity3x2?!1:o},t.prototype.isIdentity=function(){if(this._isIdentityDirty){this._isIdentityDirty=!1;var e=this._m;this._isIdentity=e[0]===1&&e[1]===0&&e[2]===0&&e[3]===0&&e[4]===0&&e[5]===1&&e[6]===0&&e[7]===0&&e[8]===0&&e[9]===0&&e[10]===1&&e[11]===0&&e[12]===0&&e[13]===0&&e[14]===0&&e[15]===1}return this._isIdentity},t.prototype.isIdentityAs3x2=function(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,this._m[0]!==1||this._m[5]!==1||this._m[15]!==1?this._isIdentity3x2=!1:this._m[1]!==0||this._m[2]!==0||this._m[3]!==0||this._m[4]!==0||this._m[6]!==0||this._m[7]!==0||this._m[8]!==0||this._m[9]!==0||this._m[10]!==0||this._m[11]!==0||this._m[12]!==0||this._m[13]!==0||this._m[14]!==0?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2},t.prototype.determinant=function(){if(this._isIdentity===!0)return 1;var e=this._m,i=e[0],r=e[1],o=e[2],g=e[3],y=e[4],v=e[5],f=e[6],b=e[7],T=e[8],E=e[9],O=e[10],D=e[11],F=e[12],x=e[13],j=e[14],V=e[15],z=O*V-j*D,w=E*V-x*D,R=E*j-x*O,L=T*V-F*D,N=T*j-O*F,B=T*x-F*E,X=+(v*z-f*w+b*R),K=-(y*z-f*L+b*N),G=+(y*w-v*L+b*B),I=-(y*R-v*N+f*B);return i*X+r*K+o*G+g*I},t.prototype.toArray=function(){return this._m},t.prototype.asArray=function(){return this._m},t.prototype.invert=function(){return this.invertToRef(this),this},t.prototype.reset=function(){return t.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this},t.prototype.add=function(e){var i=new t;return this.addToRef(e,i),i},t.prototype.addToRef=function(e,i){for(var r=this._m,o=i._m,g=e.m,y=0;y<16;y++)o[y]=r[y]+g[y];return i._markAsUpdated(),this},t.prototype.addToSelf=function(e){for(var i=this._m,r=e.m,o=0;o<16;o++)i[o]+=r[o];return this._markAsUpdated(),this},t.prototype.invertToRef=function(e){if(this._isIdentity===!0)return t.IdentityToRef(e),this;var i=this._m,r=i[0],o=i[1],g=i[2],y=i[3],v=i[4],f=i[5],b=i[6],T=i[7],E=i[8],O=i[9],D=i[10],F=i[11],x=i[12],j=i[13],V=i[14],z=i[15],w=D*z-V*F,R=O*z-j*F,L=O*V-j*D,N=E*z-x*F,B=E*V-D*x,X=E*j-x*O,K=+(f*w-b*R+T*L),G=-(v*w-b*N+T*B),I=+(v*R-f*N+T*X),A=-(v*L-f*B+b*X),S=r*K+o*G+g*I+y*A;if(S===0)return e.copyFrom(this),this;var C=1/S,U=b*z-V*T,k=f*z-j*T,J=f*V-j*b,Y=v*z-x*T,Z=v*V-x*b,Q=v*j-x*f,te=b*F-D*T,re=f*F-O*T,ae=f*D-O*b,ne=v*F-E*T,ie=v*D-E*b,fe=v*O-E*f,he=-(o*w-g*R+y*L),pe=+(r*w-g*N+y*B),ue=-(r*R-o*N+y*X),_e=+(r*L-o*B+g*X),ge=+(o*U-g*k+y*J),Ee=-(r*U-g*Y+y*Z),Te=+(r*k-o*Y+y*Q),Me=-(r*J-o*Z+g*Q),Re=-(o*te-g*re+y*ae),Ae=+(r*te-g*ne+y*ie),Pe=-(r*re-o*ne+y*fe),Oe=+(r*ae-o*ie+g*fe);return t.FromValuesToRef(K*C,he*C,ge*C,Re*C,G*C,pe*C,Ee*C,Ae*C,I*C,ue*C,Te*C,Pe*C,A*C,_e*C,Me*C,Oe*C,e),this},t.prototype.addAtIndex=function(e,i){return this._m[e]+=i,this._markAsUpdated(),this},t.prototype.multiplyAtIndex=function(e,i){return this._m[e]*=i,this._markAsUpdated(),this},t.prototype.setTranslationFromFloats=function(e,i,r){return this._m[12]=e,this._m[13]=i,this._m[14]=r,this._markAsUpdated(),this},t.prototype.addTranslationFromFloats=function(e,i,r){return this._m[12]+=e,this._m[13]+=i,this._m[14]+=r,this._markAsUpdated(),this},t.prototype.setTranslation=function(e){return this.setTranslationFromFloats(e._x,e._y,e._z)},t.prototype.getTranslation=function(){return new _(this._m[12],this._m[13],this._m[14])},t.prototype.getTranslationToRef=function(e){return e.x=this._m[12],e.y=this._m[13],e.z=this._m[14],this},t.prototype.removeRotationAndScaling=function(){var e=this.m;return t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,e[12],e[13],e[14],e[15],this),this._updateIdentityStatus(e[12]===0&&e[13]===0&&e[14]===0&&e[15]===1),this},t.prototype.multiply=function(e){var i=new t;return this.multiplyToRef(e,i),i},t.prototype.copyFrom=function(e){e.copyToArray(this._m);var i=e;return this._updateIdentityStatus(i._isIdentity,i._isIdentityDirty,i._isIdentity3x2,i._isIdentity3x2Dirty),this},t.prototype.copyToArray=function(e,i){i===void 0&&(i=0);var r=this._m;return e[i]=r[0],e[i+1]=r[1],e[i+2]=r[2],e[i+3]=r[3],e[i+4]=r[4],e[i+5]=r[5],e[i+6]=r[6],e[i+7]=r[7],e[i+8]=r[8],e[i+9]=r[9],e[i+10]=r[10],e[i+11]=r[11],e[i+12]=r[12],e[i+13]=r[13],e[i+14]=r[14],e[i+15]=r[15],this},t.prototype.multiplyToRef=function(e,i){return this._isIdentity?(i.copyFrom(e),this):e._isIdentity?(i.copyFrom(this),this):(this.multiplyToArray(e,i._m,0),i._markAsUpdated(),this)},t.prototype.multiplyToArray=function(e,i,r){var o=this._m,g=e.m,y=o[0],v=o[1],f=o[2],b=o[3],T=o[4],E=o[5],O=o[6],D=o[7],F=o[8],x=o[9],j=o[10],V=o[11],z=o[12],w=o[13],R=o[14],L=o[15],N=g[0],B=g[1],X=g[2],K=g[3],G=g[4],I=g[5],A=g[6],S=g[7],C=g[8],U=g[9],k=g[10],J=g[11],Y=g[12],Z=g[13],Q=g[14],te=g[15];return i[r]=y*N+v*G+f*C+b*Y,i[r+1]=y*B+v*I+f*U+b*Z,i[r+2]=y*X+v*A+f*k+b*Q,i[r+3]=y*K+v*S+f*J+b*te,i[r+4]=T*N+E*G+O*C+D*Y,i[r+5]=T*B+E*I+O*U+D*Z,i[r+6]=T*X+E*A+O*k+D*Q,i[r+7]=T*K+E*S+O*J+D*te,i[r+8]=F*N+x*G+j*C+V*Y,i[r+9]=F*B+x*I+j*U+V*Z,i[r+10]=F*X+x*A+j*k+V*Q,i[r+11]=F*K+x*S+j*J+V*te,i[r+12]=z*N+w*G+R*C+L*Y,i[r+13]=z*B+w*I+R*U+L*Z,i[r+14]=z*X+w*A+R*k+L*Q,i[r+15]=z*K+w*S+R*J+L*te,this},t.prototype.equals=function(e){var i=e;if(!i)return!1;if((this._isIdentity||i._isIdentity)&&!this._isIdentityDirty&&!i._isIdentityDirty)return this._isIdentity&&i._isIdentity;var r=this.m,o=i.m;return r[0]===o[0]&&r[1]===o[1]&&r[2]===o[2]&&r[3]===o[3]&&r[4]===o[4]&&r[5]===o[5]&&r[6]===o[6]&&r[7]===o[7]&&r[8]===o[8]&&r[9]===o[9]&&r[10]===o[10]&&r[11]===o[11]&&r[12]===o[12]&&r[13]===o[13]&&r[14]===o[14]&&r[15]===o[15]},t.prototype.clone=function(){var e=new t;return e.copyFrom(this),e},t.prototype.getClassName=function(){return"Matrix"},t.prototype.getHashCode=function(){for(var e=this._m[0]|0,i=1;i<16;i++)e=e*397^(this._m[i]|0);return e},t.prototype.decompose=function(e,i,r){if(this._isIdentity)return r&&r.setAll(0),e&&e.setAll(1),i&&i.copyFromFloats(0,0,0,1),!0;var o=this._m;if(r&&r.copyFromFloats(o[12],o[13],o[14]),e=e||l.Vector3[0],e.x=Math.sqrt(o[0]*o[0]+o[1]*o[1]+o[2]*o[2]),e.y=Math.sqrt(o[4]*o[4]+o[5]*o[5]+o[6]*o[6]),e.z=Math.sqrt(o[8]*o[8]+o[9]*o[9]+o[10]*o[10]),this.determinant()<=0&&(e.y*=-1),e._x===0||e._y===0||e._z===0)return i&&i.copyFromFloats(0,0,0,1),!1;if(i){var g=1/e._x,y=1/e._y,v=1/e._z;t.FromValuesToRef(o[0]*g,o[1]*g,o[2]*g,0,o[4]*y,o[5]*y,o[6]*y,0,o[8]*v,o[9]*v,o[10]*v,0,0,0,0,1,l.Matrix[0]),u.FromRotationMatrixToRef(l.Matrix[0],i)}return!0},t.prototype.getRow=function(e){if(e<0||e>3)return null;var i=e*4;return new s(this._m[i+0],this._m[i+1],this._m[i+2],this._m[i+3])},t.prototype.setRow=function(e,i){return this.setRowFromFloats(e,i.x,i.y,i.z,i.w)},t.prototype.transpose=function(){return t.Transpose(this)},t.prototype.transposeToRef=function(e){return t.TransposeToRef(this,e),this},t.prototype.setRowFromFloats=function(e,i,r,o,g){if(e<0||e>3)return this;var y=e*4;return this._m[y+0]=i,this._m[y+1]=r,this._m[y+2]=o,this._m[y+3]=g,this._markAsUpdated(),this},t.prototype.scale=function(e){var i=new t;return this.scaleToRef(e,i),i},t.prototype.scaleToRef=function(e,i){for(var r=0;r<16;r++)i._m[r]=this._m[r]*e;return i._markAsUpdated(),this},t.prototype.scaleAndAddToRef=function(e,i){for(var r=0;r<16;r++)i._m[r]+=this._m[r]*e;return i._markAsUpdated(),this},t.prototype.toNormalMatrix=function(e){var i=l.Matrix[0];this.invertToRef(i),i.transposeToRef(e);var r=e._m;t.FromValuesToRef(r[0],r[1],r[2],0,r[4],r[5],r[6],0,r[8],r[9],r[10],0,0,0,0,1,e)},t.prototype.getRotationMatrix=function(){var e=new t;return this.getRotationMatrixToRef(e),e},t.prototype.getRotationMatrixToRef=function(e){var i=l.Vector3[0];if(!this.decompose(i))return t.IdentityToRef(e),this;var r=this._m,o=1/i._x,g=1/i._y,y=1/i._z;return t.FromValuesToRef(r[0]*o,r[1]*o,r[2]*o,0,r[4]*g,r[5]*g,r[6]*g,0,r[8]*y,r[9]*y,r[10]*y,0,0,0,0,1,e),this},t.prototype.toggleModelMatrixHandInPlace=function(){var e=this._m;e[2]*=-1,e[6]*=-1,e[8]*=-1,e[9]*=-1,e[14]*=-1,this._markAsUpdated()},t.prototype.toggleProjectionMatrixHandInPlace=function(){var e=this._m;e[8]*=-1,e[9]*=-1,e[10]*=-1,e[11]*=-1,this._markAsUpdated()},t.FromArray=function(e,i){i===void 0&&(i=0);var r=new t;return t.FromArrayToRef(e,i,r),r},t.FromArrayToRef=function(e,i,r){for(var o=0;o<16;o++)r._m[o]=e[o+i];r._markAsUpdated()},t.FromFloat32ArrayToRefScaled=function(e,i,r,o){for(var g=0;g<16;g++)o._m[g]=e[g+i]*r;o._markAsUpdated()},Object.defineProperty(t,"IdentityReadOnly",{get:function(){return t._identityReadOnly},enumerable:!1,configurable:!0}),t.FromValuesToRef=function(e,i,r,o,g,y,v,f,b,T,E,O,D,F,x,j,V){var z=V._m;z[0]=e,z[1]=i,z[2]=r,z[3]=o,z[4]=g,z[5]=y,z[6]=v,z[7]=f,z[8]=b,z[9]=T,z[10]=E,z[11]=O,z[12]=D,z[13]=F,z[14]=x,z[15]=j,V._markAsUpdated()},t.FromValues=function(e,i,r,o,g,y,v,f,b,T,E,O,D,F,x,j){var V=new t,z=V._m;return z[0]=e,z[1]=i,z[2]=r,z[3]=o,z[4]=g,z[5]=y,z[6]=v,z[7]=f,z[8]=b,z[9]=T,z[10]=E,z[11]=O,z[12]=D,z[13]=F,z[14]=x,z[15]=j,V._markAsUpdated(),V},t.Compose=function(e,i,r){var o=new t;return t.ComposeToRef(e,i,r,o),o},t.ComposeToRef=function(e,i,r,o){var g=o._m,y=i._x,v=i._y,f=i._z,b=i._w,T=y+y,E=v+v,O=f+f,D=y*T,F=y*E,x=y*O,j=v*E,V=v*O,z=f*O,w=b*T,R=b*E,L=b*O,N=e._x,B=e._y,X=e._z;g[0]=(1-(j+z))*N,g[1]=(F+L)*N,g[2]=(x-R)*N,g[3]=0,g[4]=(F-L)*B,g[5]=(1-(D+z))*B,g[6]=(V+w)*B,g[7]=0,g[8]=(x+R)*X,g[9]=(V-w)*X,g[10]=(1-(D+j))*X,g[11]=0,g[12]=r._x,g[13]=r._y,g[14]=r._z,g[15]=1,o._markAsUpdated()},t.Identity=function(){var e=t.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return e._updateIdentityStatus(!0),e},t.IdentityToRef=function(e){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,e),e._updateIdentityStatus(!0)},t.Zero=function(){var e=t.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return e._updateIdentityStatus(!1),e},t.RotationX=function(e){var i=new t;return t.RotationXToRef(e,i),i},t.Invert=function(e){var i=new t;return e.invertToRef(i),i},t.RotationXToRef=function(e,i){var r=Math.sin(e),o=Math.cos(e);t.FromValuesToRef(1,0,0,0,0,o,r,0,0,-r,o,0,0,0,0,1,i),i._updateIdentityStatus(o===1&&r===0)},t.RotationY=function(e){var i=new t;return t.RotationYToRef(e,i),i},t.RotationYToRef=function(e,i){var r=Math.sin(e),o=Math.cos(e);t.FromValuesToRef(o,0,-r,0,0,1,0,0,r,0,o,0,0,0,0,1,i),i._updateIdentityStatus(o===1&&r===0)},t.RotationZ=function(e){var i=new t;return t.RotationZToRef(e,i),i},t.RotationZToRef=function(e,i){var r=Math.sin(e),o=Math.cos(e);t.FromValuesToRef(o,r,0,0,-r,o,0,0,0,0,1,0,0,0,0,1,i),i._updateIdentityStatus(o===1&&r===0)},t.RotationAxis=function(e,i){var r=new t;return t.RotationAxisToRef(e,i,r),r},t.RotationAxisToRef=function(e,i,r){var o=Math.sin(-i),g=Math.cos(-i),y=1-g;e.normalize();var v=r._m;v[0]=e._x*e._x*y+g,v[1]=e._x*e._y*y-e._z*o,v[2]=e._x*e._z*y+e._y*o,v[3]=0,v[4]=e._y*e._x*y+e._z*o,v[5]=e._y*e._y*y+g,v[6]=e._y*e._z*y-e._x*o,v[7]=0,v[8]=e._z*e._x*y-e._y*o,v[9]=e._z*e._y*y+e._x*o,v[10]=e._z*e._z*y+g,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,r._markAsUpdated()},t.RotationAlignToRef=function(e,i,r){var o=_.Cross(i,e),g=_.Dot(i,e),y=1/(1+g),v=r._m;v[0]=o._x*o._x*y+g,v[1]=o._y*o._x*y-o._z,v[2]=o._z*o._x*y+o._y,v[3]=0,v[4]=o._x*o._y*y+o._z,v[5]=o._y*o._y*y+g,v[6]=o._z*o._y*y-o._x,v[7]=0,v[8]=o._x*o._z*y-o._y,v[9]=o._y*o._z*y+o._x,v[10]=o._z*o._z*y+g,v[11]=0,v[12]=0,v[13]=0,v[14]=0,v[15]=1,r._markAsUpdated()},t.RotationYawPitchRoll=function(e,i,r){var o=new t;return t.RotationYawPitchRollToRef(e,i,r,o),o},t.RotationYawPitchRollToRef=function(e,i,r,o){u.RotationYawPitchRollToRef(e,i,r,l.Quaternion[0]),l.Quaternion[0].toRotationMatrix(o)},t.Scaling=function(e,i,r){var o=new t;return t.ScalingToRef(e,i,r,o),o},t.ScalingToRef=function(e,i,r,o){t.FromValuesToRef(e,0,0,0,0,i,0,0,0,0,r,0,0,0,0,1,o),o._updateIdentityStatus(e===1&&i===1&&r===1)},t.Translation=function(e,i,r){var o=new t;return t.TranslationToRef(e,i,r,o),o},t.TranslationToRef=function(e,i,r,o){t.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,e,i,r,1,o),o._updateIdentityStatus(e===0&&i===0&&r===0)},t.Lerp=function(e,i,r){var o=new t;return t.LerpToRef(e,i,r,o),o},t.LerpToRef=function(e,i,r,o){for(var g=o._m,y=e.m,v=i.m,f=0;f<16;f++)g[f]=y[f]*(1-r)+v[f]*r;o._markAsUpdated()},t.DecomposeLerp=function(e,i,r){var o=new t;return t.DecomposeLerpToRef(e,i,r,o),o},t.DecomposeLerpToRef=function(e,i,r,o){var g=l.Vector3[0],y=l.Quaternion[0],v=l.Vector3[1];e.decompose(g,y,v);var f=l.Vector3[2],b=l.Quaternion[1],T=l.Vector3[3];i.decompose(f,b,T);var E=l.Vector3[4];_.LerpToRef(g,f,r,E);var O=l.Quaternion[2];u.SlerpToRef(y,b,r,O);var D=l.Vector3[5];_.LerpToRef(v,T,r,D),t.ComposeToRef(E,O,D,o)},t.LookAtLH=function(e,i,r){var o=new t;return t.LookAtLHToRef(e,i,r,o),o},t.LookAtLHToRef=function(e,i,r,o){var g=l.Vector3[0],y=l.Vector3[1],v=l.Vector3[2];i.subtractToRef(e,v),v.normalize(),_.CrossToRef(r,v,g);var f=g.lengthSquared();f===0?g.x=1:g.normalizeFromLength(Math.sqrt(f)),_.CrossToRef(v,g,y),y.normalize();var b=-_.Dot(g,e),T=-_.Dot(y,e),E=-_.Dot(v,e);t.FromValuesToRef(g._x,y._x,v._x,0,g._y,y._y,v._y,0,g._z,y._z,v._z,0,b,T,E,1,o)},t.LookAtRH=function(e,i,r){var o=new t;return t.LookAtRHToRef(e,i,r,o),o},t.LookAtRHToRef=function(e,i,r,o){var g=l.Vector3[0],y=l.Vector3[1],v=l.Vector3[2];e.subtractToRef(i,v),v.normalize(),_.CrossToRef(r,v,g);var f=g.lengthSquared();f===0?g.x=1:g.normalizeFromLength(Math.sqrt(f)),_.CrossToRef(v,g,y),y.normalize();var b=-_.Dot(g,e),T=-_.Dot(y,e),E=-_.Dot(v,e);t.FromValuesToRef(g._x,y._x,v._x,0,g._y,y._y,v._y,0,g._z,y._z,v._z,0,b,T,E,1,o)},t.LookDirectionLH=function(e,i){var r=new t;return t.LookDirectionLHToRef(e,i,r),r},t.LookDirectionLHToRef=function(e,i,r){var o=l.Vector3[0];o.copyFrom(e),o.scaleInPlace(-1);var g=l.Vector3[1];_.CrossToRef(i,o,g),t.FromValuesToRef(g._x,g._y,g._z,0,i._x,i._y,i._z,0,o._x,o._y,o._z,0,0,0,0,1,r)},t.LookDirectionRH=function(e,i){var r=new t;return t.LookDirectionRHToRef(e,i,r),r},t.LookDirectionRHToRef=function(e,i,r){var o=l.Vector3[2];_.CrossToRef(i,e,o),t.FromValuesToRef(o._x,o._y,o._z,0,i._x,i._y,i._z,0,e._x,e._y,e._z,0,0,0,0,1,r)},t.OrthoLH=function(e,i,r,o){var g=new t;return t.OrthoLHToRef(e,i,r,o,g),g},t.OrthoLHToRef=function(e,i,r,o,g){var y=r,v=o,f=2/e,b=2/i,T=2/(v-y),E=-(v+y)/(v-y);t.FromValuesToRef(f,0,0,0,0,b,0,0,0,0,T,0,0,0,E,1,g),g._updateIdentityStatus(f===1&&b===1&&T===1&&E===0)},t.OrthoOffCenterLH=function(e,i,r,o,g,y){var v=new t;return t.OrthoOffCenterLHToRef(e,i,r,o,g,y,v),v},t.OrthoOffCenterLHToRef=function(e,i,r,o,g,y,v){var f=g,b=y,T=2/(i-e),E=2/(o-r),O=2/(b-f),D=-(b+f)/(b-f),F=(e+i)/(e-i),x=(o+r)/(r-o);t.FromValuesToRef(T,0,0,0,0,E,0,0,0,0,O,0,F,x,D,1,v),v._markAsUpdated()},t.OrthoOffCenterRH=function(e,i,r,o,g,y){var v=new t;return t.OrthoOffCenterRHToRef(e,i,r,o,g,y,v),v},t.OrthoOffCenterRHToRef=function(e,i,r,o,g,y,v){t.OrthoOffCenterLHToRef(e,i,r,o,g,y,v),v._m[10]*=-1},t.PerspectiveLH=function(e,i,r,o){var g=new t,y=r,v=o,f=2*y/e,b=2*y/i,T=(v+y)/(v-y),E=-2*v*y/(v-y);return t.FromValuesToRef(f,0,0,0,0,b,0,0,0,0,T,1,0,0,E,0,g),g._updateIdentityStatus(!1),g},t.PerspectiveFovLH=function(e,i,r,o){var g=new t;return t.PerspectiveFovLHToRef(e,i,r,o,g),g},t.PerspectiveFovLHToRef=function(e,i,r,o,g,y){y===void 0&&(y=!0);var v=r,f=o,b=1/Math.tan(e*.5),T=y?b/i:b,E=y?b:b*i,O=f!==0?(f+v)/(f-v):1,D=f!==0?-2*f*v/(f-v):-2*v;t.FromValuesToRef(T,0,0,0,0,E,0,0,0,0,O,1,0,0,D,0,g),g._updateIdentityStatus(!1)},t.PerspectiveFovReverseLHToRef=function(e,i,r,o,g,y){y===void 0&&(y=!0);var v=1/Math.tan(e*.5),f=y?v/i:v,b=y?v:v*i;t.FromValuesToRef(f,0,0,0,0,b,0,0,0,0,-r,1,0,0,1,0,g),g._updateIdentityStatus(!1)},t.PerspectiveFovRH=function(e,i,r,o){var g=new t;return t.PerspectiveFovRHToRef(e,i,r,o,g),g},t.PerspectiveFovRHToRef=function(e,i,r,o,g,y){y===void 0&&(y=!0);var v=r,f=o,b=1/Math.tan(e*.5),T=y?b/i:b,E=y?b:b*i,O=f!==0?-(f+v)/(f-v):-1,D=f!==0?-2*f*v/(f-v):-2*v;t.FromValuesToRef(T,0,0,0,0,E,0,0,0,0,O,-1,0,0,D,0,g),g._updateIdentityStatus(!1)},t.PerspectiveFovReverseRHToRef=function(e,i,r,o,g,y){y===void 0&&(y=!0);var v=1/Math.tan(e*.5),f=y?v/i:v,b=y?v:v*i;t.FromValuesToRef(f,0,0,0,0,b,0,0,0,0,-r,-1,0,0,-1,0,g),g._updateIdentityStatus(!1)},t.PerspectiveFovWebVRToRef=function(e,i,r,o,g){g===void 0&&(g=!1);var y=g?-1:1,v=Math.tan(e.upDegrees*Math.PI/180),f=Math.tan(e.downDegrees*Math.PI/180),b=Math.tan(e.leftDegrees*Math.PI/180),T=Math.tan(e.rightDegrees*Math.PI/180),E=2/(b+T),O=2/(v+f),D=o._m;D[0]=E,D[1]=D[2]=D[3]=D[4]=0,D[5]=O,D[6]=D[7]=0,D[8]=(b-T)*E*.5,D[9]=-((v-f)*O*.5),D[10]=-r/(i-r),D[11]=1*y,D[12]=D[13]=D[15]=0,D[14]=-(2*r*i)/(r-i),o._markAsUpdated()},t.GetFinalMatrix=function(e,i,r,o,g,y){var v=e.width,f=e.height,b=e.x,T=e.y,E=t.FromValues(v/2,0,0,0,0,-f/2,0,0,0,0,y-g,0,b+v/2,f/2+T,g,1),O=l.Matrix[0];return i.multiplyToRef(r,O),O.multiplyToRef(o,O),O.multiply(E)},t.GetAsMatrix2x2=function(e){var i=e.m,r=[i[0],i[1],i[4],i[5]];return c.a.MatrixUse64Bits?r:new Float32Array(r)},t.GetAsMatrix3x3=function(e){var i=e.m,r=[i[0],i[1],i[2],i[4],i[5],i[6],i[8],i[9],i[10]];return c.a.MatrixUse64Bits?r:new Float32Array(r)},t.Transpose=function(e){var i=new t;return t.TransposeToRef(e,i),i},t.TransposeToRef=function(e,i){var r=i._m,o=e.m;r[0]=o[0],r[1]=o[4],r[2]=o[8],r[3]=o[12],r[4]=o[1],r[5]=o[5],r[6]=o[9],r[7]=o[13],r[8]=o[2],r[9]=o[6],r[10]=o[10],r[11]=o[14],r[12]=o[3],r[13]=o[7],r[14]=o[11],r[15]=o[15],i._updateIdentityStatus(e._isIdentity,e._isIdentityDirty)},t.Reflection=function(e){var i=new t;return t.ReflectionToRef(e,i),i},t.ReflectionToRef=function(e,i){e.normalize();var r=e.normal.x,o=e.normal.y,g=e.normal.z,y=-2*r,v=-2*o,f=-2*g;t.FromValuesToRef(y*r+1,v*r,f*r,0,y*o,v*o+1,f*o,0,y*g,v*g,f*g+1,0,y*e.d,v*e.d,f*e.d,1,i)},t.FromXYZAxesToRef=function(e,i,r,o){t.FromValuesToRef(e._x,e._y,e._z,0,i._x,i._y,i._z,0,r._x,r._y,r._z,0,0,0,0,1,o)},t.FromQuaternionToRef=function(e,i){var r=e._x*e._x,o=e._y*e._y,g=e._z*e._z,y=e._x*e._y,v=e._z*e._w,f=e._z*e._x,b=e._y*e._w,T=e._y*e._z,E=e._x*e._w;i._m[0]=1-2*(o+g),i._m[1]=2*(y+v),i._m[2]=2*(f-b),i._m[3]=0,i._m[4]=2*(y-v),i._m[5]=1-2*(g+r),i._m[6]=2*(T+E),i._m[7]=0,i._m[8]=2*(f+b),i._m[9]=2*(T-E),i._m[10]=1-2*(o+r),i._m[11]=0,i._m[12]=0,i._m[13]=0,i._m[14]=0,i._m[15]=1,i._markAsUpdated()},t._updateFlagSeed=0,t._identityReadOnly=t.Identity(),t}(),l=function(){function t(){}return t.Vector3=m.a.BuildArray(6,_.Zero),t.Matrix=m.a.BuildArray(2,p.Identity),t.Quaternion=m.a.BuildArray(3,u.Zero),t}(),h=function(){function t(){}return t.Vector2=m.a.BuildArray(3,a.Zero),t.Vector3=m.a.BuildArray(13,_.Zero),t.Vector4=m.a.BuildArray(3,s.Zero),t.Quaternion=m.a.BuildArray(2,u.Zero),t.Matrix=m.a.BuildArray(8,p.Identity),t}();n.a.RegisteredTypes["BABYLON.Vector2"]=a,n.a.RegisteredTypes["BABYLON.Vector3"]=_,n.a.RegisteredTypes["BABYLON.Vector4"]=s,n.a.RegisteredTypes["BABYLON.Matrix"]=p},function($,W,M){"use strict";M.d(W,"a",function(){return P});var P=function(){function d(){}return d.GetClass=function(m){return this.RegisteredTypes&&this.RegisteredTypes[m]?this.RegisteredTypes[m]:null},d.RegisteredTypes={},d}()},function($,W,M){"use strict";M.d(W,"a",function(){return P}),M.d(W,"d",function(){return d}),M.d(W,"b",function(){return m}),M.d(W,"c",function(){return n});var P=function(){function c(a,_,s,u){_===void 0&&(_=!1),this.initialize(a,_,s,u)}return c.prototype.initialize=function(a,_,s,u){return _===void 0&&(_=!1),this.mask=a,this.skipNextObservers=_,this.target=s,this.currentTarget=u,this},c}(),d=function(){function c(a,_,s){s===void 0&&(s=null),this.callback=a,this.mask=_,this.scope=s,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1}return c}(),m=function(){function c(){}return c.prototype.dispose=function(){if(this._observers&&this._observables)for(var a=0;a<this._observers.length;a++)this._observables[a].remove(this._observers[a]);this._observers=null,this._observables=null},c.Watch=function(a,_,s,u){s===void 0&&(s=-1),u===void 0&&(u=null);var p=new c;p._observers=new Array,p._observables=a;for(var l=0,h=a;l<h.length;l++){var t=h[l],e=t.add(_,s,!1,u);e&&p._observers.push(e)}return p},c}(),n=function(){function c(a){this._observers=new Array,this._eventState=new P(0),a&&(this._onObserverAdded=a)}return Object.defineProperty(c.prototype,"observers",{get:function(){return this._observers},enumerable:!1,configurable:!0}),c.prototype.add=function(a,_,s,u,p){if(_===void 0&&(_=-1),s===void 0&&(s=!1),u===void 0&&(u=null),p===void 0&&(p=!1),!a)return null;var l=new d(a,_,u);return l.unregisterOnNextCall=p,s?this._observers.unshift(l):this._observers.push(l),this._onObserverAdded&&this._onObserverAdded(l),l},c.prototype.addOnce=function(a){return this.add(a,void 0,void 0,void 0,!0)},c.prototype.remove=function(a){if(!a)return!1;var _=this._observers.indexOf(a);return _!==-1?(this._deferUnregister(a),!0):!1},c.prototype.removeCallback=function(a,_){for(var s=0;s<this._observers.length;s++){var u=this._observers[s];if(!u._willBeUnregistered&&u.callback===a&&(!_||_===u.scope))return this._deferUnregister(u),!0}return!1},c.prototype._deferUnregister=function(a){var _=this;a.unregisterOnNextCall=!1,a._willBeUnregistered=!0,setTimeout(function(){_._remove(a)},0)},c.prototype._remove=function(a){if(!a)return!1;var _=this._observers.indexOf(a);return _!==-1?(this._observers.splice(_,1),!0):!1},c.prototype.makeObserverTopPriority=function(a){this._remove(a),this._observers.unshift(a)},c.prototype.makeObserverBottomPriority=function(a){this._remove(a),this._observers.push(a)},c.prototype.notifyObservers=function(a,_,s,u,p){if(_===void 0&&(_=-1),!this._observers.length)return!0;var l=this._eventState;l.mask=_,l.target=s,l.currentTarget=u,l.skipNextObservers=!1,l.lastReturnValue=a,l.userInfo=p;for(var h=0,t=this._observers;h<t.length;h++){var e=t[h];if(!e._willBeUnregistered&&(e.mask&_&&(e.scope?l.lastReturnValue=e.callback.apply(e.scope,[a,l]):l.lastReturnValue=e.callback(a,l),e.unregisterOnNextCall&&this._deferUnregister(e)),l.skipNextObservers))return!1}return!0},c.prototype.notifyObserversWithPromise=function(a,_,s,u,p){var l=this;_===void 0&&(_=-1);var h=Promise.resolve(a);if(!this._observers.length)return h;var t=this._eventState;return t.mask=_,t.target=s,t.currentTarget=u,t.skipNextObservers=!1,t.userInfo=p,this._observers.forEach(function(e){t.skipNextObservers||e._willBeUnregistered||e.mask&_&&(e.scope?h=h.then(function(i){return t.lastReturnValue=i,e.callback.apply(e.scope,[a,t])}):h=h.then(function(i){return t.lastReturnValue=i,e.callback(a,t)}),e.unregisterOnNextCall&&l._deferUnregister(e))}),h.then(function(){return a})},c.prototype.notifyObserver=function(a,_,s){if(s===void 0&&(s=-1),!a._willBeUnregistered){var u=this._eventState;u.mask=s,u.skipNextObservers=!1,a.callback(_,u),a.unregisterOnNextCall&&this._deferUnregister(a)}},c.prototype.hasObservers=function(){return this._observers.length>0},c.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},c.prototype.clone=function(){var a=new c;return a._observers=this._observers.slice(0),a},c.prototype.hasSpecificMask=function(a){a===void 0&&(a=-1);for(var _=0,s=this._observers;_<s.length;_++){var u=s[_];if(u.mask&a||u.mask===a)return!0}return!1},c}()},function($,W,M){"use strict";M.d(W,"b",function(){return h}),M.d(W,"c",function(){return t}),M.d(W,"m",function(){return e}),M.d(W,"e",function(){return i}),M.d(W,"h",function(){return r}),M.d(W,"n",function(){return o}),M.d(W,"o",function(){return g}),M.d(W,"k",function(){return y}),M.d(W,"g",function(){return v}),M.d(W,"f",function(){return f}),M.d(W,"i",function(){return b}),M.d(W,"l",function(){return T}),M.d(W,"j",function(){return E}),M.d(W,"d",function(){return O}),M.d(W,"a",function(){return D});var P=M(663),d=M(436),m=M(476),n=M(441),c={},a={},_=function(F,x,j){var V=F();P.a&&P.a.AddTagsTo(V,x.tags);var z=u(V);for(var w in z){var R=z[w],L=x[w],N=R.type;if(L!=null&&w!=="uniqueId")switch(N){case 0:case 6:case 11:V[w]=L;break;case 1:V[w]=j||L.isRenderTarget?L:L.clone();break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:V[w]=j?L:L.clone();break}}return V};function s(F){var x=F.getClassName();return c[x]||(c[x]={}),c[x]}function u(F){var x=F.getClassName();if(a[x])return a[x];a[x]={};for(var j=a[x],V=F,z=x;z;){var w=c[z];for(var R in w)j[R]=w[R];var L=void 0,N=!1;do{if(L=Object.getPrototypeOf(V),!L.getClassName){N=!0;break}if(L.getClassName()!==z)break;V=L}while(L);if(N)break;z=L.getClassName(),V=L}return j}function p(F,x){return function(j,V){var z=s(j);z[V]||(z[V]={type:F,sourceName:x})}}function l(F,x){return x===void 0&&(x=null),function(j,V){var z=x||"_"+V;Object.defineProperty(j,V,{get:function(){return this[z]},set:function(w){this[z]!==w&&(this[z]=w,j[F].apply(this))},enumerable:!0,configurable:!0})}}function h(F,x){return x===void 0&&(x=null),l(F,x)}function t(F){return p(0,F)}function e(F){return p(1,F)}function i(F){return p(2,F)}function r(F){return p(3,F)}function o(F){return p(4,F)}function g(F){return p(5,F)}function y(F){return p(6,F)}function v(F){return p(7,F)}function f(F){return p(8,F)}function b(F){return p(9,F)}function T(F){return p(10,F)}function E(F){return p(12,F)}function O(F){return p(11,F)}var D=function(){function F(){}return F.AppendSerializedAnimations=function(x,j){if(x.animations){j.animations=[];for(var V=0;V<x.animations.length;V++){var z=x.animations[V];j.animations.push(z.serialize())}}},F.Serialize=function(x,j){j||(j={}),P.a&&(j.tags=P.a.GetTags(x));var V=u(x);for(var z in V){var w=V[z],R=w.sourceName||z,L=w.type,N=x[z];if(N!=null&&z!=="uniqueId")switch(L){case 0:j[R]=N;break;case 1:j[R]=N.serialize();break;case 2:j[R]=N.asArray();break;case 3:j[R]=N.serialize();break;case 4:j[R]=N.asArray();break;case 5:j[R]=N.asArray();break;case 6:j[R]=N.id;break;case 7:j[R]=N.serialize();break;case 8:j[R]=N.asArray();break;case 9:j[R]=N.serialize();break;case 10:j[R]=N.asArray();break;case 11:j[R]=N.id;break;case 12:j[R]=N.asArray();break}}return j},F.Parse=function(x,j,V,z){z===void 0&&(z=null);var w=x();z||(z=""),P.a&&P.a.AddTagsTo(w,j.tags);var R=u(w);for(var L in R){var N=R[L],B=j[N.sourceName||L],X=N.type;if(B!=null&&L!=="uniqueId"){var K=w;switch(X){case 0:K[L]=B;break;case 1:V&&(K[L]=F._TextureParser(B,V,z));break;case 2:K[L]=n.a.FromArray(B);break;case 3:K[L]=F._FresnelParametersParser(B);break;case 4:K[L]=d.d.FromArray(B);break;case 5:K[L]=d.e.FromArray(B);break;case 6:V&&(K[L]=V.getLastMeshByID(B));break;case 7:K[L]=F._ColorCurvesParser(B);break;case 8:K[L]=n.b.FromArray(B);break;case 9:K[L]=F._ImageProcessingConfigurationParser(B);break;case 10:K[L]=d.b.FromArray(B);break;case 11:V&&(K[L]=V.getCameraByID(B));case 12:K[L]=d.a.FromArray(B);break}}}return w},F.Clone=function(x,j){return _(x,j,!1)},F.Instanciate=function(x,j){return _(x,j,!0)},F._ImageProcessingConfigurationParser=function(x){throw m.a.WarnImport("ImageProcessingConfiguration")},F._FresnelParametersParser=function(x){throw m.a.WarnImport("FresnelParameters")},F._ColorCurvesParser=function(x){throw m.a.WarnImport("ColorCurves")},F._TextureParser=function(x,j,V){throw m.a.WarnImport("Texture")},F}()},function($,W,M){"use strict";M.d(W,"a",function(){return P});var P=function(){function d(){}return d._CheckLimit=function(m,n){var c=d._LogLimitOutputs[m];return c?c.current++:(c={limit:n,current:1},d._LogLimitOutputs[m]=c),c.current<=c.limit},d._GenerateLimitMessage=function(m,n){var c=d._LogLimitOutputs[m];if(!(!c||!d.MessageLimitReached)&&c.current===c.limit)switch(n){case 0:d.Log(d.MessageLimitReached.replace(/%LIMIT%/g,""+c.limit).replace(/%TYPE%/g,"log"));break;case 1:d.Warn(d.MessageLimitReached.replace(/%LIMIT%/g,""+c.limit).replace(/%TYPE%/g,"warning"));break;case 2:d.Error(d.MessageLimitReached.replace(/%LIMIT%/g,""+c.limit).replace(/%TYPE%/g,"error"));break}},d._AddLogEntry=function(m){d._LogCache=m+d._LogCache,d.OnNewCacheEntry&&d.OnNewCacheEntry(m)},d._FormatMessage=function(m){var n=function(a){return a<10?"0"+a:""+a},c=new Date;return"["+n(c.getHours())+":"+n(c.getMinutes())+":"+n(c.getSeconds())+"]: "+m},d._LogDisabled=function(m,n){},d._LogEnabled=function(m,n){if(!(n!==void 0&&!d._CheckLimit(m,n))){var c=d._FormatMessage(m);console.log("BJS - "+c);var a="<div style='color:white'>"+c+"</div><br>";d._AddLogEntry(a),d._GenerateLimitMessage(m,0)}},d._WarnDisabled=function(m,n){},d._WarnEnabled=function(m,n){if(!(n!==void 0&&!d._CheckLimit(m,n))){var c=d._FormatMessage(m);console.warn("BJS - "+c);var a="<div style='color:orange'>"+m+"</div><br>";d._AddLogEntry(a),d._GenerateLimitMessage(m,1)}},d._ErrorDisabled=function(m,n){},d._ErrorEnabled=function(m,n){if(!(n!==void 0&&!d._CheckLimit(m,n))){var c=d._FormatMessage(m);d.errorsCount++,console.error("BJS - "+c);var a="<div style='color:red'>"+c+"</div><br>";d._AddLogEntry(a),d._GenerateLimitMessage(m,2)}},Object.defineProperty(d,"LogCache",{get:function(){return d._LogCache},enumerable:!1,configurable:!0}),d.ClearLogCache=function(){d._LogCache="",d._LogLimitOutputs={},d.errorsCount=0},Object.defineProperty(d,"LogLevels",{set:function(m){(m&d.MessageLogLevel)===d.MessageLogLevel?d.Log=d._LogEnabled:d.Log=d._LogDisabled,(m&d.WarningLogLevel)===d.WarningLogLevel?d.Warn=d._WarnEnabled:d.Warn=d._WarnDisabled,(m&d.ErrorLogLevel)===d.ErrorLogLevel?d.Error=d._ErrorEnabled:d.Error=d._ErrorDisabled},enumerable:!1,configurable:!0}),d.NoneLogLevel=0,d.MessageLogLevel=1,d.WarningLogLevel=2,d.ErrorLogLevel=4,d.AllLogLevel=7,d.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",d._LogCache="",d._LogLimitOutputs={},d.errorsCount=0,d.Log=d._LogEnabled,d.Warn=d._WarnEnabled,d.Error=d._ErrorEnabled,d}()},function($,W,M){"use strict";M.d(W,"a",function(){return c}),M.d(W,"b",function(){return a}),M.d(W,"c",function(){return _});var P=M(450),d=M(515),m=M(588),n=M(437),c=function(){function s(u,p,l){u===void 0&&(u=0),p===void 0&&(p=0),l===void 0&&(l=0),this.r=u,this.g=p,this.b=l}return s.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"},s.prototype.getClassName=function(){return"Color3"},s.prototype.getHashCode=function(){var u=this.r*255|0;return u=u*397^(this.g*255|0),u=u*397^(this.b*255|0),u},s.prototype.toArray=function(u,p){return p===void 0&&(p=0),u[p]=this.r,u[p+1]=this.g,u[p+2]=this.b,this},s.prototype.fromArray=function(u,p){return p===void 0&&(p=0),s.FromArrayToRef(u,p,this),this},s.prototype.toColor4=function(u){return u===void 0&&(u=1),new a(this.r,this.g,this.b,u)},s.prototype.asArray=function(){var u=new Array;return this.toArray(u,0),u},s.prototype.toLuminance=function(){return this.r*.3+this.g*.59+this.b*.11},s.prototype.multiply=function(u){return new s(this.r*u.r,this.g*u.g,this.b*u.b)},s.prototype.multiplyToRef=function(u,p){return p.r=this.r*u.r,p.g=this.g*u.g,p.b=this.b*u.b,this},s.prototype.equals=function(u){return u&&this.r===u.r&&this.g===u.g&&this.b===u.b},s.prototype.equalsFloats=function(u,p,l){return this.r===u&&this.g===p&&this.b===l},s.prototype.scale=function(u){return new s(this.r*u,this.g*u,this.b*u)},s.prototype.scaleToRef=function(u,p){return p.r=this.r*u,p.g=this.g*u,p.b=this.b*u,this},s.prototype.scaleAndAddToRef=function(u,p){return p.r+=this.r*u,p.g+=this.g*u,p.b+=this.b*u,this},s.prototype.clampToRef=function(u,p,l){return u===void 0&&(u=0),p===void 0&&(p=1),l.r=P.a.Clamp(this.r,u,p),l.g=P.a.Clamp(this.g,u,p),l.b=P.a.Clamp(this.b,u,p),this},s.prototype.add=function(u){return new s(this.r+u.r,this.g+u.g,this.b+u.b)},s.prototype.addToRef=function(u,p){return p.r=this.r+u.r,p.g=this.g+u.g,p.b=this.b+u.b,this},s.prototype.subtract=function(u){return new s(this.r-u.r,this.g-u.g,this.b-u.b)},s.prototype.subtractToRef=function(u,p){return p.r=this.r-u.r,p.g=this.g-u.g,p.b=this.b-u.b,this},s.prototype.clone=function(){return new s(this.r,this.g,this.b)},s.prototype.copyFrom=function(u){return this.r=u.r,this.g=u.g,this.b=u.b,this},s.prototype.copyFromFloats=function(u,p,l){return this.r=u,this.g=p,this.b=l,this},s.prototype.set=function(u,p,l){return this.copyFromFloats(u,p,l)},s.prototype.toHexString=function(){var u=Math.round(this.r*255),p=Math.round(this.g*255),l=Math.round(this.b*255);return"#"+P.a.ToHex(u)+P.a.ToHex(p)+P.a.ToHex(l)},s.prototype.toLinearSpace=function(){var u=new s;return this.toLinearSpaceToRef(u),u},s.prototype.toHSV=function(){var u=new s;return this.toHSVToRef(u),u},s.prototype.toHSVToRef=function(u){var p=this.r,l=this.g,h=this.b,t=Math.max(p,l,h),e=Math.min(p,l,h),i=0,r=0,o=t,g=t-e;t!==0&&(r=g/t),t!=e&&(t==p?(i=(l-h)/g,l<h&&(i+=6)):t==l?i=(h-p)/g+2:t==h&&(i=(p-l)/g+4),i*=60),u.r=i,u.g=r,u.b=o},s.prototype.toLinearSpaceToRef=function(u){return u.r=Math.pow(this.r,d.c),u.g=Math.pow(this.g,d.c),u.b=Math.pow(this.b,d.c),this},s.prototype.toGammaSpace=function(){var u=new s;return this.toGammaSpaceToRef(u),u},s.prototype.toGammaSpaceToRef=function(u){return u.r=Math.pow(this.r,d.b),u.g=Math.pow(this.g,d.b),u.b=Math.pow(this.b,d.b),this},s.HSVtoRGBToRef=function(u,p,l,h){var t=l*p,e=u/60,i=t*(1-Math.abs(e%2-1)),r=0,o=0,g=0;e>=0&&e<=1?(r=t,o=i):e>=1&&e<=2?(r=i,o=t):e>=2&&e<=3?(o=t,g=i):e>=3&&e<=4?(o=i,g=t):e>=4&&e<=5?(r=i,g=t):e>=5&&e<=6&&(r=t,g=i);var y=l-t;h.set(r+y,o+y,g+y)},s.FromHexString=function(u){if(u.substring(0,1)!=="#"||u.length!==7)return new s(0,0,0);var p=parseInt(u.substring(1,3),16),l=parseInt(u.substring(3,5),16),h=parseInt(u.substring(5,7),16);return s.FromInts(p,l,h)},s.FromArray=function(u,p){return p===void 0&&(p=0),new s(u[p],u[p+1],u[p+2])},s.FromArrayToRef=function(u,p,l){p===void 0&&(p=0),l.r=u[p],l.g=u[p+1],l.b=u[p+2]},s.FromInts=function(u,p,l){return new s(u/255,p/255,l/255)},s.Lerp=function(u,p,l){var h=new s(0,0,0);return s.LerpToRef(u,p,l,h),h},s.LerpToRef=function(u,p,l,h){h.r=u.r+(p.r-u.r)*l,h.g=u.g+(p.g-u.g)*l,h.b=u.b+(p.b-u.b)*l},s.Red=function(){return new s(1,0,0)},s.Green=function(){return new s(0,1,0)},s.Blue=function(){return new s(0,0,1)},s.Black=function(){return new s(0,0,0)},Object.defineProperty(s,"BlackReadOnly",{get:function(){return s._BlackReadOnly},enumerable:!1,configurable:!0}),s.White=function(){return new s(1,1,1)},s.Purple=function(){return new s(.5,0,.5)},s.Magenta=function(){return new s(1,0,1)},s.Yellow=function(){return new s(1,1,0)},s.Gray=function(){return new s(.5,.5,.5)},s.Teal=function(){return new s(0,1,1)},s.Random=function(){return new s(Math.random(),Math.random(),Math.random())},s._BlackReadOnly=s.Black(),s}(),a=function(){function s(u,p,l,h){u===void 0&&(u=0),p===void 0&&(p=0),l===void 0&&(l=0),h===void 0&&(h=1),this.r=u,this.g=p,this.b=l,this.a=h}return s.prototype.addInPlace=function(u){return this.r+=u.r,this.g+=u.g,this.b+=u.b,this.a+=u.a,this},s.prototype.asArray=function(){var u=new Array;return this.toArray(u,0),u},s.prototype.toArray=function(u,p){return p===void 0&&(p=0),u[p]=this.r,u[p+1]=this.g,u[p+2]=this.b,u[p+3]=this.a,this},s.prototype.fromArray=function(u,p){return p===void 0&&(p=0),s.FromArrayToRef(u,p,this),this},s.prototype.equals=function(u){return u&&this.r===u.r&&this.g===u.g&&this.b===u.b&&this.a===u.a},s.prototype.add=function(u){return new s(this.r+u.r,this.g+u.g,this.b+u.b,this.a+u.a)},s.prototype.subtract=function(u){return new s(this.r-u.r,this.g-u.g,this.b-u.b,this.a-u.a)},s.prototype.subtractToRef=function(u,p){return p.r=this.r-u.r,p.g=this.g-u.g,p.b=this.b-u.b,p.a=this.a-u.a,this},s.prototype.scale=function(u){return new s(this.r*u,this.g*u,this.b*u,this.a*u)},s.prototype.scaleToRef=function(u,p){return p.r=this.r*u,p.g=this.g*u,p.b=this.b*u,p.a=this.a*u,this},s.prototype.scaleAndAddToRef=function(u,p){return p.r+=this.r*u,p.g+=this.g*u,p.b+=this.b*u,p.a+=this.a*u,this},s.prototype.clampToRef=function(u,p,l){return u===void 0&&(u=0),p===void 0&&(p=1),l.r=P.a.Clamp(this.r,u,p),l.g=P.a.Clamp(this.g,u,p),l.b=P.a.Clamp(this.b,u,p),l.a=P.a.Clamp(this.a,u,p),this},s.prototype.multiply=function(u){return new s(this.r*u.r,this.g*u.g,this.b*u.b,this.a*u.a)},s.prototype.multiplyToRef=function(u,p){return p.r=this.r*u.r,p.g=this.g*u.g,p.b=this.b*u.b,p.a=this.a*u.a,p},s.prototype.toString=function(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"},s.prototype.getClassName=function(){return"Color4"},s.prototype.getHashCode=function(){var u=this.r*255|0;return u=u*397^(this.g*255|0),u=u*397^(this.b*255|0),u=u*397^(this.a*255|0),u},s.prototype.clone=function(){return new s(this.r,this.g,this.b,this.a)},s.prototype.copyFrom=function(u){return this.r=u.r,this.g=u.g,this.b=u.b,this.a=u.a,this},s.prototype.copyFromFloats=function(u,p,l,h){return this.r=u,this.g=p,this.b=l,this.a=h,this},s.prototype.set=function(u,p,l,h){return this.copyFromFloats(u,p,l,h)},s.prototype.toHexString=function(u){u===void 0&&(u=!1);var p=Math.round(this.r*255),l=Math.round(this.g*255),h=Math.round(this.b*255);if(u)return"#"+P.a.ToHex(p)+P.a.ToHex(l)+P.a.ToHex(h);var t=Math.round(this.a*255);return"#"+P.a.ToHex(p)+P.a.ToHex(l)+P.a.ToHex(h)+P.a.ToHex(t)},s.prototype.toLinearSpace=function(){var u=new s;return this.toLinearSpaceToRef(u),u},s.prototype.toLinearSpaceToRef=function(u){return u.r=Math.pow(this.r,d.c),u.g=Math.pow(this.g,d.c),u.b=Math.pow(this.b,d.c),u.a=this.a,this},s.prototype.toGammaSpace=function(){var u=new s;return this.toGammaSpaceToRef(u),u},s.prototype.toGammaSpaceToRef=function(u){return u.r=Math.pow(this.r,d.b),u.g=Math.pow(this.g,d.b),u.b=Math.pow(this.b,d.b),u.a=this.a,this},s.FromHexString=function(u){if(u.substring(0,1)!=="#"||u.length!==9)return new s(0,0,0,0);var p=parseInt(u.substring(1,3),16),l=parseInt(u.substring(3,5),16),h=parseInt(u.substring(5,7),16),t=parseInt(u.substring(7,9),16);return s.FromInts(p,l,h,t)},s.Lerp=function(u,p,l){var h=new s(0,0,0,0);return s.LerpToRef(u,p,l,h),h},s.LerpToRef=function(u,p,l,h){h.r=u.r+(p.r-u.r)*l,h.g=u.g+(p.g-u.g)*l,h.b=u.b+(p.b-u.b)*l,h.a=u.a+(p.a-u.a)*l},s.FromColor3=function(u,p){return p===void 0&&(p=1),new s(u.r,u.g,u.b,p)},s.FromArray=function(u,p){return p===void 0&&(p=0),new s(u[p],u[p+1],u[p+2],u[p+3])},s.FromArrayToRef=function(u,p,l){p===void 0&&(p=0),l.r=u[p],l.g=u[p+1],l.b=u[p+2],l.a=u[p+3]},s.FromInts=function(u,p,l,h){return new s(u/255,p/255,l/255,h/255)},s.CheckColors4=function(u,p){if(u.length===p*3){for(var l=[],h=0;h<u.length;h+=3){var t=h/3*4;l[t]=u[h],l[t+1]=u[h+1],l[t+2]=u[h+2],l[t+3]=1}return l}return u},s}(),_=function(){function s(){}return s.Color3=m.a.BuildArray(3,c.Black),s.Color4=m.a.BuildArray(3,function(){return new a(0,0,0,0)}),s}();n.a.RegisteredTypes["BABYLON.Color3"]=c,n.a.RegisteredTypes["BABYLON.Color4"]=a},function($,W,M){"use strict";M.d(W,"a",function(){return t});var P=M(434),d=M(439),m=M(438),n=M(436),c=M(477),a=M(437),_=M(476),s=M(760),u=M(788),p=M(603),l=M(473),h=M(725),t=function(e){Object(P.d)(i,e);function i(r,o,g,y,v,f,b,T,E,O,D,F){g===void 0&&(g=!1),y===void 0&&(y=!0),v===void 0&&(v=i.TRILINEAR_SAMPLINGMODE),f===void 0&&(f=null),b===void 0&&(b=null),T===void 0&&(T=null),E===void 0&&(E=!1);var x=e.call(this,o)||this;x.url=null,x.uOffset=0,x.vOffset=0,x.uScale=1,x.vScale=1,x.uAng=0,x.vAng=0,x.wAng=0,x.uRotationCenter=.5,x.vRotationCenter=.5,x.wRotationCenter=.5,x.homogeneousRotationInUVTransform=!1,x.inspectableCustomProperties=null,x._noMipmap=!1,x._invertY=!1,x._rowGenerationMatrix=null,x._cachedTextureMatrix=null,x._projectionModeMatrix=null,x._t0=null,x._t1=null,x._t2=null,x._cachedUOffset=-1,x._cachedVOffset=-1,x._cachedUScale=0,x._cachedVScale=0,x._cachedUAng=-1,x._cachedVAng=-1,x._cachedWAng=-1,x._cachedProjectionMatrixId=-1,x._cachedURotationCenter=-1,x._cachedVRotationCenter=-1,x._cachedWRotationCenter=-1,x._cachedHomogeneousRotationInUVTransform=!1,x._cachedCoordinatesMode=-1,x._initialSamplingMode=i.BILINEAR_SAMPLINGMODE,x._buffer=null,x._deleteBuffer=!1,x._format=null,x._delayedOnLoad=null,x._delayedOnError=null,x.onLoadObservable=new m.c,x._isBlocking=!0,x.name=r||"",x.url=r,x._noMipmap=g,x._invertY=y,x._initialSamplingMode=v,x._buffer=T,x._deleteBuffer=E,x._mimeType=D,x._loaderOptions=F,O&&(x._format=O);var j=x.getScene(),V=x._getEngine();if(!V)return x;V.onBeforeTextureInitObservable.notifyObservers(x);var z=function(){x._texture&&(x._texture._invertVScale&&(x.vScale*=-1,x.vOffset+=1),x._texture._cachedWrapU!==null&&(x.wrapU=x._texture._cachedWrapU,x._texture._cachedWrapU=null),x._texture._cachedWrapV!==null&&(x.wrapV=x._texture._cachedWrapV,x._texture._cachedWrapV=null),x._texture._cachedWrapR!==null&&(x.wrapR=x._texture._cachedWrapR,x._texture._cachedWrapR=null)),x.onLoadObservable.hasObservers()&&x.onLoadObservable.notifyObservers(x),f&&f(),!x.isBlocking&&j&&j.resetCachedMaterial()};return x.url?(x._texture=x._getFromCache(x.url,g,v,y),x._texture?x._texture.isReady?s.a.SetImmediate(function(){return z()}):x._texture.onLoadedObservable.add(z):!j||!j.useDelayedTextureLoading?(x._texture=V.createTexture(x.url,g,y,j,v,z,b,x._buffer,void 0,x._format,null,D,F),E&&(x._buffer=null)):(x.delayLoadState=4,x._delayedOnLoad=z,x._delayedOnError=b),x):(x._delayedOnLoad=z,x._delayedOnError=b,x)}return Object.defineProperty(i.prototype,"noMipmap",{get:function(){return this._noMipmap},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"mimeType",{get:function(){return this._mimeType},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isBlocking",{get:function(){return this._isBlocking},set:function(r){this._isBlocking=r},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"samplingMode",{get:function(){return this._texture?this._texture.samplingMode:this._initialSamplingMode},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"invertY",{get:function(){return this._invertY},enumerable:!1,configurable:!0}),i.prototype.updateURL=function(r,o,g){o===void 0&&(o=null),this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(1)),(!this.name||l.a.StartsWith(this.name,"data:"))&&(this.name=r),this.url=r,this._buffer=o,this.delayLoadState=4,g&&(this._delayedOnLoad=g),this.delayLoad()},i.prototype.delayLoad=function(){if(this.delayLoadState===4){var r=this.getScene();!r||(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY),this._texture?this._delayedOnLoad&&(this._texture.isReady?s.a.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=r.getEngine().createTexture(this.url,this._noMipmap,this._invertY,r,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,null,this._mimeType,this._loaderOptions),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}},i.prototype._prepareRowForTextureGeneration=function(r,o,g,y){r*=this._cachedUScale,o*=this._cachedVScale,r-=this.uRotationCenter*this._cachedUScale,o-=this.vRotationCenter*this._cachedVScale,g-=this.wRotationCenter,n.e.TransformCoordinatesFromFloatsToRef(r,o,g,this._rowGenerationMatrix,y),y.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,y.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,y.z+=this.wRotationCenter},i.prototype.checkTransformsAreIdentical=function(r){return r!==null&&this.uOffset===r.uOffset&&this.vOffset===r.vOffset&&this.uScale===r.uScale&&this.vScale===r.vScale&&this.uAng===r.uAng&&this.vAng===r.vAng&&this.wAng===r.wAng},i.prototype.getTextureMatrix=function(r){var o=this;if(r===void 0&&(r=1),this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*r===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*r,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,(!this._cachedTextureMatrix||!this._rowGenerationMatrix)&&(this._cachedTextureMatrix=n.a.Zero(),this._rowGenerationMatrix=new n.a,this._t0=n.e.Zero(),this._t1=n.e.Zero(),this._t2=n.e.Zero()),n.a.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(n.a.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,n.c.Matrix[0]),n.a.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,n.c.Matrix[1]),n.a.ScalingToRef(this._cachedUScale,this._cachedVScale,0,n.c.Matrix[2]),n.a.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,n.c.Matrix[3]),n.c.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(n.c.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(n.c.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(n.c.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),n.a.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));var g=this.getScene();return g?(g.markAllMaterialsAsDirty(1,function(y){return y.hasTexture(o)}),this._cachedTextureMatrix):this._cachedTextureMatrix},i.prototype.getReflectionTextureMatrix=function(){var r=this,o=this.getScene();if(!o)return this._cachedTextureMatrix;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale===this._cachedUScale&&this.vScale===this._cachedVScale&&this.coordinatesMode===this._cachedCoordinatesMode)if(this.coordinatesMode===i.PROJECTION_MODE){if(this._cachedProjectionMatrixId===o.getProjectionMatrix().updateFlag)return this._cachedTextureMatrix}else return this._cachedTextureMatrix;switch(this._cachedTextureMatrix||(this._cachedTextureMatrix=n.a.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=n.a.Zero()),this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale,this._cachedVScale=this.vScale,this._cachedCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case i.PLANAR_MODE:n.a.IdentityToRef(this._cachedTextureMatrix),this._cachedTextureMatrix[0]=this.uScale,this._cachedTextureMatrix[5]=this.vScale,this._cachedTextureMatrix[12]=this.uOffset,this._cachedTextureMatrix[13]=this.vOffset;break;case i.PROJECTION_MODE:n.a.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);var g=o.getProjectionMatrix();this._cachedProjectionMatrixId=g.updateFlag,g.multiplyToRef(this._projectionModeMatrix,this._cachedTextureMatrix);break;default:n.a.IdentityToRef(this._cachedTextureMatrix);break}return o.markAllMaterialsAsDirty(1,function(y){return y.getActiveTextures().indexOf(r)!==-1}),this._cachedTextureMatrix},i.prototype.clone=function(){var r=this;return d.a.Clone(function(){return new i(r._texture?r._texture.url:null,r.getScene(),r._noMipmap,r._invertY,r.samplingMode,void 0,void 0,r._texture?r._texture._buffer:void 0)},this)},i.prototype.serialize=function(){var r=this.name;i.SerializeBuffers||l.a.StartsWith(this.name,"data:")&&(this.name=""),l.a.StartsWith(this.name,"data:")&&this.url===this.name&&(this.url="");var o=e.prototype.serialize.call(this);return o?((i.SerializeBuffers||i.ForceSerializeBuffers)&&(typeof this._buffer=="string"&&this._buffer.substr(0,5)==="data:"?(o.base64String=this._buffer,o.name=o.name.replace("data:","")):this.url&&l.a.StartsWith(this.url,"data:")&&this._buffer instanceof Uint8Array?o.base64String="data:image/png;base64,"+l.a.EncodeArrayBufferToBase64(this._buffer):i.ForceSerializeBuffers&&(o.base64String=!this._engine||this._engine._features.supportSyncTextureRead?h.a.GenerateBase64StringFromTexture(this):h.a.GenerateBase64StringFromTextureAsync(this))),o.invertY=this._invertY,o.samplingMode=this.samplingMode,this.name=r,o):null},i.prototype.getClassName=function(){return"Texture"},i.prototype.dispose=function(){e.prototype.dispose.call(this),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null},i.Parse=function(r,o,g){if(r.customType){var y=u.a.Instantiate(r.customType),v=y.Parse(r,o,g);return r.samplingMode&&v.updateSamplingMode&&v._samplingMode&&v._samplingMode!==r.samplingMode&&v.updateSamplingMode(r.samplingMode),v}if(r.isCube&&!r.isRenderTarget)return i._CubeTextureParser(r,o,g);if(!r.name&&!r.isRenderTarget)return null;var f=function(){if(b&&b._texture&&(b._texture._cachedWrapU=null,b._texture._cachedWrapV=null,b._texture._cachedWrapR=null),r.samplingMode){var T=r.samplingMode;b&&b.samplingMode!==T&&b.updateSamplingMode(T)}if(b&&r.animations)for(var E=0;E<r.animations.length;E++){var O=r.animations[E],D=a.a.GetClass("BABYLON.Animation");D&&b.animations.push(D.Parse(O))}},b=d.a.Parse(function(){var T=!0;if(r.noMipmap&&(T=!1),r.mirrorPlane){var E=i._CreateMirror(r.name,r.renderTargetSize,o,T);return E._waitingRenderList=r.renderList,E.mirrorPlane=p.a.FromArray(r.mirrorPlane),f(),E}else if(r.isRenderTarget){var O=null;if(r.isCube){if(o.reflectionProbes)for(var D=0;D<o.reflectionProbes.length;D++){var F=o.reflectionProbes[D];if(F.name===r.name)return F.cubeTexture}}else O=i._CreateRenderTargetTexture(r.name,r.renderTargetSize,o,T),O._waitingRenderList=r.renderList;return f(),O}else{var x;if(r.base64String)x=i.CreateFromBase64String(r.base64String,r.name,o,!T,r.invertY,void 0,f);else{var j=void 0;r.name&&r.name.indexOf("://")>0?j=r.name:j=g+r.name,(l.a.StartsWith(r.url,"data:")||i.UseSerializedUrlIfAny&&r.url)&&(j=r.url),x=new i(j,o,!T,r.invertY,void 0,f)}return x}},r,o);return b},i.CreateFromBase64String=function(r,o,g,y,v,f,b,T,E){return f===void 0&&(f=i.TRILINEAR_SAMPLINGMODE),b===void 0&&(b=null),T===void 0&&(T=null),E===void 0&&(E=5),new i("data:"+o,g,y,v,f,b,T,r,!1,E)},i.LoadFromDataString=function(r,o,g,y,v,f,b,T,E,O){return y===void 0&&(y=!1),v===void 0&&(v=!1),f===void 0&&(f=!0),b===void 0&&(b=i.TRILINEAR_SAMPLINGMODE),T===void 0&&(T=null),E===void 0&&(E=null),O===void 0&&(O=5),r.substr(0,5)!=="data:"&&(r="data:"+r),new i(r,g,v,f,b,T,E,o,y,O)},i.SerializeBuffers=!0,i.ForceSerializeBuffers=!1,i._CubeTextureParser=function(r,o,g){throw _.a.WarnImport("CubeTexture")},i._CreateMirror=function(r,o,g,y){throw _.a.WarnImport("MirrorTexture")},i._CreateRenderTargetTexture=function(r,o,g,y){throw _.a.WarnImport("RenderTargetTexture")},i.NEAREST_SAMPLINGMODE=1,i.NEAREST_NEAREST_MIPLINEAR=8,i.BILINEAR_SAMPLINGMODE=2,i.LINEAR_LINEAR_MIPNEAREST=11,i.TRILINEAR_SAMPLINGMODE=3,i.LINEAR_LINEAR_MIPLINEAR=3,i.NEAREST_NEAREST_MIPNEAREST=4,i.NEAREST_LINEAR_MIPNEAREST=5,i.NEAREST_LINEAR_MIPLINEAR=6,i.NEAREST_LINEAR=7,i.NEAREST_NEAREST=1,i.LINEAR_NEAREST_MIPNEAREST=9,i.LINEAR_NEAREST_MIPLINEAR=10,i.LINEAR_LINEAR=2,i.LINEAR_NEAREST=12,i.EXPLICIT_MODE=0,i.SPHERICAL_MODE=1,i.PLANAR_MODE=2,i.CUBIC_MODE=3,i.PROJECTION_MODE=4,i.SKYBOX_MODE=5,i.INVCUBIC_MODE=6,i.EQUIRECTANGULAR_MODE=7,i.FIXED_EQUIRECTANGULAR_MODE=8,i.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,i.CLAMP_ADDRESSMODE=0,i.WRAP_ADDRESSMODE=1,i.MIRROR_ADDRESSMODE=2,i.UseSerializedUrlIfAny=!1,Object(P.c)([Object(d.c)()],i.prototype,"url",void 0),Object(P.c)([Object(d.c)()],i.prototype,"uOffset",void 0),Object(P.c)([Object(d.c)()],i.prototype,"vOffset",void 0),Object(P.c)([Object(d.c)()],i.prototype,"uScale",void 0),Object(P.c)([Object(d.c)()],i.prototype,"vScale",void 0),Object(P.c)([Object(d.c)()],i.prototype,"uAng",void 0),Object(P.c)([Object(d.c)()],i.prototype,"vAng",void 0),Object(P.c)([Object(d.c)()],i.prototype,"wAng",void 0),Object(P.c)([Object(d.c)()],i.prototype,"uRotationCenter",void 0),Object(P.c)([Object(d.c)()],i.prototype,"vRotationCenter",void 0),Object(P.c)([Object(d.c)()],i.prototype,"wRotationCenter",void 0),Object(P.c)([Object(d.c)()],i.prototype,"homogeneousRotationInUVTransform",void 0),Object(P.c)([Object(d.c)()],i.prototype,"isBlocking",null),i}(c.a);a.a.RegisteredTypes["BABYLON.Texture"]=t,d.a._TextureParser=t.Parse},function($,W,M){"use strict";M.d(W,"b",function(){return r}),M.d(W,"c",function(){return o}),M.d(W,"a",function(){return g});var P=M(434),d=M(438),m=M(660),n=M(440),c=M(474),a=M(589),_=M(476),s=M(519),u=M(448),p=M(662),l=M(715),h=M(760),t=M(788),e=M(709),i=M(789),r=function(){function y(){}return Object.defineProperty(y,"BaseUrl",{get:function(){return p.a.BaseUrl},set:function(v){p.a.BaseUrl=v},enumerable:!1,configurable:!0}),Object.defineProperty(y,"DefaultRetryStrategy",{get:function(){return p.a.DefaultRetryStrategy},set:function(v){p.a.DefaultRetryStrategy=v},enumerable:!1,configurable:!0}),Object.defineProperty(y,"CorsBehavior",{get:function(){return p.a.CorsBehavior},set:function(v){p.a.CorsBehavior=v},enumerable:!1,configurable:!0}),Object.defineProperty(y,"UseFallbackTexture",{get:function(){return u.a.UseFallbackTexture},set:function(v){u.a.UseFallbackTexture=v},enumerable:!1,configurable:!0}),Object.defineProperty(y,"RegisteredExternalClasses",{get:function(){return t.a.RegisteredExternalClasses},set:function(v){t.a.RegisteredExternalClasses=v},enumerable:!1,configurable:!0}),Object.defineProperty(y,"fallbackTexture",{get:function(){return u.a.FallbackTexture},set:function(v){u.a.FallbackTexture=v},enumerable:!1,configurable:!0}),y.FetchToRef=function(v,f,b,T,E,O){var D=Math.abs(v)*b%b|0,F=Math.abs(f)*T%T|0,x=(D+F*b)*4;O.r=E[x]/255,O.g=E[x+1]/255,O.b=E[x+2]/255,O.a=E[x+3]/255},y.Mix=function(v,f,b){return v*(1-b)+f*b},y.Instantiate=function(v){return t.a.Instantiate(v)},y.Slice=function(v,f,b){return i.a.Slice(v,f,b)},y.SliceToArray=function(v,f,b){return i.a.SliceToArray(v,f,b)},y.SetImmediate=function(v){h.a.SetImmediate(v)},y.IsExponentOfTwo=function(v){var f=1;do f*=2;while(f<v);return f===v},y.FloatRound=function(v){return Math.fround?Math.fround(v):y._tmpFloatArray[0]=v},y.GetFilename=function(v){var f=v.lastIndexOf("/");return f<0?v:v.substring(f+1)},y.GetFolderPath=function(v,f){f===void 0&&(f=!1);var b=v.lastIndexOf("/");return b<0?f?v:"":v.substring(0,b+1)},y.ToDegrees=function(v){return v*180/Math.PI},y.ToRadians=function(v){return v*Math.PI/180},y.MakeArray=function(v,f){return f!==!0&&(v===void 0||v==null)?null:Array.isArray(v)?v:[v]},y.GetPointerPrefix=function(v){var f="pointer";return m.a.IsWindowObjectExist()&&!window.PointerEvent&&m.a.IsNavigatorAvailable()&&!navigator.pointerEnabled&&(f="mouse"),v._badDesktopOS&&!v._badOS&&!(document&&"ontouchend"in document)&&(f="mouse"),f},y.SetCorsBehavior=function(v,f){p.a.SetCorsBehavior(v,f)},y.CleanUrl=function(v){return v=v.replace(/#/gm,"%23"),v},Object.defineProperty(y,"PreprocessUrl",{get:function(){return p.a.PreprocessUrl},set:function(v){p.a.PreprocessUrl=v},enumerable:!1,configurable:!0}),y.LoadImage=function(v,f,b,T,E){return p.a.LoadImage(v,f,b,T,E)},y.LoadFile=function(v,f,b,T,E,O){return p.a.LoadFile(v,f,b,T,E,O)},y.LoadFileAsync=function(v,f){return f===void 0&&(f=!0),new Promise(function(b,T){p.a.LoadFile(v,function(E){b(E)},void 0,void 0,f,function(E,O){T(O)})})},y.LoadScript=function(v,f,b,T){if(!!m.a.IsWindowObjectExist()){var E=document.getElementsByTagName("head")[0],O=document.createElement("script");O.setAttribute("type","text/javascript"),O.setAttribute("src",v),T&&(O.id=T),O.onload=function(){f&&f()},O.onerror=function(D){b&&b("Unable to load script '"+v+"'",D)},E.appendChild(O)}},y.LoadScriptAsync=function(v,f){var b=this;return new Promise(function(T,E){b.LoadScript(v,function(){T()},function(O,D){E(D)})})},y.ReadFileAsDataURL=function(v,f,b){var T=new FileReader,E={onCompleteObservable:new d.c,abort:function(){return T.abort()}};return T.onloadend=function(O){E.onCompleteObservable.notifyObservers(E)},T.onload=function(O){f(O.target.result)},T.onprogress=b,T.readAsDataURL(v),E},y.ReadFile=function(v,f,b,T,E){return p.a.ReadFile(v,f,b,T,E)},y.FileAsURL=function(v){var f=new Blob([v]),b=window.URL||window.webkitURL,T=b.createObjectURL(f);return T},y.Format=function(v,f){return f===void 0&&(f=2),v.toFixed(f)},y.DeepCopy=function(v,f,b,T){c.a.DeepCopy(v,f,b,T)},y.IsEmpty=function(v){for(var f in v)if(v.hasOwnProperty(f))return!1;return!0},y.RegisterTopRootEvents=function(v,f){for(var b=0;b<f.length;b++){var T=f[b];v.addEventListener(T.name,T.handler,!1);try{window.parent&&window.parent.addEventListener(T.name,T.handler,!1)}catch(E){}}},y.UnregisterTopRootEvents=function(v,f){for(var b=0;b<f.length;b++){var T=f[b];v.removeEventListener(T.name,T.handler);try{v.parent&&v.parent.removeEventListener(T.name,T.handler)}catch(E){}}},y.DumpFramebuffer=function(v,f,b,T,E,O){return E===void 0&&(E="image/png"),Object(P.b)(this,void 0,void 0,function(){var D,F;return Object(P.e)(this,function(x){switch(x.label){case 0:return[4,b.readPixels(0,0,v,f)];case 1:return D=x.sent(),F=new Uint8Array(D.buffer),y.DumpData(v,f,F,T,E,O,!0),[2]}})})},y.DumpData=function(v,f,b,T,E,O,D,F){E===void 0&&(E="image/png"),D===void 0&&(D=!1),F===void 0&&(F=!1),y._ScreenshotCanvas||(y._ScreenshotCanvas=document.createElement("canvas")),y._ScreenshotCanvas.width=v,y._ScreenshotCanvas.height=f;var x=y._ScreenshotCanvas.getContext("2d");if(x){if(b instanceof Float32Array){for(var j=new Uint8Array(b.length),V=b.length;V--;){var z=b[V];j[V]=z<0?0:z>1?1:Math.round(z*255)}b=j}var w=x.createImageData(v,f),R=w.data;R.set(b),x.putImageData(w,0,0);var L=y._ScreenshotCanvas;if(D){var N=document.createElement("canvas");N.width=v,N.height=f;var B=N.getContext("2d");if(!B)return;B.translate(0,f),B.scale(1,-1),B.drawImage(y._ScreenshotCanvas,0,0),L=N}F?y.ToBlob(L,function(X){var K=new FileReader;K.onload=function(G){var I=G.target.result;T&&T(I)},K.readAsArrayBuffer(X)}):y.EncodeScreenshotCanvasData(T,E,O,L)}},y.DumpDataAsync=function(v,f,b,T,E,O,D){return T===void 0&&(T="image/png"),O===void 0&&(O=!1),D===void 0&&(D=!1),new Promise(function(F){y.DumpData(v,f,b,function(x){return F(x)},T,E,O,D)})},y.ToBlob=function(v,f,b){b===void 0&&(b="image/png"),v.toBlob||(v.toBlob=function(T,E,O){var D=this;setTimeout(function(){for(var F=atob(D.toDataURL(E,O).split(",")[1]),x=F.length,j=new Uint8Array(x),V=0;V<x;V++)j[V]=F.charCodeAt(V);T(new Blob([j]))})}),v.toBlob(function(T){f(T)},b)},y.EncodeScreenshotCanvasData=function(v,f,b,T){if(f===void 0&&(f="image/png"),v){var E=(T!=null?T:y._ScreenshotCanvas).toDataURL(f);v(E)}else this.ToBlob(T!=null?T:y._ScreenshotCanvas,function(O){if("download"in document.createElement("a")){if(!b){var D=new Date,F=(D.getFullYear()+"-"+(D.getMonth()+1)).slice(2)+"-"+D.getDate()+"_"+D.getHours()+"-"+("0"+D.getMinutes()).slice(-2);b="screenshot_"+F+".png"}y.Download(O,b)}else{var x=URL.createObjectURL(O),j=window.open("");if(!j)return;var V=j.document.createElement("img");V.onload=function(){URL.revokeObjectURL(x)},V.src=x,j.document.body.appendChild(V)}},f)},y.Download=function(v,f){if(navigator&&navigator.msSaveBlob){navigator.msSaveBlob(v,f);return}var b=window.URL.createObjectURL(v),T=document.createElement("a");document.body.appendChild(T),T.style.display="none",T.href=b,T.download=f,T.addEventListener("click",function(){T.parentElement&&T.parentElement.removeChild(T)}),T.click(),window.URL.revokeObjectURL(b)},y.BackCompatCameraNoPreventDefault=function(v){return typeof v[0]=="boolean"?v[0]:typeof v[1]=="boolean"?v[1]:!1},y.CreateScreenshot=function(v,f,b,T,E){throw E===void 0&&(E="image/png"),_.a.WarnImport("ScreenshotTools")},y.CreateScreenshotAsync=function(v,f,b,T){throw T===void 0&&(T="image/png"),_.a.WarnImport("ScreenshotTools")},y.CreateScreenshotUsingRenderTarget=function(v,f,b,T,E,O,D,F){throw E===void 0&&(E="image/png"),O===void 0&&(O=1),D===void 0&&(D=!1),_.a.WarnImport("ScreenshotTools")},y.CreateScreenshotUsingRenderTargetAsync=function(v,f,b,T,E,O,D){throw T===void 0&&(T="image/png"),E===void 0&&(E=1),O===void 0&&(O=!1),_.a.WarnImport("ScreenshotTools")},y.RandomId=function(){return e.a.RandomId()},y.IsBase64=function(v){return v.length<5?!1:v.substr(0,5)==="data:"},y.DecodeBase64=function(v){for(var f=atob(v.split(",")[1]),b=f.length,T=new Uint8Array(new ArrayBuffer(b)),E=0;E<b;E++)T[E]=f.charCodeAt(E);return T.buffer},y.GetAbsoluteUrl=function(v){var f=document.createElement("a");return f.href=v,f.href},Object.defineProperty(y,"errorsCount",{get:function(){return n.a.errorsCount},enumerable:!1,configurable:!0}),y.Log=function(v){n.a.Log(v)},y.Warn=function(v){n.a.Warn(v)},y.Error=function(v){n.a.Error(v)},Object.defineProperty(y,"LogCache",{get:function(){return n.a.LogCache},enumerable:!1,configurable:!0}),y.ClearLogCache=function(){n.a.ClearLogCache()},Object.defineProperty(y,"LogLevels",{set:function(v){n.a.LogLevels=v},enumerable:!1,configurable:!0}),Object.defineProperty(y,"PerformanceLogLevel",{set:function(v){if((v&y.PerformanceUserMarkLogLevel)===y.PerformanceUserMarkLogLevel){y.StartPerformanceCounter=y._StartUserMark,y.EndPerformanceCounter=y._EndUserMark;return}if((v&y.PerformanceConsoleLogLevel)===y.PerformanceConsoleLogLevel){y.StartPerformanceCounter=y._StartPerformanceConsole,y.EndPerformanceCounter=y._EndPerformanceConsole;return}y.StartPerformanceCounter=y._StartPerformanceCounterDisabled,y.EndPerformanceCounter=y._EndPerformanceCounterDisabled},enumerable:!1,configurable:!0}),y._StartPerformanceCounterDisabled=function(v,f){},y._EndPerformanceCounterDisabled=function(v,f){},y._StartUserMark=function(v,f){if(f===void 0&&(f=!0),!y._performance){if(!m.a.IsWindowObjectExist())return;y._performance=window.performance}!f||!y._performance.mark||y._performance.mark(v+"-Begin")},y._EndUserMark=function(v,f){f===void 0&&(f=!0),!(!f||!y._performance.mark)&&(y._performance.mark(v+"-End"),y._performance.measure(v,v+"-Begin",v+"-End"))},y._StartPerformanceConsole=function(v,f){f===void 0&&(f=!0),!!f&&(y._StartUserMark(v,f),console.time&&console.time(v))},y._EndPerformanceConsole=function(v,f){f===void 0&&(f=!0),!!f&&(y._EndUserMark(v,f),console.timeEnd(v))},Object.defineProperty(y,"Now",{get:function(){return a.a.Now},enumerable:!1,configurable:!0}),y.GetClassName=function(v,f){f===void 0&&(f=!1);var b=null;if(!f&&v.getClassName)b=v.getClassName();else{if(v instanceof Object){var T=f?v:Object.getPrototypeOf(v);b=T.constructor.__bjsclassName__}b||(b=typeof v)}return b},y.First=function(v,f){for(var b=0,T=v;b<T.length;b++){var E=T[b];if(f(E))return E}return null},y.getFullClassName=function(v,f){f===void 0&&(f=!1);var b=null,T=null;if(!f&&v.getClassName)b=v.getClassName();else{if(v instanceof Object){var E=f?v:Object.getPrototypeOf(v);b=E.constructor.__bjsclassName__,T=E.constructor.__bjsmoduleName__}b||(b=typeof v)}return b?(T!=null?T+".":"")+b:null},y.DelayAsync=function(v){return new Promise(function(f){setTimeout(function(){f()},v)})},y.IsSafari=function(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},y.UseCustomRequestHeaders=!1,y.CustomRequestHeaders=s.a.CustomRequestHeaders,y._tmpFloatArray=new Float32Array(1),y.GetDOMTextContent=m.a.GetDOMTextContent,y.NoneLogLevel=n.a.NoneLogLevel,y.MessageLogLevel=n.a.MessageLogLevel,y.WarningLogLevel=n.a.WarningLogLevel,y.ErrorLogLevel=n.a.ErrorLogLevel,y.AllLogLevel=n.a.AllLogLevel,y.IsWindowObjectExist=m.a.IsWindowObjectExist,y.PerformanceNoneLogLevel=0,y.PerformanceUserMarkLogLevel=1,y.PerformanceConsoleLogLevel=2,y.StartPerformanceCounter=y._StartPerformanceCounterDisabled,y.EndPerformanceCounter=y._EndPerformanceCounterDisabled,y}();function o(y,v){return function(f){f.__bjsclassName__=y,f.__bjsmoduleName__=v!=null?v:null}}var g=function(){function y(v,f,b,T){T===void 0&&(T=0),this.iterations=v,this.index=T-1,this._done=!1,this._fn=f,this._successCallback=b}return y.prototype.executeNext=function(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())},y.prototype.breakLoop=function(){this._done=!0,this._successCallback()},y.Run=function(v,f,b,T){T===void 0&&(T=0);var E=new y(v,f,b,T);return E.executeNext(),E},y.SyncAsyncForLoop=function(v,f,b,T,E,O){return O===void 0&&(O=0),y.Run(Math.ceil(v/f),function(D){E&&E()?D.breakLoop():setTimeout(function(){for(var F=0;F<f;++F){var x=D.index*f+F;if(x>=v)break;if(b(x),E&&E()){D.breakLoop();break}}D.executeNext()},O)},T)},y}();u.a.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z",l.a.Apply()},,function($,W,M){"use strict";M.d(W,"a",function(){return e});var P=M(434),d=M(438),m=M(660),n=M(448),c=M(476),a=M(467),_=M(716),s=M(612),u=M(708),p=M(440),l=M(621),h=M(685),t=M(622),e=function(i){Object(P.d)(r,i);function r(o,g,y,v){v===void 0&&(v=!1);var f=i.call(this,o,g,y,v)||this;if(f.enableOfflineSupport=!1,f.disableManifestCheck=!1,f.scenes=new Array,f.onNewSceneAddedObservable=new d.c,f.postProcesses=new Array,f.isPointerLock=!1,f.onResizeObservable=new d.c,f.onCanvasBlurObservable=new d.c,f.onCanvasFocusObservable=new d.c,f.onCanvasPointerOutObservable=new d.c,f.onBeginFrameObservable=new d.c,f.customAnimationFrameRequester=null,f.onEndFrameObservable=new d.c,f.onBeforeShaderCompilationObservable=new d.c,f.onAfterShaderCompilationObservable=new d.c,f._deterministicLockstep=!1,f._lockstepMaxSteps=4,f._timeStep=1/60,f._fps=60,f._deltaTime=0,f._drawCalls=new s.a,f.canvasTabIndex=1,f.disablePerformanceMonitorInBackground=!1,f._performanceMonitor=new _.a,r.Instances.push(f),!o)return f;if(y=f._creationOptions,o.getContext){var b=o;if(f._sharedInit(b,!!y.doNotHandleTouchAction,y.audioEngine),m.a.IsWindowObjectExist()){var T=document;f._onFullscreenChange=function(){T.fullscreen!==void 0?f.isFullscreen=T.fullscreen:T.mozFullScreen!==void 0?f.isFullscreen=T.mozFullScreen:T.webkitIsFullScreen!==void 0?f.isFullscreen=T.webkitIsFullScreen:T.msIsFullScreen!==void 0&&(f.isFullscreen=T.msIsFullScreen),f.isFullscreen&&f._pointerLockRequested&&b&&r._RequestPointerlock(b)},document.addEventListener("fullscreenchange",f._onFullscreenChange,!1),document.addEventListener("mozfullscreenchange",f._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",f._onFullscreenChange,!1),document.addEventListener("msfullscreenchange",f._onFullscreenChange,!1),f._onPointerLockChange=function(){f.isPointerLock=T.mozPointerLockElement===b||T.webkitPointerLockElement===b||T.msPointerLockElement===b||T.pointerLockElement===b},document.addEventListener("pointerlockchange",f._onPointerLockChange,!1),document.addEventListener("mspointerlockchange",f._onPointerLockChange,!1),document.addEventListener("mozpointerlockchange",f._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",f._onPointerLockChange,!1),!r.audioEngine&&y.audioEngine&&r.AudioEngineFactory&&(r.audioEngine=r.AudioEngineFactory(f.getRenderingCanvas()))}f._connectVREvents(),f.enableOfflineSupport=r.OfflineProviderFactory!==void 0,f._deterministicLockstep=!!y.deterministicLockstep,f._lockstepMaxSteps=y.lockstepMaxSteps||0,f._timeStep=y.timeStep||1/60}return f._prepareVRComponent(),y.autoEnableWebVR&&f.initWebVR(),f}return Object.defineProperty(r,"NpmPackage",{get:function(){return a.a.NpmPackage},enumerable:!1,configurable:!0}),Object.defineProperty(r,"Version",{get:function(){return a.a.Version},enumerable:!1,configurable:!0}),Object.defineProperty(r,"Instances",{get:function(){return n.a.Instances},enumerable:!1,configurable:!0}),Object.defineProperty(r,"LastCreatedEngine",{get:function(){return n.a.LastCreatedEngine},enumerable:!1,configurable:!0}),Object.defineProperty(r,"LastCreatedScene",{get:function(){return n.a.LastCreatedScene},enumerable:!1,configurable:!0}),r.MarkAllMaterialsAsDirty=function(o,g){for(var y=0;y<r.Instances.length;y++)for(var v=r.Instances[y],f=0;f<v.scenes.length;f++)v.scenes[f].markAllMaterialsAsDirty(o,g)},r.DefaultLoadingScreenFactory=function(o){throw c.a.WarnImport("LoadingScreen")},Object.defineProperty(r.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!!r._RescalePostProcessFactory},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"performanceMonitor",{get:function(){return this._performanceMonitor},enumerable:!1,configurable:!0}),r.prototype.getInputElement=function(){return this._renderingCanvas},r.prototype._sharedInit=function(o,g,y){var v=this;if(i.prototype._sharedInit.call(this,o,g,y),this._onCanvasFocus=function(){v.onCanvasFocusObservable.notifyObservers(v)},this._onCanvasBlur=function(){v.onCanvasBlurObservable.notifyObservers(v)},o.addEventListener("focus",this._onCanvasFocus),o.addEventListener("blur",this._onCanvasBlur),this._onBlur=function(){v.disablePerformanceMonitorInBackground&&v._performanceMonitor.disable(),v._windowIsBackground=!0},this._onFocus=function(){v.disablePerformanceMonitorInBackground&&v._performanceMonitor.enable(),v._windowIsBackground=!1},this._onCanvasPointerOut=function(b){v.onCanvasPointerOutObservable.notifyObservers(b)},m.a.IsWindowObjectExist()){var f=this.getHostWindow();f&&(f.addEventListener("blur",this._onBlur),f.addEventListener("focus",this._onFocus))}o.addEventListener("pointerout",this._onCanvasPointerOut),g||this._disableTouchAction(),!r.audioEngine&&y&&r.AudioEngineFactory&&(r.audioEngine=r.AudioEngineFactory(this.getRenderingCanvas()))},r.prototype.getAspectRatio=function(o,g){g===void 0&&(g=!1);var y=o.viewport;return this.getRenderWidth(g)*y.width/(this.getRenderHeight(g)*y.height)},r.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},r.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},r.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},r.prototype.isDeterministicLockStep=function(){return this._deterministicLockstep},r.prototype.getLockstepMaxSteps=function(){return this._lockstepMaxSteps},r.prototype.getTimeStep=function(){return this._timeStep*1e3},r.prototype.generateMipMapsForCubemap=function(o,g){if(g===void 0&&(g=!0),o.generateMipMaps){var y=this._gl;this._bindTextureDirectly(y.TEXTURE_CUBE_MAP,o,!0),y.generateMipmap(y.TEXTURE_CUBE_MAP),g&&this._bindTextureDirectly(y.TEXTURE_CUBE_MAP,null)}},r.prototype.setState=function(o,g,y,v){g===void 0&&(g=0),v===void 0&&(v=!1),(this._depthCullingState.cull!==o||y)&&(this._depthCullingState.cull=o);var f=this.cullBackFaces?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==f||y)&&(this._depthCullingState.cullFace=f),this.setZOffset(g);var b=v?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==b||y)&&(this._depthCullingState.frontFace=b)},r.prototype.setZOffset=function(o){this._depthCullingState.zOffset=o},r.prototype.getZOffset=function(){return this._depthCullingState.zOffset},r.prototype.getDepthBuffer=function(){return this._depthCullingState.depthTest},r.prototype.setDepthBuffer=function(o){this._depthCullingState.depthTest=o},r.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},r.prototype.setDepthWrite=function(o){this._depthCullingState.depthMask=o},r.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},r.prototype.setStencilBuffer=function(o){this._stencilState.stencilTest=o},r.prototype.getStencilMask=function(){return this._stencilState.stencilMask},r.prototype.setStencilMask=function(o){this._stencilState.stencilMask=o},r.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},r.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},r.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},r.prototype.setStencilFunction=function(o){this._stencilState.stencilFunc=o},r.prototype.setStencilFunctionReference=function(o){this._stencilState.stencilFuncRef=o},r.prototype.setStencilFunctionMask=function(o){this._stencilState.stencilFuncMask=o},r.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},r.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},r.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},r.prototype.setStencilOperationFail=function(o){this._stencilState.stencilOpStencilFail=o},r.prototype.setStencilOperationDepthFail=function(o){this._stencilState.stencilOpDepthFail=o},r.prototype.setStencilOperationPass=function(o){this._stencilState.stencilOpStencilDepthPass=o},r.prototype.setDitheringState=function(o){o?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)},r.prototype.setRasterizerState=function(o){o?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)},r.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},r.prototype.setDepthFunction=function(o){this._depthCullingState.depthFunc=o},r.prototype.setDepthFunctionToGreater=function(){this._depthCullingState.depthFunc=516},r.prototype.setDepthFunctionToGreaterOrEqual=function(){this._depthCullingState.depthFunc=518},r.prototype.setDepthFunctionToLess=function(){this._depthCullingState.depthFunc=513},r.prototype.setDepthFunctionToLessOrEqual=function(){this._depthCullingState.depthFunc=515},r.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},r.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},r.prototype.setDirectViewport=function(o,g,y,v){var f=this._cachedViewport;return this._cachedViewport=null,this._viewport(o,g,y,v),f},r.prototype.scissorClear=function(o,g,y,v,f){this.enableScissor(o,g,y,v),this.clear(f,!0,!0,!0),this.disableScissor()},r.prototype.enableScissor=function(o,g,y,v){var f=this._gl;f.enable(f.SCISSOR_TEST),f.scissor(o,g,y,v)},r.prototype.disableScissor=function(){var o=this._gl;o.disable(o.SCISSOR_TEST)},r.prototype._reportDrawCall=function(){this._drawCalls.addCount(1,!1)},r.prototype.initWebVR=function(){throw c.a.WarnImport("WebVRCamera")},r.prototype._prepareVRComponent=function(){},r.prototype._connectVREvents=function(o,g){},r.prototype._submitVRFrame=function(){},r.prototype.disableVR=function(){},r.prototype.isVRPresenting=function(){return!1},r.prototype._requestVRFrame=function(){},r.prototype._loadFileAsync=function(o,g,y){var v=this;return new Promise(function(f,b){v._loadFile(o,function(T){f(T)},void 0,g,y,function(T,E){b(E)})})},r.prototype.getVertexShaderSource=function(o){var g=this._gl.getAttachedShaders(o);return g?this._gl.getShaderSource(g[0]):null},r.prototype.getFragmentShaderSource=function(o){var g=this._gl.getAttachedShaders(o);return g?this._gl.getShaderSource(g[1]):null},r.prototype.setDepthStencilTexture=function(o,g,y,v){o!==void 0&&(g&&(this._boundUniforms[o]=g),!y||!y.depthStencilTexture?this._setTexture(o,null,void 0,void 0,v):this._setTexture(o,y,!1,!0,v))},r.prototype.setTextureFromPostProcess=function(o,g,y){var v=null;g&&(g._textures.data[g._currentRenderTextureInd]?v=g._textures.data[g._currentRenderTextureInd]:g._forcedOutputTexture&&(v=g._forcedOutputTexture)),this._bindTexture(o,v,y)},r.prototype.setTextureFromPostProcessOutput=function(o,g,y){this._bindTexture(o,g?g._outputTexture:null,y)},r.prototype._rebuildBuffers=function(){for(var o=0,g=this.scenes;o<g.length;o++){var y=g[o];y.resetCachedMaterial(),y._rebuildGeometries(),y._rebuildTextures()}i.prototype._rebuildBuffers.call(this)},r.prototype._renderFrame=function(){for(var o=0;o<this._activeRenderLoops.length;o++){var g=this._activeRenderLoops[o];g()}},r.prototype._renderLoop=function(){if(!this._contextWasLost){var o=!0;!this.renderEvenInBackground&&this._windowIsBackground&&(o=!1),o&&(this.beginFrame(),this._renderViews()||this._renderFrame(),this.endFrame())}this._activeRenderLoops.length>0?this.customAnimationFrameRequester?(this.customAnimationFrameRequester.requestID=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.requestID):this.isVRPresenting()?this._requestVRFrame():this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},r.prototype._renderViews=function(){return!1},r.prototype.switchFullscreen=function(o){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(o)},r.prototype.enterFullscreen=function(o){this.isFullscreen||(this._pointerLockRequested=o,this._renderingCanvas&&r._RequestFullscreen(this._renderingCanvas))},r.prototype.exitFullscreen=function(){this.isFullscreen&&r._ExitFullscreen()},r.prototype.enterPointerlock=function(){this._renderingCanvas&&r._RequestPointerlock(this._renderingCanvas)},r.prototype.exitPointerlock=function(){r._ExitPointerlock()},r.prototype.beginFrame=function(){this._measureFps(),this.onBeginFrameObservable.notifyObservers(this),i.prototype.beginFrame.call(this)},r.prototype.endFrame=function(){i.prototype.endFrame.call(this),this._submitVRFrame(),this.onEndFrameObservable.notifyObservers(this)},r.prototype.resize=function(o){o===void 0&&(o=!1),!this.isVRPresenting()&&i.prototype.resize.call(this,o)},r.prototype.setSize=function(o,g,y){if(y===void 0&&(y=!1),!this._renderingCanvas||!i.prototype.setSize.call(this,o,g,y))return!1;if(this.scenes){for(var v=0;v<this.scenes.length;v++)for(var f=this.scenes[v],b=0;b<f.cameras.length;b++){var T=f.cameras[b];T._currentRenderId=0}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0},r.prototype._deletePipelineContext=function(o){var g=o;g&&g.program&&g.transformFeedback&&(this.deleteTransformFeedback(g.transformFeedback),g.transformFeedback=null),i.prototype._deletePipelineContext.call(this,o)},r.prototype.createShaderProgram=function(o,g,y,v,f,b){b===void 0&&(b=null),f=f||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);var T=i.prototype.createShaderProgram.call(this,o,g,y,v,f,b);return this.onAfterShaderCompilationObservable.notifyObservers(this),T},r.prototype._createShaderProgram=function(o,g,y,v,f){f===void 0&&(f=null);var b=v.createProgram();if(o.program=b,!b)throw new Error("Unable to create program");if(v.attachShader(b,g),v.attachShader(b,y),this.webGLVersion>1&&f){var T=this.createTransformFeedback();this.bindTransformFeedback(T),this.setTranformFeedbackVaryings(b,f),o.transformFeedback=T}return v.linkProgram(b),this.webGLVersion>1&&f&&this.bindTransformFeedback(null),o.context=v,o.vertexShader=g,o.fragmentShader=y,o.isParallelCompiled||this._finalizePipelineContext(o),b},r.prototype._releaseTexture=function(o){i.prototype._releaseTexture.call(this,o),this.scenes.forEach(function(g){g.postProcesses.forEach(function(y){y._outputTexture==o&&(y._outputTexture=null)}),g.cameras.forEach(function(y){y._postProcesses.forEach(function(v){v&&v._outputTexture==o&&(v._outputTexture=null)})})})},r.prototype._rescaleTexture=function(o,g,y,v,f){var b=this;this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);var T=this.createRenderTargetTexture({width:g.width,height:g.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});!this._rescalePostProcess&&r._RescalePostProcessFactory&&(this._rescalePostProcess=r._RescalePostProcessFactory(this)),this._rescalePostProcess.getEffect().executeWhenCompiled(function(){b._rescalePostProcess.onApply=function(O){O._bindTexture("textureSampler",o)};var E=y;E||(E=b.scenes[b.scenes.length-1]),E.postProcessManager.directRender([b._rescalePostProcess],T,!0),b._bindTextureDirectly(b._gl.TEXTURE_2D,g,!0),b._gl.copyTexImage2D(b._gl.TEXTURE_2D,0,v,0,0,g.width,g.height,0),b.unBindFramebuffer(T),b._releaseTexture(T),f&&f()})},r.prototype.getFps=function(){return this._fps},r.prototype.getDeltaTime=function(){return this._deltaTime},r.prototype._measureFps=function(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0},r.prototype._uploadImageToTexture=function(o,g,y,v){y===void 0&&(y=0),v===void 0&&(v=0);var f=this._gl,b=this._getWebGLTextureType(o.type),T=this._getInternalFormat(o.format),E=this._getRGBABufferInternalSizedFormat(o.type,T),O=o.isCube?f.TEXTURE_CUBE_MAP:f.TEXTURE_2D;this._bindTextureDirectly(O,o,!0),this._unpackFlipY(o.invertY);var D=f.TEXTURE_2D;o.isCube&&(D=f.TEXTURE_CUBE_MAP_POSITIVE_X+y),f.texImage2D(D,v,E,T,b,g),this._bindTextureDirectly(O,null,!0)},r.prototype.updateRenderTargetTextureSampleCount=function(o,g){if(this.webGLVersion<2||!o)return 1;if(o.samples===g)return g;var y=this._gl;if(g=Math.min(g,this.getCaps().maxMSAASamples),o._depthStencilBuffer&&(y.deleteRenderbuffer(o._depthStencilBuffer),o._depthStencilBuffer=null),o._MSAAFramebuffer&&(y.deleteFramebuffer(o._MSAAFramebuffer),o._MSAAFramebuffer=null),o._MSAARenderBuffer&&(y.deleteRenderbuffer(o._MSAARenderBuffer),o._MSAARenderBuffer=null),g>1&&y.renderbufferStorageMultisample){var v=y.createFramebuffer();if(!v)throw new Error("Unable to create multi sampled framebuffer");o._MSAAFramebuffer=v,this._bindUnboundFramebuffer(o._MSAAFramebuffer);var f=y.createRenderbuffer();if(!f)throw new Error("Unable to create multi sampled framebuffer");y.bindRenderbuffer(y.RENDERBUFFER,f),y.renderbufferStorageMultisample(y.RENDERBUFFER,g,this._getRGBAMultiSampleBufferFormat(o.type),o.width,o.height),y.framebufferRenderbuffer(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.RENDERBUFFER,f),o._MSAARenderBuffer=f}else this._bindUnboundFramebuffer(o._framebuffer);return o.samples=g,o._depthStencilBuffer=this._setupFramebufferDepthAttachments(o._generateStencilBuffer,o._generateDepthBuffer,o.width,o.height,g),this._bindUnboundFramebuffer(null),g},r.prototype.updateTextureComparisonFunction=function(o,g){if(this.webGLVersion===1){p.a.Error("WebGL 1 does not support texture comparison.");return}var y=this._gl;o.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,o,!0),g===0?(y.texParameteri(y.TEXTURE_CUBE_MAP,y.TEXTURE_COMPARE_FUNC,515),y.texParameteri(y.TEXTURE_CUBE_MAP,y.TEXTURE_COMPARE_MODE,y.NONE)):(y.texParameteri(y.TEXTURE_CUBE_MAP,y.TEXTURE_COMPARE_FUNC,g),y.texParameteri(y.TEXTURE_CUBE_MAP,y.TEXTURE_COMPARE_MODE,y.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,o,!0),g===0?(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_COMPARE_FUNC,515),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_COMPARE_MODE,y.NONE)):(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_COMPARE_FUNC,g),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_COMPARE_MODE,y.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),o._comparisonFunction=g},r.prototype.createInstancesBuffer=function(o){var g=this._gl.createBuffer();if(!g)throw new Error("Unable to create instance buffer");var y=new u.a(g);return y.capacity=o,this.bindArrayBuffer(y),this._gl.bufferData(this._gl.ARRAY_BUFFER,o,this._gl.DYNAMIC_DRAW),y},r.prototype.deleteInstancesBuffer=function(o){this._gl.deleteBuffer(o)},r.prototype._clientWaitAsync=function(o,g,y){g===void 0&&(g=0),y===void 0&&(y=10);var v=this._gl;return new Promise(function(f,b){var T=function(){var E=v.clientWaitSync(o,g,0);if(E==v.WAIT_FAILED){b();return}if(E==v.TIMEOUT_EXPIRED){setTimeout(T,y);return}f()};T()})},r.prototype._readPixelsAsync=function(o,g,y,v,f,b,T){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");var E=this._gl,O=E.createBuffer();E.bindBuffer(E.PIXEL_PACK_BUFFER,O),E.bufferData(E.PIXEL_PACK_BUFFER,T.byteLength,E.STREAM_READ),E.readPixels(o,g,y,v,f,b,0),E.bindBuffer(E.PIXEL_PACK_BUFFER,null);var D=E.fenceSync(E.SYNC_GPU_COMMANDS_COMPLETE,0);return D?(E.flush(),this._clientWaitAsync(D,0,10).then(function(){return E.deleteSync(D),E.bindBuffer(E.PIXEL_PACK_BUFFER,O),E.getBufferSubData(E.PIXEL_PACK_BUFFER,0,T),E.bindBuffer(E.PIXEL_PACK_BUFFER,null),E.deleteBuffer(O),T})):null},r.prototype.dispose=function(){for(this.hideLoadingUI(),this.onNewSceneAddedObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(this._rescalePostProcess&&this._rescalePostProcess.dispose();this.scenes.length;)this.scenes[0].dispose();r.Instances.length===1&&r.audioEngine&&r.audioEngine.dispose(),this.disableVR(),m.a.IsWindowObjectExist()&&(window.removeEventListener("blur",this._onBlur),window.removeEventListener("focus",this._onFocus),this._renderingCanvas&&(this._renderingCanvas.removeEventListener("focus",this._onCanvasFocus),this._renderingCanvas.removeEventListener("blur",this._onCanvasBlur),this._renderingCanvas.removeEventListener("pointerout",this._onCanvasPointerOut)),m.a.IsDocumentAvailable()&&(document.removeEventListener("fullscreenchange",this._onFullscreenChange),document.removeEventListener("mozfullscreenchange",this._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",this._onFullscreenChange),document.removeEventListener("msfullscreenchange",this._onFullscreenChange),document.removeEventListener("pointerlockchange",this._onPointerLockChange),document.removeEventListener("mspointerlockchange",this._onPointerLockChange),document.removeEventListener("mozpointerlockchange",this._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",this._onPointerLockChange))),i.prototype.dispose.call(this);var o=r.Instances.indexOf(this);o>=0&&r.Instances.splice(o,1),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()},r.prototype._disableTouchAction=function(){!this._renderingCanvas||!this._renderingCanvas.setAttribute||(this._renderingCanvas.setAttribute("touch-action","none"),this._renderingCanvas.style.touchAction="none",this._renderingCanvas.style.msTouchAction="none")},r.prototype.displayLoadingUI=function(){if(!!m.a.IsWindowObjectExist()){var o=this.loadingScreen;o&&o.displayLoadingUI()}},r.prototype.hideLoadingUI=function(){if(!!m.a.IsWindowObjectExist()){var o=this._loadingScreen;o&&o.hideLoadingUI()}},Object.defineProperty(r.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=r.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(o){this._loadingScreen=o},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"loadingUIText",{set:function(o){this.loadingScreen.loadingUIText=o},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"loadingUIBackgroundColor",{set:function(o){this.loadingScreen.loadingUIBackgroundColor=o},enumerable:!1,configurable:!0}),r._RequestPointerlock=function(o){o.requestPointerLock=o.requestPointerLock||o.msRequestPointerLock||o.mozRequestPointerLock||o.webkitRequestPointerLock,o.requestPointerLock&&o.requestPointerLock()},r._ExitPointerlock=function(){var o=document;document.exitPointerLock=document.exitPointerLock||o.msExitPointerLock||o.mozExitPointerLock||o.webkitExitPointerLock,document.exitPointerLock&&document.exitPointerLock()},r._RequestFullscreen=function(o){var g=o.requestFullscreen||o.msRequestFullscreen||o.webkitRequestFullscreen||o.mozRequestFullScreen;!g||g.call(o)},r._ExitFullscreen=function(){var o=document;document.exitFullscreen?document.exitFullscreen():o.mozCancelFullScreen?o.mozCancelFullScreen():o.webkitCancelFullScreen?o.webkitCancelFullScreen():o.msCancelFullScreen&&o.msCancelFullScreen()},r.ALPHA_DISABLE=0,r.ALPHA_ADD=1,r.ALPHA_COMBINE=2,r.ALPHA_SUBTRACT=3,r.ALPHA_MULTIPLY=4,r.ALPHA_MAXIMIZED=5,r.ALPHA_ONEONE=6,r.ALPHA_PREMULTIPLIED=7,r.ALPHA_PREMULTIPLIED_PORTERDUFF=8,r.ALPHA_INTERPOLATE=9,r.ALPHA_SCREENMODE=10,r.DELAYLOADSTATE_NONE=0,r.DELAYLOADSTATE_LOADED=1,r.DELAYLOADSTATE_LOADING=2,r.DELAYLOADSTATE_NOTLOADED=4,r.NEVER=512,r.ALWAYS=519,r.LESS=513,r.EQUAL=514,r.LEQUAL=515,r.GREATER=516,r.GEQUAL=518,r.NOTEQUAL=517,r.KEEP=7680,r.REPLACE=7681,r.INCR=7682,r.DECR=7683,r.INVERT=5386,r.INCR_WRAP=34055,r.DECR_WRAP=34056,r.TEXTURE_CLAMP_ADDRESSMODE=0,r.TEXTURE_WRAP_ADDRESSMODE=1,r.TEXTURE_MIRROR_ADDRESSMODE=2,r.TEXTUREFORMAT_ALPHA=0,r.TEXTUREFORMAT_LUMINANCE=1,r.TEXTUREFORMAT_LUMINANCE_ALPHA=2,r.TEXTUREFORMAT_RGB=4,r.TEXTUREFORMAT_RGBA=5,r.TEXTUREFORMAT_RED=6,r.TEXTUREFORMAT_R=6,r.TEXTUREFORMAT_RG=7,r.TEXTUREFORMAT_RED_INTEGER=8,r.TEXTUREFORMAT_R_INTEGER=8,r.TEXTUREFORMAT_RG_INTEGER=9,r.TEXTUREFORMAT_RGB_INTEGER=10,r.TEXTUREFORMAT_RGBA_INTEGER=11,r.TEXTURETYPE_UNSIGNED_BYTE=0,r.TEXTURETYPE_UNSIGNED_INT=0,r.TEXTURETYPE_FLOAT=1,r.TEXTURETYPE_HALF_FLOAT=2,r.TEXTURETYPE_BYTE=3,r.TEXTURETYPE_SHORT=4,r.TEXTURETYPE_UNSIGNED_SHORT=5,r.TEXTURETYPE_INT=6,r.TEXTURETYPE_UNSIGNED_INTEGER=7,r.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,r.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,r.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,r.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,r.TEXTURETYPE_UNSIGNED_INT_24_8=12,r.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,r.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,r.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,r.TEXTURE_NEAREST_SAMPLINGMODE=1,r.TEXTURE_BILINEAR_SAMPLINGMODE=2,r.TEXTURE_TRILINEAR_SAMPLINGMODE=3,r.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,r.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,r.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,r.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,r.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,r.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,r.TEXTURE_NEAREST_LINEAR=7,r.TEXTURE_NEAREST_NEAREST=1,r.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,r.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,r.TEXTURE_LINEAR_LINEAR=2,r.TEXTURE_LINEAR_NEAREST=12,r.TEXTURE_EXPLICIT_MODE=0,r.TEXTURE_SPHERICAL_MODE=1,r.TEXTURE_PLANAR_MODE=2,r.TEXTURE_CUBIC_MODE=3,r.TEXTURE_PROJECTION_MODE=4,r.TEXTURE_SKYBOX_MODE=5,r.TEXTURE_INVCUBIC_MODE=6,r.TEXTURE_EQUIRECTANGULAR_MODE=7,r.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,r.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,r.SCALEMODE_FLOOR=1,r.SCALEMODE_NEAREST=2,r.SCALEMODE_CEILING=3,r._RescalePostProcessFactory=null,r}(a.a)},function($,W,M){"use strict";M.d(W,"b",function(){return O}),M.d(W,"c",function(){return F}),M.d(W,"a",function(){return V});var P=M(434),d=M(438),m=M(443),n=M(474),c=M(663),a=M(436),_=M(441),s=M(453),u=M(447),p=M(485),l=M(661),h=M(462),t=M(559),e=M(536),i=M(459),r=M(543),o=M(668),g=M(439),y=M(440),v=M(437),f=M(476),b=M(452),T=M(721),E=M(596),O=function(){function z(){}return z}(),D=function(){function z(){this.visibleInstances={},this.batchCache=new F,this.instancesBufferSize=32*16*4}return z}(),F=function(){function z(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=new Array,this.hardwareInstancedRendering=new Array}return z}(),x=function(){function z(){this.instancesCount=0,this.matrixBuffer=null,this.matrixBufferSize=32*16,this.boundingVectors=[],this.worldMatrices=null}return z}(),j=function(){function z(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._morphTargetManager=null}return z}(),V=function(z){Object(P.d)(w,z);function w(R,L,N,B,X,K){L===void 0&&(L=null),N===void 0&&(N=null),B===void 0&&(B=null),K===void 0&&(K=!0);var G=z.call(this,R,L)||this;if(G._internalMeshDataInfo=new j,G.delayLoadState=0,G.instances=new Array,G._creationDataStorage=null,G._geometry=null,G._instanceDataStorage=new D,G._thinInstanceDataStorage=new x,G._effectiveMaterial=null,G._shouldGenerateFlatShading=!1,G._originalBuilderSideOrientation=w.DEFAULTSIDE,G.overrideMaterialSideOrientation=null,G.ignoreCameraMaxZ=!1,L=G.getScene(),B){if(B._geometry&&B._geometry.applyToMesh(G),n.a.DeepCopy(B,G,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","source","worldMatrixInstancedBuffer","hasLODLevels","geometry","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","isWorldMatrixFrozen","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap"],["_poseMatrix"]),G._internalMeshDataInfo._source=B,L.useClonedMeshMap&&(B._internalMeshDataInfo.meshMap||(B._internalMeshDataInfo.meshMap={}),B._internalMeshDataInfo.meshMap[G.uniqueId]=G),G._originalBuilderSideOrientation=B._originalBuilderSideOrientation,G._creationDataStorage=B._creationDataStorage,B._ranges){var I=B._ranges;for(var R in I)!I.hasOwnProperty(R)||!I[R]||G.createAnimationRange(R,I[R].from,I[R].to)}B.metadata&&B.metadata.clone?G.metadata=B.metadata.clone():G.metadata=B.metadata,c.a&&c.a.HasTags(B)&&c.a.AddTagsTo(G,c.a.GetTags(B,!0)),G.setEnabled(B.isEnabled()),G.parent=B.parent,G.setPivotMatrix(B.getPivotMatrix()),G.id=R+"."+B.id,G.material=B.material;var A;if(!X)for(var S=B.getDescendants(!0),C=0;C<S.length;C++){var U=S[C];U.clone&&U.clone(R+"."+U.name,G)}if(B.morphTargetManager&&(G.morphTargetManager=B.morphTargetManager),L.getPhysicsEngine){var k=L.getPhysicsEngine();if(K&&k){var J=k.getImpostorForPhysicsObject(B);J&&(G.physicsImpostor=J.clone(G))}}for(A=0;A<L.particleSystems.length;A++){var Y=L.particleSystems[A];Y.emitter===B&&Y.clone(Y.name,G)}G.refreshBoundingInfo(),G.computeWorldMatrix(!0)}return N!==null&&(G.parent=N),G._instanceDataStorage.hardwareInstancedRendering=G.getEngine().getCaps().instancedArrays,G}return w._GetDefaultSideOrientation=function(R){return R||w.FRONTSIDE},Object.defineProperty(w.prototype,"computeBonesUsingShaders",{get:function(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders},set:function(R){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==R&&(R&&this._internalMeshDataInfo._sourcePositions&&(this.setVerticesData(u.b.PositionKind,this._internalMeshDataInfo._sourcePositions.slice(),!0),this._internalMeshDataInfo._sourceNormals&&this.setVerticesData(u.b.NormalKind,this._internalMeshDataInfo._sourceNormals.slice(),!0)),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=R,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"onBeforeRenderObservable",{get:function(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new d.c),this._internalMeshDataInfo._onBeforeRenderObservable},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"onBeforeBindObservable",{get:function(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new d.c),this._internalMeshDataInfo._onBeforeBindObservable},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"onAfterRenderObservable",{get:function(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new d.c),this._internalMeshDataInfo._onAfterRenderObservable},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"onBetweenPassObservable",{get:function(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new d.c),this._internalMeshDataInfo._onBetweenPassObservable},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"onBeforeDrawObservable",{get:function(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new d.c),this._internalMeshDataInfo._onBeforeDrawObservable},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"onBeforeDraw",{set:function(R){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(R)},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"hasInstances",{get:function(){return this.instances.length>0},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"hasThinInstances",{get:function(){var R;return((R=this._thinInstanceDataStorage.instancesCount)!==null&&R!==void 0?R:0)>0},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"morphTargetManager",{get:function(){return this._internalMeshDataInfo._morphTargetManager},set:function(R){this._internalMeshDataInfo._morphTargetManager!==R&&(this._internalMeshDataInfo._morphTargetManager=R,this._syncGeometryWithMorphTargetManager())},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"source",{get:function(){return this._internalMeshDataInfo._source},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"cloneMeshMap",{get:function(){return this._internalMeshDataInfo.meshMap},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"isUnIndexed",{get:function(){return this._unIndexed},set:function(R){this._unIndexed!==R&&(this._unIndexed=R,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"worldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.instancesData},enumerable:!1,configurable:!0}),Object.defineProperty(w.prototype,"manualUpdateOfWorldMatrixInstancedBuffer",{get:function(){return this._instanceDataStorage.manualUpdate},set:function(R){this._instanceDataStorage.manualUpdate=R},enumerable:!1,configurable:!0}),w.prototype.instantiateHierarchy=function(R,L,N){R===void 0&&(R=null);var B=this.getTotalVertices()>0&&(!L||!L.doNotInstantiate)?this.createInstance("instance of "+(this.name||this.id)):this.clone("Clone of "+(this.name||this.id),R||this.parent,!0);B&&(B.parent=R||this.parent,B.position=this.position.clone(),B.scaling=this.scaling.clone(),this.rotationQuaternion?B.rotationQuaternion=this.rotationQuaternion.clone():B.rotation=this.rotation.clone(),N&&N(this,B));for(var X=0,K=this.getChildTransformNodes(!0);X<K.length;X++){var G=K[X];G.instantiateHierarchy(B,L,N)}return B},w.prototype.getClassName=function(){return"Mesh"},Object.defineProperty(w.prototype,"_isMesh",{get:function(){return!0},enumerable:!1,configurable:!0}),w.prototype.toString=function(R){var L=z.prototype.toString.call(this,R);if(L+=", n vertices: "+this.getTotalVertices(),L+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(var N=0;N<this.animations.length;N++)L+=", animation[0]: "+this.animations[N].toString(R);if(R)if(this._geometry){var B=this.getIndices(),X=this.getVerticesData(u.b.PositionKind);X&&B&&(L+=", flat shading: "+(X.length/3===B.length?"YES":"NO"))}else L+=", flat shading: UNKNOWN";return L},w.prototype._unBindEffect=function(){z.prototype._unBindEffect.call(this);for(var R=0,L=this.instances;R<L.length;R++){var N=L[R];N._unBindEffect()}},Object.defineProperty(w.prototype,"hasLODLevels",{get:function(){return this._internalMeshDataInfo._LODLevels.length>0},enumerable:!1,configurable:!0}),w.prototype.getLODLevels=function(){return this._internalMeshDataInfo._LODLevels},w.prototype._sortLODLevels=function(){this._internalMeshDataInfo._LODLevels.sort(function(R,L){return R.distance<L.distance?1:R.distance>L.distance?-1:0})},w.prototype.addLODLevel=function(R,L){if(L&&L._masterMesh)return y.a.Warn("You cannot use a mesh as LOD level twice"),this;var N=new T.a(R,L);return this._internalMeshDataInfo._LODLevels.push(N),L&&(L._masterMesh=this),this._sortLODLevels(),this},w.prototype.getLODLevelAtDistance=function(R){for(var L=this._internalMeshDataInfo,N=0;N<L._LODLevels.length;N++){var B=L._LODLevels[N];if(B.distance===R)return B.mesh}return null},w.prototype.removeLODLevel=function(R){for(var L=this._internalMeshDataInfo,N=0;N<L._LODLevels.length;N++)L._LODLevels[N].mesh===R&&(L._LODLevels.splice(N,1),R&&(R._masterMesh=null));return this._sortLODLevels(),this},w.prototype.getLOD=function(R,L){var N=this._internalMeshDataInfo;if(!N._LODLevels||N._LODLevels.length===0)return this;var B;if(L)B=L;else{var X=this.getBoundingInfo();B=X.boundingSphere}var K=B.centerWorld.subtract(R.globalPosition).length();if(N._LODLevels[N._LODLevels.length-1].distance>K)return this.onLODLevelSelection&&this.onLODLevelSelection(K,this,this),this;for(var G=0;G<N._LODLevels.length;G++){var I=N._LODLevels[G];if(I.distance<K){if(I.mesh){if(I.mesh.delayLoadState===4)return I.mesh._checkDelayState(),this;if(I.mesh.delayLoadState===2)return this;I.mesh._preActivate(),I.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(K,this,I.mesh),I.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(K,this,this),this},Object.defineProperty(w.prototype,"geometry",{get:function(){return this._geometry},enumerable:!1,configurable:!0}),w.prototype.getTotalVertices=function(){return this._geometry===null||this._geometry===void 0?0:this._geometry.getTotalVertices()},w.prototype.getVerticesData=function(R,L,N){var B,X;if(!this._geometry)return null;var K=(X=(B=this._userInstancedBuffersStorage)===null||B===void 0?void 0:B.vertexBuffers[R])===null||X===void 0?void 0:X.getFloatData(this._geometry.getTotalVertices(),N||L&&this._geometry.meshes.length!==1);return K||(K=this._geometry.getVerticesData(R,L,N)),K},w.prototype.getVertexBuffer=function(R){var L,N;return this._geometry?(N=(L=this._userInstancedBuffersStorage)===null||L===void 0?void 0:L.vertexBuffers[R])!==null&&N!==void 0?N:this._geometry.getVertexBuffer(R):null},w.prototype.isVerticesDataPresent=function(R){var L;return this._geometry?((L=this._userInstancedBuffersStorage)===null||L===void 0?void 0:L.vertexBuffers[R])!==void 0||this._geometry.isVerticesDataPresent(R):this._delayInfo?this._delayInfo.indexOf(R)!==-1:!1},w.prototype.isVertexBufferUpdatable=function(R){var L,N;return this._geometry?((N=(L=this._userInstancedBuffersStorage)===null||L===void 0?void 0:L.vertexBuffers[R])===null||N===void 0?void 0:N.isUpdatable())||this._geometry.isVertexBufferUpdatable(R):this._delayInfo?this._delayInfo.indexOf(R)!==-1:!1},w.prototype.getVerticesDataKinds=function(){if(!this._geometry){var R=new Array;return this._delayInfo&&this._delayInfo.forEach(function(B){R.push(B)}),R}var L=this._geometry.getVerticesDataKinds();if(this._userInstancedBuffersStorage)for(var N in this._userInstancedBuffersStorage.vertexBuffers)L.push(N);return L},w.prototype.getTotalIndices=function(){return this._geometry?this._geometry.getTotalIndices():0},w.prototype.getIndices=function(R,L){return this._geometry?this._geometry.getIndices(R,L):[]},Object.defineProperty(w.prototype,"isBlocked",{get:function(){return this._masterMesh!==null&&this._masterMesh!==void 0},enumerable:!1,configurable:!0}),w.prototype.isReady=function(R,L){var N,B,X,K,G,I;if(R===void 0&&(R=!1),L===void 0&&(L=!1),this.delayLoadState===2||!z.prototype.isReady.call(this,R))return!1;if(!this.subMeshes||this.subMeshes.length===0||!R)return!0;var A=this.getEngine(),S=this.getScene(),C=L||A.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.computeWorldMatrix();var U=this.material||S.defaultMaterial;if(U){if(U._storeEffectOnSubMeshes)for(var k=0,J=this.subMeshes;k<J.length;k++){var Y=J[k],Z=Y.getMaterial();if(Z){if(Z._storeEffectOnSubMeshes){if(!Z.isReadyForSubMesh(this,Y,C))return!1}else if(!Z.isReady(this,C))return!1}}else if(!U.isReady(this,C))return!1}for(var Q=0,te=this.lightSources;Q<te.length;Q++){var re=te[Q],ae=re.getShadowGenerator();if(ae&&(!((N=ae.getShadowMap())===null||N===void 0?void 0:N.renderList)||((B=ae.getShadowMap())===null||B===void 0?void 0:B.renderList)&&((K=(X=ae.getShadowMap())===null||X===void 0?void 0:X.renderList)===null||K===void 0?void 0:K.indexOf(this))!==-1))for(var ne=0,ie=this.subMeshes;ne<ie.length;ne++){var Y=ie[ne];if(!ae.isReady(Y,C,(I=(G=Y.getMaterial())===null||G===void 0?void 0:G.needAlphaBlendingForMesh(this))!==null&&I!==void 0?I:!1))return!1}}for(var fe=0,he=this._internalMeshDataInfo._LODLevels;fe<he.length;fe++){var pe=he[fe];if(pe.mesh&&!pe.mesh.isReady(C))return!1}return!0},Object.defineProperty(w.prototype,"areNormalsFrozen",{get:function(){return this._internalMeshDataInfo._areNormalsFrozen},enumerable:!1,configurable:!0}),w.prototype.freezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this},w.prototype.unfreezeNormals=function(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this},Object.defineProperty(w.prototype,"overridenInstanceCount",{set:function(R){this._instanceDataStorage.overridenInstanceCount=R},enumerable:!1,configurable:!0}),w.prototype._preActivate=function(){var R=this._internalMeshDataInfo,L=this.getScene().getRenderId();return R._preActivateId===L?this:(R._preActivateId=L,this._instanceDataStorage.visibleInstances=null,this)},w.prototype._preActivateForIntermediateRendering=function(R){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=R),this},w.prototype._registerInstanceForRenderId=function(R,L){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:L,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[L]||(this._instanceDataStorage.previousRenderId!==void 0&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=L,this._instanceDataStorage.visibleInstances[L]=new Array),this._instanceDataStorage.visibleInstances[L].push(R),this},w.prototype._afterComputeWorldMatrix=function(){z.prototype._afterComputeWorldMatrix.call(this),!!this.hasThinInstances&&(this.doNotSyncBoundingInfo||this.thinInstanceRefreshBoundingInfo(!1))},w.prototype._postActivate=function(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))},w.prototype.refreshBoundingInfo=function(R){if(R===void 0&&(R=!1),this._boundingInfo&&this._boundingInfo.isLocked)return this;var L=this.geometry?this.geometry.boundingBias:null;return this._refreshBoundingInfo(this._getPositionData(R),L),this},w.prototype._createGlobalSubMesh=function(R){var L=this.getTotalVertices();if(!L||!this.getIndices())return null;if(this.subMeshes&&this.subMeshes.length>0){var N=this.getIndices();if(!N)return null;var B=N.length,X=!1;if(R)X=!0;else for(var K=0,G=this.subMeshes;K<G.length;K++){var I=G[K];if(I.indexStart+I.indexCount>B){X=!0;break}if(I.verticesStart+I.verticesCount>L){X=!0;break}}if(!X)return this.subMeshes[0]}return this.releaseSubMeshes(),new t.a(0,0,L,0,this.getTotalIndices(),this)},w.prototype.subdivide=function(R){if(!(R<1)){for(var L=this.getTotalIndices(),N=L/R|0,B=0;N%3!=0;)N++;this.releaseSubMeshes();for(var X=0;X<R&&!(B>=L);X++)t.a.CreateFromIndices(0,B,X===R-1?L-B:N,this),B+=N;this.synchronizeInstances()}},w.prototype.setVerticesData=function(R,L,N,B){if(N===void 0&&(N=!1),this._geometry)this._geometry.setVerticesData(R,L,N,B);else{var X=new p.a;X.set(L,R);var K=this.getScene();new l.a(l.a.RandomId(),K,X,N,this)}return this},w.prototype.removeVerticesData=function(R){!this._geometry||this._geometry.removeVerticesData(R)},w.prototype.markVerticesDataAsUpdatable=function(R,L){L===void 0&&(L=!0);var N=this.getVertexBuffer(R);!N||N.isUpdatable()===L||this.setVerticesData(R,this.getVerticesData(R),L)},w.prototype.setVerticesBuffer=function(R){return this._geometry||(this._geometry=l.a.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(R),this},w.prototype.updateVerticesData=function(R,L,N,B){return this._geometry?(B?(this.makeGeometryUnique(),this.updateVerticesData(R,L,N,!1)):this._geometry.updateVerticesData(R,L,N),this):this},w.prototype.updateMeshPositions=function(R,L){L===void 0&&(L=!0);var N=this.getVerticesData(u.b.PositionKind);if(!N)return this;if(R(N),this.updateVerticesData(u.b.PositionKind,N,!1,!1),L){var B=this.getIndices(),X=this.getVerticesData(u.b.NormalKind);if(!X)return this;p.a.ComputeNormals(N,B,X),this.updateVerticesData(u.b.NormalKind,X,!1,!1)}return this},w.prototype.makeGeometryUnique=function(){if(!this._geometry)return this;if(this._geometry.meshes.length===1)return this;var R=this._geometry,L=this._geometry.copy(l.a.RandomId());return R.releaseForMesh(this,!0),L.applyToMesh(this),this},w.prototype.setIndices=function(R,L,N){if(L===void 0&&(L=null),N===void 0&&(N=!1),this._geometry)this._geometry.setIndices(R,L,N);else{var B=new p.a;B.indices=R;var X=this.getScene();new l.a(l.a.RandomId(),X,B,N,this)}return this},w.prototype.updateIndices=function(R,L,N){return N===void 0&&(N=!1),this._geometry?(this._geometry.updateIndices(R,L,N),this):this},w.prototype.toLeftHanded=function(){return this._geometry?(this._geometry.toLeftHanded(),this):this},w.prototype._bind=function(R,L,N){if(!this._geometry)return this;var B=this.getScene().getEngine();this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(L);var X;if(this._unIndexed)X=null;else switch(N){case i.a.PointFillMode:X=null;break;case i.a.WireFrameFillMode:X=R._getLinesIndexBuffer(this.getIndices(),B);break;default:case i.a.TriangleFillMode:X=this._geometry.getIndexBuffer();break}return this._userInstancedBuffersStorage?this._geometry._bind(L,X,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(L,X),this},w.prototype._draw=function(R,L,N){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);var B=this.getScene(),X=B.getEngine();return this._unIndexed||L==i.a.PointFillMode?X.drawArraysType(L,R.verticesStart,R.verticesCount,N):L==i.a.WireFrameFillMode?X.drawElementsType(L,0,R._linesIndexCount,N):X.drawElementsType(L,R.indexStart,R.indexCount,N),this},w.prototype.registerBeforeRender=function(R){return this.onBeforeRenderObservable.add(R),this},w.prototype.unregisterBeforeRender=function(R){return this.onBeforeRenderObservable.removeCallback(R),this},w.prototype.registerAfterRender=function(R){return this.onAfterRenderObservable.add(R),this},w.prototype.unregisterAfterRender=function(R){return this.onAfterRenderObservable.removeCallback(R),this},w.prototype._getInstancesRenderList=function(R,L){if(L===void 0&&(L=!1),this._instanceDataStorage.isFrozen&&this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch;var N=this.getScene(),B=N._isInIntermediateRendering(),X=B?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,K=this._instanceDataStorage.batchCache;if(K.mustReturn=!1,K.renderSelf[R]=L||!X&&this.isEnabled()&&this.isVisible,K.visibleInstances[R]=null,this._instanceDataStorage.visibleInstances&&!L){var G=this._instanceDataStorage.visibleInstances,I=N.getRenderId(),A=B?G.intermediateDefaultRenderId:G.defaultRenderId;K.visibleInstances[R]=G[I],!K.visibleInstances[R]&&A&&(K.visibleInstances[R]=G[A])}return K.hardwareInstancedRendering[R]=!L&&this._instanceDataStorage.hardwareInstancedRendering&&K.visibleInstances[R]!==null&&K.visibleInstances[R]!==void 0,this._instanceDataStorage.previousBatch=K,K},w.prototype._renderWithInstances=function(R,L,N,B,X){var K=N.visibleInstances[R._id];if(!K)return this;for(var G=this._instanceDataStorage,I=G.instancesBufferSize,A=G.instancesBuffer,S=K.length+1,C=S*16*4;G.instancesBufferSize<C;)G.instancesBufferSize*=2;(!G.instancesData||I!=G.instancesBufferSize)&&(G.instancesData=new Float32Array(G.instancesBufferSize/4));var U=0,k=0,J=N.renderSelf[R._id],Y=!A||I!==G.instancesBufferSize;if(!this._instanceDataStorage.manualUpdate&&(!G.isFrozen||Y)){var Z=this._effectiveMesh.getWorldMatrix();if(J&&(Z.copyToArray(G.instancesData,U),U+=16,k++),K)for(var Q=0;Q<K.length;Q++){var te=K[Q];te.getWorldMatrix().copyToArray(G.instancesData,U),U+=16,k++}}else k=(J?1:0)+K.length;return Y?(A&&A.dispose(),A=new u.a(X,G.instancesData,!0,16,!1,!0),G.instancesBuffer=A,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=A.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=A.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=A.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=A.createVertexBuffer("world3",12,4),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen||A.updateDirectly(G.instancesData,0,k),this._processInstancedBuffers(K,J),this.getScene()._activeIndices.addCount(R.indexCount*k,!1),this._bind(R,B,L),this._draw(R,L,k),X.unbindInstanceAttributes(),this},w.prototype._renderWithThinInstances=function(R,L,N,B){var X,K,G=(K=(X=this._thinInstanceDataStorage)===null||X===void 0?void 0:X.instancesCount)!==null&&K!==void 0?K:0;this.getScene()._activeIndices.addCount(R.indexCount*G,!1),this._bind(R,N,L),this._draw(R,L,G),B.unbindInstanceAttributes()},w.prototype._processInstancedBuffers=function(R,L){},w.prototype._processRendering=function(R,L,N,B,X,K,G,I){var A=this.getScene(),S=A.getEngine();if(K&&L.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(L,B,N,S),this;if(K)this._renderWithInstances(L,B,X,N,S);else{var C=0;X.renderSelf[L._id]&&(G&&G(!1,R._effectiveMesh.getWorldMatrix(),I),C++,this._draw(L,B,this._instanceDataStorage.overridenInstanceCount));var U=X.visibleInstances[L._id];if(U){var k=U.length;C+=k;for(var J=0;J<k;J++){var Y=U[J],Z=Y.getWorldMatrix();G&&G(!0,Z,I),this._draw(L,B)}}A._activeIndices.addCount(L.indexCount*C,!1)}return this},w.prototype._rebuild=function(){if(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(var R in this._userInstancedBuffersStorage.vertexBuffers){var L=this._userInstancedBuffersStorage.vertexBuffers[R];L&&(L.dispose(),this._userInstancedBuffersStorage.vertexBuffers[R]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}z.prototype._rebuild.call(this)},w.prototype._freeze=function(){if(!!this.subMeshes){for(var R=0;R<this.subMeshes.length;R++)this._getInstancesRenderList(R);this._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}},w.prototype._unFreeze=function(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null},w.prototype.render=function(R,L,N){var B=this.getScene();if(this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1,this._checkOcclusionQuery())return this;var X=this._getInstancesRenderList(R._id,!!N);if(X.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;var K=0,G=null;this.ignoreCameraMaxZ&&B.activeCamera&&!B._isInIntermediateRendering()&&(K=B.activeCamera.maxZ,G=B.activeCamera,B.activeCamera.maxZ=0,B.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);var I=B.getEngine(),A=X.hardwareInstancedRendering[R._id]||R.getRenderingMesh().hasThinInstances,S=this._instanceDataStorage,C=R.getMaterial();if(!C)return G&&(G.maxZ=K,B.updateTransformMatrix(!0)),this;if(!S.isFrozen||!this._effectiveMaterial||this._effectiveMaterial!==C){if(C._storeEffectOnSubMeshes){if(!C.isReadyForSubMesh(this,R,A))return G&&(G.maxZ=K,B.updateTransformMatrix(!0)),this}else if(!C.isReady(this,A))return G&&(G.maxZ=K,B.updateTransformMatrix(!0)),this;this._effectiveMaterial=C}L&&I.setAlphaMode(this._effectiveMaterial.alphaMode);var U;this._effectiveMaterial._storeEffectOnSubMeshes?U=R.effect:U=this._effectiveMaterial.getEffect();for(var k=0,J=B._beforeRenderingMeshStage;k<J.length;k++){var Y=J[k];Y.action(this,R,X,U)}if(!U)return G&&(G.maxZ=K,B.updateTransformMatrix(!0)),this;var Z=N||this._effectiveMesh,Q;if(!S.isFrozen&&(this._effectiveMaterial.backFaceCulling||this.overrideMaterialSideOrientation!==null)){var te=Z._getWorldMatrixDeterminant();Q=this.overrideMaterialSideOrientation,Q==null&&(Q=this._effectiveMaterial.sideOrientation),te<0&&(Q=Q===i.a.ClockWiseSideOrientation?i.a.CounterClockWiseSideOrientation:i.a.ClockWiseSideOrientation),S.sideOrientation=Q}else Q=S.sideOrientation;var re=this._effectiveMaterial._preBind(U,Q);this._effectiveMaterial.forceDepthWrite&&I.setDepthWrite(!0);var ae=B.forcePointsCloud?i.a.PointFillMode:B.forceWireframe?i.a.WireFrameFillMode:this._effectiveMaterial.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),A||this._bind(R,U,ae);var ne=Z.getWorldMatrix();this._effectiveMaterial._storeEffectOnSubMeshes?this._effectiveMaterial.bindForSubMesh(ne,this,R):this._effectiveMaterial.bind(ne,this),!this._effectiveMaterial.backFaceCulling&&this._effectiveMaterial.separateCullingPass&&(I.setState(!0,this._effectiveMaterial.zOffset,!1,!re),this._processRendering(this,R,U,ae,X,A,this._onBeforeDraw,this._effectiveMaterial),I.setState(!0,this._effectiveMaterial.zOffset,!1,re),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(R)),this._processRendering(this,R,U,ae,X,A,this._onBeforeDraw,this._effectiveMaterial),this._effectiveMaterial.unbind();for(var ie=0,fe=B._afterRenderingMeshStage;ie<fe.length;ie++){var Y=fe[ie];Y.action(this,R,X,U)}return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),G&&(G.maxZ=K,B.updateTransformMatrix(!0)),this},w.prototype._onBeforeDraw=function(R,L,N){R&&N&&N.bindOnlyWorldMatrix(L)},w.prototype.cleanMatrixWeights=function(){this.isVerticesDataPresent(u.b.MatricesWeightsKind)&&(this.isVerticesDataPresent(u.b.MatricesWeightsExtraKind)?this.normalizeSkinWeightsAndExtra():this.normalizeSkinFourWeights())},w.prototype.normalizeSkinFourWeights=function(){for(var R=this.getVerticesData(u.b.MatricesWeightsKind),L=R.length,N=0;N<L;N+=4){var B=R[N]+R[N+1]+R[N+2]+R[N+3];if(B===0)R[N]=1;else{var X=1/B;R[N]*=X,R[N+1]*=X,R[N+2]*=X,R[N+3]*=X}}this.setVerticesData(u.b.MatricesWeightsKind,R)},w.prototype.normalizeSkinWeightsAndExtra=function(){for(var R=this.getVerticesData(u.b.MatricesWeightsExtraKind),L=this.getVerticesData(u.b.MatricesWeightsKind),N=L.length,B=0;B<N;B+=4){var X=L[B]+L[B+1]+L[B+2]+L[B+3];if(X+=R[B]+R[B+1]+R[B+2]+R[B+3],X===0)L[B]=1;else{var K=1/X;L[B]*=K,L[B+1]*=K,L[B+2]*=K,L[B+3]*=K,R[B]*=K,R[B+1]*=K,R[B+2]*=K,R[B+3]*=K}}this.setVerticesData(u.b.MatricesWeightsKind,L),this.setVerticesData(u.b.MatricesWeightsKind,R)},w.prototype.validateSkinning=function(){var R=this.getVerticesData(u.b.MatricesWeightsExtraKind),L=this.getVerticesData(u.b.MatricesWeightsKind);if(L===null||this.skeleton==null)return{skinned:!1,valid:!0,report:"not skinned"};for(var N=L.length,B=0,X=0,K=0,G=0,I=R===null?4:8,A=new Array,S=0;S<=I;S++)A[S]=0;for(var C=.001,S=0;S<N;S+=4){for(var U=L[S],k=U,J=k===0?0:1,Y=1;Y<I;Y++){var Z=Y<4?L[S+Y]:R[S+Y-4];Z>U&&B++,Z!==0&&J++,k+=Z,U=Z}if(A[J]++,J>K&&(K=J),k===0)X++;else{var Q=1/k,te=0;for(Y=0;Y<I;Y++)Y<4?te+=Math.abs(L[S+Y]-L[S+Y]*Q):te+=Math.abs(R[S+Y-4]-R[S+Y-4]*Q);te>C&&G++}}for(var re=this.skeleton.bones.length,ae=this.getVerticesData(u.b.MatricesIndicesKind),ne=this.getVerticesData(u.b.MatricesIndicesExtraKind),ie=0,S=0;S<N;S+=4)for(var Y=0;Y<I;Y++){var fe=Y<4?ae[S+Y]:ne[S+Y-4];(fe>=re||fe<0)&&ie++}var he="Number of Weights = "+N/4+`
Maximum influences = `+K+`
Missing Weights = `+X+`
Not Sorted = `+B+`
Not Normalized = `+G+`
WeightCounts = [`+A+`]
Number of bones = `+re+`
Bad Bone Indices = `+ie;return{skinned:!0,valid:X===0&&G===0&&ie===0,report:he}},w.prototype._checkDelayState=function(){var R=this.getScene();return this._geometry?this._geometry.load(R):this.delayLoadState===4&&(this.delayLoadState=2,this._queueLoad(R)),this},w.prototype._queueLoad=function(R){var L=this;R._addPendingData(this);var N=this.delayLoadingFile.indexOf(".babylonbinarymeshdata")!==-1;return m.b.LoadFile(this.delayLoadingFile,function(B){B instanceof ArrayBuffer?L._delayLoadingFunction(B,L):L._delayLoadingFunction(JSON.parse(B),L),L.instances.forEach(function(X){X.refreshBoundingInfo(),X._syncSubMeshes()}),L.delayLoadState=1,R._removePendingData(L)},function(){},R.offlineProvider,N),this},w.prototype.isInFrustum=function(R){return this.delayLoadState===2||!z.prototype.isInFrustum.call(this,R)?!1:(this._checkDelayState(),!0)},w.prototype.setMaterialByID=function(R){var L=this.getScene().materials,N;for(N=L.length-1;N>-1;N--)if(L[N].id===R)return this.material=L[N],this;var B=this.getScene().multiMaterials;for(N=B.length-1;N>-1;N--)if(B[N].id===R)return this.material=B[N],this;return this},w.prototype.getAnimatables=function(){var R=new Array;return this.material&&R.push(this.material),this.skeleton&&R.push(this.skeleton),R},w.prototype.bakeTransformIntoVertices=function(R){if(!this.isVerticesDataPresent(u.b.PositionKind))return this;var L=this.subMeshes.splice(0);this._resetPointsArrayCache();var N=this.getVerticesData(u.b.PositionKind),B=new Array,X;for(X=0;X<N.length;X+=3)a.e.TransformCoordinates(a.e.FromArray(N,X),R).toArray(B,X);if(this.setVerticesData(u.b.PositionKind,B,this.getVertexBuffer(u.b.PositionKind).isUpdatable()),this.isVerticesDataPresent(u.b.NormalKind)){for(N=this.getVerticesData(u.b.NormalKind),B=[],X=0;X<N.length;X+=3)a.e.TransformNormal(a.e.FromArray(N,X),R).normalize().toArray(B,X);this.setVerticesData(u.b.NormalKind,B,this.getVertexBuffer(u.b.NormalKind).isUpdatable())}return R.m[0]*R.m[5]*R.m[10]<0&&this.flipFaces(),this.releaseSubMeshes(),this.subMeshes=L,this},w.prototype.bakeCurrentTransformIntoVertices=function(R){return R===void 0&&(R=!0),this.bakeTransformIntoVertices(this.computeWorldMatrix(!0)),this.resetLocalMatrix(R),this},Object.defineProperty(w.prototype,"_positions",{get:function(){return this._geometry?this._geometry._positions:null},enumerable:!1,configurable:!0}),w.prototype._resetPointsArrayCache=function(){return this._geometry&&this._geometry._resetPointsArrayCache(),this},w.prototype._generatePointsArray=function(){return this._geometry?this._geometry._generatePointsArray():!1},w.prototype.clone=function(R,L,N,B){return R===void 0&&(R=""),L===void 0&&(L=null),B===void 0&&(B=!0),new w(R,this.getScene(),L,this,N,B)},w.prototype.dispose=function(R,L){L===void 0&&(L=!1),this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);var N=this._internalMeshDataInfo;if(N._onBeforeDrawObservable&&N._onBeforeDrawObservable.clear(),N._onBeforeBindObservable&&N._onBeforeBindObservable.clear(),N._onBeforeRenderObservable&&N._onBeforeRenderObservable.clear(),N._onAfterRenderObservable&&N._onAfterRenderObservable.clear(),N._onBetweenPassObservable&&N._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(N.meshMap)for(var B in N.meshMap){var X=N.meshMap[B];X&&(X._internalMeshDataInfo._source=null,N.meshMap[B]=void 0)}N._source&&N._source._internalMeshDataInfo.meshMap&&(N._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else for(var K=this.getScene().meshes,G=0,I=K;G<I.length;G++){var A=I[G],X=A;X._internalMeshDataInfo&&X._internalMeshDataInfo._source&&X._internalMeshDataInfo._source===this&&(X._internalMeshDataInfo._source=null)}N._source=null,this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),z.prototype.dispose.call(this,R,L)},w.prototype._disposeInstanceSpecificData=function(){},w.prototype._disposeThinInstanceSpecificData=function(){},w.prototype._invalidateInstanceVertexArrayObject=function(){},w.prototype.applyDisplacementMap=function(R,L,N,B,X,K,G){var I=this;G===void 0&&(G=!1);var A=this.getScene(),S=function(C){var U=C.width,k=C.height,J=E.a.CreateCanvas(U,k),Y=J.getContext("2d");Y.drawImage(C,0,0);var Z=Y.getImageData(0,0,U,k).data;I.applyDisplacementMapFromBuffer(Z,U,k,L,N,X,K,G),B&&B(I)};return m.b.LoadImage(R,S,function(){},A.offlineProvider),this},w.prototype.applyDisplacementMapFromBuffer=function(R,L,N,B,X,K,G,I){if(I===void 0&&(I=!1),!this.isVerticesDataPresent(u.b.PositionKind)||!this.isVerticesDataPresent(u.b.NormalKind)||!this.isVerticesDataPresent(u.b.UVKind))return y.a.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;var A=this.getVerticesData(u.b.PositionKind,!0,!0),S=this.getVerticesData(u.b.NormalKind),C=this.getVerticesData(u.b.UVKind),U=a.e.Zero(),k=a.e.Zero(),J=a.d.Zero();K=K||a.d.Zero(),G=G||new a.d(1,1);for(var Y=0;Y<A.length;Y+=3){a.e.FromArrayToRef(A,Y,U),a.e.FromArrayToRef(S,Y,k),a.d.FromArrayToRef(C,Y/3*2,J);var Z=Math.abs(J.x*G.x+K.x%1)*(L-1)%L|0,Q=Math.abs(J.y*G.y+K.y%1)*(N-1)%N|0,te=(Z+Q*L)*4,re=R[te]/255,ae=R[te+1]/255,ne=R[te+2]/255,ie=re*.3+ae*.59+ne*.11;k.normalize(),k.scaleInPlace(B+(X-B)*ie),U=U.add(k),U.toArray(A,Y)}return p.a.ComputeNormals(A,this.getIndices(),S),I?(this.setVerticesData(u.b.PositionKind,A),this.setVerticesData(u.b.NormalKind,S)):(this.updateVerticesData(u.b.PositionKind,A),this.updateVerticesData(u.b.NormalKind,S)),this},w.prototype.convertToFlatShadedMesh=function(){var R=this.getVerticesDataKinds(),L={},N={},B={},X=!1,K,G;for(K=0;K<R.length;K++){G=R[K];var I=this.getVertexBuffer(G);if(G===u.b.NormalKind){X=I.isUpdatable(),R.splice(K,1),K--;continue}L[G]=I,N[G]=L[G].getData(),B[G]=[]}var A=this.subMeshes.slice(0),S=this.getIndices(),C=this.getTotalIndices(),U;for(U=0;U<C;U++){var k=S[U];for(K=0;K<R.length;K++){G=R[K];for(var J=L[G].getStrideSize(),Y=0;Y<J;Y++)B[G].push(N[G][k*J+Y])}}var Z=[],Q=B[u.b.PositionKind];for(U=0;U<C;U+=3){S[U]=U,S[U+1]=U+1,S[U+2]=U+2;for(var te=a.e.FromArray(Q,U*3),re=a.e.FromArray(Q,(U+1)*3),ae=a.e.FromArray(Q,(U+2)*3),ne=te.subtract(re),ie=ae.subtract(re),fe=a.e.Normalize(a.e.Cross(ne,ie)),he=0;he<3;he++)Z.push(fe.x),Z.push(fe.y),Z.push(fe.z)}for(this.setIndices(S),this.setVerticesData(u.b.NormalKind,Z,X),K=0;K<R.length;K++)G=R[K],this.setVerticesData(G,B[G],L[G].isUpdatable());this.releaseSubMeshes();for(var pe=0;pe<A.length;pe++){var ue=A[pe];t.a.AddToMesh(ue.materialIndex,ue.indexStart,ue.indexCount,ue.indexStart,ue.indexCount,this)}return this.synchronizeInstances(),this},w.prototype.convertToUnIndexedMesh=function(){var R=this.getVerticesDataKinds(),L={},N={},B={},X,K;for(X=0;X<R.length;X++){K=R[X];var G=this.getVertexBuffer(K);L[K]=G,N[K]=L[K].getData(),B[K]=[]}var I=this.subMeshes.slice(0),A=this.getIndices(),S=this.getTotalIndices(),C;for(C=0;C<S;C++){var U=A[C];for(X=0;X<R.length;X++){K=R[X];for(var k=L[K].getStrideSize(),J=0;J<k;J++)B[K].push(N[K][U*k+J])}}for(C=0;C<S;C+=3)A[C]=C,A[C+1]=C+1,A[C+2]=C+2;for(this.setIndices(A),X=0;X<R.length;X++)K=R[X],this.setVerticesData(K,B[K],L[K].isUpdatable());this.releaseSubMeshes();for(var Y=0;Y<I.length;Y++){var Z=I[Y];t.a.AddToMesh(Z.materialIndex,Z.indexStart,Z.indexCount,Z.indexStart,Z.indexCount,this)}return this._unIndexed=!0,this.synchronizeInstances(),this},w.prototype.flipFaces=function(R){R===void 0&&(R=!1);var L=p.a.ExtractFromMesh(this),N;if(R&&this.isVerticesDataPresent(u.b.NormalKind)&&L.normals)for(N=0;N<L.normals.length;N++)L.normals[N]*=-1;if(L.indices){var B;for(N=0;N<L.indices.length;N+=3)B=L.indices[N+1],L.indices[N+1]=L.indices[N+2],L.indices[N+2]=B}return L.applyToMesh(this,this.isVertexBufferUpdatable(u.b.PositionKind)),this},w.prototype.increaseVertices=function(R){var L=p.a.ExtractFromMesh(this),N=L.uvs,B=L.indices&&!Array.isArray(L.indices)&&Array.from?Array.from(L.indices):L.indices,X=L.positions&&!Array.isArray(L.positions)&&Array.from?Array.from(L.positions):L.positions,K=L.normals&&!Array.isArray(L.normals)&&Array.from?Array.from(L.normals):L.normals;if(!B||!X||!K||!N)y.a.Warn("VertexData contains null entries");else{L.indices=B,L.positions=X,L.normals=K;for(var G=R+1,I=new Array,A=0;A<G+1;A++)I[A]=new Array;for(var S,C,U=new a.e(0,0,0),k=new a.e(0,0,0),J=new a.d(0,0),Y=new Array,Z=new Array,Q=new Array,te,re=X.length,ae=N.length,A=0;A<B.length;A+=3){Z[0]=B[A],Z[1]=B[A+1],Z[2]=B[A+2];for(var ne=0;ne<3;ne++)if(S=Z[ne],C=Z[(ne+1)%3],Q[S]===void 0&&Q[C]===void 0?(Q[S]=new Array,Q[C]=new Array):(Q[S]===void 0&&(Q[S]=new Array),Q[C]===void 0&&(Q[C]=new Array)),Q[S][C]===void 0&&Q[C][S]===void 0){Q[S][C]=[],U.x=(X[3*C]-X[3*S])/G,U.y=(X[3*C+1]-X[3*S+1])/G,U.z=(X[3*C+2]-X[3*S+2])/G,k.x=(K[3*C]-K[3*S])/G,k.y=(K[3*C+1]-K[3*S+1])/G,k.z=(K[3*C+2]-K[3*S+2])/G,J.x=(N[2*C]-N[2*S])/G,J.y=(N[2*C+1]-N[2*S+1])/G,Q[S][C].push(S);for(var ie=1;ie<G;ie++)Q[S][C].push(X.length/3),X[re]=X[3*S]+ie*U.x,K[re++]=K[3*S]+ie*k.x,X[re]=X[3*S+1]+ie*U.y,K[re++]=K[3*S+1]+ie*k.y,X[re]=X[3*S+2]+ie*U.z,K[re++]=K[3*S+2]+ie*k.z,N[ae++]=N[2*S]+ie*J.x,N[ae++]=N[2*S+1]+ie*J.y;Q[S][C].push(C),Q[C][S]=new Array,te=Q[S][C].length;for(var fe=0;fe<te;fe++)Q[C][S][fe]=Q[S][C][te-1-fe]}I[0][0]=B[A],I[1][0]=Q[B[A]][B[A+1]][1],I[1][1]=Q[B[A]][B[A+2]][1];for(var ie=2;ie<G;ie++){I[ie][0]=Q[B[A]][B[A+1]][ie],I[ie][ie]=Q[B[A]][B[A+2]][ie],U.x=(X[3*I[ie][ie]]-X[3*I[ie][0]])/ie,U.y=(X[3*I[ie][ie]+1]-X[3*I[ie][0]+1])/ie,U.z=(X[3*I[ie][ie]+2]-X[3*I[ie][0]+2])/ie,k.x=(K[3*I[ie][ie]]-K[3*I[ie][0]])/ie,k.y=(K[3*I[ie][ie]+1]-K[3*I[ie][0]+1])/ie,k.z=(K[3*I[ie][ie]+2]-K[3*I[ie][0]+2])/ie,J.x=(N[2*I[ie][ie]]-N[2*I[ie][0]])/ie,J.y=(N[2*I[ie][ie]+1]-N[2*I[ie][0]+1])/ie;for(var ne=1;ne<ie;ne++)I[ie][ne]=X.length/3,X[re]=X[3*I[ie][0]]+ne*U.x,K[re++]=K[3*I[ie][0]]+ne*k.x,X[re]=X[3*I[ie][0]+1]+ne*U.y,K[re++]=K[3*I[ie][0]+1]+ne*k.y,X[re]=X[3*I[ie][0]+2]+ne*U.z,K[re++]=K[3*I[ie][0]+2]+ne*k.z,N[ae++]=N[2*I[ie][0]]+ne*J.x,N[ae++]=N[2*I[ie][0]+1]+ne*J.y}I[G]=Q[B[A+1]][B[A+2]],Y.push(I[0][0],I[1][0],I[1][1]);for(var ie=1;ie<G;ie++){for(var ne=0;ne<ie;ne++)Y.push(I[ie][ne],I[ie+1][ne],I[ie+1][ne+1]),Y.push(I[ie][ne],I[ie+1][ne+1],I[ie][ne+1]);Y.push(I[ie][ne],I[ie+1][ne],I[ie+1][ne+1])}}L.indices=Y,L.applyToMesh(this,this.isVertexBufferUpdatable(u.b.PositionKind))}},w.prototype.forceSharedVertices=function(){var R=p.a.ExtractFromMesh(this),L=R.uvs,N=R.indices,B=R.positions,X=R.colors;if(N===void 0||B===void 0||N===null||B===null)y.a.Warn("VertexData contains empty entries");else{for(var K=new Array,G=new Array,I=new Array,A=new Array,S=new Array,C=0,U={},k,J,Y=0;Y<N.length;Y+=3){J=[N[Y],N[Y+1],N[Y+2]],S=new Array;for(var Z=0;Z<3;Z++){S[Z]="";for(var Q=0;Q<3;Q++)Math.abs(B[3*J[Z]+Q])<1e-8&&(B[3*J[Z]+Q]=0),S[Z]+=B[3*J[Z]+Q]+"|"}if(!(S[0]==S[1]||S[0]==S[2]||S[1]==S[2]))for(var Z=0;Z<3;Z++){if(k=U[S[Z]],k===void 0){U[S[Z]]=C,k=C++;for(var Q=0;Q<3;Q++)K.push(B[3*J[Z]+Q]);if(X!=null)for(var Q=0;Q<4;Q++)A.push(X[4*J[Z]+Q]);if(L!=null)for(var Q=0;Q<2;Q++)I.push(L[2*J[Z]+Q])}G.push(k)}}var te=new Array;p.a.ComputeNormals(K,G,te),R.positions=K,R.indices=G,R.normals=te,L!=null&&(R.uvs=I),X!=null&&(R.colors=A),R.applyToMesh(this,this.isVertexBufferUpdatable(u.b.PositionKind))}},w._instancedMeshFactory=function(R,L){throw f.a.WarnImport("InstancedMesh")},w._PhysicsImpostorParser=function(R,L,N){throw f.a.WarnImport("PhysicsImpostor")},w.prototype.createInstance=function(R){return w._instancedMeshFactory(R,this)},w.prototype.synchronizeInstances=function(){for(var R=0;R<this.instances.length;R++){var L=this.instances[R];L._syncSubMeshes()}return this},w.prototype.optimizeIndices=function(R){var L=this,N=this.getIndices(),B=this.getVerticesData(u.b.PositionKind);if(!B||!N)return this;for(var X=new Array,K=0;K<B.length;K=K+3)X.push(a.e.FromArray(B,K));var G=new Array;return m.a.SyncAsyncForLoop(X.length,40,function(I){for(var A=X.length-1-I,S=X[A],C=0;C<A;++C){var U=X[C];if(S.equals(U)){G[A]=C;break}}},function(){for(var I=0;I<N.length;++I)N[I]=G[N[I]]||N[I];var A=L.subMeshes.slice(0);L.setIndices(N),L.subMeshes=A,R&&R(L)}),this},w.prototype.serialize=function(R){R.name=this.name,R.id=this.id,R.uniqueId=this.uniqueId,R.type=this.getClassName(),c.a&&c.a.HasTags(this)&&(R.tags=c.a.GetTags(this)),R.position=this.position.asArray(),this.rotationQuaternion?R.rotationQuaternion=this.rotationQuaternion.asArray():this.rotation&&(R.rotation=this.rotation.asArray()),R.scaling=this.scaling.asArray(),this._postMultiplyPivotMatrix?R.pivotMatrix=this.getPivotMatrix().asArray():R.localMatrix=this.getPivotMatrix().asArray(),R.isEnabled=this.isEnabled(!1),R.isVisible=this.isVisible,R.infiniteDistance=this.infiniteDistance,R.pickable=this.isPickable,R.receiveShadows=this.receiveShadows,R.billboardMode=this.billboardMode,R.visibility=this.visibility,R.checkCollisions=this.checkCollisions,R.isBlocker=this.isBlocker,R.overrideMaterialSideOrientation=this.overrideMaterialSideOrientation,this.parent&&(R.parentId=this.parent.id),R.isUnIndexed=this.isUnIndexed;var L=this._geometry;if(L&&this.subMeshes){var N=L.id;R.geometryId=N,R.subMeshes=[];for(var B=0;B<this.subMeshes.length;B++){var X=this.subMeshes[B];R.subMeshes.push({materialIndex:X.materialIndex,verticesStart:X.verticesStart,verticesCount:X.verticesCount,indexStart:X.indexStart,indexCount:X.indexCount})}}if(this.material?this.material.doNotSerialize||(R.materialId=this.material.id):this.material=null,this.morphTargetManager&&(R.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(R.skeletonId=this.skeleton.id,R.numBoneInfluencers=this.numBoneInfluencers),this.getScene()._getComponent(b.a.NAME_PHYSICSENGINE)){var K=this.getPhysicsImpostor();K&&(R.physicsMass=K.getParam("mass"),R.physicsFriction=K.getParam("friction"),R.physicsRestitution=K.getParam("mass"),R.physicsImpostor=K.type)}this.metadata&&(R.metadata=this.metadata),R.instances=[];for(var G=0;G<this.instances.length;G++){var I=this.instances[G];if(!I.doNotSerialize){var A={name:I.name,id:I.id,isEnabled:I.isEnabled(!1),isVisible:I.isVisible,isPickable:I.isPickable,checkCollisions:I.checkCollisions,position:I.position.asArray(),scaling:I.scaling.asArray()};if(I.parent&&(A.parentId=I.parent.id),I.rotationQuaternion?A.rotationQuaternion=I.rotationQuaternion.asArray():I.rotation&&(A.rotation=I.rotation.asArray()),this.getScene()._getComponent(b.a.NAME_PHYSICSENGINE)){var K=I.getPhysicsImpostor();K&&(A.physicsMass=K.getParam("mass"),A.physicsFriction=K.getParam("friction"),A.physicsRestitution=K.getParam("mass"),A.physicsImpostor=K.type)}I.metadata&&(A.metadata=I.metadata),R.instances.push(A),g.a.AppendSerializedAnimations(I,A),A.ranges=I.serializeAnimationRanges()}}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(R.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:m.b.SliceToArray(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize},this._userThinInstanceBuffersStorage)){var S={data:{},sizes:{},strides:{}};for(var C in this._userThinInstanceBuffersStorage.data)S.data[C]=m.b.SliceToArray(this._userThinInstanceBuffersStorage.data[C]),S.sizes[C]=this._userThinInstanceBuffersStorage.sizes[C],S.strides[C]=this._userThinInstanceBuffersStorage.strides[C];R.thinInstances.userThinInstance=S}g.a.AppendSerializedAnimations(this,R),R.ranges=this.serializeAnimationRanges(),R.layerMask=this.layerMask,R.alphaIndex=this.alphaIndex,R.hasVertexAlpha=this.hasVertexAlpha,R.overlayAlpha=this.overlayAlpha,R.overlayColor=this.overlayColor.asArray(),R.renderOverlay=this.renderOverlay,R.applyFog=this.applyFog,this.actionManager&&(R.actions=this.actionManager.serialize(this.name))},w.prototype._syncGeometryWithMorphTargetManager=function(){if(!!this.geometry){this._markSubMeshesAsAttributesDirty();var R=this._internalMeshDataInfo._morphTargetManager;if(R&&R.vertexCount){if(R.vertexCount!==this.getTotalVertices()){y.a.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),this.morphTargetManager=null;return}if(R.isUsingTextureForTargets)return;for(var L=0;L<R.numInfluencers;L++){var N=R.getActiveTarget(L),B=N.getPositions();if(!B){y.a.Error("Invalid morph target. Target must have positions.");return}this.geometry.setVerticesData(u.b.PositionKind+L,B,!1,3);var X=N.getNormals();X&&this.geometry.setVerticesData(u.b.NormalKind+L,X,!1,3);var K=N.getTangents();K&&this.geometry.setVerticesData(u.b.TangentKind+L,K,!1,3);var G=N.getUVs();G&&this.geometry.setVerticesData(u.b.UVKind+"_"+L,G,!1,2)}}else for(var L=0;this.geometry.isVerticesDataPresent(u.b.PositionKind+L);)this.geometry.removeVerticesData(u.b.PositionKind+L),this.geometry.isVerticesDataPresent(u.b.NormalKind+L)&&this.geometry.removeVerticesData(u.b.NormalKind+L),this.geometry.isVerticesDataPresent(u.b.TangentKind+L)&&this.geometry.removeVerticesData(u.b.TangentKind+L),this.geometry.isVerticesDataPresent(u.b.UVKind+L)&&this.geometry.removeVerticesData(u.b.UVKind+"_"+L),L++}},w.Parse=function(R,L,N){var B;if(R.type&&R.type==="LinesMesh"?B=w._LinesMeshParser(R,L):R.type&&R.type==="GroundMesh"?B=w._GroundMeshParser(R,L):B=new w(R.name,L),B.id=R.id,c.a&&c.a.AddTagsTo(B,R.tags),B.position=a.e.FromArray(R.position),R.metadata!==void 0&&(B.metadata=R.metadata),R.rotationQuaternion?B.rotationQuaternion=a.b.FromArray(R.rotationQuaternion):R.rotation&&(B.rotation=a.e.FromArray(R.rotation)),B.scaling=a.e.FromArray(R.scaling),R.localMatrix?B.setPreTransformMatrix(a.a.FromArray(R.localMatrix)):R.pivotMatrix&&B.setPivotMatrix(a.a.FromArray(R.pivotMatrix)),B.setEnabled(R.isEnabled),B.isVisible=R.isVisible,B.infiniteDistance=R.infiniteDistance,B.showBoundingBox=R.showBoundingBox,B.showSubMeshesBoundingBox=R.showSubMeshesBoundingBox,R.applyFog!==void 0&&(B.applyFog=R.applyFog),R.pickable!==void 0&&(B.isPickable=R.pickable),R.alphaIndex!==void 0&&(B.alphaIndex=R.alphaIndex),B.receiveShadows=R.receiveShadows,B.billboardMode=R.billboardMode,R.visibility!==void 0&&(B.visibility=R.visibility),B.checkCollisions=R.checkCollisions,B.overrideMaterialSideOrientation=R.overrideMaterialSideOrientation,R.isBlocker!==void 0&&(B.isBlocker=R.isBlocker),B._shouldGenerateFlatShading=R.useFlatShading,R.freezeWorldMatrix&&(B._waitingData.freezeWorldMatrix=R.freezeWorldMatrix),R.parentId&&(B._waitingParentId=R.parentId),R.actions!==void 0&&(B._waitingData.actions=R.actions),R.overlayAlpha!==void 0&&(B.overlayAlpha=R.overlayAlpha),R.overlayColor!==void 0&&(B.overlayColor=_.a.FromArray(R.overlayColor)),R.renderOverlay!==void 0&&(B.renderOverlay=R.renderOverlay),B.isUnIndexed=!!R.isUnIndexed,B.hasVertexAlpha=R.hasVertexAlpha,R.delayLoadingFile?(B.delayLoadState=4,B.delayLoadingFile=N+R.delayLoadingFile,B._boundingInfo=new e.a(a.e.FromArray(R.boundingBoxMinimum),a.e.FromArray(R.boundingBoxMaximum)),R._binaryInfo&&(B._binaryInfo=R._binaryInfo),B._delayInfo=[],R.hasUVs&&B._delayInfo.push(u.b.UVKind),R.hasUVs2&&B._delayInfo.push(u.b.UV2Kind),R.hasUVs3&&B._delayInfo.push(u.b.UV3Kind),R.hasUVs4&&B._delayInfo.push(u.b.UV4Kind),R.hasUVs5&&B._delayInfo.push(u.b.UV5Kind),R.hasUVs6&&B._delayInfo.push(u.b.UV6Kind),R.hasColors&&B._delayInfo.push(u.b.ColorKind),R.hasMatricesIndices&&B._delayInfo.push(u.b.MatricesIndicesKind),R.hasMatricesWeights&&B._delayInfo.push(u.b.MatricesWeightsKind),B._delayLoadingFunction=l.a._ImportGeometry,o.a.ForceFullSceneLoadingForIncremental&&B._checkDelayState()):l.a._ImportGeometry(R,B),R.materialId?B.setMaterialByID(R.materialId):B.material=null,R.morphTargetManagerId>-1&&(B.morphTargetManager=L.getMorphTargetManagerById(R.morphTargetManagerId)),R.skeletonId!==void 0&&R.skeletonId!==null&&(B.skeleton=L.getLastSkeletonByID(R.skeletonId),R.numBoneInfluencers&&(B.numBoneInfluencers=R.numBoneInfluencers)),R.animations){for(var X=0;X<R.animations.length;X++){var K=R.animations[X],G=v.a.GetClass("BABYLON.Animation");G&&B.animations.push(G.Parse(K))}s.a.ParseAnimationRanges(B,R,L)}if(R.autoAnimate&&L.beginAnimation(B,R.autoAnimateFrom,R.autoAnimateTo,R.autoAnimateLoop,R.autoAnimateSpeed||1),R.layerMask&&!isNaN(R.layerMask)?B.layerMask=Math.abs(parseInt(R.layerMask)):B.layerMask=268435455,R.physicsImpostor&&w._PhysicsImpostorParser(L,B,R),R.lodMeshIds&&(B._waitingData.lods={ids:R.lodMeshIds,distances:R.lodDistances?R.lodDistances:null,coverages:R.lodCoverages?R.lodCoverages:null}),R.instances)for(var I=0;I<R.instances.length;I++){var A=R.instances[I],S=B.createInstance(A.name);if(A.id&&(S.id=A.id),c.a&&(A.tags?c.a.AddTagsTo(S,A.tags):c.a.AddTagsTo(S,R.tags)),S.position=a.e.FromArray(A.position),A.metadata!==void 0&&(S.metadata=A.metadata),A.parentId&&(S._waitingParentId=A.parentId),A.isEnabled!==void 0&&A.isEnabled!==null&&S.setEnabled(A.isEnabled),A.isVisible!==void 0&&A.isVisible!==null&&(S.isVisible=A.isVisible),A.isPickable!==void 0&&A.isPickable!==null&&(S.isPickable=A.isPickable),A.rotationQuaternion?S.rotationQuaternion=a.b.FromArray(A.rotationQuaternion):A.rotation&&(S.rotation=a.e.FromArray(A.rotation)),S.scaling=a.e.FromArray(A.scaling),A.checkCollisions!=null&&A.checkCollisions!=null&&(S.checkCollisions=A.checkCollisions),A.pickable!=null&&A.pickable!=null&&(S.isPickable=A.pickable),A.showBoundingBox!=null&&A.showBoundingBox!=null&&(S.showBoundingBox=A.showBoundingBox),A.showSubMeshesBoundingBox!=null&&A.showSubMeshesBoundingBox!=null&&(S.showSubMeshesBoundingBox=A.showSubMeshesBoundingBox),A.alphaIndex!=null&&A.showSubMeshesBoundingBox!=null&&(S.alphaIndex=A.alphaIndex),A.physicsImpostor&&w._PhysicsImpostorParser(L,S,A),A.animations){for(X=0;X<A.animations.length;X++){K=A.animations[X];var G=v.a.GetClass("BABYLON.Animation");G&&S.animations.push(G.Parse(K))}s.a.ParseAnimationRanges(S,A,L),A.autoAnimate&&L.beginAnimation(S,A.autoAnimateFrom,A.autoAnimateTo,A.autoAnimateLoop,A.autoAnimateSpeed||1)}}if(R.thinInstances){var C=R.thinInstances;if(C.matrixData?(B.thinInstanceSetBuffer("matrix",new Float32Array(C.matrixData),16,!1),B._thinInstanceDataStorage.matrixBufferSize=C.matrixBufferSize,B._thinInstanceDataStorage.instancesCount=C.instancesCount):B._thinInstanceDataStorage.matrixBufferSize=C.matrixBufferSize,R.thinInstances.userThinInstance){var U=R.thinInstances.userThinInstance;for(var k in U.data)B.thinInstanceSetBuffer(k,new Float32Array(U.data[k]),U.strides[k],!1),B._userThinInstanceBuffersStorage.sizes[k]=U.sizes[k]}}return B},w.CreateRibbon=function(R,L,N,B,X,K,G,I,A){throw f.a.WarnImport("MeshBuilder")},w.CreateDisc=function(R,L,N,B,X,K){throw B===void 0&&(B=null),f.a.WarnImport("MeshBuilder")},w.CreateBox=function(R,L,N,B,X){throw N===void 0&&(N=null),f.a.WarnImport("MeshBuilder")},w.CreateSphere=function(R,L,N,B,X,K){throw f.a.WarnImport("MeshBuilder")},w.CreateHemisphere=function(R,L,N,B){throw f.a.WarnImport("MeshBuilder")},w.CreateCylinder=function(R,L,N,B,X,K,G,I,A){throw f.a.WarnImport("MeshBuilder")},w.CreateTorus=function(R,L,N,B,X,K,G){throw f.a.WarnImport("MeshBuilder")},w.CreateTorusKnot=function(R,L,N,B,X,K,G,I,A,S){throw f.a.WarnImport("MeshBuilder")},w.CreateLines=function(R,L,N,B,X){throw N===void 0&&(N=null),B===void 0&&(B=!1),X===void 0&&(X=null),f.a.WarnImport("MeshBuilder")},w.CreateDashedLines=function(R,L,N,B,X,K,G,I){throw K===void 0&&(K=null),f.a.WarnImport("MeshBuilder")},w.CreatePolygon=function(R,L,N,B,X,K,G){throw G===void 0&&(G=earcut),f.a.WarnImport("MeshBuilder")},w.ExtrudePolygon=function(R,L,N,B,X,K,G,I){throw I===void 0&&(I=earcut),f.a.WarnImport("MeshBuilder")},w.ExtrudeShape=function(R,L,N,B,X,K,G,I,A,S){throw G===void 0&&(G=null),f.a.WarnImport("MeshBuilder")},w.ExtrudeShapeCustom=function(R,L,N,B,X,K,G,I,A,S,C,U){throw f.a.WarnImport("MeshBuilder")},w.CreateLathe=function(R,L,N,B,X,K,G){throw f.a.WarnImport("MeshBuilder")},w.CreatePlane=function(R,L,N,B,X){throw f.a.WarnImport("MeshBuilder")},w.CreateGround=function(R,L,N,B,X,K){throw f.a.WarnImport("MeshBuilder")},w.CreateTiledGround=function(R,L,N,B,X,K,G,I,A){throw f.a.WarnImport("MeshBuilder")},w.CreateGroundFromHeightMap=function(R,L,N,B,X,K,G,I,A,S,C){throw f.a.WarnImport("MeshBuilder")},w.CreateTube=function(R,L,N,B,X,K,G,I,A,S){throw f.a.WarnImport("MeshBuilder")},w.CreatePolyhedron=function(R,L,N){throw f.a.WarnImport("MeshBuilder")},w.CreateIcoSphere=function(R,L,N){throw f.a.WarnImport("MeshBuilder")},w.CreateDecal=function(R,L,N,B,X,K){throw f.a.WarnImport("MeshBuilder")},w.CreateCapsule=function(R,L,N){throw f.a.WarnImport("MeshBuilder")},w.prototype.setPositionsForCPUSkinning=function(){var R=this._internalMeshDataInfo;if(!R._sourcePositions){var L=this.getVerticesData(u.b.PositionKind);if(!L)return R._sourcePositions;R._sourcePositions=new Float32Array(L),this.isVertexBufferUpdatable(u.b.PositionKind)||this.setVerticesData(u.b.PositionKind,L,!0)}return R._sourcePositions},w.prototype.setNormalsForCPUSkinning=function(){var R=this._internalMeshDataInfo;if(!R._sourceNormals){var L=this.getVerticesData(u.b.NormalKind);if(!L)return R._sourceNormals;R._sourceNormals=new Float32Array(L),this.isVertexBufferUpdatable(u.b.NormalKind)||this.setVerticesData(u.b.NormalKind,L,!0)}return R._sourceNormals},w.prototype.applySkeleton=function(R){if(!this.geometry)return this;if(this.geometry._softwareSkinningFrameId==this.getScene().getFrameId())return this;if(this.geometry._softwareSkinningFrameId=this.getScene().getFrameId(),!this.isVerticesDataPresent(u.b.PositionKind))return this;if(!this.isVerticesDataPresent(u.b.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(u.b.MatricesWeightsKind))return this;var L=this.isVerticesDataPresent(u.b.NormalKind),N=this._internalMeshDataInfo;if(!N._sourcePositions){var B=this.subMeshes.slice();this.setPositionsForCPUSkinning(),this.subMeshes=B}L&&!N._sourceNormals&&this.setNormalsForCPUSkinning();var X=this.getVerticesData(u.b.PositionKind);if(!X)return this;X instanceof Float32Array||(X=new Float32Array(X));var K=this.getVerticesData(u.b.NormalKind);if(L){if(!K)return this;K instanceof Float32Array||(K=new Float32Array(K))}var G=this.getVerticesData(u.b.MatricesIndicesKind),I=this.getVerticesData(u.b.MatricesWeightsKind);if(!I||!G)return this;for(var A=this.numBoneInfluencers>4,S=A?this.getVerticesData(u.b.MatricesIndicesExtraKind):null,C=A?this.getVerticesData(u.b.MatricesWeightsExtraKind):null,U=R.getTransformMatrices(this),k=a.e.Zero(),J=new a.a,Y=new a.a,Z=0,Q,te=0;te<X.length;te+=3,Z+=4){var re;for(Q=0;Q<4;Q++)re=I[Z+Q],re>0&&(a.a.FromFloat32ArrayToRefScaled(U,Math.floor(G[Z+Q]*16),re,Y),J.addToSelf(Y));if(A)for(Q=0;Q<4;Q++)re=C[Z+Q],re>0&&(a.a.FromFloat32ArrayToRefScaled(U,Math.floor(S[Z+Q]*16),re,Y),J.addToSelf(Y));a.e.TransformCoordinatesFromFloatsToRef(N._sourcePositions[te],N._sourcePositions[te+1],N._sourcePositions[te+2],J,k),k.toArray(X,te),L&&(a.e.TransformNormalFromFloatsToRef(N._sourceNormals[te],N._sourceNormals[te+1],N._sourceNormals[te+2],J,k),k.toArray(K,te)),J.reset()}return this.updateVerticesData(u.b.PositionKind,X),L&&this.updateVerticesData(u.b.NormalKind,K),this},w.MinMax=function(R){var L=null,N=null;return R.forEach(function(B){var X=B.getBoundingInfo(),K=X.boundingBox;!L||!N?(L=K.minimumWorld,N=K.maximumWorld):(L.minimizeInPlace(K.minimumWorld),N.maximizeInPlace(K.maximumWorld))}),!L||!N?{min:a.e.Zero(),max:a.e.Zero()}:{min:L,max:N}},w.Center=function(R){var L=R instanceof Array?w.MinMax(R):R;return a.e.Center(L.min,L.max)},w.MergeMeshes=function(R,L,N,B,X,K){L===void 0&&(L=!0);var G;if(!N){var I=0;for(G=0;G<R.length;G++)if(R[G]&&(I+=R[G].getTotalVertices(),I>=65536))return y.a.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}if(K){var A=null,S,C;X=!1}var U=new Array,k=new Array,J=null,Y,Z=new Array,Q=null;for(G=0;G<R.length;G++)if(R[G]){var te=R[G];if(te.isAnInstance)return y.a.Warn("Cannot merge instance meshes."),null;var re=te.computeWorldMatrix(!0);if(Y=p.a.ExtractFromMesh(te,!0,!0),Y.transform(re),J?J.merge(Y,N):(J=Y,Q=te),X&&Z.push(te.getTotalIndices()),K)if(te.material){var ae=te.material;if(ae instanceof r.a){for(C=0;C<ae.subMaterials.length;C++)U.indexOf(ae.subMaterials[C])<0&&U.push(ae.subMaterials[C]);for(S=0;S<te.subMeshes.length;S++)k.push(U.indexOf(ae.subMaterials[te.subMeshes[S].materialIndex])),Z.push(te.subMeshes[S].indexCount)}else for(U.indexOf(ae)<0&&U.push(ae),S=0;S<te.subMeshes.length;S++)k.push(U.indexOf(ae)),Z.push(te.subMeshes[S].indexCount)}else for(S=0;S<te.subMeshes.length;S++)k.push(0),Z.push(te.subMeshes[S].indexCount)}if(Q=Q,B||(B=new w(Q.name+"_merged",Q.getScene())),J.applyToMesh(B),B.checkCollisions=Q.checkCollisions,B.overrideMaterialSideOrientation=Q.overrideMaterialSideOrientation,L)for(G=0;G<R.length;G++)R[G]&&R[G].dispose();if(X||K){B.releaseSubMeshes(),G=0;for(var ne=0;G<Z.length;)t.a.CreateFromIndices(0,ne,Z[G],B),ne+=Z[G],G++}if(K){for(A=new r.a(Q.name+"_merged",Q.getScene()),A.subMaterials=U,S=0;S<B.subMeshes.length;S++)B.subMeshes[S].materialIndex=k[S];B.material=A}else B.material=Q.material;return B},w.prototype.addInstance=function(R){R._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(R)},w.prototype.removeInstance=function(R){var L=R._indexInSourceMeshInstanceArray;if(L!=-1){if(L!==this.instances.length-1){var N=this.instances[this.instances.length-1];this.instances[L]=N,N._indexInSourceMeshInstanceArray=L}R._indexInSourceMeshInstanceArray=-1,this.instances.pop()}},w.FRONTSIDE=p.a.FRONTSIDE,w.BACKSIDE=p.a.BACKSIDE,w.DOUBLESIDE=p.a.DOUBLESIDE,w.DEFAULTSIDE=p.a.DEFAULTSIDE,w.NO_CAP=0,w.CAP_START=1,w.CAP_END=2,w.CAP_ALL=3,w.NO_FLIP=0,w.FLIP_TILE=1,w.ROTATE_TILE=2,w.FLIP_ROW=3,w.ROTATE_ROW=4,w.FLIP_N_ROTATE_TILE=5,w.FLIP_N_ROTATE_ROW=6,w.CENTER=0,w.LEFT=1,w.RIGHT=2,w.TOP=3,w.BOTTOM=4,w._GroundMeshParser=function(R,L){throw f.a.WarnImport("GroundMesh")},w._LinesMeshParser=function(R,L){throw f.a.WarnImport("LinesMesh")},w}(h.a);v.a.RegisteredTypes["BABYLON.Mesh"]=V},function($,W,M){"use strict";M.d(W,"a",function(){return d}),M.d(W,"b",function(){return m});var P=M(789),d=function(){function n(c,a,_,s,u,p,l,h){s===void 0&&(s=0),u===void 0&&(u=!1),p===void 0&&(p=!1),l===void 0&&(l=!1),this._isAlreadyOwned=!1,c.getScene?this._engine=c.getScene().getEngine():this._engine=c,this._updatable=_,this._instanced=p,this._divisor=h||1,this._data=a,this.byteStride=l?s:s*Float32Array.BYTES_PER_ELEMENT,u||this.create()}return n.prototype.createVertexBuffer=function(c,a,_,s,u,p,l){p===void 0&&(p=!1);var h=p?a:a*Float32Array.BYTES_PER_ELEMENT,t=s?p?s:s*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new m(this._engine,this,c,this._updatable,!0,t,u===void 0?this._instanced:u,h,_,void 0,void 0,!0,this._divisor||l)},n.prototype.isUpdatable=function(){return this._updatable},n.prototype.getData=function(){return this._data},n.prototype.getBuffer=function(){return this._buffer},n.prototype.getStrideSize=function(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT},n.prototype.create=function(c){c===void 0&&(c=null),!(!c&&this._buffer)&&(c=c||this._data,!!c&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,c),this._data=c):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(c),this._data=c):this._buffer=this._engine.createVertexBuffer(c)))},n.prototype._rebuild=function(){this._buffer=null,this.create(this._data)},n.prototype.update=function(c){this.create(c)},n.prototype.updateDirectly=function(c,a,_,s){s===void 0&&(s=!1),!!this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,c,s?a:a*Float32Array.BYTES_PER_ELEMENT,_?_*this.byteStride:void 0),this._data=null)},n.prototype._increaseReferences=function(){if(!!this._buffer){if(!this._isAlreadyOwned){this._isAlreadyOwned=!0;return}this._buffer.references++}},n.prototype.dispose=function(){!this._buffer||this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)},n}(),m=function(){function n(c,a,_,s,u,p,l,h,t,e,i,r,o,g){if(i===void 0&&(i=!1),r===void 0&&(r=!1),o===void 0&&(o=1),g===void 0&&(g=!1),a instanceof d?(this._buffer=a,this._ownsBuffer=g,g&&this._buffer._increaseReferences()):(this._buffer=new d(c,a,s,p,u,l,r),this._ownsBuffer=!0),this.uniqueId=n._Counter++,this._kind=_,e==null){var y=this.getData();this.type=n.FLOAT,y instanceof Int8Array?this.type=n.BYTE:y instanceof Uint8Array?this.type=n.UNSIGNED_BYTE:y instanceof Int16Array?this.type=n.SHORT:y instanceof Uint16Array?this.type=n.UNSIGNED_SHORT:y instanceof Int32Array?this.type=n.INT:y instanceof Uint32Array&&(this.type=n.UNSIGNED_INT)}else this.type=e;var v=n.GetTypeByteLength(this.type);r?(this._size=t||(p?p/v:n.DeduceStride(_)),this.byteStride=p||this._buffer.byteStride||this._size*v,this.byteOffset=h||0):(this._size=t||p||n.DeduceStride(_),this.byteStride=p?p*v:this._buffer.byteStride||this._size*v,this.byteOffset=(h||0)*v),this.normalized=i,this._instanced=l!==void 0?l:!1,this._instanceDivisor=l?o:0,this._computeHashCode()}return Object.defineProperty(n.prototype,"instanceDivisor",{get:function(){return this._instanceDivisor},set:function(c){this._instanceDivisor=c,c==0?this._instanced=!1:this._instanced=!0,this._computeHashCode()},enumerable:!1,configurable:!0}),n.prototype._computeHashCode=function(){this.hashCode=(this.type-5120<<0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)},n.prototype._rebuild=function(){!this._buffer||this._buffer._rebuild()},n.prototype.getKind=function(){return this._kind},n.prototype.isUpdatable=function(){return this._buffer.isUpdatable()},n.prototype.getData=function(){return this._buffer.getData()},n.prototype.getFloatData=function(c,a){var _=this.getData();if(!_)return null;var s=this.getSize()*n.GetTypeByteLength(this.type),u=c*this.getSize();if(this.type!==n.FLOAT||this.byteStride!==s){var p=[];return this.forEach(u,function(i){return p.push(i)}),p}if(!(_ instanceof Array||_ instanceof Float32Array)||this.byteOffset!==0||_.length!==u)if(_ instanceof Array){var l=this.byteOffset/4;return P.a.Slice(_,l,l+u)}else{if(_ instanceof ArrayBuffer)return new Float32Array(_,this.byteOffset,u);var l=_.byteOffset+this.byteOffset;if(a){var h=new Float32Array(u),t=new Float32Array(_.buffer,l,u);return h.set(t),h}var e=l%4;return e&&(l=Math.max(0,l-e)),new Float32Array(_.buffer,l,u)}return a?P.a.Slice(_):_},n.prototype.getBuffer=function(){return this._buffer.getBuffer()},n.prototype.getStrideSize=function(){return this.byteStride/n.GetTypeByteLength(this.type)},n.prototype.getOffset=function(){return this.byteOffset/n.GetTypeByteLength(this.type)},n.prototype.getSize=function(){return this._size},n.prototype.getIsInstanced=function(){return this._instanced},n.prototype.getInstanceDivisor=function(){return this._instanceDivisor},n.prototype.create=function(c){this._buffer.create(c)},n.prototype.update=function(c){this._buffer.update(c)},n.prototype.updateDirectly=function(c,a,_){_===void 0&&(_=!1),this._buffer.updateDirectly(c,a,void 0,_)},n.prototype.dispose=function(){this._ownsBuffer&&this._buffer.dispose()},n.prototype.forEach=function(c,a){n.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,c,this.normalized,a)},n.DeduceStride=function(c){switch(c){case n.UVKind:case n.UV2Kind:case n.UV3Kind:case n.UV4Kind:case n.UV5Kind:case n.UV6Kind:return 2;case n.NormalKind:case n.PositionKind:return 3;case n.ColorKind:case n.MatricesIndicesKind:case n.MatricesIndicesExtraKind:case n.MatricesWeightsKind:case n.MatricesWeightsExtraKind:case n.TangentKind:return 4;default:throw new Error("Invalid kind '"+c+"'")}},n.GetTypeByteLength=function(c){switch(c){case n.BYTE:case n.UNSIGNED_BYTE:return 1;case n.SHORT:case n.UNSIGNED_SHORT:return 2;case n.INT:case n.UNSIGNED_INT:case n.FLOAT:return 4;default:throw new Error("Invalid type '"+c+"'")}},n.ForEach=function(c,a,_,s,u,p,l,h){if(c instanceof Array)for(var t=a/4,e=_/4,i=0;i<p;i+=s){for(var r=0;r<s;r++)h(c[t+r],i+r);t+=e}else for(var o=c instanceof ArrayBuffer?new DataView(c):new DataView(c.buffer,c.byteOffset,c.byteLength),g=n.GetTypeByteLength(u),i=0;i<p;i+=s){for(var y=a,r=0;r<s;r++){var v=n._GetFloatValue(o,u,y,l);h(v,i+r),y+=g}a+=_}},n._GetFloatValue=function(c,a,_,s){switch(a){case n.BYTE:{var u=c.getInt8(_);return s&&(u=Math.max(u/127,-1)),u}case n.UNSIGNED_BYTE:{var u=c.getUint8(_);return s&&(u=u/255),u}case n.SHORT:{var u=c.getInt16(_,!0);return s&&(u=Math.max(u/32767,-1)),u}case n.UNSIGNED_SHORT:{var u=c.getUint16(_,!0);return s&&(u=u/65535),u}case n.INT:return c.getInt32(_,!0);case n.UNSIGNED_INT:return c.getUint32(_,!0);case n.FLOAT:return c.getFloat32(_,!0);default:throw new Error("Invalid component type "+a)}},n._Counter=0,n.BYTE=5120,n.UNSIGNED_BYTE=5121,n.SHORT=5122,n.UNSIGNED_SHORT=5123,n.INT=5124,n.UNSIGNED_INT=5125,n.FLOAT=5126,n.PositionKind="position",n.NormalKind="normal",n.TangentKind="tangent",n.UVKind="uv",n.UV2Kind="uv2",n.UV3Kind="uv3",n.UV4Kind="uv4",n.UV5Kind="uv5",n.UV6Kind="uv6",n.ColorKind="color",n.MatricesIndicesKind="matricesIndices",n.MatricesWeightsKind="matricesWeights",n.MatricesIndicesExtraKind="matricesIndicesExtra",n.MatricesWeightsExtraKind="matricesWeightsExtra",n}()},function($,W,M){"use strict";M.d(W,"a",function(){return P});var P=function(){function d(){}return Object.defineProperty(d,"LastCreatedEngine",{get:function(){return this.Instances.length===0?null:this.Instances[this.Instances.length-1]},enumerable:!1,configurable:!0}),Object.defineProperty(d,"LastCreatedScene",{get:function(){return this._LastCreatedScene},enumerable:!1,configurable:!0}),d.Instances=new Array,d._LastCreatedScene=null,d.UseFallbackTexture=!0,d.FallbackTexture="",d}()},function($,W,M){"use strict";M.d(W,"a",function(){return K});var P=M(434),d=M(443),m=M(589),n=M(438),c=M(490),a=M(684),_=M(663),s=M(436),u=M(499),p=M(462),l=M(451),h=M(468),t=M(491),e=M(557),i=M(484),r=M(539),o=M(671),g=M(590),y=M(591),v=M(452),f=M(660),b=M(440),T=M(448),E=M(476),O=M(464),D=M(669),F=M(562),x=M(673),j=M(688),V=M(689),z=function(){function G(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}return Object.defineProperty(G.prototype,"singleClick",{get:function(){return this._singleClick},set:function(I){this._singleClick=I},enumerable:!1,configurable:!0}),Object.defineProperty(G.prototype,"doubleClick",{get:function(){return this._doubleClick},set:function(I){this._doubleClick=I},enumerable:!1,configurable:!0}),Object.defineProperty(G.prototype,"hasSwiped",{get:function(){return this._hasSwiped},set:function(I){this._hasSwiped=I},enumerable:!1,configurable:!0}),Object.defineProperty(G.prototype,"ignore",{get:function(){return this._ignore},set:function(I){this._ignore=I},enumerable:!1,configurable:!0}),G}(),w=function(){function G(I){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._totalPointersPressed=0,this._doubleClickOccured=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new s.d(0,0),this._previousStartingPointerPosition=new s.d(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId=[],this._scene=I}return Object.defineProperty(G.prototype,"meshUnderPointer",{get:function(){return this._pointerOverMesh},enumerable:!1,configurable:!0}),G.prototype.getMeshUnderPointerByPointerId=function(I){return this._meshUnderPointerId[I]},Object.defineProperty(G.prototype,"unTranslatedPointer",{get:function(){return new s.d(this._unTranslatedPointerX,this._unTranslatedPointerY)},enumerable:!1,configurable:!0}),Object.defineProperty(G.prototype,"pointerX",{get:function(){return this._pointerX},set:function(I){this._pointerX=I},enumerable:!1,configurable:!0}),Object.defineProperty(G.prototype,"pointerY",{get:function(){return this._pointerY},set:function(I){this._pointerY=I},enumerable:!1,configurable:!0}),G.prototype._updatePointerPosition=function(I){var A=this._scene.getEngine().getInputElementClientRect();!A||(this._pointerX=I.clientX-A.left,this._pointerY=I.clientY-A.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)},G.prototype._processPointerMove=function(I,A){var S=this._scene,C=S.getEngine(),U=C.getInputElement();if(!!U){U.tabIndex=C.canvasTabIndex,S.doNotHandleCursors||(U.style.cursor=S.defaultCursor);var k=!!(I&&I.hit&&I.pickedMesh);k?(S.setPointerOverMesh(I.pickedMesh,A.pointerId),this._pointerOverMesh&&this._pointerOverMesh.actionManager&&this._pointerOverMesh.actionManager.hasPointerTriggers&&(S.doNotHandleCursors||(this._pointerOverMesh.actionManager.hoverCursor?U.style.cursor=this._pointerOverMesh.actionManager.hoverCursor:U.style.cursor=S.hoverCursor))):S.setPointerOverMesh(null,A.pointerId);for(var J=0,Y=S._pointerMoveStage;J<Y.length;J++){var Z=Y[J];I=Z.action(this._unTranslatedPointerX,this._unTranslatedPointerY,I,k,U)}if(I){var Q=A.type==="wheel"?O.a.POINTERWHEEL:O.a.POINTERMOVE;if(S.onPointerMove&&S.onPointerMove(A,I,Q),S.onPointerObservable.hasObservers()){var te=new O.b(Q,A,I);this._setRayOnPointerInfo(te),S.onPointerObservable.notifyObservers(te,Q)}}}},G.prototype._setRayOnPointerInfo=function(I){var A=this._scene;I.pickInfo&&!I.pickInfo._pickingUnavailable&&(I.pickInfo.ray||(I.pickInfo.ray=A.createPickingRay(I.event.offsetX,I.event.offsetY,s.a.Identity(),A.activeCamera)))},G.prototype._checkPrePointerObservable=function(I,A,S){var C=this._scene,U=new O.d(S,A,this._unTranslatedPointerX,this._unTranslatedPointerY);return I&&(U.ray=I.ray),C.onPrePointerObservable.notifyObservers(U,S),!!U.skipOnPointerObservable},G.prototype.simulatePointerMove=function(I,A){var S=new PointerEvent("pointermove",A);this._checkPrePointerObservable(I,S,O.a.POINTERMOVE)||this._processPointerMove(I,S)},G.prototype.simulatePointerDown=function(I,A){var S=new PointerEvent("pointerdown",A);this._checkPrePointerObservable(I,S,O.a.POINTERDOWN)||this._processPointerDown(I,S)},G.prototype._processPointerDown=function(I,A){var S=this,C=this._scene;if(I&&I.hit&&I.pickedMesh){this._pickedDownMesh=I.pickedMesh;var U=I.pickedMesh._getActionManagerForTrigger();if(U){if(U.hasPickTriggers)switch(U.processTrigger(5,o.a.CreateNew(I.pickedMesh,A)),A.button){case 0:U.processTrigger(2,o.a.CreateNew(I.pickedMesh,A));break;case 1:U.processTrigger(4,o.a.CreateNew(I.pickedMesh,A));break;case 2:U.processTrigger(3,o.a.CreateNew(I.pickedMesh,A));break}U.hasSpecificTrigger(8)&&window.setTimeout(function(){var te=C.pick(S._unTranslatedPointerX,S._unTranslatedPointerY,function(re){return re.isPickable&&re.isVisible&&re.isReady()&&re.actionManager&&re.actionManager.hasSpecificTrigger(8)&&re===S._pickedDownMesh},!1,C.cameraToUseForPointers);te&&te.hit&&te.pickedMesh&&U&&S._totalPointersPressed!==0&&Date.now()-S._startingPointerTime>G.LongPressDelay&&!S._isPointerSwiping()&&(S._startingPointerTime=0,U.processTrigger(8,o.a.CreateNew(te.pickedMesh,A)))},G.LongPressDelay)}}else for(var k=0,J=C._pointerDownStage;k<J.length;k++){var Y=J[k];I=Y.action(this._unTranslatedPointerX,this._unTranslatedPointerY,I,A)}if(I){var Z=O.a.POINTERDOWN;if(C.onPointerDown&&C.onPointerDown(A,I,Z),C.onPointerObservable.hasObservers()){var Q=new O.b(Z,A,I);this._setRayOnPointerInfo(Q),C.onPointerObservable.notifyObservers(Q,Z)}}},G.prototype._isPointerSwiping=function(){return Math.abs(this._startingPointerPosition.x-this._pointerX)>G.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>G.DragMovementThreshold},G.prototype.simulatePointerUp=function(I,A,S){var C=new PointerEvent("pointerup",A),U=new z;S?U.doubleClick=!0:U.singleClick=!0,!this._checkPrePointerObservable(I,C,O.a.POINTERUP)&&this._processPointerUp(I,C,U)},G.prototype._processPointerUp=function(I,A,S){var C=this._scene;if(I&&I&&I.pickedMesh){if(this._pickedUpMesh=I.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(C.onPointerPick&&C.onPointerPick(A,I),S.singleClick&&!S.ignore&&C.onPointerObservable.hasObservers())){var U=O.a.POINTERPICK,k=new O.b(U,A,I);this._setRayOnPointerInfo(k),C.onPointerObservable.notifyObservers(k,U)}var J=I.pickedMesh._getActionManagerForTrigger();if(J&&!S.ignore){J.processTrigger(7,o.a.CreateNew(I.pickedMesh,A,I)),!S.hasSwiped&&S.singleClick&&J.processTrigger(1,o.a.CreateNew(I.pickedMesh,A,I));var Y=I.pickedMesh._getActionManagerForTrigger(6);S.doubleClick&&Y&&Y.processTrigger(6,o.a.CreateNew(I.pickedMesh,A,I))}}else if(!S.ignore)for(var Z=0,Q=C._pointerUpStage;Z<Q.length;Z++){var te=Q[Z];I=te.action(this._unTranslatedPointerX,this._unTranslatedPointerY,I,A)}if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){var re=this._pickedDownMesh._getActionManagerForTrigger(16);re&&re.processTrigger(16,o.a.CreateNew(this._pickedDownMesh,A))}var ae=0;if(C.onPointerObservable.hasObservers()){if(!S.ignore&&!S.hasSwiped&&(S.singleClick&&C.onPointerObservable.hasSpecificMask(O.a.POINTERTAP)?ae=O.a.POINTERTAP:S.doubleClick&&C.onPointerObservable.hasSpecificMask(O.a.POINTERDOUBLETAP)&&(ae=O.a.POINTERDOUBLETAP),ae)){var k=new O.b(ae,A,I);this._setRayOnPointerInfo(k),C.onPointerObservable.notifyObservers(k,ae)}if(!S.ignore){ae=O.a.POINTERUP;var k=new O.b(ae,A,I);this._setRayOnPointerInfo(k),C.onPointerObservable.notifyObservers(k,ae)}}C.onPointerUp&&!S.ignore&&C.onPointerUp(A,I,ae)},G.prototype.isPointerCaptured=function(I){return I===void 0&&(I=0),this._pointerCaptures[I]},G.prototype.attachControl=function(I,A,S,C){var U=this;I===void 0&&(I=!0),A===void 0&&(A=!0),S===void 0&&(S=!0),C===void 0&&(C=null);var k=this._scene;if(C||(C=k.getEngine().getInputElement()),!!C){this._alreadyAttached&&this.detachControl(),this._alreadyAttachedTo=C;var J=k.getEngine();this._deviceInputSystem=V.a.Create(J),this._initActionManager=function(Y,Z){if(!U._meshPickProceed){var Q=k.pick(U._unTranslatedPointerX,U._unTranslatedPointerY,k.pointerDownPredicate,!1,k.cameraToUseForPointers);U._currentPickResult=Q,Q&&(Y=Q.hit&&Q.pickedMesh?Q.pickedMesh._getActionManagerForTrigger():null),U._meshPickProceed=!0}return Y},this._delayedSimpleClick=function(Y,Z,Q){(Date.now()-U._previousStartingPointerTime>G.DoubleClickDelay&&!U._doubleClickOccured||Y!==U._previousButtonPressed)&&(U._doubleClickOccured=!1,Z.singleClick=!0,Z.ignore=!1,Q(Z,U._currentPickResult))},this._initClickEvent=function(Y,Z,Q,te){var re=new z;U._currentPickResult=null;var ae=null,ne=Y.hasSpecificMask(O.a.POINTERPICK)||Z.hasSpecificMask(O.a.POINTERPICK)||Y.hasSpecificMask(O.a.POINTERTAP)||Z.hasSpecificMask(O.a.POINTERTAP)||Y.hasSpecificMask(O.a.POINTERDOUBLETAP)||Z.hasSpecificMask(O.a.POINTERDOUBLETAP);!ne&&D.a&&(ae=U._initActionManager(ae,re),ae&&(ne=ae.hasPickTriggers));var ie=!1;if(ne){var fe=Q.button;if(re.hasSwiped=U._isPointerSwiping(),!re.hasSwiped){var he=!G.ExclusiveDoubleClickMode;he||(he=!Y.hasSpecificMask(O.a.POINTERDOUBLETAP)&&!Z.hasSpecificMask(O.a.POINTERDOUBLETAP),he&&!D.a.HasSpecificTrigger(6)&&(ae=U._initActionManager(ae,re),ae&&(he=!ae.hasSpecificTrigger(6)))),he?(Date.now()-U._previousStartingPointerTime>G.DoubleClickDelay||fe!==U._previousButtonPressed)&&(re.singleClick=!0,te(re,U._currentPickResult),ie=!0):(U._previousDelayedSimpleClickTimeout=U._delayedSimpleClickTimeout,U._delayedSimpleClickTimeout=window.setTimeout(U._delayedSimpleClick.bind(U,fe,re,te),G.DoubleClickDelay));var pe=Y.hasSpecificMask(O.a.POINTERDOUBLETAP)||Z.hasSpecificMask(O.a.POINTERDOUBLETAP);!pe&&D.a.HasSpecificTrigger(6)&&(ae=U._initActionManager(ae,re),ae&&(pe=ae.hasSpecificTrigger(6))),pe&&(fe===U._previousButtonPressed&&Date.now()-U._previousStartingPointerTime<G.DoubleClickDelay&&!U._doubleClickOccured?(!re.hasSwiped&&!U._isPointerSwiping()?(U._previousStartingPointerTime=0,U._doubleClickOccured=!0,re.doubleClick=!0,re.ignore=!1,G.ExclusiveDoubleClickMode&&U._previousDelayedSimpleClickTimeout&&clearTimeout(U._previousDelayedSimpleClickTimeout),U._previousDelayedSimpleClickTimeout=U._delayedSimpleClickTimeout,te(re,U._currentPickResult)):(U._doubleClickOccured=!1,U._previousStartingPointerTime=U._startingPointerTime,U._previousStartingPointerPosition.x=U._startingPointerPosition.x,U._previousStartingPointerPosition.y=U._startingPointerPosition.y,U._previousButtonPressed=fe,G.ExclusiveDoubleClickMode?(U._previousDelayedSimpleClickTimeout&&clearTimeout(U._previousDelayedSimpleClickTimeout),U._previousDelayedSimpleClickTimeout=U._delayedSimpleClickTimeout,te(re,U._previousPickResult)):te(re,U._currentPickResult)),ie=!0):(U._doubleClickOccured=!1,U._previousStartingPointerTime=U._startingPointerTime,U._previousStartingPointerPosition.x=U._startingPointerPosition.x,U._previousStartingPointerPosition.y=U._startingPointerPosition.y,U._previousButtonPressed=fe))}}ie||te(re,U._currentPickResult)},this._onPointerMove=function(Y){if(Y.pointerId===void 0&&(Y.pointerId=0),U._updatePointerPosition(Y),!U._checkPrePointerObservable(null,Y,Y.type==="wheel"?O.a.POINTERWHEEL:O.a.POINTERMOVE)&&!(!k.cameraToUseForPointers&&!k.activeCamera)){k.pointerMovePredicate||(k.pointerMovePredicate=function(Q){return Q.isPickable&&Q.isVisible&&Q.isReady()&&Q.isEnabled()&&(Q.enablePointerMoveEvents||k.constantlyUpdateMeshUnderPointer||Q._getActionManagerForTrigger()!==null)&&(!k.cameraToUseForPointers||(k.cameraToUseForPointers.layerMask&Q.layerMask)!=0)});var Z=k.pick(U._unTranslatedPointerX,U._unTranslatedPointerY,k.pointerMovePredicate,!1,k.cameraToUseForPointers);U._processPointerMove(Z,Y)}},this._onPointerDown=function(Y){if(U._totalPointersPressed++,U._pickedDownMesh=null,U._meshPickProceed=!1,Y.pointerId===void 0&&(Y.pointerId=0),U._updatePointerPosition(Y),k.preventDefaultOnPointerDown&&C&&C.focus(),U._startingPointerPosition.x=U._pointerX,U._startingPointerPosition.y=U._pointerY,U._startingPointerTime=Date.now(),!U._checkPrePointerObservable(null,Y,O.a.POINTERDOWN)&&!(!k.cameraToUseForPointers&&!k.activeCamera)){U._pointerCaptures[Y.pointerId]=!0,k.pointerDownPredicate||(k.pointerDownPredicate=function(Q){return Q.isPickable&&Q.isVisible&&Q.isReady()&&Q.isEnabled()&&(!k.cameraToUseForPointers||(k.cameraToUseForPointers.layerMask&Q.layerMask)!=0)}),U._pickedDownMesh=null;var Z=k.pick(U._unTranslatedPointerX,U._unTranslatedPointerY,k.pointerDownPredicate,!1,k.cameraToUseForPointers);U._processPointerDown(Z,Y)}},this._onPointerUp=function(Y){U._totalPointersPressed!==0&&(U._totalPointersPressed--,U._pickedUpMesh=null,U._meshPickProceed=!1,Y.pointerId===void 0&&(Y.pointerId=0),U._updatePointerPosition(Y),k.preventDefaultOnPointerUp&&C&&C.focus(),U._initClickEvent(k.onPrePointerObservable,k.onPointerObservable,Y,function(Z,Q){k.onPrePointerObservable.hasObservers()&&!Z.ignore&&(!Z.hasSwiped&&(Z.singleClick&&k.onPrePointerObservable.hasSpecificMask(O.a.POINTERTAP)&&U._checkPrePointerObservable(null,Y,O.a.POINTERTAP)||Z.doubleClick&&k.onPrePointerObservable.hasSpecificMask(O.a.POINTERDOUBLETAP)&&U._checkPrePointerObservable(null,Y,O.a.POINTERDOUBLETAP))||U._checkPrePointerObservable(null,Y,O.a.POINTERUP))||!U._pointerCaptures[Y.pointerId]||(U._pointerCaptures[Y.pointerId]=!1,!(!k.cameraToUseForPointers&&!k.activeCamera)&&(k.pointerUpPredicate||(k.pointerUpPredicate=function(te){return te.isPickable&&te.isVisible&&te.isReady()&&te.isEnabled()&&(!k.cameraToUseForPointers||(k.cameraToUseForPointers.layerMask&te.layerMask)!=0)}),!U._meshPickProceed&&(D.a&&D.a.HasTriggers||k.onPointerObservable.hasObservers())&&U._initActionManager(null,Z),Q||(Q=U._currentPickResult),U._processPointerUp(Q,Y,Z),U._previousPickResult=U._currentPickResult))}))},this._onKeyDown=function(Y){var Z=F.a.KEYDOWN;if(k.onPreKeyboardObservable.hasObservers()){var Q=new F.c(Z,Y);if(k.onPreKeyboardObservable.notifyObservers(Q,Z),Q.skipOnPointerObservable)return}if(k.onKeyboardObservable.hasObservers()){var Q=new F.b(Z,Y);k.onKeyboardObservable.notifyObservers(Q,Z)}k.actionManager&&k.actionManager.processTrigger(14,o.a.CreateNewFromScene(k,Y))},this._onKeyUp=function(Y){var Z=F.a.KEYUP;if(k.onPreKeyboardObservable.hasObservers()){var Q=new F.c(Z,Y);if(k.onPreKeyboardObservable.notifyObservers(Q,Z),Q.skipOnPointerObservable)return}if(k.onKeyboardObservable.hasObservers()){var Q=new F.b(Z,Y);k.onKeyboardObservable.notifyObservers(Q,Z)}k.actionManager&&k.actionManager.processTrigger(15,o.a.CreateNewFromScene(k,Y))},this._deviceInputSystem.onInputChanged=function(Y,Z,Q,te,re,ae){var ne=U._deviceInputSystem.isDeviceAvailable(x.a.Keyboard),ie=ne&&U._deviceInputSystem.pollInput(x.a.Keyboard,0,18)===1,fe=ne&&U._deviceInputSystem.pollInput(x.a.Keyboard,0,17)===1,he=ne&&(U._deviceInputSystem.pollInput(x.a.Keyboard,0,91)===1||U._deviceInputSystem.pollInput(x.a.Keyboard,0,92)===1||U._deviceInputSystem.pollInput(x.a.Keyboard,0,93)===1),pe=ne&&U._deviceInputSystem.pollInput(x.a.Keyboard,0,16)===1,ue={};if(ue.target=C,ue.preventDefault=function(){},ue.altKey=ie,ue.ctrlKey=fe,ue.metaKey=he,ue.shiftKey=pe,Y===x.a.Keyboard){ue.type=re===1?"keydown":"keyup",ue.key=String.fromCharCode(Q),ue.keyCode=Q;var _e=ae||ue;re===1&&U._onKeyDown(_e),re===0&&U._onKeyUp(_e)}if(Y===x.a.Mouse||Y===x.a.Touch){var ge=U._deviceInputSystem.pollInput(Y,Z,x.c.Horizontal),Ee=U._deviceInputSystem.pollInput(Y,Z,x.c.Vertical),Te=Q===x.c.DeltaHorizontal?re:0,Me=Q===x.c.DeltaVertical?re:0,Re=Q===x.c.DeltaHorizontal&&C?Te-C.getBoundingClientRect().x:0,Ae=Q===x.c.DeltaVertical&&C?Me-C.getBoundingClientRect().y:0;if(ue.pointerId=Y===x.a.Mouse?1:Z,ue.clientX=ge,ue.clientY=Ee,ue.movementX=Te,ue.movementY=Me,ue.offsetX=Re,ue.offsetY=Ae,ue.x=ge,ue.y=Ee,A&&Q>=x.c.LeftClick&&Q<=x.c.RightClick&&re===1){ue.type="pointerdown",ue.button=Q-2;var _e=ae||ue;U._onPointerDown(_e)}if(I&&Q>=x.c.LeftClick&&Q<=x.c.RightClick&&re===0){ue.type="pointerup",ue.button=Q-2;var _e=ae||ue;U._onPointerUp(_e)}if(S){if(Q===x.c.Horizontal||Q===x.c.Vertical||Q===x.c.DeltaHorizontal||Q===x.c.DeltaVertical){ue.type="pointermove";var _e=ae||ue;U._onPointerMove(_e)}else if(Q===x.c.MouseWheelX||Q===x.c.MouseWheelY||Q===x.c.MouseWheelZ){var Pe=U._deviceInputSystem.pollInput(Y,Z,x.c.MouseWheelX),Oe=U._deviceInputSystem.pollInput(Y,Z,x.c.MouseWheelY),xe=U._deviceInputSystem.pollInput(Y,Z,x.c.MouseWheelZ);if(ue.type="wheel",ue.deltaMode=j.b.DOM_DELTA_PIXEL,ue.deltaX=Pe,ue.deltaY=Oe,ue.deltaZ=xe,Pe!==0||Oe!==0||xe!==0){var _e=ae||ue;U._onPointerMove(_e)}}}}},this._alreadyAttached=!0}},G.prototype.detachControl=function(){!this._alreadyAttachedTo||!this._alreadyAttached||(this._deviceInputSystem.dispose(),this._scene.doNotHandleCursors||(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1)},G.prototype.setPointerOverMesh=function(I,A){if(A===void 0&&(A=0),A<0&&(A=0),this._meshUnderPointerId[A]!==I){var S=this._meshUnderPointerId[A],C;S&&(C=S._getActionManagerForTrigger(10),C&&C.processTrigger(10,o.a.CreateNew(S,void 0,{pointerId:A}))),this._meshUnderPointerId[A]=I,this._pointerOverMesh=I,S=this._meshUnderPointerId[A],S&&(C=S._getActionManagerForTrigger(9),C&&C.processTrigger(9,o.a.CreateNew(S,void 0,{pointerId:A})))}},G.prototype.getPointerOverMesh=function(){return this._pointerOverMesh},G.DragMovementThreshold=10,G.LongPressDelay=500,G.DoubleClickDelay=300,G.ExclusiveDoubleClickMode=!1,G}(),R=M(612),L=M(441),N=M(757),B=M(761),X=M(662),K=function(G){Object(P.d)(I,G);function I(A,S){var C=G.call(this)||this;C._inputManager=new w(C),C.cameraToUseForPointers=null,C._isScene=!0,C._blockEntityCollection=!1,C.autoClear=!0,C.autoClearDepthAndStencil=!0,C.clearColor=new L.b(.2,.2,.3,1),C.ambientColor=new L.a(0,0,0),C._environmentIntensity=1,C._forceWireframe=!1,C._skipFrustumClipping=!1,C._forcePointsCloud=!1,C.animationsEnabled=!0,C._animationPropertiesOverride=null,C.useConstantAnimationDeltaTime=!1,C.constantlyUpdateMeshUnderPointer=!1,C.hoverCursor="pointer",C.defaultCursor="",C.doNotHandleCursors=!1,C.preventDefaultOnPointerDown=!0,C.preventDefaultOnPointerUp=!0,C.metadata=null,C.reservedDataStore=null,C.disableOfflineSupportExceptionRules=new Array,C.onDisposeObservable=new n.c,C._onDisposeObserver=null,C.onBeforeRenderObservable=new n.c,C._onBeforeRenderObserver=null,C.onAfterRenderObservable=new n.c,C.onAfterRenderCameraObservable=new n.c,C._onAfterRenderObserver=null,C.onBeforeAnimationsObservable=new n.c,C.onAfterAnimationsObservable=new n.c,C.onBeforeDrawPhaseObservable=new n.c,C.onAfterDrawPhaseObservable=new n.c,C.onReadyObservable=new n.c,C.onBeforeCameraRenderObservable=new n.c,C._onBeforeCameraRenderObserver=null,C.onAfterCameraRenderObservable=new n.c,C._onAfterCameraRenderObserver=null,C.onBeforeActiveMeshesEvaluationObservable=new n.c,C.onAfterActiveMeshesEvaluationObservable=new n.c,C.onBeforeParticlesRenderingObservable=new n.c,C.onAfterParticlesRenderingObservable=new n.c,C.onDataLoadedObservable=new n.c,C.onNewCameraAddedObservable=new n.c,C.onCameraRemovedObservable=new n.c,C.onNewLightAddedObservable=new n.c,C.onLightRemovedObservable=new n.c,C.onNewGeometryAddedObservable=new n.c,C.onGeometryRemovedObservable=new n.c,C.onNewTransformNodeAddedObservable=new n.c,C.onTransformNodeRemovedObservable=new n.c,C.onNewMeshAddedObservable=new n.c,C.onMeshRemovedObservable=new n.c,C.onNewSkeletonAddedObservable=new n.c,C.onSkeletonRemovedObservable=new n.c,C.onNewMaterialAddedObservable=new n.c,C.onNewMultiMaterialAddedObservable=new n.c,C.onMaterialRemovedObservable=new n.c,C.onMultiMaterialRemovedObservable=new n.c,C.onNewTextureAddedObservable=new n.c,C.onTextureRemovedObservable=new n.c,C.onBeforeRenderTargetsRenderObservable=new n.c,C.onAfterRenderTargetsRenderObservable=new n.c,C.onBeforeStepObservable=new n.c,C.onAfterStepObservable=new n.c,C.onActiveCameraChanged=new n.c,C.onBeforeRenderingGroupObservable=new n.c,C.onAfterRenderingGroupObservable=new n.c,C.onMeshImportedObservable=new n.c,C.onAnimationFileImportedObservable=new n.c,C._registeredForLateAnimationBindings=new c.b(256),C.onPrePointerObservable=new n.c,C.onPointerObservable=new n.c,C.onPreKeyboardObservable=new n.c,C.onKeyboardObservable=new n.c,C._useRightHandedSystem=!1,C._timeAccumulator=0,C._currentStepId=0,C._currentInternalStep=0,C._fogEnabled=!0,C._fogMode=I.FOGMODE_NONE,C.fogColor=new L.a(.2,.2,.3),C.fogDensity=.1,C.fogStart=0,C.fogEnd=1e3,C._shadowsEnabled=!0,C._lightsEnabled=!0,C.activeCameras=new Array,C._texturesEnabled=!0,C.physicsEnabled=!0,C.particlesEnabled=!0,C.spritesEnabled=!0,C._skeletonsEnabled=!0,C.lensFlaresEnabled=!0,C.collisionsEnabled=!0,C.gravity=new s.e(0,-9.807,0),C.postProcessesEnabled=!0,C.renderTargetsEnabled=!0,C.dumpNextRenderTargets=!1,C.customRenderTargets=new Array,C.importedMeshesFiles=new Array,C.probesEnabled=!0,C._meshesForIntersections=new c.b(256),C.proceduralTexturesEnabled=!0,C._totalVertices=new R.a,C._activeIndices=new R.a,C._activeParticles=new R.a,C._activeBones=new R.a,C._animationTime=0,C.animationTimeScale=1,C._renderId=0,C._frameId=0,C._executeWhenReadyTimeoutId=-1,C._intermediateRendering=!1,C._viewUpdateFlag=-1,C._projectionUpdateFlag=-1,C._toBeDisposed=new Array(256),C._activeRequests=new Array,C._pendingData=new Array,C._isDisposed=!1,C.dispatchAllSubMeshesOfActiveMeshes=!1,C._activeMeshes=new c.a(256),C._processedMaterials=new c.a(256),C._renderTargets=new c.b(256),C._activeParticleSystems=new c.a(256),C._activeSkeletons=new c.b(32),C._softwareSkinnedMeshes=new c.b(32),C._activeAnimatables=new Array,C._transformMatrix=s.a.Zero(),C.requireLightSorting=!1,C._components=[],C._serializableComponents=[],C._transientComponents=[],C._beforeCameraUpdateStage=v.b.Create(),C._beforeClearStage=v.b.Create(),C._beforeRenderTargetClearStage=v.b.Create(),C._gatherRenderTargetsStage=v.b.Create(),C._gatherActiveCameraRenderTargetsStage=v.b.Create(),C._isReadyForMeshStage=v.b.Create(),C._beforeEvaluateActiveMeshStage=v.b.Create(),C._evaluateSubMeshStage=v.b.Create(),C._preActiveMeshStage=v.b.Create(),C._cameraDrawRenderTargetStage=v.b.Create(),C._beforeCameraDrawStage=v.b.Create(),C._beforeRenderTargetDrawStage=v.b.Create(),C._beforeRenderingGroupDrawStage=v.b.Create(),C._beforeRenderingMeshStage=v.b.Create(),C._afterRenderingMeshStage=v.b.Create(),C._afterRenderingGroupDrawStage=v.b.Create(),C._afterCameraDrawStage=v.b.Create(),C._afterRenderTargetDrawStage=v.b.Create(),C._afterRenderStage=v.b.Create(),C._pointerMoveStage=v.b.Create(),C._pointerDownStage=v.b.Create(),C._pointerUpStage=v.b.Create(),C.geometriesByUniqueId=null,C._renderBundles=null,C._defaultMeshCandidates={data:[],length:0},C._defaultSubMeshCandidates={data:[],length:0},C._preventFreeActiveMeshesAndRenderingGroups=!1,C._activeMeshesFrozen=!1,C._skipEvaluateActiveMeshesCompletely=!1,C._allowPostProcessClearColor=!0,C.getDeterministicFrameTime=function(){return C._engine.getTimeStep()},C._blockMaterialDirtyMechanism=!1;var U=Object(P.a)({useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1},S);return C._engine=A||T.a.LastCreatedEngine,U.virtual||(T.a._LastCreatedScene=C,C._engine.scenes.push(C)),C._uid=null,C._renderingManager=new y.b(C),g.a&&(C.postProcessManager=new g.a(C)),f.a.IsWindowObjectExist()&&C.attachControl(),C._createUbo(),t.a&&(C._imageProcessingConfiguration=new t.a),C.setDefaultCandidateProviders(),U.useGeometryUniqueIdsMap&&(C.geometriesByUniqueId={}),C.useMaterialMeshMap=U.useMaterialMeshMap,C.useClonedMeshMap=U.useClonedMeshMap,(!S||!S.virtual)&&C._engine.onNewSceneAddedObservable.notifyObservers(C),C}return I.DefaultMaterialFactory=function(A){throw E.a.WarnImport("StandardMaterial")},I.CollisionCoordinatorFactory=function(){throw E.a.WarnImport("DefaultCollisionCoordinator")},Object.defineProperty(I.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(A){this._environmentTexture!==A&&(this._environmentTexture=A,this.markAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"environmentIntensity",{get:function(){return this._environmentIntensity},set:function(A){this._environmentIntensity!==A&&(this._environmentIntensity=A,this.markAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"forceWireframe",{get:function(){return this._forceWireframe},set:function(A){this._forceWireframe!==A&&(this._forceWireframe=A,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"skipFrustumClipping",{get:function(){return this._skipFrustumClipping},set:function(A){this._skipFrustumClipping!==A&&(this._skipFrustumClipping=A)},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"forcePointsCloud",{get:function(){return this._forcePointsCloud},set:function(A){this._forcePointsCloud!==A&&(this._forcePointsCloud=A,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride},set:function(A){this._animationPropertiesOverride=A},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"onDispose",{set:function(A){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(A)},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"beforeRender",{set:function(A){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),A&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(A))},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"afterRender",{set:function(A){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),A&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(A))},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"beforeCameraRender",{set:function(A){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(A)},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"afterCameraRender",{set:function(A){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(A)},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"unTranslatedPointer",{get:function(){return this._inputManager.unTranslatedPointer},enumerable:!1,configurable:!0}),Object.defineProperty(I,"DragMovementThreshold",{get:function(){return w.DragMovementThreshold},set:function(A){w.DragMovementThreshold=A},enumerable:!1,configurable:!0}),Object.defineProperty(I,"LongPressDelay",{get:function(){return w.LongPressDelay},set:function(A){w.LongPressDelay=A},enumerable:!1,configurable:!0}),Object.defineProperty(I,"DoubleClickDelay",{get:function(){return w.DoubleClickDelay},set:function(A){w.DoubleClickDelay=A},enumerable:!1,configurable:!0}),Object.defineProperty(I,"ExclusiveDoubleClickMode",{get:function(){return w.ExclusiveDoubleClickMode},set:function(A){w.ExclusiveDoubleClickMode=A},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"useRightHandedSystem",{get:function(){return this._useRightHandedSystem},set:function(A){this._useRightHandedSystem!==A&&(this._useRightHandedSystem=A,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),I.prototype.setStepId=function(A){this._currentStepId=A},I.prototype.getStepId=function(){return this._currentStepId},I.prototype.getInternalStep=function(){return this._currentInternalStep},Object.defineProperty(I.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(A){this._fogEnabled!==A&&(this._fogEnabled=A,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"fogMode",{get:function(){return this._fogMode},set:function(A){this._fogMode!==A&&(this._fogMode=A,this.markAllMaterialsAsDirty(16))},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"prePass",{get:function(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"shadowsEnabled",{get:function(){return this._shadowsEnabled},set:function(A){this._shadowsEnabled!==A&&(this._shadowsEnabled=A,this.markAllMaterialsAsDirty(2))},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"lightsEnabled",{get:function(){return this._lightsEnabled},set:function(A){this._lightsEnabled!==A&&(this._lightsEnabled=A,this.markAllMaterialsAsDirty(2))},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"activeCamera",{get:function(){return this._activeCamera},set:function(A){A!==this._activeCamera&&(this._activeCamera=A,this.onActiveCameraChanged.notifyObservers(this))},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"defaultMaterial",{get:function(){return this._defaultMaterial||(this._defaultMaterial=I.DefaultMaterialFactory(this)),this._defaultMaterial},set:function(A){this._defaultMaterial=A},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"texturesEnabled",{get:function(){return this._texturesEnabled},set:function(A){this._texturesEnabled!==A&&(this._texturesEnabled=A,this.markAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"skeletonsEnabled",{get:function(){return this._skeletonsEnabled},set:function(A){this._skeletonsEnabled!==A&&(this._skeletonsEnabled=A,this.markAllMaterialsAsDirty(8))},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"collisionCoordinator",{get:function(){return this._collisionCoordinator||(this._collisionCoordinator=I.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"frustumPlanes",{get:function(){return this._frustumPlanes},enumerable:!1,configurable:!0}),I.prototype._registerTransientComponents=function(){if(this._transientComponents.length>0){for(var A=0,S=this._transientComponents;A<S.length;A++){var C=S[A];C.register()}this._transientComponents=[]}},I.prototype._addComponent=function(A){this._components.push(A),this._transientComponents.push(A);var S=A;S.addFromContainer&&S.serialize&&this._serializableComponents.push(S)},I.prototype._getComponent=function(A){for(var S=0,C=this._components;S<C.length;S++){var U=C[S];if(U.name===A)return U}return null},I.prototype.getClassName=function(){return"Scene"},I.prototype._getDefaultMeshCandidates=function(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates},I.prototype._getDefaultSubMeshCandidates=function(A){return this._defaultSubMeshCandidates.data=A.subMeshes,this._defaultSubMeshCandidates.length=A.subMeshes.length,this._defaultSubMeshCandidates},I.prototype.setDefaultCandidateProviders=function(){this.getActiveMeshCandidates=this._getDefaultMeshCandidates.bind(this),this.getActiveSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getIntersectingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this),this.getCollidingSubMeshCandidates=this._getDefaultSubMeshCandidates.bind(this)},Object.defineProperty(I.prototype,"meshUnderPointer",{get:function(){return this._inputManager.meshUnderPointer},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"pointerX",{get:function(){return this._inputManager.pointerX},set:function(A){this._inputManager.pointerX=A},enumerable:!1,configurable:!0}),Object.defineProperty(I.prototype,"pointerY",{get:function(){return this._inputManager.pointerY},set:function(A){this._inputManager.pointerY=A},enumerable:!1,configurable:!0}),I.prototype.getCachedMaterial=function(){return this._cachedMaterial},I.prototype.getCachedEffect=function(){return this._cachedEffect},I.prototype.getCachedVisibility=function(){return this._cachedVisibility},I.prototype.isCachedMaterialInvalid=function(A,S,C){return C===void 0&&(C=1),this._cachedEffect!==S||this._cachedMaterial!==A||this._cachedVisibility!==C},I.prototype.getEngine=function(){return this._engine},I.prototype.getTotalVertices=function(){return this._totalVertices.current},Object.defineProperty(I.prototype,"totalVerticesPerfCounter",{get:function(){return this._totalVertices},enumerable:!1,configurable:!0}),I.prototype.getActiveIndices=function(){return this._activeIndices.current},Object.defineProperty(I.prototype,"totalActiveIndicesPerfCounter",{get:function(){return this._activeIndices},enumerable:!1,configurable:!0}),I.prototype.getActiveParticles=function(){return this._activeParticles.current},Object.defineProperty(I.prototype,"activeParticlesPerfCounter",{get:function(){return this._activeParticles},enumerable:!1,configurable:!0}),I.prototype.getActiveBones=function(){return this._activeBones.current},Object.defineProperty(I.prototype,"activeBonesPerfCounter",{get:function(){return this._activeBones},enumerable:!1,configurable:!0}),I.prototype.getActiveMeshes=function(){return this._activeMeshes},I.prototype.getAnimationRatio=function(){return this._animationRatio!==void 0?this._animationRatio:1},I.prototype.getRenderId=function(){return this._renderId},I.prototype.getFrameId=function(){return this._frameId},I.prototype.incrementRenderId=function(){this._renderId++},I.prototype._createUbo=function(){this._sceneUbo=new e.a(this._engine,void 0,!1,"scene"),this._sceneUbo.addUniform("viewProjection",16),this._sceneUbo.addUniform("view",16),this._sceneUbo.addUniform("projection",16),this._sceneUbo.addUniform("vEyePosition",4)},I.prototype.simulatePointerMove=function(A,S){return this._inputManager.simulatePointerMove(A,S),this},I.prototype.simulatePointerDown=function(A,S){return this._inputManager.simulatePointerDown(A,S),this},I.prototype.simulatePointerUp=function(A,S,C){return this._inputManager.simulatePointerUp(A,S,C),this},I.prototype.isPointerCaptured=function(A){return A===void 0&&(A=0),this._inputManager.isPointerCaptured(A)},I.prototype.attachControl=function(A,S,C){A===void 0&&(A=!0),S===void 0&&(S=!0),C===void 0&&(C=!0),this._inputManager.attachControl(A,S,C)},I.prototype.detachControl=function(){this._inputManager.detachControl()},I.prototype.isReady=function(){if(this._isDisposed)return!1;var A,S=this.getEngine();if(!S.areAllEffectsReady()||this._pendingData.length>0)return!1;for(A=0;A<this.meshes.length;A++){var C=this.meshes[A];if(!!C.isEnabled()&&!(!C.subMeshes||C.subMeshes.length===0)){if(!C.isReady(!0))return!1;for(var U=C.hasThinInstances||C.getClassName()==="InstancedMesh"||C.getClassName()==="InstancedLinesMesh"||S.getCaps().instancedArrays&&C.instances.length>0,k=0,J=this._isReadyForMeshStage;k<J.length;k++){var Y=J[k];if(!Y.action(C,U))return!1}}}for(A=0;A<this.geometries.length;A++){var Z=this.geometries[A];if(Z.delayLoadState===2)return!1}if(this.activeCameras&&this.activeCameras.length>0)for(var Q=0,te=this.activeCameras;Q<te.length;Q++){var re=te[Q];if(!re.isReady(!0))return!1}else if(this.activeCamera&&!this.activeCamera.isReady(!0))return!1;for(var ae=0,ne=this.particleSystems;ae<ne.length;ae++){var ie=ne[ae];if(!ie.isReady())return!1}return!0},I.prototype.resetCachedMaterial=function(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null},I.prototype.registerBeforeRender=function(A){this.onBeforeRenderObservable.add(A)},I.prototype.unregisterBeforeRender=function(A){this.onBeforeRenderObservable.removeCallback(A)},I.prototype.registerAfterRender=function(A){this.onAfterRenderObservable.add(A)},I.prototype.unregisterAfterRender=function(A){this.onAfterRenderObservable.removeCallback(A)},I.prototype._executeOnceBeforeRender=function(A){var S=this,C=function(){A(),setTimeout(function(){S.unregisterBeforeRender(C)})};this.registerBeforeRender(C)},I.prototype.executeOnceBeforeRender=function(A,S){var C=this;S!==void 0?setTimeout(function(){C._executeOnceBeforeRender(A)},S):this._executeOnceBeforeRender(A)},I.prototype._addPendingData=function(A){this._pendingData.push(A)},I.prototype._removePendingData=function(A){var S=this.isLoading,C=this._pendingData.indexOf(A);C!==-1&&this._pendingData.splice(C,1),S&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)},I.prototype.getWaitingItemsCount=function(){return this._pendingData.length},Object.defineProperty(I.prototype,"isLoading",{get:function(){return this._pendingData.length>0},enumerable:!1,configurable:!0}),I.prototype.executeWhenReady=function(A){var S=this;this.onReadyObservable.add(A),this._executeWhenReadyTimeoutId===-1&&(this._executeWhenReadyTimeoutId=setTimeout(function(){S._checkIsReady()},150))},I.prototype.whenReadyAsync=function(){var A=this;return new Promise(function(S){A.executeWhenReady(function(){S()})})},I.prototype._checkIsReady=function(){var A=this;if(this._registerTransientComponents(),this.isReady()){this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),this._executeWhenReadyTimeoutId=-1;return}if(this._isDisposed){this.onReadyObservable.clear(),this._executeWhenReadyTimeoutId=-1;return}this._executeWhenReadyTimeoutId=setTimeout(function(){A._checkIsReady()},150)},Object.defineProperty(I.prototype,"animatables",{get:function(){return this._activeAnimatables},enumerable:!1,configurable:!0}),I.prototype.resetLastAnimationTimeFrame=function(){this._animationTimeLast=m.a.Now},I.prototype.getViewMatrix=function(){return this._viewMatrix},I.prototype.getProjectionMatrix=function(){return this._projectionMatrix},I.prototype.getTransformMatrix=function(){return this._transformMatrix},I.prototype.setTransformMatrix=function(A,S,C,U){this._viewUpdateFlag===A.updateFlag&&this._projectionUpdateFlag===S.updateFlag||(this._viewUpdateFlag=A.updateFlag,this._projectionUpdateFlag=S.updateFlag,this._viewMatrix=A,this._projectionMatrix=S,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?N.a.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=N.a.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(C,U):this._sceneUbo.useUbo&&(this._sceneUbo.updateMatrix("viewProjection",this._transformMatrix),this._sceneUbo.updateMatrix("view",this._viewMatrix),this._sceneUbo.updateMatrix("projection",this._projectionMatrix)))},I.prototype.getSceneUniformBuffer=function(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo},I.prototype.getUniqueId=function(){return B.a.UniqueId},I.prototype.addMesh=function(A,S){var C=this;S===void 0&&(S=!1),!this._blockEntityCollection&&(this.meshes.push(A),A._resyncLightSources(),A.parent||A._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(A),S&&A.getChildMeshes().forEach(function(U){C.addMesh(U)}))},I.prototype.removeMesh=function(A,S){var C=this;S===void 0&&(S=!1);var U=this.meshes.indexOf(A);return U!==-1&&(this.meshes[U]=this.meshes[this.meshes.length-1],this.meshes.pop(),A.parent||A._removeFromSceneRootNodes()),this.onMeshRemovedObservable.notifyObservers(A),S&&A.getChildMeshes().forEach(function(k){C.removeMesh(k)}),U},I.prototype.addTransformNode=function(A){this._blockEntityCollection||(A._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(A),A.parent||A._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(A))},I.prototype.removeTransformNode=function(A){var S=A._indexInSceneTransformNodesArray;if(S!==-1){if(S!==this.transformNodes.length-1){var C=this.transformNodes[this.transformNodes.length-1];this.transformNodes[S]=C,C._indexInSceneTransformNodesArray=S}A._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),A.parent||A._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(A),S},I.prototype.removeSkeleton=function(A){var S=this.skeletons.indexOf(A);return S!==-1&&(this.skeletons.splice(S,1),this.onSkeletonRemovedObservable.notifyObservers(A)),S},I.prototype.removeMorphTargetManager=function(A){var S=this.morphTargetManagers.indexOf(A);return S!==-1&&this.morphTargetManagers.splice(S,1),S},I.prototype.removeLight=function(A){var S=this.lights.indexOf(A);if(S!==-1){for(var C=0,U=this.meshes;C<U.length;C++){var k=U[C];k._removeLightSource(A,!1)}this.lights.splice(S,1),this.sortLightsByPriority(),A.parent||A._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(A),S},I.prototype.removeCamera=function(A){var S=this.cameras.indexOf(A);if(S!==-1&&(this.cameras.splice(S,1),A.parent||A._removeFromSceneRootNodes()),this.activeCameras){var C=this.activeCameras.indexOf(A);C!==-1&&this.activeCameras.splice(C,1)}return this.activeCamera===A&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(A),S},I.prototype.removeParticleSystem=function(A){var S=this.particleSystems.indexOf(A);return S!==-1&&this.particleSystems.splice(S,1),S},I.prototype.removeAnimation=function(A){var S=this.animations.indexOf(A);return S!==-1&&this.animations.splice(S,1),S},I.prototype.stopAnimation=function(A,S,C){},I.prototype.removeAnimationGroup=function(A){var S=this.animationGroups.indexOf(A);return S!==-1&&this.animationGroups.splice(S,1),S},I.prototype.removeMultiMaterial=function(A){var S=this.multiMaterials.indexOf(A);return S!==-1&&this.multiMaterials.splice(S,1),this.onMultiMaterialRemovedObservable.notifyObservers(A),S},I.prototype.removeMaterial=function(A){var S=A._indexInSceneMaterialArray;if(S!==-1&&S<this.materials.length){if(S!==this.materials.length-1){var C=this.materials[this.materials.length-1];this.materials[S]=C,C._indexInSceneMaterialArray=S}A._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(A),S},I.prototype.removeActionManager=function(A){var S=this.actionManagers.indexOf(A);return S!==-1&&this.actionManagers.splice(S,1),S},I.prototype.removeTexture=function(A){var S=this.textures.indexOf(A);return S!==-1&&this.textures.splice(S,1),this.onTextureRemovedObservable.notifyObservers(A),S},I.prototype.addLight=function(A){if(!this._blockEntityCollection){this.lights.push(A),this.sortLightsByPriority(),A.parent||A._addToSceneRootNodes();for(var S=0,C=this.meshes;S<C.length;S++){var U=C[S];U.lightSources.indexOf(A)===-1&&(U.lightSources.push(A),U._resyncLightSources())}this.onNewLightAddedObservable.notifyObservers(A)}},I.prototype.sortLightsByPriority=function(){this.requireLightSorting&&this.lights.sort(i.a.CompareLightsPriority)},I.prototype.addCamera=function(A){this._blockEntityCollection||(this.cameras.push(A),this.onNewCameraAddedObservable.notifyObservers(A),A.parent||A._addToSceneRootNodes())},I.prototype.addSkeleton=function(A){this._blockEntityCollection||(this.skeletons.push(A),this.onNewSkeletonAddedObservable.notifyObservers(A))},I.prototype.addParticleSystem=function(A){this._blockEntityCollection||this.particleSystems.push(A)},I.prototype.addAnimation=function(A){this._blockEntityCollection||this.animations.push(A)},I.prototype.addAnimationGroup=function(A){this._blockEntityCollection||this.animationGroups.push(A)},I.prototype.addMultiMaterial=function(A){this._blockEntityCollection||(this.multiMaterials.push(A),this.onNewMultiMaterialAddedObservable.notifyObservers(A))},I.prototype.addMaterial=function(A){this._blockEntityCollection||(A._indexInSceneMaterialArray=this.materials.length,this.materials.push(A),this.onNewMaterialAddedObservable.notifyObservers(A))},I.prototype.addMorphTargetManager=function(A){this._blockEntityCollection||this.morphTargetManagers.push(A)},I.prototype.addGeometry=function(A){this._blockEntityCollection||(this.geometriesByUniqueId&&(this.geometriesByUniqueId[A.uniqueId]=this.geometries.length),this.geometries.push(A))},I.prototype.addActionManager=function(A){this.actionManagers.push(A)},I.prototype.addTexture=function(A){this._blockEntityCollection||(this.textures.push(A),this.onNewTextureAddedObservable.notifyObservers(A))},I.prototype.switchActiveCamera=function(A,S){S===void 0&&(S=!0);var C=this._engine.getInputElement();!C||(this.activeCamera&&this.activeCamera.detachControl(),this.activeCamera=A,S&&A.attachControl())},I.prototype.setActiveCameraByID=function(A){var S=this.getCameraByID(A);return S?(this.activeCamera=S,S):null},I.prototype.setActiveCameraByName=function(A){var S=this.getCameraByName(A);return S?(this.activeCamera=S,S):null},I.prototype.getAnimationGroupByName=function(A){for(var S=0;S<this.animationGroups.length;S++)if(this.animationGroups[S].name===A)return this.animationGroups[S];return null},I.prototype.getMaterialByUniqueID=function(A){for(var S=0;S<this.materials.length;S++)if(this.materials[S].uniqueId===A)return this.materials[S];return null},I.prototype.getMaterialByID=function(A){for(var S=0;S<this.materials.length;S++)if(this.materials[S].id===A)return this.materials[S];return null},I.prototype.getLastMaterialByID=function(A){for(var S=this.materials.length-1;S>=0;S--)if(this.materials[S].id===A)return this.materials[S];return null},I.prototype.getMaterialByName=function(A){for(var S=0;S<this.materials.length;S++)if(this.materials[S].name===A)return this.materials[S];return null},I.prototype.getTextureByUniqueID=function(A){for(var S=0;S<this.textures.length;S++)if(this.textures[S].uniqueId===A)return this.textures[S];return null},I.prototype.getCameraByID=function(A){for(var S=0;S<this.cameras.length;S++)if(this.cameras[S].id===A)return this.cameras[S];return null},I.prototype.getCameraByUniqueID=function(A){for(var S=0;S<this.cameras.length;S++)if(this.cameras[S].uniqueId===A)return this.cameras[S];return null},I.prototype.getCameraByName=function(A){for(var S=0;S<this.cameras.length;S++)if(this.cameras[S].name===A)return this.cameras[S];return null},I.prototype.getBoneByID=function(A){for(var S=0;S<this.skeletons.length;S++)for(var C=this.skeletons[S],U=0;U<C.bones.length;U++)if(C.bones[U].id===A)return C.bones[U];return null},I.prototype.getBoneByName=function(A){for(var S=0;S<this.skeletons.length;S++)for(var C=this.skeletons[S],U=0;U<C.bones.length;U++)if(C.bones[U].name===A)return C.bones[U];return null},I.prototype.getLightByName=function(A){for(var S=0;S<this.lights.length;S++)if(this.lights[S].name===A)return this.lights[S];return null},I.prototype.getLightByID=function(A){for(var S=0;S<this.lights.length;S++)if(this.lights[S].id===A)return this.lights[S];return null},I.prototype.getLightByUniqueID=function(A){for(var S=0;S<this.lights.length;S++)if(this.lights[S].uniqueId===A)return this.lights[S];return null},I.prototype.getParticleSystemByID=function(A){for(var S=0;S<this.particleSystems.length;S++)if(this.particleSystems[S].id===A)return this.particleSystems[S];return null},I.prototype.getGeometryByID=function(A){for(var S=0;S<this.geometries.length;S++)if(this.geometries[S].id===A)return this.geometries[S];return null},I.prototype._getGeometryByUniqueID=function(A){if(this.geometriesByUniqueId){var S=this.geometriesByUniqueId[A];if(S!==void 0)return this.geometries[S]}else for(var C=0;C<this.geometries.length;C++)if(this.geometries[C].uniqueId===A)return this.geometries[C];return null},I.prototype.pushGeometry=function(A,S){return!S&&this._getGeometryByUniqueID(A.uniqueId)?!1:(this.addGeometry(A),this.onNewGeometryAddedObservable.notifyObservers(A),!0)},I.prototype.removeGeometry=function(A){var S;if(this.geometriesByUniqueId){if(S=this.geometriesByUniqueId[A.uniqueId],S===void 0)return!1}else if(S=this.geometries.indexOf(A),S<0)return!1;if(S!==this.geometries.length-1){var C=this.geometries[this.geometries.length-1];C&&(this.geometries[S]=C,this.geometriesByUniqueId&&(this.geometriesByUniqueId[C.uniqueId]=S,this.geometriesByUniqueId[A.uniqueId]=void 0))}return this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(A),!0},I.prototype.getGeometries=function(){return this.geometries},I.prototype.getMeshByID=function(A){for(var S=0;S<this.meshes.length;S++)if(this.meshes[S].id===A)return this.meshes[S];return null},I.prototype.getMeshesByID=function(A){return this.meshes.filter(function(S){return S.id===A})},I.prototype.getTransformNodeByID=function(A){for(var S=0;S<this.transformNodes.length;S++)if(this.transformNodes[S].id===A)return this.transformNodes[S];return null},I.prototype.getTransformNodeByUniqueID=function(A){for(var S=0;S<this.transformNodes.length;S++)if(this.transformNodes[S].uniqueId===A)return this.transformNodes[S];return null},I.prototype.getTransformNodesByID=function(A){return this.transformNodes.filter(function(S){return S.id===A})},I.prototype.getMeshByUniqueID=function(A){for(var S=0;S<this.meshes.length;S++)if(this.meshes[S].uniqueId===A)return this.meshes[S];return null},I.prototype.getLastMeshByID=function(A){for(var S=this.meshes.length-1;S>=0;S--)if(this.meshes[S].id===A)return this.meshes[S];return null},I.prototype.getLastEntryByID=function(A){var S;for(S=this.meshes.length-1;S>=0;S--)if(this.meshes[S].id===A)return this.meshes[S];for(S=this.transformNodes.length-1;S>=0;S--)if(this.transformNodes[S].id===A)return this.transformNodes[S];for(S=this.cameras.length-1;S>=0;S--)if(this.cameras[S].id===A)return this.cameras[S];for(S=this.lights.length-1;S>=0;S--)if(this.lights[S].id===A)return this.lights[S];return null},I.prototype.getNodeByID=function(A){var S=this.getMeshByID(A);if(S)return S;var C=this.getTransformNodeByID(A);if(C)return C;var U=this.getLightByID(A);if(U)return U;var k=this.getCameraByID(A);if(k)return k;var J=this.getBoneByID(A);return J||null},I.prototype.getNodeByName=function(A){var S=this.getMeshByName(A);if(S)return S;var C=this.getTransformNodeByName(A);if(C)return C;var U=this.getLightByName(A);if(U)return U;var k=this.getCameraByName(A);if(k)return k;var J=this.getBoneByName(A);return J||null},I.prototype.getMeshByName=function(A){for(var S=0;S<this.meshes.length;S++)if(this.meshes[S].name===A)return this.meshes[S];return null},I.prototype.getTransformNodeByName=function(A){for(var S=0;S<this.transformNodes.length;S++)if(this.transformNodes[S].name===A)return this.transformNodes[S];return null},I.prototype.getLastSkeletonByID=function(A){for(var S=this.skeletons.length-1;S>=0;S--)if(this.skeletons[S].id===A)return this.skeletons[S];return null},I.prototype.getSkeletonByUniqueId=function(A){for(var S=0;S<this.skeletons.length;S++)if(this.skeletons[S].uniqueId===A)return this.skeletons[S];return null},I.prototype.getSkeletonById=function(A){for(var S=0;S<this.skeletons.length;S++)if(this.skeletons[S].id===A)return this.skeletons[S];return null},I.prototype.getSkeletonByName=function(A){for(var S=0;S<this.skeletons.length;S++)if(this.skeletons[S].name===A)return this.skeletons[S];return null},I.prototype.getMorphTargetManagerById=function(A){for(var S=0;S<this.morphTargetManagers.length;S++)if(this.morphTargetManagers[S].uniqueId===A)return this.morphTargetManagers[S];return null},I.prototype.getMorphTargetById=function(A){for(var S=0;S<this.morphTargetManagers.length;++S)for(var C=this.morphTargetManagers[S],U=0;U<C.numTargets;++U){var k=C.getTarget(U);if(k.id===A)return k}return null},I.prototype.getMorphTargetByName=function(A){for(var S=0;S<this.morphTargetManagers.length;++S)for(var C=this.morphTargetManagers[S],U=0;U<C.numTargets;++U){var k=C.getTarget(U);if(k.name===A)return k}return null},I.prototype.getPostProcessByName=function(A){for(var S=0;S<this.postProcesses.length;++S){var C=this.postProcesses[S];if(C.name===A)return C}return null},I.prototype.isActiveMesh=function(A){return this._activeMeshes.indexOf(A)!==-1},Object.defineProperty(I.prototype,"uid",{get:function(){return this._uid||(this._uid=d.b.RandomId()),this._uid},enumerable:!1,configurable:!0}),I.prototype.addExternalData=function(A,S){return this._externalData||(this._externalData=new a.a),this._externalData.add(A,S)},I.prototype.getExternalData=function(A){return this._externalData?this._externalData.get(A):null},I.prototype.getOrAddExternalDataWithFactory=function(A,S){return this._externalData||(this._externalData=new a.a),this._externalData.getOrAddWithFactory(A,S)},I.prototype.removeExternalData=function(A){return this._externalData.remove(A)},I.prototype._evaluateSubMesh=function(A,S,C){if(C.hasInstances||C.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||S.alwaysSelectAsActiveMesh||S.subMeshes.length===1||A.isInFrustum(this._frustumPlanes)){for(var U=0,k=this._evaluateSubMeshStage;U<k.length;U++){var J=k[U];J.action(S,A)}var Y=A.getMaterial();Y!=null&&(Y.hasRenderTargetTextures&&Y.getRenderTargetTextures!=null&&this._processedMaterials.indexOf(Y)===-1&&(this._processedMaterials.push(Y),this._renderTargets.concatWithNoDuplicate(Y.getRenderTargetTextures())),this._renderingManager.dispatch(A,S,Y))}},I.prototype.freeProcessedMaterials=function(){this._processedMaterials.dispose()},Object.defineProperty(I.prototype,"blockfreeActiveMeshesAndRenderingGroups",{get:function(){return this._preventFreeActiveMeshesAndRenderingGroups},set:function(A){this._preventFreeActiveMeshesAndRenderingGroups!==A&&(A&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=A)},enumerable:!1,configurable:!0}),I.prototype.freeActiveMeshes=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(var A=0;A<this.activeCameras.length;A++){var S=this.activeCameras[A];S&&S._activeMeshes&&S._activeMeshes.dispose()}},I.prototype.freeRenderingGroups=function(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(var A=0;A<this.textures.length;A++){var S=this.textures[A];S&&S.renderList&&S.freeRenderingGroups()}},I.prototype._isInIntermediateRendering=function(){return this._intermediateRendering},I.prototype.freezeActiveMeshes=function(A,S,C){var U=this;return A===void 0&&(A=!1),this.executeWhenReady(function(){if(!U.activeCamera){C&&C("No active camera found");return}U._frustumPlanes||U.setTransformMatrix(U.activeCamera.getViewMatrix(),U.activeCamera.getProjectionMatrix()),U._evaluateActiveMeshes(),U._activeMeshesFrozen=!0,U._skipEvaluateActiveMeshesCompletely=A;for(var k=0;k<U._activeMeshes.length;k++)U._activeMeshes.data[k]._freeze();S&&S()}),this},I.prototype.unfreezeActiveMeshes=function(){for(var A=0;A<this.meshes.length;A++){var S=this.meshes[A];S._internalAbstractMeshDataInfo&&(S._internalAbstractMeshDataInfo._isActive=!1)}for(var A=0;A<this._activeMeshes.length;A++)this._activeMeshes.data[A]._unFreeze();return this._activeMeshesFrozen=!1,this},I.prototype._evaluateActiveMeshes=function(){if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely)for(var A=this._activeMeshes.length,S=0;S<A;S++){var C=this._activeMeshes.data[S];C.computeWorldMatrix()}if(this._activeParticleSystems)for(var U=this._activeParticleSystems.length,S=0;S<U;S++)this._activeParticleSystems.data[S].animate();return}if(!!this.activeCamera){this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();for(var k=0,J=this._beforeEvaluateActiveMeshStage;k<J.length;k++){var Y=J[k];Y.action()}for(var Z=this.getActiveMeshCandidates(),Q=Z.length,S=0;S<Q;S++){var C=Z.data[S];if(C._internalAbstractMeshDataInfo._currentLODIsUpToDate=!1,!C.isBlocked&&(this._totalVertices.addCount(C.getTotalVertices(),!1),!(!C.isReady()||!C.isEnabled()||C.scaling.lengthSquared()===0))){C.computeWorldMatrix(),C.actionManager&&C.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(C);var te=this.customLODSelector?this.customLODSelector(C,this.activeCamera):C.getLOD(this.activeCamera);if(C._internalAbstractMeshDataInfo._currentLOD=te,C._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0,te!=null&&(te!==C&&te.billboardMode!==u.a.BILLBOARDMODE_NONE&&te.computeWorldMatrix(),C._preActivate(),C.isVisible&&C.visibility>0&&(C.layerMask&this.activeCamera.layerMask)!=0&&(this._skipFrustumClipping||C.alwaysSelectAsActiveMesh||C.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(C),this.activeCamera._activeMeshes.push(C),te!==C&&te._activate(this._renderId,!1);for(var re=0,ae=this._preActiveMeshStage;re<ae.length;re++){var Y=ae[re];Y.action(C)}C._activate(this._renderId,!1)&&(C.isAnInstance?C._internalAbstractMeshDataInfo._actAsRegularMesh&&(te=C):te._internalAbstractMeshDataInfo._onlyForInstances=!1,te._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(C,te)),C._postActivate()}}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(var ne=0;ne<this.particleSystems.length;ne++){var ie=this.particleSystems[ne];if(!(!ie.isStarted()||!ie.emitter)){var fe=ie.emitter;(!fe.position||fe.isEnabled())&&(this._activeParticleSystems.push(ie),ie.animate(),this._renderingManager.dispatchParticles(ie))}}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}},I.prototype._activeMesh=function(A,S){if(this._skeletonsEnabled&&S.skeleton!==null&&S.skeleton!==void 0&&(this._activeSkeletons.pushNoDuplicate(S.skeleton)&&S.skeleton.prepare(),S.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(S)),S!=null&&S.subMeshes!==void 0&&S.subMeshes!==null&&S.subMeshes.length>0)for(var C=this.getActiveSubMeshCandidates(S),U=C.length,k=0;k<U;k++){var J=C.data[k];this._evaluateSubMesh(J,S,A)}},I.prototype.updateTransformMatrix=function(A){!this.activeCamera||this.setTransformMatrix(this.activeCamera.getViewMatrix(),this.activeCamera.getProjectionMatrix(A))},I.prototype._bindFrameBuffer=function(A){if(A&&A._multiviewTexture)A._multiviewTexture._bindFrameBuffer();else if(A&&A.outputRenderTarget){var S=this.getEngine().getCaps().multiview&&A.outputRenderTarget&&A.outputRenderTarget.getViewCount()>1;if(S)A.outputRenderTarget._bindFrameBuffer();else{var C=A.outputRenderTarget.getInternalTexture();C?this.getEngine().bindFramebuffer(C):b.a.Error("Camera contains invalid customDefaultRenderTarget")}}else this.getEngine().restoreDefaultFramebuffer()},I.prototype._renderForCamera=function(A,S){if(!(A&&A._skipRendering)){var C=this._engine;if(this._activeCamera=A,!this.activeCamera)throw new Error("Active camera not set");C.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++;var U=this.getEngine().getCaps().multiview&&A.outputRenderTarget&&A.outputRenderTarget.getViewCount()>1;U?this.setTransformMatrix(A._rigCameras[0].getViewMatrix(),A._rigCameras[0].getProjectionMatrix(),A._rigCameras[1].getViewMatrix(),A._rigCameras[1].getProjectionMatrix()):this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(var k=0;k<this._softwareSkinnedMeshes.length;k++){var J=this._softwareSkinnedMeshes.data[k];J.applySkeleton(J.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),A.customRenderTargets&&A.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(A.customRenderTargets),S&&S.customRenderTargets&&S.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(S.customRenderTargets);for(var Y=0,Z=this._gatherActiveCameraRenderTargetsStage;Y<Z.length;Y++){var Q=Z[Y];Q.action(this._renderTargets)}var te=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){d.b.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(var re=0;re<this._renderTargets.length;re++){var ae=this._renderTargets.data[re];if(ae._shouldRender()){this._renderId++;var ne=ae.activeCamera&&ae.activeCamera!==this.activeCamera;ae.render(ne,this.dumpNextRenderTargets),te=!0}}d.b.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(var ie=0,fe=this._cameraDrawRenderTargetStage;ie<fe.length;ie++){var Q=fe[ie];te=Q.action(this.activeCamera)||te}this._intermediateRendering=!1,this.activeCamera&&this.activeCamera.outputRenderTarget&&(te=!0)}te&&!this.prePass&&this._bindFrameBuffer(this._activeCamera),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),this.postProcessManager&&!A._multiviewTexture&&!this.prePass&&this.postProcessManager._prepareFrame();for(var he=0,pe=this._beforeCameraDrawStage;he<pe.length;he++){var Q=pe[he];Q.action(this.activeCamera)}this.onBeforeDrawPhaseObservable.notifyObservers(this),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(var ue=0,_e=this._afterCameraDrawStage;ue<_e.length;ue++){var Q=_e[ue];Q.action(this.activeCamera)}if(this.postProcessManager&&!A._multiviewTexture){var ge=A.outputRenderTarget?A.outputRenderTarget.getInternalTexture():void 0;this.postProcessManager._finalizeFrame(A.isIntermediate,ge)}this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}},I.prototype._processSubCameras=function(A){if(A.cameraRigMode===l.a.RIG_MODE_NONE||A.outputRenderTarget&&A.outputRenderTarget.getViewCount()>1&&this.getEngine().getCaps().multiview){this._renderForCamera(A),this.onAfterRenderCameraObservable.notifyObservers(A);return}if(A._useMultiviewToSingleView)this._renderMultiviewToSingleView(A);else for(var S=0;S<A._rigCameras.length;S++)this._renderForCamera(A._rigCameras[S],A);this._activeCamera=A,this.setTransformMatrix(this._activeCamera.getViewMatrix(),this._activeCamera.getProjectionMatrix()),this.onAfterRenderCameraObservable.notifyObservers(A)},I.prototype._checkIntersections=function(){for(var A=0;A<this._meshesForIntersections.length;A++){var S=this._meshesForIntersections.data[A];if(!!S.actionManager)for(var C=0;S.actionManager&&C<S.actionManager.actions.length;C++){var U=S.actionManager.actions[C];if(U.trigger===12||U.trigger===13){var k=U.getTriggerParameter(),J=k instanceof p.a?k:k.mesh,Y=J.intersectsMesh(S,k.usePreciseIntersection),Z=S._intersectionsInProgress.indexOf(J);Y&&Z===-1?U.trigger===12?(U._executeCurrent(o.a.CreateNew(S,void 0,J)),S._intersectionsInProgress.push(J)):U.trigger===13&&S._intersectionsInProgress.push(J):!Y&&Z>-1&&(U.trigger===13&&U._executeCurrent(o.a.CreateNew(S,void 0,J)),(!S.actionManager.hasSpecificTrigger(13,function(Q){var te=Q instanceof p.a?Q:Q.mesh;return J===te})||U.trigger===13)&&S._intersectionsInProgress.splice(Z,1))}}}},I.prototype._advancePhysicsEngineStep=function(A){},I.prototype._animate=function(){},I.prototype.animate=function(){if(this._engine.isDeterministicLockStep()){var A=Math.max(I.MinDeltaTime,Math.min(this._engine.getDeltaTime(),I.MaxDeltaTime))+this._timeAccumulator,S=this._engine.getTimeStep(),C=1e3/S/1e3,U=0,k=this._engine.getLockstepMaxSteps(),J=Math.floor(A/S);for(J=Math.min(J,k);A>0&&U<J;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=S*C,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(S),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,U++,A-=S;this._timeAccumulator=A<0?0:A}else{var A=this.useConstantAnimationDeltaTime?16:Math.max(I.MinDeltaTime,Math.min(this._engine.getDeltaTime(),I.MaxDeltaTime));this._animationRatio=A*(60/1e3),this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(A)}},I.prototype._clear=function(){(this.autoClearDepthAndStencil||this.autoClear)&&this._engine.clear(this.clearColor,this.autoClear||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)},I.prototype.render=function(A,S){var C=this,U;if(A===void 0&&(A=!0),S===void 0&&(S=!1),!this.isDisposed){this.onReadyObservable.hasObservers()&&this._executeWhenReadyTimeoutId===-1&&this._checkIsReady(),this._frameId++,this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),S||this.animate();for(var k=0,J=this._beforeCameraUpdateStage;k<J.length;k++){var Y=J[k];Y.action()}if(A){if(this.activeCameras&&this.activeCameras.length>0)for(var Z=0;Z<this.activeCameras.length;Z++){var Q=this.activeCameras[Z];if(Q.update(),Q.cameraRigMode!==l.a.RIG_MODE_NONE)for(var te=0;te<Q._rigCameras.length;te++)Q._rigCameras[te].update()}else if(this.activeCamera&&(this.activeCamera.update(),this.activeCamera.cameraRigMode!==l.a.RIG_MODE_NONE))for(var te=0;te<this.activeCamera._rigCameras.length;te++)this.activeCamera._rigCameras[te].update()}this.onBeforeRenderObservable.notifyObservers(this);var re=this.getEngine();if(re.isWebGPU){var ae=re;if(this._activeMeshesFrozen){if((U=this.activeCameras)===null||U===void 0?void 0:U.length)for(var ne=0;ne<this.activeCameras.length;ne++){var Q=this.activeCameras[ne];this.setTransformMatrix(Q.getViewMatrix(),Q.getProjectionMatrix())}else{var Q=this.activeCamera;this.setTransformMatrix(Q.getViewMatrix(),Q.getProjectionMatrix())}if(this._renderBundles){ae.executeBundles(this._renderBundles);return}ae.startRecordBundle(),ae.onEndFrameObservable.addOnce(function(){C._renderBundles=[ae.stopRecordBundle()]})}else this._renderBundles&&(this._renderBundles=null)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);var ie=this.activeCamera;if(this.renderTargetsEnabled){d.b.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(var fe=0;fe<this.customRenderTargets.length;fe++){var he=this.customRenderTargets[fe];if(he._shouldRender()){if(this._renderId++,this.activeCamera=he.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");re.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),he.render(ie!==this.activeCamera,this.dumpNextRenderTargets)}}d.b.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this.activeCamera=ie;var pe=!1;this._activeCamera&&this._activeCamera.cameraRigMode!==l.a.RIG_MODE_CUSTOM&&!this.prePass&&(this._bindFrameBuffer(this._activeCamera),pe=!0),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(var ue=0,_e=this._beforeClearStage;ue<_e.length;ue++){var Y=_e[ue];Y.action()}if(!pe&&this.activeCamera&&this.activeCamera._rigCameras.length>0)for(var ge=0,Ee=this.activeCamera._rigCameras;ge<Ee.length;ge++){var Te=Ee[ge];this._bindFrameBuffer(Te),this._clear()}else this._clear();for(var Me=0,Re=this._gatherRenderTargetsStage;Me<Re.length;Me++){var Y=Re[Me];Y.action(this._renderTargets)}if(this.activeCameras&&this.activeCameras.length>0)for(var Z=0;Z<this.activeCameras.length;Z++)Z>0&&this._engine.clear(null,!1,!0,!0),this._processSubCameras(this.activeCameras[Z]);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera)}this._checkIntersections();for(var Ae=0,Pe=this._afterRenderStage;Ae<Pe.length;Ae++){var Y=Pe[Ae];Y.action()}if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(var te=0;te<this._toBeDisposed.length;te++){var Oe=this._toBeDisposed[te];Oe&&Oe.dispose()}this._toBeDisposed=[]}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0)}},I.prototype.freezeMaterials=function(){for(var A=0;A<this.materials.length;A++)this.materials[A].freeze()},I.prototype.unfreezeMaterials=function(){for(var A=0;A<this.materials.length;A++)this.materials[A].unfreeze()},I.prototype.dispose=function(){this._renderBundles=null,this.beforeRender=null,this.afterRender=null,T.a._LastCreatedScene===this&&(T.a._LastCreatedScene=null),this.skeletons=[],this.morphTargetManagers=[],this._transientComponents=[],this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear();for(var A=0,S=this._components;A<S.length;A++){var C=S[A];C.dispose()}this.importedMeshesFiles=new Array,this.stopAllAnimations&&this.stopAllAnimations(),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed=[];for(var U=0,k=this._activeRequests;U<k.length;U++){var J=k[U];J.abort()}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.detachControl();var Y=this._engine.getInputElement();if(Y){var Z;for(Z=0;Z<this.cameras.length;Z++)this.cameras[Z].detachControl()}for(;this.animationGroups.length;)this.animationGroups[0].dispose();for(;this.lights.length;)this.lights[0].dispose();for(;this.meshes.length;)this.meshes[0].dispose(!0);for(;this.transformNodes.length;)this.transformNodes[0].dispose(!0);for(;this.cameras.length;)this.cameras[0].dispose();for(this._defaultMaterial&&this._defaultMaterial.dispose();this.multiMaterials.length;)this.multiMaterials[0].dispose();for(;this.materials.length;)this.materials[0].dispose();for(;this.particleSystems.length;)this.particleSystems[0].dispose();for(;this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.textures.length;)this.textures[0].dispose();for(;this.morphTargetManagers.length;)this.morphTargetManagers[0].dispose();this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),Z=this._engine.scenes.indexOf(this),Z>-1&&this._engine.scenes.splice(Z,1),this._engine.wipeCaches(!0),this._isDisposed=!0},Object.defineProperty(I.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!1,configurable:!0}),I.prototype.clearCachedVertexData=function(){for(var A=0;A<this.meshes.length;A++){var S=this.meshes[A],C=S.geometry;if(C){C._indices=[];for(var U in C._vertexBuffers)!C._vertexBuffers.hasOwnProperty(U)||(C._vertexBuffers[U]._buffer._data=null)}}},I.prototype.cleanCachedTextureBuffer=function(){for(var A=0,S=this.textures;A<S.length;A++){var C=S[A],U=C._buffer;U&&(C._buffer=null)}},I.prototype.getWorldExtends=function(A){var S=new s.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),C=new s.e(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return A=A||function(){return!0},this.meshes.filter(A).forEach(function(U){if(U.computeWorldMatrix(!0),!(!U.subMeshes||U.subMeshes.length===0||U.infiniteDistance)){var k=U.getBoundingInfo(),J=k.boundingBox.minimumWorld,Y=k.boundingBox.maximumWorld;s.e.CheckExtends(J,S,C),s.e.CheckExtends(Y,S,C)}}),{min:S,max:C}},I.prototype.createPickingRay=function(A,S,C,U,k){throw k===void 0&&(k=!1),E.a.WarnImport("Ray")},I.prototype.createPickingRayToRef=function(A,S,C,U,k,J){throw J===void 0&&(J=!1),E.a.WarnImport("Ray")},I.prototype.createPickingRayInCameraSpace=function(A,S,C){throw E.a.WarnImport("Ray")},I.prototype.createPickingRayInCameraSpaceToRef=function(A,S,C,U){throw E.a.WarnImport("Ray")},I.prototype.pick=function(A,S,C,U,k,J){var Y=new r.a;return Y._pickingUnavailable=!0,Y},I.prototype.pickWithBoundingInfo=function(A,S,C,U,k){var J=new r.a;return J._pickingUnavailable=!0,J},I.prototype.pickWithRay=function(A,S,C,U){throw E.a.WarnImport("Ray")},I.prototype.multiPick=function(A,S,C,U,k){throw E.a.WarnImport("Ray")},I.prototype.multiPickWithRay=function(A,S,C){throw E.a.WarnImport("Ray")},I.prototype.setPointerOverMesh=function(A,S){this._inputManager.setPointerOverMesh(A,S)},I.prototype.getPointerOverMesh=function(){return this._inputManager.getPointerOverMesh()},I.prototype._rebuildGeometries=function(){for(var A=0,S=this.geometries;A<S.length;A++){var C=S[A];C._rebuild()}for(var U=0,k=this.meshes;U<k.length;U++){var J=k[U];J._rebuild()}this.postProcessManager&&this.postProcessManager._rebuild();for(var Y=0,Z=this._components;Y<Z.length;Y++){var Q=Z[Y];Q.rebuild()}for(var te=0,re=this.particleSystems;te<re.length;te++){var ae=re[te];ae.rebuild()}},I.prototype._rebuildTextures=function(){for(var A=0,S=this.textures;A<S.length;A++){var C=S[A];C._rebuild()}this.markAllMaterialsAsDirty(1)},I.prototype._getByTags=function(A,S,C){if(S===void 0)return A;var U=[];C=C||function(Y){};for(var k in A){var J=A[k];_.a&&_.a.MatchesQuery(J,S)&&(U.push(J),C(J))}return U},I.prototype.getMeshesByTags=function(A,S){return this._getByTags(this.meshes,A,S)},I.prototype.getCamerasByTags=function(A,S){return this._getByTags(this.cameras,A,S)},I.prototype.getLightsByTags=function(A,S){return this._getByTags(this.lights,A,S)},I.prototype.getMaterialByTags=function(A,S){return this._getByTags(this.materials,A,S).concat(this._getByTags(this.multiMaterials,A,S))},I.prototype.getTransformNodesByTags=function(A,S){return this._getByTags(this.transformNodes,A,S)},I.prototype.setRenderingOrder=function(A,S,C,U){S===void 0&&(S=null),C===void 0&&(C=null),U===void 0&&(U=null),this._renderingManager.setRenderingOrder(A,S,C,U)},I.prototype.setRenderingAutoClearDepthStencil=function(A,S,C,U){C===void 0&&(C=!0),U===void 0&&(U=!0),this._renderingManager.setRenderingAutoClearDepthStencil(A,S,C,U)},I.prototype.getAutoClearDepthStencilSetup=function(A){return this._renderingManager.getAutoClearDepthStencilSetup(A)},Object.defineProperty(I.prototype,"blockMaterialDirtyMechanism",{get:function(){return this._blockMaterialDirtyMechanism},set:function(A){this._blockMaterialDirtyMechanism!==A&&(this._blockMaterialDirtyMechanism=A,A||this.markAllMaterialsAsDirty(63))},enumerable:!1,configurable:!0}),I.prototype.markAllMaterialsAsDirty=function(A,S){if(!this._blockMaterialDirtyMechanism)for(var C=0,U=this.materials;C<U.length;C++){var k=U[C];S&&!S(k)||k.markAsDirty(A)}},I.prototype._loadFile=function(A,S,C,U,k,J){var Y=this,Z=X.a.LoadFile(A,S,C,U?this.offlineProvider:void 0,k,J);return this._activeRequests.push(Z),Z.onCompleteObservable.add(function(Q){Y._activeRequests.splice(Y._activeRequests.indexOf(Q),1)}),Z},I.prototype._loadFileAsync=function(A,S,C,U){var k=this;return new Promise(function(J,Y){k._loadFile(A,function(Z){J(Z)},S,C,U,function(Z,Q){Y(Q)})})},I.prototype._requestFile=function(A,S,C,U,k,J,Y){var Z=this,Q=X.a.RequestFile(A,S,C,U?this.offlineProvider:void 0,k,J,Y);return this._activeRequests.push(Q),Q.onCompleteObservable.add(function(te){Z._activeRequests.splice(Z._activeRequests.indexOf(te),1)}),Q},I.prototype._requestFileAsync=function(A,S,C,U,k){var J=this;return new Promise(function(Y,Z){J._requestFile(A,function(Q){Y(Q)},S,C,U,function(Q){Z(Q)},k)})},I.prototype._readFile=function(A,S,C,U,k){var J=this,Y=X.a.ReadFile(A,S,C,U,k);return this._activeRequests.push(Y),Y.onCompleteObservable.add(function(Z){J._activeRequests.splice(J._activeRequests.indexOf(Z),1)}),Y},I.prototype._readFileAsync=function(A,S,C){var U=this;return new Promise(function(k,J){U._readFile(A,function(Y){k(Y)},S,C,function(Y){J(Y)})})},I.FOGMODE_NONE=0,I.FOGMODE_EXP=1,I.FOGMODE_EXP2=2,I.FOGMODE_LINEAR=3,I.MinDeltaTime=1,I.MaxDeltaTime=1e3,I}(h.a)},function($,W,M){"use strict";M.d(W,"a",function(){return P});var P=function(){function d(){}return d.WithinEpsilon=function(m,n,c){return c===void 0&&(c=1401298e-51),Math.abs(m-n)<=c},d.ToHex=function(m){var n=m.toString(16);return m<=15?("0"+n).toUpperCase():n.toUpperCase()},d.Sign=function(m){return m=+m,m===0||isNaN(m)?m:m>0?1:-1},d.Clamp=function(m,n,c){return n===void 0&&(n=0),c===void 0&&(c=1),Math.min(c,Math.max(n,m))},d.Log2=function(m){return Math.log(m)*Math.LOG2E},d.ILog2=function(m){if(Math.log2)return Math.floor(Math.log2(m));if(m<0)return NaN;if(m===0)return-Infinity;var n=0;if(m<1){for(;m<1;)n++,m=m*2;n=-n}else if(m>1)for(;m>1;)n++,m=Math.floor(m/2);return n},d.Repeat=function(m,n){return m-Math.floor(m/n)*n},d.Normalize=function(m,n,c){return(m-n)/(c-n)},d.Denormalize=function(m,n,c){return m*(c-n)+n},d.DeltaAngle=function(m,n){var c=d.Repeat(n-m,360);return c>180&&(c-=360),c},d.PingPong=function(m,n){var c=d.Repeat(m,n*2);return n-Math.abs(c-n)},d.SmoothStep=function(m,n,c){var a=d.Clamp(c);return a=-2*a*a*a+3*a*a,n*a+m*(1-a)},d.MoveTowards=function(m,n,c){var a=0;return Math.abs(n-m)<=c?a=n:a=m+d.Sign(n-m)*c,a},d.MoveTowardsAngle=function(m,n,c){var a=d.DeltaAngle(m,n),_=0;return-c<a&&a<c?_=n:(n=m+a,_=d.MoveTowards(m,n,c)),_},d.Lerp=function(m,n,c){return m+(n-m)*c},d.LerpAngle=function(m,n,c){var a=d.Repeat(n-m,360);return a>180&&(a-=360),m+a*d.Clamp(c)},d.InverseLerp=function(m,n,c){var a=0;return m!=n?a=d.Clamp((c-m)/(n-m)):a=0,a},d.Hermite=function(m,n,c,a,_){var s=_*_,u=_*s,p=2*u-3*s+1,l=-2*u+3*s,h=u-2*s+_,t=u-s;return m*p+c*l+n*h+a*t},d.RandomRange=function(m,n){return m===n?m:Math.random()*(n-m)+m},d.RangeToPercent=function(m,n,c){return(m-n)/(c-n)},d.PercentToRange=function(m,n,c){return(c-n)*m+n},d.NormalizeRadians=function(m){return m-=d.TwoPi*Math.floor((m+Math.PI)/d.TwoPi),m},d.TwoPi=Math.PI*2,d}()},function($,W,M){"use strict";M.d(W,"a",function(){return t});var P=M(434),d=M(439),m=M(490),n=M(443),c=M(438),a=M(436),_=M(453),s=M(440),u=M(437),p=M(476),l=M(520),h=M(757),t=function(e){Object(P.d)(i,e);function i(r,o,g,y){y===void 0&&(y=!0);var v=e.call(this,r,g)||this;return v._position=a.e.Zero(),v._upVector=a.e.Up(),v.orthoLeft=null,v.orthoRight=null,v.orthoBottom=null,v.orthoTop=null,v.fov=.8,v.minZ=1,v.maxZ=1e4,v.inertia=.9,v.mode=i.PERSPECTIVE_CAMERA,v.isIntermediate=!1,v.viewport=new l.a(0,0,1,1),v.layerMask=268435455,v.fovMode=i.FOVMODE_VERTICAL_FIXED,v.cameraRigMode=i.RIG_MODE_NONE,v.customRenderTargets=new Array,v.outputRenderTarget=null,v.onViewMatrixChangedObservable=new c.c,v.onProjectionMatrixChangedObservable=new c.c,v.onAfterCheckInputsObservable=new c.c,v.onRestoreStateObservable=new c.c,v.isRigCamera=!1,v._rigCameras=new Array,v._webvrViewMatrix=a.a.Identity(),v._skipRendering=!1,v._projectionMatrix=new a.a,v._postProcesses=new Array,v._activeMeshes=new m.a(256),v._globalPosition=a.e.Zero(),v._computedViewMatrix=a.a.Identity(),v._doNotComputeProjectionMatrix=!1,v._transformMatrix=a.a.Zero(),v._refreshFrustumPlanes=!0,v._isCamera=!0,v._isLeftCamera=!1,v._isRightCamera=!1,v.getScene().addCamera(v),y&&!v.getScene().activeCamera&&(v.getScene().activeCamera=v),v.position=o,v}return Object.defineProperty(i.prototype,"position",{get:function(){return this._position},set:function(r){this._position=r},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"upVector",{get:function(){return this._upVector},set:function(r){this._upVector=r},enumerable:!1,configurable:!0}),i.prototype.storeState=function(){return this._stateStored=!0,this._storedFov=this.fov,this},i.prototype._restoreStateValues=function(){return this._stateStored?(this.fov=this._storedFov,!0):!1},i.prototype.restoreState=function(){return this._restoreStateValues()?(this.onRestoreStateObservable.notifyObservers(this),!0):!1},i.prototype.getClassName=function(){return"Camera"},i.prototype.toString=function(r){var o="Name: "+this.name;if(o+=", type: "+this.getClassName(),this.animations)for(var g=0;g<this.animations.length;g++)o+=", animation[0]: "+this.animations[g].toString(r);return o},Object.defineProperty(i.prototype,"globalPosition",{get:function(){return this._globalPosition},enumerable:!1,configurable:!0}),i.prototype.getActiveMeshes=function(){return this._activeMeshes},i.prototype.isActiveMesh=function(r){return this._activeMeshes.indexOf(r)!==-1},i.prototype.isReady=function(r){if(r===void 0&&(r=!1),r)for(var o=0,g=this._postProcesses;o<g.length;o++){var y=g[o];if(y&&!y.isReady())return!1}return e.prototype.isReady.call(this,r)},i.prototype._initCache=function(){e.prototype._initCache.call(this),this._cache.position=new a.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new a.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.minZ=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0},i.prototype._updateCache=function(r){r||e.prototype._updateCache.call(this),this._cache.position.copyFrom(this.position),this._cache.upVector.copyFrom(this.upVector)},i.prototype._isSynchronized=function(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()},i.prototype._isSynchronizedViewMatrix=function(){return e.prototype._isSynchronized.call(this)?this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent():!1},i.prototype._isSynchronizedProjectionMatrix=function(){var r=this._cache.mode===this.mode&&this._cache.minZ===this.minZ&&this._cache.maxZ===this.maxZ;if(!r)return!1;var o=this.getEngine();return this.mode===i.PERSPECTIVE_CAMERA?r=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===o.getAspectRatio(this):r=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===o.getRenderWidth()&&this._cache.renderHeight===o.getRenderHeight(),r},i.prototype.attachControl=function(r,o){},i.prototype.detachControl=function(r){},i.prototype.update=function(){this._checkInputs(),this.cameraRigMode!==i.RIG_MODE_NONE&&this._updateRigCameras()},i.prototype._checkInputs=function(){this.onAfterCheckInputsObservable.notifyObservers(this)},Object.defineProperty(i.prototype,"rigCameras",{get:function(){return this._rigCameras},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rigPostProcess",{get:function(){return this._rigPostProcess},enumerable:!1,configurable:!0}),i.prototype._getFirstPostProcess=function(){for(var r=0;r<this._postProcesses.length;r++)if(this._postProcesses[r]!==null)return this._postProcesses[r];return null},i.prototype._cascadePostProcessesToRigCams=function(){var r=this._getFirstPostProcess();r&&r.markTextureDirty();for(var o=0,g=this._rigCameras.length;o<g;o++){var y=this._rigCameras[o],v=y._rigPostProcess;if(v){var f=v.getEffectName()==="pass";f&&(y.isIntermediate=this._postProcesses.length===0),y._postProcesses=this._postProcesses.slice(0).concat(v),v.markTextureDirty()}else y._postProcesses=this._postProcesses.slice(0)}},i.prototype.attachPostProcess=function(r,o){return o===void 0&&(o=null),!r.isReusable()&&this._postProcesses.indexOf(r)>-1?(s.a.Error("You're trying to reuse a post process not defined as reusable."),0):(o==null||o<0?this._postProcesses.push(r):this._postProcesses[o]===null?this._postProcesses[o]=r:this._postProcesses.splice(o,0,r),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._postProcesses.indexOf(r))},i.prototype.detachPostProcess=function(r){var o=this._postProcesses.indexOf(r);o!==-1&&(this._postProcesses[o]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.markAsDirty(),this._cascadePostProcessesToRigCams()},i.prototype.getWorldMatrix=function(){return this._isSynchronizedViewMatrix()?this._worldMatrix:(this.getViewMatrix(),this._worldMatrix)},i.prototype._getViewMatrix=function(){return a.a.Identity()},i.prototype.getViewMatrix=function(r){return!r&&this._isSynchronizedViewMatrix()?this._computedViewMatrix:(this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.getScene().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix),this._computedViewMatrix)},i.prototype.freezeProjectionMatrix=function(r){this._doNotComputeProjectionMatrix=!0,r!==void 0&&(this._projectionMatrix=r)},i.prototype.unfreezeProjectionMatrix=function(){this._doNotComputeProjectionMatrix=!1},i.prototype.getProjectionMatrix=function(r){var o,g,y,v,f,b,T,E;if(this._doNotComputeProjectionMatrix||!r&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.minZ=this.minZ,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;var O=this.getEngine(),D=this.getScene();if(this.mode===i.PERSPECTIVE_CAMERA){this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=O.getAspectRatio(this),this.minZ<=0&&(this.minZ=.1);var F=O.useReverseDepthBuffer,x=void 0;D.useRightHandedSystem?x=F?a.a.PerspectiveFovReverseRHToRef:a.a.PerspectiveFovRHToRef:x=F?a.a.PerspectiveFovReverseLHToRef:a.a.PerspectiveFovLHToRef,x(this.fov,O.getAspectRatio(this),this.minZ,this.maxZ,this._projectionMatrix,this.fovMode===i.FOVMODE_VERTICAL_FIXED)}else{var j=O.getRenderWidth()/2,V=O.getRenderHeight()/2;D.useRightHandedSystem?a.a.OrthoOffCenterRHToRef((o=this.orthoLeft)!==null&&o!==void 0?o:-j,(g=this.orthoRight)!==null&&g!==void 0?g:j,(y=this.orthoBottom)!==null&&y!==void 0?y:-V,(v=this.orthoTop)!==null&&v!==void 0?v:V,this.minZ,this.maxZ,this._projectionMatrix):a.a.OrthoOffCenterLHToRef((f=this.orthoLeft)!==null&&f!==void 0?f:-j,(b=this.orthoRight)!==null&&b!==void 0?b:j,(T=this.orthoBottom)!==null&&T!==void 0?T:-V,(E=this.orthoTop)!==null&&E!==void 0?E:V,this.minZ,this.maxZ,this._projectionMatrix),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.renderWidth=O.getRenderWidth(),this._cache.renderHeight=O.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix},i.prototype.getTransformationMatrix=function(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix},i.prototype._updateFrustumPlanes=function(){!this._refreshFrustumPlanes||(this.getTransformationMatrix(),this._frustumPlanes?h.a.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=h.a.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)},i.prototype.isInFrustum=function(r,o){if(o===void 0&&(o=!1),this._updateFrustumPlanes(),o&&this.rigCameras.length>0){var g=!1;return this.rigCameras.forEach(function(y){y._updateFrustumPlanes(),g=g||r.isInFrustum(y._frustumPlanes)}),g}else return r.isInFrustum(this._frustumPlanes)},i.prototype.isCompletelyInFrustum=function(r){return this._updateFrustumPlanes(),r.isCompletelyInFrustum(this._frustumPlanes)},i.prototype.getForwardRay=function(r,o,g){throw r===void 0&&(r=100),p.a.WarnImport("Ray")},i.prototype.getForwardRayToRef=function(r,o,g,y){throw o===void 0&&(o=100),p.a.WarnImport("Ray")},i.prototype.dispose=function(r,o){for(o===void 0&&(o=!1),this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.getScene().stopAnimation(this),this.getScene().removeCamera(this);this._rigCameras.length>0;){var g=this._rigCameras.pop();g&&g.dispose()}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses=[];else if(this.cameraRigMode!==i.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses=[];else for(var v=this._postProcesses.length;--v>=0;){var y=this._postProcesses[v];y&&y.dispose(this)}for(var v=this.customRenderTargets.length;--v>=0;)this.customRenderTargets[v].dispose();this.customRenderTargets=[],this._activeMeshes.dispose(),e.prototype.dispose.call(this,r,o)},Object.defineProperty(i.prototype,"isLeftCamera",{get:function(){return this._isLeftCamera},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isRightCamera",{get:function(){return this._isRightCamera},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"leftCamera",{get:function(){return this._rigCameras.length<1?null:this._rigCameras[0]},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rightCamera",{get:function(){return this._rigCameras.length<2?null:this._rigCameras[1]},enumerable:!1,configurable:!0}),i.prototype.getLeftTarget=function(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()},i.prototype.getRightTarget=function(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()},i.prototype.setCameraRigMode=function(r,o){if(this.cameraRigMode!==r){for(;this._rigCameras.length>0;){var g=this._rigCameras.pop();g&&g.dispose()}if(this.cameraRigMode=r,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=o.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=n.b.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==i.RIG_MODE_NONE){var y=this.createRigCamera(this.name+"_L",0);y&&(y._isLeftCamera=!0);var v=this.createRigCamera(this.name+"_R",1);v&&(v._isRightCamera=!0),y&&v&&(this._rigCameras.push(y),this._rigCameras.push(v))}switch(this.cameraRigMode){case i.RIG_MODE_STEREOSCOPIC_ANAGLYPH:i._setStereoscopicAnaglyphRigMode(this);break;case i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case i.RIG_MODE_STEREOSCOPIC_OVERUNDER:case i.RIG_MODE_STEREOSCOPIC_INTERLACED:i._setStereoscopicRigMode(this);break;case i.RIG_MODE_VR:i._setVRRigMode(this,o);break;case i.RIG_MODE_WEBVR:i._setWebVRRigMode(this,o);break}this._cascadePostProcessesToRigCams(),this.update()}},i._setStereoscopicRigMode=function(r){throw"Import Cameras/RigModes/stereoscopicRigMode before using stereoscopic rig mode"},i._setStereoscopicAnaglyphRigMode=function(r){throw"Import Cameras/RigModes/stereoscopicAnaglyphRigMode before using stereoscopic anaglyph rig mode"},i._setVRRigMode=function(r,o){throw"Import Cameras/RigModes/vrRigMode before using VR rig mode"},i._setWebVRRigMode=function(r,o){throw"Import Cameras/RigModes/WebVRRigMode before using Web VR rig mode"},i.prototype._getVRProjectionMatrix=function(){return a.a.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.minZ,this.maxZ,this._cameraRigParams.vrWorkMatrix),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix},i.prototype._updateCameraRotationMatrix=function(){},i.prototype._updateWebVRCameraRotationMatrix=function(){},i.prototype._getWebVRProjectionMatrix=function(){return a.a.Identity()},i.prototype._getWebVRViewMatrix=function(){return a.a.Identity()},i.prototype.setCameraRigParameter=function(r,o){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[r]=o,r==="interaxialDistance"&&(this._cameraRigParams.stereoHalfAngle=n.b.ToRadians(o/.0637))},i.prototype.createRigCamera=function(r,o){return null},i.prototype._updateRigCameras=function(){for(var r=0;r<this._rigCameras.length;r++)this._rigCameras[r].minZ=this.minZ,this._rigCameras[r].maxZ=this.maxZ,this._rigCameras[r].fov=this.fov,this._rigCameras[r].upVector.copyFrom(this.upVector);this.cameraRigMode===i.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)},i.prototype._setupInputs=function(){},i.prototype.serialize=function(){var r=d.a.Serialize(this);return r.type=this.getClassName(),this.parent&&(r.parentId=this.parent.id),this.inputs&&this.inputs.serialize(r),d.a.AppendSerializedAnimations(this,r),r.ranges=this.serializeAnimationRanges(),r},i.prototype.clone=function(r){return d.a.Clone(i.GetConstructorFromName(this.getClassName(),r,this.getScene(),this.interaxialDistance,this.isStereoscopicSideBySide),this)},i.prototype.getDirection=function(r){var o=a.e.Zero();return this.getDirectionToRef(r,o),o},Object.defineProperty(i.prototype,"absoluteRotation",{get:function(){var r=a.b.Zero();return this.getWorldMatrix().decompose(void 0,r),r},enumerable:!1,configurable:!0}),i.prototype.getDirectionToRef=function(r,o){a.e.TransformNormalToRef(r,this.getWorldMatrix(),o)},i.GetConstructorFromName=function(r,o,g,y,v){y===void 0&&(y=0),v===void 0&&(v=!0);var f=_.a.Construct(r,o,g,{interaxial_distance:y,isStereoscopicSideBySide:v});return f||function(){return i._createDefaultParsedCamera(o,g)}},i.prototype.computeWorldMatrix=function(){return this.getWorldMatrix()},i.Parse=function(r,o){var g=r.type,y=i.GetConstructorFromName(g,r.name,o,r.interaxial_distance,r.isStereoscopicSideBySide),v=d.a.Parse(y,r,o);if(r.parentId&&(v._waitingParentId=r.parentId),v.inputs&&(v.inputs.parse(r),v._setupInputs()),r.upVector&&(v.upVector=a.e.FromArray(r.upVector)),v.setPosition&&(v.position.copyFromFloats(0,0,0),v.setPosition(a.e.FromArray(r.position))),r.target&&v.setTarget&&v.setTarget(a.e.FromArray(r.target)),r.cameraRigMode){var f=r.interaxial_distance?{interaxialDistance:r.interaxial_distance}:{};v.setCameraRigMode(r.cameraRigMode,f)}if(r.animations){for(var b=0;b<r.animations.length;b++){var T=r.animations[b],E=u.a.GetClass("BABYLON.Animation");E&&v.animations.push(E.Parse(T))}_.a.ParseAnimationRanges(v,r,o)}return r.autoAnimate&&o.beginAnimation(v,r.autoAnimateFrom,r.autoAnimateTo,r.autoAnimateLoop,r.autoAnimateSpeed||1),v},i._createDefaultParsedCamera=function(r,o){throw p.a.WarnImport("UniversalCamera")},i.PERSPECTIVE_CAMERA=0,i.ORTHOGRAPHIC_CAMERA=1,i.FOVMODE_VERTICAL_FIXED=0,i.FOVMODE_HORIZONTAL_FIXED=1,i.RIG_MODE_NONE=0,i.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,i.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,i.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,i.RIG_MODE_STEREOSCOPIC_INTERLACED=14,i.RIG_MODE_VR=20,i.RIG_MODE_WEBVR=21,i.RIG_MODE_CUSTOM=22,i.ForceAttachControlToAlwaysPreventDefault=!1,Object(P.c)([Object(d.o)("position")],i.prototype,"_position",void 0),Object(P.c)([Object(d.o)("upVector")],i.prototype,"_upVector",void 0),Object(P.c)([Object(d.c)()],i.prototype,"orthoLeft",void 0),Object(P.c)([Object(d.c)()],i.prototype,"orthoRight",void 0),Object(P.c)([Object(d.c)()],i.prototype,"orthoBottom",void 0),Object(P.c)([Object(d.c)()],i.prototype,"orthoTop",void 0),Object(P.c)([Object(d.c)()],i.prototype,"fov",void 0),Object(P.c)([Object(d.c)()],i.prototype,"minZ",void 0),Object(P.c)([Object(d.c)()],i.prototype,"maxZ",void 0),Object(P.c)([Object(d.c)()],i.prototype,"inertia",void 0),Object(P.c)([Object(d.c)()],i.prototype,"mode",void 0),Object(P.c)([Object(d.c)()],i.prototype,"layerMask",void 0),Object(P.c)([Object(d.c)()],i.prototype,"fovMode",void 0),Object(P.c)([Object(d.c)()],i.prototype,"cameraRigMode",void 0),Object(P.c)([Object(d.c)()],i.prototype,"interaxialDistance",void 0),Object(P.c)([Object(d.c)()],i.prototype,"isStereoscopicSideBySide",void 0),i}(_.a)},function($,W,M){"use strict";M.d(W,"a",function(){return d}),M.d(W,"b",function(){return m});var P=M(434),d=function(){function n(){}return n.NAME_EFFECTLAYER="EffectLayer",n.NAME_LAYER="Layer",n.NAME_LENSFLARESYSTEM="LensFlareSystem",n.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",n.NAME_PARTICLESYSTEM="ParticleSystem",n.NAME_GAMEPAD="Gamepad",n.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",n.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",n.NAME_PREPASSRENDERER="PrePassRenderer",n.NAME_DEPTHRENDERER="DepthRenderer",n.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",n.NAME_SPRITE="Sprite",n.NAME_SUBSURFACE="SubSurface",n.NAME_OUTLINERENDERER="Outline",n.NAME_PROCEDURALTEXTURE="ProceduralTexture",n.NAME_SHADOWGENERATOR="ShadowGenerator",n.NAME_OCTREE="Octree",n.NAME_PHYSICSENGINE="PhysicsEngine",n.NAME_AUDIO="Audio",n.STEP_ISREADYFORMESH_EFFECTLAYER=0,n.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,n.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,n.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,n.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,n.STEP_BEFORECAMERADRAW_PREPASS=0,n.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,n.STEP_BEFORECAMERADRAW_LAYER=2,n.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,n.STEP_BEFORERENDERTARGETDRAW_LAYER=1,n.STEP_BEFORERENDERINGMESH_PREPASS=0,n.STEP_BEFORERENDERINGMESH_OUTLINE=1,n.STEP_AFTERRENDERINGMESH_PREPASS=0,n.STEP_AFTERRENDERINGMESH_OUTLINE=1,n.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,n.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,n.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,n.STEP_BEFORECAMERAUPDATE_GAMEPAD=1,n.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,n.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,n.STEP_AFTERRENDERTARGETDRAW_LAYER=1,n.STEP_AFTERCAMERADRAW_PREPASS=0,n.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,n.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,n.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,n.STEP_AFTERCAMERADRAW_LAYER=4,n.STEP_AFTERRENDER_AUDIO=0,n.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,n.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,n.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,n.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,n.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,n.STEP_BEFORECLEARSTAGE_PREPASS=0,n.STEP_BEFORERENDERTARGETCLEARSTAGE_PREPASS=0,n.STEP_POINTERMOVE_SPRITE=0,n.STEP_POINTERDOWN_SPRITE=0,n.STEP_POINTERUP_SPRITE=0,n}(),m=function(n){Object(P.d)(c,n);function c(a){return n.apply(this,a)||this}return c.Create=function(){return Object.create(c.prototype)},c.prototype.registerStep=function(a,_,s){for(var u=0,p=Number.MAX_VALUE;u<this.length;u++){var l=this[u];if(p=l.index,a<p)break}this.splice(u,0,{index:a,component:_,action:s.bind(_)})},c.prototype.clear=function(){this.length=0},c}(Array)},function($,W,M){"use strict";M.d(W,"a",function(){return _});var P=M(434),d=M(436),m=M(439),n=M(438),c=M(448),a=M(476),_=function(){function s(u,p){p===void 0&&(p=null),this.state="",this.metadata=null,this.reservedDataStore=null,this._doNotSerialize=!1,this._isDisposed=!1,this.animations=new Array,this._ranges={},this.onReady=null,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=d.a.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._sceneRootNodesIndex=-1,this._animationPropertiesOverride=null,this._isNode=!0,this.onDisposeObservable=new n.c,this._onDisposeObserver=null,this._behaviors=new Array,this.name=u,this.id=u,this._scene=p||c.a.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache()}return s.AddNodeConstructor=function(u,p){this._NodeConstructors[u]=p},s.Construct=function(u,p,l,h){var t=this._NodeConstructors[u];return t?t(p,l,h):null},Object.defineProperty(s.prototype,"doNotSerialize",{get:function(){return this._doNotSerialize?!0:this._parentNode?this._parentNode.doNotSerialize:!1},set:function(u){this._doNotSerialize=u},enumerable:!1,configurable:!0}),s.prototype.isDisposed=function(){return this._isDisposed},Object.defineProperty(s.prototype,"parent",{get:function(){return this._parentNode},set:function(u){if(this._parentNode!==u){var p=this._parentNode;if(this._parentNode&&this._parentNode._children!==void 0&&this._parentNode._children!==null){var l=this._parentNode._children.indexOf(this);l!==-1&&this._parentNode._children.splice(l,1),!u&&!this._isDisposed&&this._addToSceneRootNodes()}this._parentNode=u,this._parentNode&&((this._parentNode._children===void 0||this._parentNode._children===null)&&(this._parentNode._children=new Array),this._parentNode._children.push(this),p||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}},enumerable:!1,configurable:!0}),s.prototype._addToSceneRootNodes=function(){this._sceneRootNodesIndex===-1&&(this._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))},s.prototype._removeFromSceneRootNodes=function(){if(this._sceneRootNodesIndex!==-1){var u=this._scene.rootNodes,p=u.length-1;u[this._sceneRootNodesIndex]=u[p],u[this._sceneRootNodesIndex]._sceneRootNodesIndex=this._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._sceneRootNodesIndex=-1}},Object.defineProperty(s.prototype,"animationPropertiesOverride",{get:function(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride},set:function(u){this._animationPropertiesOverride=u},enumerable:!1,configurable:!0}),s.prototype.getClassName=function(){return"Node"},Object.defineProperty(s.prototype,"onDispose",{set:function(u){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(u)},enumerable:!1,configurable:!0}),s.prototype.getScene=function(){return this._scene},s.prototype.getEngine=function(){return this._scene.getEngine()},s.prototype.addBehavior=function(u,p){var l=this;p===void 0&&(p=!1);var h=this._behaviors.indexOf(u);return h!==-1?this:(u.init(),this._scene.isLoading&&!p?this._scene.onDataLoadedObservable.addOnce(function(){u.attach(l)}):u.attach(this),this._behaviors.push(u),this)},s.prototype.removeBehavior=function(u){var p=this._behaviors.indexOf(u);return p===-1?this:(this._behaviors[p].detach(),this._behaviors.splice(p,1),this)},Object.defineProperty(s.prototype,"behaviors",{get:function(){return this._behaviors},enumerable:!1,configurable:!0}),s.prototype.getBehaviorByName=function(u){for(var p=0,l=this._behaviors;p<l.length;p++){var h=l[p];if(h.name===u)return h}return null},s.prototype.getWorldMatrix=function(){return this._currentRenderId!==this._scene.getRenderId()&&this.computeWorldMatrix(),this._worldMatrix},s.prototype._getWorldMatrixDeterminant=function(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant},Object.defineProperty(s.prototype,"worldMatrixFromCache",{get:function(){return this._worldMatrix},enumerable:!1,configurable:!0}),s.prototype._initCache=function(){this._cache={},this._cache.parent=void 0},s.prototype.updateCache=function(u){!u&&this.isSynchronized()||(this._cache.parent=this.parent,this._updateCache())},s.prototype._getActionManagerForTrigger=function(u,p){return p===void 0&&(p=!0),this.parent?this.parent._getActionManagerForTrigger(u,!1):null},s.prototype._updateCache=function(u){},s.prototype._isSynchronized=function(){return!0},s.prototype._markSyncedWithParent=function(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)},s.prototype.isSynchronizedWithParent=function(){return this._parentNode?this._parentUpdateId!==this._parentNode._childUpdateId?!1:this._parentNode.isSynchronized():!0},s.prototype.isSynchronized=function(){return this._cache.parent!=this._parentNode?(this._cache.parent=this._parentNode,!1):this._parentNode&&!this.isSynchronizedWithParent()?!1:this._isSynchronized()},s.prototype.isReady=function(u){return u===void 0&&(u=!1),this._isReady},s.prototype.isEnabled=function(u){return u===void 0&&(u=!0),u===!1?this._isEnabled:this._isEnabled?this._isParentEnabled:!1},s.prototype._syncParentEnabledState=function(){this._isParentEnabled=this._parentNode?this._parentNode.isEnabled():!0,this._children&&this._children.forEach(function(u){u._syncParentEnabledState()})},s.prototype.setEnabled=function(u){this._isEnabled=u,this._syncParentEnabledState()},s.prototype.isDescendantOf=function(u){return this.parent?this.parent===u?!0:this.parent.isDescendantOf(u):!1},s.prototype._getDescendants=function(u,p,l){if(p===void 0&&(p=!1),!!this._children)for(var h=0;h<this._children.length;h++){var t=this._children[h];(!l||l(t))&&u.push(t),p||t._getDescendants(u,!1,l)}},s.prototype.getDescendants=function(u,p){var l=new Array;return this._getDescendants(l,u,p),l},s.prototype.getChildMeshes=function(u,p){var l=[];return this._getDescendants(l,u,function(h){return(!p||p(h))&&h.cullingStrategy!==void 0}),l},s.prototype.getChildren=function(u,p){return p===void 0&&(p=!0),this.getDescendants(p,u)},s.prototype._setReady=function(u){if(u!==this._isReady){if(!u){this._isReady=!1;return}this.onReady&&this.onReady(this),this._isReady=!0}},s.prototype.getAnimationByName=function(u){for(var p=0;p<this.animations.length;p++){var l=this.animations[p];if(l.name===u)return l}return null},s.prototype.createAnimationRange=function(u,p,l){if(!this._ranges[u]){this._ranges[u]=s._AnimationRangeFactory(u,p,l);for(var h=0,t=this.animations.length;h<t;h++)this.animations[h]&&this.animations[h].createRange(u,p,l)}},s.prototype.deleteAnimationRange=function(u,p){p===void 0&&(p=!0);for(var l=0,h=this.animations.length;l<h;l++)this.animations[l]&&this.animations[l].deleteRange(u,p);this._ranges[u]=null},s.prototype.getAnimationRange=function(u){return this._ranges[u]||null},s.prototype.getAnimationRanges=function(){var u=[],p;for(p in this._ranges)u.push(this._ranges[p]);return u},s.prototype.beginAnimation=function(u,p,l,h){var t=this.getAnimationRange(u);return t?this._scene.beginAnimation(this,t.from,t.to,p,l,h):null},s.prototype.serializeAnimationRanges=function(){var u=[];for(var p in this._ranges){var l=this._ranges[p];if(!!l){var h={};h.name=p,h.from=l.from,h.to=l.to,u.push(h)}}return u},s.prototype.computeWorldMatrix=function(u){return this._worldMatrix||(this._worldMatrix=d.a.Identity()),this._worldMatrix},s.prototype.dispose=function(u,p){if(p===void 0&&(p=!1),this._isDisposed=!0,!u)for(var l=this.getDescendants(!0),h=0,t=l;h<t.length;h++){var e=t[h];e.dispose(u,p)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear();for(var i=0,r=this._behaviors;i<r.length;i++){var o=r[i];o.detach()}this._behaviors=[]},s.ParseAnimationRanges=function(u,p,l){if(p.ranges)for(var h=0;h<p.ranges.length;h++){var t=p.ranges[h];u.createAnimationRange(t.name,t.from,t.to)}},s.prototype.getHierarchyBoundingVectors=function(u,p){u===void 0&&(u=!0),p===void 0&&(p=null),this.getScene().incrementRenderId(),this.computeWorldMatrix(!0);var l,h,t=this;if(t.getBoundingInfo&&t.subMeshes){var e=t.getBoundingInfo();l=e.boundingBox.minimumWorld.clone(),h=e.boundingBox.maximumWorld.clone()}else l=new d.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),h=new d.e(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(u)for(var i=this.getDescendants(!1),r=0,o=i;r<o.length;r++){var g=o[r],y=g;if(y.computeWorldMatrix(!0),!(p&&!p(y))&&!(!y.getBoundingInfo||y.getTotalVertices()===0)){var v=y.getBoundingInfo(),f=v.boundingBox,b=f.minimumWorld,T=f.maximumWorld;d.e.CheckExtends(b,l,h),d.e.CheckExtends(T,l,h)}}return{min:l,max:h}},s._AnimationRangeFactory=function(u,p,l){throw a.a.WarnImport("AnimationRange")},s._NodeConstructors={},Object(P.c)([Object(m.c)()],s.prototype,"name",void 0),Object(P.c)([Object(m.c)()],s.prototype,"id",void 0),Object(P.c)([Object(m.c)()],s.prototype,"uniqueId",void 0),Object(P.c)([Object(m.c)()],s.prototype,"state",void 0),Object(P.c)([Object(m.c)()],s.prototype,"metadata",void 0),s}()},function($,W,M){"use strict";M.d(W,"a",function(){return u});var P=M(440),d=M(449),m=M(448),n=M(447),c=M(484),a=M(441),_=M(690),s=M(436),u=function(){function p(){}return p.BindEyePosition=function(l,h,t,e){var i;t===void 0&&(t="vEyePosition"),e===void 0&&(e=!1);var r=h._forcedViewPosition?h._forcedViewPosition:h._mirroredCameraPosition?h._mirroredCameraPosition:(i=h.activeCamera.globalPosition)!==null&&i!==void 0?i:h.activeCamera.devicePosition,o=h.useRightHandedSystem===(h._mirroredCameraPosition!=null);return s.c.Vector4[0].set(r.x,r.y,r.z,o?-1:1),l&&(e?l.setFloat3(t,s.c.Vector4[0].x,s.c.Vector4[0].y,s.c.Vector4[0].z):l.setVector4(t,s.c.Vector4[0])),s.c.Vector4[0]},p.FinalizeSceneUbo=function(l){var h=l.getSceneUniformBuffer(),t=p.BindEyePosition(null,l);return h.updateFloat4("vEyePosition",t.x,t.y,t.z,t.w),h.update(),h},p.BindSceneUniformBuffer=function(l,h){h.bindToEffect(l,"Scene")},p.PrepareDefinesForMergedUV=function(l,h,t){h._needUVs=!0,h[t]=!0,l.getTextureMatrix().isIdentityAs3x2()?(h[t+"DIRECTUV"]=l.coordinatesIndex+1,l.coordinatesIndex===0?h.MAINUV1=!0:h.MAINUV2=!0):h[t+"DIRECTUV"]=0},p.BindTextureMatrix=function(l,h,t){var e=l.getTextureMatrix();h.updateMatrix(t+"Matrix",e)},p.GetFogState=function(l,h){return h.fogEnabled&&l.applyFog&&h.fogMode!==d.a.FOGMODE_NONE},p.PrepareDefinesForMisc=function(l,h,t,e,i,r,o){o._areMiscDirty&&(o.LOGARITHMICDEPTH=t,o.POINTSIZE=e,o.FOG=i&&this.GetFogState(l,h),o.NONUNIFORMSCALING=l.nonUniformScaling,o.ALPHATEST=r)},p.PrepareDefinesForFrameBoundValues=function(l,h,t,e,i,r){i===void 0&&(i=null),r===void 0&&(r=!1);var o=!1,g=!1,y=!1,v=!1,f=!1,b=!1,T=!1;g=i==null?l.clipPlane!==void 0&&l.clipPlane!==null:i,y=i==null?l.clipPlane2!==void 0&&l.clipPlane2!==null:i,v=i==null?l.clipPlane3!==void 0&&l.clipPlane3!==null:i,f=i==null?l.clipPlane4!==void 0&&l.clipPlane4!==null:i,b=i==null?l.clipPlane5!==void 0&&l.clipPlane5!==null:i,T=i==null?l.clipPlane6!==void 0&&l.clipPlane6!==null:i,t.CLIPPLANE!==g&&(t.CLIPPLANE=g,o=!0),t.CLIPPLANE2!==y&&(t.CLIPPLANE2=y,o=!0),t.CLIPPLANE3!==v&&(t.CLIPPLANE3=v,o=!0),t.CLIPPLANE4!==f&&(t.CLIPPLANE4=f,o=!0),t.CLIPPLANE5!==b&&(t.CLIPPLANE5=b,o=!0),t.CLIPPLANE6!==T&&(t.CLIPPLANE6=T,o=!0),t.DEPTHPREPASS!==!h.getColorWrite()&&(t.DEPTHPREPASS=!t.DEPTHPREPASS,o=!0),t.INSTANCES!==e&&(t.INSTANCES=e,o=!0),t.THIN_INSTANCES!==r&&(t.THIN_INSTANCES=r,o=!0),o&&t.markAsUnprocessed()},p.PrepareDefinesForBones=function(l,h){if(l.useBones&&l.computeBonesUsingShaders&&l.skeleton){h.NUM_BONE_INFLUENCERS=l.numBoneInfluencers;var t=h.BONETEXTURE!==void 0;if(l.skeleton.isUsingTextureForMatrices&&t)h.BONETEXTURE=!0;else{h.BonesPerMesh=l.skeleton.bones.length+1,h.BONETEXTURE=t?!1:void 0;var e=l.getScene().prePassRenderer;if(e&&e.enabled){var i=e.excludedSkinnedMesh.indexOf(l)===-1;h.BONES_VELOCITY_ENABLED=i}}}else h.NUM_BONE_INFLUENCERS=0,h.BonesPerMesh=0},p.PrepareDefinesForMorphTargets=function(l,h){var t=l.morphTargetManager;t?(h.MORPHTARGETS_UV=t.supportsUVs&&h.UV1,h.MORPHTARGETS_TANGENT=t.supportsTangents&&h.TANGENT,h.MORPHTARGETS_NORMAL=t.supportsNormals&&h.NORMAL,h.MORPHTARGETS=t.numInfluencers>0,h.NUM_MORPH_INFLUENCERS=t.numInfluencers,h.MORPHTARGETS_TEXTURE=t.isUsingTextureForTargets):(h.MORPHTARGETS_UV=!1,h.MORPHTARGETS_TANGENT=!1,h.MORPHTARGETS_NORMAL=!1,h.MORPHTARGETS=!1,h.NUM_MORPH_INFLUENCERS=0)},p.PrepareDefinesForAttributes=function(l,h,t,e,i,r){if(i===void 0&&(i=!1),r===void 0&&(r=!0),!h._areAttributesDirty&&h._needNormals===h._normals&&h._needUVs===h._uvs)return!1;if(h._normals=h._needNormals,h._uvs=h._needUVs,h.NORMAL=h._needNormals&&l.isVerticesDataPresent(n.b.NormalKind),h._needNormals&&l.isVerticesDataPresent(n.b.TangentKind)&&(h.TANGENT=!0),h._needUVs?(h.UV1=l.isVerticesDataPresent(n.b.UVKind),h.UV2=l.isVerticesDataPresent(n.b.UV2Kind)):(h.UV1=!1,h.UV2=!1),t){var o=l.useVertexColors&&l.isVerticesDataPresent(n.b.ColorKind);h.VERTEXCOLOR=o,h.VERTEXALPHA=l.hasVertexAlpha&&o&&r}return e&&this.PrepareDefinesForBones(l,h),i&&this.PrepareDefinesForMorphTargets(l,h),!0},p.PrepareDefinesForMultiview=function(l,h){if(l.activeCamera){var t=h.MULTIVIEW;h.MULTIVIEW=l.activeCamera.outputRenderTarget!==null&&l.activeCamera.outputRenderTarget.getViewCount()>1,h.MULTIVIEW!=t&&h.markAsUnprocessed()}},p.PrepareDefinesForPrePass=function(l,h,t){var e=h.PREPASS;if(!!h._arePrePassDirty){var i=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO",index:"PREPASS_ALBEDO_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"}];if(l.prePassRenderer&&l.prePassRenderer.enabled&&t){h.PREPASS=!0,h.SCENE_MRT_COUNT=l.prePassRenderer.mrtCount;for(var r=0;r<i.length;r++){var o=l.prePassRenderer.getIndex(i[r].type);o!==-1?(h[i[r].define]=!0,h[i[r].index]=o):h[i[r].define]=!1}}else{h.PREPASS=!1;for(var r=0;r<i.length;r++)h[i[r].define]=!1}h.PREPASS!=e&&(h.markAsUnprocessed(),h.markAsImageProcessingDirty())}},p.PrepareDefinesForLight=function(l,h,t,e,i,r,o){switch(o.needNormals=!0,i["LIGHT"+e]===void 0&&(o.needRebuild=!0),i["LIGHT"+e]=!0,i["SPOTLIGHT"+e]=!1,i["HEMILIGHT"+e]=!1,i["POINTLIGHT"+e]=!1,i["DIRLIGHT"+e]=!1,t.prepareLightSpecificDefines(i,e),i["LIGHT_FALLOFF_PHYSICAL"+e]=!1,i["LIGHT_FALLOFF_GLTF"+e]=!1,i["LIGHT_FALLOFF_STANDARD"+e]=!1,t.falloffType){case c.a.FALLOFF_GLTF:i["LIGHT_FALLOFF_GLTF"+e]=!0;break;case c.a.FALLOFF_PHYSICAL:i["LIGHT_FALLOFF_PHYSICAL"+e]=!0;break;case c.a.FALLOFF_STANDARD:i["LIGHT_FALLOFF_STANDARD"+e]=!0;break}if(r&&!t.specular.equalsFloats(0,0,0)&&(o.specularEnabled=!0),i["SHADOW"+e]=!1,i["SHADOWCSM"+e]=!1,i["SHADOWCSMDEBUG"+e]=!1,i["SHADOWCSMNUM_CASCADES"+e]=!1,i["SHADOWCSMUSESHADOWMAXZ"+e]=!1,i["SHADOWCSMNOBLEND"+e]=!1,i["SHADOWCSM_RIGHTHANDED"+e]=!1,i["SHADOWPCF"+e]=!1,i["SHADOWPCSS"+e]=!1,i["SHADOWPOISSON"+e]=!1,i["SHADOWESM"+e]=!1,i["SHADOWCLOSEESM"+e]=!1,i["SHADOWCUBE"+e]=!1,i["SHADOWLOWQUALITY"+e]=!1,i["SHADOWMEDIUMQUALITY"+e]=!1,h&&h.receiveShadows&&l.shadowsEnabled&&t.shadowEnabled){var g=t.getShadowGenerator();if(g){var y=g.getShadowMap();y&&y.renderList&&y.renderList.length>0&&(o.shadowEnabled=!0,g.prepareDefines(i,e))}}t.lightmapMode!=c.a.LIGHTMAP_DEFAULT?(o.lightmapMode=!0,i["LIGHTMAPEXCLUDED"+e]=!0,i["LIGHTMAPNOSPECULAR"+e]=t.lightmapMode==c.a.LIGHTMAP_SHADOWSONLY):(i["LIGHTMAPEXCLUDED"+e]=!1,i["LIGHTMAPNOSPECULAR"+e]=!1)},p.PrepareDefinesForLights=function(l,h,t,e,i,r){if(i===void 0&&(i=4),r===void 0&&(r=!1),!t._areLightsDirty)return t._needNormals;var o=0,g={needNormals:!1,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(l.lightsEnabled&&!r)for(var y=0,v=h.lightSources;y<v.length;y++){var f=v[y];if(this.PrepareDefinesForLight(l,h,f,o,t,e,g),o++,o===i)break}t.SPECULARTERM=g.specularEnabled,t.SHADOWS=g.shadowEnabled;for(var b=o;b<i;b++)t["LIGHT"+b]!==void 0&&(t["LIGHT"+b]=!1,t["HEMILIGHT"+b]=!1,t["POINTLIGHT"+b]=!1,t["DIRLIGHT"+b]=!1,t["SPOTLIGHT"+b]=!1,t["SHADOW"+b]=!1,t["SHADOWCSM"+b]=!1,t["SHADOWCSMDEBUG"+b]=!1,t["SHADOWCSMNUM_CASCADES"+b]=!1,t["SHADOWCSMUSESHADOWMAXZ"+b]=!1,t["SHADOWCSMNOBLEND"+b]=!1,t["SHADOWCSM_RIGHTHANDED"+b]=!1,t["SHADOWPCF"+b]=!1,t["SHADOWPCSS"+b]=!1,t["SHADOWPOISSON"+b]=!1,t["SHADOWESM"+b]=!1,t["SHADOWCLOSEESM"+b]=!1,t["SHADOWCUBE"+b]=!1,t["SHADOWLOWQUALITY"+b]=!1,t["SHADOWMEDIUMQUALITY"+b]=!1);var T=l.getEngine().getCaps();return t.SHADOWFLOAT===void 0&&(g.needRebuild=!0),t.SHADOWFLOAT=g.shadowEnabled&&(T.textureFloatRender&&T.textureFloatLinearFiltering||T.textureHalfFloatRender&&T.textureHalfFloatLinearFiltering),t.LIGHTMAPEXCLUDED=g.lightmapMode,g.needRebuild&&t.rebuild(),g.needNormals},p.PrepareUniformsAndSamplersForLight=function(l,h,t,e,i,r){i===void 0&&(i=null),r===void 0&&(r=!1),i&&i.push("Light"+l),!r&&(h.push("vLightData"+l,"vLightDiffuse"+l,"vLightSpecular"+l,"vLightDirection"+l,"vLightFalloff"+l,"vLightGround"+l,"lightMatrix"+l,"shadowsInfo"+l,"depthValues"+l),t.push("shadowSampler"+l),t.push("depthSampler"+l),h.push("viewFrustumZ"+l,"cascadeBlendFactor"+l,"lightSizeUVCorrection"+l,"depthCorrection"+l,"penumbraDarkness"+l,"frustumLengths"+l),e&&(t.push("projectionLightSampler"+l),h.push("textureProjectionMatrix"+l)))},p.PrepareUniformsAndSamplersList=function(l,h,t,e){e===void 0&&(e=4);var i,r=null;if(l.uniformsNames){var o=l;i=o.uniformsNames,r=o.uniformBuffersNames,h=o.samplers,t=o.defines,e=o.maxSimultaneousLights||0}else i=l,h||(h=[]);for(var g=0;g<e&&t["LIGHT"+g];g++)this.PrepareUniformsAndSamplersForLight(g,i,h,t["PROJECTEDLIGHTTEXTURE"+g],r);t.NUM_MORPH_INFLUENCERS&&i.push("morphTargetInfluences")},p.HandleFallbacksForShadows=function(l,h,t,e){t===void 0&&(t=4),e===void 0&&(e=0);for(var i=0,r=0;r<t&&l["LIGHT"+r];r++)r>0&&(i=e+r,h.addFallback(i,"LIGHT"+r)),l.SHADOWS||(l["SHADOW"+r]&&h.addFallback(e,"SHADOW"+r),l["SHADOWPCF"+r]&&h.addFallback(e,"SHADOWPCF"+r),l["SHADOWPCSS"+r]&&h.addFallback(e,"SHADOWPCSS"+r),l["SHADOWPOISSON"+r]&&h.addFallback(e,"SHADOWPOISSON"+r),l["SHADOWESM"+r]&&h.addFallback(e,"SHADOWESM"+r),l["SHADOWCLOSEESM"+r]&&h.addFallback(e,"SHADOWCLOSEESM"+r));return i++},p.PrepareAttributesForMorphTargetsInfluencers=function(l,h,t){this._TmpMorphInfluencers.NUM_MORPH_INFLUENCERS=t,this.PrepareAttributesForMorphTargets(l,h,this._TmpMorphInfluencers)},p.PrepareAttributesForMorphTargets=function(l,h,t){var e=t.NUM_MORPH_INFLUENCERS;if(e>0&&m.a.LastCreatedEngine){var i=m.a.LastCreatedEngine.getCaps().maxVertexAttribs,r=h.morphTargetManager;if(r==null?void 0:r.isUsingTextureForTargets)return;for(var o=r&&r.supportsNormals&&t.NORMAL,g=r&&r.supportsTangents&&t.TANGENT,y=r&&r.supportsUVs&&t.UV1,v=0;v<e;v++)l.push(n.b.PositionKind+v),o&&l.push(n.b.NormalKind+v),g&&l.push(n.b.TangentKind+v),y&&l.push(n.b.UVKind+"_"+v),l.length>i&&P.a.Error("Cannot add more vertex attributes for mesh "+h.name)}},p.PrepareAttributesForBones=function(l,h,t,e){t.NUM_BONE_INFLUENCERS>0&&(e.addCPUSkinningFallback(0,h),l.push(n.b.MatricesIndicesKind),l.push(n.b.MatricesWeightsKind),t.NUM_BONE_INFLUENCERS>4&&(l.push(n.b.MatricesIndicesExtraKind),l.push(n.b.MatricesWeightsExtraKind)))},p.PrepareAttributesForInstances=function(l,h){(h.INSTANCES||h.THIN_INSTANCES)&&this.PushAttributesForInstances(l)},p.PushAttributesForInstances=function(l){l.push("world0"),l.push("world1"),l.push("world2"),l.push("world3")},p.BindLightProperties=function(l,h,t){l.transferToEffect(h,t+"")},p.BindLight=function(l,h,t,e,i,r){r===void 0&&(r=!1),l._bindLight(h,t,e,i,r)},p.BindLights=function(l,h,t,e,i,r){i===void 0&&(i=4),r===void 0&&(r=!1);for(var o=Math.min(h.lightSources.length,i),g=0;g<o;g++){var y=h.lightSources[g];this.BindLight(y,g,l,t,typeof e=="boolean"?e:e.SPECULARTERM,r)}},p.BindFogParameters=function(l,h,t,e){e===void 0&&(e=!1),l.fogEnabled&&h.applyFog&&l.fogMode!==d.a.FOGMODE_NONE&&(t.setFloat4("vFogInfos",l.fogMode,l.fogStart,l.fogEnd,l.fogDensity),e?(l.fogColor.toLinearSpaceToRef(this._tempFogColor),t.setColor3("vFogColor",this._tempFogColor)):t.setColor3("vFogColor",l.fogColor))},p.BindBonesParameters=function(l,h,t){if(!(!h||!l)&&(l.computeBonesUsingShaders&&h._bonesComputationForcedToCPU&&(l.computeBonesUsingShaders=!1),l.useBones&&l.computeBonesUsingShaders&&l.skeleton)){var e=l.skeleton;if(e.isUsingTextureForMatrices&&h.getUniformIndex("boneTextureWidth")>-1){var i=e.getTransformMatrixTexture(l);h.setTexture("boneSampler",i),h.setFloat("boneTextureWidth",4*(e.bones.length+1))}else{var r=e.getTransformMatrices(l);r&&(h.setMatrices("mBones",r),t&&l.getScene().prePassRenderer&&l.getScene().prePassRenderer.getIndex(2)&&(t.previousBones[l.uniqueId]&&h.setMatrices("mPreviousBones",t.previousBones[l.uniqueId]),p._CopyBonesTransformationMatrices(r,t.previousBones[l.uniqueId])))}}},p._CopyBonesTransformationMatrices=function(l,h){return h.set(l),h},p.BindMorphTargetParameters=function(l,h){var t=l.morphTargetManager;!l||!t||h.setFloatArray("morphTargetInfluences",t.influences)},p.BindLogDepth=function(l,h,t){l.LOGARITHMICDEPTH&&h.setFloat("logarithmicDepthConstant",2/(Math.log(t.activeCamera.maxZ+1)/Math.LN2))},p.BindClipPlane=function(l,h){_.a.BindClipPlane(l,h)},p._TmpMorphInfluencers={NUM_MORPH_INFLUENCERS:0},p._tempFogColor=a.a.Black(),p}()},function($,W,M){"use strict";M.d(W,"b",function(){return Ve}),M.d(W,"a",function(){return Fe});var P=M(434),d=M(439),m=M(490),n=M(449),c=M(436),a=M(441),_=M(447),s=M(744),u=M(491),p=M(459),l=M(552),h=M(553),t=M(454),e=M(442),i=M(437),r=M(480),o=M(435),g="defaultFragmentDeclaration",y=`uniform vec4 vEyePosition;
uniform vec4 vDiffuseColor;
#ifdef SPECULARTERM
uniform vec4 vSpecularColor;
#endif
uniform vec3 vEmissiveColor;
uniform float visibility;

#ifdef DIFFUSE
uniform vec2 vDiffuseInfos;
#endif
#ifdef AMBIENT
uniform vec2 vAmbientInfos;
#endif
#ifdef OPACITY
uniform vec2 vOpacityInfos;
#endif
#ifdef EMISSIVE
uniform vec2 vEmissiveInfos;
#endif
#ifdef LIGHTMAP
uniform vec2 vLightmapInfos;
#endif
#ifdef BUMP
uniform vec3 vBumpInfos;
uniform vec2 vTangentSpaceParams;
#endif
#if defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_PROJECTION) || defined(REFRACTION)
uniform mat4 view;
#endif
#ifdef REFRACTION
uniform vec4 vRefractionInfos;
#ifndef REFRACTIONMAP_3D
uniform mat4 refractionMatrix;
#endif
#ifdef REFRACTIONFRESNEL
uniform vec4 refractionLeftColor;
uniform vec4 refractionRightColor;
#endif
#endif
#if defined(SPECULAR) && defined(SPECULARTERM)
uniform vec2 vSpecularInfos;
#endif
#ifdef DIFFUSEFRESNEL
uniform vec4 diffuseLeftColor;
uniform vec4 diffuseRightColor;
#endif
#ifdef OPACITYFRESNEL
uniform vec4 opacityParts;
#endif
#ifdef EMISSIVEFRESNEL
uniform vec4 emissiveLeftColor;
uniform vec4 emissiveRightColor;
#endif

#ifdef REFLECTION
uniform vec2 vReflectionInfos;
#if defined(REFLECTIONMAP_PLANAR) || defined(REFLECTIONMAP_CUBIC) || defined(REFLECTIONMAP_PROJECTION) || defined(REFLECTIONMAP_EQUIRECTANGULAR) || defined(REFLECTIONMAP_SPHERICAL) || defined(REFLECTIONMAP_SKYBOX)
uniform mat4 reflectionMatrix;
#endif
#ifndef REFLECTIONMAP_SKYBOX
#if defined(USE_LOCAL_REFLECTIONMAP_CUBIC) && defined(REFLECTIONMAP_CUBIC)
uniform vec3 vReflectionPosition;
uniform vec3 vReflectionSize;
#endif
#endif
#ifdef REFLECTIONFRESNEL
uniform vec4 reflectionLeftColor;
uniform vec4 reflectionRightColor;
#endif
#endif
#ifdef DETAIL
uniform vec4 vDetailInfos;
#endif`;o.a.IncludesShadersStore[g]=y;var v={name:g,shader:y},f=M(674),b=M(745),T="defaultUboDeclaration",E=`layout(std140,column_major) uniform;
uniform Material
{
vec4 diffuseLeftColor;
vec4 diffuseRightColor;
vec4 opacityParts;
vec4 reflectionLeftColor;
vec4 reflectionRightColor;
vec4 refractionLeftColor;
vec4 refractionRightColor;
vec4 emissiveLeftColor;
vec4 emissiveRightColor;
vec2 vDiffuseInfos;
vec2 vAmbientInfos;
vec2 vOpacityInfos;
vec2 vReflectionInfos;
vec3 vReflectionPosition;
vec3 vReflectionSize;
vec2 vEmissiveInfos;
vec2 vLightmapInfos;
vec2 vSpecularInfos;
vec3 vBumpInfos;
mat4 diffuseMatrix;
mat4 ambientMatrix;
mat4 opacityMatrix;
mat4 reflectionMatrix;
mat4 emissiveMatrix;
mat4 lightmapMatrix;
mat4 specularMatrix;
mat4 bumpMatrix;
vec2 vTangentSpaceParams;
float pointSize;
mat4 refractionMatrix;
vec4 vRefractionInfos;
vec4 vSpecularColor;
vec3 vEmissiveColor;
vec4 vDiffuseColor;
vec4 vDetailInfos;
mat4 detailMatrix;
};
#include<sceneUboDeclaration>
#include<meshUboDeclaration>
`;o.a.IncludesShadersStore[T]=E;var O={name:T,shader:E},D=M(746),F=M(457),x=M(650),j=M(651),V=M(729),z=M(652),w=M(762),R=M(653),L=M(524),N=M(525),B=M(614),X=M(615),K=M(592),G=M(558),I=M(597),A=M(550),S=M(616),C=M(747),U=M(654),k=M(701),J=M(655),Y="defaultPixelShader",Z=`#include<__decl__defaultFragment>
#if defined(BUMP) || !defined(NORMAL)
#extension GL_OES_standard_derivatives : enable
#endif
#include<prePassDeclaration>[SCENE_MRT_COUNT]
#define CUSTOM_FRAGMENT_BEGIN
#ifdef LOGARITHMICDEPTH
#extension GL_EXT_frag_depth : enable
#endif

#define RECIPROCAL_PI2 0.15915494
uniform vec3 vAmbientColor;

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2;
#endif

#include<helperFunctions>

#include<__decl__lightFragment>[0..maxSimultaneousLights]
#include<lightsFragmentFunctions>
#include<shadowsFragmentFunctions>

#ifdef DIFFUSE
#if DIFFUSEDIRECTUV == 1
#define vDiffuseUV vMainUV1
#elif DIFFUSEDIRECTUV == 2
#define vDiffuseUV vMainUV2
#else
varying vec2 vDiffuseUV;
#endif
uniform sampler2D diffuseSampler;
#endif
#ifdef AMBIENT
#if AMBIENTDIRECTUV == 1
#define vAmbientUV vMainUV1
#elif AMBIENTDIRECTUV == 2
#define vAmbientUV vMainUV2
#else
varying vec2 vAmbientUV;
#endif
uniform sampler2D ambientSampler;
#endif
#ifdef OPACITY
#if OPACITYDIRECTUV == 1
#define vOpacityUV vMainUV1
#elif OPACITYDIRECTUV == 2
#define vOpacityUV vMainUV2
#else
varying vec2 vOpacityUV;
#endif
uniform sampler2D opacitySampler;
#endif
#ifdef EMISSIVE
#if EMISSIVEDIRECTUV == 1
#define vEmissiveUV vMainUV1
#elif EMISSIVEDIRECTUV == 2
#define vEmissiveUV vMainUV2
#else
varying vec2 vEmissiveUV;
#endif
uniform sampler2D emissiveSampler;
#endif
#ifdef LIGHTMAP
#if LIGHTMAPDIRECTUV == 1
#define vLightmapUV vMainUV1
#elif LIGHTMAPDIRECTUV == 2
#define vLightmapUV vMainUV2
#else
varying vec2 vLightmapUV;
#endif
uniform sampler2D lightmapSampler;
#endif
#ifdef REFRACTION
#ifdef REFRACTIONMAP_3D
uniform samplerCube refractionCubeSampler;
#else
uniform sampler2D refraction2DSampler;
#endif
#endif
#if defined(SPECULAR) && defined(SPECULARTERM)
#if SPECULARDIRECTUV == 1
#define vSpecularUV vMainUV1
#elif SPECULARDIRECTUV == 2
#define vSpecularUV vMainUV2
#else
varying vec2 vSpecularUV;
#endif
uniform sampler2D specularSampler;
#endif
#ifdef ALPHATEST
uniform float alphaCutOff;
#endif

#include<fresnelFunction>

#ifdef REFLECTION
#ifdef REFLECTIONMAP_3D
uniform samplerCube reflectionCubeSampler;
#else
uniform sampler2D reflection2DSampler;
#endif
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#else
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#endif
#include<reflectionFunction>
#endif
#include<imageProcessingDeclaration>
#include<imageProcessingFunctions>
#include<bumpFragmentMainFunctions>
#include<bumpFragmentFunctions>
#include<clipPlaneFragmentDeclaration>
#include<logDepthDeclaration>
#include<fogFragmentDeclaration>
#define CUSTOM_FRAGMENT_DEFINITIONS
void main(void) {
#define CUSTOM_FRAGMENT_MAIN_BEGIN
#include<clipPlaneFragment>
vec3 viewDirectionW=normalize(vEyePosition.xyz-vPositionW);

vec4 baseColor=vec4(1.,1.,1.,1.);
vec3 diffuseColor=vDiffuseColor.rgb;

float alpha=vDiffuseColor.a;

#ifdef NORMAL
vec3 normalW=normalize(vNormalW);
#else
vec3 normalW=normalize(-cross(dFdx(vPositionW),dFdy(vPositionW)));
#endif
#include<bumpFragment>
#ifdef TWOSIDEDLIGHTING
normalW=gl_FrontFacing ? normalW : -normalW;
#endif
#ifdef DIFFUSE
baseColor=texture2D(diffuseSampler,vDiffuseUV+uvOffset);
#if defined(ALPHATEST) && !defined(ALPHATEST_AFTERALLALPHACOMPUTATIONS)
if (baseColor.a<alphaCutOff)
discard;
#endif
#ifdef ALPHAFROMDIFFUSE
alpha*=baseColor.a;
#endif
#define CUSTOM_FRAGMENT_UPDATE_ALPHA
baseColor.rgb*=vDiffuseInfos.y;
#endif
#include<depthPrePass>
#ifdef VERTEXCOLOR
baseColor.rgb*=vColor.rgb;
#endif
#ifdef DETAIL
baseColor.rgb=baseColor.rgb*2.0*mix(0.5,detailColor.r,vDetailInfos.y);
#endif
#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE

vec3 baseAmbientColor=vec3(1.,1.,1.);
#ifdef AMBIENT
baseAmbientColor=texture2D(ambientSampler,vAmbientUV+uvOffset).rgb*vAmbientInfos.y;
#endif
#define CUSTOM_FRAGMENT_BEFORE_LIGHTS

#ifdef SPECULARTERM
float glossiness=vSpecularColor.a;
vec3 specularColor=vSpecularColor.rgb;
#ifdef SPECULAR
vec4 specularMapColor=texture2D(specularSampler,vSpecularUV+uvOffset);
specularColor=specularMapColor.rgb;
#ifdef GLOSSINESS
glossiness=glossiness*specularMapColor.a;
#endif
#endif
#else
float glossiness=0.;
#endif

vec3 diffuseBase=vec3(0.,0.,0.);
lightingInfo info;
#ifdef SPECULARTERM
vec3 specularBase=vec3(0.,0.,0.);
#endif
float shadow=1.;
#ifdef LIGHTMAP
vec4 lightmapColor=texture2D(lightmapSampler,vLightmapUV+uvOffset);
#ifdef RGBDLIGHTMAP
lightmapColor.rgb=fromRGBD(lightmapColor);
#endif
lightmapColor.rgb*=vLightmapInfos.y;
#endif
#include<lightFragment>[0..maxSimultaneousLights]

vec4 refractionColor=vec4(0.,0.,0.,1.);
#ifdef REFRACTION
vec3 refractionVector=normalize(refract(-viewDirectionW,normalW,vRefractionInfos.y));
#ifdef REFRACTIONMAP_3D
refractionVector.y=refractionVector.y*vRefractionInfos.w;
if (dot(refractionVector,viewDirectionW)<1.0) {
refractionColor=textureCube(refractionCubeSampler,refractionVector);
}
#else
vec3 vRefractionUVW=vec3(refractionMatrix*(view*vec4(vPositionW+refractionVector*vRefractionInfos.z,1.0)));
vec2 refractionCoords=vRefractionUVW.xy/vRefractionUVW.z;
refractionCoords.y=1.0-refractionCoords.y;
refractionColor=texture2D(refraction2DSampler,refractionCoords);
#endif
#ifdef RGBDREFRACTION
refractionColor.rgb=fromRGBD(refractionColor);
#endif
#ifdef IS_REFRACTION_LINEAR
refractionColor.rgb=toGammaSpace(refractionColor.rgb);
#endif
refractionColor.rgb*=vRefractionInfos.x;
#endif

vec4 reflectionColor=vec4(0.,0.,0.,1.);
#ifdef REFLECTION
vec3 vReflectionUVW=computeReflectionCoords(vec4(vPositionW,1.0),normalW);
#ifdef REFLECTIONMAP_OPPOSITEZ
vReflectionUVW.z*=-1.0;
#endif
#ifdef REFLECTIONMAP_3D
#ifdef ROUGHNESS
float bias=vReflectionInfos.y;
#ifdef SPECULARTERM
#ifdef SPECULAR
#ifdef GLOSSINESS
bias*=(1.0-specularMapColor.a);
#endif
#endif
#endif
reflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW,bias);
#else
reflectionColor=textureCube(reflectionCubeSampler,vReflectionUVW);
#endif
#else
vec2 coords=vReflectionUVW.xy;
#ifdef REFLECTIONMAP_PROJECTION
coords/=vReflectionUVW.z;
#endif
coords.y=1.0-coords.y;
reflectionColor=texture2D(reflection2DSampler,coords);
#endif
#ifdef RGBDREFLECTION
reflectionColor.rgb=fromRGBD(reflectionColor);
#endif
#ifdef IS_REFLECTION_LINEAR
reflectionColor.rgb=toGammaSpace(reflectionColor.rgb);
#endif
reflectionColor.rgb*=vReflectionInfos.x;
#ifdef REFLECTIONFRESNEL
float reflectionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,reflectionRightColor.a,reflectionLeftColor.a);
#ifdef REFLECTIONFRESNELFROMSPECULAR
#ifdef SPECULARTERM
reflectionColor.rgb*=specularColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;
#else
reflectionColor.rgb*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;
#endif
#else
reflectionColor.rgb*=reflectionLeftColor.rgb*(1.0-reflectionFresnelTerm)+reflectionFresnelTerm*reflectionRightColor.rgb;
#endif
#endif
#endif
#ifdef REFRACTIONFRESNEL
float refractionFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,refractionRightColor.a,refractionLeftColor.a);
refractionColor.rgb*=refractionLeftColor.rgb*(1.0-refractionFresnelTerm)+refractionFresnelTerm*refractionRightColor.rgb;
#endif
#ifdef OPACITY
vec4 opacityMap=texture2D(opacitySampler,vOpacityUV+uvOffset);
#ifdef OPACITYRGB
opacityMap.rgb=opacityMap.rgb*vec3(0.3,0.59,0.11);
alpha*=(opacityMap.x+opacityMap.y+opacityMap.z)* vOpacityInfos.y;
#else
alpha*=opacityMap.a*vOpacityInfos.y;
#endif
#endif
#ifdef VERTEXALPHA
alpha*=vColor.a;
#endif
#ifdef OPACITYFRESNEL
float opacityFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,opacityParts.z,opacityParts.w);
alpha+=opacityParts.x*(1.0-opacityFresnelTerm)+opacityFresnelTerm*opacityParts.y;
#endif
#ifdef ALPHATEST
#ifdef ALPHATEST_AFTERALLALPHACOMPUTATIONS
if (alpha<alphaCutOff)
discard;
#endif
#ifndef ALPHABLEND

alpha=1.0;
#endif
#endif

vec3 emissiveColor=vEmissiveColor;
#ifdef EMISSIVE
emissiveColor+=texture2D(emissiveSampler,vEmissiveUV+uvOffset).rgb*vEmissiveInfos.y;
#endif
#ifdef EMISSIVEFRESNEL
float emissiveFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,emissiveRightColor.a,emissiveLeftColor.a);
emissiveColor*=emissiveLeftColor.rgb*(1.0-emissiveFresnelTerm)+emissiveFresnelTerm*emissiveRightColor.rgb;
#endif

#ifdef DIFFUSEFRESNEL
float diffuseFresnelTerm=computeFresnelTerm(viewDirectionW,normalW,diffuseRightColor.a,diffuseLeftColor.a);
diffuseBase*=diffuseLeftColor.rgb*(1.0-diffuseFresnelTerm)+diffuseFresnelTerm*diffuseRightColor.rgb;
#endif

#ifdef EMISSIVEASILLUMINATION
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;
#else
#ifdef LINKEMISSIVEWITHDIFFUSE
vec3 finalDiffuse=clamp((diffuseBase+emissiveColor)*diffuseColor+vAmbientColor,0.0,1.0)*baseColor.rgb;
#else
vec3 finalDiffuse=clamp(diffuseBase*diffuseColor+emissiveColor+vAmbientColor,0.0,1.0)*baseColor.rgb;
#endif
#endif
#ifdef SPECULARTERM
vec3 finalSpecular=specularBase*specularColor;
#ifdef SPECULAROVERALPHA
alpha=clamp(alpha+dot(finalSpecular,vec3(0.3,0.59,0.11)),0.,1.);
#endif
#else
vec3 finalSpecular=vec3(0.0);
#endif
#ifdef REFLECTIONOVERALPHA
alpha=clamp(alpha+dot(reflectionColor.rgb,vec3(0.3,0.59,0.11)),0.,1.);
#endif

#ifdef EMISSIVEASILLUMINATION
vec4 color=vec4(clamp(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor.rgb+emissiveColor+refractionColor.rgb,0.0,1.0),alpha);
#else
vec4 color=vec4(finalDiffuse*baseAmbientColor+finalSpecular+reflectionColor.rgb+refractionColor.rgb,alpha);
#endif

#ifdef LIGHTMAP
#ifndef LIGHTMAPEXCLUDED
#ifdef USELIGHTMAPASSHADOWMAP
color.rgb*=lightmapColor.rgb;
#else
color.rgb+=lightmapColor.rgb;
#endif
#endif
#endif
#define CUSTOM_FRAGMENT_BEFORE_FOG
color.rgb=max(color.rgb,0.);
#include<logDepthFragment>
#include<fogFragment>


#ifdef IMAGEPROCESSINGPOSTPROCESS
color.rgb=toLinearSpace(color.rgb);
#else
#ifdef IMAGEPROCESSING
color.rgb=toLinearSpace(color.rgb);
color=applyImageProcessing(color);
#endif
#endif
color.a*=visibility;
#ifdef PREMULTIPLYALPHA

color.rgb*=color.a;
#endif
#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR
#ifdef PREPASS
float writeGeometryInfo=color.a>0.4 ? 1.0 : 0.0;
gl_FragData[0]=color;
#ifdef PREPASS_POSITION
gl_FragData[PREPASS_POSITION_INDEX]=vec4(vPositionW,writeGeometryInfo);
#endif
#ifdef PREPASS_VELOCITY
vec2 a=(vCurrentPosition.xy/vCurrentPosition.w)*0.5+0.5;
vec2 b=(vPreviousPosition.xy/vPreviousPosition.w)*0.5+0.5;
vec2 velocity=abs(a-b);
velocity=vec2(pow(velocity.x,1.0/3.0),pow(velocity.y,1.0/3.0))*sign(a-b)*0.5+0.5;
gl_FragData[PREPASS_VELOCITY_INDEX]=vec4(velocity,0.0,writeGeometryInfo);
#endif
#ifdef PREPASS_IRRADIANCE
gl_FragData[PREPASS_IRRADIANCE_INDEX]=vec4(0.0,0.0,0.0,writeGeometryInfo);
#endif
#ifdef PREPASS_DEPTH
gl_FragData[PREPASS_DEPTH_INDEX]=vec4(vViewPos.z,0.0,0.0,writeGeometryInfo);
#endif
#ifdef PREPASS_NORMAL
gl_FragData[PREPASS_NORMAL_INDEX]=vec4((view*vec4(normalW,0.0)).rgb,writeGeometryInfo);
#endif
#ifdef PREPASS_ALBEDO
gl_FragData[PREPASS_ALBEDO_INDEX]=vec4(0.0,0.0,0.0,writeGeometryInfo);
#endif
#ifdef PREPASS_REFLECTIVITY
#if defined(SPECULAR)
gl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(specularMapColor.rgb,writeGeometryInfo);
#else
gl_FragData[PREPASS_REFLECTIVITY_INDEX]=vec4(0.0,0.0,0.0,writeGeometryInfo);
#endif
#endif
#endif
#if !defined(PREPASS) || defined(WEBGL2)
gl_FragColor=color;
#endif
}
`;o.a.ShadersStore[Y]=Z;var Q={name:Y,shader:Z},te="defaultVertexDeclaration",re=`
uniform mat4 world;
uniform mat4 viewProjection;
uniform mat4 view;
#ifdef DIFFUSE
uniform mat4 diffuseMatrix;
uniform vec2 vDiffuseInfos;
#endif
#ifdef AMBIENT
uniform mat4 ambientMatrix;
uniform vec2 vAmbientInfos;
#endif
#ifdef OPACITY
uniform mat4 opacityMatrix;
uniform vec2 vOpacityInfos;
#endif
#ifdef EMISSIVE
uniform vec2 vEmissiveInfos;
uniform mat4 emissiveMatrix;
#endif
#ifdef LIGHTMAP
uniform vec2 vLightmapInfos;
uniform mat4 lightmapMatrix;
#endif
#if defined(SPECULAR) && defined(SPECULARTERM)
uniform vec2 vSpecularInfos;
uniform mat4 specularMatrix;
#endif
#ifdef BUMP
uniform vec3 vBumpInfos;
uniform mat4 bumpMatrix;
#endif
#ifdef REFLECTION
uniform mat4 reflectionMatrix;
#endif
#ifdef POINTSIZE
uniform float pointSize;
#endif
#ifdef DETAIL
uniform vec4 vDetailInfos;
uniform mat4 detailMatrix;
#endif`;o.a.IncludesShadersStore[te]=re;var ae={name:te,shader:re},ne=M(487),ie=M(748),fe=M(749),he=M(593),pe=M(656),ue=M(657),_e=M(658),ge=M(496),Ee=M(497),Te=M(507),Me=M(508),Re=M(488),Ae=M(489),Pe=M(750),Oe=M(675),xe=M(551),Ke=M(702),He=M(659),we="pointCloudVertex",Ue=`#ifdef POINTSIZE
gl_PointSize=pointSize;
#endif`;o.a.IncludesShadersStore[we]=Ue;var ke={name:we,shader:Ue},Ye=M(703),Ne="defaultVertexShader",We=`#include<__decl__defaultVertex>

#define CUSTOM_VERTEX_BEGIN
attribute vec3 position;
#ifdef NORMAL
attribute vec3 normal;
#endif
#ifdef TANGENT
attribute vec4 tangent;
#endif
#ifdef UV1
attribute vec2 uv;
#endif
#ifdef UV2
attribute vec2 uv2;
#endif
#ifdef VERTEXCOLOR
attribute vec4 color;
#endif
#include<helperFunctions>
#include<bonesDeclaration>


#ifdef INSTANCES
attribute vec4 world0;
attribute vec4 world1;
attribute vec4 world2;
attribute vec4 world3;
#endif
#include<prePassVertexDeclaration>
#ifdef MAINUV1
varying vec2 vMainUV1;
#endif
#ifdef MAINUV2
varying vec2 vMainUV2;
#endif
#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0
varying vec2 vDiffuseUV;
#endif
#if defined(DETAIL) && DETAILDIRECTUV == 0
varying vec2 vDetailUV;
#endif
#if defined(AMBIENT) && AMBIENTDIRECTUV == 0
varying vec2 vAmbientUV;
#endif
#if defined(OPACITY) && OPACITYDIRECTUV == 0
varying vec2 vOpacityUV;
#endif
#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0
varying vec2 vEmissiveUV;
#endif
#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0
varying vec2 vLightmapUV;
#endif
#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0
varying vec2 vSpecularUV;
#endif
#if defined(BUMP) && BUMPDIRECTUV == 0
varying vec2 vBumpUV;
#endif

varying vec3 vPositionW;
#ifdef NORMAL
varying vec3 vNormalW;
#endif
#ifdef VERTEXCOLOR
varying vec4 vColor;
#endif
#include<bumpVertexDeclaration>
#include<clipPlaneVertexDeclaration>
#include<fogVertexDeclaration>
#include<__decl__lightVxFragment>[0..maxSimultaneousLights]
#include<morphTargetsVertexGlobalDeclaration>
#include<morphTargetsVertexDeclaration>[0..maxSimultaneousMorphTargets]
#ifdef REFLECTIONMAP_SKYBOX
varying vec3 vPositionUVW;
#endif
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
varying vec3 vDirectionW;
#endif
#include<logDepthDeclaration>
#define CUSTOM_VERTEX_DEFINITIONS
void main(void) {
#define CUSTOM_VERTEX_MAIN_BEGIN
vec3 positionUpdated=position;
#ifdef NORMAL
vec3 normalUpdated=normal;
#endif
#ifdef TANGENT
vec4 tangentUpdated=tangent;
#endif
#ifdef UV1
vec2 uvUpdated=uv;
#endif
#include<morphTargetsVertexGlobal>
#include<morphTargetsVertex>[0..maxSimultaneousMorphTargets]
#ifdef REFLECTIONMAP_SKYBOX
vPositionUVW=positionUpdated;
#endif
#define CUSTOM_VERTEX_UPDATE_POSITION
#define CUSTOM_VERTEX_UPDATE_NORMAL
#include<instancesVertex>
#if defined(PREPASS) && defined(PREPASS_VELOCITY) && !defined(BONES_VELOCITY_ENABLED)

vCurrentPosition=viewProjection*finalWorld*vec4(positionUpdated,1.0);
vPreviousPosition=previousViewProjection*previousWorld*vec4(positionUpdated,1.0);
#endif
#include<bonesVertex>
vec4 worldPos=finalWorld*vec4(positionUpdated,1.0);
#ifdef NORMAL
mat3 normalWorld=mat3(finalWorld);
#if defined(INSTANCES) && defined(THIN_INSTANCES)
vNormalW=normalUpdated/vec3(dot(normalWorld[0],normalWorld[0]),dot(normalWorld[1],normalWorld[1]),dot(normalWorld[2],normalWorld[2]));
vNormalW=normalize(normalWorld*vNormalW);
#else
#ifdef NONUNIFORMSCALING
normalWorld=transposeMat3(inverseMat3(normalWorld));
#endif
vNormalW=normalize(normalWorld*normalUpdated);
#endif
#endif
#define CUSTOM_VERTEX_UPDATE_WORLDPOS
#ifdef MULTIVIEW
if (gl_ViewID_OVR == 0u) {
gl_Position=viewProjection*worldPos;
} else {
gl_Position=viewProjectionR*worldPos;
}
#else
gl_Position=viewProjection*worldPos;
#endif
vPositionW=vec3(worldPos);
#include<prePassVertex>
#if defined(REFLECTIONMAP_EQUIRECTANGULAR_FIXED) || defined(REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED)
vDirectionW=normalize(vec3(finalWorld*vec4(positionUpdated,0.0)));
#endif

#ifndef UV1
vec2 uvUpdated=vec2(0.,0.);
#endif
#ifndef UV2
vec2 uv2=vec2(0.,0.);
#endif
#ifdef MAINUV1
vMainUV1=uvUpdated;
#endif
#ifdef MAINUV2
vMainUV2=uv2;
#endif
#if defined(DIFFUSE) && DIFFUSEDIRECTUV == 0
if (vDiffuseInfos.x == 0.)
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(DETAIL) && DETAILDIRECTUV == 0
if (vDetailInfos.x == 0.)
{
vDetailUV=vec2(detailMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vDetailUV=vec2(detailMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(AMBIENT) && AMBIENTDIRECTUV == 0
if (vAmbientInfos.x == 0.)
{
vAmbientUV=vec2(ambientMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vAmbientUV=vec2(ambientMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(OPACITY) && OPACITYDIRECTUV == 0
if (vOpacityInfos.x == 0.)
{
vOpacityUV=vec2(opacityMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vOpacityUV=vec2(opacityMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(EMISSIVE) && EMISSIVEDIRECTUV == 0
if (vEmissiveInfos.x == 0.)
{
vEmissiveUV=vec2(emissiveMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vEmissiveUV=vec2(emissiveMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(LIGHTMAP) && LIGHTMAPDIRECTUV == 0
if (vLightmapInfos.x == 0.)
{
vLightmapUV=vec2(lightmapMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vLightmapUV=vec2(lightmapMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(SPECULAR) && defined(SPECULARTERM) && SPECULARDIRECTUV == 0
if (vSpecularInfos.x == 0.)
{
vSpecularUV=vec2(specularMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vSpecularUV=vec2(specularMatrix*vec4(uv2,1.0,0.0));
}
#endif
#if defined(BUMP) && BUMPDIRECTUV == 0
if (vBumpInfos.x == 0.)
{
vBumpUV=vec2(bumpMatrix*vec4(uvUpdated,1.0,0.0));
}
else
{
vBumpUV=vec2(bumpMatrix*vec4(uv2,1.0,0.0));
}
#endif
#include<bumpVertex>
#include<clipPlaneVertex>
#include<fogVertex>
#include<shadowsVertex>[0..maxSimultaneousLights]
#ifdef VERTEXCOLOR

vColor=color;
#endif
#include<pointCloudVertex>
#include<logDepthVertex>
#define CUSTOM_VERTEX_MAIN_END
}
`;o.a.ShadersStore[Ne]=We;var Qe={name:Ne,shader:We},Xe=M(512),Ie=M(751),Le={effect:null,subMesh:null},Ve=function(me){Object(P.d)(q,me);function q(){var H=me.call(this)||this;return H.MAINUV1=!1,H.MAINUV2=!1,H.DIFFUSE=!1,H.DIFFUSEDIRECTUV=0,H.DETAIL=!1,H.DETAILDIRECTUV=0,H.DETAIL_NORMALBLENDMETHOD=0,H.AMBIENT=!1,H.AMBIENTDIRECTUV=0,H.OPACITY=!1,H.OPACITYDIRECTUV=0,H.OPACITYRGB=!1,H.REFLECTION=!1,H.EMISSIVE=!1,H.EMISSIVEDIRECTUV=0,H.SPECULAR=!1,H.SPECULARDIRECTUV=0,H.BUMP=!1,H.BUMPDIRECTUV=0,H.PARALLAX=!1,H.PARALLAXOCCLUSION=!1,H.SPECULAROVERALPHA=!1,H.CLIPPLANE=!1,H.CLIPPLANE2=!1,H.CLIPPLANE3=!1,H.CLIPPLANE4=!1,H.CLIPPLANE5=!1,H.CLIPPLANE6=!1,H.ALPHATEST=!1,H.DEPTHPREPASS=!1,H.ALPHAFROMDIFFUSE=!1,H.POINTSIZE=!1,H.FOG=!1,H.SPECULARTERM=!1,H.DIFFUSEFRESNEL=!1,H.OPACITYFRESNEL=!1,H.REFLECTIONFRESNEL=!1,H.REFRACTIONFRESNEL=!1,H.EMISSIVEFRESNEL=!1,H.FRESNEL=!1,H.NORMAL=!1,H.UV1=!1,H.UV2=!1,H.VERTEXCOLOR=!1,H.VERTEXALPHA=!1,H.NUM_BONE_INFLUENCERS=0,H.BonesPerMesh=0,H.BONETEXTURE=!1,H.BONES_VELOCITY_ENABLED=!1,H.INSTANCES=!1,H.THIN_INSTANCES=!1,H.GLOSSINESS=!1,H.ROUGHNESS=!1,H.EMISSIVEASILLUMINATION=!1,H.LINKEMISSIVEWITHDIFFUSE=!1,H.REFLECTIONFRESNELFROMSPECULAR=!1,H.LIGHTMAP=!1,H.LIGHTMAPDIRECTUV=0,H.OBJECTSPACE_NORMALMAP=!1,H.USELIGHTMAPASSHADOWMAP=!1,H.REFLECTIONMAP_3D=!1,H.REFLECTIONMAP_SPHERICAL=!1,H.REFLECTIONMAP_PLANAR=!1,H.REFLECTIONMAP_CUBIC=!1,H.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,H.REFLECTIONMAP_PROJECTION=!1,H.REFLECTIONMAP_SKYBOX=!1,H.REFLECTIONMAP_EXPLICIT=!1,H.REFLECTIONMAP_EQUIRECTANGULAR=!1,H.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,H.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,H.REFLECTIONMAP_OPPOSITEZ=!1,H.INVERTCUBICMAP=!1,H.LOGARITHMICDEPTH=!1,H.REFRACTION=!1,H.REFRACTIONMAP_3D=!1,H.REFLECTIONOVERALPHA=!1,H.TWOSIDEDLIGHTING=!1,H.SHADOWFLOAT=!1,H.MORPHTARGETS=!1,H.MORPHTARGETS_NORMAL=!1,H.MORPHTARGETS_TANGENT=!1,H.MORPHTARGETS_UV=!1,H.NUM_MORPH_INFLUENCERS=0,H.MORPHTARGETS_TEXTURE=!1,H.NONUNIFORMSCALING=!1,H.PREMULTIPLYALPHA=!1,H.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,H.ALPHABLEND=!0,H.PREPASS=!1,H.PREPASS_IRRADIANCE=!1,H.PREPASS_IRRADIANCE_INDEX=-1,H.PREPASS_ALBEDO=!1,H.PREPASS_ALBEDO_INDEX=-1,H.PREPASS_DEPTH=!1,H.PREPASS_DEPTH_INDEX=-1,H.PREPASS_NORMAL=!1,H.PREPASS_NORMAL_INDEX=-1,H.PREPASS_POSITION=!1,H.PREPASS_POSITION_INDEX=-1,H.PREPASS_VELOCITY=!1,H.PREPASS_VELOCITY_INDEX=-1,H.PREPASS_REFLECTIVITY=!1,H.PREPASS_REFLECTIVITY_INDEX=-1,H.SCENE_MRT_COUNT=0,H.RGBDLIGHTMAP=!1,H.RGBDREFLECTION=!1,H.RGBDREFRACTION=!1,H.IMAGEPROCESSING=!1,H.VIGNETTE=!1,H.VIGNETTEBLENDMODEMULTIPLY=!1,H.VIGNETTEBLENDMODEOPAQUE=!1,H.TONEMAPPING=!1,H.TONEMAPPING_ACES=!1,H.CONTRAST=!1,H.COLORCURVES=!1,H.COLORGRADING=!1,H.COLORGRADING3D=!1,H.SAMPLER3DGREENDEPTH=!1,H.SAMPLER3DBGRMAP=!1,H.IMAGEPROCESSINGPOSTPROCESS=!1,H.MULTIVIEW=!1,H.IS_REFLECTION_LINEAR=!1,H.IS_REFRACTION_LINEAR=!1,H.EXPOSURE=!1,H.rebuild(),H}return q.prototype.setReflectionMode=function(H){for(var le=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"],oe=0,ce=le;oe<ce.length;oe++){var ee=ce[oe];this[ee]=ee===H}},q}(l.a),Fe=function(me){Object(P.d)(q,me);function q(H,le){var oe=me.call(this,H,le)||this;return oe._diffuseTexture=null,oe._ambientTexture=null,oe._opacityTexture=null,oe._reflectionTexture=null,oe._emissiveTexture=null,oe._specularTexture=null,oe._bumpTexture=null,oe._lightmapTexture=null,oe._refractionTexture=null,oe.ambientColor=new a.a(0,0,0),oe.diffuseColor=new a.a(1,1,1),oe.specularColor=new a.a(1,1,1),oe.emissiveColor=new a.a(0,0,0),oe.specularPower=64,oe._useAlphaFromDiffuseTexture=!1,oe._useEmissiveAsIllumination=!1,oe._linkEmissiveWithDiffuse=!1,oe._useSpecularOverAlpha=!1,oe._useReflectionOverAlpha=!1,oe._disableLighting=!1,oe._useObjectSpaceNormalMap=!1,oe._useParallax=!1,oe._useParallaxOcclusion=!1,oe.parallaxScaleBias=.05,oe._roughness=0,oe.indexOfRefraction=.98,oe.invertRefractionY=!0,oe.alphaCutOff=.4,oe._useLightmapAsShadowmap=!1,oe._useReflectionFresnelFromSpecular=!1,oe._useGlossinessFromSpecularMapAlpha=!1,oe._maxSimultaneousLights=4,oe._invertNormalMapX=!1,oe._invertNormalMapY=!1,oe._twoSidedLighting=!1,oe.detailMap=new Ie.a(oe._markAllSubMeshesAsTexturesDirty.bind(oe)),oe._renderTargets=new m.a(16),oe._worldViewProjectionMatrix=c.a.Zero(),oe._globalAmbientColor=new a.a(0,0,0),oe._rebuildInParallel=!1,oe._attachImageProcessingConfiguration(null),oe.prePassConfiguration=new s.a,oe.getRenderTargetTextures=function(){return oe._renderTargets.reset(),q.ReflectionTextureEnabled&&oe._reflectionTexture&&oe._reflectionTexture.isRenderTarget&&oe._renderTargets.push(oe._reflectionTexture),q.RefractionTextureEnabled&&oe._refractionTexture&&oe._refractionTexture.isRenderTarget&&oe._renderTargets.push(oe._refractionTexture),oe._renderTargets},oe}return Object.defineProperty(q.prototype,"imageProcessingConfiguration",{get:function(){return this._imageProcessingConfiguration},set:function(H){this._attachImageProcessingConfiguration(H),this._markAllSubMeshesAsTexturesDirty()},enumerable:!1,configurable:!0}),q.prototype._attachImageProcessingConfiguration=function(H){var le=this;H!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),H?this._imageProcessingConfiguration=H:this._imageProcessingConfiguration=this.getScene().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add(function(){le._markAllSubMeshesAsImageProcessingDirty()})))},Object.defineProperty(q.prototype,"isPrePassCapable",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"cameraColorCurvesEnabled",{get:function(){return this.imageProcessingConfiguration.colorCurvesEnabled},set:function(H){this.imageProcessingConfiguration.colorCurvesEnabled=H},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"cameraColorGradingEnabled",{get:function(){return this.imageProcessingConfiguration.colorGradingEnabled},set:function(H){this.imageProcessingConfiguration.colorGradingEnabled=H},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"cameraToneMappingEnabled",{get:function(){return this._imageProcessingConfiguration.toneMappingEnabled},set:function(H){this._imageProcessingConfiguration.toneMappingEnabled=H},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"cameraExposure",{get:function(){return this._imageProcessingConfiguration.exposure},set:function(H){this._imageProcessingConfiguration.exposure=H},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"cameraContrast",{get:function(){return this._imageProcessingConfiguration.contrast},set:function(H){this._imageProcessingConfiguration.contrast=H},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"cameraColorGradingTexture",{get:function(){return this._imageProcessingConfiguration.colorGradingTexture},set:function(H){this._imageProcessingConfiguration.colorGradingTexture=H},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"cameraColorCurves",{get:function(){return this._imageProcessingConfiguration.colorCurves},set:function(H){this._imageProcessingConfiguration.colorCurves=H},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"canRenderToMRT",{get:function(){return!0},enumerable:!1,configurable:!0}),Object.defineProperty(q.prototype,"hasRenderTargetTextures",{get:function(){return!!(q.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget||q.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)},enumerable:!1,configurable:!0}),q.prototype.getClassName=function(){return"StandardMaterial"},Object.defineProperty(q.prototype,"useLogarithmicDepth",{get:function(){return this._useLogarithmicDepth},set:function(H){this._useLogarithmicDepth=H&&this.getScene().getEngine().getCaps().fragmentDepthSupported,this._markAllSubMeshesAsMiscDirty()},enumerable:!1,configurable:!0}),q.prototype.needAlphaBlending=function(){return this._disableAlphaBlending?!1:this.alpha<1||this._opacityTexture!=null||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled},q.prototype.needAlphaTesting=function(){return this._forceAlphaTest?!0:this._hasAlphaChannel()&&(this._transparencyMode==null||this._transparencyMode===p.a.MATERIAL_ALPHATEST)},q.prototype._shouldUseAlphaFromDiffuseTexture=function(){return this._diffuseTexture!=null&&this._diffuseTexture.hasAlpha&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==p.a.MATERIAL_OPAQUE},q.prototype._hasAlphaChannel=function(){return this._diffuseTexture!=null&&this._diffuseTexture.hasAlpha||this._opacityTexture!=null},q.prototype.getAlphaTestTexture=function(){return this._diffuseTexture},q.prototype.isReadyForSubMesh=function(H,le,oe){if(oe===void 0&&(oe=!1),le.effect&&this.isFrozen&&le.effect._wasPreviouslyReady)return!0;le._materialDefines||(le._materialDefines=new Ve);var ce=this.getScene(),ee=le._materialDefines;if(this._isReadyForSubMesh(le))return!0;var de=ce.getEngine();if(ee._needNormals=t.a.PrepareDefinesForLights(ce,H,ee,!0,this._maxSimultaneousLights,this._disableLighting),t.a.PrepareDefinesForMultiview(ce,ee),t.a.PrepareDefinesForPrePass(ce,ee,this.canRenderToMRT),ee._areTexturesDirty){if(ee._needUVs=!1,ee.MAINUV1=!1,ee.MAINUV2=!1,ce.texturesEnabled){if(this._diffuseTexture&&q.DiffuseTextureEnabled)if(this._diffuseTexture.isReadyOrNotBlocking())t.a.PrepareDefinesForMergedUV(this._diffuseTexture,ee,"DIFFUSE");else return!1;else ee.DIFFUSE=!1;if(this._ambientTexture&&q.AmbientTextureEnabled)if(this._ambientTexture.isReadyOrNotBlocking())t.a.PrepareDefinesForMergedUV(this._ambientTexture,ee,"AMBIENT");else return!1;else ee.AMBIENT=!1;if(this._opacityTexture&&q.OpacityTextureEnabled)if(this._opacityTexture.isReadyOrNotBlocking())t.a.PrepareDefinesForMergedUV(this._opacityTexture,ee,"OPACITY"),ee.OPACITYRGB=this._opacityTexture.getAlphaFromRGB;else return!1;else ee.OPACITY=!1;if(this._reflectionTexture&&q.ReflectionTextureEnabled)if(this._reflectionTexture.isReadyOrNotBlocking()){switch(ee._needNormals=!0,ee.REFLECTION=!0,ee.ROUGHNESS=this._roughness>0,ee.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,ee.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===e.a.INVCUBIC_MODE,ee.REFLECTIONMAP_3D=this._reflectionTexture.isCube,ee.RGBDREFLECTION=this._reflectionTexture.isRGBD,ee.REFLECTIONMAP_OPPOSITEZ=this.getScene().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,this._reflectionTexture.coordinatesMode){case e.a.EXPLICIT_MODE:ee.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case e.a.PLANAR_MODE:ee.setReflectionMode("REFLECTIONMAP_PLANAR");break;case e.a.PROJECTION_MODE:ee.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case e.a.SKYBOX_MODE:ee.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case e.a.SPHERICAL_MODE:ee.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case e.a.EQUIRECTANGULAR_MODE:ee.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case e.a.FIXED_EQUIRECTANGULAR_MODE:ee.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case e.a.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:ee.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case e.a.CUBIC_MODE:case e.a.INVCUBIC_MODE:default:ee.setReflectionMode("REFLECTIONMAP_CUBIC");break}ee.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else return!1;else ee.REFLECTION=!1,ee.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&q.EmissiveTextureEnabled)if(this._emissiveTexture.isReadyOrNotBlocking())t.a.PrepareDefinesForMergedUV(this._emissiveTexture,ee,"EMISSIVE");else return!1;else ee.EMISSIVE=!1;if(this._lightmapTexture&&q.LightmapTextureEnabled)if(this._lightmapTexture.isReadyOrNotBlocking())t.a.PrepareDefinesForMergedUV(this._lightmapTexture,ee,"LIGHTMAP"),ee.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,ee.RGBDLIGHTMAP=this._lightmapTexture.isRGBD;else return!1;else ee.LIGHTMAP=!1;if(this._specularTexture&&q.SpecularTextureEnabled)if(this._specularTexture.isReadyOrNotBlocking())t.a.PrepareDefinesForMergedUV(this._specularTexture,ee,"SPECULAR"),ee.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha;else return!1;else ee.SPECULAR=!1;if(ce.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&q.BumpTextureEnabled){if(this._bumpTexture.isReady())t.a.PrepareDefinesForMergedUV(this._bumpTexture,ee,"BUMP"),ee.PARALLAX=this._useParallax,ee.PARALLAXOCCLUSION=this._useParallaxOcclusion;else return!1;ee.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else ee.BUMP=!1;if(this._refractionTexture&&q.RefractionTextureEnabled)if(this._refractionTexture.isReadyOrNotBlocking())ee._needUVs=!0,ee.REFRACTION=!0,ee.REFRACTIONMAP_3D=this._refractionTexture.isCube,ee.RGBDREFRACTION=this._refractionTexture.isRGBD;else return!1;else ee.REFRACTION=!1;ee.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else ee.DIFFUSE=!1,ee.AMBIENT=!1,ee.OPACITY=!1,ee.REFLECTION=!1,ee.EMISSIVE=!1,ee.LIGHTMAP=!1,ee.BUMP=!1,ee.REFRACTION=!1;ee.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),ee.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,ee.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,ee.SPECULAROVERALPHA=this._useSpecularOverAlpha,ee.PREMULTIPLYALPHA=this.alphaMode===7||this.alphaMode===8,ee.ALPHATEST_AFTERALLALPHACOMPUTATIONS=this.transparencyMode!==null,ee.ALPHABLEND=this.transparencyMode===null||this.needAlphaBlendingForMesh(H)}if(!this.detailMap.isReadyForSubMesh(ee,ce))return!1;if(ee._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(ee),ee.IS_REFLECTION_LINEAR=this.reflectionTexture!=null&&!this.reflectionTexture.gammaSpace,ee.IS_REFRACTION_LINEAR=this.refractionTexture!=null&&!this.refractionTexture.gammaSpace}if(ee._areFresnelDirty&&(q.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(ee.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,ee.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,ee.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,ee.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,ee.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,ee.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,ee._needNormals=!0,ee.FRESNEL=!0):ee.FRESNEL=!1),t.a.PrepareDefinesForMisc(H,ce,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(H)||this._forceAlphaTest,ee),t.a.PrepareDefinesForAttributes(H,ee,!0,!0,!0),t.a.PrepareDefinesForFrameBoundValues(ce,de,ee,oe,null,le.getRenderingMesh().hasThinInstances),this.detailMap.prepareDefines(ee,ce),ee.isDirty){var Se=ee._areLightsDisposed;ee.markAsProcessed();var se=new Xe.a;ee.REFLECTION&&se.addFallback(0,"REFLECTION"),ee.SPECULAR&&se.addFallback(0,"SPECULAR"),ee.BUMP&&se.addFallback(0,"BUMP"),ee.PARALLAX&&se.addFallback(1,"PARALLAX"),ee.PARALLAXOCCLUSION&&se.addFallback(0,"PARALLAXOCCLUSION"),ee.SPECULAROVERALPHA&&se.addFallback(0,"SPECULAROVERALPHA"),ee.FOG&&se.addFallback(1,"FOG"),ee.POINTSIZE&&se.addFallback(0,"POINTSIZE"),ee.LOGARITHMICDEPTH&&se.addFallback(0,"LOGARITHMICDEPTH"),t.a.HandleFallbacksForShadows(ee,se,this._maxSimultaneousLights),ee.SPECULARTERM&&se.addFallback(0,"SPECULARTERM"),ee.DIFFUSEFRESNEL&&se.addFallback(1,"DIFFUSEFRESNEL"),ee.OPACITYFRESNEL&&se.addFallback(2,"OPACITYFRESNEL"),ee.REFLECTIONFRESNEL&&se.addFallback(3,"REFLECTIONFRESNEL"),ee.EMISSIVEFRESNEL&&se.addFallback(4,"EMISSIVEFRESNEL"),ee.FRESNEL&&se.addFallback(4,"FRESNEL"),ee.MULTIVIEW&&se.addFallback(0,"MULTIVIEW");var ve=[_.b.PositionKind];ee.NORMAL&&ve.push(_.b.NormalKind),ee.UV1&&ve.push(_.b.UVKind),ee.UV2&&ve.push(_.b.UV2Kind),ee.VERTEXCOLOR&&ve.push(_.b.ColorKind),t.a.PrepareAttributesForBones(ve,H,ee,se),t.a.PrepareAttributesForInstances(ve,ee),t.a.PrepareAttributesForMorphTargets(ve,H,ee);var ye="default",be=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","vClipPlane","vClipPlane2","vClipPlane3","vClipPlane4","vClipPlane5","vClipPlane6","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices"],Ce=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets"],Be=["Material","Scene","Mesh"];Ie.a.AddUniforms(be),Ie.a.AddSamplers(Ce),s.a.AddUniforms(be),s.a.AddSamplers(be),u.a&&(u.a.PrepareUniforms(be,ee),u.a.PrepareSamplers(Ce,ee)),t.a.PrepareUniformsAndSamplersList({uniformsNames:be,uniformBuffersNames:Be,samplers:Ce,defines:ee,maxSimultaneousLights:this._maxSimultaneousLights});var je={};this.customShaderNameResolve&&(ye=this.customShaderNameResolve(ye,be,Be,Ce,ee,ve,je));var Ge=ee.toString(),ze=le.effect,De=ce.getEngine().createEffect(ye,{attributes:ve,uniformsNames:be,uniformBuffersNames:Be,samplers:Ce,defines:Ge,fallbacks:se,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:ee.NUM_MORPH_INFLUENCERS},processFinalCode:je.processFinalCode,multiTarget:ee.PREPASS},de);if(De)if(this._onEffectCreatedObservable&&(Le.effect=De,Le.subMesh=le,this._onEffectCreatedObservable.notifyObservers(Le)),this.allowShaderHotSwapping&&ze&&!De.isReady()){if(De=ze,this._rebuildInParallel=!0,ee.markAsUnprocessed(),Se)return ee._areLightsDisposed=!0,!1}else this._rebuildInParallel=!1,ce.resetCachedMaterial(),le.setEffect(De,ee),this.buildUniformLayout()}return!le.effect||!le.effect.isReady()?!1:(ee._renderId=ce.getRenderId(),le.effect._wasPreviouslyReady=!0,!0)},q.prototype.buildUniformLayout=function(){var H=this._uniformBuffer;H.addUniform("diffuseLeftColor",4),H.addUniform("diffuseRightColor",4),H.addUniform("opacityParts",4),H.addUniform("reflectionLeftColor",4),H.addUniform("reflectionRightColor",4),H.addUniform("refractionLeftColor",4),H.addUniform("refractionRightColor",4),H.addUniform("emissiveLeftColor",4),H.addUniform("emissiveRightColor",4),H.addUniform("vDiffuseInfos",2),H.addUniform("vAmbientInfos",2),H.addUniform("vOpacityInfos",2),H.addUniform("vReflectionInfos",2),H.addUniform("vReflectionPosition",3),H.addUniform("vReflectionSize",3),H.addUniform("vEmissiveInfos",2),H.addUniform("vLightmapInfos",2),H.addUniform("vSpecularInfos",2),H.addUniform("vBumpInfos",3),H.addUniform("diffuseMatrix",16),H.addUniform("ambientMatrix",16),H.addUniform("opacityMatrix",16),H.addUniform("reflectionMatrix",16),H.addUniform("emissiveMatrix",16),H.addUniform("lightmapMatrix",16),H.addUniform("specularMatrix",16),H.addUniform("bumpMatrix",16),H.addUniform("vTangentSpaceParams",2),H.addUniform("pointSize",1),H.addUniform("refractionMatrix",16),H.addUniform("vRefractionInfos",4),H.addUniform("vSpecularColor",4),H.addUniform("vEmissiveColor",3),H.addUniform("vDiffuseColor",4),Ie.a.PrepareUniformBuffer(H),H.create()},q.prototype.unbind=function(){if(this._activeEffect){var H=!1;this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&(this._activeEffect.setTexture("reflection2DSampler",null),H=!0),this._refractionTexture&&this._refractionTexture.isRenderTarget&&(this._activeEffect.setTexture("refraction2DSampler",null),H=!0),H&&this._markAllSubMeshesAsTexturesDirty()}me.prototype.unbind.call(this)},q.prototype.bindForSubMesh=function(H,le,oe){var ce=this.getScene(),ee=oe._materialDefines;if(!!ee){var de=oe.effect;if(!!de){this._activeEffect=de,le.getMeshUniformBuffer().bindToEffect(de,"Mesh"),le.transferToEffect(H),this.prePassConfiguration.bindForSubMesh(this._activeEffect,ce,le,H,this.isFrozen),ee.OBJECTSPACE_NORMALMAP&&(H.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));var Se=this._mustRebind(ce,de,le.visibility);t.a.BindBonesParameters(le,de);var se=this._uniformBuffer;if(Se){if(se.bindToEffect(de,"Material"),this.bindViewProjection(de),!se.useUbo||!this.isFrozen||!se.isSync){if(q.FresnelEnabled&&ee.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(se.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),se.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&se.updateColor4("opacityParts",new a.a(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(se.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),se.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(se.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),se.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(se.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),se.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),ce.texturesEnabled){if(this._diffuseTexture&&q.DiffuseTextureEnabled&&(se.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),t.a.BindTextureMatrix(this._diffuseTexture,se,"diffuse")),this._ambientTexture&&q.AmbientTextureEnabled&&(se.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),t.a.BindTextureMatrix(this._ambientTexture,se,"ambient")),this._opacityTexture&&q.OpacityTextureEnabled&&(se.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),t.a.BindTextureMatrix(this._opacityTexture,se,"opacity")),this._hasAlphaChannel()&&de.setFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&q.ReflectionTextureEnabled&&(se.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),se.updateMatrix("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){var ve=this._reflectionTexture;se.updateVector3("vReflectionPosition",ve.boundingBoxPosition),se.updateVector3("vReflectionSize",ve.boundingBoxSize)}if(this._emissiveTexture&&q.EmissiveTextureEnabled&&(se.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),t.a.BindTextureMatrix(this._emissiveTexture,se,"emissive")),this._lightmapTexture&&q.LightmapTextureEnabled&&(se.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),t.a.BindTextureMatrix(this._lightmapTexture,se,"lightmap")),this._specularTexture&&q.SpecularTextureEnabled&&(se.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),t.a.BindTextureMatrix(this._specularTexture,se,"specular")),this._bumpTexture&&ce.getEngine().getCaps().standardDerivatives&&q.BumpTextureEnabled&&(se.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),t.a.BindTextureMatrix(this._bumpTexture,se,"bump"),ce._mirroredCameraPosition?se.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):se.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&q.RefractionTextureEnabled){var ye=1;this._refractionTexture.isCube||(se.updateMatrix("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(ye=this._refractionTexture.depth)),se.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,ye,this.invertRefractionY?-1:1)}}this.pointsCloud&&se.updateFloat("pointSize",this.pointSize),ee.SPECULARTERM&&se.updateColor4("vSpecularColor",this.specularColor,this.specularPower),se.updateColor3("vEmissiveColor",q.EmissiveTextureEnabled?this.emissiveColor:a.a.BlackReadOnly),se.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha)}if(ce.texturesEnabled&&(this._diffuseTexture&&q.DiffuseTextureEnabled&&de.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&q.AmbientTextureEnabled&&de.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&q.OpacityTextureEnabled&&de.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&q.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?de.setTexture("reflectionCubeSampler",this._reflectionTexture):de.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&q.EmissiveTextureEnabled&&de.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&q.LightmapTextureEnabled&&de.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&q.SpecularTextureEnabled&&de.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&ce.getEngine().getCaps().standardDerivatives&&q.BumpTextureEnabled&&de.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&q.RefractionTextureEnabled)){var ye=1;this._refractionTexture.isCube?de.setTexture("refractionCubeSampler",this._refractionTexture):de.setTexture("refraction2DSampler",this._refractionTexture)}this.detailMap.bindForSubMesh(se,ce,this.isFrozen),t.a.BindClipPlane(de,ce),ce.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),this.bindEyePosition(de),de.setColor3("vAmbientColor",this._globalAmbientColor)}(Se||!this.isFrozen)&&(ce.lightsEnabled&&!this._disableLighting&&t.a.BindLights(ce,le,de,ee,this._maxSimultaneousLights,this._rebuildInParallel),(ce.fogEnabled&&le.applyFog&&ce.fogMode!==n.a.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture)&&this.bindView(de),t.a.BindFogParameters(ce,le,de),ee.NUM_MORPH_INFLUENCERS&&t.a.BindMorphTargetParameters(le,de),this.useLogarithmicDepth&&t.a.BindLogDepth(ee,de,ce),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)),this._afterBind(le,this._activeEffect),se.update()}}},q.prototype.getAnimatables=function(){var H=[];return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&H.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&H.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&H.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&H.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&H.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&H.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&H.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&H.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&H.push(this._refractionTexture),this.detailMap.getAnimatables(H),H},q.prototype.getActiveTextures=function(){var H=me.prototype.getActiveTextures.call(this);return this._diffuseTexture&&H.push(this._diffuseTexture),this._ambientTexture&&H.push(this._ambientTexture),this._opacityTexture&&H.push(this._opacityTexture),this._reflectionTexture&&H.push(this._reflectionTexture),this._emissiveTexture&&H.push(this._emissiveTexture),this._specularTexture&&H.push(this._specularTexture),this._bumpTexture&&H.push(this._bumpTexture),this._lightmapTexture&&H.push(this._lightmapTexture),this._refractionTexture&&H.push(this._refractionTexture),this.detailMap.getActiveTextures(H),H},q.prototype.hasTexture=function(H){return me.prototype.hasTexture.call(this,H)||this._diffuseTexture===H||this._ambientTexture===H||this._opacityTexture===H||this._reflectionTexture===H||this._emissiveTexture===H||this._specularTexture===H||this._bumpTexture===H||this._lightmapTexture===H||this._refractionTexture===H?!0:this.detailMap.hasTexture(H)},q.prototype.dispose=function(H,le){var oe,ce,ee,de,Se,se,ve,ye,be;le&&((oe=this._diffuseTexture)===null||oe===void 0||oe.dispose(),(ce=this._ambientTexture)===null||ce===void 0||ce.dispose(),(ee=this._opacityTexture)===null||ee===void 0||ee.dispose(),(de=this._reflectionTexture)===null||de===void 0||de.dispose(),(Se=this._emissiveTexture)===null||Se===void 0||Se.dispose(),(se=this._specularTexture)===null||se===void 0||se.dispose(),(ve=this._bumpTexture)===null||ve===void 0||ve.dispose(),(ye=this._lightmapTexture)===null||ye===void 0||ye.dispose(),(be=this._refractionTexture)===null||be===void 0||be.dispose()),this.detailMap.dispose(le),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),me.prototype.dispose.call(this,H,le)},q.prototype.clone=function(H){var le=this,oe=d.a.Clone(function(){return new q(H,le.getScene())},this);return oe.name=H,oe.id=H,oe},q.prototype.serialize=function(){return d.a.Serialize(this)},q.Parse=function(H,le,oe){return d.a.Parse(function(){return new q(H.name,le)},H,le,oe)},Object.defineProperty(q,"DiffuseTextureEnabled",{get:function(){return r.a.DiffuseTextureEnabled},set:function(H){r.a.DiffuseTextureEnabled=H},enumerable:!1,configurable:!0}),Object.defineProperty(q,"DetailTextureEnabled",{get:function(){return r.a.DetailTextureEnabled},set:function(H){r.a.DetailTextureEnabled=H},enumerable:!1,configurable:!0}),Object.defineProperty(q,"AmbientTextureEnabled",{get:function(){return r.a.AmbientTextureEnabled},set:function(H){r.a.AmbientTextureEnabled=H},enumerable:!1,configurable:!0}),Object.defineProperty(q,"OpacityTextureEnabled",{get:function(){return r.a.OpacityTextureEnabled},set:function(H){r.a.OpacityTextureEnabled=H},enumerable:!1,configurable:!0}),Object.defineProperty(q,"ReflectionTextureEnabled",{get:function(){return r.a.ReflectionTextureEnabled},set:function(H){r.a.ReflectionTextureEnabled=H},enumerable:!1,configurable:!0}),Object.defineProperty(q,"EmissiveTextureEnabled",{get:function(){return r.a.EmissiveTextureEnabled},set:function(H){r.a.EmissiveTextureEnabled=H},enumerable:!1,configurable:!0}),Object.defineProperty(q,"SpecularTextureEnabled",{get:function(){return r.a.SpecularTextureEnabled},set:function(H){r.a.SpecularTextureEnabled=H},enumerable:!1,configurable:!0}),Object.defineProperty(q,"BumpTextureEnabled",{get:function(){return r.a.BumpTextureEnabled},set:function(H){r.a.BumpTextureEnabled=H},enumerable:!1,configurable:!0}),Object.defineProperty(q,"LightmapTextureEnabled",{get:function(){return r.a.LightmapTextureEnabled},set:function(H){r.a.LightmapTextureEnabled=H},enumerable:!1,configurable:!0}),Object.defineProperty(q,"RefractionTextureEnabled",{get:function(){return r.a.RefractionTextureEnabled},set:function(H){r.a.RefractionTextureEnabled=H},enumerable:!1,configurable:!0}),Object.defineProperty(q,"ColorGradingTextureEnabled",{get:function(){return r.a.ColorGradingTextureEnabled},set:function(H){r.a.ColorGradingTextureEnabled=H},enumerable:!1,configurable:!0}),Object.defineProperty(q,"FresnelEnabled",{get:function(){return r.a.FresnelEnabled},set:function(H){r.a.FresnelEnabled=H},enumerable:!1,configurable:!0}),Object(P.c)([Object(d.m)("diffuseTexture")],q.prototype,"_diffuseTexture",void 0),Object(P.c)([Object(d.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],q.prototype,"diffuseTexture",void 0),Object(P.c)([Object(d.m)("ambientTexture")],q.prototype,"_ambientTexture",void 0),Object(P.c)([Object(d.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"ambientTexture",void 0),Object(P.c)([Object(d.m)("opacityTexture")],q.prototype,"_opacityTexture",void 0),Object(P.c)([Object(d.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],q.prototype,"opacityTexture",void 0),Object(P.c)([Object(d.m)("reflectionTexture")],q.prototype,"_reflectionTexture",void 0),Object(P.c)([Object(d.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"reflectionTexture",void 0),Object(P.c)([Object(d.m)("emissiveTexture")],q.prototype,"_emissiveTexture",void 0),Object(P.c)([Object(d.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"emissiveTexture",void 0),Object(P.c)([Object(d.m)("specularTexture")],q.prototype,"_specularTexture",void 0),Object(P.c)([Object(d.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"specularTexture",void 0),Object(P.c)([Object(d.m)("bumpTexture")],q.prototype,"_bumpTexture",void 0),Object(P.c)([Object(d.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"bumpTexture",void 0),Object(P.c)([Object(d.m)("lightmapTexture")],q.prototype,"_lightmapTexture",void 0),Object(P.c)([Object(d.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"lightmapTexture",void 0),Object(P.c)([Object(d.m)("refractionTexture")],q.prototype,"_refractionTexture",void 0),Object(P.c)([Object(d.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"refractionTexture",void 0),Object(P.c)([Object(d.e)("ambient")],q.prototype,"ambientColor",void 0),Object(P.c)([Object(d.e)("diffuse")],q.prototype,"diffuseColor",void 0),Object(P.c)([Object(d.e)("specular")],q.prototype,"specularColor",void 0),Object(P.c)([Object(d.e)("emissive")],q.prototype,"emissiveColor",void 0),Object(P.c)([Object(d.c)()],q.prototype,"specularPower",void 0),Object(P.c)([Object(d.c)("useAlphaFromDiffuseTexture")],q.prototype,"_useAlphaFromDiffuseTexture",void 0),Object(P.c)([Object(d.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],q.prototype,"useAlphaFromDiffuseTexture",void 0),Object(P.c)([Object(d.c)("useEmissiveAsIllumination")],q.prototype,"_useEmissiveAsIllumination",void 0),Object(P.c)([Object(d.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useEmissiveAsIllumination",void 0),Object(P.c)([Object(d.c)("linkEmissiveWithDiffuse")],q.prototype,"_linkEmissiveWithDiffuse",void 0),Object(P.c)([Object(d.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"linkEmissiveWithDiffuse",void 0),Object(P.c)([Object(d.c)("useSpecularOverAlpha")],q.prototype,"_useSpecularOverAlpha",void 0),Object(P.c)([Object(d.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useSpecularOverAlpha",void 0),Object(P.c)([Object(d.c)("useReflectionOverAlpha")],q.prototype,"_useReflectionOverAlpha",void 0),Object(P.c)([Object(d.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useReflectionOverAlpha",void 0),Object(P.c)([Object(d.c)("disableLighting")],q.prototype,"_disableLighting",void 0),Object(P.c)([Object(d.b)("_markAllSubMeshesAsLightsDirty")],q.prototype,"disableLighting",void 0),Object(P.c)([Object(d.c)("useObjectSpaceNormalMap")],q.prototype,"_useObjectSpaceNormalMap",void 0),Object(P.c)([Object(d.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useObjectSpaceNormalMap",void 0),Object(P.c)([Object(d.c)("useParallax")],q.prototype,"_useParallax",void 0),Object(P.c)([Object(d.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useParallax",void 0),Object(P.c)([Object(d.c)("useParallaxOcclusion")],q.prototype,"_useParallaxOcclusion",void 0),Object(P.c)([Object(d.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useParallaxOcclusion",void 0),Object(P.c)([Object(d.c)()],q.prototype,"parallaxScaleBias",void 0),Object(P.c)([Object(d.c)("roughness")],q.prototype,"_roughness",void 0),Object(P.c)([Object(d.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"roughness",void 0),Object(P.c)([Object(d.c)()],q.prototype,"indexOfRefraction",void 0),Object(P.c)([Object(d.c)()],q.prototype,"invertRefractionY",void 0),Object(P.c)([Object(d.c)()],q.prototype,"alphaCutOff",void 0),Object(P.c)([Object(d.c)("useLightmapAsShadowmap")],q.prototype,"_useLightmapAsShadowmap",void 0),Object(P.c)([Object(d.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useLightmapAsShadowmap",void 0),Object(P.c)([Object(d.h)("diffuseFresnelParameters")],q.prototype,"_diffuseFresnelParameters",void 0),Object(P.c)([Object(d.b)("_markAllSubMeshesAsFresnelDirty")],q.prototype,"diffuseFresnelParameters",void 0),Object(P.c)([Object(d.h)("opacityFresnelParameters")],q.prototype,"_opacityFresnelParameters",void 0),Object(P.c)([Object(d.b)("_markAllSubMeshesAsFresnelAndMiscDirty")],q.prototype,"opacityFresnelParameters",void 0),Object(P.c)([Object(d.h)("reflectionFresnelParameters")],q.prototype,"_reflectionFresnelParameters",void 0),Object(P.c)([Object(d.b)("_markAllSubMeshesAsFresnelDirty")],q.prototype,"reflectionFresnelParameters",void 0),Object(P.c)([Object(d.h)("refractionFresnelParameters")],q.prototype,"_refractionFresnelParameters",void 0),Object(P.c)([Object(d.b)("_markAllSubMeshesAsFresnelDirty")],q.prototype,"refractionFresnelParameters",void 0),Object(P.c)([Object(d.h)("emissiveFresnelParameters")],q.prototype,"_emissiveFresnelParameters",void 0),Object(P.c)([Object(d.b)("_markAllSubMeshesAsFresnelDirty")],q.prototype,"emissiveFresnelParameters",void 0),Object(P.c)([Object(d.c)("useReflectionFresnelFromSpecular")],q.prototype,"_useReflectionFresnelFromSpecular",void 0),Object(P.c)([Object(d.b)("_markAllSubMeshesAsFresnelDirty")],q.prototype,"useReflectionFresnelFromSpecular",void 0),Object(P.c)([Object(d.c)("useGlossinessFromSpecularMapAlpha")],q.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),Object(P.c)([Object(d.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"useGlossinessFromSpecularMapAlpha",void 0),Object(P.c)([Object(d.c)("maxSimultaneousLights")],q.prototype,"_maxSimultaneousLights",void 0),Object(P.c)([Object(d.b)("_markAllSubMeshesAsLightsDirty")],q.prototype,"maxSimultaneousLights",void 0),Object(P.c)([Object(d.c)("invertNormalMapX")],q.prototype,"_invertNormalMapX",void 0),Object(P.c)([Object(d.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"invertNormalMapX",void 0),Object(P.c)([Object(d.c)("invertNormalMapY")],q.prototype,"_invertNormalMapY",void 0),Object(P.c)([Object(d.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"invertNormalMapY",void 0),Object(P.c)([Object(d.c)("twoSidedLighting")],q.prototype,"_twoSidedLighting",void 0),Object(P.c)([Object(d.b)("_markAllSubMeshesAsTexturesDirty")],q.prototype,"twoSidedLighting",void 0),Object(P.c)([Object(d.c)()],q.prototype,"useLogarithmicDepth",null),q}(h.a);i.a.RegisteredTypes["BABYLON.StandardMaterial"]=Fe,n.a.DefaultMaterialFactory=function(me){return new Fe("default material",me)}},function($,W,M){"use strict";M.d(W,"b",function(){return n}),M.d(W,"a",function(){return c});var P=M(438),d=M(595),m=M(476),n;(function(a){a[a.Unknown=0]="Unknown",a[a.Url=1]="Url",a[a.Temp=2]="Temp",a[a.Raw=3]="Raw",a[a.Dynamic=4]="Dynamic",a[a.RenderTarget=5]="RenderTarget",a[a.MultiRenderTarget=6]="MultiRenderTarget",a[a.Cube=7]="Cube",a[a.CubeRaw=8]="CubeRaw",a[a.CubePrefiltered=9]="CubePrefiltered",a[a.Raw3D=10]="Raw3D",a[a.Raw2DArray=11]="Raw2DArray",a[a.Depth=12]="Depth",a[a.CubeRawRGBD=13]="CubeRawRGBD"})(n||(n={}));var c=function(){function a(_,s,u){u===void 0&&(u=!1),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.samplingMode=-1,this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new P.c,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=n.Unknown,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._MSAARenderBuffer=null,this._attachments=null,this._textureArray=null,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._isDisabled=!1,this._compression=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._comparisonFunction=0,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._references=1,this._gammaSpace=null,this._engine=_,this._source=s,this._uniqueId=a._Counter++,u||(this._hardwareTexture=_._createHardwareTexture())}return Object.defineProperty(a.prototype,"uniqueId",{get:function(){return this._uniqueId},enumerable:!1,configurable:!0}),a.prototype.getEngine=function(){return this._engine},Object.defineProperty(a.prototype,"source",{get:function(){return this._source},enumerable:!1,configurable:!0}),a.prototype.incrementReferences=function(){this._references++},a.prototype.updateSize=function(_,s,u){u===void 0&&(u=1),this._engine.updateTextureDimensions(this,_,s,u),this.width=_,this.height=s,this.depth=u,this.baseWidth=_,this.baseHeight=s,this.baseDepth=u,this._size=_*s*u},a.prototype._rebuild=function(){var _=this,s,u;switch(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedAnisotropicFilteringLevel=null,this.source){case n.Temp:return;case n.Url:u=this._engine.createTexture((s=this._originalUrl)!==null&&s!==void 0?s:this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,function(){u._swapAndDie(_),_.isReady=!0},null,this._buffer,void 0,this.format);return;case n.Raw:u=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),u._swapAndDie(this),this.isReady=!0;return;case n.Raw3D:u=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),u._swapAndDie(this),this.isReady=!0;return;case n.Raw2DArray:u=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),u._swapAndDie(this),this.isReady=!0;return;case n.Dynamic:u=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),u._swapAndDie(this),this._engine.updateDynamicTexture(this,this._engine.getRenderingCanvas(),this.invertY,void 0,void 0,!0);return;case n.RenderTarget:var p=new d.a;if(p.generateDepthBuffer=this._generateDepthBuffer,p.generateMipMaps=this.generateMipMaps,p.generateStencilBuffer=this._generateStencilBuffer,p.samplingMode=this.samplingMode,p.type=this.type,this.isCube)u=this._engine.createRenderTargetCubeTexture(this.width,p);else{var l={width:this.width,height:this.height,layers:this.is2DArray?this.depth:void 0};u=this._engine.createRenderTargetTexture(l,p)}u._swapAndDie(this),this.isReady=!0;return;case n.Depth:var h={bilinearFiltering:this.samplingMode!==2,comparisonFunction:this._comparisonFunction,generateStencil:this._generateStencilBuffer,isCube:this.isCube,samples:this.samples},t={width:this.width,height:this.height,layers:this.is2DArray?this.depth:void 0};u=this._engine.createDepthStencilTexture(t,h),u._swapAndDie(this),this.isReady=!0;return;case n.Cube:u=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,function(){u._swapAndDie(_),_.isReady=!0},null,this.format,this._extension);return;case n.CubeRaw:u=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),u._swapAndDie(this),this.isReady=!0;return;case n.CubeRawRGBD:u=this._engine.createRawCubeTexture(null,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),a._UpdateRGBDAsync(u,this._bufferViewArrayArray,this._sphericalPolynomial,this._lodGenerationScale,this._lodGenerationOffset).then(function(){u._swapAndDie(_),_.isReady=!0});return;case n.CubePrefiltered:u=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,function(e){e&&e._swapAndDie(_),_.isReady=!0},null,this.format,this._extension),u._sphericalPolynomial=this._sphericalPolynomial;return}},a.prototype._swapAndDie=function(_){var s;(s=this._hardwareTexture)===null||s===void 0||s.setUsage(_._source,this.generateMipMaps,this.isCube,this.width,this.height),_._hardwareTexture=this._hardwareTexture,_._isRGBD=this._isRGBD,this._framebuffer&&(_._framebuffer=this._framebuffer),this._depthStencilBuffer&&(_._depthStencilBuffer=this._depthStencilBuffer),_._depthStencilTexture=this._depthStencilTexture,this._lodTextureHigh&&(_._lodTextureHigh&&_._lodTextureHigh.dispose(),_._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(_._lodTextureMid&&_._lodTextureMid.dispose(),_._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(_._lodTextureLow&&_._lodTextureLow.dispose(),_._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(_._irradianceTexture&&_._irradianceTexture.dispose(),_._irradianceTexture=this._irradianceTexture);var u=this._engine.getLoadedTexturesCache(),p=u.indexOf(this);p!==-1&&u.splice(p,1);var p=u.indexOf(_);p===-1&&u.push(_)},a.prototype.dispose=function(){this._references--,this._references===0&&(this._engine._releaseTexture(this),this._hardwareTexture=null)},a._UpdateRGBDAsync=function(_,s,u,p,l){throw m.a.WarnImport("environmentTextureTools")},a._Counter=0,a}()},function($,W,M){"use strict";var P=M(435),d="helperFunctions",m=`const float PI=3.1415926535897932384626433832795;
const float HALF_MIN=5.96046448e-08;
const float LinearEncodePowerApprox=2.2;
const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;
const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);
const float Epsilon=0.0000001;
#define saturate(x) clamp(x,0.0,1.0)
#define absEps(x) abs(x)+Epsilon
#define maxEps(x) max(x,Epsilon)
#define saturateEps(x) clamp(x,Epsilon,1.0)
mat3 transposeMat3(mat3 inMatrix) {
vec3 i0=inMatrix[0];
vec3 i1=inMatrix[1];
vec3 i2=inMatrix[2];
mat3 outMatrix=mat3(
vec3(i0.x,i1.x,i2.x),
vec3(i0.y,i1.y,i2.y),
vec3(i0.z,i1.z,i2.z)
);
return outMatrix;
}

mat3 inverseMat3(mat3 inMatrix) {
float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];
float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];
float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];
float b01=a22*a11-a12*a21;
float b11=-a22*a10+a12*a20;
float b21=a21*a10-a11*a20;
float det=a00*b01+a01*b11+a02*b21;
return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),
b11,(a22*a00-a02*a20),(-a12*a00+a02*a10),
b21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;
}
float toLinearSpace(float color)
{
return pow(color,LinearEncodePowerApprox);
}
vec3 toLinearSpace(vec3 color)
{
return pow(color,vec3(LinearEncodePowerApprox));
}
vec4 toLinearSpace(vec4 color)
{
return vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);
}
vec3 toGammaSpace(vec3 color)
{
return pow(color,vec3(GammaEncodePowerApprox));
}
vec4 toGammaSpace(vec4 color)
{
return vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);
}
float toGammaSpace(float color)
{
return pow(color,GammaEncodePowerApprox);
}
float square(float value)
{
return value*value;
}
float pow5(float value) {
float sq=value*value;
return sq*sq*value;
}
float getLuminance(vec3 color)
{
return clamp(dot(color,LuminanceEncodeApprox),0.,1.);
}

float getRand(vec2 seed) {
return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);
}
float dither(vec2 seed,float varianceAmount) {
float rand=getRand(seed);
float dither=mix(-varianceAmount/255.0,varianceAmount/255.0,rand);
return dither;
}

const float rgbdMaxRange=255.0;
vec4 toRGBD(vec3 color) {
float maxRGB=maxEps(max(color.r,max(color.g,color.b)));
float D=max(rgbdMaxRange/maxRGB,1.);
D=clamp(floor(D)/255.0,0.,1.);

vec3 rgb=color.rgb*D;

rgb=toGammaSpace(rgb);
return vec4(clamp(rgb,0.,1.),D);
}
vec3 fromRGBD(vec4 rgbd) {

rgbd.rgb=toLinearSpace(rgbd.rgb);

return rgbd.rgb/rgbd.a;
}
`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},,function($,W,M){"use strict";M.d(W,"a",function(){return l});var P=M(434),d=M(439),m=M(443),n=M(438),c=M(448),a=M(559),_=M(557),s=M(440),u=M(603),p=M(454),l=function(){function h(t,e,i){this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.onDisposeObservable=new n.c,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this._effect=null,this._useUBO=!1,this._fillMode=h.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._forceAlphaTest=!1,this._transparencyMode=null,this.name=t,this._scene=e||c.a.LastCreatedScene,this.id=t||m.b.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._scene.useRightHandedSystem?this.sideOrientation=h.ClockWiseSideOrientation:this.sideOrientation=h.CounterClockWiseSideOrientation,this._uniformBuffer=new _.a(this._scene.getEngine(),void 0,void 0,t),this._useUBO=this.getScene().getEngine().supportsUniformBuffers,i||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={})}return Object.defineProperty(h.prototype,"canRenderToMRT",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"alpha",{get:function(){return this._alpha},set:function(t){this._alpha!==t&&(this._alpha=t,this.markAsDirty(h.MiscDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"backFaceCulling",{get:function(){return this._backFaceCulling},set:function(t){this._backFaceCulling!==t&&(this._backFaceCulling=t,this.markAsDirty(h.TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"hasRenderTargetTextures",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onDispose",{set:function(t){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new n.c),this._onBindObservable},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onBind",{set:function(t){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onUnBindObservable",{get:function(){return this._onUnBindObservable||(this._onUnBindObservable=new n.c),this._onUnBindObservable},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onEffectCreatedObservable",{get:function(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new n.c),this._onEffectCreatedObservable},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"alphaMode",{get:function(){return this._alphaMode},set:function(t){this._alphaMode!==t&&(this._alphaMode=t,this.markAsDirty(h.TextureDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"needDepthPrePass",{get:function(){return this._needDepthPrePass},set:function(t){this._needDepthPrePass!==t&&(this._needDepthPrePass=t,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"isPrePassCapable",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"fogEnabled",{get:function(){return this._fogEnabled},set:function(t){this._fogEnabled!==t&&(this._fogEnabled=t,this.markAsDirty(h.MiscDirtyFlag))},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"wireframe",{get:function(){switch(this._fillMode){case h.WireFrameFillMode:case h.LineListDrawMode:case h.LineLoopDrawMode:case h.LineStripDrawMode:return!0}return this._scene.forceWireframe},set:function(t){this.fillMode=t?h.WireFrameFillMode:h.TriangleFillMode},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"pointsCloud",{get:function(){switch(this._fillMode){case h.PointFillMode:case h.PointListDrawMode:return!0}return this._scene.forcePointsCloud},set:function(t){this.fillMode=t?h.PointFillMode:h.TriangleFillMode},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"fillMode",{get:function(){return this._fillMode},set:function(t){this._fillMode!==t&&(this._fillMode=t,this.markAsDirty(h.MiscDirtyFlag))},enumerable:!1,configurable:!0}),h.prototype.toString=function(t){var e="Name: "+this.name;return e},h.prototype.getClassName=function(){return"Material"},Object.defineProperty(h.prototype,"isFrozen",{get:function(){return this.checkReadyOnlyOnce},enumerable:!1,configurable:!0}),h.prototype.freeze=function(){this.markDirty(),this.checkReadyOnlyOnce=!0},h.prototype.unfreeze=function(){this.markDirty(),this.checkReadyOnlyOnce=!1},h.prototype.isReady=function(t,e){return!0},h.prototype.isReadyForSubMesh=function(t,e,i){return!1},h.prototype.getEffect=function(){return this._effect},h.prototype.getScene=function(){return this._scene},Object.defineProperty(h.prototype,"transparencyMode",{get:function(){return this._transparencyMode},set:function(t){this._transparencyMode!==t&&(this._transparencyMode=t,this._forceAlphaTest=t===h.MATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"_disableAlphaBlending",{get:function(){return this._transparencyMode===h.MATERIAL_OPAQUE||this._transparencyMode===h.MATERIAL_ALPHATEST},enumerable:!1,configurable:!0}),h.prototype.needAlphaBlending=function(){return this._disableAlphaBlending?!1:this.alpha<1},h.prototype.needAlphaBlendingForMesh=function(t){return this._disableAlphaBlending&&t.visibility>=1?!1:this.needAlphaBlending()||t.visibility<1||t.hasVertexAlpha},h.prototype.needAlphaTesting=function(){return!!this._forceAlphaTest},h.prototype._shouldTurnAlphaTestOn=function(t){return!this.needAlphaBlendingForMesh(t)&&this.needAlphaTesting()},h.prototype.getAlphaTestTexture=function(){return null},h.prototype.markDirty=function(){for(var t=this.getScene().meshes,e=0,i=t;e<i.length;e++){var r=i[e];if(!!r.subMeshes)for(var o=0,g=r.subMeshes;o<g.length;o++){var y=g[o];y.getMaterial()===this&&(!y.effect||(y.effect._wasPreviouslyReady=!1))}}},h.prototype._preBind=function(t,e){e===void 0&&(e=null);var i=this._scene.getEngine(),r=e==null?this.sideOrientation:e,o=r===h.ClockWiseSideOrientation;return i.enableEffect(t||this._effect),i.setState(this.backFaceCulling,this.zOffset,!1,o),o},h.prototype.bind=function(t,e){},h.prototype.bindForSubMesh=function(t,e,i){},h.prototype.bindOnlyWorldMatrix=function(t){},h.prototype.bindView=function(t){this._useUBO?this._needToBindSceneUbo=!0:t.setMatrix("view",this.getScene().getViewMatrix())},h.prototype.bindViewProjection=function(t){this._useUBO?this._needToBindSceneUbo=!0:(t.setMatrix("viewProjection",this.getScene().getTransformMatrix()),t.setMatrix("projection",this.getScene().getProjectionMatrix()))},h.prototype.bindEyePosition=function(t,e){this._useUBO?this._needToBindSceneUbo=!0:p.a.BindEyePosition(t,this._scene,e)},h.prototype._afterBind=function(t,e){if(e===void 0&&(e=null),this._scene._cachedMaterial=this,this._needToBindSceneUbo&&e&&(this._needToBindSceneUbo=!1,p.a.FinalizeSceneUbo(this.getScene()),p.a.BindSceneUniformBuffer(e,this.getScene().getSceneUniformBuffer())),t?this._scene._cachedVisibility=t.visibility:this._scene._cachedVisibility=1,this._onBindObservable&&t&&this._onBindObservable.notifyObservers(t),this.disableDepthWrite){var i=this._scene.getEngine();this._cachedDepthWriteState=i.getDepthWrite(),i.setDepthWrite(!1)}if(this.disableColorWrite){var i=this._scene.getEngine();this._cachedColorWriteState=i.getColorWrite(),i.setColorWrite(!1)}if(this.depthFunction!==0){var i=this._scene.getEngine();this._cachedDepthFunctionState=i.getDepthFunction()||0,i.setDepthFunction(this.depthFunction)}},h.prototype.unbind=function(){if(this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),this.depthFunction!==0){var t=this._scene.getEngine();t.setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){var t=this._scene.getEngine();t.setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){var t=this._scene.getEngine();t.setColorWrite(this._cachedColorWriteState)}},h.prototype.getActiveTextures=function(){return[]},h.prototype.hasTexture=function(t){return!1},h.prototype.clone=function(t){return null},h.prototype.getBindedMeshes=function(){var t=this;if(this.meshMap){var e=new Array;for(var i in this.meshMap){var r=this.meshMap[i];r&&e.push(r)}return e}else{var o=this._scene.meshes;return o.filter(function(g){return g.material===t})}},h.prototype.forceCompilation=function(t,e,i,r){var o=this,g=Object(P.a)({clipPlane:!1,useInstances:!1},i),y=this.getScene(),v=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;var f=function(){if(!(!o._scene||!o._scene.getEngine())){var b=y.clipPlane;if(g.clipPlane&&(y.clipPlane=new u.a(0,0,0,1)),o._storeEffectOnSubMeshes){var T=!0,E=null;if(t.subMeshes){var O=new a.a(0,0,0,0,0,t,void 0,!1,!1);O._materialDefines&&(O._materialDefines._renderId=-1),o.isReadyForSubMesh(t,O,g.useInstances)||(O.effect&&O.effect.getCompilationError()&&O.effect.allFallbacksProcessed()?E=O.effect.getCompilationError():(T=!1,setTimeout(f,16)))}T&&(o.allowShaderHotSwapping=v,E&&r&&r(E),e&&e(o))}else o.isReady()?(o.allowShaderHotSwapping=v,e&&e(o)):setTimeout(f,16);g.clipPlane&&(y.clipPlane=b)}};f()},h.prototype.forceCompilationAsync=function(t,e){var i=this;return new Promise(function(r,o){i.forceCompilation(t,function(){r()},e,function(g){o(g)})})},h.prototype.markAsDirty=function(t){this.getScene().blockMaterialDirtyMechanism||(h._DirtyCallbackArray.length=0,t&h.TextureDirtyFlag&&h._DirtyCallbackArray.push(h._TextureDirtyCallBack),t&h.LightDirtyFlag&&h._DirtyCallbackArray.push(h._LightsDirtyCallBack),t&h.FresnelDirtyFlag&&h._DirtyCallbackArray.push(h._FresnelDirtyCallBack),t&h.AttributesDirtyFlag&&h._DirtyCallbackArray.push(h._AttributeDirtyCallBack),t&h.MiscDirtyFlag&&h._DirtyCallbackArray.push(h._MiscDirtyCallBack),t&h.PrePassDirtyFlag&&h._DirtyCallbackArray.push(h._PrePassDirtyCallBack),h._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(h._RunDirtyCallBacks),this.getScene().resetCachedMaterial())},h.prototype._markAllSubMeshesAsDirty=function(t){if(!this.getScene().blockMaterialDirtyMechanism)for(var e=this.getScene().meshes,i=0,r=e;i<r.length;i++){var o=r[i];if(!!o.subMeshes)for(var g=0,y=o.subMeshes;g<y.length;g++){var v=y[g];v.getMaterial()===this&&(!v._materialDefines||t(v._materialDefines))}}},h.prototype._markScenePrePassDirty=function(){if(!this.getScene().blockMaterialDirtyMechanism){var t=this.getScene().enablePrePassRenderer();t&&t.markAsDirty()}},h.prototype._markAllSubMeshesAsAllDirty=function(){this._markAllSubMeshesAsDirty(h._AllDirtyCallBack)},h.prototype._markAllSubMeshesAsImageProcessingDirty=function(){this._markAllSubMeshesAsDirty(h._ImageProcessingDirtyCallBack)},h.prototype._markAllSubMeshesAsTexturesDirty=function(){this._markAllSubMeshesAsDirty(h._TextureDirtyCallBack)},h.prototype._markAllSubMeshesAsFresnelDirty=function(){this._markAllSubMeshesAsDirty(h._FresnelDirtyCallBack)},h.prototype._markAllSubMeshesAsFresnelAndMiscDirty=function(){this._markAllSubMeshesAsDirty(h._FresnelAndMiscDirtyCallBack)},h.prototype._markAllSubMeshesAsLightsDirty=function(){this._markAllSubMeshesAsDirty(h._LightsDirtyCallBack)},h.prototype._markAllSubMeshesAsAttributesDirty=function(){this._markAllSubMeshesAsDirty(h._AttributeDirtyCallBack)},h.prototype._markAllSubMeshesAsMiscDirty=function(){this._markAllSubMeshesAsDirty(h._MiscDirtyCallBack)},h.prototype._markAllSubMeshesAsPrePassDirty=function(){this._markAllSubMeshesAsDirty(h._MiscDirtyCallBack)},h.prototype._markAllSubMeshesAsTexturesAndMiscDirty=function(){this._markAllSubMeshesAsDirty(h._TextureAndMiscDirtyCallBack)},h.prototype.setPrePassRenderer=function(t){return!1},h.prototype.dispose=function(t,e,i){var r=this.getScene();if(r.stopAnimation(this),r.freeProcessedMaterials(),r.removeMaterial(this),i!==!0)if(this.meshMap)for(var o in this.meshMap){var g=this.meshMap[o];g&&(g.material=null,this.releaseVertexArrayObject(g,t))}else for(var y=r.meshes,v=0,f=y;v<f.length;v++){var g=f[v];g.material===this&&!g.sourceMesh&&(g.material=null,this.releaseVertexArrayObject(g,t))}this._uniformBuffer.dispose(),t&&this._effect&&(this._storeEffectOnSubMeshes||this._effect.dispose(),this._effect=null),this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear()},h.prototype.releaseVertexArrayObject=function(t,e){if(t.geometry){var i=t.geometry;if(this._storeEffectOnSubMeshes)for(var r=0,o=t.subMeshes;r<o.length;r++){var g=o[r];i._releaseVertexArrayObject(g._materialEffect),e&&g._materialEffect&&g._materialEffect.dispose()}else i._releaseVertexArrayObject(this._effect)}},h.prototype.serialize=function(){return d.a.Serialize(this)},h.Parse=function(t,e,i){if(!t.customType)t.customType="BABYLON.StandardMaterial";else if(t.customType==="BABYLON.PBRMaterial"&&t.overloadedAlbedo&&(t.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return s.a.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null;var r=m.b.Instantiate(t.customType);return r.Parse(t,e,i)},h.TriangleFillMode=0,h.WireFrameFillMode=1,h.PointFillMode=2,h.PointListDrawMode=3,h.LineListDrawMode=4,h.LineLoopDrawMode=5,h.LineStripDrawMode=6,h.TriangleStripDrawMode=7,h.TriangleFanDrawMode=8,h.ClockWiseSideOrientation=0,h.CounterClockWiseSideOrientation=1,h.TextureDirtyFlag=1,h.LightDirtyFlag=2,h.FresnelDirtyFlag=4,h.AttributesDirtyFlag=8,h.MiscDirtyFlag=16,h.PrePassDirtyFlag=32,h.AllDirtyFlag=63,h.MATERIAL_OPAQUE=0,h.MATERIAL_ALPHATEST=1,h.MATERIAL_ALPHABLEND=2,h.MATERIAL_ALPHATESTANDBLEND=3,h.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,h.MATERIAL_NORMALBLENDMETHOD_RNM=1,h._AllDirtyCallBack=function(t){return t.markAllAsDirty()},h._ImageProcessingDirtyCallBack=function(t){return t.markAsImageProcessingDirty()},h._TextureDirtyCallBack=function(t){return t.markAsTexturesDirty()},h._FresnelDirtyCallBack=function(t){return t.markAsFresnelDirty()},h._MiscDirtyCallBack=function(t){return t.markAsMiscDirty()},h._PrePassDirtyCallBack=function(t){return t.markAsPrePassDirty()},h._LightsDirtyCallBack=function(t){return t.markAsLightDirty()},h._AttributeDirtyCallBack=function(t){return t.markAsAttributesDirty()},h._FresnelAndMiscDirtyCallBack=function(t){h._FresnelDirtyCallBack(t),h._MiscDirtyCallBack(t)},h._TextureAndMiscDirtyCallBack=function(t){h._TextureDirtyCallBack(t),h._MiscDirtyCallBack(t)},h._DirtyCallbackArray=[],h._RunDirtyCallBacks=function(t){for(var e=0,i=h._DirtyCallbackArray;e<i.length;e++){var r=i[e];r(t)}},Object(P.c)([Object(d.c)()],h.prototype,"id",void 0),Object(P.c)([Object(d.c)()],h.prototype,"uniqueId",void 0),Object(P.c)([Object(d.c)()],h.prototype,"name",void 0),Object(P.c)([Object(d.c)()],h.prototype,"checkReadyOnEveryCall",void 0),Object(P.c)([Object(d.c)()],h.prototype,"checkReadyOnlyOnce",void 0),Object(P.c)([Object(d.c)()],h.prototype,"state",void 0),Object(P.c)([Object(d.c)("alpha")],h.prototype,"_alpha",void 0),Object(P.c)([Object(d.c)("backFaceCulling")],h.prototype,"_backFaceCulling",void 0),Object(P.c)([Object(d.c)()],h.prototype,"sideOrientation",void 0),Object(P.c)([Object(d.c)("alphaMode")],h.prototype,"_alphaMode",void 0),Object(P.c)([Object(d.c)()],h.prototype,"_needDepthPrePass",void 0),Object(P.c)([Object(d.c)()],h.prototype,"disableDepthWrite",void 0),Object(P.c)([Object(d.c)()],h.prototype,"disableColorWrite",void 0),Object(P.c)([Object(d.c)()],h.prototype,"forceDepthWrite",void 0),Object(P.c)([Object(d.c)()],h.prototype,"depthFunction",void 0),Object(P.c)([Object(d.c)()],h.prototype,"separateCullingPass",void 0),Object(P.c)([Object(d.c)("fogEnabled")],h.prototype,"_fogEnabled",void 0),Object(P.c)([Object(d.c)()],h.prototype,"pointSize",void 0),Object(P.c)([Object(d.c)()],h.prototype,"zOffset",void 0),Object(P.c)([Object(d.c)()],h.prototype,"pointsCloud",null),Object(P.c)([Object(d.c)()],h.prototype,"fillMode",null),Object(P.c)([Object(d.c)()],h.prototype,"transparencyMode",null),h}()},function($,W,M){"use strict";M.d(W,"a",function(){return n}),M.d(W,"b",function(){return c});var P=M(440),d=M(439),m=M(451),n={},c=function(){function a(_){this.attachedToElement=!1,this.attached={},this.camera=_,this.checkInputs=function(){}}return a.prototype.add=function(_){var s=_.getSimpleName();if(this.attached[s]){P.a.Warn("camera input of type "+s+" already exists on camera");return}this.attached[s]=_,_.camera=this.camera,_.checkInputs&&(this.checkInputs=this._addCheckInputs(_.checkInputs.bind(_))),this.attachedToElement&&_.attachControl()},a.prototype.remove=function(_){for(var s in this.attached){var u=this.attached[s];u===_&&(u.detachControl(),u.camera=null,delete this.attached[s],this.rebuildInputCheck())}},a.prototype.removeByType=function(_){for(var s in this.attached){var u=this.attached[s];u.getClassName()===_&&(u.detachControl(),u.camera=null,delete this.attached[s],this.rebuildInputCheck())}},a.prototype._addCheckInputs=function(_){var s=this.checkInputs;return function(){s(),_()}},a.prototype.attachInput=function(_){this.attachedToElement&&_.attachControl(this.noPreventDefault)},a.prototype.attachElement=function(_){if(_===void 0&&(_=!1),!this.attachedToElement){_=m.a.ForceAttachControlToAlwaysPreventDefault?!1:_,this.attachedToElement=!0,this.noPreventDefault=_;for(var s in this.attached)this.attached[s].attachControl(_)}},a.prototype.detachElement=function(_){_===void 0&&(_=!1);for(var s in this.attached)this.attached[s].detachControl(),_&&(this.attached[s].camera=null);this.attachedToElement=!1},a.prototype.rebuildInputCheck=function(){this.checkInputs=function(){};for(var _ in this.attached){var s=this.attached[_];s.checkInputs&&(this.checkInputs=this._addCheckInputs(s.checkInputs.bind(s)))}},a.prototype.clear=function(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=function(){}},a.prototype.serialize=function(_){var s={};for(var u in this.attached){var p=this.attached[u],l=d.a.Serialize(p);s[p.getClassName()]=l}_.inputsmgr=s},a.prototype.parse=function(_){var s=_.inputsmgr;if(s){this.clear();for(var u in s){var p=n[u];if(p){var l=s[u],h=d.a.Parse(function(){return new p},l,null);this.add(h)}}}else for(var u in this.attached){var p=n[this.attached[u].getClassName()];if(p){var h=d.a.Parse(function(){return new p},_,null);this.remove(this.attached[u]),this.add(h)}}},a}()},,function($,W,M){"use strict";M.d(W,"a",function(){return f});var P=M(434),d=M(443),m=M(438),n=M(436),c=M(445),a=M(447),_=M(485),s=M(499),u=M(539),p=M(536),l=M(557),h=M(718),t=M(476),e=M(710),i=M(441),r=M(515),o=M(465),g=M(437),y=function(){function b(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=n.e.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}return b}(),v=function(){function b(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new y,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3}return b}(),f=function(b){Object(P.d)(T,b);function T(E,O){O===void 0&&(O=null);var D=b.call(this,E,O,!1)||this;return D._internalAbstractMeshDataInfo=new v,D.cullingStrategy=T.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY,D.onCollideObservable=new m.c,D.onCollisionPositionChangeObservable=new m.c,D.onMaterialChangedObservable=new m.c,D.definedFacingForward=!0,D._occlusionQuery=null,D._renderingGroup=null,D.alphaIndex=Number.MAX_VALUE,D.isVisible=!0,D.isPickable=!0,D.showSubMeshesBoundingBox=!1,D.isBlocker=!1,D.enablePointerMoveEvents=!1,D._renderingGroupId=0,D._material=null,D.outlineColor=i.a.Red(),D.outlineWidth=.02,D.overlayColor=i.a.Red(),D.overlayAlpha=.5,D.useOctreeForRenderingSelection=!0,D.useOctreeForPicking=!0,D.useOctreeForCollisions=!0,D.alwaysSelectAsActiveMesh=!1,D.doNotSyncBoundingInfo=!1,D.actionManager=null,D._meshCollisionData=new h.a,D.ellipsoid=new n.e(.5,1,.5),D.ellipsoidOffset=new n.e(0,0,0),D.edgesWidth=1,D.edgesColor=new i.b(1,0,0,1),D._edgesRenderer=null,D._masterMesh=null,D._boundingInfo=null,D._renderId=0,D._intersectionsInProgress=new Array,D._unIndexed=!1,D._lightSources=new Array,D._waitingData={lods:null,actions:null,freezeWorldMatrix:null},D._bonesTransformMatrices=null,D._transformMatrixTexture=null,D.onRebuildObservable=new m.c,D._onCollisionPositionChange=function(F,x,j){j===void 0&&(j=null),x.subtractToRef(D._meshCollisionData._oldPositionForCollisions,D._meshCollisionData._diffPositionForCollisions),D._meshCollisionData._diffPositionForCollisions.length()>c.a.CollisionsEpsilon&&D.position.addInPlace(D._meshCollisionData._diffPositionForCollisions),j&&D.onCollideObservable.notifyObservers(j),D.onCollisionPositionChangeObservable.notifyObservers(D.position)},D.getScene().addMesh(D),D._resyncLightSources(),D._uniformBuffer=new l.a(D.getScene().getEngine(),void 0,void 0,E),D._buildUniformLayout(),D}return Object.defineProperty(T,"BILLBOARDMODE_NONE",{get:function(){return s.a.BILLBOARDMODE_NONE},enumerable:!1,configurable:!0}),Object.defineProperty(T,"BILLBOARDMODE_X",{get:function(){return s.a.BILLBOARDMODE_X},enumerable:!1,configurable:!0}),Object.defineProperty(T,"BILLBOARDMODE_Y",{get:function(){return s.a.BILLBOARDMODE_Y},enumerable:!1,configurable:!0}),Object.defineProperty(T,"BILLBOARDMODE_Z",{get:function(){return s.a.BILLBOARDMODE_Z},enumerable:!1,configurable:!0}),Object.defineProperty(T,"BILLBOARDMODE_ALL",{get:function(){return s.a.BILLBOARDMODE_ALL},enumerable:!1,configurable:!0}),Object.defineProperty(T,"BILLBOARDMODE_USE_POSITION",{get:function(){return s.a.BILLBOARDMODE_USE_POSITION},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"facetNb",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetNb},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"partitioningSubdivisions",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions},set:function(E){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=E},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"partitioningBBoxRatio",{get:function(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio},set:function(E){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=E},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"mustDepthSortFacets",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort},set:function(E){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=E},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"facetDepthSortFrom",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom},set:function(E){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=E},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"collisionRetryCount",{get:function(){return this._internalAbstractMeshDataInfo._collisionRetryCount},set:function(E){this._internalAbstractMeshDataInfo._collisionRetryCount=E},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"isFacetDataEnabled",{get:function(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled},enumerable:!1,configurable:!0}),T.prototype._updateNonUniformScalingState=function(E){return b.prototype._updateNonUniformScalingState.call(this,E)?(this._markSubMeshesAsMiscDirty(),!0):!1},Object.defineProperty(T.prototype,"onCollide",{set:function(E){this._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._meshCollisionData._onCollideObserver),this._meshCollisionData._onCollideObserver=this.onCollideObservable.add(E)},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"onCollisionPositionChange",{set:function(E){this._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._meshCollisionData._onCollisionPositionChangeObserver),this._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(E)},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"visibility",{get:function(){return this._internalAbstractMeshDataInfo._visibility},set:function(E){this._internalAbstractMeshDataInfo._visibility!==E&&(this._internalAbstractMeshDataInfo._visibility=E,this._markSubMeshesAsMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"renderingGroupId",{get:function(){return this._renderingGroupId},set:function(E){this._renderingGroupId=E},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"material",{get:function(){return this._material},set:function(E){this._material!==E&&(this._material&&this._material.meshMap&&(this._material.meshMap[this.uniqueId]=void 0),this._material=E,E&&E.meshMap&&(E.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),!!this.subMeshes&&this._unBindEffect())},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"receiveShadows",{get:function(){return this._internalAbstractMeshDataInfo._receiveShadows},set:function(E){this._internalAbstractMeshDataInfo._receiveShadows!==E&&(this._internalAbstractMeshDataInfo._receiveShadows=E,this._markSubMeshesAsLightDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"hasVertexAlpha",{get:function(){return this._internalAbstractMeshDataInfo._hasVertexAlpha},set:function(E){this._internalAbstractMeshDataInfo._hasVertexAlpha!==E&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=E,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"useVertexColors",{get:function(){return this._internalAbstractMeshDataInfo._useVertexColors},set:function(E){this._internalAbstractMeshDataInfo._useVertexColors!==E&&(this._internalAbstractMeshDataInfo._useVertexColors=E,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"computeBonesUsingShaders",{get:function(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders},set:function(E){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==E&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=E,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"numBoneInfluencers",{get:function(){return this._internalAbstractMeshDataInfo._numBoneInfluencers},set:function(E){this._internalAbstractMeshDataInfo._numBoneInfluencers!==E&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=E,this._markSubMeshesAsAttributesDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"applyFog",{get:function(){return this._internalAbstractMeshDataInfo._applyFog},set:function(E){this._internalAbstractMeshDataInfo._applyFog!==E&&(this._internalAbstractMeshDataInfo._applyFog=E,this._markSubMeshesAsMiscDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"layerMask",{get:function(){return this._internalAbstractMeshDataInfo._layerMask},set:function(E){E!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=E,this._resyncLightSources())},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"collisionMask",{get:function(){return this._meshCollisionData._collisionMask},set:function(E){this._meshCollisionData._collisionMask=isNaN(E)?-1:E},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"collisionResponse",{get:function(){return this._meshCollisionData._collisionResponse},set:function(E){this._meshCollisionData._collisionResponse=E},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"collisionGroup",{get:function(){return this._meshCollisionData._collisionGroup},set:function(E){this._meshCollisionData._collisionGroup=isNaN(E)?-1:E},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"surroundingMeshes",{get:function(){return this._meshCollisionData._surroundingMeshes},set:function(E){this._meshCollisionData._surroundingMeshes=E},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"lightSources",{get:function(){return this._lightSources},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"_positions",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"skeleton",{get:function(){return this._internalAbstractMeshDataInfo._skeleton},set:function(E){var O=this._internalAbstractMeshDataInfo._skeleton;O&&O.needInitialSkinMatrix&&O._unregisterMeshWithPoseMatrix(this),E&&E.needInitialSkinMatrix&&E._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=E,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()},enumerable:!1,configurable:!0}),T.prototype._buildUniformLayout=function(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()},T.prototype.transferToEffect=function(E){var O=this._uniformBuffer;O.updateMatrix("world",E),O.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),O.update()},T.prototype.getMeshUniformBuffer=function(){return this._uniformBuffer},T.prototype.getClassName=function(){return"AbstractMesh"},T.prototype.toString=function(E){var O="Name: "+this.name+", isInstance: "+(this.getClassName()!=="InstancedMesh"?"YES":"NO");O+=", # of submeshes: "+(this.subMeshes?this.subMeshes.length:0);var D=this._internalAbstractMeshDataInfo._skeleton;return D&&(O+=", skeleton: "+D.name),E&&(O+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],O+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.freezeWorldMatrix?"YES":"NO")),O},T.prototype._getEffectiveParent=function(){return this._masterMesh&&this.billboardMode!==s.a.BILLBOARDMODE_NONE?this._masterMesh:b.prototype._getEffectiveParent.call(this)},T.prototype._getActionManagerForTrigger=function(E,O){if(O===void 0&&(O=!0),this.actionManager&&(O||this.actionManager.isRecursive))if(E){if(this.actionManager.hasSpecificTrigger(E))return this.actionManager}else return this.actionManager;return this.parent?this.parent._getActionManagerForTrigger(E,!1):null},T.prototype._rebuild=function(){if(this.onRebuildObservable.notifyObservers(this),this._occlusionQuery&&(this._occlusionQuery=null),!!this.subMeshes)for(var E=0,O=this.subMeshes;E<O.length;E++){var D=O[E];D._rebuild()}},T.prototype._resyncLightSources=function(){this._lightSources.length=0;for(var E=0,O=this.getScene().lights;E<O.length;E++){var D=O[E];!D.isEnabled()||D.canAffectMesh(this)&&this._lightSources.push(D)}this._markSubMeshesAsLightDirty()},T.prototype._resyncLightSource=function(E){var O=E.isEnabled()&&E.canAffectMesh(this),D=this._lightSources.indexOf(E),F=!1;if(D===-1){if(!O)return;this._lightSources.push(E)}else{if(O)return;F=!0,this._lightSources.splice(D,1)}this._markSubMeshesAsLightDirty(F)},T.prototype._unBindEffect=function(){for(var E=0,O=this.subMeshes;E<O.length;E++){var D=O[E];D.setEffect(null)}},T.prototype._removeLightSource=function(E,O){var D=this._lightSources.indexOf(E);D!==-1&&(this._lightSources.splice(D,1),this._markSubMeshesAsLightDirty(O))},T.prototype._markSubMeshesAsDirty=function(E){if(!!this.subMeshes)for(var O=0,D=this.subMeshes;O<D.length;O++){var F=D[O];F._materialDefines&&E(F._materialDefines)}},T.prototype._markSubMeshesAsLightDirty=function(E){E===void 0&&(E=!1),this._markSubMeshesAsDirty(function(O){return O.markAsLightDirty(E)})},T.prototype._markSubMeshesAsAttributesDirty=function(){this._markSubMeshesAsDirty(function(E){return E.markAsAttributesDirty()})},T.prototype._markSubMeshesAsMiscDirty=function(){this._markSubMeshesAsDirty(function(E){return E.markAsMiscDirty()})},Object.defineProperty(T.prototype,"scaling",{get:function(){return this._scaling},set:function(E){this._scaling=E},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"isBlocked",{get:function(){return!1},enumerable:!1,configurable:!0}),T.prototype.getLOD=function(E){return this},T.prototype.getTotalVertices=function(){return 0},T.prototype.getTotalIndices=function(){return 0},T.prototype.getIndices=function(){return null},T.prototype.getVerticesData=function(E){return null},T.prototype.setVerticesData=function(E,O,D,F){return this},T.prototype.updateVerticesData=function(E,O,D,F){return this},T.prototype.setIndices=function(E,O){return this},T.prototype.isVerticesDataPresent=function(E){return!1},T.prototype.getBoundingInfo=function(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfo||this._updateBoundingInfo(),this._boundingInfo)},T.prototype.normalizeToUnitCube=function(E,O,D){return E===void 0&&(E=!0),O===void 0&&(O=!1),b.prototype.normalizeToUnitCube.call(this,E,O,D)},T.prototype.setBoundingInfo=function(E){return this._boundingInfo=E,this},Object.defineProperty(T.prototype,"useBones",{get:function(){return this.skeleton&&this.getScene().skeletonsEnabled&&this.isVerticesDataPresent(a.b.MatricesIndicesKind)&&this.isVerticesDataPresent(a.b.MatricesWeightsKind)},enumerable:!1,configurable:!0}),T.prototype._preActivate=function(){},T.prototype._preActivateForIntermediateRendering=function(E){},T.prototype._activate=function(E,O){return this._renderId=E,!0},T.prototype._postActivate=function(){},T.prototype._freeze=function(){},T.prototype._unFreeze=function(){},T.prototype.getWorldMatrix=function(){return this._masterMesh&&this.billboardMode===s.a.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():b.prototype.getWorldMatrix.call(this)},T.prototype._getWorldMatrixDeterminant=function(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():b.prototype._getWorldMatrixDeterminant.call(this)},Object.defineProperty(T.prototype,"isAnInstance",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"hasInstances",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"hasThinInstances",{get:function(){return!1},enumerable:!1,configurable:!0}),T.prototype.movePOV=function(E,O,D){return this.position.addInPlace(this.calcMovePOV(E,O,D)),this},T.prototype.calcMovePOV=function(E,O,D){var F=new n.a,x=this.rotationQuaternion?this.rotationQuaternion:n.b.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z);x.toRotationMatrix(F);var j=n.e.Zero(),V=this.definedFacingForward?-1:1;return n.e.TransformCoordinatesFromFloatsToRef(E*V,O,D*V,F,j),j},T.prototype.rotatePOV=function(E,O,D){return this.rotation.addInPlace(this.calcRotatePOV(E,O,D)),this},T.prototype.calcRotatePOV=function(E,O,D){var F=this.definedFacingForward?1:-1;return new n.e(E*F,O,D*F)},T.prototype.refreshBoundingInfo=function(E){return E===void 0&&(E=!1),this._boundingInfo&&this._boundingInfo.isLocked?this:(this._refreshBoundingInfo(this._getPositionData(E),null),this)},T.prototype._refreshBoundingInfo=function(E,O){if(E){var D=Object(e.a)(E,0,this.getTotalVertices(),O);this._boundingInfo?this._boundingInfo.reConstruct(D.minimum,D.maximum):this._boundingInfo=new p.a(D.minimum,D.maximum)}if(this.subMeshes)for(var F=0;F<this.subMeshes.length;F++)this.subMeshes[F].refreshBoundingInfo(E);this._updateBoundingInfo()},T.prototype._getPositionData=function(E){var O=this.getVerticesData(a.b.PositionKind);if(O&&E&&this.skeleton){O=d.b.Slice(O),this._generatePointsArray();var D=this.getVerticesData(a.b.MatricesIndicesKind),F=this.getVerticesData(a.b.MatricesWeightsKind);if(F&&D){var x=this.numBoneInfluencers>4,j=x?this.getVerticesData(a.b.MatricesIndicesExtraKind):null,V=x?this.getVerticesData(a.b.MatricesWeightsExtraKind):null;this.skeleton.prepare();for(var z=this.skeleton.getTransformMatrices(this),w=n.c.Vector3[0],R=n.c.Matrix[0],L=n.c.Matrix[1],N=0,B=0;B<O.length;B+=3,N+=4){R.reset();var X,K;for(X=0;X<4;X++)K=F[N+X],K>0&&(n.a.FromFloat32ArrayToRefScaled(z,Math.floor(D[N+X]*16),K,L),R.addToSelf(L));if(x)for(X=0;X<4;X++)K=V[N+X],K>0&&(n.a.FromFloat32ArrayToRefScaled(z,Math.floor(j[N+X]*16),K,L),R.addToSelf(L));n.e.TransformCoordinatesFromFloatsToRef(O[B],O[B+1],O[B+2],R,w),w.toArray(O,B),this._positions&&this._positions[B/3].copyFrom(w)}}}return O},T.prototype._updateBoundingInfo=function(){var E=this._effectiveMesh;return this._boundingInfo?this._boundingInfo.update(E.worldMatrixFromCache):this._boundingInfo=new p.a(this.absolutePosition,this.absolutePosition,E.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(E.worldMatrixFromCache),this},T.prototype._updateSubMeshesBoundingInfo=function(E){if(!this.subMeshes)return this;for(var O=this.subMeshes.length,D=0;D<O;D++){var F=this.subMeshes[D];(O>1||!F.IsGlobal)&&F.updateBoundingInfo(E)}return this},T.prototype._afterComputeWorldMatrix=function(){this.doNotSyncBoundingInfo||this._updateBoundingInfo()},Object.defineProperty(T.prototype,"_effectiveMesh",{get:function(){return this.skeleton&&this.skeleton.overrideMesh||this},enumerable:!1,configurable:!0}),T.prototype.isInFrustum=function(E){return this._boundingInfo!==null&&this._boundingInfo.isInFrustum(E,this.cullingStrategy)},T.prototype.isCompletelyInFrustum=function(E){return this._boundingInfo!==null&&this._boundingInfo.isCompletelyInFrustum(E)},T.prototype.intersectsMesh=function(E,O,D){if(O===void 0&&(O=!1),!this._boundingInfo||!E._boundingInfo)return!1;if(this._boundingInfo.intersects(E._boundingInfo,O))return!0;if(D)for(var F=0,x=this.getChildMeshes();F<x.length;F++){var j=x[F];if(j.intersectsMesh(E,O,!0))return!0}return!1},T.prototype.intersectsPoint=function(E){return this._boundingInfo?this._boundingInfo.intersectsPoint(E):!1},Object.defineProperty(T.prototype,"checkCollisions",{get:function(){return this._meshCollisionData._checkCollisions},set:function(E){this._meshCollisionData._checkCollisions=E},enumerable:!1,configurable:!0}),Object.defineProperty(T.prototype,"collider",{get:function(){return this._meshCollisionData._collider},enumerable:!1,configurable:!0}),T.prototype.moveWithCollisions=function(E){var O=this.getAbsolutePosition();O.addToRef(this.ellipsoidOffset,this._meshCollisionData._oldPositionForCollisions);var D=this.getScene().collisionCoordinator;return this._meshCollisionData._collider||(this._meshCollisionData._collider=D.createCollider()),this._meshCollisionData._collider._radius=this.ellipsoid,D.getNewPosition(this._meshCollisionData._oldPositionForCollisions,E,this._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this},T.prototype._collideForSubMesh=function(E,O,D){if(this._generatePointsArray(),!this._positions)return this;if(!E._lastColliderWorldVertices||!E._lastColliderTransformMatrix.equals(O)){E._lastColliderTransformMatrix=O.clone(),E._lastColliderWorldVertices=[],E._trianglePlanes=[];for(var F=E.verticesStart,x=E.verticesStart+E.verticesCount,j=F;j<x;j++)E._lastColliderWorldVertices.push(n.e.TransformCoordinates(this._positions[j],O))}return D._collide(E._trianglePlanes,E._lastColliderWorldVertices,this.getIndices(),E.indexStart,E.indexStart+E.indexCount,E.verticesStart,!!E.getMaterial(),this),this},T.prototype._processCollisionsForSubMeshes=function(E,O){for(var D=this._scene.getCollidingSubMeshCandidates(this,E),F=D.length,x=0;x<F;x++){var j=D.data[x];F>1&&!j._checkCollision(E)||this._collideForSubMesh(j,O,E)}return this},T.prototype._checkCollision=function(E){if(!this._boundingInfo||!this._boundingInfo._checkCollision(E))return this;var O=n.c.Matrix[0],D=n.c.Matrix[1];return n.a.ScalingToRef(1/E._radius.x,1/E._radius.y,1/E._radius.z,O),this.worldMatrixFromCache.multiplyToRef(O,D),this._processCollisionsForSubMeshes(E,D),this},T.prototype._generatePointsArray=function(){return!1},T.prototype.intersects=function(E,O,D,F,x,j){F===void 0&&(F=!1),j===void 0&&(j=!1);var V=new u.a,z=this.getClassName()==="InstancedLinesMesh"||this.getClassName()==="LinesMesh"?this.intersectionThreshold:0,w=this._boundingInfo;if(!this.subMeshes||!w||!j&&(!E.intersectsSphere(w.boundingSphere,z)||!E.intersectsBox(w.boundingBox,z)))return V;if(F)return V.hit=!j,V.pickedMesh=j?null:this,V.distance=j?0:n.e.Distance(E.origin,w.boundingSphere.center),V.subMeshId=0,V;if(!this._generatePointsArray())return V;for(var R=null,L=this._scene.getIntersectingSubMeshCandidates(this,E),N=L.length,B=!1,X=0;X<N;X++){var K=L.data[X],G=K.getMaterial();if(!!G&&(G.fillMode==7||G.fillMode==0||G.fillMode==1||G.fillMode==2)){B=!0;break}}if(!B)return V.hit=!0,V.pickedMesh=this,V.distance=n.e.Distance(E.origin,w.boundingSphere.center),V.subMeshId=-1,V;for(var X=0;X<N;X++){var K=L.data[X];if(!(N>1&&!K.canIntersects(E))){var I=K.intersects(E,this._positions,this.getIndices(),O,D);if(I&&(O||!R||I.distance<R.distance)&&(R=I,R.subMeshId=X,O))break}}if(R){var A=x!=null?x:this.skeleton&&this.skeleton.overrideMesh?this.skeleton.overrideMesh.getWorldMatrix():this.getWorldMatrix(),S=n.c.Vector3[0],C=n.c.Vector3[1];n.e.TransformCoordinatesToRef(E.origin,A,S),E.direction.scaleToRef(R.distance,C);var U=n.e.TransformNormal(C,A),k=U.addInPlace(S);return V.hit=!0,V.distance=n.e.Distance(S,k),V.pickedPoint=k,V.pickedMesh=this,V.bu=R.bu||0,V.bv=R.bv||0,V.subMeshFaceId=R.faceId,V.faceId=R.faceId+L.data[R.subMeshId].indexStart/(this.getClassName().indexOf("LinesMesh")!==-1?2:3),V.subMeshId=R.subMeshId,V}return V},T.prototype.clone=function(E,O,D){return null},T.prototype.releaseSubMeshes=function(){if(this.subMeshes)for(;this.subMeshes.length;)this.subMeshes[0].dispose();else this.subMeshes=new Array;return this},T.prototype.dispose=function(E,O){var D=this;O===void 0&&(O=!1);var F;for(this._scene.useMaterialMeshMap&&this._material&&this._material.meshMap&&(this._material.meshMap[this.uniqueId]=void 0),this.getScene().freeActiveMeshes(),this.getScene().freeRenderingGroups(),this.actionManager!==void 0&&this.actionManager!==null&&(this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),F=0;F<this._intersectionsInProgress.length;F++){var x=this._intersectionsInProgress[F],j=x._intersectionsInProgress.indexOf(this);x._intersectionsInProgress.splice(j,1)}this._intersectionsInProgress=[];var V=this.getScene().lights;V.forEach(function(w){var R=w.includedOnlyMeshes.indexOf(D);R!==-1&&w.includedOnlyMeshes.splice(R,1),R=w.excludedMeshes.indexOf(D),R!==-1&&w.excludedMeshes.splice(R,1);var L=w.getShadowGenerator();if(L){var N=L.getShadowMap();N&&N.renderList&&(R=N.renderList.indexOf(D),R!==-1&&N.renderList.splice(R,1))}}),(this.getClassName()!=="InstancedMesh"||this.getClassName()!=="InstancedLinesMesh")&&this.releaseSubMeshes();var z=this.getScene().getEngine();if(this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,z.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),z.wipeCaches(),this.getScene().removeMesh(this),O&&this.material&&(this.material.getClassName()==="MultiMaterial"?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!E)for(F=0;F<this.getScene().particleSystems.length;F++)this.getScene().particleSystems[F].emitter===this&&(this.getScene().particleSystems[F].dispose(),F--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),b.prototype.dispose.call(this,E,O)},T.prototype.addChild=function(E){return E.setParent(this),this},T.prototype.removeChild=function(E){return E.setParent(null),this},T.prototype._initFacetData=function(){var E=this._internalAbstractMeshDataInfo._facetData;E.facetNormals||(E.facetNormals=new Array),E.facetPositions||(E.facetPositions=new Array),E.facetPartitioning||(E.facetPartitioning=new Array),E.facetNb=this.getIndices().length/3|0,E.partitioningSubdivisions=E.partitioningSubdivisions?E.partitioningSubdivisions:10,E.partitioningBBoxRatio=E.partitioningBBoxRatio?E.partitioningBBoxRatio:1.01;for(var O=0;O<E.facetNb;O++)E.facetNormals[O]=n.e.Zero(),E.facetPositions[O]=n.e.Zero();return E.facetDataEnabled=!0,this},T.prototype.updateFacetData=function(){var E=this._internalAbstractMeshDataInfo._facetData;E.facetDataEnabled||this._initFacetData();var O=this.getVerticesData(a.b.PositionKind),D=this.getIndices(),F=this.getVerticesData(a.b.NormalKind),x=this.getBoundingInfo();if(E.facetDepthSort&&!E.facetDepthSortEnabled){if(E.facetDepthSortEnabled=!0,D instanceof Uint16Array)E.depthSortedIndices=new Uint16Array(D);else if(D instanceof Uint32Array)E.depthSortedIndices=new Uint32Array(D);else{for(var j=!1,V=0;V<D.length;V++)if(D[V]>65535){j=!0;break}j?E.depthSortedIndices=new Uint32Array(D):E.depthSortedIndices=new Uint16Array(D)}if(E.facetDepthSortFunction=function(X,K){return K.sqDistance-X.sqDistance},!E.facetDepthSortFrom){var z=this.getScene().activeCamera;E.facetDepthSortFrom=z?z.position:n.e.Zero()}E.depthSortedFacets=[];for(var w=0;w<E.facetNb;w++){var R={ind:w*3,sqDistance:0};E.depthSortedFacets.push(R)}E.invertedMatrix=n.a.Identity(),E.facetDepthSortOrigin=n.e.Zero()}E.bbSize.x=x.maximum.x-x.minimum.x>r.a?x.maximum.x-x.minimum.x:r.a,E.bbSize.y=x.maximum.y-x.minimum.y>r.a?x.maximum.y-x.minimum.y:r.a,E.bbSize.z=x.maximum.z-x.minimum.z>r.a?x.maximum.z-x.minimum.z:r.a;var L=E.bbSize.x>E.bbSize.y?E.bbSize.x:E.bbSize.y;if(L=L>E.bbSize.z?L:E.bbSize.z,E.subDiv.max=E.partitioningSubdivisions,E.subDiv.X=Math.floor(E.subDiv.max*E.bbSize.x/L),E.subDiv.Y=Math.floor(E.subDiv.max*E.bbSize.y/L),E.subDiv.Z=Math.floor(E.subDiv.max*E.bbSize.z/L),E.subDiv.X=E.subDiv.X<1?1:E.subDiv.X,E.subDiv.Y=E.subDiv.Y<1?1:E.subDiv.Y,E.subDiv.Z=E.subDiv.Z<1?1:E.subDiv.Z,E.facetParameters.facetNormals=this.getFacetLocalNormals(),E.facetParameters.facetPositions=this.getFacetLocalPositions(),E.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),E.facetParameters.bInfo=x,E.facetParameters.bbSize=E.bbSize,E.facetParameters.subDiv=E.subDiv,E.facetParameters.ratio=this.partitioningBBoxRatio,E.facetParameters.depthSort=E.facetDepthSort,E.facetDepthSort&&E.facetDepthSortEnabled&&(this.computeWorldMatrix(!0),this._worldMatrix.invertToRef(E.invertedMatrix),n.e.TransformCoordinatesToRef(E.facetDepthSortFrom,E.invertedMatrix,E.facetDepthSortOrigin),E.facetParameters.distanceTo=E.facetDepthSortOrigin),E.facetParameters.depthSortedFacets=E.depthSortedFacets,_.a.ComputeNormals(O,D,F,E.facetParameters),E.facetDepthSort&&E.facetDepthSortEnabled){E.depthSortedFacets.sort(E.facetDepthSortFunction);for(var N=E.depthSortedIndices.length/3|0,w=0;w<N;w++){var B=E.depthSortedFacets[w].ind;E.depthSortedIndices[w*3]=D[B],E.depthSortedIndices[w*3+1]=D[B+1],E.depthSortedIndices[w*3+2]=D[B+2]}this.updateIndices(E.depthSortedIndices,void 0,!0)}return this},T.prototype.getFacetLocalNormals=function(){var E=this._internalAbstractMeshDataInfo._facetData;return E.facetNormals||this.updateFacetData(),E.facetNormals},T.prototype.getFacetLocalPositions=function(){var E=this._internalAbstractMeshDataInfo._facetData;return E.facetPositions||this.updateFacetData(),E.facetPositions},T.prototype.getFacetLocalPartitioning=function(){var E=this._internalAbstractMeshDataInfo._facetData;return E.facetPartitioning||this.updateFacetData(),E.facetPartitioning},T.prototype.getFacetPosition=function(E){var O=n.e.Zero();return this.getFacetPositionToRef(E,O),O},T.prototype.getFacetPositionToRef=function(E,O){var D=this.getFacetLocalPositions()[E],F=this.getWorldMatrix();return n.e.TransformCoordinatesToRef(D,F,O),this},T.prototype.getFacetNormal=function(E){var O=n.e.Zero();return this.getFacetNormalToRef(E,O),O},T.prototype.getFacetNormalToRef=function(E,O){var D=this.getFacetLocalNormals()[E];return n.e.TransformNormalToRef(D,this.getWorldMatrix(),O),this},T.prototype.getFacetsAtLocalCoordinates=function(E,O,D){var F=this.getBoundingInfo(),x=this._internalAbstractMeshDataInfo._facetData,j=Math.floor((E-F.minimum.x*x.partitioningBBoxRatio)*x.subDiv.X*x.partitioningBBoxRatio/x.bbSize.x),V=Math.floor((O-F.minimum.y*x.partitioningBBoxRatio)*x.subDiv.Y*x.partitioningBBoxRatio/x.bbSize.y),z=Math.floor((D-F.minimum.z*x.partitioningBBoxRatio)*x.subDiv.Z*x.partitioningBBoxRatio/x.bbSize.z);return j<0||j>x.subDiv.max||V<0||V>x.subDiv.max||z<0||z>x.subDiv.max?null:x.facetPartitioning[j+x.subDiv.max*V+x.subDiv.max*x.subDiv.max*z]},T.prototype.getClosestFacetAtCoordinates=function(E,O,D,F,x,j){x===void 0&&(x=!1),j===void 0&&(j=!0);var V=this.getWorldMatrix(),z=n.c.Matrix[5];V.invertToRef(z);var w=n.c.Vector3[8];n.e.TransformCoordinatesFromFloatsToRef(E,O,D,z,w);var R=this.getClosestFacetAtLocalCoordinates(w.x,w.y,w.z,F,x,j);return F&&n.e.TransformCoordinatesFromFloatsToRef(F.x,F.y,F.z,V,F),R},T.prototype.getClosestFacetAtLocalCoordinates=function(E,O,D,F,x,j){x===void 0&&(x=!1),j===void 0&&(j=!0);var V=null,z=0,w=0,R=0,L=0,N=0,B=0,X=0,K=0,G=this.getFacetLocalPositions(),I=this.getFacetLocalNormals(),A=this.getFacetsAtLocalCoordinates(E,O,D);if(!A)return null;for(var S=Number.MAX_VALUE,C=S,U,k,J,Y=0;Y<A.length;Y++)U=A[Y],k=I[U],J=G[U],L=(E-J.x)*k.x+(O-J.y)*k.y+(D-J.z)*k.z,(!x||x&&j&&L>=0||x&&!j&&L<=0)&&(L=k.x*J.x+k.y*J.y+k.z*J.z,N=-(k.x*E+k.y*O+k.z*D-L)/(k.x*k.x+k.y*k.y+k.z*k.z),B=E+k.x*N,X=O+k.y*N,K=D+k.z*N,z=B-E,w=X-O,R=K-D,C=z*z+w*w+R*R,C<S&&(S=C,V=U,F&&(F.x=B,F.y=X,F.z=K)));return V},T.prototype.getFacetDataParameters=function(){return this._internalAbstractMeshDataInfo._facetData.facetParameters},T.prototype.disableFacetData=function(){var E=this._internalAbstractMeshDataInfo._facetData;return E.facetDataEnabled&&(E.facetDataEnabled=!1,E.facetPositions=new Array,E.facetNormals=new Array,E.facetPartitioning=new Array,E.facetParameters=null,E.depthSortedIndices=new Uint32Array(0)),this},T.prototype.updateIndices=function(E,O,D){return D===void 0&&(D=!1),this},T.prototype.createNormals=function(E){var O=this.getVerticesData(a.b.PositionKind),D=this.getIndices(),F;return this.isVerticesDataPresent(a.b.NormalKind)?F=this.getVerticesData(a.b.NormalKind):F=[],_.a.ComputeNormals(O,D,F,{useRightHandedSystem:this.getScene().useRightHandedSystem}),this.setVerticesData(a.b.NormalKind,F,E),this},T.prototype.alignWithNormal=function(E,O){O||(O=o.a.Y);var D=n.c.Vector3[0],F=n.c.Vector3[1];return n.e.CrossToRef(O,E,F),n.e.CrossToRef(E,F,D),this.rotationQuaternion?n.b.RotationQuaternionFromAxisToRef(D,E,F,this.rotationQuaternion):n.e.RotationFromAxisToRef(D,E,F,this.rotation),this},T.prototype._checkOcclusionQuery=function(){return!1},T.prototype.disableEdgesRendering=function(){throw t.a.WarnImport("EdgesRenderer")},T.prototype.enableEdgesRendering=function(E,O,D){throw t.a.WarnImport("EdgesRenderer")},T.prototype.getConnectedParticleSystems=function(){var E=this;return this._scene.particleSystems.filter(function(O){return O.emitter===E})},T.OCCLUSION_TYPE_NONE=0,T.OCCLUSION_TYPE_OPTIMISTIC=1,T.OCCLUSION_TYPE_STRICT=2,T.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,T.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,T.CULLINGSTRATEGY_STANDARD=0,T.CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,T.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,T.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,T}(s.a);g.a.RegisteredTypes["BABYLON.AbstractMesh"]=f},,function($,W,M){"use strict";M.d(W,"a",function(){return m}),M.d(W,"c",function(){return n}),M.d(W,"d",function(){return c}),M.d(W,"b",function(){return a});var P=M(434),d=M(436),m=function(){function _(){}return _.POINTERDOWN=1,_.POINTERUP=2,_.POINTERMOVE=4,_.POINTERWHEEL=8,_.POINTERPICK=16,_.POINTERTAP=32,_.POINTERDOUBLETAP=64,_}(),n=function(){function _(s,u){this.type=s,this.event=u}return _}(),c=function(_){Object(P.d)(s,_);function s(u,p,l,h){var t=_.call(this,u,p)||this;return t.ray=null,t.skipOnPointerObservable=!1,t.localPosition=new d.d(l,h),t}return s}(n),a=function(_){Object(P.d)(s,_);function s(u,p,l){var h=_.call(this,u,p)||this;return h.pickInfo=l,h}return s}(n)},function($,W,M){"use strict";M.d(W,"c",function(){return d}),M.d(W,"a",function(){return m}),M.d(W,"b",function(){return n});var P=M(436),d;(function(c){c[c.LOCAL=0]="LOCAL",c[c.WORLD=1]="WORLD",c[c.BONE=2]="BONE"})(d||(d={}));var m=function(){function c(){}return c.X=new P.e(1,0,0),c.Y=new P.e(0,1,0),c.Z=new P.e(0,0,1),c}(),n;(function(c){c[c.X=0]="X",c[c.Y=1]="Y",c[c.Z=2]="Z"})(n||(n={}))},,function($,W,M){"use strict";M.d(W,"a",function(){return y});var P=M(448),d=M(435),m=M(476),n=M(438),c=M(681),a=M(682),_=M(713),s=M(456),u=M(440),p=M(660),l=function(){function v(){}return v.prototype.postProcessor=function(f,b,T,E,O){if(!O.getCaps().drawBuffersExtension){var D=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;f=f.replace(D,"")}return f},v}(),h=M(683),t=M(708),e=M(714),i=M(596),r=M(670),o=function(){function v(f,b){if(f===void 0&&(f=null),this._context=b,!f&&(f=b.createTexture(),!f))throw new Error("Unable to create webGL texture");this.set(f)}return Object.defineProperty(v.prototype,"underlyingResource",{get:function(){return this._webGLTexture},enumerable:!1,configurable:!0}),v.prototype.setUsage=function(f,b,T,E,O){},v.prototype.set=function(f){this._webGLTexture=f},v.prototype.reset=function(){this._webGLTexture=null},v.prototype.release=function(){this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()},v}(),g=function(){function v(){}return v}(),y=function(){function v(f,b,T,E){var O=this,D;this.forcePOTTextures=!1,this.isFullscreen=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this.validateShaderPrograms=!1,this.useReverseDepthBuffer=!1,this.disableUniformBuffers=!1,this.onDisposeObservable=new n.c,this._frameId=0,this._uniformBuffers=new Array,this._webGLVersion=1,this._windowIsBackground=!1,this._highPrecisionShadersAllowed=!0,this._badOS=!1,this._badDesktopOS=!1,this._renderingQueueLaunched=!1,this._activeRenderLoops=new Array,this.onContextLostObservable=new n.c,this.onContextRestoredObservable=new n.c,this._contextWasLost=!1,this._doNotHandleContextLost=!1,this.disableVertexArrayObjects=!1,this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new c.a,this._stencilState=new a.a,this._alphaState=new _.a,this._alphaMode=1,this._alphaEquation=0,this._internalTexturesCache=new Array,this._activeChannel=0,this._currentTextureChannel=-1,this._boundTexturesCache={},this._compiledEffects={},this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._activeRequests=new Array,this._transformTextureUrl=null,this.hostInformation={isMobile:!1},this.premultipliedAlpha=!0,this.onBeforeTextureInitObservable=new n.c,this._isWebGPU=!1,this._viewportCached={x:0,y:0,z:0,w:0},this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._getDepthStencilBuffer=function(Y,Z,Q,te,re,ae){var ne=O._gl,ie=ne.createRenderbuffer();return ne.bindRenderbuffer(ne.RENDERBUFFER,ie),Q>1&&ne.renderbufferStorageMultisample?ne.renderbufferStorageMultisample(ne.RENDERBUFFER,Q,re,Y,Z):ne.renderbufferStorage(ne.RENDERBUFFER,te,Y,Z),ne.framebufferRenderbuffer(ne.FRAMEBUFFER,ae,ne.RENDERBUFFER,ie),ne.bindRenderbuffer(ne.RENDERBUFFER,null),ie},this._boundUniforms={};var F=null;if(T=T||{},r.a.SetMatrixPrecision(!!T.useHighPrecisionMatrix),!!f){if(E=(D=E!=null?E:T.adaptToDeviceRatio)!==null&&D!==void 0?D:!1,f.getContext){if(F=f,this._renderingCanvas=F,b!==void 0&&(T.antialias=b),T.deterministicLockstep===void 0&&(T.deterministicLockstep=!1),T.lockstepMaxSteps===void 0&&(T.lockstepMaxSteps=4),T.timeStep===void 0&&(T.timeStep=1/60),T.preserveDrawingBuffer===void 0&&(T.preserveDrawingBuffer=!1),T.audioEngine===void 0&&(T.audioEngine=!0),T.stencil===void 0&&(T.stencil=!0),T.premultipliedAlpha===!1&&(this.premultipliedAlpha=!1),T.xrCompatible===void 0&&(T.xrCompatible=!0),this._doNotHandleContextLost=!!T.doNotHandleContextLost,navigator&&navigator.userAgent){var x=navigator.userAgent;this.hostInformation.isMobile=x.indexOf("Mobile")!==-1;for(var j=0,V=v.ExceptionList;j<V.length;j++){var z=V[j],w=z.key,R=z.targets,L=new RegExp(w);if(L.test(x)){if(z.capture&&z.captureConstraint){var N=z.capture,B=z.captureConstraint,X=new RegExp(N),K=X.exec(x);if(K&&K.length>0){var G=parseInt(K[K.length-1]);if(G>=B)continue}}for(var I=0,A=R;I<A.length;I++){var S=A[I];switch(S){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break}}}}}if(this._doNotHandleContextLost||(this._onContextLost=function(Y){Y.preventDefault(),O._contextWasLost=!0,u.a.Warn("WebGL context lost."),O.onContextLostObservable.notifyObservers(O)},this._onContextRestored=function(){setTimeout(function(){O._initGLContext(),O._rebuildEffects(),O._rebuildInternalTextures(),O._rebuildBuffers(),O.wipeCaches(!0),u.a.Warn("WebGL context successfully restored."),O.onContextRestoredObservable.notifyObservers(O),O._contextWasLost=!1},0)},F.addEventListener("webglcontextlost",this._onContextLost,!1),F.addEventListener("webglcontextrestored",this._onContextRestored,!1),T.powerPreference="high-performance"),!T.disableWebGL2Support)try{this._gl=F.getContext("webgl2",T)||F.getContext("experimental-webgl2",T),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(Y){}if(!this._gl){if(!F)throw new Error("The provided canvas is null or undefined.");try{this._gl=F.getContext("webgl",T)||F.getContext("experimental-webgl",T)}catch(Y){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=f,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";var C=this._gl.getContextAttributes();C&&(T.stencil=C.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),T.useHighPrecisionFloats!==void 0&&(this._highPrecisionShadersAllowed=T.useHighPrecisionFloats);var U=p.a.IsWindowObjectExist()&&window.devicePixelRatio||1,k=T.limitDeviceRatio||U;this._hardwareScalingLevel=E?1/Math.min(k,U):1,this.resize(),this._isStencilEnable=!!T.stencil,this._initGLContext(),this._initFeatures();for(var J=0;J<this._caps.maxVertexAttribs;J++)this._currentBufferPointers[J]=new g;this._shaderProcessor=this._getShaderProcessor(),this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this._creationOptions=T,console.log("Babylon.js v"+v.Version+" - "+this.description)}}return Object.defineProperty(v,"NpmPackage",{get:function(){return"babylonjs@5.0.0-alpha.12"},enumerable:!1,configurable:!0}),Object.defineProperty(v,"Version",{get:function(){return"5.0.0-alpha.12"},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"description",{get:function(){var f=this.name+this.webGLVersion;return this._caps.parallelShaderCompile&&(f+=" - Parallel shader compilation"),f},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"name",{get:function(){return"WebGL"},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"version",{get:function(){return this._webGLVersion},enumerable:!1,configurable:!0}),Object.defineProperty(v,"ShadersRepository",{get:function(){return d.a.ShadersRepository},set:function(f){d.a.ShadersRepository=f},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"frameId",{get:function(){return this._frameId},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"supportsUniformBuffers",{get:function(){return this.webGLVersion>1&&!this.disableUniformBuffers},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"_shouldUseHighPrecisionShader",{get:function(){return!!(this._caps.highPrecisionShaderSupported&&this._highPrecisionShadersAllowed)},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"needPOTTextures",{get:function(){return this._webGLVersion<2||this.forcePOTTextures},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"activeRenderLoops",{get:function(){return this._activeRenderLoops},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"doNotHandleContextLost",{get:function(){return this._doNotHandleContextLost},set:function(f){this._doNotHandleContextLost=f},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"framebufferDimensionsObject",{set:function(f){this._framebufferDimensionsObject=f},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"currentViewport",{get:function(){return this._cachedViewport},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"emptyTexture",{get:function(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"emptyTexture3D",{get:function(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"emptyTexture2DArray",{get:function(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"emptyCubeTexture",{get:function(){if(!this._emptyCubeTexture){var f=new Uint8Array(4),b=[f,f,f,f,f,f];this._emptyCubeTexture=this.createRawCubeTexture(b,1,5,0,!1,!1,1)}return this._emptyCubeTexture},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"isWebGPU",{get:function(){return this._isWebGPU},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"shaderPlatformName",{get:function(){return this._shaderPlatformName},enumerable:!1,configurable:!0}),v.prototype._debugPushGroup=function(f,b){},v.prototype._debugPopGroup=function(f){},v.prototype._debugInsertMarker=function(f,b){},v.prototype._sharedInit=function(f,b,T){this._renderingCanvas=f},v.prototype._getShaderProcessor=function(){return this.webGLVersion>1?new h.a:new l},v.prototype._getShaderProcessingContext=function(){return null},v.prototype._rebuildInternalTextures=function(){for(var f=this._internalTexturesCache.slice(),b=0,T=f;b<T.length;b++){var E=T[b];E._rebuild()}},v.prototype._rebuildEffects=function(){for(var f in this._compiledEffects){var b=this._compiledEffects[f];b._prepareEffect()}d.a.ResetCache()},v.prototype.areAllEffectsReady=function(){for(var f in this._compiledEffects){var b=this._compiledEffects[f];if(!b.isReady())return!1}return!0},v.prototype._rebuildBuffers=function(){for(var f=0,b=this._uniformBuffers;f<b.length;f++){var T=b[f];T._rebuild()}},v.prototype._initGLContext=function(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile"),standardDerivatives:this._webGLVersion>1||this._gl.getExtension("OES_standard_derivatives")!==null,maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||this._gl.getExtension("OES_element_index_uint")!==null,fragmentDepthSupported:this._webGLVersion>1||this._gl.getExtension("EXT_frag_depth")!==null,highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float"),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:!(this._badOS&&this._webGLVersion<=1),canUseGLVertexID:this._webGLVersion>1},this._glVersion=this._gl.getParameter(this._gl.VERSION);var f=this._gl.getExtension("WEBGL_debug_renderer_info");if(f!=null&&(this._glRenderer=this._gl.getParameter(f.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(f.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor="Unknown vendor"),this._glRenderer||(this._glRenderer="Unknown renderer"),this._gl.HALF_FLOAT_OES!==36193&&(this._gl.HALF_FLOAT_OES=36193),this._gl.RGBA16F!==34842&&(this._gl.RGBA16F=34842),this._gl.RGBA32F!==34836&&(this._gl.RGBA32F=34836),this._gl.DEPTH24_STENCIL8!==35056&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(this._webGLVersion===1&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!!(this._caps.textureFloat&&this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!!(this._caps.textureFloat&&this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._webGLVersion>1&&this._gl.HALF_FLOAT_OES!==5131&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=this._gl.getParameter(this._gl.MAX_SAMPLES);else{var b=this._gl.getExtension("WEBGL_draw_buffers");if(b!==null){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=b.drawBuffersWEBGL.bind(b),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(var T=0;T<16;T++)this._gl["COLOR_ATTACHMENT"+T+"_WEBGL"]=b["COLOR_ATTACHMENT"+T+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{var E=this._gl.getExtension("WEBGL_depth_texture");E!=null&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=E.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{var O=this._gl.getExtension("OES_vertex_array_object");O!=null&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=O.createVertexArrayOES.bind(O),this._gl.bindVertexArray=O.bindVertexArrayOES.bind(O),this._gl.deleteVertexArray=O.deleteVertexArrayOES.bind(O))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{var D=this._gl.getExtension("ANGLE_instanced_arrays");D!=null?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=D.drawArraysInstancedANGLE.bind(D),this._gl.drawElementsInstanced=D.drawElementsInstancedANGLE.bind(D),this._gl.vertexAttribDivisor=D.vertexAttribDivisorANGLE.bind(D)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){var F=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),x=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);F&&x&&(this._caps.highPrecisionShaderSupported=F.precision!==0&&x.precision!==0)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{var j=this._gl.getExtension("EXT_blend_minmax");j!=null&&(this._caps.blendMinMax=!0,this._gl.MAX=j.MAX_EXT,this._gl.MIN=j.MIN_EXT)}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(var V=0;V<this._maxSimultaneousTextures;V++)this._nextFreeTextureSlots.push(V)},v.prototype._initFeatures=function(){this._features={forceBitmapOverHTMLImageElement:!1,supportRenderAndCopyToLodForFloatTextures:this._webGLVersion!==1,supportDepthStencilTexture:this._webGLVersion!==1,supportShadowSamplers:this._webGLVersion!==1,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:this._webGLVersion!==1,trackUbosInFrame:!1,supportCSM:this._webGLVersion!==1,basisNeedsPOT:this._webGLVersion===1,support3DTextures:this._webGLVersion!==1,needTypeSuffixInShaderConstants:this._webGLVersion!==1,supportMSAA:this._webGLVersion!==1,supportSSAO2:this._webGLVersion!==1,supportExtendedTextureFormats:this._webGLVersion!==1,supportSwitchCaseInShader:this._webGLVersion!==1,supportSyncTextureRead:!0,needsInvertingBitmap:!0,_collectUbosUpdatedInFrame:!1}},Object.defineProperty(v.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!1,configurable:!0}),v.prototype.getClassName=function(){return"ThinEngine"},Object.defineProperty(v.prototype,"isStencilEnable",{get:function(){return this._isStencilEnable},enumerable:!1,configurable:!0}),v.prototype._prepareWorkingCanvas=function(){if(!this._workingCanvas){this._workingCanvas=i.a.CreateCanvas(1,1);var f=this._workingCanvas.getContext("2d");f&&(this._workingContext=f)}},v.prototype.resetTextureCache=function(){for(var f in this._boundTexturesCache)!this._boundTexturesCache.hasOwnProperty(f)||(this._boundTexturesCache[f]=null);this._currentTextureChannel=-1},v.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},v.prototype.setHardwareScalingLevel=function(f){this._hardwareScalingLevel=f,this.resize()},v.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},v.prototype.getLoadedTexturesCache=function(){return this._internalTexturesCache},v.prototype.getCaps=function(){return this._caps},v.prototype.stopRenderLoop=function(f){if(!f){this._activeRenderLoops=[];return}var b=this._activeRenderLoops.indexOf(f);b>=0&&this._activeRenderLoops.splice(b,1)},v.prototype._renderLoop=function(){if(!this._contextWasLost){var f=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(f=!1),f){this.beginFrame();for(var b=0;b<this._activeRenderLoops.length;b++){var T=this._activeRenderLoops[b];T()}this.endFrame()}}this._activeRenderLoops.length>0?this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},v.prototype.getRenderingCanvas=function(){return this._renderingCanvas},v.prototype.getHostWindow=function(){return p.a.IsWindowObjectExist()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null},v.prototype.getRenderWidth=function(f){return f===void 0&&(f=!1),!f&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth},v.prototype.getRenderHeight=function(f){return f===void 0&&(f=!1),!f&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight},v.prototype._queueNewFrame=function(f,b){return v.QueueNewFrame(f,b)},v.prototype.runRenderLoop=function(f){this._activeRenderLoops.indexOf(f)===-1&&(this._activeRenderLoops.push(f),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._boundRenderFunction=this._renderLoop.bind(this),this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))},v.prototype.clear=function(f,b,T,E){E===void 0&&(E=!1),this.applyStates();var O=0;b&&f&&(this._gl.clearColor(f.r,f.g,f.b,f.a!==void 0?f.a:1),O|=this._gl.COLOR_BUFFER_BIT),T&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GREATER,this._gl.clearDepth(0)):this._gl.clearDepth(1),O|=this._gl.DEPTH_BUFFER_BIT),E&&(this._gl.clearStencil(0),O|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(O)},v.prototype._viewport=function(f,b,T,E){(f!==this._viewportCached.x||b!==this._viewportCached.y||T!==this._viewportCached.z||E!==this._viewportCached.w)&&(this._viewportCached.x=f,this._viewportCached.y=b,this._viewportCached.z=T,this._viewportCached.w=E,this._gl.viewport(f,b,T,E))},v.prototype.setViewport=function(f,b,T){var E=b||this.getRenderWidth(),O=T||this.getRenderHeight(),D=f.x||0,F=f.y||0;this._cachedViewport=f,this._viewport(D*E,F*O,E*f.width,O*f.height)},v.prototype.beginFrame=function(){},v.prototype.endFrame=function(){this._badOS&&this.flushFramebuffer(),this._frameId++},v.prototype.resize=function(f){f===void 0&&(f=!1);var b,T;p.a.IsWindowObjectExist()?(b=this._renderingCanvas?this._renderingCanvas.clientWidth||this._renderingCanvas.width:window.innerWidth,T=this._renderingCanvas?this._renderingCanvas.clientHeight||this._renderingCanvas.height:window.innerHeight):(b=this._renderingCanvas?this._renderingCanvas.width:100,T=this._renderingCanvas?this._renderingCanvas.height:100),this.setSize(b/this._hardwareScalingLevel,T/this._hardwareScalingLevel,f)},v.prototype.setSize=function(f,b,T){return T===void 0&&(T=!1),!this._renderingCanvas||(f=f|0,b=b|0,!T&&this._renderingCanvas.width===f&&this._renderingCanvas.height===b)?!1:(this._renderingCanvas.width=f,this._renderingCanvas.height=b,!0)},v.prototype.bindFramebuffer=function(f,b,T,E,O,D,F){var x,j,V,z,w;b===void 0&&(b=0),D===void 0&&(D=0),F===void 0&&(F=0),this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=f,this._bindUnboundFramebuffer(f._MSAAFramebuffer?f._MSAAFramebuffer:f._framebuffer);var R=this._gl;f.is2DArray?R.framebufferTextureLayer(R.FRAMEBUFFER,R.COLOR_ATTACHMENT0,(x=f._hardwareTexture)===null||x===void 0?void 0:x.underlyingResource,D,F):f.isCube&&R.framebufferTexture2D(R.FRAMEBUFFER,R.COLOR_ATTACHMENT0,R.TEXTURE_CUBE_MAP_POSITIVE_X+b,(j=f._hardwareTexture)===null||j===void 0?void 0:j.underlyingResource,D);var L=f._depthStencilTexture;if(L){var N=L._generateStencilBuffer?R.DEPTH_STENCIL_ATTACHMENT:R.DEPTH_ATTACHMENT;f.is2DArray?R.framebufferTextureLayer(R.FRAMEBUFFER,N,(V=L._hardwareTexture)===null||V===void 0?void 0:V.underlyingResource,D,F):f.isCube?R.framebufferTexture2D(R.FRAMEBUFFER,N,R.TEXTURE_CUBE_MAP_POSITIVE_X+b,(z=L._hardwareTexture)===null||z===void 0?void 0:z.underlyingResource,D):R.framebufferTexture2D(R.FRAMEBUFFER,N,R.TEXTURE_2D,(w=L._hardwareTexture)===null||w===void 0?void 0:w.underlyingResource,D)}this._cachedViewport&&!O?this.setViewport(this._cachedViewport,T,E):(T||(T=f.width,D&&(T=T/Math.pow(2,D))),E||(E=f.height,D&&(E=E/Math.pow(2,D))),this._viewport(0,0,T,E)),this.wipeCaches()},v.prototype._bindUnboundFramebuffer=function(f){this._currentFramebuffer!==f&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,f),this._currentFramebuffer=f)},v.prototype.unBindFramebuffer=function(f,b,T){b===void 0&&(b=!1),this._currentRenderTarget=null;var E=this._gl;if(f._MSAAFramebuffer){if(f._textureArray){this.unBindMultiColorAttachmentFramebuffer(f._textureArray,b,T);return}E.bindFramebuffer(E.READ_FRAMEBUFFER,f._MSAAFramebuffer),E.bindFramebuffer(E.DRAW_FRAMEBUFFER,f._framebuffer),E.blitFramebuffer(0,0,f.width,f.height,0,0,f.width,f.height,E.COLOR_BUFFER_BIT,E.NEAREST)}f.generateMipMaps&&!b&&!f.isCube&&(this._bindTextureDirectly(E.TEXTURE_2D,f,!0),E.generateMipmap(E.TEXTURE_2D),this._bindTextureDirectly(E.TEXTURE_2D,null)),T&&(f._MSAAFramebuffer&&this._bindUnboundFramebuffer(f._framebuffer),T()),this._bindUnboundFramebuffer(null)},v.prototype.flushFramebuffer=function(){this._gl.flush()},v.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()},v.prototype._resetVertexBufferBinding=function(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null},v.prototype.createVertexBuffer=function(f){return this._createVertexBuffer(f,this._gl.STATIC_DRAW)},v.prototype._createVertexBuffer=function(f,b){var T=this._gl.createBuffer();if(!T)throw new Error("Unable to create vertex buffer");var E=new t.a(T);return this.bindArrayBuffer(E),f instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(f),this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,f,this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),E.references=1,E},v.prototype.createDynamicVertexBuffer=function(f){return this._createVertexBuffer(f,this._gl.DYNAMIC_DRAW)},v.prototype._resetIndexBufferBinding=function(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null},v.prototype.createIndexBuffer=function(f,b){var T=this._gl.createBuffer(),E=new t.a(T);if(!T)throw new Error("Unable to create index buffer");this.bindIndexBuffer(E);var O=this._normalizeIndexData(f);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,O,b?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),E.references=1,E.is32Bits=O.BYTES_PER_ELEMENT===4,E},v.prototype._normalizeIndexData=function(f){if(f instanceof Uint16Array)return f;if(this._caps.uintIndices){if(f instanceof Uint32Array)return f;for(var b=0;b<f.length;b++)if(f[b]>=65535)return new Uint32Array(f);return new Uint16Array(f)}return new Uint16Array(f)},v.prototype.bindArrayBuffer=function(f){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(f,this._gl.ARRAY_BUFFER)},v.prototype.bindUniformBlock=function(f,b,T){var E=f.program,O=this._gl.getUniformBlockIndex(E,b);this._gl.uniformBlockBinding(E,O,T)},v.prototype.bindIndexBuffer=function(f){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(f,this._gl.ELEMENT_ARRAY_BUFFER)},v.prototype.bindBuffer=function(f,b){(this._vaoRecordInProgress||this._currentBoundBuffer[b]!==f)&&(this._gl.bindBuffer(b,f?f.underlyingResource:null),this._currentBoundBuffer[b]=f)},v.prototype.updateArrayBuffer=function(f){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,f)},v.prototype._vertexAttribPointer=function(f,b,T,E,O,D,F){var x=this._currentBufferPointers[b];if(!!x){var j=!1;x.active?(x.buffer!==f&&(x.buffer=f,j=!0),x.size!==T&&(x.size=T,j=!0),x.type!==E&&(x.type=E,j=!0),x.normalized!==O&&(x.normalized=O,j=!0),x.stride!==D&&(x.stride=D,j=!0),x.offset!==F&&(x.offset=F,j=!0)):(j=!0,x.active=!0,x.index=b,x.size=T,x.type=E,x.normalized=O,x.stride=D,x.offset=F,x.buffer=f),(j||this._vaoRecordInProgress)&&(this.bindArrayBuffer(f),this._gl.vertexAttribPointer(b,T,E,O,D,F))}},v.prototype._bindIndexBufferWithCache=function(f){f!=null&&this._cachedIndexBuffer!==f&&(this._cachedIndexBuffer=f,this.bindIndexBuffer(f),this._uintIndicesCurrentlySet=f.is32Bits)},v.prototype._bindVertexBuffersAttributes=function(f,b,T){var E=b.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var O=0;O<E.length;O++){var D=b.getAttributeLocation(O);if(D>=0){var F=E[O],x=null;if(T&&(x=T[F]),x||(x=f[F]),!x)continue;this._gl.enableVertexAttribArray(D),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[D]=!0);var j=x.getBuffer();j&&(this._vertexAttribPointer(j,D,x.getSize(),x.type,x.normalized,x.byteStride,x.byteOffset),x.getIsInstanced()&&(this._gl.vertexAttribDivisor(D,x.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(D),this._currentInstanceBuffers.push(j))))}}},v.prototype.recordVertexArrayObject=function(f,b,T,E){var O=this._gl.createVertexArray();return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(O),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(f,T,E),this.bindIndexBuffer(b),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),O},v.prototype.bindVertexArrayObject=function(f,b){this._cachedVertexArrayObject!==f&&(this._cachedVertexArrayObject=f,this._gl.bindVertexArray(f),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=b!=null&&b.is32Bits,this._mustWipeVertexAttributes=!0)},v.prototype.bindBuffersDirectly=function(f,b,T,E,O){if(this._cachedVertexBuffers!==f||this._cachedEffectForVertexBuffers!==O){this._cachedVertexBuffers=f,this._cachedEffectForVertexBuffers=O;var D=O.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var F=0,x=0;x<D;x++)if(x<T.length){var j=O.getAttributeLocation(x);j>=0&&(this._gl.enableVertexAttribArray(j),this._vertexAttribArraysEnabled[j]=!0,this._vertexAttribPointer(f,j,T[x],this._gl.FLOAT,!1,E,F)),F+=T[x]*4}}this._bindIndexBufferWithCache(b)},v.prototype._unbindVertexArrayObject=function(){!this._cachedVertexArrayObject||(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))},v.prototype.bindBuffers=function(f,b,T,E){(this._cachedVertexBuffers!==f||this._cachedEffectForVertexBuffers!==T)&&(this._cachedVertexBuffers=f,this._cachedEffectForVertexBuffers=T,this._bindVertexBuffersAttributes(f,T,E)),this._bindIndexBufferWithCache(b)},v.prototype.unbindInstanceAttributes=function(){for(var f,b=0,T=this._currentInstanceLocations.length;b<T;b++){var E=this._currentInstanceBuffers[b];f!=E&&E.references&&(f=E,this.bindArrayBuffer(E));var O=this._currentInstanceLocations[b];this._gl.vertexAttribDivisor(O,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0},v.prototype.releaseVertexArrayObject=function(f){this._gl.deleteVertexArray(f)},v.prototype._releaseBuffer=function(f){return f.references--,f.references===0?(this._deleteBuffer(f),!0):!1},v.prototype._deleteBuffer=function(f){this._gl.deleteBuffer(f.underlyingResource)},v.prototype.updateAndBindInstancesBuffer=function(f,b,T){if(this.bindArrayBuffer(f),b&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,b),T[0].index!==void 0)this.bindInstancesBuffer(f,T,!0);else for(var E=0;E<4;E++){var O=T[E];this._vertexAttribArraysEnabled[O]||(this._gl.enableVertexAttribArray(O),this._vertexAttribArraysEnabled[O]=!0),this._vertexAttribPointer(f,O,4,this._gl.FLOAT,!1,64,E*16),this._gl.vertexAttribDivisor(O,1),this._currentInstanceLocations.push(O),this._currentInstanceBuffers.push(f)}},v.prototype.bindInstancesBuffer=function(f,b,T){T===void 0&&(T=!0),this.bindArrayBuffer(f);var E=0;if(T)for(var O=0;O<b.length;O++){var D=b[O];E+=D.attributeSize*4}for(var O=0;O<b.length;O++){var D=b[O];D.index===void 0&&(D.index=this._currentEffect.getAttributeLocationByName(D.attributeName)),!(D.index<0)&&(this._vertexAttribArraysEnabled[D.index]||(this._gl.enableVertexAttribArray(D.index),this._vertexAttribArraysEnabled[D.index]=!0),this._vertexAttribPointer(f,D.index,D.attributeSize,D.attributeType||this._gl.FLOAT,D.normalized||!1,E,D.offset),this._gl.vertexAttribDivisor(D.index,D.divisor===void 0?1:D.divisor),this._currentInstanceLocations.push(D.index),this._currentInstanceBuffers.push(f))}},v.prototype.disableInstanceAttributeByName=function(f){if(!!this._currentEffect){var b=this._currentEffect.getAttributeLocationByName(f);this.disableInstanceAttribute(b)}},v.prototype.disableInstanceAttribute=function(f){for(var b=!1,T;(T=this._currentInstanceLocations.indexOf(f))!==-1;)this._currentInstanceLocations.splice(T,1),this._currentInstanceBuffers.splice(T,1),b=!0,T=this._currentInstanceLocations.indexOf(f);b&&(this._gl.vertexAttribDivisor(f,0),this.disableAttributeByIndex(f))},v.prototype.disableAttributeByIndex=function(f){this._gl.disableVertexAttribArray(f),this._vertexAttribArraysEnabled[f]=!1,this._currentBufferPointers[f].active=!1},v.prototype.draw=function(f,b,T,E){this.drawElementsType(f?0:1,b,T,E)},v.prototype.drawPointClouds=function(f,b,T){this.drawArraysType(2,f,b,T)},v.prototype.drawUnIndexed=function(f,b,T,E){this.drawArraysType(f?0:1,b,T,E)},v.prototype.drawElementsType=function(f,b,T,E){this.applyStates(),this._reportDrawCall();var O=this._drawMode(f),D=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,F=this._uintIndicesCurrentlySet?4:2;E?this._gl.drawElementsInstanced(O,T,D,b*F,E):this._gl.drawElements(O,T,D,b*F)},v.prototype.drawArraysType=function(f,b,T,E){this.applyStates(),this._reportDrawCall();var O=this._drawMode(f);E?this._gl.drawArraysInstanced(O,b,T,E):this._gl.drawArrays(O,b,T)},v.prototype._drawMode=function(f){switch(f){case 0:return this._gl.TRIANGLES;case 2:return this._gl.POINTS;case 1:return this._gl.LINES;case 3:return this._gl.POINTS;case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN;default:return this._gl.TRIANGLES}},v.prototype._reportDrawCall=function(){},v.prototype._releaseEffect=function(f){this._compiledEffects[f._key]&&(delete this._compiledEffects[f._key],this._deletePipelineContext(f.getPipelineContext()))},v.prototype._deletePipelineContext=function(f){var b=f;b&&b.program&&(b.program.__SPECTOR_rebuildProgram=null,this._gl.deleteProgram(b.program))},v.prototype.createEffect=function(f,b,T,E,O,D,F,x,j){var V=f.vertexElement||f.vertex||f.vertexToken||f.vertexSource||f,z=f.fragmentElement||f.fragment||f.fragmentToken||f.fragmentSource||f,w=V+"+"+z+"@"+(O||b.defines);if(this._compiledEffects[w]){var R=this._compiledEffects[w];return F&&R.isReady()&&F(R),R}var L=new d.a(f,b,T,E,this,O,D,F,x,j,w);return this._compiledEffects[w]=L,L},v._ConcatenateShader=function(f,b,T){return T===void 0&&(T=""),T+(b?b+`
`:"")+f},v.prototype._compileShader=function(f,b,T,E){return this._compileRawShader(v._ConcatenateShader(f,T,E),b)},v.prototype._compileRawShader=function(f,b){for(var T=this._gl;T.getError()!=T.NO_ERROR;);var E=T.createShader(b==="vertex"?T.VERTEX_SHADER:T.FRAGMENT_SHADER);if(!E)throw new Error("Something went wrong while creating a gl "+b+" shader object. gl error="+T.getError()+", gl isContextLost="+T.isContextLost()+", _contextWasLost="+this._contextWasLost);return T.shaderSource(E,f),T.compileShader(E),E},v.prototype._getShaderSource=function(f){return this._gl.getShaderSource(f)},v.prototype.createRawShaderProgram=function(f,b,T,E,O){O===void 0&&(O=null),E=E||this._gl;var D=this._compileRawShader(b,"vertex"),F=this._compileRawShader(T,"fragment");return this._createShaderProgram(f,D,F,E,O)},v.prototype.createShaderProgram=function(f,b,T,E,O,D){D===void 0&&(D=null),O=O||this._gl;var F=this._webGLVersion>1?`#version 300 es
#define WEBGL2 
`:"",x=this._compileShader(b,"vertex",E,F),j=this._compileShader(T,"fragment",E,F);return this._createShaderProgram(f,x,j,O,D)},v.prototype.createPipelineContext=function(f){var b=new e.a;return b.engine=this,this._caps.parallelShaderCompile&&(b.isParallelCompiled=!0),b},v.prototype._createShaderProgram=function(f,b,T,E,O){O===void 0&&(O=null);var D=E.createProgram();if(f.program=D,!D)throw new Error("Unable to create program");return E.attachShader(D,b),E.attachShader(D,T),E.linkProgram(D),f.context=E,f.vertexShader=b,f.fragmentShader=T,f.isParallelCompiled||this._finalizePipelineContext(f),D},v.prototype._finalizePipelineContext=function(f){var b=f.context,T=f.vertexShader,E=f.fragmentShader,O=f.program,D=b.getProgramParameter(O,b.LINK_STATUS);if(!D){if(!this._gl.getShaderParameter(T,this._gl.COMPILE_STATUS)){var F=this._gl.getShaderInfoLog(T);if(F)throw f.vertexCompilationError=F,new Error("VERTEX SHADER "+F)}if(!this._gl.getShaderParameter(E,this._gl.COMPILE_STATUS)){var F=this._gl.getShaderInfoLog(E);if(F)throw f.fragmentCompilationError=F,new Error("FRAGMENT SHADER "+F)}var x=b.getProgramInfoLog(O);if(x)throw f.programLinkError=x,new Error(x)}if(this.validateShaderPrograms){b.validateProgram(O);var j=b.getProgramParameter(O,b.VALIDATE_STATUS);if(!j){var x=b.getProgramInfoLog(O);if(x)throw f.programValidationError=x,new Error(x)}}b.deleteShader(T),b.deleteShader(E),f.vertexShader=void 0,f.fragmentShader=void 0,f.onCompiled&&(f.onCompiled(),f.onCompiled=void 0)},v.prototype._preparePipelineContext=function(f,b,T,E,O,D,F,x,j,V){var z=f;E?z.program=this.createRawShaderProgram(z,b,T,void 0,j):z.program=this.createShaderProgram(z,b,T,x,void 0,j),z.program.__SPECTOR_rebuildProgram=F},v.prototype._isRenderingStateCompiled=function(f){var b=f;return this._gl.getProgramParameter(b.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)?(this._finalizePipelineContext(b),!0):!1},v.prototype._executeWhenRenderingStateIsCompiled=function(f,b){var T=f;if(!T.isParallelCompiled){b();return}var E=T.onCompiled;E?T.onCompiled=function(){E(),b()}:T.onCompiled=b},v.prototype.getUniforms=function(f,b){for(var T=new Array,E=f,O=0;O<b.length;O++)T.push(this._gl.getUniformLocation(E.program,b[O]));return T},v.prototype.getAttributes=function(f,b){for(var T=[],E=f,O=0;O<b.length;O++)try{T.push(this._gl.getAttribLocation(E.program,b[O]))}catch(D){T.push(-1)}return T},v.prototype.enableEffect=function(f){!f||f===this._currentEffect||(this.bindSamplers(f),this._currentEffect=f,f.onBind&&f.onBind(f),f._onBindObservable&&f._onBindObservable.notifyObservers(f))},v.prototype.setInt=function(f,b){return f?(this._gl.uniform1i(f,b),!0):!1},v.prototype.setInt2=function(f,b,T){return f?(this._gl.uniform2i(f,b,T),!0):!1},v.prototype.setInt3=function(f,b,T,E){return f?(this._gl.uniform3i(f,b,T,E),!0):!1},v.prototype.setInt4=function(f,b,T,E,O){return f?(this._gl.uniform4i(f,b,T,E,O),!0):!1},v.prototype.setIntArray=function(f,b){return f?(this._gl.uniform1iv(f,b),!0):!1},v.prototype.setIntArray2=function(f,b){return!f||b.length%2!=0?!1:(this._gl.uniform2iv(f,b),!0)},v.prototype.setIntArray3=function(f,b){return!f||b.length%3!=0?!1:(this._gl.uniform3iv(f,b),!0)},v.prototype.setIntArray4=function(f,b){return!f||b.length%4!=0?!1:(this._gl.uniform4iv(f,b),!0)},v.prototype.setArray=function(f,b){return!f||b.length<1?!1:(this._gl.uniform1fv(f,b),!0)},v.prototype.setArray2=function(f,b){return!f||b.length%2!=0?!1:(this._gl.uniform2fv(f,b),!0)},v.prototype.setArray3=function(f,b){return!f||b.length%3!=0?!1:(this._gl.uniform3fv(f,b),!0)},v.prototype.setArray4=function(f,b){return!f||b.length%4!=0?!1:(this._gl.uniform4fv(f,b),!0)},v.prototype.setMatrices=function(f,b){return f?(this._gl.uniformMatrix4fv(f,!1,b),!0):!1},v.prototype.setMatrix3x3=function(f,b){return f?(this._gl.uniformMatrix3fv(f,!1,b),!0):!1},v.prototype.setMatrix2x2=function(f,b){return f?(this._gl.uniformMatrix2fv(f,!1,b),!0):!1},v.prototype.setFloat=function(f,b){return f?(this._gl.uniform1f(f,b),!0):!1},v.prototype.setFloat2=function(f,b,T){return f?(this._gl.uniform2f(f,b,T),!0):!1},v.prototype.setFloat3=function(f,b,T,E){return f?(this._gl.uniform3f(f,b,T,E),!0):!1},v.prototype.setFloat4=function(f,b,T,E,O){return f?(this._gl.uniform4f(f,b,T,E,O),!0):!1},v.prototype.applyStates=function(){if(this._depthCullingState.apply(this._gl),this._stencilState.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;var f=this._colorWrite;this._gl.colorMask(f,f,f,f)}},v.prototype.setColorWrite=function(f){f!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=f)},v.prototype.getColorWrite=function(){return this._colorWrite},Object.defineProperty(v.prototype,"depthCullingState",{get:function(){return this._depthCullingState},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"alphaState",{get:function(){return this._alphaState},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"stencilState",{get:function(){return this._stencilState},enumerable:!1,configurable:!0}),v.prototype.clearInternalTexturesCache=function(){this._internalTexturesCache=[]},v.prototype.wipeCaches=function(f){this.preventCacheWipeBetweenFrames&&!f||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),f&&(this._currentProgram=null,this.resetTextureCache(),this._stencilState.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))},v.prototype._getSamplingParameters=function(f,b){var T=this._gl,E=T.NEAREST,O=T.NEAREST;switch(f){case 11:E=T.LINEAR,b?O=T.LINEAR_MIPMAP_NEAREST:O=T.LINEAR;break;case 3:E=T.LINEAR,b?O=T.LINEAR_MIPMAP_LINEAR:O=T.LINEAR;break;case 8:E=T.NEAREST,b?O=T.NEAREST_MIPMAP_LINEAR:O=T.NEAREST;break;case 4:E=T.NEAREST,b?O=T.NEAREST_MIPMAP_NEAREST:O=T.NEAREST;break;case 5:E=T.NEAREST,b?O=T.LINEAR_MIPMAP_NEAREST:O=T.LINEAR;break;case 6:E=T.NEAREST,b?O=T.LINEAR_MIPMAP_LINEAR:O=T.LINEAR;break;case 7:E=T.NEAREST,O=T.LINEAR;break;case 1:E=T.NEAREST,O=T.NEAREST;break;case 9:E=T.LINEAR,b?O=T.NEAREST_MIPMAP_NEAREST:O=T.NEAREST;break;case 10:E=T.LINEAR,b?O=T.NEAREST_MIPMAP_LINEAR:O=T.NEAREST;break;case 2:E=T.LINEAR,O=T.LINEAR;break;case 12:E=T.LINEAR,O=T.NEAREST;break}return{min:O,mag:E}},v.prototype._createTexture=function(){var f=this._gl.createTexture();if(!f)throw new Error("Unable to create texture");return f},v.prototype._createHardwareTexture=function(){return new o(this._createTexture(),this._gl)},v.prototype._createTextureBase=function(f,b,T,E,O,D,F,x,j,V,z,w,R,L,N){var B=this;O===void 0&&(O=3),D===void 0&&(D=null),F===void 0&&(F=null),V===void 0&&(V=null),z===void 0&&(z=null),w===void 0&&(w=null),R===void 0&&(R=null),f=f||"";var X=f.substr(0,5)==="data:",K=f.substr(0,5)==="blob:",G=X&&f.indexOf(";base64,")!==-1,I=z||new s.a(this,s.b.Url),A=f;this._transformTextureUrl&&!G&&!z&&!V&&(f=this._transformTextureUrl(f)),A!==f&&(I._originalUrl=A);var S=f.lastIndexOf("."),C=R||(S>-1?f.substring(S).toLowerCase():""),U=null,k=C.indexOf("?");k>-1&&(C=C.split("?")[0]);for(var J=0,Y=v._TextureLoaders;J<Y.length;J++){var Z=Y[J];if(Z.canLoad(C,L)){U=Z;break}}E&&E._addPendingData(I),I.url=f,I.generateMipMaps=!b,I.samplingMode=O,I.invertY=T,this._doNotHandleContextLost||(I._buffer=V);var Q=null;D&&!z&&(Q=I.onLoadedObservable.add(D)),z||this._internalTexturesCache.push(I);var te=function(ne,ie){E&&E._removePendingData(I),f===A?(Q&&I.onLoadedObservable.remove(Q),P.a.UseFallbackTexture&&B._createTextureBase(P.a.FallbackTexture,b,I.invertY,E,O,null,F,x,j,V,I),F&&F((ne||"Unknown error")+(P.a.UseFallbackTexture?" - Fallback texture was used":""),ie)):(u.a.Warn("Failed to load "+f+", falling back to "+A),B._createTextureBase(A,b,I.invertY,E,O,D,F,x,j,V,I,w,R,L,N))};if(U){var re=function(ne){U.loadData(ne,I,function(ie,fe,he,pe,ue,_e){_e?te("TextureLoader failed to load data"):x(I,C,E,{width:ie,height:fe},I.invertY,!he,pe,function(){return ue(),!1},O)},N)};V?V instanceof ArrayBuffer?re(new Uint8Array(V)):ArrayBuffer.isView(V)?re(V):F&&F("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(f,function(ne){return re(new Uint8Array(ne))},void 0,E?E.offlineProvider:void 0,!0,function(ne,ie){te("Unable to load "+(ne&&ne.responseURL,ie))})}else{var ae=function(ne){K&&!B._doNotHandleContextLost&&(I._buffer=ne),x(I,C,E,ne,I.invertY,b,!1,j,O)};!X||G?V&&(typeof V.decoding=="string"||V.close)?ae(V):v._FileToolsLoadImage(f,ae,te,E?E.offlineProvider:null,L):typeof V=="string"||V instanceof ArrayBuffer||ArrayBuffer.isView(V)||V instanceof Blob?v._FileToolsLoadImage(V,ae,te,E?E.offlineProvider:null,L):V&&ae(V)}return I},v.prototype.createTexture=function(f,b,T,E,O,D,F,x,j,V,z,w,R){var L=this;return O===void 0&&(O=3),D===void 0&&(D=null),F===void 0&&(F=null),x===void 0&&(x=null),j===void 0&&(j=null),V===void 0&&(V=null),z===void 0&&(z=null),this._createTextureBase(f,b,T,E,O,D,F,this._prepareWebGLTexture.bind(this),function(N,B,X,K,G,I){var A=L._gl,S=X.width===N&&X.height===B,C=V?L._getInternalFormat(V):K===".jpg"?A.RGB:A.RGBA;if(S)return A.texImage2D(A.TEXTURE_2D,0,C,C,A.UNSIGNED_BYTE,X),!1;var U=L._caps.maxTextureSize;if(X.width>U||X.height>U||!L._supportsHardwareTextureRescaling)return L._prepareWorkingCanvas(),!L._workingCanvas||!L._workingContext||(L._workingCanvas.width=N,L._workingCanvas.height=B,L._workingContext.drawImage(X,0,0,X.width,X.height,0,0,N,B),A.texImage2D(A.TEXTURE_2D,0,C,C,A.UNSIGNED_BYTE,L._workingCanvas),G.width=N,G.height=B),!1;var k=new s.a(L,s.b.Temp);return L._bindTextureDirectly(A.TEXTURE_2D,k,!0),A.texImage2D(A.TEXTURE_2D,0,C,C,A.UNSIGNED_BYTE,X),L._rescaleTexture(k,G,E,C,function(){L._releaseTexture(k),L._bindTextureDirectly(A.TEXTURE_2D,G,!0),I()}),!0},x,j,V,z,w,R)},v._FileToolsLoadImage=function(f,b,T,E,O){throw m.a.WarnImport("FileTools")},v.prototype._rescaleTexture=function(f,b,T,E,O){},v.prototype.createRawTexture=function(f,b,T,E,O,D,F,x,j){throw x===void 0&&(x=null),j===void 0&&(j=0),m.a.WarnImport("Engine.RawTexture")},v.prototype.createRawCubeTexture=function(f,b,T,E,O,D,F,x){throw x===void 0&&(x=null),m.a.WarnImport("Engine.RawTexture")},v.prototype.createRawTexture3D=function(f,b,T,E,O,D,F,x,j,V){throw j===void 0&&(j=null),V===void 0&&(V=0),m.a.WarnImport("Engine.RawTexture")},v.prototype.createRawTexture2DArray=function(f,b,T,E,O,D,F,x,j,V){throw j===void 0&&(j=null),V===void 0&&(V=0),m.a.WarnImport("Engine.RawTexture")},v.prototype._unpackFlipY=function(f){this._unpackFlipYCached!==f&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,f?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=f))},v.prototype._getUnpackAlignement=function(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)},v.prototype._getTextureTarget=function(f){return f.isCube?this._gl.TEXTURE_CUBE_MAP:f.is3D?this._gl.TEXTURE_3D:f.is2DArray||f.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D},v.prototype.updateTextureSamplingMode=function(f,b,T){T===void 0&&(T=!1);var E=this._getTextureTarget(b),O=this._getSamplingParameters(f,b.generateMipMaps||T);this._setTextureParameterInteger(E,this._gl.TEXTURE_MAG_FILTER,O.mag,b),this._setTextureParameterInteger(E,this._gl.TEXTURE_MIN_FILTER,O.min),T&&(b.generateMipMaps=!0,this._gl.generateMipmap(E)),this._bindTextureDirectly(E,null),b.samplingMode=f},v.prototype.updateTextureDimensions=function(f,b,T,E){E===void 0&&(E=1)},v.prototype.updateTextureWrappingMode=function(f,b,T,E){T===void 0&&(T=null),E===void 0&&(E=null);var O=this._getTextureTarget(f);b!==null&&(this._setTextureParameterInteger(O,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(b),f),f._cachedWrapU=b),T!==null&&(this._setTextureParameterInteger(O,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(T),f),f._cachedWrapV=T),(f.is2DArray||f.is3D)&&E!==null&&(this._setTextureParameterInteger(O,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(E),f),f._cachedWrapR=E),this._bindTextureDirectly(O,null)},v.prototype._setupDepthStencilTexture=function(f,b,T,E,O,D){D===void 0&&(D=1);var F=b.width||b,x=b.height||b,j=b.layers||0;f.baseWidth=F,f.baseHeight=x,f.width=F,f.height=x,f.is2DArray=j>0,f.depth=j,f.isReady=!0,f.samples=D,f.generateMipMaps=!1,f._generateDepthBuffer=!0,f._generateStencilBuffer=T,f.samplingMode=E?2:1,f.type=0,f._comparisonFunction=O;var V=this._gl,z=this._getTextureTarget(f),w=this._getSamplingParameters(f.samplingMode,!1);V.texParameteri(z,V.TEXTURE_MAG_FILTER,w.mag),V.texParameteri(z,V.TEXTURE_MIN_FILTER,w.min),V.texParameteri(z,V.TEXTURE_WRAP_S,V.CLAMP_TO_EDGE),V.texParameteri(z,V.TEXTURE_WRAP_T,V.CLAMP_TO_EDGE),O===0?(V.texParameteri(z,V.TEXTURE_COMPARE_FUNC,515),V.texParameteri(z,V.TEXTURE_COMPARE_MODE,V.NONE)):(V.texParameteri(z,V.TEXTURE_COMPARE_FUNC,O),V.texParameteri(z,V.TEXTURE_COMPARE_MODE,V.COMPARE_REF_TO_TEXTURE))},v.prototype._uploadCompressedDataToTextureDirectly=function(f,b,T,E,O,D,F){D===void 0&&(D=0),F===void 0&&(F=0);var x=this._gl,j=x.TEXTURE_2D;f.isCube&&(j=x.TEXTURE_CUBE_MAP_POSITIVE_X+D),this._gl.compressedTexImage2D(j,F,b,T,E,0,O)},v.prototype._uploadDataToTextureDirectly=function(f,b,T,E,O,D){T===void 0&&(T=0),E===void 0&&(E=0),D===void 0&&(D=!1);var F=this._gl,x=this._getWebGLTextureType(f.type),j=this._getInternalFormat(f.format),V=O===void 0?this._getRGBABufferInternalSizedFormat(f.type,f.format):this._getInternalFormat(O);this._unpackFlipY(f.invertY);var z=F.TEXTURE_2D;f.isCube&&(z=F.TEXTURE_CUBE_MAP_POSITIVE_X+T);var w=Math.round(Math.log(f.width)*Math.LOG2E),R=Math.round(Math.log(f.height)*Math.LOG2E),L=D?f.width:Math.pow(2,Math.max(w-E,0)),N=D?f.height:Math.pow(2,Math.max(R-E,0));F.texImage2D(z,E,V,L,N,0,j,x,b)},v.prototype.updateTextureData=function(f,b,T,E,O,D,F,x){F===void 0&&(F=0),x===void 0&&(x=0);var j=this._gl,V=this._getWebGLTextureType(f.type),z=this._getInternalFormat(f.format);this._unpackFlipY(f.invertY);var w=j.TEXTURE_2D;f.isCube&&(w=j.TEXTURE_CUBE_MAP_POSITIVE_X+F),j.texSubImage2D(w,x,T,E,O,D,z,V,b)},v.prototype._uploadArrayBufferViewToTexture=function(f,b,T,E){T===void 0&&(T=0),E===void 0&&(E=0);var O=this._gl,D=f.isCube?O.TEXTURE_CUBE_MAP:O.TEXTURE_2D;this._bindTextureDirectly(D,f,!0),this._uploadDataToTextureDirectly(f,b,T,E),this._bindTextureDirectly(D,null,!0)},v.prototype._prepareWebGLTextureContinuation=function(f,b,T,E,O){var D=this._gl;if(!!D){var F=this._getSamplingParameters(O,!T);D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MAG_FILTER,F.mag),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MIN_FILTER,F.min),!T&&!E&&D.generateMipmap(D.TEXTURE_2D),this._bindTextureDirectly(D.TEXTURE_2D,null),b&&b._removePendingData(f),f.onLoadedObservable.notifyObservers(f),f.onLoadedObservable.clear()}},v.prototype._prepareWebGLTexture=function(f,b,T,E,O,D,F,x,j){var V=this;j===void 0&&(j=3);var z=this.getCaps().maxTextureSize,w=Math.min(z,this.needPOTTextures?v.GetExponentOfTwo(E.width,z):E.width),R=Math.min(z,this.needPOTTextures?v.GetExponentOfTwo(E.height,z):E.height),L=this._gl;if(!!L){if(!f._hardwareTexture){T&&T._removePendingData(f);return}this._bindTextureDirectly(L.TEXTURE_2D,f,!0),this._unpackFlipY(O===void 0?!0:!!O),f.baseWidth=E.width,f.baseHeight=E.height,f.width=w,f.height=R,f.isReady=!0,!x(w,R,E,b,f,function(){V._prepareWebGLTextureContinuation(f,T,D,F,j)})&&this._prepareWebGLTextureContinuation(f,T,D,F,j)}},v.prototype._setupFramebufferDepthAttachments=function(f,b,T,E,O){O===void 0&&(O=1);var D=this._gl;if(f&&b)return this._getDepthStencilBuffer(T,E,O,D.DEPTH_STENCIL,D.DEPTH24_STENCIL8,D.DEPTH_STENCIL_ATTACHMENT);if(b){var F=D.DEPTH_COMPONENT16;return this._webGLVersion>1&&(F=D.DEPTH_COMPONENT32F),this._getDepthStencilBuffer(T,E,O,F,F,D.DEPTH_ATTACHMENT)}return f?this._getDepthStencilBuffer(T,E,O,D.STENCIL_INDEX8,D.STENCIL_INDEX8,D.STENCIL_ATTACHMENT):null},v.prototype._releaseFramebufferObjects=function(f){var b=this._gl;f._framebuffer&&(b.deleteFramebuffer(f._framebuffer),f._framebuffer=null),f._depthStencilBuffer&&(b.deleteRenderbuffer(f._depthStencilBuffer),f._depthStencilBuffer=null),f._MSAAFramebuffer&&(b.deleteFramebuffer(f._MSAAFramebuffer),f._MSAAFramebuffer=null),f._MSAARenderBuffer&&(b.deleteRenderbuffer(f._MSAARenderBuffer),f._MSAARenderBuffer=null)},v.prototype._releaseTexture=function(f){var b,T;this._releaseFramebufferObjects(f),this._deleteTexture((b=f._hardwareTexture)===null||b===void 0?void 0:b.underlyingResource),this.unbindAllTextures();var E=this._internalTexturesCache.indexOf(f);E!==-1&&this._internalTexturesCache.splice(E,1),f._lodTextureHigh&&f._lodTextureHigh.dispose(),f._lodTextureMid&&f._lodTextureMid.dispose(),f._lodTextureLow&&f._lodTextureLow.dispose(),f._irradianceTexture&&f._irradianceTexture.dispose(),(T=f._depthStencilTexture)===null||T===void 0||T.dispose()},v.prototype._deleteTexture=function(f){f&&this._gl.deleteTexture(f)},v.prototype._setProgram=function(f){this._currentProgram!==f&&(this._gl.useProgram(f),this._currentProgram=f)},v.prototype.bindSamplers=function(f){var b=f.getPipelineContext();this._setProgram(b.program);for(var T=f.getSamplers(),E=0;E<T.length;E++){var O=f.getUniform(T[E]);O&&(this._boundUniforms[E]=O)}this._currentEffect=null},v.prototype._activateCurrentTexture=function(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)},v.prototype._bindTextureDirectly=function(f,b,T,E){var O,D;T===void 0&&(T=!1),E===void 0&&(E=!1);var F=!1,x=b&&b._associatedChannel>-1;T&&x&&(this._activeChannel=b._associatedChannel);var j=this._boundTexturesCache[this._activeChannel];return j!==b||E?(this._activateCurrentTexture(),b&&b.isMultiview?this._gl.bindTexture(f,b?b._colorTextureArray:null):this._gl.bindTexture(f,(D=(O=b==null?void 0:b._hardwareTexture)===null||O===void 0?void 0:O.underlyingResource)!==null&&D!==void 0?D:null),this._boundTexturesCache[this._activeChannel]=b,b&&(b._associatedChannel=this._activeChannel)):T&&(F=!0,this._activateCurrentTexture()),x&&!T&&this._bindSamplerUniformToChannel(b._associatedChannel,this._activeChannel),F},v.prototype._bindTexture=function(f,b,T){if(f!==void 0){b&&(b._associatedChannel=f),this._activeChannel=f;var E=b?this._getTextureTarget(b):this._gl.TEXTURE_2D;this._bindTextureDirectly(E,b)}},v.prototype.unbindAllTextures=function(){for(var f=0;f<this._maxSimultaneousTextures;f++)this._activeChannel=f,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))},v.prototype.setTexture=function(f,b,T,E){f!==void 0&&(b&&(this._boundUniforms[f]=b),this._setTexture(f,T))},v.prototype._bindSamplerUniformToChannel=function(f,b){var T=this._boundUniforms[f];!T||T._currentState===b||(this._gl.uniform1i(T,b),T._currentState=b)},v.prototype._getTextureWrapMode=function(f){switch(f){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT},v.prototype._setTexture=function(f,b,T,E,O){if(T===void 0&&(T=!1),E===void 0&&(E=!1),O===void 0&&(O=""),!b)return this._boundTexturesCache[f]!=null&&(this._activeChannel=f,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(b.video)this._activeChannel=f,b.update();else if(b.delayLoadState===4)return b.delayLoad(),!1;var D;E?D=b.depthStencilTexture:b.isReady()?D=b.getInternalTexture():b.isCube?D=this.emptyCubeTexture:b.is3D?D=this.emptyTexture3D:b.is2DArray?D=this.emptyTexture2DArray:D=this.emptyTexture,!T&&D&&(D._associatedChannel=f);var F=!0;this._boundTexturesCache[f]===D&&(T||this._bindSamplerUniformToChannel(D._associatedChannel,f),F=!1),this._activeChannel=f;var x=this._getTextureTarget(D);if(F&&this._bindTextureDirectly(x,D,T),D&&!D.isMultiview){if(D.isCube&&D._cachedCoordinatesMode!==b.coordinatesMode){D._cachedCoordinatesMode=b.coordinatesMode;var j=b.coordinatesMode!==3&&b.coordinatesMode!==5?1:0;b.wrapU=j,b.wrapV=j}D._cachedWrapU!==b.wrapU&&(D._cachedWrapU=b.wrapU,this._setTextureParameterInteger(x,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(b.wrapU),D)),D._cachedWrapV!==b.wrapV&&(D._cachedWrapV=b.wrapV,this._setTextureParameterInteger(x,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(b.wrapV),D)),D.is3D&&D._cachedWrapR!==b.wrapR&&(D._cachedWrapR=b.wrapR,this._setTextureParameterInteger(x,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(b.wrapR),D)),this._setAnisotropicLevel(x,D,b.anisotropicFilteringLevel)}return!0},v.prototype.setTextureArray=function(f,b,T,E){if(!(f===void 0||!b)){(!this._textureUnits||this._textureUnits.length!==T.length)&&(this._textureUnits=new Int32Array(T.length));for(var O=0;O<T.length;O++){var D=T[O].getInternalTexture();D?(this._textureUnits[O]=f+O,D._associatedChannel=f+O):this._textureUnits[O]=-1}this._gl.uniform1iv(b,this._textureUnits);for(var F=0;F<T.length;F++)this._setTexture(this._textureUnits[F],T[F],!0)}},v.prototype._setAnisotropicLevel=function(f,b,T){var E=this._caps.textureAnisotropicFilterExtension;b.samplingMode!==11&&b.samplingMode!==3&&b.samplingMode!==2&&(T=1),E&&b._cachedAnisotropicFilteringLevel!==T&&(this._setTextureParameterFloat(f,E.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(T,this._caps.maxAnisotropy),b),b._cachedAnisotropicFilteringLevel=T)},v.prototype._setTextureParameterFloat=function(f,b,T,E){this._bindTextureDirectly(f,E,!0,!0),this._gl.texParameterf(f,b,T)},v.prototype._setTextureParameterInteger=function(f,b,T,E){E&&this._bindTextureDirectly(f,E,!0,!0),this._gl.texParameteri(f,b,T)},v.prototype.unbindAllAttributes=function(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(var f=0;f<this._caps.maxVertexAttribs;f++)this.disableAttributeByIndex(f);return}for(var f=0,b=this._vertexAttribArraysEnabled.length;f<b;f++)f>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[f]||this.disableAttributeByIndex(f)},v.prototype.releaseEffects=function(){for(var f in this._compiledEffects){var b=this._compiledEffects[f].getPipelineContext();this._deletePipelineContext(b)}this._compiledEffects={}},v.prototype.dispose=function(){this.stopRenderLoop(),this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.releaseEffects(),this.unbindAllAttributes(),this._boundUniforms=[],p.a.IsWindowObjectExist()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers=[],this._renderingCanvas=null,this._currentProgram=null,this._boundRenderFunction=null,d.a.ResetCache();for(var f=0,b=this._activeRequests;f<b.length;f++){var T=b[f];T.abort()}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear()},v.prototype.attachContextLostEvent=function(f){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",f,!1)},v.prototype.attachContextRestoredEvent=function(f){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",f,!1)},v.prototype.getError=function(){return this._gl.getError()},v.prototype._canRenderToFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)},v.prototype._canRenderToHalfFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)},v.prototype._canRenderToFramebuffer=function(f){for(var b=this._gl;b.getError()!==b.NO_ERROR;);var T=!0,E=b.createTexture();b.bindTexture(b.TEXTURE_2D,E),b.texImage2D(b.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(f),1,1,0,b.RGBA,this._getWebGLTextureType(f),null),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST);var O=b.createFramebuffer();b.bindFramebuffer(b.FRAMEBUFFER,O),b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,E,0);var D=b.checkFramebufferStatus(b.FRAMEBUFFER);if(T=T&&D===b.FRAMEBUFFER_COMPLETE,T=T&&b.getError()===b.NO_ERROR,T&&(b.clear(b.COLOR_BUFFER_BIT),T=T&&b.getError()===b.NO_ERROR),T){b.bindFramebuffer(b.FRAMEBUFFER,null);var F=b.RGBA,x=b.UNSIGNED_BYTE,j=new Uint8Array(4);b.readPixels(0,0,1,1,F,x,j),T=T&&b.getError()===b.NO_ERROR}for(b.deleteTexture(E),b.deleteFramebuffer(O),b.bindFramebuffer(b.FRAMEBUFFER,null);!T&&b.getError()!==b.NO_ERROR;);return T},v.prototype._getWebGLTextureType=function(f){if(this._webGLVersion===1){switch(f){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(f){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE},v.prototype._getInternalFormat=function(f){var b=this._gl.RGBA;switch(f){case 0:b=this._gl.ALPHA;break;case 1:b=this._gl.LUMINANCE;break;case 2:b=this._gl.LUMINANCE_ALPHA;break;case 6:b=this._gl.RED;break;case 7:b=this._gl.RG;break;case 4:b=this._gl.RGB;break;case 5:b=this._gl.RGBA;break}if(this._webGLVersion>1)switch(f){case 8:b=this._gl.RED_INTEGER;break;case 9:b=this._gl.RG_INTEGER;break;case 10:b=this._gl.RGB_INTEGER;break;case 11:b=this._gl.RGBA_INTEGER;break}return b},v.prototype._getRGBABufferInternalSizedFormat=function(f,b){if(this._webGLVersion===1){if(b!==void 0)switch(b){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return this._gl.RGB}return this._gl.RGBA}switch(f){case 3:switch(b){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(b){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return this._gl.RGB8;case 5:return this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(b){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;case 11:return this._gl.RGBA16I;default:return this._gl.RGBA16I}case 5:switch(b){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;case 11:return this._gl.RGBA16UI;default:return this._gl.RGBA16UI}case 6:switch(b){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;case 11:return this._gl.RGBA32I;default:return this._gl.RGBA32I}case 7:switch(b){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;case 11:return this._gl.RGBA32UI;default:return this._gl.RGBA32UI}case 1:switch(b){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;case 5:return this._gl.RGBA32F;default:return this._gl.RGBA32F}case 2:switch(b){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;case 5:return this._gl.RGBA16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(b){case 5:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI;default:return this._gl.RGB10_A2}}return this._gl.RGBA8},v.prototype._getRGBAMultiSampleBufferFormat=function(f){return f===1?this._gl.RGBA32F:f===2?this._gl.RGBA16F:this._gl.RGBA8},v.prototype._loadFile=function(f,b,T,E,O,D){var F=this,x=v._FileToolsLoadFile(f,b,T,E,O,D);return this._activeRequests.push(x),x.onCompleteObservable.add(function(j){F._activeRequests.splice(F._activeRequests.indexOf(j),1)}),x},v._FileToolsLoadFile=function(f,b,T,E,O,D){throw m.a.WarnImport("FileTools")},v.prototype.readPixels=function(f,b,T,E,O,D){O===void 0&&(O=!0),D===void 0&&(D=!0);var F=O?4:3,x=O?this._gl.RGBA:this._gl.RGB,j=new Uint8Array(E*T*F);return D&&this.flushFramebuffer(),this._gl.readPixels(f,b,T,E,x,this._gl.UNSIGNED_BYTE,j),Promise.resolve(j)},Object.defineProperty(v,"IsSupported",{get:function(){return this.isSupported()},enumerable:!1,configurable:!0}),v.isSupported=function(){if(this._HasMajorPerformanceCaveat!==null)return!this._HasMajorPerformanceCaveat;if(this._IsSupported===null)try{var f=i.a.CreateCanvas(1,1),b=f.getContext("webgl")||f.getContext("experimental-webgl");this._IsSupported=b!=null&&!!window.WebGLRenderingContext}catch(T){this._IsSupported=!1}return this._IsSupported},Object.defineProperty(v,"HasMajorPerformanceCaveat",{get:function(){if(this._HasMajorPerformanceCaveat===null)try{var f=i.a.CreateCanvas(1,1),b=f.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||f.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!b}catch(T){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat},enumerable:!1,configurable:!0}),v.CeilingPOT=function(f){return f--,f|=f>>1,f|=f>>2,f|=f>>4,f|=f>>8,f|=f>>16,f++,f},v.FloorPOT=function(f){return f=f|f>>1,f=f|f>>2,f=f|f>>4,f=f|f>>8,f=f|f>>16,f-(f>>1)},v.NearestPOT=function(f){var b=v.CeilingPOT(f),T=v.FloorPOT(f);return b-f>f-T?T:b},v.GetExponentOfTwo=function(f,b,T){T===void 0&&(T=2);var E;switch(T){case 1:E=v.FloorPOT(f);break;case 2:E=v.NearestPOT(f);break;case 3:default:E=v.CeilingPOT(f);break}return Math.min(E,b)},v.QueueNewFrame=function(f,b){return p.a.IsWindowObjectExist()?(b||(b=window),b.requestPostAnimationFrame?b.requestPostAnimationFrame(f):b.requestAnimationFrame?b.requestAnimationFrame(f):b.msRequestAnimationFrame?b.msRequestAnimationFrame(f):b.webkitRequestAnimationFrame?b.webkitRequestAnimationFrame(f):b.mozRequestAnimationFrame?b.mozRequestAnimationFrame(f):b.oRequestAnimationFrame?b.oRequestAnimationFrame(f):window.setTimeout(f,16)):typeof requestAnimationFrame!="undefined"?requestAnimationFrame(f):setTimeout(f,16)},v.prototype.getHostDocument=function(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:document},v.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]}],v._TextureLoaders=[],v.CollisionsEpsilon=.001,v._IsSupported=null,v._HasMajorPerformanceCaveat=null,v}()},function($,W,M){"use strict";M.d(W,"a",function(){return P});var P=function(){function d(){this.rootNodes=new Array,this.cameras=new Array,this.lights=new Array,this.meshes=new Array,this.skeletons=new Array,this.particleSystems=new Array,this.animations=[],this.animationGroups=new Array,this.multiMaterials=new Array,this.materials=new Array,this.morphTargetManagers=new Array,this.geometries=new Array,this.transformNodes=new Array,this.actionManagers=new Array,this.textures=new Array,this._environmentTexture=null,this.postProcesses=new Array}return d.AddParser=function(m,n){this._BabylonFileParsers[m]=n},d.GetParser=function(m){return this._BabylonFileParsers[m]?this._BabylonFileParsers[m]:null},d.AddIndividualParser=function(m,n){this._IndividualBabylonFileParsers[m]=n},d.GetIndividualParser=function(m){return this._IndividualBabylonFileParsers[m]?this._IndividualBabylonFileParsers[m]:null},d.Parse=function(m,n,c,a){for(var _ in this._BabylonFileParsers)this._BabylonFileParsers.hasOwnProperty(_)&&this._BabylonFileParsers[_](m,n,c,a)},Object.defineProperty(d.prototype,"environmentTexture",{get:function(){return this._environmentTexture},set:function(m){this._environmentTexture=m},enumerable:!1,configurable:!0}),d.prototype.getNodes=function(){var m=new Array;return m=m.concat(this.meshes),m=m.concat(this.lights),m=m.concat(this.cameras),m=m.concat(this.transformNodes),this.skeletons.forEach(function(n){return m=m.concat(n.bones)}),m},d._BabylonFileParsers={},d._IndividualBabylonFileParsers={},d}()},,,,,function($,W,M){"use strict";M.d(W,"a",function(){return P});var P=function(){function d(){}return d.EndsWith=function(m,n){return m.indexOf(n,m.length-n.length)!==-1},d.StartsWith=function(m,n){return m?m.indexOf(n)===0:!1},d.Decode=function(m){if(typeof TextDecoder!="undefined")return new TextDecoder().decode(m);for(var n="",c=0;c<m.byteLength;c++)n+=String.fromCharCode(m[c]);return n},d.EncodeArrayBufferToBase64=function(m){for(var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="",a,_,s,u,p,l,h,t=0,e=ArrayBuffer.isView(m)?new Uint8Array(m.buffer,m.byteOffset,m.byteLength):new Uint8Array(m);t<e.length;)a=e[t++],_=t<e.length?e[t++]:Number.NaN,s=t<e.length?e[t++]:Number.NaN,u=a>>2,p=(a&3)<<4|_>>4,l=(_&15)<<2|s>>6,h=s&63,isNaN(_)?l=h=64:isNaN(s)&&(h=64),c+=n.charAt(u)+n.charAt(p)+n.charAt(l)+n.charAt(h);return c},d.PadNumber=function(m,n){for(var c=String(m);c.length<n;)c="0"+c;return c},d}()},function($,W,M){"use strict";M.d(W,"a",function(){return c});var P=M(473),d=M(440),m=function(a,_){return!a||a.getClassName&&a.getClassName()==="Mesh"?null:a.getClassName&&a.getClassName()==="SubMesh"?a.clone(_):a.clone?a.clone():null};function n(a){var _=[];do Object.getOwnPropertyNames(a).forEach(function(s){_.indexOf(s)===-1&&_.push(s)});while(a=Object.getPrototypeOf(a));return _}var c=function(){function a(){}return a.DeepCopy=function(_,s,u,p){for(var l=n(_),h=0,t=l;h<t.length;h++){var e=t[h];if(!(e[0]==="_"&&(!p||p.indexOf(e)===-1))&&!P.a.EndsWith(e,"Observable")&&!(u&&u.indexOf(e)!==-1)){var i=_[e],r=typeof i;if(r!=="function")try{if(r==="object")if(i instanceof Array){if(s[e]=[],i.length>0)if(typeof i[0]=="object")for(var o=0;o<i.length;o++){var g=m(i[o],s);s[e].indexOf(g)===-1&&s[e].push(g)}else s[e]=i.slice(0)}else s[e]=m(i,s);else s[e]=i}catch(y){d.a.Warn(y.message)}}}},a}()},function($,W,M){"use strict";var P=M(465);M.d(W,"c",function(){return P.a}),M.d(W,"g",function(){return P.b}),M.d(W,"t",function(){return P.c});var d=M(441);M.d(W,"e",function(){return d.a}),M.d(W,"f",function(){return d.b}),M.d(W,"u",function(){return d.c});var m=M(515);M.d(W,"i",function(){return m.a}),M.d(W,"w",function(){return m.b}),M.d(W,"x",function(){return m.c});var n=M(757);M.d(W,"j",function(){return n.a});var c=M(756);M.d(W,"a",function(){return c.a}),M.d(W,"b",function(){return c.b}),M.d(W,"d",function(){return c.c}),M.d(W,"h",function(){return c.d}),M.d(W,"l",function(){return c.e}),M.d(W,"m",function(){return c.f}),M.d(W,"n",function(){return c.g});var a=M(603);M.d(W,"o",function(){return a.a});var _=M(700);M.d(W,"s",function(){return _.a});var s=M(436);M.d(W,"k",function(){return s.a}),M.d(W,"r",function(){return s.b}),M.d(W,"v",function(){return s.c}),M.d(W,"y",function(){return s.d}),M.d(W,"z",function(){return s.e}),M.d(W,"A",function(){return s.f});var u=M(781);M.d(W,"p",function(){return u.a}),M.d(W,"q",function(){return u.b});var p=M(520);M.d(W,"B",function(){return p.a})},function($,W,M){"use strict";M.d(W,"a",function(){return P});var P=function(){function d(){}return d.WarnImport=function(m){return m+" needs to be imported before as it contains a side-effect required by your code."},d}()},function($,W,M){"use strict";M.d(W,"a",function(){return p});var P=M(434),d=M(439),m=M(438),n=M(436),c=M(448),a=M(709),_=M(662),s=M(700),u=function(){function l(h){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=s.a.Zero(),this._cachedBaseSize=s.a.Zero(),this._texture=h,this._texture&&(this._engine=this._texture.getEngine())}return Object.defineProperty(l.prototype,"wrapU",{get:function(){return this._wrapU},set:function(h){this._wrapU=h},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"wrapV",{get:function(){return this._wrapV},set:function(h){this._wrapV=h},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"coordinatesMode",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"isCube",{get:function(){return this._texture?this._texture.isCube:!1},set:function(h){!this._texture||(this._texture.isCube=h)},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"is3D",{get:function(){return this._texture?this._texture.is3D:!1},set:function(h){!this._texture||(this._texture.is3D=h)},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"is2DArray",{get:function(){return this._texture?this._texture.is2DArray:!1},set:function(h){!this._texture||(this._texture.is2DArray=h)},enumerable:!1,configurable:!0}),l.prototype.getClassName=function(){return"ThinTexture"},l.prototype.isReady=function(){return this.delayLoadState===4?(this.delayLoad(),!1):this._texture?this._texture.isReady:!1},l.prototype.delayLoad=function(){},l.prototype.getInternalTexture=function(){return this._texture},l.prototype.getSize=function(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize},l.prototype.getBaseSize=function(){return!this.isReady()||!this._texture?(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize):this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize)},l.prototype.updateSamplingMode=function(h){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(h,this._texture)},l.prototype.releaseInternalTexture=function(){this._texture&&(this._texture.dispose(),this._texture=null)},l.prototype.dispose=function(){this._texture&&(this.releaseInternalTexture(),this._engine=null)},l}(),p=function(l){Object(P.d)(h,l);function h(t){var e=l.call(this,null)||this;return e.metadata=null,e.reservedDataStore=null,e._hasAlpha=!1,e.getAlphaFromRGB=!1,e.level=1,e.coordinatesIndex=0,e._coordinatesMode=0,e.wrapR=1,e.anisotropicFilteringLevel=h.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,e._isCube=!1,e._gammaSpace=!0,e.invertZ=!1,e.lodLevelInAlpha=!1,e.isRenderTarget=!1,e._prefiltered=!1,e.animations=new Array,e.onDisposeObservable=new m.c,e._onDisposeObserver=null,e._scene=null,e._texture=null,e._uid=null,t?h._isScene(t)?e._scene=t:e._engine=t:e._scene=c.a.LastCreatedScene,e._scene&&(e.uniqueId=e._scene.getUniqueId(),e._scene.addTexture(e),e._engine=e._scene.getEngine()),e._uid=null,e}return Object.defineProperty(h.prototype,"hasAlpha",{get:function(){return this._hasAlpha},set:function(t){this._hasAlpha!==t&&(this._hasAlpha=t,this._scene&&this._scene.markAllMaterialsAsDirty(1|16))},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"coordinatesMode",{get:function(){return this._coordinatesMode},set:function(t){this._coordinatesMode!==t&&(this._coordinatesMode=t,this._scene&&this._scene.markAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"wrapU",{get:function(){return this._wrapU},set:function(t){this._wrapU=t},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"wrapV",{get:function(){return this._wrapV},set:function(t){this._wrapV=t},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"isCube",{get:function(){return this._texture?this._texture.isCube:this._isCube},set:function(t){this._texture?this._texture.isCube=t:this._isCube=t},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"is3D",{get:function(){return this._texture?this._texture.is3D:!1},set:function(t){!this._texture||(this._texture.is3D=t)},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"is2DArray",{get:function(){return this._texture?this._texture.is2DArray:!1},set:function(t){!this._texture||(this._texture.is2DArray=t)},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"gammaSpace",{get:function(){if(this._texture)this._texture._gammaSpace===null&&(this._texture._gammaSpace=this._gammaSpace);else return this._gammaSpace;return this._texture._gammaSpace},set:function(t){if(this._texture){if(this._texture._gammaSpace===t)return;this._texture._gammaSpace=t}else{if(this._gammaSpace===t)return;this._gammaSpace=t}this._markAllSubMeshesAsTexturesDirty()},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"isRGBD",{get:function(){return this._texture!=null&&this._texture._isRGBD},set:function(t){this._texture&&(this._texture._isRGBD=t)},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"noMipmap",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"lodGenerationOffset",{get:function(){return this._texture?this._texture._lodGenerationOffset:0},set:function(t){this._texture&&(this._texture._lodGenerationOffset=t)},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"lodGenerationScale",{get:function(){return this._texture?this._texture._lodGenerationScale:0},set:function(t){this._texture&&(this._texture._lodGenerationScale=t)},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"linearSpecularLOD",{get:function(){return this._texture?this._texture._linearSpecularLOD:!1},set:function(t){this._texture&&(this._texture._linearSpecularLOD=t)},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"irradianceTexture",{get:function(){return this._texture?this._texture._irradianceTexture:null},set:function(t){this._texture&&(this._texture._irradianceTexture=t)},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"uid",{get:function(){return this._uid||(this._uid=a.a.RandomId()),this._uid},enumerable:!1,configurable:!0}),h.prototype.toString=function(){return this.name},h.prototype.getClassName=function(){return"BaseTexture"},Object.defineProperty(h.prototype,"onDispose",{set:function(t){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"isBlocking",{get:function(){return!0},enumerable:!1,configurable:!0}),h.prototype.getScene=function(){return this._scene},h.prototype._getEngine=function(){return this._engine},h.prototype.checkTransformsAreIdentical=function(t){return t!==null},h.prototype.getTextureMatrix=function(){return n.a.IdentityReadOnly},h.prototype.getReflectionTextureMatrix=function(){return n.a.IdentityReadOnly},h.prototype.isReadyOrNotBlocking=function(){return!this.isBlocking||this.isReady()},h.prototype.scale=function(t){},Object.defineProperty(h.prototype,"canRescale",{get:function(){return!1},enumerable:!1,configurable:!0}),h.prototype._getFromCache=function(t,e,i,r){var o=this._getEngine();if(!o)return null;for(var g=o.getLoadedTexturesCache(),y=0;y<g.length;y++){var v=g[y];if((r===void 0||r===v.invertY)&&v.url===t&&v.generateMipMaps===!e&&(!i||i===v.samplingMode))return v.incrementReferences(),v}return null},h.prototype._rebuild=function(){},h.prototype.clone=function(){return null},Object.defineProperty(h.prototype,"textureType",{get:function(){return this._texture&&this._texture.type!==void 0?this._texture.type:0},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"textureFormat",{get:function(){return this._texture&&this._texture.format!==void 0?this._texture.format:5},enumerable:!1,configurable:!0}),h.prototype._markAllSubMeshesAsTexturesDirty=function(){var t=this.getScene();!t||t.markAllMaterialsAsDirty(1)},h.prototype.readPixels=function(t,e,i,r){if(t===void 0&&(t=0),e===void 0&&(e=0),i===void 0&&(i=null),r===void 0&&(r=!0),!this._texture)return null;var o=this.getSize(),g=o.width,y=o.height,v=this._getEngine();if(!v)return null;e!=0&&(g=g/Math.pow(2,e),y=y/Math.pow(2,e),g=Math.round(g),y=Math.round(y));try{return this._texture.isCube?v._readTexturePixels(this._texture,g,y,t,e,i,r):v._readTexturePixels(this._texture,g,y,-1,e,i,r)}catch(f){return null}},h.prototype._readPixelsSync=function(t,e,i,r){if(t===void 0&&(t=0),e===void 0&&(e=0),i===void 0&&(i=null),r===void 0&&(r=!0),!this._texture)return null;var o=this.getSize(),g=o.width,y=o.height,v=this._getEngine();if(!v)return null;e!=0&&(g=g/Math.pow(2,e),y=y/Math.pow(2,e),g=Math.round(g),y=Math.round(y));try{return this._texture.isCube?v._readTexturePixelsSync(this._texture,g,y,t,e,i,r):v._readTexturePixelsSync(this._texture,g,y,-1,e,i,r)}catch(f){return null}},Object.defineProperty(h.prototype,"_lodTextureHigh",{get:function(){return this._texture?this._texture._lodTextureHigh:null},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"_lodTextureMid",{get:function(){return this._texture?this._texture._lodTextureMid:null},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"_lodTextureLow",{get:function(){return this._texture?this._texture._lodTextureLow:null},enumerable:!1,configurable:!0}),h.prototype.dispose=function(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene._removePendingData(this);var t=this._scene.textures.indexOf(this);t>=0&&this._scene.textures.splice(t,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),l.prototype.dispose.call(this)},h.prototype.serialize=function(){if(!this.name)return null;var t=d.a.Serialize(this);return d.a.AppendSerializedAnimations(this,t),t},h.WhenAllReady=function(t,e){var i=t.length;if(i===0){e();return}for(var r=0;r<t.length;r++){var o=t[r];if(o.isReady())--i==0&&e();else{var g=o.onLoadObservable;g&&g.addOnce(function(){--i==0&&e()})}}},h._isScene=function(t){return t.getClassName()==="Scene"},h.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,Object(P.c)([Object(d.c)()],h.prototype,"uniqueId",void 0),Object(P.c)([Object(d.c)()],h.prototype,"name",void 0),Object(P.c)([Object(d.c)()],h.prototype,"metadata",void 0),Object(P.c)([Object(d.c)("hasAlpha")],h.prototype,"_hasAlpha",void 0),Object(P.c)([Object(d.c)()],h.prototype,"getAlphaFromRGB",void 0),Object(P.c)([Object(d.c)()],h.prototype,"level",void 0),Object(P.c)([Object(d.c)()],h.prototype,"coordinatesIndex",void 0),Object(P.c)([Object(d.c)("coordinatesMode")],h.prototype,"_coordinatesMode",void 0),Object(P.c)([Object(d.c)()],h.prototype,"wrapU",null),Object(P.c)([Object(d.c)()],h.prototype,"wrapV",null),Object(P.c)([Object(d.c)()],h.prototype,"wrapR",void 0),Object(P.c)([Object(d.c)()],h.prototype,"anisotropicFilteringLevel",void 0),Object(P.c)([Object(d.c)()],h.prototype,"isCube",null),Object(P.c)([Object(d.c)()],h.prototype,"is3D",null),Object(P.c)([Object(d.c)()],h.prototype,"is2DArray",null),Object(P.c)([Object(d.c)()],h.prototype,"gammaSpace",null),Object(P.c)([Object(d.c)()],h.prototype,"invertZ",void 0),Object(P.c)([Object(d.c)()],h.prototype,"lodLevelInAlpha",void 0),Object(P.c)([Object(d.c)()],h.prototype,"lodGenerationOffset",null),Object(P.c)([Object(d.c)()],h.prototype,"lodGenerationScale",null),Object(P.c)([Object(d.c)()],h.prototype,"linearSpecularLOD",null),Object(P.c)([Object(d.m)()],h.prototype,"irradianceTexture",null),Object(P.c)([Object(d.c)()],h.prototype,"isRenderTarget",void 0),h}(u)},,,function($,W,M){"use strict";M.d(W,"a",function(){return d});var P=M(445),d=function(){function m(){}return Object.defineProperty(m,"DiffuseTextureEnabled",{get:function(){return this._DiffuseTextureEnabled},set:function(n){this._DiffuseTextureEnabled!==n&&(this._DiffuseTextureEnabled=n,P.a.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(m,"DetailTextureEnabled",{get:function(){return this._DetailTextureEnabled},set:function(n){this._DetailTextureEnabled!==n&&(this._DetailTextureEnabled=n,P.a.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(m,"AmbientTextureEnabled",{get:function(){return this._AmbientTextureEnabled},set:function(n){this._AmbientTextureEnabled!==n&&(this._AmbientTextureEnabled=n,P.a.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(m,"OpacityTextureEnabled",{get:function(){return this._OpacityTextureEnabled},set:function(n){this._OpacityTextureEnabled!==n&&(this._OpacityTextureEnabled=n,P.a.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(m,"ReflectionTextureEnabled",{get:function(){return this._ReflectionTextureEnabled},set:function(n){this._ReflectionTextureEnabled!==n&&(this._ReflectionTextureEnabled=n,P.a.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(m,"EmissiveTextureEnabled",{get:function(){return this._EmissiveTextureEnabled},set:function(n){this._EmissiveTextureEnabled!==n&&(this._EmissiveTextureEnabled=n,P.a.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(m,"SpecularTextureEnabled",{get:function(){return this._SpecularTextureEnabled},set:function(n){this._SpecularTextureEnabled!==n&&(this._SpecularTextureEnabled=n,P.a.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(m,"BumpTextureEnabled",{get:function(){return this._BumpTextureEnabled},set:function(n){this._BumpTextureEnabled!==n&&(this._BumpTextureEnabled=n,P.a.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(m,"LightmapTextureEnabled",{get:function(){return this._LightmapTextureEnabled},set:function(n){this._LightmapTextureEnabled!==n&&(this._LightmapTextureEnabled=n,P.a.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(m,"RefractionTextureEnabled",{get:function(){return this._RefractionTextureEnabled},set:function(n){this._RefractionTextureEnabled!==n&&(this._RefractionTextureEnabled=n,P.a.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(m,"ColorGradingTextureEnabled",{get:function(){return this._ColorGradingTextureEnabled},set:function(n){this._ColorGradingTextureEnabled!==n&&(this._ColorGradingTextureEnabled=n,P.a.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(m,"FresnelEnabled",{get:function(){return this._FresnelEnabled},set:function(n){this._FresnelEnabled!==n&&(this._FresnelEnabled=n,P.a.MarkAllMaterialsAsDirty(4))},enumerable:!1,configurable:!0}),Object.defineProperty(m,"ClearCoatTextureEnabled",{get:function(){return this._ClearCoatTextureEnabled},set:function(n){this._ClearCoatTextureEnabled!==n&&(this._ClearCoatTextureEnabled=n,P.a.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(m,"ClearCoatBumpTextureEnabled",{get:function(){return this._ClearCoatBumpTextureEnabled},set:function(n){this._ClearCoatBumpTextureEnabled!==n&&(this._ClearCoatBumpTextureEnabled=n,P.a.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(m,"ClearCoatTintTextureEnabled",{get:function(){return this._ClearCoatTintTextureEnabled},set:function(n){this._ClearCoatTintTextureEnabled!==n&&(this._ClearCoatTintTextureEnabled=n,P.a.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(m,"SheenTextureEnabled",{get:function(){return this._SheenTextureEnabled},set:function(n){this._SheenTextureEnabled!==n&&(this._SheenTextureEnabled=n,P.a.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(m,"AnisotropicTextureEnabled",{get:function(){return this._AnisotropicTextureEnabled},set:function(n){this._AnisotropicTextureEnabled!==n&&(this._AnisotropicTextureEnabled=n,P.a.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),Object.defineProperty(m,"ThicknessTextureEnabled",{get:function(){return this._ThicknessTextureEnabled},set:function(n){this._ThicknessTextureEnabled!==n&&(this._ThicknessTextureEnabled=n,P.a.MarkAllMaterialsAsDirty(1))},enumerable:!1,configurable:!0}),m._DiffuseTextureEnabled=!0,m._DetailTextureEnabled=!0,m._AmbientTextureEnabled=!0,m._OpacityTextureEnabled=!0,m._ReflectionTextureEnabled=!0,m._EmissiveTextureEnabled=!0,m._SpecularTextureEnabled=!0,m._BumpTextureEnabled=!0,m._LightmapTextureEnabled=!0,m._RefractionTextureEnabled=!0,m._ColorGradingTextureEnabled=!0,m._FresnelEnabled=!0,m._ClearCoatTextureEnabled=!0,m._ClearCoatBumpTextureEnabled=!0,m._ClearCoatTintTextureEnabled=!0,m._SheenTextureEnabled=!0,m._AnisotropicTextureEnabled=!0,m._ThicknessTextureEnabled=!0,m}()},,,function($,W,M){"use strict";M.d(W,"b",function(){return l}),M.d(W,"a",function(){return h});var P=M(436),d=M(441),m=M(450),n=M(439),c=M(437),a=M(707),_=M(672),s=M(453),u=M(700),p=M(519),l=function(){function t(){}return t}(),h=function(){function t(e,i,r,o,g,y){this.name=e,this.targetProperty=i,this.framePerSecond=r,this.dataType=o,this.loopMode=g,this.enableBlending=y,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=i.split("."),this.dataType=o,this.loopMode=g===void 0?t.ANIMATIONLOOPMODE_CYCLE:g}return t._PrepareAnimation=function(e,i,r,o,g,y,v,f){var b=void 0;if(!isNaN(parseFloat(g))&&isFinite(g)?b=t.ANIMATIONTYPE_FLOAT:g instanceof P.b?b=t.ANIMATIONTYPE_QUATERNION:g instanceof P.e?b=t.ANIMATIONTYPE_VECTOR3:g instanceof P.d?b=t.ANIMATIONTYPE_VECTOR2:g instanceof d.a?b=t.ANIMATIONTYPE_COLOR3:g instanceof d.b?b=t.ANIMATIONTYPE_COLOR4:g instanceof u.a&&(b=t.ANIMATIONTYPE_SIZE),b==null)return null;var T=new t(e,i,r,b,v),E=[{frame:0,value:g},{frame:o,value:y}];return T.setKeys(E),f!==void 0&&T.setEasingFunction(f),T},t.CreateAnimation=function(e,i,r,o){var g=new t(e+"Animation",e,r,i,t.ANIMATIONLOOPMODE_CONSTANT);return g.setEasingFunction(o),g},t.CreateAndStartAnimation=function(e,i,r,o,g,y,v,f,b,T){var E=t._PrepareAnimation(e,r,o,g,y,v,f,b);return E?i.getScene().beginDirectAnimation(i,[E],0,g,E.loopMode===1,1,T):null},t.CreateAndStartHierarchyAnimation=function(e,i,r,o,g,y,v,f,b,T,E){var O=t._PrepareAnimation(e,o,g,y,v,f,b,T);if(!O)return null;var D=i.getScene();return D.beginDirectHierarchyAnimation(i,r,[O],0,y,O.loopMode===1,1,E)},t.CreateMergeAndStartAnimation=function(e,i,r,o,g,y,v,f,b,T){var E=t._PrepareAnimation(e,r,o,g,y,v,f,b);return E?(i.animations.push(E),i.getScene().beginAnimation(i,0,g,E.loopMode===1,1,T)):null},t.MakeAnimationAdditive=function(e,i,r,o,g){i===void 0&&(i=0),o===void 0&&(o=!1);var y=e;if(o&&(y=e.clone(),y.name=g||y.name),!y._keys.length)return y;i=i>=0?i:0;var v=0,f=y._keys[0],b=y._keys.length-1,T=y._keys[b],E={referenceValue:f.value,referencePosition:P.c.Vector3[0],referenceQuaternion:P.c.Quaternion[0],referenceScaling:P.c.Vector3[1],keyPosition:P.c.Vector3[2],keyQuaternion:P.c.Quaternion[1],keyScaling:P.c.Vector3[3]},O=!1,D=f.frame,F=T.frame;if(r){var x=y.getRange(r);x&&(D=x.from,F=x.to)}var j=f.frame===D,V=T.frame===F;if(y._keys.length===1){var z=y._getKeyValue(y._keys[0]);E.referenceValue=z.clone?z.clone():z,O=!0}else if(i<=f.frame){var z=y._getKeyValue(f.value);E.referenceValue=z.clone?z.clone():z,O=!0}else if(i>=T.frame){var z=y._getKeyValue(T.value);E.referenceValue=z.clone?z.clone():z,O=!0}for(var w=0;!O||!j||!V&&w<y._keys.length-1;){var R=y._keys[w],L=y._keys[w+1];if(!O&&i>=R.frame&&i<=L.frame){var z=void 0;if(i===R.frame)z=y._getKeyValue(R.value);else if(i===L.frame)z=y._getKeyValue(L.value);else{var N={key:w,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT};z=y._interpolate(i,N)}E.referenceValue=z.clone?z.clone():z,O=!0}if(!j&&D>=R.frame&&D<=L.frame){if(D===R.frame)v=w;else if(D===L.frame)v=w+1;else{var N={key:w,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT},z=y._interpolate(D,N),B={frame:D,value:z.clone?z.clone():z};y._keys.splice(w+1,0,B),v=w+1}j=!0}if(!V&&F>=R.frame&&F<=L.frame){if(F===R.frame)b=w;else if(F===L.frame)b=w+1;else{var N={key:w,repeatCount:0,loopMode:this.ANIMATIONLOOPMODE_CONSTANT},z=y._interpolate(F,N),B={frame:F,value:z.clone?z.clone():z};y._keys.splice(w+1,0,B),b=w+1}V=!0}w++}y.dataType===t.ANIMATIONTYPE_QUATERNION?E.referenceValue.normalize().conjugateInPlace():y.dataType===t.ANIMATIONTYPE_MATRIX&&(E.referenceValue.decompose(E.referenceScaling,E.referenceQuaternion,E.referencePosition),E.referenceQuaternion.normalize().conjugateInPlace());for(var w=v;w<=b;w++){var B=y._keys[w];if(!(w&&y.dataType!==t.ANIMATIONTYPE_FLOAT&&B.value===f.value))switch(y.dataType){case t.ANIMATIONTYPE_MATRIX:B.value.decompose(E.keyScaling,E.keyQuaternion,E.keyPosition),E.keyPosition.subtractInPlace(E.referencePosition),E.keyScaling.divideInPlace(E.referenceScaling),E.referenceQuaternion.multiplyToRef(E.keyQuaternion,E.keyQuaternion),P.a.ComposeToRef(E.keyScaling,E.keyQuaternion,E.keyPosition,B.value);break;case t.ANIMATIONTYPE_QUATERNION:E.referenceValue.multiplyToRef(B.value,B.value);break;case t.ANIMATIONTYPE_VECTOR2:case t.ANIMATIONTYPE_VECTOR3:case t.ANIMATIONTYPE_COLOR3:case t.ANIMATIONTYPE_COLOR4:B.value.subtractToRef(E.referenceValue,B.value);break;case t.ANIMATIONTYPE_SIZE:B.value.width-=E.referenceValue.width,B.value.height-=E.referenceValue.height;break;default:B.value-=E.referenceValue}}return y},t.TransitionTo=function(e,i,r,o,g,y,v,f){if(f===void 0&&(f=null),v<=0)return r[e]=i,f&&f(),null;var b=g*(v/1e3);y.setKeys([{frame:0,value:r[e].clone?r[e].clone():r[e]},{frame:b,value:i}]),r.animations||(r.animations=[]),r.animations.push(y);var T=o.beginAnimation(r,0,b,!1);return T.onAnimationEnd=f,T},Object.defineProperty(t.prototype,"runtimeAnimations",{get:function(){return this._runtimeAnimations},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasRunningRuntimeAnimations",{get:function(){for(var e=0,i=this._runtimeAnimations;e<i.length;e++){var r=i[e];if(!r.isStopped)return!0}return!1},enumerable:!1,configurable:!0}),t.prototype.toString=function(e){var i="Name: "+this.name+", property: "+this.targetProperty;if(i+=", datatype: "+["Float","Vector3","Quaternion","Matrix","Color3","Vector2"][this.dataType],i+=", nKeys: "+(this._keys?this._keys.length:"none"),i+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),e){i+=", Ranges: {";var r=!0;for(var o in this._ranges)r&&(i+=", ",r=!1),i+=o;i+="}"}return i},t.prototype.addEvent=function(e){this._events.push(e),this._events.sort(function(i,r){return i.frame-r.frame})},t.prototype.removeEvents=function(e){for(var i=0;i<this._events.length;i++)this._events[i].frame===e&&(this._events.splice(i,1),i--)},t.prototype.getEvents=function(){return this._events},t.prototype.createRange=function(e,i,r){this._ranges[e]||(this._ranges[e]=new _.a(e,i,r))},t.prototype.deleteRange=function(e,i){i===void 0&&(i=!0);var r=this._ranges[e];if(!!r){if(i)for(var o=r.from,g=r.to,y=this._keys.length-1;y>=0;y--)this._keys[y].frame>=o&&this._keys[y].frame<=g&&this._keys.splice(y,1);this._ranges[e]=null}},t.prototype.getRange=function(e){return this._ranges[e]},t.prototype.getKeys=function(){return this._keys},t.prototype.getHighestFrame=function(){for(var e=0,i=0,r=this._keys.length;i<r;i++)e<this._keys[i].frame&&(e=this._keys[i].frame);return e},t.prototype.getEasingFunction=function(){return this._easingFunction},t.prototype.setEasingFunction=function(e){this._easingFunction=e},t.prototype.floatInterpolateFunction=function(e,i,r){return m.a.Lerp(e,i,r)},t.prototype.floatInterpolateFunctionWithTangents=function(e,i,r,o,g){return m.a.Hermite(e,i,r,o,g)},t.prototype.quaternionInterpolateFunction=function(e,i,r){return P.b.Slerp(e,i,r)},t.prototype.quaternionInterpolateFunctionWithTangents=function(e,i,r,o,g){return P.b.Hermite(e,i,r,o,g).normalize()},t.prototype.vector3InterpolateFunction=function(e,i,r){return P.e.Lerp(e,i,r)},t.prototype.vector3InterpolateFunctionWithTangents=function(e,i,r,o,g){return P.e.Hermite(e,i,r,o,g)},t.prototype.vector2InterpolateFunction=function(e,i,r){return P.d.Lerp(e,i,r)},t.prototype.vector2InterpolateFunctionWithTangents=function(e,i,r,o,g){return P.d.Hermite(e,i,r,o,g)},t.prototype.sizeInterpolateFunction=function(e,i,r){return u.a.Lerp(e,i,r)},t.prototype.color3InterpolateFunction=function(e,i,r){return d.a.Lerp(e,i,r)},t.prototype.color4InterpolateFunction=function(e,i,r){return d.b.Lerp(e,i,r)},t.prototype._getKeyValue=function(e){return typeof e=="function"?e():e},t.prototype.evaluate=function(e){return this._interpolate(e,{key:0,repeatCount:0,loopMode:t.ANIMATIONLOOPMODE_CONSTANT})},t.prototype._interpolate=function(e,i){if(i.loopMode===t.ANIMATIONLOOPMODE_CONSTANT&&i.repeatCount>0)return i.highLimitValue.clone?i.highLimitValue.clone():i.highLimitValue;var r=this._keys;if(r.length===1)return this._getKeyValue(r[0].value);var o=i.key;if(r[o].frame>=e)for(;o-1>=0&&r[o].frame>=e;)o--;for(var g=o;g<r.length-1;g++){var y=r[g+1];if(y.frame>=e){i.key=g;var v=r[g],f=this._getKeyValue(v.value);if(v.interpolation===a.a.STEP)return f;var b=this._getKeyValue(y.value),T=v.outTangent!==void 0&&y.inTangent!==void 0,E=y.frame-v.frame,O=(e-v.frame)/E,D=this.getEasingFunction();switch(D!=null&&(O=D.ease(O)),this.dataType){case t.ANIMATIONTYPE_FLOAT:var F=T?this.floatInterpolateFunctionWithTangents(f,v.outTangent*E,b,y.inTangent*E,O):this.floatInterpolateFunction(f,b,O);switch(i.loopMode){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:return F;case t.ANIMATIONLOOPMODE_RELATIVE:return i.offsetValue*i.repeatCount+F}break;case t.ANIMATIONTYPE_QUATERNION:var x=T?this.quaternionInterpolateFunctionWithTangents(f,v.outTangent.scale(E),b,y.inTangent.scale(E),O):this.quaternionInterpolateFunction(f,b,O);switch(i.loopMode){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:return x;case t.ANIMATIONLOOPMODE_RELATIVE:return x.addInPlace(i.offsetValue.scale(i.repeatCount))}return x;case t.ANIMATIONTYPE_VECTOR3:var j=T?this.vector3InterpolateFunctionWithTangents(f,v.outTangent.scale(E),b,y.inTangent.scale(E),O):this.vector3InterpolateFunction(f,b,O);switch(i.loopMode){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:return j;case t.ANIMATIONLOOPMODE_RELATIVE:return j.add(i.offsetValue.scale(i.repeatCount))}case t.ANIMATIONTYPE_VECTOR2:var V=T?this.vector2InterpolateFunctionWithTangents(f,v.outTangent.scale(E),b,y.inTangent.scale(E),O):this.vector2InterpolateFunction(f,b,O);switch(i.loopMode){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:return V;case t.ANIMATIONLOOPMODE_RELATIVE:return V.add(i.offsetValue.scale(i.repeatCount))}case t.ANIMATIONTYPE_SIZE:switch(i.loopMode){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:return this.sizeInterpolateFunction(f,b,O);case t.ANIMATIONLOOPMODE_RELATIVE:return this.sizeInterpolateFunction(f,b,O).add(i.offsetValue.scale(i.repeatCount))}case t.ANIMATIONTYPE_COLOR3:switch(i.loopMode){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:return this.color3InterpolateFunction(f,b,O);case t.ANIMATIONLOOPMODE_RELATIVE:return this.color3InterpolateFunction(f,b,O).add(i.offsetValue.scale(i.repeatCount))}case t.ANIMATIONTYPE_COLOR4:switch(i.loopMode){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:return this.color4InterpolateFunction(f,b,O);case t.ANIMATIONLOOPMODE_RELATIVE:return this.color4InterpolateFunction(f,b,O).add(i.offsetValue.scale(i.repeatCount))}case t.ANIMATIONTYPE_MATRIX:switch(i.loopMode){case t.ANIMATIONLOOPMODE_CYCLE:case t.ANIMATIONLOOPMODE_CONSTANT:if(t.AllowMatricesInterpolation)return this.matrixInterpolateFunction(f,b,O,i.workValue);case t.ANIMATIONLOOPMODE_RELATIVE:return f}default:break}break}}return this._getKeyValue(r[r.length-1].value)},t.prototype.matrixInterpolateFunction=function(e,i,r,o){return t.AllowMatrixDecomposeForInterpolation?o?(P.a.DecomposeLerpToRef(e,i,r,o),o):P.a.DecomposeLerp(e,i,r):o?(P.a.LerpToRef(e,i,r,o),o):P.a.Lerp(e,i,r)},t.prototype.clone=function(){var e=new t(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(e.enableBlending=this.enableBlending,e.blendingSpeed=this.blendingSpeed,this._keys&&e.setKeys(this._keys),this._ranges){e._ranges={};for(var i in this._ranges){var r=this._ranges[i];!r||(e._ranges[i]=r.clone())}}return e},t.prototype.setKeys=function(e){this._keys=e.slice(0)},t.prototype.serialize=function(){var e={};e.name=this.name,e.property=this.targetProperty,e.framePerSecond=this.framePerSecond,e.dataType=this.dataType,e.loopBehavior=this.loopMode,e.enableBlending=this.enableBlending,e.blendingSpeed=this.blendingSpeed;var i=this.dataType;e.keys=[];for(var r=this.getKeys(),o=0;o<r.length;o++){var g=r[o],y={};switch(y.frame=g.frame,i){case t.ANIMATIONTYPE_FLOAT:y.values=[g.value],g.inTangent!==void 0&&y.values.push(g.inTangent),g.outTangent!==void 0&&(g.inTangent===void 0&&y.values.push(void 0),y.values.push(g.outTangent));break;case t.ANIMATIONTYPE_QUATERNION:case t.ANIMATIONTYPE_MATRIX:case t.ANIMATIONTYPE_VECTOR3:case t.ANIMATIONTYPE_COLOR3:case t.ANIMATIONTYPE_COLOR4:y.values=g.value.asArray(),g.inTangent!=null&&y.values.push(g.inTangent.asArray()),g.outTangent!=null&&(g.inTangent===void 0&&y.values.push(void 0),y.values.push(g.outTangent.asArray()));break}e.keys.push(y)}e.ranges=[];for(var v in this._ranges){var f=this._ranges[v];if(!!f){var b={};b.name=v,b.from=f.from,b.to=f.to,e.ranges.push(b)}}return e},t._UniversalLerp=function(e,i,r){var o=e.constructor;return o.Lerp?o.Lerp(e,i,r):o.Slerp?o.Slerp(e,i,r):e.toFixed?e*(1-r)+r*i:i},t.Parse=function(e){var i=new t(e.name,e.property,e.framePerSecond,e.dataType,e.loopBehavior),r=e.dataType,o=[],g,y;for(e.enableBlending&&(i.enableBlending=e.enableBlending),e.blendingSpeed&&(i.blendingSpeed=e.blendingSpeed),y=0;y<e.keys.length;y++){var v=e.keys[y],f,b;switch(r){case t.ANIMATIONTYPE_FLOAT:g=v.values[0],v.values.length>=1&&(f=v.values[1]),v.values.length>=2&&(b=v.values[2]);break;case t.ANIMATIONTYPE_QUATERNION:if(g=P.b.FromArray(v.values),v.values.length>=8){var T=P.b.FromArray(v.values.slice(4,8));T.equals(P.b.Zero())||(f=T)}if(v.values.length>=12){var E=P.b.FromArray(v.values.slice(8,12));E.equals(P.b.Zero())||(b=E)}break;case t.ANIMATIONTYPE_MATRIX:g=P.a.FromArray(v.values);break;case t.ANIMATIONTYPE_COLOR3:g=d.a.FromArray(v.values);break;case t.ANIMATIONTYPE_COLOR4:g=d.b.FromArray(v.values);break;case t.ANIMATIONTYPE_VECTOR3:default:g=P.e.FromArray(v.values);break}var O={};O.frame=v.frame,O.value=g,f!=null&&(O.inTangent=f),b!=null&&(O.outTangent=b),o.push(O)}if(i.setKeys(o),e.ranges)for(y=0;y<e.ranges.length;y++)g=e.ranges[y],i.createRange(g.name,g.from,g.to);return i},t.AppendSerializedAnimations=function(e,i){n.a.AppendSerializedAnimations(e,i)},t.ParseFromFileAsync=function(e,i){var r=this;return new Promise(function(o,g){var y=new p.a;y.addEventListener("readystatechange",function(){if(y.readyState==4)if(y.status==200){var v=JSON.parse(y.responseText);if(v.length){for(var f=new Array,b=0,T=v;b<T.length;b++){var E=T[b];f.push(r.Parse(E))}o(f)}else{var f=r.Parse(v);e&&(f.name=e),o(f)}}else g("Unable to load the animation")}),y.open("GET",i),y.send()})},t.CreateFromSnippetAsync=function(e){var i=this;return new Promise(function(r,o){var g=new p.a;g.addEventListener("readystatechange",function(){if(g.readyState==4)if(g.status==200){var y=JSON.parse(JSON.parse(g.responseText).jsonPayload);if(y.animations){for(var v=JSON.parse(y.animations),f=new Array,b=0,T=v;b<T.length;b++){var E=T[b];f.push(i.Parse(E))}r(f)}else{var v=JSON.parse(y.animation),f=i.Parse(v);f.snippetId=e,r(f)}}else o("Unable to load the snippet "+e)}),g.open("GET",i.SnippetUrl+"/"+e.replace(/#/g,"/")),g.send()})},t.AllowMatricesInterpolation=!1,t.AllowMatrixDecomposeForInterpolation=!0,t.SnippetUrl="https://snippet.babylonjs.com",t.ANIMATIONTYPE_FLOAT=0,t.ANIMATIONTYPE_VECTOR3=1,t.ANIMATIONTYPE_QUATERNION=2,t.ANIMATIONTYPE_MATRIX=3,t.ANIMATIONTYPE_COLOR3=4,t.ANIMATIONTYPE_COLOR4=7,t.ANIMATIONTYPE_VECTOR2=5,t.ANIMATIONTYPE_SIZE=6,t.ANIMATIONLOOPMODE_RELATIVE=0,t.ANIMATIONLOOPMODE_CYCLE=1,t.ANIMATIONLOOPMODE_CONSTANT=2,t}();c.a.RegisteredTypes["BABYLON.Animation"]=h,s.a._AnimationRangeFactory=function(t,e,i){return new _.a(t,e,i)}},function($,W,M){"use strict";M.d(W,"a",function(){return s});var P=M(434),d=M(439),m=M(436),n=M(441),c=M(453),a=M(557),_=M(437),s=function(u){Object(P.d)(p,u);function p(l,h){var t=u.call(this,l,h)||this;return t.diffuse=new n.a(1,1,1),t.specular=new n.a(1,1,1),t.falloffType=p.FALLOFF_DEFAULT,t.intensity=1,t._range=Number.MAX_VALUE,t._inverseSquaredRange=0,t._photometricScale=1,t._intensityMode=p.INTENSITYMODE_AUTOMATIC,t._radius=1e-5,t.renderPriority=0,t._shadowEnabled=!0,t._excludeWithLayerMask=0,t._includeOnlyWithLayerMask=0,t._lightmapMode=0,t._excludedMeshesIds=new Array,t._includedOnlyMeshesIds=new Array,t._isLight=!0,t.getScene().addLight(t),t._uniformBuffer=new a.a(t.getScene().getEngine(),void 0,void 0,l),t._buildUniformLayout(),t.includedOnlyMeshes=new Array,t.excludedMeshes=new Array,t._resyncMeshes(),t}return Object.defineProperty(p.prototype,"range",{get:function(){return this._range},set:function(l){this._range=l,this._inverseSquaredRange=1/(this.range*this.range)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"intensityMode",{get:function(){return this._intensityMode},set:function(l){this._intensityMode=l,this._computePhotometricScale()},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"radius",{get:function(){return this._radius},set:function(l){this._radius=l,this._computePhotometricScale()},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"shadowEnabled",{get:function(){return this._shadowEnabled},set:function(l){this._shadowEnabled!==l&&(this._shadowEnabled=l,this._markMeshesAsLightDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"includedOnlyMeshes",{get:function(){return this._includedOnlyMeshes},set:function(l){this._includedOnlyMeshes=l,this._hookArrayForIncludedOnly(l)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"excludedMeshes",{get:function(){return this._excludedMeshes},set:function(l){this._excludedMeshes=l,this._hookArrayForExcluded(l)},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"excludeWithLayerMask",{get:function(){return this._excludeWithLayerMask},set:function(l){this._excludeWithLayerMask=l,this._resyncMeshes()},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"includeOnlyWithLayerMask",{get:function(){return this._includeOnlyWithLayerMask},set:function(l){this._includeOnlyWithLayerMask=l,this._resyncMeshes()},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"lightmapMode",{get:function(){return this._lightmapMode},set:function(l){this._lightmapMode!==l&&(this._lightmapMode=l,this._markMeshesAsLightDirty())},enumerable:!1,configurable:!0}),p.prototype.transferTexturesToEffect=function(l,h){return this},p.prototype._bindLight=function(l,h,t,e,i){i===void 0&&(i=!1);var r=l.toString(),o=!1;if(!(i&&this._uniformBuffer._alreadyBound)){if(this._uniformBuffer.bindToEffect(t,"Light"+r),this._renderId!==h.getRenderId()||!this._uniformBuffer.useUbo){this._renderId=h.getRenderId();var g=this.getScaledIntensity();this.transferToEffect(t,r),this.diffuse.scaleToRef(g,n.c.Color3[0]),this._uniformBuffer.updateColor4("vLightDiffuse",n.c.Color3[0],this.range,r),e&&(this.specular.scaleToRef(g,n.c.Color3[1]),this._uniformBuffer.updateColor4("vLightSpecular",n.c.Color3[1],this.radius,r)),o=!0}if(this.transferTexturesToEffect(t,r),h.shadowsEnabled&&this.shadowEnabled){var y=this.getShadowGenerator();y&&(y.bindShadowLight(r,t),o=!0)}o&&this._uniformBuffer.update()}},p.prototype.getClassName=function(){return"Light"},p.prototype.toString=function(l){var h="Name: "+this.name;if(h+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(var t=0;t<this.animations.length;t++)h+=", animation[0]: "+this.animations[t].toString(l);return h},p.prototype._syncParentEnabledState=function(){u.prototype._syncParentEnabledState.call(this),this.isDisposed()||this._resyncMeshes()},p.prototype.setEnabled=function(l){u.prototype.setEnabled.call(this,l),this._resyncMeshes()},p.prototype.getShadowGenerator=function(){return this._shadowGenerator},p.prototype.getAbsolutePosition=function(){return m.e.Zero()},p.prototype.canAffectMesh=function(l){return l?!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&this.includedOnlyMeshes.indexOf(l)===-1||this.excludedMeshes&&this.excludedMeshes.length>0&&this.excludedMeshes.indexOf(l)!==-1||this.includeOnlyWithLayerMask!==0&&(this.includeOnlyWithLayerMask&l.layerMask)==0||this.excludeWithLayerMask!==0&&this.excludeWithLayerMask&l.layerMask):!0},p.CompareLightsPriority=function(l,h){return l.shadowEnabled!==h.shadowEnabled?(h.shadowEnabled?1:0)-(l.shadowEnabled?1:0):h.renderPriority-l.renderPriority},p.prototype.dispose=function(l,h){h===void 0&&(h=!1),this._shadowGenerator&&(this._shadowGenerator.dispose(),this._shadowGenerator=null),this.getScene().stopAnimation(this);for(var t=0,e=this.getScene().meshes;t<e.length;t++){var i=e[t];i._removeLightSource(this,!0)}this._uniformBuffer.dispose(),this.getScene().removeLight(this),u.prototype.dispose.call(this,l,h)},p.prototype.getTypeID=function(){return 0},p.prototype.getScaledIntensity=function(){return this._photometricScale*this.intensity},p.prototype.clone=function(l,h){h===void 0&&(h=null);var t=p.GetConstructorFromName(this.getTypeID(),l,this.getScene());if(!t)return null;var e=d.a.Clone(t,this);return h&&(e.parent=h),e.setEnabled(this.isEnabled()),e},p.prototype.serialize=function(){var l=d.a.Serialize(this);return l.type=this.getTypeID(),this.parent&&(l.parentId=this.parent.id),this.excludedMeshes.length>0&&(l.excludedMeshesIds=[],this.excludedMeshes.forEach(function(h){l.excludedMeshesIds.push(h.id)})),this.includedOnlyMeshes.length>0&&(l.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach(function(h){l.includedOnlyMeshesIds.push(h.id)})),d.a.AppendSerializedAnimations(this,l),l.ranges=this.serializeAnimationRanges(),l},p.GetConstructorFromName=function(l,h,t){var e=c.a.Construct("Light_Type_"+l,h,t);return e||null},p.Parse=function(l,h){var t=p.GetConstructorFromName(l.type,l.name,h);if(!t)return null;var e=d.a.Parse(t,l,h);if(l.excludedMeshesIds&&(e._excludedMeshesIds=l.excludedMeshesIds),l.includedOnlyMeshesIds&&(e._includedOnlyMeshesIds=l.includedOnlyMeshesIds),l.parentId&&(e._waitingParentId=l.parentId),l.falloffType!==void 0&&(e.falloffType=l.falloffType),l.lightmapMode!==void 0&&(e.lightmapMode=l.lightmapMode),l.animations){for(var i=0;i<l.animations.length;i++){var r=l.animations[i],o=_.a.GetClass("BABYLON.Animation");o&&e.animations.push(o.Parse(r))}c.a.ParseAnimationRanges(e,l,h)}return l.autoAnimate&&h.beginAnimation(e,l.autoAnimateFrom,l.autoAnimateTo,l.autoAnimateLoop,l.autoAnimateSpeed||1),e},p.prototype._hookArrayForExcluded=function(l){var h=this,t=l.push;l.push=function(){for(var g=[],y=0;y<arguments.length;y++)g[y]=arguments[y];for(var v=t.apply(l,g),f=0,b=g;f<b.length;f++){var T=b[f];T._resyncLightSource(h)}return v};var e=l.splice;l.splice=function(g,y){for(var v=e.apply(l,[g,y]),f=0,b=v;f<b.length;f++){var T=b[f];T._resyncLightSource(h)}return v};for(var i=0,r=l;i<r.length;i++){var o=r[i];o._resyncLightSource(this)}},p.prototype._hookArrayForIncludedOnly=function(l){var h=this,t=l.push;l.push=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];var o=t.apply(l,i);return h._resyncMeshes(),o};var e=l.splice;l.splice=function(i,r){var o=e.apply(l,[i,r]);return h._resyncMeshes(),o},this._resyncMeshes()},p.prototype._resyncMeshes=function(){for(var l=0,h=this.getScene().meshes;l<h.length;l++){var t=h[l];t._resyncLightSource(this)}},p.prototype._markMeshesAsLightDirty=function(){for(var l=0,h=this.getScene().meshes;l<h.length;l++){var t=h[l];t.lightSources.indexOf(this)!==-1&&t._markSubMeshesAsLightDirty()}},p.prototype._computePhotometricScale=function(){this._photometricScale=this._getPhotometricScale(),this.getScene().resetCachedMaterial()},p.prototype._getPhotometricScale=function(){var l=0,h=this.getTypeID(),t=this.intensityMode;switch(t===p.INTENSITYMODE_AUTOMATIC&&(h===p.LIGHTTYPEID_DIRECTIONALLIGHT?t=p.INTENSITYMODE_ILLUMINANCE:t=p.INTENSITYMODE_LUMINOUSINTENSITY),h){case p.LIGHTTYPEID_POINTLIGHT:case p.LIGHTTYPEID_SPOTLIGHT:switch(t){case p.INTENSITYMODE_LUMINOUSPOWER:l=1/(4*Math.PI);break;case p.INTENSITYMODE_LUMINOUSINTENSITY:l=1;break;case p.INTENSITYMODE_LUMINANCE:l=this.radius*this.radius;break}break;case p.LIGHTTYPEID_DIRECTIONALLIGHT:switch(t){case p.INTENSITYMODE_ILLUMINANCE:l=1;break;case p.INTENSITYMODE_LUMINANCE:var e=this.radius;e=Math.max(e,.001);var i=2*Math.PI*(1-Math.cos(e));l=i;break}break;case p.LIGHTTYPEID_HEMISPHERICLIGHT:l=1;break}return l},p.prototype._reorderLightsInScene=function(){var l=this.getScene();this._renderPriority!=0&&(l.requireLightSorting=!0),this.getScene().sortLightsByPriority()},p.FALLOFF_DEFAULT=0,p.FALLOFF_PHYSICAL=1,p.FALLOFF_GLTF=2,p.FALLOFF_STANDARD=3,p.LIGHTMAP_DEFAULT=0,p.LIGHTMAP_SPECULAR=1,p.LIGHTMAP_SHADOWSONLY=2,p.INTENSITYMODE_AUTOMATIC=0,p.INTENSITYMODE_LUMINOUSPOWER=1,p.INTENSITYMODE_LUMINOUSINTENSITY=2,p.INTENSITYMODE_ILLUMINANCE=3,p.INTENSITYMODE_LUMINANCE=4,p.LIGHTTYPEID_POINTLIGHT=0,p.LIGHTTYPEID_DIRECTIONALLIGHT=1,p.LIGHTTYPEID_SPOTLIGHT=2,p.LIGHTTYPEID_HEMISPHERICLIGHT=3,Object(P.c)([Object(d.e)()],p.prototype,"diffuse",void 0),Object(P.c)([Object(d.e)()],p.prototype,"specular",void 0),Object(P.c)([Object(d.c)()],p.prototype,"falloffType",void 0),Object(P.c)([Object(d.c)()],p.prototype,"intensity",void 0),Object(P.c)([Object(d.c)()],p.prototype,"range",null),Object(P.c)([Object(d.c)()],p.prototype,"intensityMode",null),Object(P.c)([Object(d.c)()],p.prototype,"radius",null),Object(P.c)([Object(d.c)()],p.prototype,"_renderPriority",void 0),Object(P.c)([Object(d.b)("_reorderLightsInScene")],p.prototype,"renderPriority",void 0),Object(P.c)([Object(d.c)("shadowEnabled")],p.prototype,"_shadowEnabled",void 0),Object(P.c)([Object(d.c)("excludeWithLayerMask")],p.prototype,"_excludeWithLayerMask",void 0),Object(P.c)([Object(d.c)("includeOnlyWithLayerMask")],p.prototype,"_includeOnlyWithLayerMask",void 0),Object(P.c)([Object(d.c)("lightmapMode")],p.prototype,"_lightmapMode",void 0),p}(c.a)},function($,W,M){"use strict";M.d(W,"a",function(){return a});var P=M(436),d=M(447),m=M(476),n=M(441),c=M(440),a=function(){function _(){}return _.prototype.set=function(s,u){switch(s.length||c.a.Warn("Setting vertex data kind '"+u+"' with an empty array"),u){case d.b.PositionKind:this.positions=s;break;case d.b.NormalKind:this.normals=s;break;case d.b.TangentKind:this.tangents=s;break;case d.b.UVKind:this.uvs=s;break;case d.b.UV2Kind:this.uvs2=s;break;case d.b.UV3Kind:this.uvs3=s;break;case d.b.UV4Kind:this.uvs4=s;break;case d.b.UV5Kind:this.uvs5=s;break;case d.b.UV6Kind:this.uvs6=s;break;case d.b.ColorKind:this.colors=s;break;case d.b.MatricesIndicesKind:this.matricesIndices=s;break;case d.b.MatricesWeightsKind:this.matricesWeights=s;break;case d.b.MatricesIndicesExtraKind:this.matricesIndicesExtra=s;break;case d.b.MatricesWeightsExtraKind:this.matricesWeightsExtra=s;break}},_.prototype.applyToMesh=function(s,u){return this._applyTo(s,u),this},_.prototype.applyToGeometry=function(s,u){return this._applyTo(s,u),this},_.prototype.updateMesh=function(s){return this._update(s),this},_.prototype.updateGeometry=function(s){return this._update(s),this},_.prototype._applyTo=function(s,u){return u===void 0&&(u=!1),this.positions&&s.setVerticesData(d.b.PositionKind,this.positions,u),this.normals&&s.setVerticesData(d.b.NormalKind,this.normals,u),this.tangents&&s.setVerticesData(d.b.TangentKind,this.tangents,u),this.uvs&&s.setVerticesData(d.b.UVKind,this.uvs,u),this.uvs2&&s.setVerticesData(d.b.UV2Kind,this.uvs2,u),this.uvs3&&s.setVerticesData(d.b.UV3Kind,this.uvs3,u),this.uvs4&&s.setVerticesData(d.b.UV4Kind,this.uvs4,u),this.uvs5&&s.setVerticesData(d.b.UV5Kind,this.uvs5,u),this.uvs6&&s.setVerticesData(d.b.UV6Kind,this.uvs6,u),this.colors&&s.setVerticesData(d.b.ColorKind,this.colors,u),this.matricesIndices&&s.setVerticesData(d.b.MatricesIndicesKind,this.matricesIndices,u),this.matricesWeights&&s.setVerticesData(d.b.MatricesWeightsKind,this.matricesWeights,u),this.matricesIndicesExtra&&s.setVerticesData(d.b.MatricesIndicesExtraKind,this.matricesIndicesExtra,u),this.matricesWeightsExtra&&s.setVerticesData(d.b.MatricesWeightsExtraKind,this.matricesWeightsExtra,u),this.indices?s.setIndices(this.indices,null,u):s.setIndices([],null),this},_.prototype._update=function(s,u,p){return this.positions&&s.updateVerticesData(d.b.PositionKind,this.positions,u,p),this.normals&&s.updateVerticesData(d.b.NormalKind,this.normals,u,p),this.tangents&&s.updateVerticesData(d.b.TangentKind,this.tangents,u,p),this.uvs&&s.updateVerticesData(d.b.UVKind,this.uvs,u,p),this.uvs2&&s.updateVerticesData(d.b.UV2Kind,this.uvs2,u,p),this.uvs3&&s.updateVerticesData(d.b.UV3Kind,this.uvs3,u,p),this.uvs4&&s.updateVerticesData(d.b.UV4Kind,this.uvs4,u,p),this.uvs5&&s.updateVerticesData(d.b.UV5Kind,this.uvs5,u,p),this.uvs6&&s.updateVerticesData(d.b.UV6Kind,this.uvs6,u,p),this.colors&&s.updateVerticesData(d.b.ColorKind,this.colors,u,p),this.matricesIndices&&s.updateVerticesData(d.b.MatricesIndicesKind,this.matricesIndices,u,p),this.matricesWeights&&s.updateVerticesData(d.b.MatricesWeightsKind,this.matricesWeights,u,p),this.matricesIndicesExtra&&s.updateVerticesData(d.b.MatricesIndicesExtraKind,this.matricesIndicesExtra,u,p),this.matricesWeightsExtra&&s.updateVerticesData(d.b.MatricesWeightsExtraKind,this.matricesWeightsExtra,u,p),this.indices&&s.setIndices(this.indices,null),this},_.prototype.transform=function(s){var u=s.determinant()<0,p=P.e.Zero(),l;if(this.positions){var h=P.e.Zero();for(l=0;l<this.positions.length;l+=3)P.e.FromArrayToRef(this.positions,l,h),P.e.TransformCoordinatesToRef(h,s,p),this.positions[l]=p.x,this.positions[l+1]=p.y,this.positions[l+2]=p.z}if(this.normals){var t=P.e.Zero();for(l=0;l<this.normals.length;l+=3)P.e.FromArrayToRef(this.normals,l,t),P.e.TransformNormalToRef(t,s,p),this.normals[l]=p.x,this.normals[l+1]=p.y,this.normals[l+2]=p.z}if(this.tangents){var e=P.f.Zero(),i=P.f.Zero();for(l=0;l<this.tangents.length;l+=4)P.f.FromArrayToRef(this.tangents,l,e),P.f.TransformNormalToRef(e,s,i),this.tangents[l]=i.x,this.tangents[l+1]=i.y,this.tangents[l+2]=i.z,this.tangents[l+3]=i.w}if(u&&this.indices)for(l=0;l<this.indices.length;l+=3){var r=this.indices[l+1];this.indices[l+1]=this.indices[l+2],this.indices[l+2]=r}return this},_.prototype.merge=function(s,u){if(u===void 0&&(u=!1),this._validate(),s._validate(),!this.normals!=!s.normals||!this.tangents!=!s.tangents||!this.uvs!=!s.uvs||!this.uvs2!=!s.uvs2||!this.uvs3!=!s.uvs3||!this.uvs4!=!s.uvs4||!this.uvs5!=!s.uvs5||!this.uvs6!=!s.uvs6||!this.colors!=!s.colors||!this.matricesIndices!=!s.matricesIndices||!this.matricesWeights!=!s.matricesWeights||!this.matricesIndicesExtra!=!s.matricesIndicesExtra||!this.matricesWeightsExtra!=!s.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(s.indices){this.indices||(this.indices=[]);var p=this.positions?this.positions.length/3:0,l=this.indices.BYTES_PER_ELEMENT!==void 0;if(l){var h=this.indices.length+s.indices.length,t=u||this.indices instanceof Uint32Array?new Uint32Array(h):new Uint16Array(h);t.set(this.indices);for(var e=this.indices.length,i=0;i<s.indices.length;i++)t[e+i]=s.indices[i]+p;this.indices=t}else for(var i=0;i<s.indices.length;i++)this.indices.push(s.indices[i]+p)}return this.positions=this._mergeElement(this.positions,s.positions),this.normals=this._mergeElement(this.normals,s.normals),this.tangents=this._mergeElement(this.tangents,s.tangents),this.uvs=this._mergeElement(this.uvs,s.uvs),this.uvs2=this._mergeElement(this.uvs2,s.uvs2),this.uvs3=this._mergeElement(this.uvs3,s.uvs3),this.uvs4=this._mergeElement(this.uvs4,s.uvs4),this.uvs5=this._mergeElement(this.uvs5,s.uvs5),this.uvs6=this._mergeElement(this.uvs6,s.uvs6),this.colors=this._mergeElement(this.colors,s.colors),this.matricesIndices=this._mergeElement(this.matricesIndices,s.matricesIndices),this.matricesWeights=this._mergeElement(this.matricesWeights,s.matricesWeights),this.matricesIndicesExtra=this._mergeElement(this.matricesIndicesExtra,s.matricesIndicesExtra),this.matricesWeightsExtra=this._mergeElement(this.matricesWeightsExtra,s.matricesWeightsExtra),this},_.prototype._mergeElement=function(s,u){if(!s)return u;if(!u)return s;var p=u.length+s.length,l=s instanceof Float32Array,h=u instanceof Float32Array;if(l){var t=new Float32Array(p);return t.set(s),t.set(u,s.length),t}else if(h){for(var e=s.slice(0),i=0,p=u.length;i<p;i++)e.push(u[i]);return e}else return s.concat(u)},_.prototype._validate=function(){if(!this.positions)throw new Error("Positions are required");var s=function(l,h){var t=d.b.DeduceStride(l);if(h.length%t!=0)throw new Error("The "+l+"s array count must be a multiple of "+t);return h.length/t},u=s(d.b.PositionKind,this.positions),p=function(l,h){var t=s(l,h);if(t!==u)throw new Error("The "+l+"s element count ("+t+") does not match the positions count ("+u+")")};this.normals&&p(d.b.NormalKind,this.normals),this.tangents&&p(d.b.TangentKind,this.tangents),this.uvs&&p(d.b.UVKind,this.uvs),this.uvs2&&p(d.b.UV2Kind,this.uvs2),this.uvs3&&p(d.b.UV3Kind,this.uvs3),this.uvs4&&p(d.b.UV4Kind,this.uvs4),this.uvs5&&p(d.b.UV5Kind,this.uvs5),this.uvs6&&p(d.b.UV6Kind,this.uvs6),this.colors&&p(d.b.ColorKind,this.colors),this.matricesIndices&&p(d.b.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&p(d.b.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&p(d.b.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&p(d.b.MatricesWeightsExtraKind,this.matricesWeightsExtra)},_.prototype.serialize=function(){var s=this.serialize();return this.positions&&(s.positions=this.positions),this.normals&&(s.normals=this.normals),this.tangents&&(s.tangents=this.tangents),this.uvs&&(s.uvs=this.uvs),this.uvs2&&(s.uvs2=this.uvs2),this.uvs3&&(s.uvs3=this.uvs3),this.uvs4&&(s.uvs4=this.uvs4),this.uvs5&&(s.uvs5=this.uvs5),this.uvs6&&(s.uvs6=this.uvs6),this.colors&&(s.colors=this.colors),this.matricesIndices&&(s.matricesIndices=this.matricesIndices,s.matricesIndices._isExpanded=!0),this.matricesWeights&&(s.matricesWeights=this.matricesWeights),this.matricesIndicesExtra&&(s.matricesIndicesExtra=this.matricesIndicesExtra,s.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(s.matricesWeightsExtra=this.matricesWeightsExtra),s.indices=this.indices,s},_.ExtractFromMesh=function(s,u,p){return _._ExtractFrom(s,u,p)},_.ExtractFromGeometry=function(s,u,p){return _._ExtractFrom(s,u,p)},_._ExtractFrom=function(s,u,p){var l=new _;return s.isVerticesDataPresent(d.b.PositionKind)&&(l.positions=s.getVerticesData(d.b.PositionKind,u,p)),s.isVerticesDataPresent(d.b.NormalKind)&&(l.normals=s.getVerticesData(d.b.NormalKind,u,p)),s.isVerticesDataPresent(d.b.TangentKind)&&(l.tangents=s.getVerticesData(d.b.TangentKind,u,p)),s.isVerticesDataPresent(d.b.UVKind)&&(l.uvs=s.getVerticesData(d.b.UVKind,u,p)),s.isVerticesDataPresent(d.b.UV2Kind)&&(l.uvs2=s.getVerticesData(d.b.UV2Kind,u,p)),s.isVerticesDataPresent(d.b.UV3Kind)&&(l.uvs3=s.getVerticesData(d.b.UV3Kind,u,p)),s.isVerticesDataPresent(d.b.UV4Kind)&&(l.uvs4=s.getVerticesData(d.b.UV4Kind,u,p)),s.isVerticesDataPresent(d.b.UV5Kind)&&(l.uvs5=s.getVerticesData(d.b.UV5Kind,u,p)),s.isVerticesDataPresent(d.b.UV6Kind)&&(l.uvs6=s.getVerticesData(d.b.UV6Kind,u,p)),s.isVerticesDataPresent(d.b.ColorKind)&&(l.colors=s.getVerticesData(d.b.ColorKind,u,p)),s.isVerticesDataPresent(d.b.MatricesIndicesKind)&&(l.matricesIndices=s.getVerticesData(d.b.MatricesIndicesKind,u,p)),s.isVerticesDataPresent(d.b.MatricesWeightsKind)&&(l.matricesWeights=s.getVerticesData(d.b.MatricesWeightsKind,u,p)),s.isVerticesDataPresent(d.b.MatricesIndicesExtraKind)&&(l.matricesIndicesExtra=s.getVerticesData(d.b.MatricesIndicesExtraKind,u,p)),s.isVerticesDataPresent(d.b.MatricesWeightsExtraKind)&&(l.matricesWeightsExtra=s.getVerticesData(d.b.MatricesWeightsExtraKind,u,p)),l.indices=s.getIndices(u,p),l},_.CreateRibbon=function(s){throw m.a.WarnImport("ribbonBuilder")},_.CreateBox=function(s){throw m.a.WarnImport("boxBuilder")},_.CreateTiledBox=function(s){throw m.a.WarnImport("tiledBoxBuilder")},_.CreateTiledPlane=function(s){throw m.a.WarnImport("tiledPlaneBuilder")},_.CreateSphere=function(s){throw m.a.WarnImport("sphereBuilder")},_.CreateCylinder=function(s){throw m.a.WarnImport("cylinderBuilder")},_.CreateTorus=function(s){throw m.a.WarnImport("torusBuilder")},_.CreateLineSystem=function(s){throw m.a.WarnImport("linesBuilder")},_.CreateDashedLines=function(s){throw m.a.WarnImport("linesBuilder")},_.CreateGround=function(s){throw m.a.WarnImport("groundBuilder")},_.CreateTiledGround=function(s){throw m.a.WarnImport("groundBuilder")},_.CreateGroundFromHeightMap=function(s){throw m.a.WarnImport("groundBuilder")},_.CreatePlane=function(s){throw m.a.WarnImport("planeBuilder")},_.CreateDisc=function(s){throw m.a.WarnImport("discBuilder")},_.CreatePolygon=function(s,u,p,l,h,t,e){throw m.a.WarnImport("polygonBuilder")},_.CreateIcoSphere=function(s){throw m.a.WarnImport("icoSphereBuilder")},_.CreatePolyhedron=function(s){throw m.a.WarnImport("polyhedronBuilder")},_.CreateCapsule=function(s){throw s===void 0&&(s={orientation:P.e.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6}),m.a.WarnImport("capsuleBuilder")},_.CreateTorusKnot=function(s){throw m.a.WarnImport("torusKnotBuilder")},_.ComputeNormals=function(s,u,p,l){var h=0,t=0,e=0,i=0,r=0,o=0,g=0,y=0,v=0,f=0,b=0,T=0,E=0,O=0,D=0,F=0,x=0,j=0,V=0,z=0,w=!1,R=!1,L=!1,N=!1,B=1,X=0,K=null;if(l&&(w=!!l.facetNormals,R=!!l.facetPositions,L=!!l.facetPartitioning,B=l.useRightHandedSystem===!0?-1:1,X=l.ratio||0,N=!!l.depthSort,K=l.distanceTo,N)){K===void 0&&(K=P.e.Zero());var G=l.depthSortedFacets}var I=0,A=0,S=0,C=0;if(L&&l&&l.bbSize){var U=0,k=0,J=0,Y=0,Z=0,Q=0,te=0,re=0,ae=0,ne=0,ie=0,fe=0,he=0,pe=0,ue=0,_e=0,ge=l.bbSize.x>l.bbSize.y?l.bbSize.x:l.bbSize.y;ge=ge>l.bbSize.z?ge:l.bbSize.z,I=l.subDiv.X*X/l.bbSize.x,A=l.subDiv.Y*X/l.bbSize.y,S=l.subDiv.Z*X/l.bbSize.z,C=l.subDiv.max*l.subDiv.max,l.facetPartitioning.length=0}for(h=0;h<s.length;h++)p[h]=0;var Ee=u.length/3|0;for(h=0;h<Ee;h++){if(T=u[h*3]*3,E=T+1,O=T+2,D=u[h*3+1]*3,F=D+1,x=D+2,j=u[h*3+2]*3,V=j+1,z=j+2,t=s[T]-s[D],e=s[E]-s[F],i=s[O]-s[x],r=s[j]-s[D],o=s[V]-s[F],g=s[z]-s[x],y=B*(e*g-i*o),v=B*(i*r-t*g),f=B*(t*o-e*r),b=Math.sqrt(y*y+v*v+f*f),b=b===0?1:b,y/=b,v/=b,f/=b,w&&l&&(l.facetNormals[h].x=y,l.facetNormals[h].y=v,l.facetNormals[h].z=f),R&&l&&(l.facetPositions[h].x=(s[T]+s[D]+s[j])/3,l.facetPositions[h].y=(s[E]+s[F]+s[V])/3,l.facetPositions[h].z=(s[O]+s[x]+s[z])/3),L&&l&&(U=Math.floor((l.facetPositions[h].x-l.bInfo.minimum.x*X)*I),k=Math.floor((l.facetPositions[h].y-l.bInfo.minimum.y*X)*A),J=Math.floor((l.facetPositions[h].z-l.bInfo.minimum.z*X)*S),Y=Math.floor((s[T]-l.bInfo.minimum.x*X)*I),Z=Math.floor((s[E]-l.bInfo.minimum.y*X)*A),Q=Math.floor((s[O]-l.bInfo.minimum.z*X)*S),te=Math.floor((s[D]-l.bInfo.minimum.x*X)*I),re=Math.floor((s[F]-l.bInfo.minimum.y*X)*A),ae=Math.floor((s[x]-l.bInfo.minimum.z*X)*S),ne=Math.floor((s[j]-l.bInfo.minimum.x*X)*I),ie=Math.floor((s[V]-l.bInfo.minimum.y*X)*A),fe=Math.floor((s[z]-l.bInfo.minimum.z*X)*S),pe=Y+l.subDiv.max*Z+C*Q,ue=te+l.subDiv.max*re+C*ae,_e=ne+l.subDiv.max*ie+C*fe,he=U+l.subDiv.max*k+C*J,l.facetPartitioning[he]=l.facetPartitioning[he]?l.facetPartitioning[he]:new Array,l.facetPartitioning[pe]=l.facetPartitioning[pe]?l.facetPartitioning[pe]:new Array,l.facetPartitioning[ue]=l.facetPartitioning[ue]?l.facetPartitioning[ue]:new Array,l.facetPartitioning[_e]=l.facetPartitioning[_e]?l.facetPartitioning[_e]:new Array,l.facetPartitioning[pe].push(h),ue!=pe&&l.facetPartitioning[ue].push(h),_e==ue||_e==pe||l.facetPartitioning[_e].push(h),he==pe||he==ue||he==_e||l.facetPartitioning[he].push(h)),N&&l&&l.facetPositions){var Te=G[h];Te.ind=h*3,Te.sqDistance=P.e.DistanceSquared(l.facetPositions[h],K)}p[T]+=y,p[E]+=v,p[O]+=f,p[D]+=y,p[F]+=v,p[x]+=f,p[j]+=y,p[V]+=v,p[z]+=f}for(h=0;h<p.length/3;h++)y=p[h*3],v=p[h*3+1],f=p[h*3+2],b=Math.sqrt(y*y+v*v+f*f),b=b===0?1:b,y/=b,v/=b,f/=b,p[h*3]=y,p[h*3+1]=v,p[h*3+2]=f},_._ComputeSides=function(s,u,p,l,h,t,e){var i=p.length,r=l.length,o,g;switch(s=s||_.DEFAULTSIDE,s){case _.FRONTSIDE:break;case _.BACKSIDE:var y;for(o=0;o<i;o+=3)y=p[o],p[o]=p[o+2],p[o+2]=y;for(g=0;g<r;g++)l[g]=-l[g];break;case _.DOUBLESIDE:for(var v=u.length,f=v/3,b=0;b<v;b++)u[v+b]=u[b];for(o=0;o<i;o+=3)p[o+i]=p[o+2]+f,p[o+1+i]=p[o+1]+f,p[o+2+i]=p[o]+f;for(g=0;g<r;g++)l[r+g]=-l[g];var T=h.length,E=0;for(E=0;E<T;E++)h[E+T]=h[E];for(t=t||new P.f(0,0,1,1),e=e||new P.f(0,0,1,1),E=0,o=0;o<T/2;o++)h[E]=t.x+(t.z-t.x)*h[E],h[E+1]=t.y+(t.w-t.y)*h[E+1],h[E+T]=e.x+(e.z-e.x)*h[E+T],h[E+T+1]=e.y+(e.w-e.y)*h[E+T+1],E+=2;break}},_.ImportVertexData=function(s,u){var p=new _,l=s.positions;l&&p.set(l,d.b.PositionKind);var h=s.normals;h&&p.set(h,d.b.NormalKind);var t=s.tangents;t&&p.set(t,d.b.TangentKind);var e=s.uvs;e&&p.set(e,d.b.UVKind);var i=s.uv2s;i&&p.set(i,d.b.UV2Kind);var r=s.uv3s;r&&p.set(r,d.b.UV3Kind);var o=s.uv4s;o&&p.set(o,d.b.UV4Kind);var g=s.uv5s;g&&p.set(g,d.b.UV5Kind);var y=s.uv6s;y&&p.set(y,d.b.UV6Kind);var v=s.colors;v&&p.set(n.b.CheckColors4(v,l.length/3),d.b.ColorKind);var f=s.matricesIndices;f&&p.set(f,d.b.MatricesIndicesKind);var b=s.matricesWeights;b&&p.set(b,d.b.MatricesWeightsKind);var T=s.indices;T&&(p.indices=T),u.setAllVerticesData(p,s.updatable)},_.FRONTSIDE=0,_.BACKSIDE=1,_.DOUBLESIDE=2,_.DEFAULTSIDE=0,_}()},,function($,W,M){"use strict";var P=M(435),d="bonesDeclaration",m=`#if NUM_BONE_INFLUENCERS>0
#ifdef BONETEXTURE
uniform sampler2D boneSampler;
uniform float boneTextureWidth;
#else
uniform mat4 mBones[BonesPerMesh];
#ifdef BONES_VELOCITY_ENABLED
uniform mat4 mPreviousBones[BonesPerMesh];
#endif
#endif
attribute vec4 matricesIndices;
attribute vec4 matricesWeights;
#if NUM_BONE_INFLUENCERS>4
attribute vec4 matricesIndicesExtra;
attribute vec4 matricesWeightsExtra;
#endif
#ifdef BONETEXTURE
#define inline
mat4 readMatrixFromRawSampler(sampler2D smp,float index)
{
float offset=index*4.0;
float dx=1.0/boneTextureWidth;
vec4 m0=texture2D(smp,vec2(dx*(offset+0.5),0.));
vec4 m1=texture2D(smp,vec2(dx*(offset+1.5),0.));
vec4 m2=texture2D(smp,vec2(dx*(offset+2.5),0.));
vec4 m3=texture2D(smp,vec2(dx*(offset+3.5),0.));
return mat4(m0,m1,m2,m3);
}
#endif
#endif`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},function($,W,M){"use strict";var P=M(435),d="instancesVertex",m=`#ifdef INSTANCES
mat4 finalWorld=mat4(world0,world1,world2,world3);
#ifdef THIN_INSTANCES
finalWorld=world*finalWorld;
#endif
#else
mat4 finalWorld=world;
#endif`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},function($,W,M){"use strict";var P=M(435),d="bonesVertex",m=`#if NUM_BONE_INFLUENCERS>0
mat4 influence;
#ifdef BONETEXTURE
influence=readMatrixFromRawSampler(boneSampler,matricesIndices[0])*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
influence+=readMatrixFromRawSampler(boneSampler,matricesIndices[1])*matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
influence+=readMatrixFromRawSampler(boneSampler,matricesIndices[2])*matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
influence+=readMatrixFromRawSampler(boneSampler,matricesIndices[3])*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[0])*matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[1])*matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[2])*matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
influence+=readMatrixFromRawSampler(boneSampler,matricesIndicesExtra[3])*matricesWeightsExtra[3];
#endif
#else
influence=mBones[int(matricesIndices[0])]*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
influence+=mBones[int(matricesIndices[1])]*matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
influence+=mBones[int(matricesIndices[2])]*matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
influence+=mBones[int(matricesIndices[3])]*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
influence+=mBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
influence+=mBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
influence+=mBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
influence+=mBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];
#endif
#endif
finalWorld=finalWorld*influence;
#endif`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},function($,W,M){"use strict";M.d(W,"a",function(){return d}),M.d(W,"b",function(){return m});var P=M(434),d=function(){function n(c){this.length=0,this.data=new Array(c),this._id=n._GlobalId++}return n.prototype.push=function(c){this.data[this.length++]=c,this.length>this.data.length&&(this.data.length*=2)},n.prototype.forEach=function(c){for(var a=0;a<this.length;a++)c(this.data[a])},n.prototype.sort=function(c){this.data.sort(c)},n.prototype.reset=function(){this.length=0},n.prototype.dispose=function(){this.reset(),this.data&&(this.data.length=0,this.data=[])},n.prototype.concat=function(c){if(c.length!==0){this.length+c.length>this.data.length&&(this.data.length=(this.length+c.length)*2);for(var a=0;a<c.length;a++)this.data[this.length++]=(c.data||c)[a]}},n.prototype.indexOf=function(c){var a=this.data.indexOf(c);return a>=this.length?-1:a},n.prototype.contains=function(c){return this.indexOf(c)!==-1},n._GlobalId=0,n}(),m=function(n){Object(P.d)(c,n);function c(){var a=n!==null&&n.apply(this,arguments)||this;return a._duplicateId=0,a}return c.prototype.push=function(a){n.prototype.push.call(this,a),a.__smartArrayFlags||(a.__smartArrayFlags={}),a.__smartArrayFlags[this._id]=this._duplicateId},c.prototype.pushNoDuplicate=function(a){return a.__smartArrayFlags&&a.__smartArrayFlags[this._id]===this._duplicateId?!1:(this.push(a),!0)},c.prototype.reset=function(){n.prototype.reset.call(this),this._duplicateId++},c.prototype.concatWithNoDuplicate=function(a){if(a.length!==0){this.length+a.length>this.data.length&&(this.data.length=(this.length+a.length)*2);for(var _=0;_<a.length;_++){var s=(a.data||a)[_];this.pushNoDuplicate(s)}}},c}(d)},function($,W,M){"use strict";M.d(W,"b",function(){return s}),M.d(W,"a",function(){return u});var P=M(434),d=M(439),m=M(438),n=M(443),c=M(441),a=M(552),_=M(719),s=function(p){Object(P.d)(l,p);function l(){var h=p.call(this)||this;return h.IMAGEPROCESSING=!1,h.VIGNETTE=!1,h.VIGNETTEBLENDMODEMULTIPLY=!1,h.VIGNETTEBLENDMODEOPAQUE=!1,h.TONEMAPPING=!1,h.TONEMAPPING_ACES=!1,h.CONTRAST=!1,h.COLORCURVES=!1,h.COLORGRADING=!1,h.COLORGRADING3D=!1,h.SAMPLER3DGREENDEPTH=!1,h.SAMPLER3DBGRMAP=!1,h.IMAGEPROCESSINGPOSTPROCESS=!1,h.EXPOSURE=!1,h.rebuild(),h}return l}(a.a),u=function(){function p(){this.colorCurves=new _.a,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=p.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCentreX=0,this.vignetteCentreY=0,this.vignetteWeight=1.5,this.vignetteColor=new c.b(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=p.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new m.c}return Object.defineProperty(p.prototype,"colorCurvesEnabled",{get:function(){return this._colorCurvesEnabled},set:function(l){this._colorCurvesEnabled!==l&&(this._colorCurvesEnabled=l,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"colorGradingTexture",{get:function(){return this._colorGradingTexture},set:function(l){this._colorGradingTexture!==l&&(this._colorGradingTexture=l,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"colorGradingEnabled",{get:function(){return this._colorGradingEnabled},set:function(l){this._colorGradingEnabled!==l&&(this._colorGradingEnabled=l,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"colorGradingWithGreenDepth",{get:function(){return this._colorGradingWithGreenDepth},set:function(l){this._colorGradingWithGreenDepth!==l&&(this._colorGradingWithGreenDepth=l,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"colorGradingBGR",{get:function(){return this._colorGradingBGR},set:function(l){this._colorGradingBGR!==l&&(this._colorGradingBGR=l,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"exposure",{get:function(){return this._exposure},set:function(l){this._exposure!==l&&(this._exposure=l,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"toneMappingEnabled",{get:function(){return this._toneMappingEnabled},set:function(l){this._toneMappingEnabled!==l&&(this._toneMappingEnabled=l,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"toneMappingType",{get:function(){return this._toneMappingType},set:function(l){this._toneMappingType!==l&&(this._toneMappingType=l,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"contrast",{get:function(){return this._contrast},set:function(l){this._contrast!==l&&(this._contrast=l,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"vignetteBlendMode",{get:function(){return this._vignetteBlendMode},set:function(l){this._vignetteBlendMode!==l&&(this._vignetteBlendMode=l,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"vignetteEnabled",{get:function(){return this._vignetteEnabled},set:function(l){this._vignetteEnabled!==l&&(this._vignetteEnabled=l,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"applyByPostProcess",{get:function(){return this._applyByPostProcess},set:function(l){this._applyByPostProcess!==l&&(this._applyByPostProcess=l,this._updateParameters())},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isEnabled",{get:function(){return this._isEnabled},set:function(l){this._isEnabled!==l&&(this._isEnabled=l,this._updateParameters())},enumerable:!1,configurable:!0}),p.prototype._updateParameters=function(){this.onUpdateParameters.notifyObservers(this)},p.prototype.getClassName=function(){return"ImageProcessingConfiguration"},p.PrepareUniforms=function(l,h){h.EXPOSURE&&l.push("exposureLinear"),h.CONTRAST&&l.push("contrast"),h.COLORGRADING&&l.push("colorTransformSettings"),h.VIGNETTE&&(l.push("vInverseScreenSize"),l.push("vignetteSettings1"),l.push("vignetteSettings2")),h.COLORCURVES&&_.a.PrepareUniforms(l)},p.PrepareSamplers=function(l,h){h.COLORGRADING&&l.push("txColorTransform")},p.prototype.prepareDefines=function(l,h){if(h===void 0&&(h=!1),h!==this.applyByPostProcess||!this._isEnabled){l.VIGNETTE=!1,l.TONEMAPPING=!1,l.TONEMAPPING_ACES=!1,l.CONTRAST=!1,l.EXPOSURE=!1,l.COLORCURVES=!1,l.COLORGRADING=!1,l.COLORGRADING3D=!1,l.IMAGEPROCESSING=!1,l.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled;return}switch(l.VIGNETTE=this.vignetteEnabled,l.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===p._VIGNETTEMODE_MULTIPLY,l.VIGNETTEBLENDMODEOPAQUE=!l.VIGNETTEBLENDMODEMULTIPLY,l.TONEMAPPING=this.toneMappingEnabled,this._toneMappingType){case p.TONEMAPPING_ACES:l.TONEMAPPING_ACES=!0;break;default:l.TONEMAPPING_ACES=!1;break}l.CONTRAST=this.contrast!==1,l.EXPOSURE=this.exposure!==1,l.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,l.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,l.COLORGRADING?l.COLORGRADING3D=this.colorGradingTexture.is3D:l.COLORGRADING3D=!1,l.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,l.SAMPLER3DBGRMAP=this.colorGradingBGR,l.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,l.IMAGEPROCESSING=l.VIGNETTE||l.TONEMAPPING||l.CONTRAST||l.EXPOSURE||l.COLORCURVES||l.COLORGRADING},p.prototype.isReady=function(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()},p.prototype.bind=function(l,h){if(this._colorCurvesEnabled&&this.colorCurves&&_.a.Bind(this.colorCurves,l),this._vignetteEnabled){var t=1/l.getEngine().getRenderWidth(),e=1/l.getEngine().getRenderHeight();l.setFloat2("vInverseScreenSize",t,e);var i=h!=null?h:e/t,r=Math.tan(this.vignetteCameraFov*.5),o=r*i,g=Math.sqrt(o*r);o=n.b.Mix(o,g,this.vignetteStretch),r=n.b.Mix(r,g,this.vignetteStretch),l.setFloat4("vignetteSettings1",o,r,-o*this.vignetteCentreX,-r*this.vignetteCentreY);var y=-2*this.vignetteWeight;l.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,y)}if(l.setFloat("exposureLinear",this.exposure),l.setFloat("contrast",this.contrast),this.colorGradingTexture){l.setTexture("txColorTransform",this.colorGradingTexture);var v=this.colorGradingTexture.getSize().height;l.setFloat4("colorTransformSettings",(v-1)/v,.5/v,v,this.colorGradingTexture.level)}},p.prototype.clone=function(){return d.a.Clone(function(){return new p},this)},p.prototype.serialize=function(){return d.a.Serialize(this)},p.Parse=function(l){return d.a.Parse(function(){return new p},l,null,null)},Object.defineProperty(p,"VIGNETTEMODE_MULTIPLY",{get:function(){return this._VIGNETTEMODE_MULTIPLY},enumerable:!1,configurable:!0}),Object.defineProperty(p,"VIGNETTEMODE_OPAQUE",{get:function(){return this._VIGNETTEMODE_OPAQUE},enumerable:!1,configurable:!0}),p.TONEMAPPING_STANDARD=0,p.TONEMAPPING_ACES=1,p._VIGNETTEMODE_MULTIPLY=0,p._VIGNETTEMODE_OPAQUE=1,Object(P.c)([Object(d.g)()],p.prototype,"colorCurves",void 0),Object(P.c)([Object(d.c)()],p.prototype,"_colorCurvesEnabled",void 0),Object(P.c)([Object(d.m)("colorGradingTexture")],p.prototype,"_colorGradingTexture",void 0),Object(P.c)([Object(d.c)()],p.prototype,"_colorGradingEnabled",void 0),Object(P.c)([Object(d.c)()],p.prototype,"_colorGradingWithGreenDepth",void 0),Object(P.c)([Object(d.c)()],p.prototype,"_colorGradingBGR",void 0),Object(P.c)([Object(d.c)()],p.prototype,"_exposure",void 0),Object(P.c)([Object(d.c)()],p.prototype,"_toneMappingEnabled",void 0),Object(P.c)([Object(d.c)()],p.prototype,"_toneMappingType",void 0),Object(P.c)([Object(d.c)()],p.prototype,"_contrast",void 0),Object(P.c)([Object(d.c)()],p.prototype,"vignetteStretch",void 0),Object(P.c)([Object(d.c)()],p.prototype,"vignetteCentreX",void 0),Object(P.c)([Object(d.c)()],p.prototype,"vignetteCentreY",void 0),Object(P.c)([Object(d.c)()],p.prototype,"vignetteWeight",void 0),Object(P.c)([Object(d.f)()],p.prototype,"vignetteColor",void 0),Object(P.c)([Object(d.c)()],p.prototype,"vignetteCameraFov",void 0),Object(P.c)([Object(d.c)()],p.prototype,"_vignetteBlendMode",void 0),Object(P.c)([Object(d.c)()],p.prototype,"_vignetteEnabled",void 0),Object(P.c)([Object(d.c)()],p.prototype,"_applyByPostProcess",void 0),Object(P.c)([Object(d.c)()],p.prototype,"_isEnabled",void 0),p}();d.a._ImageProcessingConfigurationParser=u.Parse},,,,,function($,W,M){"use strict";var P=M(435),d="morphTargetsVertexGlobalDeclaration",m=`#ifdef MORPHTARGETS
uniform float morphTargetInfluences[NUM_MORPH_INFLUENCERS];
#ifdef MORPHTARGETS_TEXTURE
precision mediump sampler2DArray;
uniform float morphTargetTextureIndices[NUM_MORPH_INFLUENCERS];
uniform vec3 morphTargetTextureInfo;
uniform sampler2DArray morphTargets;
vec3 readVector3FromRawSampler(int targetIndex,float vertexIndex)
{
float y=floor(vertexIndex/morphTargetTextureInfo.y);
float x=vertexIndex-y*morphTargetTextureInfo.y;
vec3 textureUV=vec3((x+0.5)/morphTargetTextureInfo.y,(y+0.5)/morphTargetTextureInfo.z,morphTargetTextureIndices[targetIndex]);
return texture(morphTargets,textureUV).xyz;
}
#endif
#endif`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},function($,W,M){"use strict";var P=M(435),d="morphTargetsVertexDeclaration",m=`#ifdef MORPHTARGETS
#ifndef MORPHTARGETS_TEXTURE
attribute vec3 position{X};
#ifdef MORPHTARGETS_NORMAL
attribute vec3 normal{X};
#endif
#ifdef MORPHTARGETS_TANGENT
attribute vec3 tangent{X};
#endif
#ifdef MORPHTARGETS_UV
attribute vec2 uv_{X};
#endif
#endif
#endif`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},,function($,W,M){"use strict";M.d(W,"a",function(){return _});var P=M(434),d=M(439),m=M(438),n=M(436),c=M(453),a=M(465),_=function(s){Object(P.d)(u,s);function u(p,l,h){l===void 0&&(l=null),h===void 0&&(h=!0);var t=s.call(this,p,l)||this;return t._forward=new n.e(0,0,1),t._forwardInverted=new n.e(0,0,-1),t._up=new n.e(0,1,0),t._right=new n.e(1,0,0),t._rightInverted=new n.e(-1,0,0),t._position=n.e.Zero(),t._rotation=n.e.Zero(),t._rotationQuaternion=null,t._scaling=n.e.One(),t._isDirty=!1,t._transformToBoneReferal=null,t._isAbsoluteSynced=!1,t._billboardMode=u.BILLBOARDMODE_NONE,t._preserveParentRotationForBillboard=!1,t.scalingDeterminant=1,t._infiniteDistance=!1,t.ignoreNonUniformScaling=!1,t.reIntegrateRotationIntoRotationQuaternion=!1,t._poseMatrix=null,t._localMatrix=n.a.Zero(),t._usePivotMatrix=!1,t._absolutePosition=n.e.Zero(),t._absoluteScaling=n.e.Zero(),t._absoluteRotationQuaternion=n.b.Identity(),t._pivotMatrix=n.a.Identity(),t._postMultiplyPivotMatrix=!1,t._isWorldMatrixFrozen=!1,t._indexInSceneTransformNodesArray=-1,t.onAfterWorldMatrixUpdateObservable=new m.c,t._nonUniformScaling=!1,h&&t.getScene().addTransformNode(t),t}return Object.defineProperty(u.prototype,"billboardMode",{get:function(){return this._billboardMode},set:function(p){this._billboardMode!==p&&(this._billboardMode=p)},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"preserveParentRotationForBillboard",{get:function(){return this._preserveParentRotationForBillboard},set:function(p){p!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=p)},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"infiniteDistance",{get:function(){return this._infiniteDistance},set:function(p){this._infiniteDistance!==p&&(this._infiniteDistance=p)},enumerable:!1,configurable:!0}),u.prototype.getClassName=function(){return"TransformNode"},Object.defineProperty(u.prototype,"position",{get:function(){return this._position},set:function(p){this._position=p,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"rotation",{get:function(){return this._rotation},set:function(p){this._rotation=p,this._rotationQuaternion=null,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"scaling",{get:function(){return this._scaling},set:function(p){this._scaling=p,this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"rotationQuaternion",{get:function(){return this._rotationQuaternion},set:function(p){this._rotationQuaternion=p,p&&this._rotation.setAll(0),this._isDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"forward",{get:function(){return n.e.Normalize(n.e.TransformNormal(this.getScene().useRightHandedSystem?this._forwardInverted:this._forward,this.getWorldMatrix()))},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"up",{get:function(){return n.e.Normalize(n.e.TransformNormal(this._up,this.getWorldMatrix()))},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"right",{get:function(){return n.e.Normalize(n.e.TransformNormal(this.getScene().useRightHandedSystem?this._rightInverted:this._right,this.getWorldMatrix()))},enumerable:!1,configurable:!0}),u.prototype.updatePoseMatrix=function(p){return this._poseMatrix?(this._poseMatrix.copyFrom(p),this):(this._poseMatrix=p.clone(),this)},u.prototype.getPoseMatrix=function(){return this._poseMatrix||(this._poseMatrix=n.a.Identity()),this._poseMatrix},u.prototype._isSynchronized=function(){var p=this._cache;return!(this.billboardMode!==p.billboardMode||this.billboardMode!==u.BILLBOARDMODE_NONE||p.pivotMatrixUpdated||this.infiniteDistance||this.position._isDirty||this.scaling._isDirty||this._rotationQuaternion&&this._rotationQuaternion._isDirty||this.rotation._isDirty)},u.prototype._initCache=function(){s.prototype._initCache.call(this);var p=this._cache;p.localMatrixUpdated=!1,p.billboardMode=-1,p.infiniteDistance=!1},u.prototype.markAsDirty=function(p){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this},Object.defineProperty(u.prototype,"absolutePosition",{get:function(){return this._absolutePosition},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"absoluteScaling",{get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"absoluteRotationQuaternion",{get:function(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion},enumerable:!1,configurable:!0}),u.prototype.setPreTransformMatrix=function(p){return this.setPivotMatrix(p,!1)},u.prototype.setPivotMatrix=function(p,l){return l===void 0&&(l=!0),this._pivotMatrix.copyFrom(p),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=l,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=n.a.Invert(this._pivotMatrix)),this},u.prototype.getPivotMatrix=function(){return this._pivotMatrix},u.prototype.instantiateHierarchy=function(p,l,h){p===void 0&&(p=null);var t=this.clone("Clone of "+(this.name||this.id),p||this.parent,!0);t&&h&&h(this,t);for(var e=0,i=this.getChildTransformNodes(!0);e<i.length;e++){var r=i[e];r.instantiateHierarchy(t,l,h)}return t},u.prototype.freezeWorldMatrix=function(p){return p===void 0&&(p=null),p?this._worldMatrix=p:(this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this},u.prototype.unfreezeWorldMatrix=function(){return this._isWorldMatrixFrozen=!1,this.computeWorldMatrix(!0),this},Object.defineProperty(u.prototype,"isWorldMatrixFrozen",{get:function(){return this._isWorldMatrixFrozen},enumerable:!1,configurable:!0}),u.prototype.getAbsolutePosition=function(){return this.computeWorldMatrix(),this._absolutePosition},u.prototype.setAbsolutePosition=function(p){if(!p)return this;var l,h,t;if(p.x===void 0){if(arguments.length<3)return this;l=arguments[0],h=arguments[1],t=arguments[2]}else l=p.x,h=p.y,t=p.z;if(this.parent){var e=n.c.Matrix[0];this.parent.getWorldMatrix().invertToRef(e),n.e.TransformCoordinatesFromFloatsToRef(l,h,t,e,this.position)}else this.position.x=l,this.position.y=h,this.position.z=t;return this._absolutePosition.copyFrom(p),this},u.prototype.setPositionWithLocalVector=function(p){return this.computeWorldMatrix(),this.position=n.e.TransformNormal(p,this._localMatrix),this},u.prototype.getPositionExpressedInLocalSpace=function(){this.computeWorldMatrix();var p=n.c.Matrix[0];return this._localMatrix.invertToRef(p),n.e.TransformNormal(this.position,p)},u.prototype.locallyTranslate=function(p){return this.computeWorldMatrix(!0),this.position=n.e.TransformCoordinates(p,this._localMatrix),this},u.prototype.lookAt=function(p,l,h,t,e){l===void 0&&(l=0),h===void 0&&(h=0),t===void 0&&(t=0),e===void 0&&(e=a.c.LOCAL);var i=u._lookAtVectorCache,r=e===a.c.LOCAL?this.position:this.getAbsolutePosition();if(p.subtractToRef(r,i),this.setDirection(i,l,h,t),e===a.c.WORLD&&this.parent)if(this.rotationQuaternion){var o=n.c.Matrix[0];this.rotationQuaternion.toRotationMatrix(o);var g=n.c.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(g),g.invert(),o.multiplyToRef(g,o),this.rotationQuaternion.fromRotationMatrix(o)}else{var y=n.c.Quaternion[0];n.b.FromEulerVectorToRef(this.rotation,y);var o=n.c.Matrix[0];y.toRotationMatrix(o);var g=n.c.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(g),g.invert(),o.multiplyToRef(g,o),y.fromRotationMatrix(o),y.toEulerAnglesToRef(this.rotation)}return this},u.prototype.getDirection=function(p){var l=n.e.Zero();return this.getDirectionToRef(p,l),l},u.prototype.getDirectionToRef=function(p,l){return n.e.TransformNormalToRef(p,this.getWorldMatrix(),l),this},u.prototype.setDirection=function(p,l,h,t){l===void 0&&(l=0),h===void 0&&(h=0),t===void 0&&(t=0);var e=-Math.atan2(p.z,p.x)+Math.PI/2,i=Math.sqrt(p.x*p.x+p.z*p.z),r=-Math.atan2(p.y,i);return this.rotationQuaternion?n.b.RotationYawPitchRollToRef(e+l,r+h,t,this.rotationQuaternion):(this.rotation.x=r+h,this.rotation.y=e+l,this.rotation.z=t),this},u.prototype.setPivotPoint=function(p,l){l===void 0&&(l=a.c.LOCAL),this.getScene().getRenderId()==0&&this.computeWorldMatrix(!0);var h=this.getWorldMatrix();if(l==a.c.WORLD){var t=n.c.Matrix[0];h.invertToRef(t),p=n.e.TransformCoordinates(p,t)}return this.setPivotMatrix(n.a.Translation(-p.x,-p.y,-p.z),!0)},u.prototype.getPivotPoint=function(){var p=n.e.Zero();return this.getPivotPointToRef(p),p},u.prototype.getPivotPointToRef=function(p){return p.x=-this._pivotMatrix.m[12],p.y=-this._pivotMatrix.m[13],p.z=-this._pivotMatrix.m[14],this},u.prototype.getAbsolutePivotPoint=function(){var p=n.e.Zero();return this.getAbsolutePivotPointToRef(p),p},u.prototype.getAbsolutePivotPointToRef=function(p){return this.getPivotPointToRef(p),n.e.TransformCoordinatesToRef(p,this.getWorldMatrix(),p),this},u.prototype.setParent=function(p){if(!p&&!this.parent)return this;var l=n.c.Quaternion[0],h=n.c.Vector3[0],t=n.c.Vector3[1];if(!p)this.computeWorldMatrix(!0),this.getWorldMatrix().decompose(t,l,h);else{var e=n.c.Matrix[0],i=n.c.Matrix[1];this.computeWorldMatrix(!0),p.computeWorldMatrix(!0),p.getWorldMatrix().invertToRef(i),this.getWorldMatrix().multiplyToRef(i,e),e.decompose(t,l,h)}return this.rotationQuaternion?this.rotationQuaternion.copyFrom(l):l.toEulerAnglesToRef(this.rotation),this.scaling.copyFrom(t),this.position.copyFrom(h),this.parent=p,this},Object.defineProperty(u.prototype,"nonUniformScaling",{get:function(){return this._nonUniformScaling},enumerable:!1,configurable:!0}),u.prototype._updateNonUniformScalingState=function(p){return this._nonUniformScaling===p?!1:(this._nonUniformScaling=p,!0)},u.prototype.attachToBone=function(p,l){return this._transformToBoneReferal=l,this.parent=p,p.getSkeleton().prepare(),p.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this},u.prototype.detachFromBone=function(){return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=null,this):this},u.prototype.rotate=function(p,l,h){p.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.setAll(0));var t;if(!h||h===a.c.LOCAL)t=n.b.RotationAxisToRef(p,l,u._rotationAxisCache),this.rotationQuaternion.multiplyToRef(t,this.rotationQuaternion);else{if(this.parent){var e=n.c.Matrix[0];this.parent.getWorldMatrix().invertToRef(e),p=n.e.TransformNormal(p,e)}t=n.b.RotationAxisToRef(p,l,u._rotationAxisCache),t.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}return this},u.prototype.rotateAround=function(p,l,h){l.normalize(),this.rotationQuaternion||(this.rotationQuaternion=n.b.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.setAll(0));var t=n.c.Vector3[0],e=n.c.Vector3[1],i=n.c.Vector3[2],r=n.c.Quaternion[0],o=n.c.Matrix[0],g=n.c.Matrix[1],y=n.c.Matrix[2],v=n.c.Matrix[3];return p.subtractToRef(this.position,t),n.a.TranslationToRef(t.x,t.y,t.z,o),n.a.TranslationToRef(-t.x,-t.y,-t.z,g),n.a.RotationAxisToRef(l,h,y),g.multiplyToRef(y,v),v.multiplyToRef(o,v),v.decompose(e,r,i),this.position.addInPlace(i),r.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this},u.prototype.translate=function(p,l,h){var t=p.scale(l);if(!h||h===a.c.LOCAL){var e=this.getPositionExpressedInLocalSpace().add(t);this.setPositionWithLocalVector(e)}else this.setAbsolutePosition(this.getAbsolutePosition().add(t));return this},u.prototype.addRotation=function(p,l,h){var t;this.rotationQuaternion?t=this.rotationQuaternion:(t=n.c.Quaternion[1],n.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,t));var e=n.c.Quaternion[0];return n.b.RotationYawPitchRollToRef(l,p,h,e),t.multiplyInPlace(e),this.rotationQuaternion||t.toEulerAnglesToRef(this.rotation),this},u.prototype._getEffectiveParent=function(){return this.parent},u.prototype.computeWorldMatrix=function(p){if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;var l=this.getScene().getRenderId();if(!this._isDirty&&!p&&this.isSynchronized())return this._currentRenderId=l,this._worldMatrix;var h=this.getScene().activeCamera,t=(this._billboardMode&u.BILLBOARDMODE_USE_POSITION)!=0,e=this._billboardMode!==u.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard;e&&h&&t&&(this.lookAt(h.position),(this.billboardMode&u.BILLBOARDMODE_X)!==u.BILLBOARDMODE_X&&(this.rotation.x=0),(this.billboardMode&u.BILLBOARDMODE_Y)!==u.BILLBOARDMODE_Y&&(this.rotation.y=0),(this.billboardMode&u.BILLBOARDMODE_Z)!==u.BILLBOARDMODE_Z&&(this.rotation.z=0)),this._updateCache();var i=this._cache;i.pivotMatrixUpdated=!1,i.billboardMode=this.billboardMode,i.infiniteDistance=this.infiniteDistance,this._currentRenderId=l,this._childUpdateId++,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;var r=this._getEffectiveParent(),o=u._TmpScaling,g=this._position;if(this._infiniteDistance&&!this.parent&&h){var y=h.getWorldMatrix(),v=new n.e(y.m[12],y.m[13],y.m[14]);g=u._TmpTranslation,g.copyFromFloats(this._position.x+v.x,this._position.y+v.y,this._position.z+v.z)}o.copyFromFloats(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant);var f;if(this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,f=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){var b=this.rotation.lengthSquared();b&&(this._rotationQuaternion.multiplyInPlace(n.b.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.copyFromFloats(0,0,0))}}else f=u._TmpRotation,n.b.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,f);if(this._usePivotMatrix){var T=n.c.Matrix[1];n.a.ScalingToRef(o.x,o.y,o.z,T);var E=n.c.Matrix[0];f.toRotationMatrix(E),this._pivotMatrix.multiplyToRef(T,n.c.Matrix[4]),n.c.Matrix[4].multiplyToRef(E,this._localMatrix),this._postMultiplyPivotMatrix&&this._localMatrix.multiplyToRef(this._pivotMatrixInverse,this._localMatrix),this._localMatrix.addTranslationFromFloats(g.x,g.y,g.z)}else n.a.ComposeToRef(o,f,g,this._localMatrix);if(r&&r.getWorldMatrix){if(p&&r.computeWorldMatrix(p),e){this._transformToBoneReferal?r.getWorldMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),n.c.Matrix[7]):n.c.Matrix[7].copyFrom(r.getWorldMatrix());var O=n.c.Vector3[5],D=n.c.Vector3[6];n.c.Matrix[7].decompose(D,void 0,O),n.a.ScalingToRef(D.x,D.y,D.z,n.c.Matrix[7]),n.c.Matrix[7].setTranslation(O),this._localMatrix.multiplyToRef(n.c.Matrix[7],this._worldMatrix)}else this._transformToBoneReferal?(this._localMatrix.multiplyToRef(r.getWorldMatrix(),n.c.Matrix[6]),n.c.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)):this._localMatrix.multiplyToRef(r.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.copyFrom(this._localMatrix);if(e&&h&&this.billboardMode&&!t){var F=n.c.Vector3[0];if(this._worldMatrix.getTranslationToRef(F),n.c.Matrix[1].copyFrom(h.getViewMatrix()),n.c.Matrix[1].setTranslationFromFloats(0,0,0),n.c.Matrix[1].invertToRef(n.c.Matrix[0]),(this.billboardMode&u.BILLBOARDMODE_ALL)!==u.BILLBOARDMODE_ALL){n.c.Matrix[0].decompose(void 0,n.c.Quaternion[0],void 0);var x=n.c.Vector3[1];n.c.Quaternion[0].toEulerAnglesToRef(x),(this.billboardMode&u.BILLBOARDMODE_X)!==u.BILLBOARDMODE_X&&(x.x=0),(this.billboardMode&u.BILLBOARDMODE_Y)!==u.BILLBOARDMODE_Y&&(x.y=0),(this.billboardMode&u.BILLBOARDMODE_Z)!==u.BILLBOARDMODE_Z&&(x.z=0),n.a.RotationYawPitchRollToRef(x.y,x.x,x.z,n.c.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(n.c.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(n.c.Vector3[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):r&&r._nonUniformScaling?this._updateNonUniformScalingState(r._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.copyFromFloats(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=n.a.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix},u.prototype.resetLocalMatrix=function(p){if(p===void 0&&(p=!0),this.computeWorldMatrix(),p)for(var l=this.getChildren(),h=0;h<l.length;++h){var t=l[h];if(t){t.computeWorldMatrix();var e=n.c.Matrix[0];t._localMatrix.multiplyToRef(this._localMatrix,e);var i=n.c.Quaternion[0];e.decompose(t.scaling,i,t.position),t.rotationQuaternion?t.rotationQuaternion=i:i.toEulerAnglesToRef(t.rotation)}}this.scaling.copyFromFloats(1,1,1),this.position.copyFromFloats(0,0,0),this.rotation.copyFromFloats(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=n.b.Identity()),this._worldMatrix=n.a.Identity()},u.prototype._afterComputeWorldMatrix=function(){},u.prototype.registerAfterWorldMatrixUpdate=function(p){return this.onAfterWorldMatrixUpdateObservable.add(p),this},u.prototype.unregisterAfterWorldMatrixUpdate=function(p){return this.onAfterWorldMatrixUpdateObservable.removeCallback(p),this},u.prototype.getPositionInCameraSpace=function(p){return p===void 0&&(p=null),p||(p=this.getScene().activeCamera),n.e.TransformCoordinates(this.getAbsolutePosition(),p.getViewMatrix())},u.prototype.getDistanceToCamera=function(p){return p===void 0&&(p=null),p||(p=this.getScene().activeCamera),this.getAbsolutePosition().subtract(p.globalPosition).length()},u.prototype.clone=function(p,l,h){var t=this,e=d.a.Clone(function(){return new u(p,t.getScene())},this);if(e.name=p,e.id=p,l&&(e.parent=l),!h)for(var i=this.getDescendants(!0),r=0;r<i.length;r++){var o=i[r];o.clone&&o.clone(p+"."+o.name,e)}return e},u.prototype.serialize=function(p){var l=d.a.Serialize(this,p);return l.type=this.getClassName(),this.parent&&(l.parentId=this.parent.id),l.localMatrix=this.getPivotMatrix().asArray(),l.isEnabled=this.isEnabled(),this.parent&&(l.parentId=this.parent.id),l},u.Parse=function(p,l,h){var t=d.a.Parse(function(){return new u(p.name,l)},p,l,h);return p.localMatrix?t.setPreTransformMatrix(n.a.FromArray(p.localMatrix)):p.pivotMatrix&&t.setPivotMatrix(n.a.FromArray(p.pivotMatrix)),t.setEnabled(p.isEnabled),p.parentId&&(t._waitingParentId=p.parentId),t},u.prototype.getChildTransformNodes=function(p,l){var h=[];return this._getDescendants(h,p,function(t){return(!l||l(t))&&t instanceof u}),h},u.prototype.dispose=function(p,l){if(l===void 0&&(l=!1),this.getScene().stopAnimation(this),this.getScene().removeTransformNode(this),this.onAfterWorldMatrixUpdateObservable.clear(),p)for(var h=this.getChildTransformNodes(!0),t=0,e=h;t<e.length;t++){var i=e[t];i.parent=null,i.computeWorldMatrix(!0)}s.prototype.dispose.call(this,p,l)},u.prototype.normalizeToUnitCube=function(p,l,h){p===void 0&&(p=!0),l===void 0&&(l=!1);var t=null,e=null;l&&(this.rotationQuaternion?(e=this.rotationQuaternion.clone(),this.rotationQuaternion.copyFromFloats(0,0,0,1)):this.rotation&&(t=this.rotation.clone(),this.rotation.copyFromFloats(0,0,0)));var i=this.getHierarchyBoundingVectors(p,h),r=i.max.subtract(i.min),o=Math.max(r.x,r.y,r.z);if(o===0)return this;var g=1/o;return this.scaling.scaleInPlace(g),l&&(this.rotationQuaternion&&e?this.rotationQuaternion.copyFrom(e):this.rotation&&t&&this.rotation.copyFrom(t)),this},u.prototype._syncAbsoluteScalingAndRotation=function(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)},u.BILLBOARDMODE_NONE=0,u.BILLBOARDMODE_X=1,u.BILLBOARDMODE_Y=2,u.BILLBOARDMODE_Z=4,u.BILLBOARDMODE_ALL=7,u.BILLBOARDMODE_USE_POSITION=128,u._TmpRotation=n.b.Zero(),u._TmpScaling=n.e.Zero(),u._TmpTranslation=n.e.Zero(),u._lookAtVectorCache=new n.e(0,0,0),u._rotationAxisCache=new n.b,Object(P.c)([Object(d.o)("position")],u.prototype,"_position",void 0),Object(P.c)([Object(d.o)("rotation")],u.prototype,"_rotation",void 0),Object(P.c)([Object(d.l)("rotationQuaternion")],u.prototype,"_rotationQuaternion",void 0),Object(P.c)([Object(d.o)("scaling")],u.prototype,"_scaling",void 0),Object(P.c)([Object(d.c)("billboardMode")],u.prototype,"_billboardMode",void 0),Object(P.c)([Object(d.c)()],u.prototype,"scalingDeterminant",void 0),Object(P.c)([Object(d.c)("infiniteDistance")],u.prototype,"_infiniteDistance",void 0),Object(P.c)([Object(d.c)()],u.prototype,"ignoreNonUniformScaling",void 0),Object(P.c)([Object(d.c)()],u.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0),u}(c.a)},,,,,,,function($,W,M){"use strict";M.d(W,"a",function(){return i});var P=M(434),d=M(439),m=M(438),n=M(436),c=M(453),a=M(446),_=M(722),s=M(723),u=M(724),p=M(451),l=M(528),h=M(623),t=M(515),e=M(443);c.a.AddNodeConstructor("ArcRotateCamera",function(r,o){return function(){return new i(r,0,0,1,n.e.Zero(),o)}});var i=function(r){Object(P.d)(o,r);function o(g,y,v,f,b,T,E){E===void 0&&(E=!0);var O=r.call(this,g,n.e.Zero(),T,E)||this;return O.inertialAlphaOffset=0,O.inertialBetaOffset=0,O.inertialRadiusOffset=0,O.lowerAlphaLimit=null,O.upperAlphaLimit=null,O.lowerBetaLimit=.01,O.upperBetaLimit=Math.PI-.01,O.lowerRadiusLimit=null,O.upperRadiusLimit=null,O.inertialPanningX=0,O.inertialPanningY=0,O.pinchToPanMaxDistance=20,O.panningDistanceLimit=null,O.panningOriginTarget=n.e.Zero(),O.panningInertia=.9,O.zoomOnFactor=1,O.targetScreenOffset=n.d.Zero(),O.allowUpsideDown=!0,O.useInputToRestoreState=!0,O._viewMatrix=new n.a,O.panningAxis=new n.e(1,1,0),O._transformedDirection=new n.e,O.onMeshTargetChangedObservable=new m.c,O.checkCollisions=!1,O.collisionRadius=new n.e(.5,.5,.5),O._previousPosition=n.e.Zero(),O._collisionVelocity=n.e.Zero(),O._newPosition=n.e.Zero(),O._computationVector=n.e.Zero(),O._onCollisionPositionChange=function(D,F,x){x===void 0&&(x=null),x?(O.setPosition(F),O.onCollide&&O.onCollide(x)):O._previousPosition.copyFrom(O._position);var j=Math.cos(O.alpha),V=Math.sin(O.alpha),z=Math.cos(O.beta),w=Math.sin(O.beta);w===0&&(w=1e-4);var R=O._getTargetPosition();O._computationVector.copyFromFloats(O.radius*j*w,O.radius*z,O.radius*V*w),R.addToRef(O._computationVector,O._newPosition),O._position.copyFrom(O._newPosition);var L=O.upVector;O.allowUpsideDown&&O.beta<0&&(L=L.clone(),L=L.negate()),O._computeViewMatrix(O._position,R,L),O._viewMatrix.addAtIndex(12,O.targetScreenOffset.x),O._viewMatrix.addAtIndex(13,O.targetScreenOffset.y),O._collisionTriggered=!1},O._target=n.e.Zero(),b&&O.setTarget(b),O.alpha=y,O.beta=v,O.radius=f,O.getViewMatrix(),O.inputs=new h.a(O),O.inputs.addKeyboard().addMouseWheel().addPointers(),O}return Object.defineProperty(o.prototype,"target",{get:function(){return this._target},set:function(g){this.setTarget(g)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"position",{get:function(){return this._position},set:function(g){this.setPosition(g)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"upVector",{get:function(){return this._upVector},set:function(g){this._upToYMatrix||(this._YToUpMatrix=new n.a,this._upToYMatrix=new n.a,this._upVector=n.e.Zero()),g.normalize(),this._upVector.copyFrom(g),this.setMatUp()},enumerable:!1,configurable:!0}),o.prototype.setMatUp=function(){n.a.RotationAlignToRef(n.e.UpReadOnly,this._upVector,this._YToUpMatrix),n.a.RotationAlignToRef(this._upVector,n.e.UpReadOnly,this._upToYMatrix)},Object.defineProperty(o.prototype,"angularSensibilityX",{get:function(){var g=this.inputs.attached.pointers;return g?g.angularSensibilityX:0},set:function(g){var y=this.inputs.attached.pointers;y&&(y.angularSensibilityX=g)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"angularSensibilityY",{get:function(){var g=this.inputs.attached.pointers;return g?g.angularSensibilityY:0},set:function(g){var y=this.inputs.attached.pointers;y&&(y.angularSensibilityY=g)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"pinchPrecision",{get:function(){var g=this.inputs.attached.pointers;return g?g.pinchPrecision:0},set:function(g){var y=this.inputs.attached.pointers;y&&(y.pinchPrecision=g)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"pinchDeltaPercentage",{get:function(){var g=this.inputs.attached.pointers;return g?g.pinchDeltaPercentage:0},set:function(g){var y=this.inputs.attached.pointers;y&&(y.pinchDeltaPercentage=g)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"useNaturalPinchZoom",{get:function(){var g=this.inputs.attached.pointers;return g?g.useNaturalPinchZoom:!1},set:function(g){var y=this.inputs.attached.pointers;y&&(y.useNaturalPinchZoom=g)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"panningSensibility",{get:function(){var g=this.inputs.attached.pointers;return g?g.panningSensibility:0},set:function(g){var y=this.inputs.attached.pointers;y&&(y.panningSensibility=g)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"keysUp",{get:function(){var g=this.inputs.attached.keyboard;return g?g.keysUp:[]},set:function(g){var y=this.inputs.attached.keyboard;y&&(y.keysUp=g)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"keysDown",{get:function(){var g=this.inputs.attached.keyboard;return g?g.keysDown:[]},set:function(g){var y=this.inputs.attached.keyboard;y&&(y.keysDown=g)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"keysLeft",{get:function(){var g=this.inputs.attached.keyboard;return g?g.keysLeft:[]},set:function(g){var y=this.inputs.attached.keyboard;y&&(y.keysLeft=g)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"keysRight",{get:function(){var g=this.inputs.attached.keyboard;return g?g.keysRight:[]},set:function(g){var y=this.inputs.attached.keyboard;y&&(y.keysRight=g)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"wheelPrecision",{get:function(){var g=this.inputs.attached.mousewheel;return g?g.wheelPrecision:0},set:function(g){var y=this.inputs.attached.mousewheel;y&&(y.wheelPrecision=g)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"wheelDeltaPercentage",{get:function(){var g=this.inputs.attached.mousewheel;return g?g.wheelDeltaPercentage:0},set:function(g){var y=this.inputs.attached.mousewheel;y&&(y.wheelDeltaPercentage=g)},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"bouncingBehavior",{get:function(){return this._bouncingBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"useBouncingBehavior",{get:function(){return this._bouncingBehavior!=null},set:function(g){g!==this.useBouncingBehavior&&(g?(this._bouncingBehavior=new s.a,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"framingBehavior",{get:function(){return this._framingBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"useFramingBehavior",{get:function(){return this._framingBehavior!=null},set:function(g){g!==this.useFramingBehavior&&(g?(this._framingBehavior=new u.a,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"autoRotationBehavior",{get:function(){return this._autoRotationBehavior},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"useAutoRotationBehavior",{get:function(){return this._autoRotationBehavior!=null},set:function(g){g!==this.useAutoRotationBehavior&&(g?(this._autoRotationBehavior=new _.a,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))},enumerable:!1,configurable:!0}),o.prototype._initCache=function(){r.prototype._initCache.call(this),this._cache._target=new n.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=n.d.Zero()},o.prototype._updateCache=function(g){g||r.prototype._updateCache.call(this),this._cache._target.copyFrom(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.copyFrom(this.targetScreenOffset)},o.prototype._getTargetPosition=function(){if(this._targetHost&&this._targetHost.getAbsolutePosition){var g=this._targetHost.absolutePosition;this._targetBoundingCenter?g.addToRef(this._targetBoundingCenter,this._target):this._target.copyFrom(g)}var y=this._getLockedTargetPosition();return y||this._target},o.prototype.storeState=function(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),r.prototype.storeState.call(this)},o.prototype._restoreStateValues=function(){return r.prototype._restoreStateValues.call(this)?(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!1},o.prototype._isSynchronizedViewMatrix=function(){return r.prototype._isSynchronizedViewMatrix.call(this)?this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset):!1},o.prototype.attachControl=function(g,y,v,f){var b=this;v===void 0&&(v=!0),f===void 0&&(f=2),y=e.b.BackCompatCameraNoPreventDefault(arguments),this._useCtrlForPanning=v,this._panningMouseButton=f,typeof arguments[0]=="boolean"&&(arguments.length>1&&(this._useCtrlForPanning=arguments[1]),arguments.length>2&&(this._panningMouseButton=arguments[2])),this.inputs.attachElement(y),this._reset=function(){b.inertialAlphaOffset=0,b.inertialBetaOffset=0,b.inertialRadiusOffset=0,b.inertialPanningX=0,b.inertialPanningY=0}},o.prototype.detachControl=function(g){this.inputs.detachElement(),this._reset&&this._reset()},o.prototype._checkInputs=function(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this.inertialAlphaOffset!==0||this.inertialBetaOffset!==0||this.inertialRadiusOffset!==0){var g=this.inertialAlphaOffset;this.beta<=0&&(g*=-1),this.getScene().useRightHandedSystem&&(g*=-1),this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(g*=-1),this.alpha+=g,this.beta+=this.inertialBetaOffset,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<t.a&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<t.a&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*t.a&&(this.inertialRadiusOffset=0)}if(this.inertialPanningX!==0||this.inertialPanningY!==0){var y=new n.e(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),y.multiplyInPlace(this.panningAxis),n.e.TransformNormalToRef(y,this._cameraTransformMatrix,this._transformedDirection),!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);var v=n.e.DistanceSquared(this._transformedDirection,this.panningOriginTarget);v<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.copyFrom(this._transformedDirection)}else this._target.addInPlace(this._transformedDirection);this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*t.a&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*t.a&&(this.inertialPanningY=0)}this._checkLimits(),r.prototype._checkInputs.call(this)}},o.prototype._checkLimits=function(){this.lowerBetaLimit===null||this.lowerBetaLimit===void 0?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),this.upperBetaLimit===null||this.upperBetaLimit===void 0?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),this.lowerAlphaLimit!==null&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),this.upperAlphaLimit!==null&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),this.lowerRadiusLimit!==null&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),this.upperRadiusLimit!==null&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)},o.prototype.rebuildAnglesAndRadius=function(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),(this._upVector.x!==0||this._upVector.y!==1||this._upVector.z!==0)&&n.e.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),this.radius===0&&(this.radius=1e-4);var g=this.alpha;this._computationVector.x===0&&this._computationVector.z===0?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);var y=Math.round((g-this.alpha)/(2*Math.PI));this.alpha+=y*2*Math.PI,this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()},o.prototype.setPosition=function(g){this._position.equals(g)||(this._position.copyFrom(g),this.rebuildAnglesAndRadius())},o.prototype.setTarget=function(g,y,v){if(y===void 0&&(y=!1),v===void 0&&(v=!1),g.getBoundingInfo)y?this._targetBoundingCenter=g.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,g.computeWorldMatrix(),this._targetHost=g,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{var f=g,b=this._getTargetPosition();if(b&&!v&&b.equals(f))return;this._targetHost=null,this._target=f,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}this.rebuildAnglesAndRadius()},o.prototype._getViewMatrix=function(){var g=Math.cos(this.alpha),y=Math.sin(this.alpha),v=Math.cos(this.beta),f=Math.sin(this.beta);f===0&&(f=1e-4),this.radius===0&&(this.radius=1e-4);var b=this._getTargetPosition();if(this._computationVector.copyFromFloats(this.radius*g*f,this.radius*v,this.radius*y*f),(this._upVector.x!==0||this._upVector.y!==1||this._upVector.z!==0)&&n.e.TransformCoordinatesToRef(this._computationVector,this._YToUpMatrix,this._computationVector),b.addToRef(this._computationVector,this._newPosition),this.getScene().collisionsEnabled&&this.checkCollisions){var T=this.getScene().collisionCoordinator;this._collider||(this._collider=T.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,T.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.copyFrom(this._newPosition);var E=this.upVector;this.allowUpsideDown&&f<0&&(E=E.negate()),this._computeViewMatrix(this._position,b,E),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=b,this._viewMatrix},o.prototype.zoomOn=function(g,y){y===void 0&&(y=!1),g=g||this.getScene().meshes;var v=a.a.MinMax(g),f=n.e.Distance(v.min,v.max);this.radius=f*this.zoomOnFactor,this.focusOn({min:v.min,max:v.max,distance:f},y)},o.prototype.focusOn=function(g,y){y===void 0&&(y=!1);var v,f;if(g.min===void 0){var b=g||this.getScene().meshes;v=a.a.MinMax(b),f=n.e.Distance(v.min,v.max)}else{var T=g;v=T,f=T.distance}this._target=a.a.Center(v),y||(this.maxZ=f*2)},o.prototype.createRigCamera=function(g,y){var v=0;switch(this.cameraRigMode){case p.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case p.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case p.a.RIG_MODE_STEREOSCOPIC_OVERUNDER:case p.a.RIG_MODE_STEREOSCOPIC_INTERLACED:case p.a.RIG_MODE_VR:v=this._cameraRigParams.stereoHalfAngle*(y===0?1:-1);break;case p.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:v=this._cameraRigParams.stereoHalfAngle*(y===0?-1:1);break}var f=new o(g,this.alpha+v,this.beta,this.radius,this._target,this.getScene());return f._cameraRigParams={},f.isRigCamera=!0,f.rigParent=this,f.upVector=this.upVector,f},o.prototype._updateRigCameras=function(){var g=this._rigCameras[0],y=this._rigCameras[1];switch(g.beta=y.beta=this.beta,this.cameraRigMode){case p.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case p.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case p.a.RIG_MODE_STEREOSCOPIC_OVERUNDER:case p.a.RIG_MODE_STEREOSCOPIC_INTERLACED:case p.a.RIG_MODE_VR:g.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,y.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case p.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:g.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,y.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle;break}r.prototype._updateRigCameras.call(this)},o.prototype.dispose=function(){this.inputs.clear(),r.prototype.dispose.call(this)},o.prototype.getClassName=function(){return"ArcRotateCamera"},Object(P.c)([Object(d.c)()],o.prototype,"alpha",void 0),Object(P.c)([Object(d.c)()],o.prototype,"beta",void 0),Object(P.c)([Object(d.c)()],o.prototype,"radius",void 0),Object(P.c)([Object(d.o)("target")],o.prototype,"_target",void 0),Object(P.c)([Object(d.c)()],o.prototype,"inertialAlphaOffset",void 0),Object(P.c)([Object(d.c)()],o.prototype,"inertialBetaOffset",void 0),Object(P.c)([Object(d.c)()],o.prototype,"inertialRadiusOffset",void 0),Object(P.c)([Object(d.c)()],o.prototype,"lowerAlphaLimit",void 0),Object(P.c)([Object(d.c)()],o.prototype,"upperAlphaLimit",void 0),Object(P.c)([Object(d.c)()],o.prototype,"lowerBetaLimit",void 0),Object(P.c)([Object(d.c)()],o.prototype,"upperBetaLimit",void 0),Object(P.c)([Object(d.c)()],o.prototype,"lowerRadiusLimit",void 0),Object(P.c)([Object(d.c)()],o.prototype,"upperRadiusLimit",void 0),Object(P.c)([Object(d.c)()],o.prototype,"inertialPanningX",void 0),Object(P.c)([Object(d.c)()],o.prototype,"inertialPanningY",void 0),Object(P.c)([Object(d.c)()],o.prototype,"pinchToPanMaxDistance",void 0),Object(P.c)([Object(d.c)()],o.prototype,"panningDistanceLimit",void 0),Object(P.c)([Object(d.o)()],o.prototype,"panningOriginTarget",void 0),Object(P.c)([Object(d.c)()],o.prototype,"panningInertia",void 0),Object(P.c)([Object(d.c)()],o.prototype,"zoomOnFactor",void 0),Object(P.c)([Object(d.c)()],o.prototype,"targetScreenOffset",void 0),Object(P.c)([Object(d.c)()],o.prototype,"allowUpsideDown",void 0),Object(P.c)([Object(d.c)()],o.prototype,"useInputToRestoreState",void 0),o}(l.a)},function($,W,M){"use strict";var P=M(435),d="morphTargetsVertexGlobal",m=`#ifdef MORPHTARGETS
#ifdef MORPHTARGETS_TEXTURE
float vertexID;
#endif
#endif`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},function($,W,M){"use strict";var P=M(435),d="morphTargetsVertex",m=`#ifdef MORPHTARGETS
#ifdef MORPHTARGETS_TEXTURE
vertexID=float(gl_VertexID)*morphTargetTextureInfo.x;
positionUpdated+=(readVector3FromRawSampler({X},vertexID)-position)*morphTargetInfluences[{X}];
vertexID+=1.0;
#ifdef MORPHTARGETS_NORMAL
normalUpdated+=(readVector3FromRawSampler({X},vertexID)-normal)*morphTargetInfluences[{X}];
vertexID+=1.0;
#endif
#ifdef MORPHTARGETS_UV
uvUpdated+=(readVector3FromRawSampler({X},vertexID).xy-uv)*morphTargetInfluences[{X}];
vertexID+=1.0;
#endif
#ifdef MORPHTARGETS_TANGENT
tangentUpdated.xyz+=(readVector3FromRawSampler({X},vertexID)-tangent.xyz)*morphTargetInfluences[{X}];
#endif
#else
positionUpdated+=(position{X}-position)*morphTargetInfluences[{X}];
#ifdef MORPHTARGETS_NORMAL
normalUpdated+=(normal{X}-normal)*morphTargetInfluences[{X}];
#endif
#ifdef MORPHTARGETS_TANGENT
tangentUpdated.xyz+=(tangent{X}-tangent.xyz)*morphTargetInfluences[{X}];
#endif
#ifdef MORPHTARGETS_UV
uvUpdated+=(uv_{X}-uv)*morphTargetInfluences[{X}];
#endif
#endif
#endif`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},,,,function($,W,M){"use strict";M.d(W,"a",function(){return P});var P=function(){function d(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}return d.prototype.unBindMesh=function(){this._mesh=null},d.prototype.addFallback=function(m,n){this._defines[m]||(m<this._currentRank&&(this._currentRank=m),m>this._maxRank&&(this._maxRank=m),this._defines[m]=new Array),this._defines[m].push(n)},d.prototype.addCPUSkinningFallback=function(m,n){this._mesh=n,m<this._currentRank&&(this._currentRank=m),m>this._maxRank&&(this._maxRank=m)},Object.defineProperty(d.prototype,"hasMoreFallbacks",{get:function(){return this._currentRank<=this._maxRank},enumerable:!1,configurable:!0}),d.prototype.reduce=function(m,n){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,m=m.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),n._bonesComputationForcedToCPU=!0;for(var c=this._mesh.getScene(),a=0;a<c.meshes.length;a++){var _=c.meshes[a];if(!_.material){!this._mesh.material&&_.computeBonesUsingShaders&&_.numBoneInfluencers>0&&(_.computeBonesUsingShaders=!1);continue}if(!(!_.computeBonesUsingShaders||_.numBoneInfluencers===0)){if(_.material.getEffect()===n)_.computeBonesUsingShaders=!1;else if(_.subMeshes)for(var s=0,u=_.subMeshes;s<u.length;s++){var p=u[s],l=p.effect;if(l===n){_.computeBonesUsingShaders=!1;break}}}}}else{var h=this._defines[this._currentRank];if(h)for(var a=0;a<h.length;a++)m=m.replace("#define "+h[a],"");this._currentRank++}return m},d}()},,,function($,W,M){"use strict";M.d(W,"b",function(){return P}),M.d(W,"c",function(){return d}),M.d(W,"a",function(){return m});var P=1/2.2,d=2.2,m=.001},,,,function($,W,M){"use strict";M.d(W,"a",function(){return d});function P(){return typeof _native!="undefined"&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest}var d=function(){function m(){this._xhr=P()}return m.prototype._injectCustomRequestHeaders=function(){for(var n in m.CustomRequestHeaders){var c=m.CustomRequestHeaders[n];c&&this._xhr.setRequestHeader(n,c)}},Object.defineProperty(m.prototype,"onprogress",{get:function(){return this._xhr.onprogress},set:function(n){this._xhr.onprogress=n},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"readyState",{get:function(){return this._xhr.readyState},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"status",{get:function(){return this._xhr.status},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"statusText",{get:function(){return this._xhr.statusText},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"response",{get:function(){return this._xhr.response},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"responseURL",{get:function(){return this._xhr.responseURL},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"responseText",{get:function(){return this._xhr.responseText},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"responseType",{get:function(){return this._xhr.responseType},set:function(n){this._xhr.responseType=n},enumerable:!1,configurable:!0}),m.prototype.addEventListener=function(n,c,a){this._xhr.addEventListener(n,c,a)},m.prototype.removeEventListener=function(n,c,a){this._xhr.removeEventListener(n,c,a)},m.prototype.abort=function(){this._xhr.abort()},m.prototype.send=function(n){m.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(n)},m.prototype.open=function(n,c){for(var a=0,_=m.CustomRequestModifiers;a<_.length;a++){var s=_[a];s(this._xhr,c)}return c=c.replace("file:http:","http:"),c=c.replace("file:https:","https:"),this._xhr.open(n,c,!0)},m.prototype.setRequestHeader=function(n,c){this._xhr.setRequestHeader(n,c)},m.prototype.getResponseHeader=function(n){return this._xhr.getResponseHeader(n)},m.CustomRequestHeaders={},m.CustomRequestModifiers=new Array,m}()},function($,W,M){"use strict";M.d(W,"a",function(){return P});var P=function(){function d(m,n,c,a){this.x=m,this.y=n,this.width=c,this.height=a}return d.prototype.toGlobal=function(m,n){return new d(this.x*m,this.y*n,this.width*m,this.height*n)},d.prototype.toGlobalToRef=function(m,n,c){return c.x=this.x*m,c.y=this.y*n,c.width=this.width*m,c.height=this.height*n,this},d.prototype.clone=function(){return new d(this.x,this.y,this.width,this.height)},d}()},,,,function($,W,M){"use strict";var P=M(435),d="imageProcessingDeclaration",m=`#ifdef EXPOSURE
uniform float exposureLinear;
#endif
#ifdef CONTRAST
uniform float contrast;
#endif
#ifdef VIGNETTE
uniform vec2 vInverseScreenSize;
uniform vec4 vignetteSettings1;
uniform vec4 vignetteSettings2;
#endif
#ifdef COLORCURVES
uniform vec4 vCameraColorCurveNegative;
uniform vec4 vCameraColorCurveNeutral;
uniform vec4 vCameraColorCurvePositive;
#endif
#ifdef COLORGRADING
#ifdef COLORGRADING3D
uniform highp sampler3D txColorTransform;
#else
uniform sampler2D txColorTransform;
#endif
uniform vec4 colorTransformSettings;
#endif`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},function($,W,M){"use strict";var P=M(435),d="imageProcessingFunctions",m=`#if defined(COLORGRADING) && !defined(COLORGRADING3D)

#define inline
vec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)
{
float sliceSize=2.0*sampler3dSetting.x;
#ifdef SAMPLER3DGREENDEPTH
float sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;
#else
float sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;
#endif
float sliceInteger=floor(sliceContinuous);


float sliceFraction=sliceContinuous-sliceInteger;
#ifdef SAMPLER3DGREENDEPTH
vec2 sliceUV=color.rb;
#else
vec2 sliceUV=color.rg;
#endif
sliceUV.x*=sliceSize;
sliceUV.x+=sliceInteger*sliceSize;
sliceUV=saturate(sliceUV);
vec4 slice0Color=texture2D(colorTransform,sliceUV);
sliceUV.x+=sliceSize;
sliceUV=saturate(sliceUV);
vec4 slice1Color=texture2D(colorTransform,sliceUV);
vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);
#ifdef SAMPLER3DBGRMAP
color.rgb=result.rgb;
#else
color.rgb=result.bgr;
#endif
return color;
}
#endif
#ifdef TONEMAPPING_ACES





const mat3 ACESInputMat=mat3(
vec3(0.59719,0.07600,0.02840),
vec3(0.35458,0.90834,0.13383),
vec3(0.04823,0.01566,0.83777)
);

const mat3 ACESOutputMat=mat3(
vec3( 1.60475,-0.10208,-0.00327),
vec3(-0.53108,1.10813,-0.07276),
vec3(-0.07367,-0.00605,1.07602)
);
vec3 RRTAndODTFit(vec3 v)
{
vec3 a=v*(v+0.0245786)-0.000090537;
vec3 b=v*(0.983729*v+0.4329510)+0.238081;
return a/b;
}
vec3 ACESFitted(vec3 color)
{
color=ACESInputMat*color;

color=RRTAndODTFit(color);
color=ACESOutputMat*color;

color=saturate(color);
return color;
}
#endif
vec4 applyImageProcessing(vec4 result) {
#ifdef EXPOSURE
result.rgb*=exposureLinear;
#endif
#ifdef VIGNETTE

vec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;
viewportXY=viewportXY*2.0-1.0;
vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);
float vignetteTerm=dot(vignetteXY1,vignetteXY1);
float vignette=pow(vignetteTerm,vignetteSettings2.w);

vec3 vignetteColor=vignetteSettings2.rgb;
#ifdef VIGNETTEBLENDMODEMULTIPLY
vec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);
result.rgb*=vignetteColorMultiplier;
#endif
#ifdef VIGNETTEBLENDMODEOPAQUE
result.rgb=mix(vignetteColor,result.rgb,vignette);
#endif
#endif
#ifdef TONEMAPPING
#ifdef TONEMAPPING_ACES
result.rgb=ACESFitted(result.rgb);
#else
const float tonemappingCalibration=1.590579;
result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);
#endif
#endif

result.rgb=toGammaSpace(result.rgb);
result.rgb=saturate(result.rgb);
#ifdef CONTRAST

vec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);
if (contrast<1.0) {

result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);
} else {

result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);
}
#endif

#ifdef COLORGRADING
vec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;
#ifdef COLORGRADING3D
vec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;
#else
vec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;
#endif
result.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);
#endif
#ifdef COLORCURVES

float luma=getLuminance(result.rgb);
vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));
vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;
result.rgb*=colorCurve.rgb;
result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);
#endif
return result;
}`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},,,function($,W,M){"use strict";M.d(W,"a",function(){return _});var P=M(434),d=M(439),m=M(451),n=M(436),c=M(515),a=M(465),_=function(s){Object(P.d)(u,s);function u(p,l,h,t){t===void 0&&(t=!0);var e=s.call(this,p,l,h,t)||this;return e._tmpUpVector=n.e.Zero(),e._tmpTargetVector=n.e.Zero(),e.cameraDirection=new n.e(0,0,0),e.cameraRotation=new n.d(0,0),e.ignoreParentScaling=!1,e.updateUpVectorFromRotation=!1,e._tmpQuaternion=new n.b,e.rotation=new n.e(0,0,0),e.speed=2,e.noRotationConstraint=!1,e.invertRotation=!1,e.inverseRotationSpeed=.2,e.lockedTarget=null,e._currentTarget=n.e.Zero(),e._initialFocalDistance=1,e._viewMatrix=n.a.Zero(),e._camMatrix=n.a.Zero(),e._cameraTransformMatrix=n.a.Zero(),e._cameraRotationMatrix=n.a.Zero(),e._referencePoint=new n.e(0,0,1),e._transformedReferencePoint=n.e.Zero(),e._defaultUp=n.e.Up(),e._cachedRotationZ=0,e._cachedQuaternionRotationZ=0,e}return u.prototype.getFrontPosition=function(p){this.getWorldMatrix();var l=this.getTarget().subtract(this.position);return l.normalize(),l.scaleInPlace(p),this.globalPosition.add(l)},u.prototype._getLockedTargetPosition=function(){return this.lockedTarget?(this.lockedTarget.absolutePosition&&this.lockedTarget.computeWorldMatrix(),this.lockedTarget.absolutePosition||this.lockedTarget):null},u.prototype.storeState=function(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),s.prototype.storeState.call(this)},u.prototype._restoreStateValues=function(){return s.prototype._restoreStateValues.call(this)?(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.copyFromFloats(0,0,0),this.cameraRotation.copyFromFloats(0,0),!0):!1},u.prototype._initCache=function(){s.prototype._initCache.call(this),this._cache.lockedTarget=new n.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new n.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new n.b(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},u.prototype._updateCache=function(p){p||s.prototype._updateCache.call(this);var l=this._getLockedTargetPosition();l?this._cache.lockedTarget?this._cache.lockedTarget.copyFrom(l):this._cache.lockedTarget=l.clone():this._cache.lockedTarget=null,this._cache.rotation.copyFrom(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.copyFrom(this.rotationQuaternion)},u.prototype._isSynchronizedViewMatrix=function(){if(!s.prototype._isSynchronizedViewMatrix.call(this))return!1;var p=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(p):!p)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))},u.prototype._computeLocalCameraSpeed=function(){var p=this.getEngine();return this.speed*Math.sqrt(p.getDeltaTime()/(p.getFps()*100))},u.prototype.setTarget=function(p){this.upVector.normalize(),this._initialFocalDistance=p.subtract(this.position).length(),this.position.z===p.z&&(this.position.z+=c.a),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),n.a.LookAtLHToRef(this.position,p,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);var l=p.subtract(this.position);l.x>=0?this.rotation.y=-Math.atan(l.z/l.x)+Math.PI/2:this.rotation.y=-Math.atan(l.z/l.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&n.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)},Object.defineProperty(u.prototype,"target",{get:function(){return this.getTarget()},set:function(p){this.setTarget(p)},enumerable:!1,configurable:!0}),u.prototype.getTarget=function(){return this._currentTarget},u.prototype._decideIfNeedsToMove=function(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0},u.prototype._updatePosition=function(){if(this.parent){this.parent.getWorldMatrix().invertToRef(n.c.Matrix[0]),n.e.TransformNormalToRef(this.cameraDirection,n.c.Matrix[0],n.c.Vector3[0]),this.position.addInPlace(n.c.Vector3[0]);return}this.position.addInPlace(this.cameraDirection)},u.prototype._checkInputs=function(){var p=this.invertRotation?-this.inverseRotationSpeed:1,l=this._decideIfNeedsToMove(),h=Math.abs(this.cameraRotation.x)>0||Math.abs(this.cameraRotation.y)>0;if(l&&this._updatePosition(),h){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this.rotation),this.rotation.x+=this.cameraRotation.x*p,this.rotation.y+=this.cameraRotation.y*p,!this.noRotationConstraint){var t=1.570796;this.rotation.x>t&&(this.rotation.x=t),this.rotation.x<-t&&(this.rotation.x=-t)}if(this.rotationQuaternion){var e=this.rotation.lengthSquared();e&&n.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}}l&&(Math.abs(this.cameraDirection.x)<this.speed*c.a&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*c.a&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*c.a&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),h&&(Math.abs(this.cameraRotation.x)<this.speed*c.a&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*c.a&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),s.prototype._checkInputs.call(this)},u.prototype._updateCameraRotationMatrix=function(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):n.a.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)},u.prototype._rotateUpVectorWithCameraRotationMatrix=function(){return n.e.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this},u.prototype._getViewMatrix=function(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!=this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),n.e.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?a.a.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(n.b.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),a.a.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix},u.prototype._computeViewMatrix=function(p,l,h){if(this.ignoreParentScaling){if(this.parent){var t=this.parent.getWorldMatrix();n.e.TransformCoordinatesToRef(p,t,this._globalPosition),n.e.TransformCoordinatesToRef(l,t,this._tmpTargetVector),n.e.TransformNormalToRef(h,t,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.copyFrom(p),this._tmpTargetVector.copyFrom(l),this._tmpUpVector.copyFrom(h);this.getScene().useRightHandedSystem?n.a.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):n.a.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix);return}if(this.getScene().useRightHandedSystem?n.a.LookAtRHToRef(p,l,h,this._viewMatrix):n.a.LookAtLHToRef(p,l,h,this._viewMatrix),this.parent){var t=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(t,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.copyFrom(p)},u.prototype.createRigCamera=function(p,l){if(this.cameraRigMode!==m.a.RIG_MODE_NONE){var h=new u(p,this.position.clone(),this.getScene());return h.isRigCamera=!0,h.rigParent=this,(this.cameraRigMode===m.a.RIG_MODE_VR||this.cameraRigMode===m.a.RIG_MODE_WEBVR)&&(this.rotationQuaternion||(this.rotationQuaternion=new n.b),h._cameraRigParams={},h.rotationQuaternion=new n.b),h}return null},u.prototype._updateRigCameras=function(){var p=this._rigCameras[0],l=this._rigCameras[1];switch(this.computeWorldMatrix(),this.cameraRigMode){case m.a.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case m.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case m.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case m.a.RIG_MODE_STEREOSCOPIC_OVERUNDER:case m.a.RIG_MODE_STEREOSCOPIC_INTERLACED:var h=this.cameraRigMode===m.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,t=this.cameraRigMode===m.a.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*h,p),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*t,l);break;case m.a.RIG_MODE_VR:p.rotationQuaternion?(p.rotationQuaternion.copyFrom(this.rotationQuaternion),l.rotationQuaternion.copyFrom(this.rotationQuaternion)):(p.rotation.copyFrom(this.rotation),l.rotation.copyFrom(this.rotation)),p.position.copyFrom(this.position),l.position.copyFrom(this.position);break}s.prototype._updateRigCameras.call(this)},u.prototype._getRigCamPositionAndTarget=function(p,l){var h=this.getTarget();h.subtractToRef(this.position,u._TargetFocalPoint),u._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);var t=u._TargetFocalPoint.addInPlace(this.position);n.a.TranslationToRef(-t.x,-t.y,-t.z,u._TargetTransformMatrix),u._TargetTransformMatrix.multiplyToRef(n.a.RotationAxis(l.upVector,p),u._RigCamTransformMatrix),n.a.TranslationToRef(t.x,t.y,t.z,u._TargetTransformMatrix),u._RigCamTransformMatrix.multiplyToRef(u._TargetTransformMatrix,u._RigCamTransformMatrix),n.e.TransformCoordinatesToRef(this.position,u._RigCamTransformMatrix,l.position),l.setTarget(t)},u.prototype.getClassName=function(){return"TargetCamera"},u._RigCamTransformMatrix=new n.a,u._TargetTransformMatrix=new n.a,u._TargetFocalPoint=new n.e,Object(P.c)([Object(d.o)()],u.prototype,"rotation",void 0),Object(P.c)([Object(d.c)()],u.prototype,"speed",void 0),Object(P.c)([Object(d.k)("lockedTargetId")],u.prototype,"lockedTarget",void 0),u}(m.a)},,,,,,,,function($,W,M){"use strict";M.d(W,"a",function(){return u});var P=M(588),d=M(436),m=M(686),n=M(687),c={min:0,max:0},a={min:0,max:0},_=function(p,l,h){var t=d.e.Dot(l.centerWorld,p),e=Math.abs(d.e.Dot(l.directions[0],p))*l.extendSize.x,i=Math.abs(d.e.Dot(l.directions[1],p))*l.extendSize.y,r=Math.abs(d.e.Dot(l.directions[2],p))*l.extendSize.z,o=e+i+r;h.min=t-o,h.max=t+o},s=function(p,l,h){return _(p,l,c),_(p,h,a),!(c.min>a.max||a.min>c.max)},u=function(){function p(l,h,t){this._isLocked=!1,this.boundingBox=new m.a(l,h,t),this.boundingSphere=new n.a(l,h,t)}return p.prototype.reConstruct=function(l,h,t){this.boundingBox.reConstruct(l,h,t),this.boundingSphere.reConstruct(l,h,t)},Object.defineProperty(p.prototype,"minimum",{get:function(){return this.boundingBox.minimum},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"maximum",{get:function(){return this.boundingBox.maximum},enumerable:!1,configurable:!0}),Object.defineProperty(p.prototype,"isLocked",{get:function(){return this._isLocked},set:function(l){this._isLocked=l},enumerable:!1,configurable:!0}),p.prototype.update=function(l){this._isLocked||(this.boundingBox._update(l),this.boundingSphere._update(l))},p.prototype.centerOn=function(l,h){var t=p.TmpVector3[0].copyFrom(l).subtractInPlace(h),e=p.TmpVector3[1].copyFrom(l).addInPlace(h);return this.boundingBox.reConstruct(t,e,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(t,e,this.boundingBox.getWorldMatrix()),this},p.prototype.encapsulate=function(l){var h=d.e.Minimize(this.minimum,l),t=d.e.Maximize(this.maximum,l);return this.reConstruct(h,t,this.boundingBox.getWorldMatrix()),this},p.prototype.encapsulateBoundingInfo=function(l){return this.encapsulate(l.boundingBox.centerWorld.subtract(l.boundingBox.extendSizeWorld)),this.encapsulate(l.boundingBox.centerWorld.add(l.boundingBox.extendSizeWorld)),this},p.prototype.scale=function(l){return this.boundingBox.scale(l),this.boundingSphere.scale(l),this},p.prototype.isInFrustum=function(l,h){h===void 0&&(h=0);var t=h===2||h===3;if(t&&this.boundingSphere.isCenterInFrustum(l))return!0;if(!this.boundingSphere.isInFrustum(l))return!1;var e=h===1||h===3;return e?!0:this.boundingBox.isInFrustum(l)},Object.defineProperty(p.prototype,"diagonalLength",{get:function(){var l=this.boundingBox,h=l.maximumWorld.subtractToRef(l.minimumWorld,p.TmpVector3[0]);return h.length()},enumerable:!1,configurable:!0}),p.prototype.isCompletelyInFrustum=function(l){return this.boundingBox.isCompletelyInFrustum(l)},p.prototype._checkCollision=function(l){return l._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)},p.prototype.intersectsPoint=function(l){return!(!this.boundingSphere.centerWorld||!this.boundingSphere.intersectsPoint(l)||!this.boundingBox.intersectsPoint(l))},p.prototype.intersects=function(l,h){if(!n.a.Intersects(this.boundingSphere,l.boundingSphere)||!m.a.Intersects(this.boundingBox,l.boundingBox))return!1;if(!h)return!0;var t=this.boundingBox,e=l.boundingBox;return!(!s(t.directions[0],t,e)||!s(t.directions[1],t,e)||!s(t.directions[2],t,e)||!s(e.directions[0],t,e)||!s(e.directions[1],t,e)||!s(e.directions[2],t,e)||!s(d.e.Cross(t.directions[0],e.directions[0]),t,e)||!s(d.e.Cross(t.directions[0],e.directions[1]),t,e)||!s(d.e.Cross(t.directions[0],e.directions[2]),t,e)||!s(d.e.Cross(t.directions[1],e.directions[0]),t,e)||!s(d.e.Cross(t.directions[1],e.directions[1]),t,e)||!s(d.e.Cross(t.directions[1],e.directions[2]),t,e)||!s(d.e.Cross(t.directions[2],e.directions[0]),t,e)||!s(d.e.Cross(t.directions[2],e.directions[1]),t,e)||!s(d.e.Cross(t.directions[2],e.directions[2]),t,e))},p.TmpVector3=P.a.BuildArray(2,d.e.Zero),p}()},,,function($,W,M){"use strict";M.d(W,"a",function(){return m});var P=M(436),d=M(447),m=function(){function n(){this._pickingUnavailable=!1,this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.originMesh=null,this.ray=null}return n.prototype.getNormal=function(c,a){if(c===void 0&&(c=!1),a===void 0&&(a=!0),!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(d.b.NormalKind))return null;var _=this.pickedMesh.getIndices();if(!_)return null;var s;if(a){var u=this.pickedMesh.getVerticesData(d.b.NormalKind),p=P.e.FromArray(u,_[this.faceId*3]*3),l=P.e.FromArray(u,_[this.faceId*3+1]*3),h=P.e.FromArray(u,_[this.faceId*3+2]*3);p=p.scale(this.bu),l=l.scale(this.bv),h=h.scale(1-this.bu-this.bv),s=new P.e(p.x+l.x+h.x,p.y+l.y+h.y,p.z+l.z+h.z)}else{var t=this.pickedMesh.getVerticesData(d.b.PositionKind),e=P.e.FromArray(t,_[this.faceId*3]*3),i=P.e.FromArray(t,_[this.faceId*3+1]*3),r=P.e.FromArray(t,_[this.faceId*3+2]*3),o=e.subtract(i),g=r.subtract(i);s=P.e.Cross(o,g)}if(c){var y=this.pickedMesh.getWorldMatrix();this.pickedMesh.nonUniformScaling&&(P.c.Matrix[0].copyFrom(y),y=P.c.Matrix[0],y.setTranslationFromFloats(0,0,0),y.invert(),y.transposeToRef(P.c.Matrix[1]),y=P.c.Matrix[1]),s=P.e.TransformNormal(s,y)}return s.normalize(),s},n.prototype.getTextureCoordinates=function(){if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(d.b.UVKind))return null;var c=this.pickedMesh.getIndices();if(!c)return null;var a=this.pickedMesh.getVerticesData(d.b.UVKind);if(!a)return null;var _=P.d.FromArray(a,c[this.faceId*3]*2),s=P.d.FromArray(a,c[this.faceId*3+1]*2),u=P.d.FromArray(a,c[this.faceId*3+2]*2);return _=_.scale(this.bu),s=s.scale(this.bv),u=u.scale(1-this.bu-this.bv),new P.d(_.x+s.x+u.x,_.y+s.y+u.y)},n}()},,,,function($,W,M){"use strict";M.d(W,"a",function(){return c});var P=M(434),d=M(459),m=M(663),n=M(437),c=function(a){Object(P.d)(_,a);function _(s,u){var p=a.call(this,s,u,!0)||this;return u.multiMaterials.push(p),p.subMaterials=new Array,p._storeEffectOnSubMeshes=!0,p}return Object.defineProperty(_.prototype,"subMaterials",{get:function(){return this._subMaterials},set:function(s){this._subMaterials=s,this._hookArray(s)},enumerable:!1,configurable:!0}),_.prototype.getChildren=function(){return this.subMaterials},_.prototype._hookArray=function(s){var u=this,p=s.push;s.push=function(){for(var h=[],t=0;t<arguments.length;t++)h[t]=arguments[t];var e=p.apply(s,h);return u._markAllSubMeshesAsTexturesDirty(),e};var l=s.splice;s.splice=function(h,t){var e=l.apply(s,[h,t]);return u._markAllSubMeshesAsTexturesDirty(),e}},_.prototype.getSubMaterial=function(s){return s<0||s>=this.subMaterials.length?this.getScene().defaultMaterial:this.subMaterials[s]},_.prototype.getActiveTextures=function(){var s;return(s=a.prototype.getActiveTextures.call(this)).concat.apply(s,this.subMaterials.map(function(u){return u?u.getActiveTextures():[]}))},_.prototype.hasTexture=function(s){var u;if(a.prototype.hasTexture.call(this,s))return!0;for(var p=0;p<this.subMaterials.length;p++)if((u=this.subMaterials[p])===null||u===void 0?void 0:u.hasTexture(s))return!0;return!1},_.prototype.getClassName=function(){return"MultiMaterial"},_.prototype.isReadyForSubMesh=function(s,u,p){for(var l=0;l<this.subMaterials.length;l++){var h=this.subMaterials[l];if(h){if(h._storeEffectOnSubMeshes){if(!h.isReadyForSubMesh(s,u,p))return!1;continue}if(!h.isReady(s))return!1}}return!0},_.prototype.clone=function(s,u){for(var p=new _(s,this.getScene()),l=0;l<this.subMaterials.length;l++){var h=null,t=this.subMaterials[l];u&&t?h=t.clone(s+"-"+t.name):h=this.subMaterials[l],p.subMaterials.push(h)}return p},_.prototype.serialize=function(){var s={};s.name=this.name,s.id=this.id,m.a&&(s.tags=m.a.GetTags(this)),s.materials=[];for(var u=0;u<this.subMaterials.length;u++){var p=this.subMaterials[u];p?s.materials.push(p.id):s.materials.push(null)}return s},_.prototype.dispose=function(s,u,p){var l=this.getScene();if(!!l){if(p)for(var t=0;t<this.subMaterials.length;t++){var h=this.subMaterials[t];h&&h.dispose(s,u)}var t=l.multiMaterials.indexOf(this);t>=0&&l.multiMaterials.splice(t,1),a.prototype.dispose.call(this,s,u)}},_.ParseMultiMaterial=function(s,u){var p=new _(s.name,u);p.id=s.id,m.a&&m.a.AddTagsTo(p,s.tags);for(var l=0;l<s.materials.length;l++){var h=s.materials[l];h?p.subMaterials.push(u.getLastMaterialByID(h)):p.subMaterials.push(null)}return p},_}(d.a);n.a.RegisteredTypes["BABYLON.MultiMaterial"]=c},,,,,,,function($,W,M){"use strict";var P=M(435),d="clipPlaneFragment",m=`#ifdef CLIPPLANE
if (fClipDistance>0.0)
{
discard;
}
#endif
#ifdef CLIPPLANE2
if (fClipDistance2>0.0)
{
discard;
}
#endif
#ifdef CLIPPLANE3
if (fClipDistance3>0.0)
{
discard;
}
#endif
#ifdef CLIPPLANE4
if (fClipDistance4>0.0)
{
discard;
}
#endif
#ifdef CLIPPLANE5
if (fClipDistance5>0.0)
{
discard;
}
#endif
#ifdef CLIPPLANE6
if (fClipDistance6>0.0)
{
discard;
}
#endif`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},function($,W,M){"use strict";var P=M(435),d="clipPlaneVertex",m=`#ifdef CLIPPLANE
fClipDistance=dot(worldPos,vClipPlane);
#endif
#ifdef CLIPPLANE2
fClipDistance2=dot(worldPos,vClipPlane2);
#endif
#ifdef CLIPPLANE3
fClipDistance3=dot(worldPos,vClipPlane3);
#endif
#ifdef CLIPPLANE4
fClipDistance4=dot(worldPos,vClipPlane4);
#endif
#ifdef CLIPPLANE5
fClipDistance5=dot(worldPos,vClipPlane5);
#endif
#ifdef CLIPPLANE6
fClipDistance6=dot(worldPos,vClipPlane6);
#endif`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},function($,W,M){"use strict";M.d(W,"a",function(){return P});var P=function(){function d(){this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1}return Object.defineProperty(d.prototype,"isDirty",{get:function(){return this._isDirty},enumerable:!1,configurable:!0}),d.prototype.markAsProcessed=function(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1},d.prototype.markAsUnprocessed=function(){this._isDirty=!0},d.prototype.markAllAsDirty=function(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0},d.prototype.markAsImageProcessingDirty=function(){this._areImageProcessingDirty=!0,this._isDirty=!0},d.prototype.markAsLightDirty=function(m){m===void 0&&(m=!1),this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||m,this._isDirty=!0},d.prototype.markAsAttributesDirty=function(){this._areAttributesDirty=!0,this._isDirty=!0},d.prototype.markAsTexturesDirty=function(){this._areTexturesDirty=!0,this._isDirty=!0},d.prototype.markAsFresnelDirty=function(){this._areFresnelDirty=!0,this._isDirty=!0},d.prototype.markAsMiscDirty=function(){this._areMiscDirty=!0,this._isDirty=!0},d.prototype.markAsPrePassDirty=function(){this._arePrePassDirty=!0,this._isDirty=!0},d.prototype.rebuild=function(){this._keys=[];for(var m=0,n=Object.keys(this);m<n.length;m++){var c=n[m];c[0]!=="_"&&this._keys.push(c)}},d.prototype.isEqual=function(m){if(this._keys.length!==m._keys.length)return!1;for(var n=0;n<this._keys.length;n++){var c=this._keys[n];if(this[c]!==m[c])return!1}return!0},d.prototype.cloneTo=function(m){this._keys.length!==m._keys.length&&(m._keys=this._keys.slice(0));for(var n=0;n<this._keys.length;n++){var c=this._keys[n];m[c]=this[c]}},d.prototype.reset=function(){for(var m=0;m<this._keys.length;m++){var n=this._keys[m],c=typeof this[n];switch(c){case"number":this[n]=0;break;case"string":this[n]="";break;default:this[n]=!1;break}}},d.prototype.toString=function(){for(var m="",n=0;n<this._keys.length;n++){var c=this._keys[n],a=this[c],_=typeof a;switch(_){case"number":case"string":m+="#define "+c+" "+a+`
`;break;default:a&&(m+="#define "+c+`
`);break}}return m},d}()},function($,W,M){"use strict";M.d(W,"a",function(){return n});var P=M(434),d=M(436),m=M(459),n=function(c){Object(P.d)(a,c);function a(_,s){var u=c.call(this,_,s)||this;return u._normalMatrix=new d.a,u._storeEffectOnSubMeshes=!0,u}return a.prototype.getEffect=function(){return this._activeEffect},a.prototype.isReady=function(_,s){return _?!_.subMeshes||_.subMeshes.length===0?!0:this.isReadyForSubMesh(_,_.subMeshes[0],s):!1},a.prototype._isReadyForSubMesh=function(_){var s=_._materialDefines;return!!(!this.checkReadyOnEveryCall&&_.effect&&s&&s._renderId===this.getScene().getRenderId())},a.prototype.bindOnlyWorldMatrix=function(_){this._activeEffect.setMatrix("world",_)},a.prototype.bindOnlyNormalMatrix=function(_){this._activeEffect.setMatrix("normalMatrix",_)},a.prototype.bind=function(_,s){!s||this.bindForSubMesh(_,s,s.subMeshes[0])},a.prototype._afterBind=function(_,s){s===void 0&&(s=null),c.prototype._afterBind.call(this,_,s),this.getScene()._cachedEffect=s},a.prototype._mustRebind=function(_,s,u){return u===void 0&&(u=1),_.isCachedMaterialInvalid(this,s,u)},a}(m.a)},,,,function($,W,M){"use strict";M.d(W,"a",function(){return m});var P=M(440),d=M(717),m=function(){function n(c,a,_,s){this._alreadyBound=!1,this._valueCache={},this._engine=c,this._noUBO=!c.supportsUniformBuffers,this._dynamic=_,this._name=s!=null?s:"no-name",this._data=a||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateMatrix=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateMatrix=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform)}return Object.defineProperty(n.prototype,"useUbo",{get:function(){return!this._noUBO},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isSync",{get:function(){return!this._needSync},enumerable:!1,configurable:!0}),n.prototype.isDynamic=function(){return this._dynamic!==void 0},n.prototype.getData=function(){return this._bufferData},n.prototype.getBuffer=function(){return this._buffer},n.prototype._fillAlignment=function(c){var a;if(c<=2?a=c:a=4,this._uniformLocationPointer%a!=0){var _=this._uniformLocationPointer;this._uniformLocationPointer+=a-this._uniformLocationPointer%a;for(var s=this._uniformLocationPointer-_,u=0;u<s;u++)this._data.push(0)}},n.prototype.addUniform=function(c,a,_){if(_===void 0&&(_=0),!this._noUBO&&this._uniformLocations[c]===void 0){var s;if(_>0){if(a instanceof Array)throw"addUniform should not be use with Array in UBO: "+c;if(this._fillAlignment(4),this._uniformArraySizes[c]={strideSize:a,arraySize:_},a==16)a=a*_;else{var u=4-a,p=u*_;a=a*_+p}s=[];for(var l=0;l<a;l++)s.push(0)}else{if(a instanceof Array)s=a,a=s.length;else{a=a,s=[];for(var l=0;l<a;l++)s.push(0)}this._fillAlignment(a)}this._uniformSizes[c]=a,this._uniformLocations[c]=this._uniformLocationPointer,this._uniformLocationPointer+=a;for(var l=0;l<a;l++)this._data.push(s[l]);this._needSync=!0}},n.prototype.addMatrix=function(c,a){this.addUniform(c,Array.prototype.slice.call(a.toArray()))},n.prototype.addFloat2=function(c,a,_){var s=[a,_];this.addUniform(c,s)},n.prototype.addFloat3=function(c,a,_,s){var u=[a,_,s];this.addUniform(c,u)},n.prototype.addColor3=function(c,a){var _=[a.r,a.g,a.b];this.addUniform(c,_)},n.prototype.addColor4=function(c,a,_){var s=[a.r,a.g,a.b,_];this.addUniform(c,s)},n.prototype.addVector3=function(c,a){var _=[a.x,a.y,a.z];this.addUniform(c,_)},n.prototype.addMatrix3x3=function(c){this.addUniform(c,12)},n.prototype.addMatrix2x2=function(c){this.addUniform(c,8)},n.prototype.create=function(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)},n.prototype._rebuild=function(){this._noUBO||!this._bufferData||(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData):this._buffer=this._engine.createUniformBuffer(this._bufferData),this._engine._features.trackUbosInFrame&&(this._buffers.push(this._buffer),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))},Object.defineProperty(n.prototype,"_numBuffers",{get:function(){return this._buffers.length},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"_indexBuffer",{get:function(){return this._bufferIndex},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),n.prototype.update=function(){if(!this._buffer){this.create();return}if(!this._dynamic&&!this._needSync){this._createBufferOnWrite=this._engine._features.trackUbosInFrame;return}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(n._updatedUbosInFrame[this._name]||(n._updatedUbosInFrame[this._name]=0),n._updatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame},n.prototype._createNewBuffer=function(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild(),this._currentEffect&&this._buffer&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)},n.prototype._checkNewFrame=function(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=this._bufferIndex!==0,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex]):this._bufferIndex=-1,this._currentEffect&&this._buffer&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName))},n.prototype.updateUniform=function(c,a,_){this._checkNewFrame();var s=this._uniformLocations[c];if(s===void 0){if(this._buffer){P.a.Error("Cannot add an uniform after UBO has been created.");return}this.addUniform(c,_),s=this._uniformLocations[c]}if(this._buffer||this.create(),this._dynamic)for(var p=0;p<_;p++)this._bufferData[s+p]=a[p];else{for(var u=!1,p=0;p<_;p++)(_===16&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[s+p]!==a[p])&&(u=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[s+p]=a[p]);this._needSync=this._needSync||u}},n.prototype.updateUniformArray=function(c,a,_){this._checkNewFrame();var s=this._uniformLocations[c];if(s===void 0){P.a.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform.");return}this._buffer||this.create();var u=this._uniformArraySizes[c];if(this._dynamic)for(var t=0;t<_;t++)this._bufferData[s+t]=a[t];else{for(var p=!1,l=0,h=0,t=0;t<_;t++)if(this._bufferData[s+h*4+l]!==a[t]&&(p=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[s+h*4+l]=a[t]),l++,l===u.strideSize){for(;l<4;l++)this._bufferData[s+h*4+l]=0;l=0,h++}this._needSync=this._needSync||p}},n.prototype._cacheMatrix=function(c,a){this._checkNewFrame();var _=this._valueCache[c],s=a.updateFlag;return!(_!==void 0&&_===s)},n.prototype._updateMatrix3x3ForUniform=function(c,a){for(var _=0;_<3;_++)n._tempBuffer[_*4]=a[_*3],n._tempBuffer[_*4+1]=a[_*3+1],n._tempBuffer[_*4+2]=a[_*3+2],n._tempBuffer[_*4+3]=0;this.updateUniform(c,n._tempBuffer,12)},n.prototype._updateMatrix3x3ForEffect=function(c,a){this._currentEffect.setMatrix3x3(c,a)},n.prototype._updateMatrix2x2ForEffect=function(c,a){this._currentEffect.setMatrix2x2(c,a)},n.prototype._updateMatrix2x2ForUniform=function(c,a){for(var _=0;_<2;_++)n._tempBuffer[_*4]=a[_*2],n._tempBuffer[_*4+1]=a[_*2+1],n._tempBuffer[_*4+2]=0,n._tempBuffer[_*4+3]=0;this.updateUniform(c,n._tempBuffer,8)},n.prototype._updateFloatForEffect=function(c,a){this._currentEffect.setFloat(c,a)},n.prototype._updateFloatForUniform=function(c,a){n._tempBuffer[0]=a,this.updateUniform(c,n._tempBuffer,1)},n.prototype._updateFloat2ForEffect=function(c,a,_,s){s===void 0&&(s=""),this._currentEffect.setFloat2(c+s,a,_)},n.prototype._updateFloat2ForUniform=function(c,a,_){n._tempBuffer[0]=a,n._tempBuffer[1]=_,this.updateUniform(c,n._tempBuffer,2)},n.prototype._updateFloat3ForEffect=function(c,a,_,s,u){u===void 0&&(u=""),this._currentEffect.setFloat3(c+u,a,_,s)},n.prototype._updateFloat3ForUniform=function(c,a,_,s){n._tempBuffer[0]=a,n._tempBuffer[1]=_,n._tempBuffer[2]=s,this.updateUniform(c,n._tempBuffer,3)},n.prototype._updateFloat4ForEffect=function(c,a,_,s,u,p){p===void 0&&(p=""),this._currentEffect.setFloat4(c+p,a,_,s,u)},n.prototype._updateFloat4ForUniform=function(c,a,_,s,u){n._tempBuffer[0]=a,n._tempBuffer[1]=_,n._tempBuffer[2]=s,n._tempBuffer[3]=u,this.updateUniform(c,n._tempBuffer,4)},n.prototype._updateFloatArrayForEffect=function(c,a){this._currentEffect.setFloatArray(c,a)},n.prototype._updateFloatArrayForUniform=function(c,a){this.updateUniformArray(c,a,a.length)},n.prototype._updateArrayForEffect=function(c,a){this._currentEffect.setArray(c,a)},n.prototype._updateArrayForUniform=function(c,a){this.updateUniformArray(c,a,a.length)},n.prototype._updateIntArrayForEffect=function(c,a){this._currentEffect.setIntArray(c,a)},n.prototype._updateIntArrayForUniform=function(c,a){n._tempBufferInt32View.set(a),this.updateUniformArray(c,n._tempBuffer,a.length)},n.prototype._updateMatrixForEffect=function(c,a){this._currentEffect.setMatrix(c,a)},n.prototype._updateMatrixForUniform=function(c,a){this._cacheMatrix(c,a)&&this.updateUniform(c,a.toArray(),16)},n.prototype._updateMatricesForEffect=function(c,a){this._currentEffect.setMatrices(c,a)},n.prototype._updateMatricesForUniform=function(c,a){this.updateUniform(c,a,a.length)},n.prototype._updateVector3ForEffect=function(c,a){this._currentEffect.setVector3(c,a)},n.prototype._updateVector3ForUniform=function(c,a){n._tempBuffer[0]=a.x,n._tempBuffer[1]=a.y,n._tempBuffer[2]=a.z,this.updateUniform(c,n._tempBuffer,3)},n.prototype._updateVector4ForEffect=function(c,a){this._currentEffect.setVector4(c,a)},n.prototype._updateVector4ForUniform=function(c,a){n._tempBuffer[0]=a.x,n._tempBuffer[1]=a.y,n._tempBuffer[2]=a.z,n._tempBuffer[3]=a.w,this.updateUniform(c,n._tempBuffer,4)},n.prototype._updateColor3ForEffect=function(c,a,_){_===void 0&&(_=""),this._currentEffect.setColor3(c+_,a)},n.prototype._updateColor3ForUniform=function(c,a){n._tempBuffer[0]=a.r,n._tempBuffer[1]=a.g,n._tempBuffer[2]=a.b,this.updateUniform(c,n._tempBuffer,3)},n.prototype._updateColor4ForEffect=function(c,a,_,s){s===void 0&&(s=""),this._currentEffect.setColor4(c+s,a,_)},n.prototype._updateColor4ForUniform=function(c,a,_){n._tempBuffer[0]=a.r,n._tempBuffer[1]=a.g,n._tempBuffer[2]=a.b,n._tempBuffer[3]=_,this.updateUniform(c,n._tempBuffer,4)},n.prototype._updateIntForEffect=function(c,a,_){_===void 0&&(_=""),this._currentEffect.setInt(c+_,a)},n.prototype._updateIntForUniform=function(c,a){n._tempBufferInt32View[0]=a,this.updateUniform(c,n._tempBuffer,1)},n.prototype._updateInt2ForEffect=function(c,a,_,s){s===void 0&&(s=""),this._currentEffect.setInt2(c+s,a,_)},n.prototype._updateInt2ForUniform=function(c,a,_){n._tempBufferInt32View[0]=a,n._tempBufferInt32View[1]=_,this.updateUniform(c,n._tempBuffer,2)},n.prototype._updateInt3ForEffect=function(c,a,_,s,u){u===void 0&&(u=""),this._currentEffect.setInt3(c+u,a,_,s)},n.prototype._updateInt3ForUniform=function(c,a,_,s){n._tempBufferInt32View[0]=a,n._tempBufferInt32View[1]=_,n._tempBufferInt32View[2]=s,this.updateUniform(c,n._tempBuffer,3)},n.prototype._updateInt4ForEffect=function(c,a,_,s,u,p){p===void 0&&(p=""),this._currentEffect.setInt4(c+p,a,_,s,u)},n.prototype._updateInt4ForUniform=function(c,a,_,s,u){n._tempBufferInt32View[0]=a,n._tempBufferInt32View[1]=_,n._tempBufferInt32View[2]=s,n._tempBufferInt32View[3]=u,this.updateUniform(c,n._tempBuffer,4)},n.prototype.setTexture=function(c,a){this._currentEffect.setTexture(c,a)},n.prototype.updateUniformDirectly=function(c,a){this.updateUniform(c,a,a.length),this.update()},n.prototype.bindToEffect=function(c,a){this._currentEffect=c,this._currentEffectName=a,!(this._noUBO||!this._buffer)&&(this._alreadyBound=!0,c.bindUniformBuffer(this._buffer,a))},n.prototype.dispose=function(){if(!this._noUBO){var c=this._engine._uniformBuffers,a=c.indexOf(this);if(a!==-1&&(c[a]=c[c.length-1],c.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(var _=0;_<this._buffers.length;++_){var s=this._buffers[_];this._engine._releaseBuffer(s)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}},n._updatedUbosInFrame={},n._MAX_UNIFORM_SIZE=256,n._tempBuffer=new Float32Array(n._MAX_UNIFORM_SIZE),n._tempBufferInt32View=new Uint32Array(n._tempBuffer.buffer),n}()},function($,W,M){"use strict";var P=M(435),d="logDepthDeclaration",m=`#ifdef LOGARITHMICDEPTH
uniform float logarithmicDepthConstant;
varying float vFragmentDepth;
#endif`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},function($,W,M){"use strict";M.d(W,"a",function(){return c});var P=M(447),d=M(667),m=M(536),n=M(710),c=function(){function a(_,s,u,p,l,h,t,e,i){e===void 0&&(e=!0),i===void 0&&(i=!0),this.materialIndex=_,this.verticesStart=s,this.verticesCount=u,this.indexStart=p,this.indexCount=l,this._materialDefines=null,this._materialEffect=null,this._effectOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=h,this._renderingMesh=t||h,i&&h.subMeshes.push(this),this._trianglePlanes=[],this._id=h.subMeshes.length-1,e&&(this.refreshBoundingInfo(),h.computeWorldMatrix(!0))}return Object.defineProperty(a.prototype,"materialDefines",{get:function(){return this._materialDefines},set:function(_){this._materialDefines=_},enumerable:!1,configurable:!0}),a.prototype._getCustomEffect=function(_,s){s===void 0&&(s=!0),this._customEffects||(this._customEffects={});var u=this._customEffects[_];return!u&&s&&(this._customEffects[_]=u={effect:void 0,defines:void 0}),u},a.prototype._removeCustomEffect=function(_){delete this._customEffects[_]},Object.defineProperty(a.prototype,"effect",{get:function(){var _;return(_=this._effectOverride)!==null&&_!==void 0?_:this._materialEffect},enumerable:!1,configurable:!0}),a.prototype.setEffect=function(_,s){if(s===void 0&&(s=null),this._materialEffect===_){_||(this._materialDefines=null);return}this._materialDefines=s,this._materialEffect=_},a.AddToMesh=function(_,s,u,p,l,h,t,e){return e===void 0&&(e=!0),new a(_,s,u,p,l,h,t,e)},Object.defineProperty(a.prototype,"IsGlobal",{get:function(){return this.verticesStart===0&&this.verticesCount===this._mesh.getTotalVertices()},enumerable:!1,configurable:!0}),a.prototype.getBoundingInfo=function(){return this.IsGlobal?this._mesh.getBoundingInfo():this._boundingInfo},a.prototype.setBoundingInfo=function(_){return this._boundingInfo=_,this},a.prototype.getMesh=function(){return this._mesh},a.prototype.getRenderingMesh=function(){return this._renderingMesh},a.prototype.getReplacementMesh=function(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null},a.prototype.getEffectiveMesh=function(){var _=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return _||this._renderingMesh},a.prototype.getMaterial=function(){var _=this._renderingMesh.material;if(_==null)return this._mesh.getScene().defaultMaterial;if(this._IsMultiMaterial(_)){var s=_.getSubMaterial(this.materialIndex);return this._currentMaterial!==s&&(this._currentMaterial=s,this._materialDefines=null),s}return _},a.prototype._IsMultiMaterial=function(_){return _.getSubMaterial!==void 0},a.prototype.refreshBoundingInfo=function(_){if(_===void 0&&(_=null),this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.geometry)return this;if(_||(_=this._renderingMesh.getVerticesData(P.b.PositionKind)),!_)return this._boundingInfo=this._mesh.getBoundingInfo(),this;var s=this._renderingMesh.getIndices(),u;if(this.indexStart===0&&this.indexCount===s.length){var p=this._renderingMesh.getBoundingInfo();u={minimum:p.minimum.clone(),maximum:p.maximum.clone()}}else u=Object(n.b)(_,s,this.indexStart,this.indexCount,this._renderingMesh.geometry.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(u.minimum,u.maximum):this._boundingInfo=new m.a(u.minimum,u.maximum),this},a.prototype._checkCollision=function(_){var s=this.getBoundingInfo();return s._checkCollision(_)},a.prototype.updateBoundingInfo=function(_){var s=this.getBoundingInfo();return s||(this.refreshBoundingInfo(),s=this.getBoundingInfo()),s&&s.update(_),this},a.prototype.isInFrustum=function(_){var s=this.getBoundingInfo();return s?s.isInFrustum(_,this._mesh.cullingStrategy):!1},a.prototype.isCompletelyInFrustum=function(_){var s=this.getBoundingInfo();return s?s.isCompletelyInFrustum(_):!1},a.prototype.render=function(_){return this._renderingMesh.render(this,_,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this},a.prototype._getLinesIndexBuffer=function(_,s){if(!this._linesIndexBuffer){for(var u=[],p=this.indexStart;p<this.indexStart+this.indexCount;p+=3)u.push(_[p],_[p+1],_[p+1],_[p+2],_[p+2],_[p]);this._linesIndexBuffer=s.createIndexBuffer(u),this._linesIndexCount=u.length}return this._linesIndexBuffer},a.prototype.canIntersects=function(_){var s=this.getBoundingInfo();return s?_.intersectsBox(s.boundingBox):!1},a.prototype.intersects=function(_,s,u,p,l){var h=this.getMaterial();if(!h)return null;var t=3,e=!1;switch(h.fillMode){case 3:case 4:case 5:case 6:case 8:return null;case 7:t=1,e=!0;break;default:break}return this._mesh.getClassName()==="InstancedLinesMesh"||this._mesh.getClassName()==="LinesMesh"?u.length?this._intersectLines(_,s,u,this._mesh.intersectionThreshold,p):this._intersectUnIndexedLines(_,s,u,this._mesh.intersectionThreshold,p):!u.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(_,s,u,p,l):this._intersectTriangles(_,s,u,t,e,p,l)},a.prototype._intersectLines=function(_,s,u,p,l){for(var h=null,t=this.indexStart;t<this.indexStart+this.indexCount;t+=2){var e=s[u[t]],i=s[u[t+1]],r=_.intersectionSegment(e,i,p);if(!(r<0)&&(l||!h||r<h.distance)&&(h=new d.a(null,null,r),h.faceId=t/2,l))break}return h},a.prototype._intersectUnIndexedLines=function(_,s,u,p,l){for(var h=null,t=this.verticesStart;t<this.verticesStart+this.verticesCount;t+=2){var e=s[t],i=s[t+1],r=_.intersectionSegment(e,i,p);if(!(r<0)&&(l||!h||r<h.distance)&&(h=new d.a(null,null,r),h.faceId=t/2,l))break}return h},a.prototype._intersectTriangles=function(_,s,u,p,l,h,t){for(var e=null,i=-1,r=this.indexStart;r<this.indexStart+this.indexCount;r+=p){i++;var o=u[r],g=u[r+1],y=u[r+2];if(l&&y===4294967295){r+=2;continue}var v=s[o],f=s[g],b=s[y];if(!(t&&!t(v,f,b,_))){var T=_.intersectsTriangle(v,f,b);if(T){if(T.distance<0)continue;if((h||!e||T.distance<e.distance)&&(e=T,e.faceId=i,h))break}}}return e},a.prototype._intersectUnIndexedTriangles=function(_,s,u,p,l){for(var h=null,t=this.verticesStart;t<this.verticesStart+this.verticesCount;t+=3){var e=s[t],i=s[t+1],r=s[t+2];if(!(l&&!l(e,i,r,_))){var o=_.intersectsTriangle(e,i,r);if(o){if(o.distance<0)continue;if((p||!h||o.distance<h.distance)&&(h=o,h.faceId=t/3,p))break}}}return h},a.prototype._rebuild=function(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)},a.prototype.clone=function(_,s){var u=new a(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,_,s,!1);if(!this.IsGlobal){var p=this.getBoundingInfo();if(!p)return u;u._boundingInfo=new m.a(p.minimum,p.maximum)}return u},a.prototype.dispose=function(){this._linesIndexBuffer&&(this._mesh.getScene().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);var _=this._mesh.subMeshes.indexOf(this);this._mesh.subMeshes.splice(_,1)},a.prototype.getClassName=function(){return"SubMesh"},a.CreateFromIndices=function(_,s,u,p,l){for(var h=Number.MAX_VALUE,t=-Number.MAX_VALUE,e=l||p,i=e.getIndices(),r=s;r<s+u;r++){var o=i[r];o<h&&(h=o),o>t&&(t=o)}return new a(_,h,t-h+1,s,u,p,l)},a}()},,,function($,W,M){"use strict";M.d(W,"a",function(){return d}),M.d(W,"b",function(){return m}),M.d(W,"c",function(){return n});var P=M(434),d=function(){function c(){}return c.KEYDOWN=1,c.KEYUP=2,c}(),m=function(){function c(a,_){this.type=a,this.event=_}return c}(),n=function(c){Object(P.d)(a,c);function a(_,s){var u=c.call(this,_,s)||this;return u.type=_,u.event=s,u.skipOnPointerObservable=!1,u}return a}(m)},function($,W,M){"use strict";M.d(W,"a",function(){return P});var P=function(){function d(){this.references=0,this.capacity=0,this.is32Bits=!1,this.uniqueId=d._Counter++}return Object.defineProperty(d.prototype,"underlyingResource",{get:function(){return null},enumerable:!1,configurable:!0}),d._Counter=0,d}()},,,,,,,,,,,,,,,,,,,,,,,,,function($,W,M){"use strict";M.d(W,"a",function(){return P});var P=function(){function d(){}return d.BuildArray=function(m,n){for(var c=[],a=0;a<m;++a)c.push(n());return c},d}()},function($,W,M){"use strict";M.d(W,"a",function(){return d});var P=M(660),d=function(){function m(){}return Object.defineProperty(m,"Now",{get:function(){return P.a.IsWindowObjectExist()&&window.performance&&window.performance.now?window.performance.now():Date.now()},enumerable:!1,configurable:!0}),m}()},function($,W,M){"use strict";M.d(W,"a",function(){return d});var P=M(447),d=function(){function m(n){this._vertexBuffers={},this._scene=n}return m.prototype._prepareBuffers=function(){if(!this._vertexBuffers[P.b.PositionKind]){var n=[];n.push(1,1),n.push(-1,1),n.push(-1,-1),n.push(1,-1),this._vertexBuffers[P.b.PositionKind]=new P.b(this._scene.getEngine(),n,P.b.PositionKind,!1,!1,2),this._buildIndexBuffer()}},m.prototype._buildIndexBuffer=function(){var n=[];n.push(0),n.push(1),n.push(2),n.push(0),n.push(2),n.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(n)},m.prototype._rebuild=function(){var n=this._vertexBuffers[P.b.PositionKind];!n||(n._rebuild(),this._buildIndexBuffer())},m.prototype._prepareFrame=function(n,c){n===void 0&&(n=null),c===void 0&&(c=null);var a=this._scene.activeCamera;return!a||(c=c||a._postProcesses.filter(function(_){return _!=null}),!c||c.length===0||!this._scene.postProcessesEnabled)?!1:(c[0].activate(a,n,c!=null),!0)},m.prototype.directRender=function(n,c,a,_,s,u){c===void 0&&(c=null),a===void 0&&(a=!1),_===void 0&&(_=0),s===void 0&&(s=0),u===void 0&&(u=!1);for(var p=this._scene.getEngine(),l=0;l<n.length;l++){l<n.length-1?n[l+1].activate(this._scene.activeCamera,c):(c?p.bindFramebuffer(c,_,void 0,void 0,a,s):u||p.restoreDefaultFramebuffer(),p._debugInsertMarker("post process "+n[l].name+" output"));var h=n[l],t=h.apply();t&&(h.onBeforeRenderObservable.notifyObservers(t),this._prepareBuffers(),p.bindBuffers(this._vertexBuffers,this._indexBuffer,t),p.drawElementsType(0,0,6),h.onAfterRenderObservable.notifyObservers(t))}p.setDepthBuffer(!0),p.setDepthWrite(!0)},m.prototype._finalizeFrame=function(n,c,a,_,s){s===void 0&&(s=!1);var u=this._scene.activeCamera;if(!!u&&(_=_||u._postProcesses.filter(function(i){return i!=null}),!(_.length===0||!this._scene.postProcessesEnabled))){for(var p=this._scene.getEngine(),l=0,h=_.length;l<h;l++){var t=_[l];if(l<h-1?t._outputTexture=_[l+1].activate(u,c):(c?(p.bindFramebuffer(c,a,void 0,void 0,s),t._outputTexture=c):(p.restoreDefaultFramebuffer(),t._outputTexture=null),p._debugInsertMarker("post process "+_[l].name+" output")),n)break;var e=t.apply();e&&(t.onBeforeRenderObservable.notifyObservers(e),this._prepareBuffers(),p.bindBuffers(this._vertexBuffers,this._indexBuffer,e),p.drawElementsType(0,0,6),t.onAfterRenderObservable.notifyObservers(e))}p.setDepthBuffer(!0),p.setDepthWrite(!0),p.setAlphaMode(0)}},m.prototype.dispose=function(){var n=this._vertexBuffers[P.b.PositionKind];n&&(n.dispose(),this._vertexBuffers[P.b.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)},m}()},function($,W,M){"use strict";M.d(W,"a",function(){return d}),M.d(W,"b",function(){return m});var P=M(720),d=function(){function n(){}return n}(),m=function(){function n(c){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new d,this._scene=c;for(var a=n.MIN_RENDERINGGROUPS;a<n.MAX_RENDERINGGROUPS;a++)this._autoClearDepthStencil[a]={autoClear:!0,depth:!0,stencil:!0}}return n.prototype._clearDepthStencilBuffer=function(c,a){c===void 0&&(c=!0),a===void 0&&(a=!0),!this._depthStencilBufferAlreadyCleaned&&(this._scene.getEngine().clear(null,!1,c,a),this._depthStencilBufferAlreadyCleaned=!0)},n.prototype.render=function(c,a,_,s){var u=this._renderingGroupInfo;if(u.scene=this._scene,u.camera=this._scene.activeCamera,this._scene.spriteManagers&&s)for(var p=0;p<this._scene.spriteManagers.length;p++){var l=this._scene.spriteManagers[p];this.dispatchSprites(l)}for(var p=n.MIN_RENDERINGGROUPS;p<n.MAX_RENDERINGGROUPS;p++){this._depthStencilBufferAlreadyCleaned=p===n.MIN_RENDERINGGROUPS;var h=this._renderingGroups[p];if(!!h){var t=Math.pow(2,p);if(u.renderingGroupId=p,this._scene.onBeforeRenderingGroupObservable.notifyObservers(u,t),n.AUTOCLEAR){var e=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(p):this._autoClearDepthStencil[p];e&&e.autoClear&&this._clearDepthStencilBuffer(e.depth,e.stencil)}for(var i=0,r=this._scene._beforeRenderingGroupDrawStage;i<r.length;i++){var o=r[i];o.action(p)}h.render(c,s,_,a);for(var g=0,y=this._scene._afterRenderingGroupDrawStage;g<y.length;g++){var o=y[g];o.action(p)}this._scene.onAfterRenderingGroupObservable.notifyObservers(u,t)}}},n.prototype.reset=function(){for(var c=n.MIN_RENDERINGGROUPS;c<n.MAX_RENDERINGGROUPS;c++){var a=this._renderingGroups[c];a&&a.prepare()}},n.prototype.dispose=function(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null},n.prototype.freeRenderingGroups=function(){for(var c=n.MIN_RENDERINGGROUPS;c<n.MAX_RENDERINGGROUPS;c++){var a=this._renderingGroups[c];a&&a.dispose()}},n.prototype._prepareRenderingGroup=function(c){this._renderingGroups[c]===void 0&&(this._renderingGroups[c]=new P.a(c,this._scene,this._customOpaqueSortCompareFn[c],this._customAlphaTestSortCompareFn[c],this._customTransparentSortCompareFn[c]))},n.prototype.dispatchSprites=function(c){var a=c.renderingGroupId||0;this._prepareRenderingGroup(a),this._renderingGroups[a].dispatchSprites(c)},n.prototype.dispatchParticles=function(c){var a=c.renderingGroupId||0;this._prepareRenderingGroup(a),this._renderingGroups[a].dispatchParticles(c)},n.prototype.dispatch=function(c,a,_){a===void 0&&(a=c.getMesh());var s=a.renderingGroupId||0;this._prepareRenderingGroup(s),this._renderingGroups[s].dispatch(c,a,_)},n.prototype.setRenderingOrder=function(c,a,_,s){if(a===void 0&&(a=null),_===void 0&&(_=null),s===void 0&&(s=null),this._customOpaqueSortCompareFn[c]=a,this._customAlphaTestSortCompareFn[c]=_,this._customTransparentSortCompareFn[c]=s,this._renderingGroups[c]){var u=this._renderingGroups[c];u.opaqueSortCompareFn=this._customOpaqueSortCompareFn[c],u.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[c],u.transparentSortCompareFn=this._customTransparentSortCompareFn[c]}},n.prototype.setRenderingAutoClearDepthStencil=function(c,a,_,s){_===void 0&&(_=!0),s===void 0&&(s=!0),this._autoClearDepthStencil[c]={autoClear:a,depth:_,stencil:s}},n.prototype.getAutoClearDepthStencilSetup=function(c){return this._autoClearDepthStencil[c]},n.MAX_RENDERINGGROUPS=4,n.MIN_RENDERINGGROUPS=0,n.AUTOCLEAR=!0,n}()},function($,W,M){"use strict";var P=M(435),d="clipPlaneFragmentDeclaration",m=`#ifdef CLIPPLANE
varying float fClipDistance;
#endif
#ifdef CLIPPLANE2
varying float fClipDistance2;
#endif
#ifdef CLIPPLANE3
varying float fClipDistance3;
#endif
#ifdef CLIPPLANE4
varying float fClipDistance4;
#endif
#ifdef CLIPPLANE5
varying float fClipDistance5;
#endif
#ifdef CLIPPLANE6
varying float fClipDistance6;
#endif`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},function($,W,M){"use strict";var P=M(435),d="clipPlaneVertexDeclaration",m=`#ifdef CLIPPLANE
uniform vec4 vClipPlane;
varying float fClipDistance;
#endif
#ifdef CLIPPLANE2
uniform vec4 vClipPlane2;
varying float fClipDistance2;
#endif
#ifdef CLIPPLANE3
uniform vec4 vClipPlane3;
varying float fClipDistance3;
#endif
#ifdef CLIPPLANE4
uniform vec4 vClipPlane4;
varying float fClipDistance4;
#endif
#ifdef CLIPPLANE5
uniform vec4 vClipPlane5;
varying float fClipDistance5;
#endif
#ifdef CLIPPLANE6
uniform vec4 vClipPlane6;
varying float fClipDistance6;
#endif`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},,function($,W,M){"use strict";M.d(W,"a",function(){return P});var P=function(){function d(){}return d}()},function($,W,M){"use strict";M.d(W,"a",function(){return P});var P=function(){function d(){}return d.CreateCanvas=function(m,n){if(typeof document=="undefined")return new OffscreenCanvas(m,n);var c=document.createElement("canvas");return c.width=m,c.height=n,c},d}()},function($,W,M){"use strict";var P=M(435),d="fogFragmentDeclaration",m=`#ifdef FOG
#define FOGMODE_NONE 0.
#define FOGMODE_EXP 1.
#define FOGMODE_EXP2 2.
#define FOGMODE_LINEAR 3.
#define E 2.71828
uniform vec4 vFogInfos;
uniform vec3 vFogColor;
varying vec3 vFogDistance;
float CalcFogFactor()
{
float fogCoeff=1.0;
float fogStart=vFogInfos.y;
float fogEnd=vFogInfos.z;
float fogDensity=vFogInfos.w;
float fogDistance=length(vFogDistance);
if (FOGMODE_LINEAR == vFogInfos.x)
{
fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);
}
else if (FOGMODE_EXP == vFogInfos.x)
{
fogCoeff=1.0/pow(E,fogDistance*fogDensity);
}
else if (FOGMODE_EXP2 == vFogInfos.x)
{
fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);
}
return clamp(fogCoeff,0.0,1.0);
}
#endif`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},,,,,,function($,W,M){"use strict";M.d(W,"a",function(){return d});var P=M(436),d=function(){function m(n,c,a,_){this.normal=new P.e(n,c,a),this.d=_}return m.prototype.asArray=function(){return[this.normal.x,this.normal.y,this.normal.z,this.d]},m.prototype.clone=function(){return new m(this.normal.x,this.normal.y,this.normal.z,this.d)},m.prototype.getClassName=function(){return"Plane"},m.prototype.getHashCode=function(){var n=this.normal.getHashCode();return n=n*397^(this.d|0),n},m.prototype.normalize=function(){var n=Math.sqrt(this.normal.x*this.normal.x+this.normal.y*this.normal.y+this.normal.z*this.normal.z),c=0;return n!==0&&(c=1/n),this.normal.x*=c,this.normal.y*=c,this.normal.z*=c,this.d*=c,this},m.prototype.transform=function(n){var c=m._TmpMatrix;n.invertToRef(c);var a=c.m,_=this.normal.x,s=this.normal.y,u=this.normal.z,p=this.d,l=_*a[0]+s*a[1]+u*a[2]+p*a[3],h=_*a[4]+s*a[5]+u*a[6]+p*a[7],t=_*a[8]+s*a[9]+u*a[10]+p*a[11],e=_*a[12]+s*a[13]+u*a[14]+p*a[15];return new m(l,h,t,e)},m.prototype.dotCoordinate=function(n){return this.normal.x*n.x+this.normal.y*n.y+this.normal.z*n.z+this.d},m.prototype.copyFromPoints=function(n,c,a){var _=c.x-n.x,s=c.y-n.y,u=c.z-n.z,p=a.x-n.x,l=a.y-n.y,h=a.z-n.z,t=s*h-u*l,e=u*p-_*h,i=_*l-s*p,r=Math.sqrt(t*t+e*e+i*i),o;return r!==0?o=1/r:o=0,this.normal.x=t*o,this.normal.y=e*o,this.normal.z=i*o,this.d=-(this.normal.x*n.x+this.normal.y*n.y+this.normal.z*n.z),this},m.prototype.isFrontFacingTo=function(n,c){var a=P.e.Dot(this.normal,n);return a<=c},m.prototype.signedDistanceTo=function(n){return P.e.Dot(n,this.normal)+this.d},m.FromArray=function(n){return new m(n[0],n[1],n[2],n[3])},m.FromPoints=function(n,c,a){var _=new m(0,0,0,0);return _.copyFromPoints(n,c,a),_},m.FromPositionAndNormal=function(n,c){var a=new m(0,0,0,0);return c.normalize(),a.normal=c,a.d=-(c.x*n.x+c.y*n.y+c.z*n.z),a},m.SignedDistanceToPlaneFromPositionAndNormal=function(n,c,a){var _=-(c.x*n.x+c.y*n.y+c.z*n.z);return P.e.Dot(a,c)+_},m._TmpMatrix=P.a.Identity(),m}()},,,,,,,,function($,W,M){"use strict";M.d(W,"a",function(){return P});var P=function(){function d(){}return d.FilesToLoad={},d}()},function($,W,M){"use strict";M.d(W,"a",function(){return d});var P=M(589),d=function(){function m(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}return Object.defineProperty(m.prototype,"min",{get:function(){return this._min},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"max",{get:function(){return this._max},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"average",{get:function(){return this._average},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"lastSecAverage",{get:function(){return this._lastSecAverage},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"current",{get:function(){return this._current},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"total",{get:function(){return this._totalAccumulated},enumerable:!1,configurable:!0}),Object.defineProperty(m.prototype,"count",{get:function(){return this._totalValueCount},enumerable:!1,configurable:!0}),m.prototype.fetchNewFrame=function(){this._totalValueCount++,this._current=0,this._lastSecValueCount++},m.prototype.addCount=function(n,c){!m.Enabled||(this._current+=n,c&&this._fetchResult())},m.prototype.beginMonitoring=function(){!m.Enabled||(this._startMonitoringTime=P.a.Now)},m.prototype.endMonitoring=function(n){if(n===void 0&&(n=!0),!!m.Enabled){n&&this.fetchNewFrame();var c=P.a.Now;this._current=c-this._startMonitoringTime,n&&this._fetchResult()}},m.prototype._fetchResult=function(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;var n=P.a.Now;n-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=n,this._lastSecAccumulated=0,this._lastSecValueCount=0)},m.Enabled=!0,m}()},function($,W,M){"use strict";M.d(W,"f",function(){return m}),M.d(W,"d",function(){return n}),M.d(W,"a",function(){return c}),M.d(W,"c",function(){return a}),M.d(W,"e",function(){return _}),M.d(W,"g",function(){return s}),M.d(W,"h",function(){return u}),M.d(W,"i",function(){return p}),M.d(W,"j",function(){return l}),M.d(W,"k",function(){return h}),M.d(W,"l",function(){return t}),M.d(W,"m",function(){return e}),M.d(W,"b",function(){return i});var P=M(434),d=M(756),m=function(){function r(){this._easingMode=r.EASINGMODE_EASEIN}return r.prototype.setEasingMode=function(o){var g=Math.min(Math.max(o,0),2);this._easingMode=g},r.prototype.getEasingMode=function(){return this._easingMode},r.prototype.easeInCore=function(o){throw new Error("You must implement this method")},r.prototype.ease=function(o){switch(this._easingMode){case r.EASINGMODE_EASEIN:return this.easeInCore(o);case r.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-o)}return o>=.5?(1-this.easeInCore((1-o)*2))*.5+.5:this.easeInCore(o*2)*.5},r.EASINGMODE_EASEIN=0,r.EASINGMODE_EASEOUT=1,r.EASINGMODE_EASEINOUT=2,r}(),n=function(r){Object(P.d)(o,r);function o(){return r!==null&&r.apply(this,arguments)||this}return o.prototype.easeInCore=function(g){return g=Math.max(0,Math.min(1,g)),1-Math.sqrt(1-g*g)},o}(m),c=function(r){Object(P.d)(o,r);function o(g){g===void 0&&(g=1);var y=r.call(this)||this;return y.amplitude=g,y}return o.prototype.easeInCore=function(g){var y=Math.max(0,this.amplitude);return Math.pow(g,3)-g*y*Math.sin(3.141592653589793*g)},o}(m),a=function(r){Object(P.d)(o,r);function o(g,y){g===void 0&&(g=3),y===void 0&&(y=2);var v=r.call(this)||this;return v.bounces=g,v.bounciness=y,v}return o.prototype.easeInCore=function(g){var y=Math.max(0,this.bounces),v=this.bounciness;v<=1&&(v=1.001);var f=Math.pow(v,y),b=1-v,T=(1-f)/b+f*.5,E=g*T,O=Math.log(-E*(1-v)+1)/Math.log(v),D=Math.floor(O),F=D+1,x=(1-Math.pow(v,D))/(b*T),j=(1-Math.pow(v,F))/(b*T),V=(x+j)*.5,z=g-V,w=V-x;return-Math.pow(1/v,y-D)/(w*w)*(z-w)*(z+w)},o}(m),_=function(r){Object(P.d)(o,r);function o(){return r!==null&&r.apply(this,arguments)||this}return o.prototype.easeInCore=function(g){return g*g*g},o}(m),s=function(r){Object(P.d)(o,r);function o(g,y){g===void 0&&(g=3),y===void 0&&(y=3);var v=r.call(this)||this;return v.oscillations=g,v.springiness=y,v}return o.prototype.easeInCore=function(g){var y,v=Math.max(0,this.oscillations),f=Math.max(0,this.springiness);return f==0?y=g:y=(Math.exp(f*g)-1)/(Math.exp(f)-1),y*Math.sin((6.283185307179586*v+1.5707963267948966)*g)},o}(m),u=function(r){Object(P.d)(o,r);function o(g){g===void 0&&(g=2);var y=r.call(this)||this;return y.exponent=g,y}return o.prototype.easeInCore=function(g){return this.exponent<=0?g:(Math.exp(this.exponent*g)-1)/(Math.exp(this.exponent)-1)},o}(m),p=function(r){Object(P.d)(o,r);function o(g){g===void 0&&(g=2);var y=r.call(this)||this;return y.power=g,y}return o.prototype.easeInCore=function(g){var y=Math.max(0,this.power);return Math.pow(g,y)},o}(m),l=function(r){Object(P.d)(o,r);function o(){return r!==null&&r.apply(this,arguments)||this}return o.prototype.easeInCore=function(g){return g*g},o}(m),h=function(r){Object(P.d)(o,r);function o(){return r!==null&&r.apply(this,arguments)||this}return o.prototype.easeInCore=function(g){return g*g*g*g},o}(m),t=function(r){Object(P.d)(o,r);function o(){return r!==null&&r.apply(this,arguments)||this}return o.prototype.easeInCore=function(g){return g*g*g*g*g},o}(m),e=function(r){Object(P.d)(o,r);function o(){return r!==null&&r.apply(this,arguments)||this}return o.prototype.easeInCore=function(g){return 1-Math.sin(1.5707963267948966*(1-g))},o}(m),i=function(r){Object(P.d)(o,r);function o(g,y,v,f){g===void 0&&(g=0),y===void 0&&(y=0),v===void 0&&(v=1),f===void 0&&(f=1);var b=r.call(this)||this;return b.x1=g,b.y1=y,b.x2=v,b.y2=f,b}return o.prototype.easeInCore=function(g){return d.c.Interpolate(g,this.x1,this.y1,this.x2,this.y2)},o}(m)},function($,W,M){"use strict";var P=M(435),d="bumpFragmentMainFunctions",m=`#if defined(BUMP) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC) || defined(DETAIL)
#if defined(TANGENT) && defined(NORMAL)
varying mat3 vTBN;
#endif
#ifdef OBJECTSPACE_NORMALMAP
uniform mat4 normalMatrix;
#endif
vec3 perturbNormalBase(mat3 cotangentFrame,vec3 normal,float scale)
{
#ifdef NORMALXYSCALE
normal=normalize(normal*vec3(scale,scale,1.0));
#endif
return normalize(cotangentFrame*normal);
}
vec3 perturbNormal(mat3 cotangentFrame,vec3 textureSample,float scale)
{
return perturbNormalBase(cotangentFrame,textureSample*2.0-1.0,scale);
}

mat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv,vec2 tangentSpaceParams)
{

vec3 dp1=dFdx(p);
vec3 dp2=dFdy(p);
vec2 duv1=dFdx(uv);
vec2 duv2=dFdy(uv);

vec3 dp2perp=cross(dp2,normal);
vec3 dp1perp=cross(normal,dp1);
vec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;
vec3 bitangent=dp2perp*duv1.y+dp1perp*duv2.y;

tangent*=tangentSpaceParams.x;
bitangent*=tangentSpaceParams.y;

float invmax=inversesqrt(max(dot(tangent,tangent),dot(bitangent,bitangent)));
return mat3(tangent*invmax,bitangent*invmax,normal);
}
#endif
`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},function($,W,M){"use strict";var P=M(435),d="bumpFragmentFunctions",m=`#if defined(BUMP)
#if BUMPDIRECTUV == 1
#define vBumpUV vMainUV1
#elif BUMPDIRECTUV == 2
#define vBumpUV vMainUV2
#else
varying vec2 vBumpUV;
#endif
uniform sampler2D bumpSampler;
vec3 perturbNormal(mat3 cotangentFrame,vec2 uv)
{
return perturbNormal(cotangentFrame,texture2D(bumpSampler,uv).xyz,vBumpInfos.y);
}
#endif
#if defined(DETAIL)
#if DETAILDIRECTUV == 1
#define vDetailUV vMainUV1
#elif DETAILDIRECTUV == 2
#define vDetailUV vMainUV2
#else
varying vec2 vDetailUV;
#endif
uniform sampler2D detailSampler;
#endif
#if defined(BUMP)
vec3 perturbNormal(mat3 cotangentFrame,vec3 color)
{
return perturbNormal(cotangentFrame,color,vBumpInfos.y);
}

mat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv)
{
return cotangent_frame(normal,p,uv,vTangentSpaceParams);
}
#endif
#if defined(BUMP) && defined(PARALLAX)
const float minSamples=4.;
const float maxSamples=15.;
const int iMaxSamples=15;

vec2 parallaxOcclusion(vec3 vViewDirCoT,vec3 vNormalCoT,vec2 texCoord,float parallaxScale) {
float parallaxLimit=length(vViewDirCoT.xy)/vViewDirCoT.z;
parallaxLimit*=parallaxScale;
vec2 vOffsetDir=normalize(vViewDirCoT.xy);
vec2 vMaxOffset=vOffsetDir*parallaxLimit;
float numSamples=maxSamples+(dot(vViewDirCoT,vNormalCoT)*(minSamples-maxSamples));
float stepSize=1.0/numSamples;

float currRayHeight=1.0;
vec2 vCurrOffset=vec2(0,0);
vec2 vLastOffset=vec2(0,0);
float lastSampledHeight=1.0;
float currSampledHeight=1.0;
for (int i=0; i<iMaxSamples; i++)
{
currSampledHeight=texture2D(bumpSampler,vBumpUV+vCurrOffset).w;

if (currSampledHeight>currRayHeight)
{
float delta1=currSampledHeight-currRayHeight;
float delta2=(currRayHeight+stepSize)-lastSampledHeight;
float ratio=delta1/(delta1+delta2);
vCurrOffset=(ratio)* vLastOffset+(1.0-ratio)*vCurrOffset;

break;
}
else
{
currRayHeight-=stepSize;
vLastOffset=vCurrOffset;
vCurrOffset+=stepSize*vMaxOffset;
lastSampledHeight=currSampledHeight;
}
}
return vCurrOffset;
}
vec2 parallaxOffset(vec3 viewDir,float heightScale)
{

float height=texture2D(bumpSampler,vBumpUV).w;
vec2 texCoordOffset=heightScale*viewDir.xy*height;
return -texCoordOffset;
}
#endif`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},function($,W,M){"use strict";var P=M(435),d="bumpFragment",m=`vec2 uvOffset=vec2(0.0,0.0);
#if defined(BUMP) || defined(PARALLAX) || defined(DETAIL)
#ifdef NORMALXYSCALE
float normalScale=1.0;
#elif defined(BUMP)
float normalScale=vBumpInfos.y;
#else
float normalScale=1.0;
#endif
#if defined(TANGENT) && defined(NORMAL)
mat3 TBN=vTBN;
#elif defined(BUMP)

vec2 TBNUV=gl_FrontFacing ? vBumpUV : -vBumpUV;
mat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,TBNUV);
#else

vec2 TBNUV=gl_FrontFacing ? vDetailUV : -vDetailUV;
mat3 TBN=cotangent_frame(normalW*normalScale,vPositionW,TBNUV,vec2(1.,1.));
#endif
#elif defined(ANISOTROPIC)
#if defined(TANGENT) && defined(NORMAL)
mat3 TBN=vTBN;
#else

vec2 TBNUV=gl_FrontFacing ? vMainUV1 : -vMainUV1;
mat3 TBN=cotangent_frame(normalW,vPositionW,TBNUV,vec2(1.,1.));
#endif
#endif
#ifdef PARALLAX
mat3 invTBN=transposeMat3(TBN);
#ifdef PARALLAXOCCLUSION
uvOffset=parallaxOcclusion(invTBN*-viewDirectionW,invTBN*normalW,vBumpUV,vBumpInfos.z);
#else
uvOffset=parallaxOffset(invTBN*viewDirectionW,vBumpInfos.z);
#endif
#endif
#ifdef DETAIL
vec4 detailColor=texture2D(detailSampler,vDetailUV+uvOffset);
vec2 detailNormalRG=detailColor.wy*2.0-1.0;
float detailNormalB=sqrt(1.-saturate(dot(detailNormalRG,detailNormalRG)));
vec3 detailNormal=vec3(detailNormalRG,detailNormalB);
#endif
#ifdef BUMP
#ifdef OBJECTSPACE_NORMALMAP
normalW=normalize(texture2D(bumpSampler,vBumpUV).xyz*2.0-1.0);
normalW=normalize(mat3(normalMatrix)*normalW);
#elif !defined(DETAIL)
normalW=perturbNormal(TBN,vBumpUV+uvOffset);
#else
vec3 bumpNormal=texture2D(bumpSampler,vBumpUV+uvOffset).xyz*2.0-1.0;

#if DETAIL_NORMALBLENDMETHOD == 0
detailNormal.xy*=vDetailInfos.z;
vec3 blendedNormal=normalize(vec3(bumpNormal.xy+detailNormal.xy,bumpNormal.z*detailNormal.z));
#elif DETAIL_NORMALBLENDMETHOD == 1
detailNormal.xy*=vDetailInfos.z;
bumpNormal+=vec3(0.0,0.0,1.0);
detailNormal*=vec3(-1.0,-1.0,1.0);
vec3 blendedNormal=bumpNormal*dot(bumpNormal,detailNormal)/bumpNormal.z-detailNormal;
#endif
normalW=perturbNormalBase(TBN,blendedNormal,vBumpInfos.y);
#endif
#elif defined(DETAIL)
detailNormal.xy*=vDetailInfos.z;
normalW=perturbNormalBase(TBN,detailNormal,vDetailInfos.z);
#endif`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},,,,,function($,W,M){"use strict";var P=M(467);P.a.prototype.setAlphaConstants=function(d,m,n,c){this._alphaState.setAlphaBlendConstants(d,m,n,c)},P.a.prototype.setAlphaMode=function(d,m){if(m===void 0&&(m=!1),this._alphaMode!==d){switch(d){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break}m||(this.depthCullingState.depthMask=d===0),this._alphaMode=d}},P.a.prototype.getAlphaMode=function(){return this._alphaMode},P.a.prototype.setAlphaEquation=function(d){if(this._alphaEquation!==d){switch(d){case 0:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_ADD,this._gl.FUNC_ADD);break;case 1:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_SUBTRACT,this._gl.FUNC_SUBTRACT);break;case 2:this._alphaState.setAlphaEquationParameters(this._gl.FUNC_REVERSE_SUBTRACT,this._gl.FUNC_REVERSE_SUBTRACT);break;case 3:this._alphaState.setAlphaEquationParameters(this._gl.MAX,this._gl.MAX);break;case 4:this._alphaState.setAlphaEquationParameters(this._gl.MIN,this._gl.MIN);break;case 5:this._alphaState.setAlphaEquationParameters(this._gl.MIN,this._gl.FUNC_ADD);break}this._alphaEquation=d}},P.a.prototype.getAlphaEquation=function(){return this._alphaEquation}},function($,W,M){"use strict";var P=M(467);P.a.prototype.updateDynamicIndexBuffer=function(d,m,n){n===void 0&&(n=0),this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(d);var c;m instanceof Uint16Array||m instanceof Uint32Array?c=m:c=d.is32Bits?new Uint32Array(m):new Uint16Array(m),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,c,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},P.a.prototype.updateDynamicVertexBuffer=function(d,m,n,c){this.bindArrayBuffer(d),n===void 0&&(n=0);var a=m.length||m.byteLength;c===void 0||c>=a&&n===0?m instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,n,new Float32Array(m)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,n,m):m instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(m).subarray(n,n+c)):(m instanceof ArrayBuffer?m=new Uint8Array(m,n,c):m=new Uint8Array(m.buffer,m.byteOffset+n,c),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,m)),this._resetVertexBufferBinding()}},function($,W,M){"use strict";M.d(W,"a",function(){return a});var P=M(434),d=M(728),m=M(726),n=M(727),c=M(460),a=function(_){Object(P.d)(s,_);function s(u){return _.call(this,u)||this}return s.prototype.addMouseWheel=function(){return this.add(new n.a),this},s.prototype.addPointers=function(){return this.add(new d.a),this},s.prototype.addKeyboard=function(){return this.add(new m.a),this},s}(c.b)},,,,,,,,,,,,,,,,,,,,,,,,,,,function($,W,M){"use strict";var P=M(435),d="lightFragmentDeclaration",m=`#ifdef LIGHT{X}
uniform vec4 vLightData{X};
uniform vec4 vLightDiffuse{X};
#ifdef SPECULARTERM
uniform vec4 vLightSpecular{X};
#else
vec4 vLightSpecular{X}=vec4(0.);
#endif
#ifdef SHADOW{X}
#ifdef SHADOWCSM{X}
uniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float cascadeBlendFactor{X};
varying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];
varying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];
varying vec4 vPositionFromCamera{X};
#if defined(SHADOWPCSS{X})
uniform highp sampler2DArrayShadow shadowSampler{X};
uniform highp sampler2DArray depthSampler{X};
uniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float penumbraDarkness{X};
#elif defined(SHADOWPCF{X})
uniform highp sampler2DArrayShadow shadowSampler{X};
#else
uniform highp sampler2DArray shadowSampler{X};
#endif
#ifdef SHADOWCSMDEBUG{X}
const vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]
(
vec3 ( 1.5,0.0,0.0 ),
vec3 ( 0.0,1.5,0.0 ),
vec3 ( 0.0,0.0,5.5 ),
vec3 ( 1.5,0.0,5.5 ),
vec3 ( 1.5,1.5,0.0 ),
vec3 ( 1.0,1.0,1.0 ),
vec3 ( 0.0,1.0,5.5 ),
vec3 ( 0.5,3.5,0.75 )
);
vec3 shadowDebug{X};
#endif
#ifdef SHADOWCSMUSESHADOWMAXZ{X}
int index{X}=-1;
#else
int index{X}=SHADOWCSMNUM_CASCADES{X}-1;
#endif
float diff{X}=0.;
#elif defined(SHADOWCUBE{X})
uniform samplerCube shadowSampler{X};
#else
varying vec4 vPositionFromLight{X};
varying float vDepthMetric{X};
#if defined(SHADOWPCSS{X})
uniform highp sampler2DShadow shadowSampler{X};
uniform highp sampler2D depthSampler{X};
#elif defined(SHADOWPCF{X})
uniform highp sampler2DShadow shadowSampler{X};
#else
uniform sampler2D shadowSampler{X};
#endif
uniform mat4 lightMatrix{X};
#endif
uniform vec4 shadowsInfo{X};
uniform vec2 depthValues{X};
#endif
#ifdef SPOTLIGHT{X}
uniform vec4 vLightDirection{X};
uniform vec4 vLightFalloff{X};
#elif defined(POINTLIGHT{X})
uniform vec4 vLightFalloff{X};
#elif defined(HEMILIGHT{X})
uniform vec3 vLightGround{X};
#endif
#ifdef PROJECTEDLIGHTTEXTURE{X}
uniform mat4 textureProjectionMatrix{X};
uniform sampler2D projectionLightSampler{X};
#endif
#endif`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},function($,W,M){"use strict";var P=M(435),d="lightUboDeclaration",m=`#ifdef LIGHT{X}
uniform Light{X}
{
vec4 vLightData;
vec4 vLightDiffuse;
vec4 vLightSpecular;
#ifdef SPOTLIGHT{X}
vec4 vLightDirection;
vec4 vLightFalloff;
#elif defined(POINTLIGHT{X})
vec4 vLightFalloff;
#elif defined(HEMILIGHT{X})
vec3 vLightGround;
#endif
vec4 shadowsInfo;
vec2 depthValues;
} light{X};
#ifdef PROJECTEDLIGHTTEXTURE{X}
uniform mat4 textureProjectionMatrix{X};
uniform sampler2D projectionLightSampler{X};
#endif
#ifdef SHADOW{X}
#ifdef SHADOWCSM{X}
uniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float viewFrustumZ{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float frustumLengths{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float cascadeBlendFactor{X};
varying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];
varying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];
varying vec4 vPositionFromCamera{X};
#if defined(SHADOWPCSS{X})
uniform highp sampler2DArrayShadow shadowSampler{X};
uniform highp sampler2DArray depthSampler{X};
uniform vec2 lightSizeUVCorrection{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float depthCorrection{X}[SHADOWCSMNUM_CASCADES{X}];
uniform float penumbraDarkness{X};
#elif defined(SHADOWPCF{X})
uniform highp sampler2DArrayShadow shadowSampler{X};
#else
uniform highp sampler2DArray shadowSampler{X};
#endif
#ifdef SHADOWCSMDEBUG{X}
const vec3 vCascadeColorsMultiplier{X}[8]=vec3[8]
(
vec3 ( 1.5,0.0,0.0 ),
vec3 ( 0.0,1.5,0.0 ),
vec3 ( 0.0,0.0,5.5 ),
vec3 ( 1.5,0.0,5.5 ),
vec3 ( 1.5,1.5,0.0 ),
vec3 ( 1.0,1.0,1.0 ),
vec3 ( 0.0,1.0,5.5 ),
vec3 ( 0.5,3.5,0.75 )
);
vec3 shadowDebug{X};
#endif
#ifdef SHADOWCSMUSESHADOWMAXZ{X}
int index{X}=-1;
#else
int index{X}=SHADOWCSMNUM_CASCADES{X}-1;
#endif
float diff{X}=0.;
#elif defined(SHADOWCUBE{X})
uniform samplerCube shadowSampler{X};
#else
varying vec4 vPositionFromLight{X};
varying float vDepthMetric{X};
#if defined(SHADOWPCSS{X})
uniform highp sampler2DShadow shadowSampler{X};
uniform highp sampler2D depthSampler{X};
#elif defined(SHADOWPCF{X})
uniform highp sampler2DShadow shadowSampler{X};
#else
uniform sampler2D shadowSampler{X};
#endif
uniform mat4 lightMatrix{X};
#endif
#endif
#endif`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},function($,W,M){"use strict";var P=M(435),d="shadowsFragmentFunctions",m=`#ifdef SHADOWS
#ifndef SHADOWFLOAT

float unpack(vec4 color)
{
const vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);
return dot(color,bit_shift);
}
#endif
float computeFallOff(float value,vec2 clipSpace,float frustumEdgeFalloff)
{
float mask=smoothstep(1.0-frustumEdgeFalloff,1.00000012,clamp(dot(clipSpace,clipSpace),0.,1.));
return mix(value,1.0,mask);
}
#define inline
float computeShadowCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,vec2 depthValues)
{
vec3 directionToLight=vPositionW-lightPosition;
float depth=length(directionToLight);
depth=(depth+depthValues.x)/(depthValues.y);
depth=clamp(depth,0.,1.0);
directionToLight=normalize(directionToLight);
directionToLight.y=-directionToLight.y;
#ifndef SHADOWFLOAT
float shadow=unpack(textureCube(shadowSampler,directionToLight));
#else
float shadow=textureCube(shadowSampler,directionToLight).x;
#endif
return depth>shadow ? darkness : 1.0;
}
#define inline
float computeShadowWithPoissonSamplingCube(vec3 lightPosition,samplerCube shadowSampler,float mapSize,float darkness,vec2 depthValues)
{
vec3 directionToLight=vPositionW-lightPosition;
float depth=length(directionToLight);
depth=(depth+depthValues.x)/(depthValues.y);
depth=clamp(depth,0.,1.0);
directionToLight=normalize(directionToLight);
directionToLight.y=-directionToLight.y;
float visibility=1.;
vec3 poissonDisk[4];
poissonDisk[0]=vec3(-1.0,1.0,-1.0);
poissonDisk[1]=vec3(1.0,-1.0,-1.0);
poissonDisk[2]=vec3(-1.0,-1.0,-1.0);
poissonDisk[3]=vec3(1.0,-1.0,1.0);

#ifndef SHADOWFLOAT
if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize))<depth) visibility-=0.25;
if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize))<depth) visibility-=0.25;
if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize))<depth) visibility-=0.25;
if (unpack(textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize))<depth) visibility-=0.25;
#else
if (textureCube(shadowSampler,directionToLight+poissonDisk[0]*mapSize).x<depth) visibility-=0.25;
if (textureCube(shadowSampler,directionToLight+poissonDisk[1]*mapSize).x<depth) visibility-=0.25;
if (textureCube(shadowSampler,directionToLight+poissonDisk[2]*mapSize).x<depth) visibility-=0.25;
if (textureCube(shadowSampler,directionToLight+poissonDisk[3]*mapSize).x<depth) visibility-=0.25;
#endif
return min(1.0,visibility+darkness);
}
#define inline
float computeShadowWithESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)
{
vec3 directionToLight=vPositionW-lightPosition;
float depth=length(directionToLight);
depth=(depth+depthValues.x)/(depthValues.y);
float shadowPixelDepth=clamp(depth,0.,1.0);
directionToLight=normalize(directionToLight);
directionToLight.y=-directionToLight.y;
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));
#else
float shadowMapSample=textureCube(shadowSampler,directionToLight).x;
#endif
float esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);
return esm;
}
#define inline
float computeShadowWithCloseESMCube(vec3 lightPosition,samplerCube shadowSampler,float darkness,float depthScale,vec2 depthValues)
{
vec3 directionToLight=vPositionW-lightPosition;
float depth=length(directionToLight);
depth=(depth+depthValues.x)/(depthValues.y);
float shadowPixelDepth=clamp(depth,0.,1.0);
directionToLight=normalize(directionToLight);
directionToLight.y=-directionToLight.y;
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(textureCube(shadowSampler,directionToLight));
#else
float shadowMapSample=textureCube(shadowSampler,directionToLight).x;
#endif
float esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);
return esm;
}
#if defined(WEBGL2) || defined(WEBGPU)
#define inline
float computeShadowCSM(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray shadowSampler,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
vec3 uvLayer=vec3(uv.x,uv.y,layer);
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
#ifndef SHADOWFLOAT
float shadow=unpack(texture2D(shadowSampler,uvLayer));
#else
float shadow=texture2D(shadowSampler,uvLayer).x;
#endif
return shadowPixelDepth>shadow ? computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff) : 1.;
}
#endif
#define inline
float computeShadow(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{
return 1.0;
}
else
{
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
#ifndef SHADOWFLOAT
float shadow=unpack(texture2D(shadowSampler,uv));
#else
float shadow=texture2D(shadowSampler,uv).x;
#endif
return shadowPixelDepth>shadow ? computeFallOff(darkness,clipSpace.xy,frustumEdgeFalloff) : 1.;
}
}
#define inline
float computeShadowWithPoissonSampling(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float mapSize,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{
return 1.0;
}
else
{
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
float visibility=1.;
vec2 poissonDisk[4];
poissonDisk[0]=vec2(-0.94201624,-0.39906216);
poissonDisk[1]=vec2(0.94558609,-0.76890725);
poissonDisk[2]=vec2(-0.094184101,-0.92938870);
poissonDisk[3]=vec2(0.34495938,0.29387760);

#ifndef SHADOWFLOAT
if (unpack(texture2D(shadowSampler,uv+poissonDisk[0]*mapSize))<shadowPixelDepth) visibility-=0.25;
if (unpack(texture2D(shadowSampler,uv+poissonDisk[1]*mapSize))<shadowPixelDepth) visibility-=0.25;
if (unpack(texture2D(shadowSampler,uv+poissonDisk[2]*mapSize))<shadowPixelDepth) visibility-=0.25;
if (unpack(texture2D(shadowSampler,uv+poissonDisk[3]*mapSize))<shadowPixelDepth) visibility-=0.25;
#else
if (texture2D(shadowSampler,uv+poissonDisk[0]*mapSize).x<shadowPixelDepth) visibility-=0.25;
if (texture2D(shadowSampler,uv+poissonDisk[1]*mapSize).x<shadowPixelDepth) visibility-=0.25;
if (texture2D(shadowSampler,uv+poissonDisk[2]*mapSize).x<shadowPixelDepth) visibility-=0.25;
if (texture2D(shadowSampler,uv+poissonDisk[3]*mapSize).x<shadowPixelDepth) visibility-=0.25;
#endif
return computeFallOff(min(1.0,visibility+darkness),clipSpace.xy,frustumEdgeFalloff);
}
}
#define inline
float computeShadowWithESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{
return 1.0;
}
else
{
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(texture2D(shadowSampler,uv));
#else
float shadowMapSample=texture2D(shadowSampler,uv).x;
#endif
float esm=1.0-clamp(exp(min(87.,depthScale*shadowPixelDepth))*shadowMapSample,0.,1.-darkness);
return computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);
}
}
#define inline
float computeShadowWithCloseESM(vec4 vPositionFromLight,float depthMetric,sampler2D shadowSampler,float darkness,float depthScale,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec2 uv=0.5*clipSpace.xy+vec2(0.5);
if (uv.x<0. || uv.x>1.0 || uv.y<0. || uv.y>1.0)
{
return 1.0;
}
else
{
float shadowPixelDepth=clamp(depthMetric,0.,1.0);
#ifndef SHADOWFLOAT
float shadowMapSample=unpack(texture2D(shadowSampler,uv));
#else
float shadowMapSample=texture2D(shadowSampler,uv).x;
#endif
float esm=clamp(exp(min(87.,-depthScale*(shadowPixelDepth-shadowMapSample))),darkness,1.);
return computeFallOff(esm,clipSpace.xy,frustumEdgeFalloff);
}
}
#if defined(WEBGL2) || defined(WEBGPU)
#define GREATEST_LESS_THAN_ONE 0.99999994

#define inline
float computeShadowWithCSMPCF1(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
uvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);
vec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);
float shadow=texture(shadowSampler,uvDepthLayer);
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}



#define inline
float computeShadowWithCSMPCF3(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
uvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);
vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;
uv+=0.5;
vec2 st=fract(uv);
vec2 base_uv=floor(uv)-0.5;
base_uv*=shadowMapSizeAndInverse.y;




vec2 uvw0=3.-2.*st;
vec2 uvw1=1.+2.*st;
vec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;
vec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;
float shadow=0.;
shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));
shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));
shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));
shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));
shadow=shadow/16.;
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}



#define inline
float computeShadowWithCSMPCF5(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArrayShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
uvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);
vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;
uv+=0.5;
vec2 st=fract(uv);
vec2 base_uv=floor(uv)-0.5;
base_uv*=shadowMapSizeAndInverse.y;


vec2 uvw0=4.-3.*st;
vec2 uvw1=vec2(7.);
vec2 uvw2=1.+3.*st;
vec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;
vec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;
float shadow=0.;
shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[0]),layer,uvDepth.z));
shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[0]),layer,uvDepth.z));
shadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[0]),layer,uvDepth.z));
shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[1]),layer,uvDepth.z));
shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[1]),layer,uvDepth.z));
shadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[1]),layer,uvDepth.z));
shadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[0],v[2]),layer,uvDepth.z));
shadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[1],v[2]),layer,uvDepth.z));
shadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec4(base_uv.xy+vec2(u[2],v[2]),layer,uvDepth.z));
shadow=shadow/144.;
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}

#define inline
float computeShadowWithPCF1(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,float darkness,float frustumEdgeFalloff)
{
if (depthMetric>1.0 || depthMetric<0.0) {
return 1.0;
}
else
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
float shadow=texture2D(shadowSampler,uvDepth);
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}
}



#define inline
float computeShadowWithPCF3(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)
{
if (depthMetric>1.0 || depthMetric<0.0) {
return 1.0;
}
else
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;
uv+=0.5;
vec2 st=fract(uv);
vec2 base_uv=floor(uv)-0.5;
base_uv*=shadowMapSizeAndInverse.y;




vec2 uvw0=3.-2.*st;
vec2 uvw1=1.+2.*st;
vec2 u=vec2((2.-st.x)/uvw0.x-1.,st.x/uvw1.x+1.)*shadowMapSizeAndInverse.y;
vec2 v=vec2((2.-st.y)/uvw0.y-1.,st.y/uvw1.y+1.)*shadowMapSizeAndInverse.y;
float shadow=0.;
shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));
shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));
shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));
shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));
shadow=shadow/16.;
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}
}



#define inline
float computeShadowWithPCF5(vec4 vPositionFromLight,float depthMetric,sampler2DShadow shadowSampler,vec2 shadowMapSizeAndInverse,float darkness,float frustumEdgeFalloff)
{
if (depthMetric>1.0 || depthMetric<0.0) {
return 1.0;
}
else
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));

vec2 uv=uvDepth.xy*shadowMapSizeAndInverse.x;
uv+=0.5;
vec2 st=fract(uv);
vec2 base_uv=floor(uv)-0.5;
base_uv*=shadowMapSizeAndInverse.y;


vec2 uvw0=4.-3.*st;
vec2 uvw1=vec2(7.);
vec2 uvw2=1.+3.*st;
vec3 u=vec3((3.-2.*st.x)/uvw0.x-2.,(3.+st.x)/uvw1.x,st.x/uvw2.x+2.)*shadowMapSizeAndInverse.y;
vec3 v=vec3((3.-2.*st.y)/uvw0.y-2.,(3.+st.y)/uvw1.y,st.y/uvw2.y+2.)*shadowMapSizeAndInverse.y;
float shadow=0.;
shadow+=uvw0.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[0]),uvDepth.z));
shadow+=uvw1.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[0]),uvDepth.z));
shadow+=uvw2.x*uvw0.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[0]),uvDepth.z));
shadow+=uvw0.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[1]),uvDepth.z));
shadow+=uvw1.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[1]),uvDepth.z));
shadow+=uvw2.x*uvw1.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[1]),uvDepth.z));
shadow+=uvw0.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[0],v[2]),uvDepth.z));
shadow+=uvw1.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[1],v[2]),uvDepth.z));
shadow+=uvw2.x*uvw2.y*texture2D(shadowSampler,vec3(base_uv.xy+vec2(u[2],v[2]),uvDepth.z));
shadow=shadow/144.;
shadow=mix(darkness,1.,shadow);
return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}
}
const vec3 PoissonSamplers32[64]=vec3[64](
vec3(0.06407013,0.05409927,0.),
vec3(0.7366577,0.5789394,0.),
vec3(-0.6270542,-0.5320278,0.),
vec3(-0.4096107,0.8411095,0.),
vec3(0.6849564,-0.4990818,0.),
vec3(-0.874181,-0.04579735,0.),
vec3(0.9989998,0.0009880066,0.),
vec3(-0.004920578,-0.9151649,0.),
vec3(0.1805763,0.9747483,0.),
vec3(-0.2138451,0.2635818,0.),
vec3(0.109845,0.3884785,0.),
vec3(0.06876755,-0.3581074,0.),
vec3(0.374073,-0.7661266,0.),
vec3(0.3079132,-0.1216763,0.),
vec3(-0.3794335,-0.8271583,0.),
vec3(-0.203878,-0.07715034,0.),
vec3(0.5912697,0.1469799,0.),
vec3(-0.88069,0.3031784,0.),
vec3(0.5040108,0.8283722,0.),
vec3(-0.5844124,0.5494877,0.),
vec3(0.6017799,-0.1726654,0.),
vec3(-0.5554981,0.1559997,0.),
vec3(-0.3016369,-0.3900928,0.),
vec3(-0.5550632,-0.1723762,0.),
vec3(0.925029,0.2995041,0.),
vec3(-0.2473137,0.5538505,0.),
vec3(0.9183037,-0.2862392,0.),
vec3(0.2469421,0.6718712,0.),
vec3(0.3916397,-0.4328209,0.),
vec3(-0.03576927,-0.6220032,0.),
vec3(-0.04661255,0.7995201,0.),
vec3(0.4402924,0.3640312,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.),
vec3(0.,0.,0.)
);
const vec3 PoissonSamplers64[64]=vec3[64](
vec3(-0.613392,0.617481,0.),
vec3(0.170019,-0.040254,0.),
vec3(-0.299417,0.791925,0.),
vec3(0.645680,0.493210,0.),
vec3(-0.651784,0.717887,0.),
vec3(0.421003,0.027070,0.),
vec3(-0.817194,-0.271096,0.),
vec3(-0.705374,-0.668203,0.),
vec3(0.977050,-0.108615,0.),
vec3(0.063326,0.142369,0.),
vec3(0.203528,0.214331,0.),
vec3(-0.667531,0.326090,0.),
vec3(-0.098422,-0.295755,0.),
vec3(-0.885922,0.215369,0.),
vec3(0.566637,0.605213,0.),
vec3(0.039766,-0.396100,0.),
vec3(0.751946,0.453352,0.),
vec3(0.078707,-0.715323,0.),
vec3(-0.075838,-0.529344,0.),
vec3(0.724479,-0.580798,0.),
vec3(0.222999,-0.215125,0.),
vec3(-0.467574,-0.405438,0.),
vec3(-0.248268,-0.814753,0.),
vec3(0.354411,-0.887570,0.),
vec3(0.175817,0.382366,0.),
vec3(0.487472,-0.063082,0.),
vec3(-0.084078,0.898312,0.),
vec3(0.488876,-0.783441,0.),
vec3(0.470016,0.217933,0.),
vec3(-0.696890,-0.549791,0.),
vec3(-0.149693,0.605762,0.),
vec3(0.034211,0.979980,0.),
vec3(0.503098,-0.308878,0.),
vec3(-0.016205,-0.872921,0.),
vec3(0.385784,-0.393902,0.),
vec3(-0.146886,-0.859249,0.),
vec3(0.643361,0.164098,0.),
vec3(0.634388,-0.049471,0.),
vec3(-0.688894,0.007843,0.),
vec3(0.464034,-0.188818,0.),
vec3(-0.440840,0.137486,0.),
vec3(0.364483,0.511704,0.),
vec3(0.034028,0.325968,0.),
vec3(0.099094,-0.308023,0.),
vec3(0.693960,-0.366253,0.),
vec3(0.678884,-0.204688,0.),
vec3(0.001801,0.780328,0.),
vec3(0.145177,-0.898984,0.),
vec3(0.062655,-0.611866,0.),
vec3(0.315226,-0.604297,0.),
vec3(-0.780145,0.486251,0.),
vec3(-0.371868,0.882138,0.),
vec3(0.200476,0.494430,0.),
vec3(-0.494552,-0.711051,0.),
vec3(0.612476,0.705252,0.),
vec3(-0.578845,-0.768792,0.),
vec3(-0.772454,-0.090976,0.),
vec3(0.504440,0.372295,0.),
vec3(0.155736,0.065157,0.),
vec3(0.391522,0.849605,0.),
vec3(-0.620106,-0.328104,0.),
vec3(0.789239,-0.419965,0.),
vec3(-0.545396,0.538133,0.),
vec3(-0.178564,-0.596057,0.)
);





#define inline
float computeShadowWithCSMPCSS(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
uvDepth.z=clamp(uvDepth.z,0.,GREATEST_LESS_THAN_ONE);
vec4 uvDepthLayer=vec4(uvDepth.x,uvDepth.y,layer,uvDepth.z);
float blockerDepth=0.0;
float sumBlockerDepth=0.0;
float numBlocker=0.0;
for (int i=0; i<searchTapCount; i ++) {
blockerDepth=texture(depthSampler,vec3(uvDepth.xy+(lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse*PoissonSamplers32[i].xy),layer)).r;
if (blockerDepth<depthMetric) {
sumBlockerDepth+=blockerDepth;
numBlocker++;
}
}
if (numBlocker<1.0) {
return 1.0;
}
else
{
float avgBlockerDepth=sumBlockerDepth/numBlocker;

float AAOffset=shadowMapSizeInverse*10.;


float penumbraRatio=((depthMetric-avgBlockerDepth)*depthCorrection+AAOffset);
vec4 filterRadius=vec4(penumbraRatio*lightSizeUV*lightSizeUVCorrection*shadowMapSizeInverse,0.,0.);
float random=getRand(vPositionFromLight.xy);
float rotationAngle=random*3.1415926;
vec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));
float shadow=0.;
for (int i=0; i<pcfTapCount; i++) {
vec4 offset=vec4(poissonSamplers[i],0.);

offset=vec4(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.,0.);
shadow+=texture2D(shadowSampler,uvDepthLayer+offset*filterRadius);
}
shadow/=float(pcfTapCount);

shadow=mix(shadow,1.,min((depthMetric-avgBlockerDepth)*depthCorrection*penumbraDarkness,1.));

shadow=mix(darkness,1.,shadow);

return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}
}





#define inline
float computeShadowWithPCSS(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,int searchTapCount,int pcfTapCount,vec3[64] poissonSamplers)
{
if (depthMetric>1.0 || depthMetric<0.0) {
return 1.0;
}
else
{
vec3 clipSpace=vPositionFromLight.xyz/vPositionFromLight.w;
vec3 uvDepth=vec3(0.5*clipSpace.xyz+vec3(0.5));
float blockerDepth=0.0;
float sumBlockerDepth=0.0;
float numBlocker=0.0;
for (int i=0; i<searchTapCount; i ++) {
blockerDepth=texture(depthSampler,uvDepth.xy+(lightSizeUV*shadowMapSizeInverse*PoissonSamplers32[i].xy)).r;
if (blockerDepth<depthMetric) {
sumBlockerDepth+=blockerDepth;
numBlocker++;
}
}
if (numBlocker<1.0) {
return 1.0;
}
else
{
float avgBlockerDepth=sumBlockerDepth/numBlocker;

float AAOffset=shadowMapSizeInverse*10.;


float penumbraRatio=((depthMetric-avgBlockerDepth)+AAOffset);
float filterRadius=penumbraRatio*lightSizeUV*shadowMapSizeInverse;
float random=getRand(vPositionFromLight.xy);
float rotationAngle=random*3.1415926;
vec2 rotationVector=vec2(cos(rotationAngle),sin(rotationAngle));
float shadow=0.;
for (int i=0; i<pcfTapCount; i++) {
vec3 offset=poissonSamplers[i];

offset=vec3(offset.x*rotationVector.x-offset.y*rotationVector.y,offset.y*rotationVector.x+offset.x*rotationVector.y,0.);
shadow+=texture2D(shadowSampler,uvDepth+offset*filterRadius);
}
shadow/=float(pcfTapCount);

shadow=mix(shadow,1.,depthMetric-avgBlockerDepth);

shadow=mix(darkness,1.,shadow);

return computeFallOff(shadow,clipSpace.xy,frustumEdgeFalloff);
}
}
}
#define inline
float computeShadowWithPCSS16(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)
{
return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32);
}
#define inline
float computeShadowWithPCSS32(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)
{
return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32);
}
#define inline
float computeShadowWithPCSS64(vec4 vPositionFromLight,float depthMetric,sampler2D depthSampler,sampler2DShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff)
{
return computeShadowWithPCSS(vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64);
}
#define inline
float computeShadowWithCSMPCSS16(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)
{
return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,16,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);
}
#define inline
float computeShadowWithCSMPCSS32(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)
{
return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,16,32,PoissonSamplers32,lightSizeUVCorrection,depthCorrection,penumbraDarkness);
}
#define inline
float computeShadowWithCSMPCSS64(float layer,vec4 vPositionFromLight,float depthMetric,highp sampler2DArray depthSampler,highp sampler2DArrayShadow shadowSampler,float shadowMapSizeInverse,float lightSizeUV,float darkness,float frustumEdgeFalloff,vec2 lightSizeUVCorrection,float depthCorrection,float penumbraDarkness)
{
return computeShadowWithCSMPCSS(layer,vPositionFromLight,depthMetric,depthSampler,shadowSampler,shadowMapSizeInverse,lightSizeUV,darkness,frustumEdgeFalloff,32,64,PoissonSamplers64,lightSizeUVCorrection,depthCorrection,penumbraDarkness);
}
#endif
#endif
`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},function($,W,M){"use strict";var P=M(435),d="reflectionFunction",m=`vec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {

vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;
vec3 halfSize=cubeSize*0.5;
vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;
vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;

vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);

float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);

vec3 intersectPositionWS=vertexPos+origVec*distance;

return intersectPositionWS-cubePos;
}
vec3 computeFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)
{
float lon=atan(direction.z,direction.x);
float lat=acos(direction.y);
vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;
float s=sphereCoords.x*0.5+0.5;
float t=sphereCoords.y;
return vec3(s,t,0);
}
vec3 computeMirroredFixedEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 direction)
{
float lon=atan(direction.z,direction.x);
float lat=acos(direction.y);
vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;
float s=sphereCoords.x*0.5+0.5;
float t=sphereCoords.y;
return vec3(1.0-s,t,0);
}
vec3 computeEquirectangularCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)
{
vec3 cameraToVertex=normalize(worldPos.xyz-eyePosition);
vec3 r=normalize(reflect(cameraToVertex,worldNormal));
r=vec3(reflectionMatrix*vec4(r,0));
float lon=atan(r.z,r.x);
float lat=acos(r.y);
vec2 sphereCoords=vec2(lon,lat)*RECIPROCAL_PI2*2.0;
float s=sphereCoords.x*0.5+0.5;
float t=sphereCoords.y;
return vec3(s,t,0);
}
vec3 computeSphericalCoords(vec4 worldPos,vec3 worldNormal,mat4 view,mat4 reflectionMatrix)
{
vec3 viewDir=normalize(vec3(view*worldPos));
vec3 viewNormal=normalize(vec3(view*vec4(worldNormal,0.0)));
vec3 r=reflect(viewDir,viewNormal);
r=vec3(reflectionMatrix*vec4(r,0));
r.z=r.z-1.0;
float m=2.0*length(r);
return vec3(r.x/m+0.5,1.0-r.y/m-0.5,0);
}
vec3 computePlanarCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)
{
vec3 viewDir=worldPos.xyz-eyePosition;
vec3 coords=normalize(reflect(viewDir,worldNormal));
return vec3(reflectionMatrix*vec4(coords,1));
}
vec3 computeCubicCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix)
{
vec3 viewDir=normalize(worldPos.xyz-eyePosition);

vec3 coords=reflect(viewDir,worldNormal);
coords=vec3(reflectionMatrix*vec4(coords,0));
#ifdef INVERTCUBICMAP
coords.y*=-1.0;
#endif
return coords;
}
vec3 computeCubicLocalCoords(vec4 worldPos,vec3 worldNormal,vec3 eyePosition,mat4 reflectionMatrix,vec3 reflectionSize,vec3 reflectionPosition)
{
vec3 viewDir=normalize(worldPos.xyz-eyePosition);

vec3 coords=reflect(viewDir,worldNormal);
coords=parallaxCorrectNormal(worldPos.xyz,coords,reflectionSize,reflectionPosition);
coords=vec3(reflectionMatrix*vec4(coords,0));
#ifdef INVERTCUBICMAP
coords.y*=-1.0;
#endif
return coords;
}
vec3 computeProjectionCoords(vec4 worldPos,mat4 view,mat4 reflectionMatrix)
{
return vec3(reflectionMatrix*(view*worldPos));
}
vec3 computeSkyBoxCoords(vec3 positionW,mat4 reflectionMatrix)
{
return vec3(reflectionMatrix*vec4(positionW,1.));
}
#ifdef REFLECTION
vec3 computeReflectionCoords(vec4 worldPos,vec3 worldNormal)
{
#ifdef REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED
vec3 direction=normalize(vDirectionW);
return computeMirroredFixedEquirectangularCoords(worldPos,worldNormal,direction);
#endif
#ifdef REFLECTIONMAP_EQUIRECTANGULAR_FIXED
vec3 direction=normalize(vDirectionW);
return computeFixedEquirectangularCoords(worldPos,worldNormal,direction);
#endif
#ifdef REFLECTIONMAP_EQUIRECTANGULAR
return computeEquirectangularCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_SPHERICAL
return computeSphericalCoords(worldPos,worldNormal,view,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_PLANAR
return computePlanarCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_CUBIC
#ifdef USE_LOCAL_REFLECTIONMAP_CUBIC
return computeCubicLocalCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix,vReflectionSize,vReflectionPosition);
#else
return computeCubicCoords(worldPos,worldNormal,vEyePosition.xyz,reflectionMatrix);
#endif
#endif
#ifdef REFLECTIONMAP_PROJECTION
return computeProjectionCoords(worldPos,view,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_SKYBOX
return computeSkyBoxCoords(vPositionUVW,reflectionMatrix);
#endif
#ifdef REFLECTIONMAP_EXPLICIT
return vec3(0,0,0);
#endif
}
#endif`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},function($,W,M){"use strict";var P=M(435),d="lightFragment",m=`#ifdef LIGHT{X}
#if defined(SHADOWONLY) || defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X}) && defined(LIGHTMAPNOSPECULAR{X})

#else
#ifdef PBR

#ifdef SPOTLIGHT{X}
preInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);
#elif defined(POINTLIGHT{X})
preInfo=computePointAndSpotPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);
#elif defined(HEMILIGHT{X})
preInfo=computeHemisphericPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);
#elif defined(DIRLIGHT{X})
preInfo=computeDirectionalPreLightingInfo(light{X}.vLightData,viewDirectionW,normalW);
#endif
preInfo.NdotV=NdotV;

#ifdef SPOTLIGHT{X}
#ifdef LIGHT_FALLOFF_GLTF{X}
preInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);
preInfo.attenuation*=computeDirectionalLightFalloff_GLTF(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);
#elif defined(LIGHT_FALLOFF_PHYSICAL{X})
preInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);
preInfo.attenuation*=computeDirectionalLightFalloff_Physical(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w);
#elif defined(LIGHT_FALLOFF_STANDARD{X})
preInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);
preInfo.attenuation*=computeDirectionalLightFalloff_Standard(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w);
#else
preInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);
preInfo.attenuation*=computeDirectionalLightFalloff(light{X}.vLightDirection.xyz,preInfo.L,light{X}.vLightDirection.w,light{X}.vLightData.w,light{X}.vLightFalloff.z,light{X}.vLightFalloff.w);
#endif
#elif defined(POINTLIGHT{X})
#ifdef LIGHT_FALLOFF_GLTF{X}
preInfo.attenuation=computeDistanceLightFalloff_GLTF(preInfo.lightDistanceSquared,light{X}.vLightFalloff.y);
#elif defined(LIGHT_FALLOFF_PHYSICAL{X})
preInfo.attenuation=computeDistanceLightFalloff_Physical(preInfo.lightDistanceSquared);
#elif defined(LIGHT_FALLOFF_STANDARD{X})
preInfo.attenuation=computeDistanceLightFalloff_Standard(preInfo.lightOffset,light{X}.vLightFalloff.x);
#else
preInfo.attenuation=computeDistanceLightFalloff(preInfo.lightOffset,preInfo.lightDistanceSquared,light{X}.vLightFalloff.x,light{X}.vLightFalloff.y);
#endif
#else
preInfo.attenuation=1.0;
#endif


#ifdef HEMILIGHT{X}
preInfo.roughness=roughness;
#else
preInfo.roughness=adjustRoughnessFromLightProperties(roughness,light{X}.vLightSpecular.a,preInfo.lightDistance);
#endif

#ifdef HEMILIGHT{X}
info.diffuse=computeHemisphericDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb,light{X}.vLightGround);
#elif defined(SS_TRANSLUCENCY)
info.diffuse=computeDiffuseAndTransmittedLighting(preInfo,light{X}.vLightDiffuse.rgb,subSurfaceOut.transmittance);
#else
info.diffuse=computeDiffuseLighting(preInfo,light{X}.vLightDiffuse.rgb);
#endif

#ifdef SPECULARTERM
#ifdef ANISOTROPIC
info.specular=computeAnisotropicSpecularLighting(preInfo,viewDirectionW,normalW,anisotropicOut.anisotropicTangent,anisotropicOut.anisotropicBitangent,anisotropicOut.anisotropy,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);
#else
info.specular=computeSpecularLighting(preInfo,normalW,clearcoatOut.specularEnvironmentR0,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);
#endif
#endif

#ifdef SHEEN
#ifdef SHEEN_LINKWITHALBEDO

preInfo.roughness=sheenOut.sheenIntensity;
#else
#ifdef HEMILIGHT{X}
preInfo.roughness=sheenOut.sheenRoughness;
#else
preInfo.roughness=adjustRoughnessFromLightProperties(sheenOut.sheenRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);
#endif
#endif
info.sheen=computeSheenLighting(preInfo,normalW,sheenOut.sheenColor,specularEnvironmentR90,AARoughnessFactors.x,light{X}.vLightDiffuse.rgb);
#endif

#ifdef CLEARCOAT

#ifdef HEMILIGHT{X}
preInfo.roughness=clearcoatOut.clearCoatRoughness;
#else
preInfo.roughness=adjustRoughnessFromLightProperties(clearcoatOut.clearCoatRoughness,light{X}.vLightSpecular.a,preInfo.lightDistance);
#endif
info.clearCoat=computeClearCoatLighting(preInfo,clearcoatOut.clearCoatNormalW,clearcoatOut.clearCoatAARoughnessFactors.x,clearcoatOut.clearCoatIntensity,light{X}.vLightDiffuse.rgb);
#ifdef CLEARCOAT_TINT

absorption=computeClearCoatLightingAbsorption(clearcoatOut.clearCoatNdotVRefract,preInfo.L,clearcoatOut.clearCoatNormalW,clearcoatOut.clearCoatColor,clearcoatOut.clearCoatThickness,clearcoatOut.clearCoatIntensity);
info.diffuse*=absorption;
#ifdef SPECULARTERM
info.specular*=absorption;
#endif
#endif

info.diffuse*=info.clearCoat.w;
#ifdef SPECULARTERM
info.specular*=info.clearCoat.w;
#endif
#ifdef SHEEN
info.sheen*=info.clearCoat.w;
#endif
#endif
#else
#ifdef SPOTLIGHT{X}
info=computeSpotLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDirection,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);
#elif defined(HEMILIGHT{X})
info=computeHemisphericLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightGround,glossiness);
#elif defined(POINTLIGHT{X}) || defined(DIRLIGHT{X})
info=computeLighting(viewDirectionW,normalW,light{X}.vLightData,light{X}.vLightDiffuse.rgb,light{X}.vLightSpecular.rgb,light{X}.vLightDiffuse.a,glossiness);
#endif
#endif
#ifdef PROJECTEDLIGHTTEXTURE{X}
info.diffuse*=computeProjectionTextureDiffuseLighting(projectionLightSampler{X},textureProjectionMatrix{X});
#endif
#endif
#ifdef SHADOW{X}
#ifdef SHADOWCSM{X}
for (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++)
{
#ifdef SHADOWCSM_RIGHTHANDED{X}
diff{X}=viewFrustumZ{X}[i]+vPositionFromCamera{X}.z;
#else
diff{X}=viewFrustumZ{X}[i]-vPositionFromCamera{X}.z;
#endif
if (diff{X}>=0.) {
index{X}=i;
break;
}
}
#ifdef SHADOWCSMUSESHADOWMAXZ{X}
if (index{X}>=0)
#endif
{
#if defined(SHADOWPCF{X})
#if defined(SHADOWLOWQUALITY{X})
shadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#elif defined(SHADOWMEDIUMQUALITY{X})
shadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#else
shadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPCSS{X})
#if defined(SHADOWLOWQUALITY{X})
shadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#elif defined(SHADOWMEDIUMQUALITY{X})
shadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#else
shadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#endif
#else
shadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#ifdef SHADOWCSMDEBUG{X}
shadowDebug{X}=vec3(shadow)*vCascadeColorsMultiplier{X}[index{X}];
#endif
#ifndef SHADOWCSMNOBLEND{X}
float frustumLength=frustumLengths{X}[index{X}];
float diffRatio=clamp(diff{X}/frustumLength,0.,1.)*cascadeBlendFactor{X};
if (index{X}<(SHADOWCSMNUM_CASCADES{X}-1) && diffRatio<1.)
{
index{X}+=1;
float nextShadow=0.;
#if defined(SHADOWPCF{X})
#if defined(SHADOWLOWQUALITY{X})
nextShadow=computeShadowWithCSMPCF1(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#elif defined(SHADOWMEDIUMQUALITY{X})
nextShadow=computeShadowWithCSMPCF3(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#else
nextShadow=computeShadowWithCSMPCF5(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPCSS{X})
#if defined(SHADOWLOWQUALITY{X})
nextShadow=computeShadowWithCSMPCSS16(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#elif defined(SHADOWMEDIUMQUALITY{X})
nextShadow=computeShadowWithCSMPCSS32(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#else
nextShadow=computeShadowWithCSMPCSS64(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w,lightSizeUVCorrection{X}[index{X}],depthCorrection{X}[index{X}],penumbraDarkness{X});
#endif
#else
nextShadow=computeShadowCSM(float(index{X}),vPositionFromLight{X}[index{X}],vDepthMetric{X}[index{X}],shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
shadow=mix(nextShadow,shadow,diffRatio);
#ifdef SHADOWCSMDEBUG{X}
shadowDebug{X}=mix(vec3(nextShadow)*vCascadeColorsMultiplier{X}[index{X}],shadowDebug{X},diffRatio);
#endif
}
#endif
}
#elif defined(SHADOWCLOSEESM{X})
#if defined(SHADOWCUBE{X})
shadow=computeShadowWithCloseESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);
#else
shadow=computeShadowWithCloseESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWESM{X})
#if defined(SHADOWCUBE{X})
shadow=computeShadowWithESMCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.depthValues);
#else
shadow=computeShadowWithESM(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.z,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPOISSON{X})
#if defined(SHADOWCUBE{X})
shadow=computeShadowWithPoissonSamplingCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.depthValues);
#else
shadow=computeShadowWithPoissonSampling(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPCF{X})
#if defined(SHADOWLOWQUALITY{X})
shadow=computeShadowWithPCF1(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#elif defined(SHADOWMEDIUMQUALITY{X})
shadow=computeShadowWithPCF3(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#else
shadow=computeShadowWithPCF5(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.yz,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#elif defined(SHADOWPCSS{X})
#if defined(SHADOWLOWQUALITY{X})
shadow=computeShadowWithPCSS16(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#elif defined(SHADOWMEDIUMQUALITY{X})
shadow=computeShadowWithPCSS32(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#else
shadow=computeShadowWithPCSS64(vPositionFromLight{X},vDepthMetric{X},depthSampler{X},shadowSampler{X},light{X}.shadowsInfo.y,light{X}.shadowsInfo.z,light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#else
#if defined(SHADOWCUBE{X})
shadow=computeShadowCube(light{X}.vLightData.xyz,shadowSampler{X},light{X}.shadowsInfo.x,light{X}.depthValues);
#else
shadow=computeShadow(vPositionFromLight{X},vDepthMetric{X},shadowSampler{X},light{X}.shadowsInfo.x,light{X}.shadowsInfo.w);
#endif
#endif
#ifdef SHADOWONLY
#ifndef SHADOWINUSE
#define SHADOWINUSE
#endif
globalShadow+=shadow;
shadowLightCount+=1.0;
#endif
#else
shadow=1.;
#endif
#ifndef SHADOWONLY
#ifdef CUSTOMUSERLIGHTING
diffuseBase+=computeCustomDiffuseLighting(info,diffuseBase,shadow);
#ifdef SPECULARTERM
specularBase+=computeCustomSpecularLighting(info,specularBase,shadow);
#endif
#elif defined(LIGHTMAP) && defined(LIGHTMAPEXCLUDED{X})
diffuseBase+=lightmapColor.rgb*shadow;
#ifdef SPECULARTERM
#ifndef LIGHTMAPNOSPECULAR{X}
specularBase+=info.specular*shadow*lightmapColor.rgb;
#endif
#endif
#ifdef CLEARCOAT
#ifndef LIGHTMAPNOSPECULAR{X}
clearCoatBase+=info.clearCoat.rgb*shadow*lightmapColor.rgb;
#endif
#endif
#ifdef SHEEN
#ifndef LIGHTMAPNOSPECULAR{X}
sheenBase+=info.sheen.rgb*shadow;
#endif
#endif
#else
#ifdef SHADOWCSMDEBUG{X}
diffuseBase+=info.diffuse*shadowDebug{X};
#else
diffuseBase+=info.diffuse*shadow;
#endif
#ifdef SPECULARTERM
specularBase+=info.specular*shadow;
#endif
#ifdef CLEARCOAT
clearCoatBase+=info.clearCoat.rgb*shadow;
#endif
#ifdef SHEEN
sheenBase+=info.sheen.rgb*shadow;
#endif
#endif
#endif
#endif`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},function($,W,M){"use strict";var P=M(435),d="fogFragment",m=`#ifdef FOG
float fog=CalcFogFactor();
color.rgb=fog*color.rgb+(1.0-fog)*vFogColor;
#endif`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},function($,W,M){"use strict";var P=M(435),d="fogVertexDeclaration",m=`#ifdef FOG
varying vec3 vFogDistance;
#endif`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},function($,W,M){"use strict";var P=M(435),d="lightVxFragmentDeclaration",m=`#ifdef LIGHT{X}
uniform vec4 vLightData{X};
uniform vec4 vLightDiffuse{X};
#ifdef SPECULARTERM
uniform vec4 vLightSpecular{X};
#else
vec4 vLightSpecular{X}=vec4(0.);
#endif
#ifdef SHADOW{X}
#ifdef SHADOWCSM{X}
uniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];
varying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];
varying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];
varying vec4 vPositionFromCamera{X};
#elif defined(SHADOWCUBE{X})
#else
varying vec4 vPositionFromLight{X};
varying float vDepthMetric{X};
uniform mat4 lightMatrix{X};
#endif
uniform vec4 shadowsInfo{X};
uniform vec2 depthValues{X};
#endif
#ifdef SPOTLIGHT{X}
uniform vec4 vLightDirection{X};
uniform vec4 vLightFalloff{X};
#elif defined(POINTLIGHT{X})
uniform vec4 vLightFalloff{X};
#elif defined(HEMILIGHT{X})
uniform vec3 vLightGround{X};
#endif
#endif`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},function($,W,M){"use strict";var P=M(435),d="lightVxUboDeclaration",m=`#ifdef LIGHT{X}
uniform Light{X}
{
vec4 vLightData;
vec4 vLightDiffuse;
vec4 vLightSpecular;
#ifdef SPOTLIGHT{X}
vec4 vLightDirection;
vec4 vLightFalloff;
#elif defined(POINTLIGHT{X})
vec4 vLightFalloff;
#elif defined(HEMILIGHT{X})
vec3 vLightGround;
#endif
vec4 shadowsInfo;
vec2 depthValues;
} light{X};
#ifdef SHADOW{X}
#ifdef SHADOWCSM{X}
uniform mat4 lightMatrix{X}[SHADOWCSMNUM_CASCADES{X}];
varying vec4 vPositionFromLight{X}[SHADOWCSMNUM_CASCADES{X}];
varying float vDepthMetric{X}[SHADOWCSMNUM_CASCADES{X}];
varying vec4 vPositionFromCamera{X};
#elif defined(SHADOWCUBE{X})
#else
varying vec4 vPositionFromLight{X};
varying float vDepthMetric{X};
uniform mat4 lightMatrix{X};
#endif
#endif
#endif`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},function($,W,M){"use strict";var P=M(435),d="shadowsVertex",m=`#ifdef SHADOWS
#if defined(SHADOWCSM{X})
vPositionFromCamera{X}=view*worldPos;
for (int i=0; i<SHADOWCSMNUM_CASCADES{X}; i++) {
vPositionFromLight{X}[i]=lightMatrix{X}[i]*worldPos;
vDepthMetric{X}[i]=((vPositionFromLight{X}[i].z+light{X}.depthValues.x)/(light{X}.depthValues.y));
}
#elif defined(SHADOW{X}) && !defined(SHADOWCUBE{X})
vPositionFromLight{X}=lightMatrix{X}*worldPos;
vDepthMetric{X}=((vPositionFromLight{X}.z+light{X}.depthValues.x)/(light{X}.depthValues.y));
#endif
#endif`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},function($,W,M){"use strict";M.d(W,"a",function(){return P});var P=function(){function d(){}return d.IsWindowObjectExist=function(){return typeof window!="undefined"},d.IsNavigatorAvailable=function(){return typeof navigator!="undefined"},d.IsDocumentAvailable=function(){return typeof document!="undefined"},d.GetDOMTextContent=function(m){for(var n="",c=m.firstChild;c;)c.nodeType===3&&(n+=c.textContent),c=c.nextSibling;return n},d}()},function($,W,M){"use strict";M.d(W,"a",function(){return l});var P=M(436),d=M(441),m=M(485),n=M(447),c=M(559),a=M(668),_=M(536),s=M(443),u=M(663),p=M(710),l=function(){function h(t,e,i,r,o){r===void 0&&(r=!1),o===void 0&&(o=null),this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this.useBoundingInfoFromGeometry=!1,this.id=t,this.uniqueId=e.getUniqueId(),this._engine=e.getEngine(),this._meshes=[],this._scene=e,this._vertexBuffers={},this._indices=[],this._updatable=r,i?this.setAllVerticesData(i,r):(this._totalVertices=0,this._indices=[]),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),o&&(this.applyToMesh(o),o.computeWorldMatrix(!0))}return Object.defineProperty(h.prototype,"boundingBias",{get:function(){return this._boundingBias},set:function(t){this._boundingBias?this._boundingBias.copyFrom(t):this._boundingBias=t.clone(),this._updateBoundingInfo(!0,null)},enumerable:!1,configurable:!0}),h.CreateGeometryForMesh=function(t){var e=new h(h.RandomId(),t.getScene());return e.applyToMesh(t),e},Object.defineProperty(h.prototype,"meshes",{get:function(){return this._meshes},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"extend",{get:function(){return this._extend},enumerable:!1,configurable:!0}),h.prototype.getScene=function(){return this._scene},h.prototype.getEngine=function(){return this._engine},h.prototype.isReady=function(){return this.delayLoadState===1||this.delayLoadState===0},Object.defineProperty(h.prototype,"doNotSerialize",{get:function(){for(var t=0;t<this._meshes.length;t++)if(!this._meshes[t].doNotSerialize)return!1;return!0},enumerable:!1,configurable:!0}),h.prototype._rebuild=function(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),this._meshes.length!==0&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable));for(var t in this._vertexBuffers){var e=this._vertexBuffers[t];e._rebuild()}},h.prototype.setAllVerticesData=function(t,e){t.applyToGeometry(this,e),this.notifyUpdate()},h.prototype.setVerticesData=function(t,e,i,r){i===void 0&&(i=!1),i&&Array.isArray(e)&&(e=new Float32Array(e));var o=new n.b(this._engine,e,t,i,this._meshes.length===0,r);this.setVerticesBuffer(o)},h.prototype.removeVerticesData=function(t){this._vertexBuffers[t]&&(this._vertexBuffers[t].dispose(),delete this._vertexBuffers[t]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()},h.prototype.setVerticesBuffer=function(t,e){e===void 0&&(e=null);var i=t.getKind();this._vertexBuffers[i]&&this._vertexBuffers[i].dispose(),this._vertexBuffers[i]=t;var r=this._meshes,o=r.length;if(i===n.b.PositionKind){var g=t.getData();e!=null?this._totalVertices=e:g!=null&&(this._totalVertices=g.length/(t.type===n.b.BYTE?t.byteStride:t.byteStride/4)),this._updateExtend(g),this._resetPointsArrayCache();for(var y=0;y<o;y++){var v=r[y];v._boundingInfo=new _.a(this._extend.minimum,this._extend.maximum),v._createGlobalSubMesh(!1),v.computeWorldMatrix(!0),v.synchronizeInstances()}}this.notifyUpdate(i)},h.prototype.updateVerticesDataDirectly=function(t,e,i,r){r===void 0&&(r=!1);var o=this.getVertexBuffer(t);!o||(o.updateDirectly(e,i,r),this.notifyUpdate(t))},h.prototype.updateVerticesData=function(t,e,i){i===void 0&&(i=!1);var r=this.getVertexBuffer(t);!r||(r.update(e),t===n.b.PositionKind&&this._updateBoundingInfo(i,e),this.notifyUpdate(t))},h.prototype._updateBoundingInfo=function(t,e){if(t&&this._updateExtend(e),this._resetPointsArrayCache(),t)for(var i=this._meshes,r=0,o=i;r<o.length;r++){var g=o[r];g._boundingInfo?g._boundingInfo.reConstruct(this._extend.minimum,this._extend.maximum):g._boundingInfo=new _.a(this._extend.minimum,this._extend.maximum);for(var y=g.subMeshes,v=0,f=y;v<f.length;v++){var b=f[v];b.refreshBoundingInfo()}}},h.prototype._bind=function(t,e,i,r){if(!!t){e===void 0&&(e=this._indexBuffer);var o=this.getVertexBuffers();if(!!o){if(e!=this._indexBuffer||!this._vertexArrayObjects&&!r){this._engine.bindBuffers(o,e,t,i);return}var g=r||this._vertexArrayObjects;g[t.key]||(g[t.key]=this._engine.recordVertexArrayObject(o,e,t,i)),this._engine.bindVertexArrayObject(g[t.key],e)}}},h.prototype.getTotalVertices=function(){return this.isReady()?this._totalVertices:0},h.prototype.getVerticesData=function(t,e,i){var r=this.getVertexBuffer(t);return r?r.getFloatData(this._totalVertices,i||e&&this._meshes.length!==1):null},h.prototype.isVertexBufferUpdatable=function(t){var e=this._vertexBuffers[t];return e?e.isUpdatable():!1},h.prototype.getVertexBuffer=function(t){return this.isReady()?this._vertexBuffers[t]:null},h.prototype.getVertexBuffers=function(){return this.isReady()?this._vertexBuffers:null},h.prototype.isVerticesDataPresent=function(t){return this._vertexBuffers?this._vertexBuffers[t]!==void 0:this._delayInfo?this._delayInfo.indexOf(t)!==-1:!1},h.prototype.getVerticesDataKinds=function(){var t=[],e;if(!this._vertexBuffers&&this._delayInfo)for(e in this._delayInfo)t.push(e);else for(e in this._vertexBuffers)t.push(e);return t},h.prototype.updateIndices=function(t,e,i){if(i===void 0&&(i=!1),!!this._indexBuffer)if(!this._indexBufferIsUpdatable)this.setIndices(t,null,!0);else{var r=t.length!==this._indices.length;if(i||(this._indices=t.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,t,e),r)for(var o=0,g=this._meshes;o<g.length;o++){var y=g[o];y._createGlobalSubMesh(!0)}}},h.prototype.setIndices=function(t,e,i){e===void 0&&(e=null),i===void 0&&(i=!1),this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=t,this._indexBufferIsUpdatable=i,this._meshes.length!==0&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,i)),e!=null&&(this._totalVertices=e);for(var r=0,o=this._meshes;r<o.length;r++){var g=o[r];g._createGlobalSubMesh(!0),g.synchronizeInstances()}this.notifyUpdate()},h.prototype.getTotalIndices=function(){return this.isReady()?this._indices.length:0},h.prototype.getIndices=function(t,e){if(!this.isReady())return null;var i=this._indices;if(!e&&(!t||this._meshes.length===1))return i;for(var r=i.length,o=[],g=0;g<r;g++)o.push(i[g]);return o},h.prototype.getIndexBuffer=function(){return this.isReady()?this._indexBuffer:null},h.prototype._releaseVertexArrayObject=function(t){t===void 0&&(t=null),!(!t||!this._vertexArrayObjects)&&this._vertexArrayObjects[t.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[t.key]),delete this._vertexArrayObjects[t.key])},h.prototype.releaseForMesh=function(t,e){var i=this._meshes,r=i.indexOf(t);r!==-1&&(i.splice(r,1),this._vertexArrayObjects&&t._invalidateInstanceVertexArrayObject(),t._geometry=null,i.length===0&&e&&this.dispose())},h.prototype.applyToMesh=function(t){if(t._geometry!==this){var e=t._geometry;e&&e.releaseForMesh(t),this._vertexArrayObjects&&t._invalidateInstanceVertexArrayObject();var i=this._meshes;t._geometry=this,this._scene.pushGeometry(this),i.push(t),this.isReady()?this._applyToMesh(t):t._boundingInfo=this._boundingInfo}},h.prototype._updateExtend=function(t){t===void 0&&(t=null),this.useBoundingInfoFromGeometry&&this._boundingInfo?this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()}:(t||(t=this.getVerticesData(n.b.PositionKind)),this._extend=Object(p.a)(t,0,this._totalVertices,this.boundingBias,3))},h.prototype._applyToMesh=function(t){var e=this._meshes.length;for(var i in this._vertexBuffers){e===1&&this._vertexBuffers[i].create();var r=this._vertexBuffers[i].getBuffer();r&&(r.references=e),i===n.b.PositionKind&&(this._extend||this._updateExtend(),t._boundingInfo=new _.a(this._extend.minimum,this._extend.maximum),t._createGlobalSubMesh(!1),t._updateBoundingInfo())}e===1&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable)),this._indexBuffer&&(this._indexBuffer.references=e),t._syncGeometryWithMorphTargetManager(),t.synchronizeInstances()},h.prototype.notifyUpdate=function(t){this.onGeometryUpdated&&this.onGeometryUpdated(this,t),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(var e=0,i=this._meshes;e<i.length;e++){var r=i[e];r._markSubMeshesAsAttributesDirty()}},h.prototype.load=function(t,e){if(this.delayLoadState!==2){if(this.isReady()){e&&e();return}this.delayLoadState=2,this._queueLoad(t,e)}},h.prototype._queueLoad=function(t,e){var i=this;!this.delayLoadingFile||(t._addPendingData(this),t._loadFile(this.delayLoadingFile,function(r){if(!!i._delayLoadingFunction){i._delayLoadingFunction(JSON.parse(r),i),i.delayLoadState=1,i._delayInfo=[],t._removePendingData(i);for(var o=i._meshes,g=o.length,y=0;y<g;y++)i._applyToMesh(o[y]);e&&e()}},void 0,!0))},h.prototype.toLeftHanded=function(){var t=this.getIndices(!1);if(t!=null&&t.length>0){for(var e=0;e<t.length;e+=3){var i=t[e+0];t[e+0]=t[e+2],t[e+2]=i}this.setIndices(t)}var r=this.getVerticesData(n.b.PositionKind,!1);if(r!=null&&r.length>0){for(var e=0;e<r.length;e+=3)r[e+2]=-r[e+2];this.setVerticesData(n.b.PositionKind,r,!1)}var o=this.getVerticesData(n.b.NormalKind,!1);if(o!=null&&o.length>0){for(var e=0;e<o.length;e+=3)o[e+2]=-o[e+2];this.setVerticesData(n.b.NormalKind,o,!1)}},h.prototype._resetPointsArrayCache=function(){this._positions=null},h.prototype._generatePointsArray=function(){if(this._positions)return!0;var t=this.getVerticesData(n.b.PositionKind);if(!t||t.length===0)return!1;for(var e=this._positionsCache.length*3,i=this._positionsCache.length;e<t.length;e+=3,++i)this._positionsCache[i]=P.e.FromArray(t,e);for(var e=0,i=0;e<t.length;e+=3,++i)this._positionsCache[i].set(t[0+e],t[1+e],t[2+e]);return this._positionsCache.length=t.length/3,this._positions=this._positionsCache,!0},h.prototype.isDisposed=function(){return this._isDisposed},h.prototype._disposeVertexArrayObjects=function(){if(this._vertexArrayObjects){for(var t in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[t]);this._vertexArrayObjects={};for(var e=this._meshes,i=e.length,r=0;r<i;r++)e[r]._invalidateInstanceVertexArrayObject()}},h.prototype.dispose=function(){var t=this._meshes,e=t.length,i;for(i=0;i<e;i++)this.releaseForMesh(t[i]);this._meshes=[],this._disposeVertexArrayObjects();for(var r in this._vertexBuffers)this._vertexBuffers[r].dispose();this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._isDisposed=!0},h.prototype.copy=function(t){var e=new m.a;e.indices=[];var i=this.getIndices();if(i)for(var r=0;r<i.length;r++)e.indices.push(i[r]);var o=!1,g=!1,y;for(y in this._vertexBuffers){var v=this.getVerticesData(y);if(v&&(v instanceof Float32Array?e.set(new Float32Array(v),y):e.set(v.slice(0),y),!g)){var f=this.getVertexBuffer(y);f&&(o=f.isUpdatable(),g=!o)}}var b=new h(t,this._scene,e,o);b.delayLoadState=this.delayLoadState,b.delayLoadingFile=this.delayLoadingFile,b._delayLoadingFunction=this._delayLoadingFunction;for(y in this._delayInfo)b._delayInfo=b._delayInfo||[],b._delayInfo.push(y);return b._boundingInfo=new _.a(this._extend.minimum,this._extend.maximum),b},h.prototype.serialize=function(){var t={};return t.id=this.id,t.updatable=this._updatable,u.a&&u.a.HasTags(this)&&(t.tags=u.a.GetTags(this)),t},h.prototype.toNumberArray=function(t){return Array.isArray(t)?t:Array.prototype.slice.call(t)},h.prototype.serializeVerticeData=function(){var t=this.serialize();return this.isVerticesDataPresent(n.b.PositionKind)&&(t.positions=this.toNumberArray(this.getVerticesData(n.b.PositionKind)),this.isVertexBufferUpdatable(n.b.PositionKind)&&(t.positions._updatable=!0)),this.isVerticesDataPresent(n.b.NormalKind)&&(t.normals=this.toNumberArray(this.getVerticesData(n.b.NormalKind)),this.isVertexBufferUpdatable(n.b.NormalKind)&&(t.normals._updatable=!0)),this.isVerticesDataPresent(n.b.TangentKind)&&(t.tangets=this.toNumberArray(this.getVerticesData(n.b.TangentKind)),this.isVertexBufferUpdatable(n.b.TangentKind)&&(t.tangets._updatable=!0)),this.isVerticesDataPresent(n.b.UVKind)&&(t.uvs=this.toNumberArray(this.getVerticesData(n.b.UVKind)),this.isVertexBufferUpdatable(n.b.UVKind)&&(t.uvs._updatable=!0)),this.isVerticesDataPresent(n.b.UV2Kind)&&(t.uv2s=this.toNumberArray(this.getVerticesData(n.b.UV2Kind)),this.isVertexBufferUpdatable(n.b.UV2Kind)&&(t.uv2s._updatable=!0)),this.isVerticesDataPresent(n.b.UV3Kind)&&(t.uv3s=this.toNumberArray(this.getVerticesData(n.b.UV3Kind)),this.isVertexBufferUpdatable(n.b.UV3Kind)&&(t.uv3s._updatable=!0)),this.isVerticesDataPresent(n.b.UV4Kind)&&(t.uv4s=this.toNumberArray(this.getVerticesData(n.b.UV4Kind)),this.isVertexBufferUpdatable(n.b.UV4Kind)&&(t.uv4s._updatable=!0)),this.isVerticesDataPresent(n.b.UV5Kind)&&(t.uv5s=this.toNumberArray(this.getVerticesData(n.b.UV5Kind)),this.isVertexBufferUpdatable(n.b.UV5Kind)&&(t.uv5s._updatable=!0)),this.isVerticesDataPresent(n.b.UV6Kind)&&(t.uv6s=this.toNumberArray(this.getVerticesData(n.b.UV6Kind)),this.isVertexBufferUpdatable(n.b.UV6Kind)&&(t.uv6s._updatable=!0)),this.isVerticesDataPresent(n.b.ColorKind)&&(t.colors=this.toNumberArray(this.getVerticesData(n.b.ColorKind)),this.isVertexBufferUpdatable(n.b.ColorKind)&&(t.colors._updatable=!0)),this.isVerticesDataPresent(n.b.MatricesIndicesKind)&&(t.matricesIndices=this.toNumberArray(this.getVerticesData(n.b.MatricesIndicesKind)),t.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(n.b.MatricesIndicesKind)&&(t.matricesIndices._updatable=!0)),this.isVerticesDataPresent(n.b.MatricesWeightsKind)&&(t.matricesWeights=this.toNumberArray(this.getVerticesData(n.b.MatricesWeightsKind)),this.isVertexBufferUpdatable(n.b.MatricesWeightsKind)&&(t.matricesWeights._updatable=!0)),t.indices=this.toNumberArray(this.getIndices()),t},h.ExtractFromMesh=function(t,e){var i=t._geometry;return i?i.copy(e):null},h.RandomId=function(){return s.b.RandomId()},h._ImportGeometry=function(t,e){var i=e.getScene(),r=t.geometryId;if(r){var o=i.getGeometryByID(r);o&&o.applyToMesh(e)}else if(t instanceof ArrayBuffer){var g=e._binaryInfo;if(g.positionsAttrDesc&&g.positionsAttrDesc.count>0){var y=new Float32Array(t,g.positionsAttrDesc.offset,g.positionsAttrDesc.count);e.setVerticesData(n.b.PositionKind,y,!1)}if(g.normalsAttrDesc&&g.normalsAttrDesc.count>0){var v=new Float32Array(t,g.normalsAttrDesc.offset,g.normalsAttrDesc.count);e.setVerticesData(n.b.NormalKind,v,!1)}if(g.tangetsAttrDesc&&g.tangetsAttrDesc.count>0){var f=new Float32Array(t,g.tangetsAttrDesc.offset,g.tangetsAttrDesc.count);e.setVerticesData(n.b.TangentKind,f,!1)}if(g.uvsAttrDesc&&g.uvsAttrDesc.count>0){var b=new Float32Array(t,g.uvsAttrDesc.offset,g.uvsAttrDesc.count);e.setVerticesData(n.b.UVKind,b,!1)}if(g.uvs2AttrDesc&&g.uvs2AttrDesc.count>0){var T=new Float32Array(t,g.uvs2AttrDesc.offset,g.uvs2AttrDesc.count);e.setVerticesData(n.b.UV2Kind,T,!1)}if(g.uvs3AttrDesc&&g.uvs3AttrDesc.count>0){var E=new Float32Array(t,g.uvs3AttrDesc.offset,g.uvs3AttrDesc.count);e.setVerticesData(n.b.UV3Kind,E,!1)}if(g.uvs4AttrDesc&&g.uvs4AttrDesc.count>0){var O=new Float32Array(t,g.uvs4AttrDesc.offset,g.uvs4AttrDesc.count);e.setVerticesData(n.b.UV4Kind,O,!1)}if(g.uvs5AttrDesc&&g.uvs5AttrDesc.count>0){var D=new Float32Array(t,g.uvs5AttrDesc.offset,g.uvs5AttrDesc.count);e.setVerticesData(n.b.UV5Kind,D,!1)}if(g.uvs6AttrDesc&&g.uvs6AttrDesc.count>0){var F=new Float32Array(t,g.uvs6AttrDesc.offset,g.uvs6AttrDesc.count);e.setVerticesData(n.b.UV6Kind,F,!1)}if(g.colorsAttrDesc&&g.colorsAttrDesc.count>0){var x=new Float32Array(t,g.colorsAttrDesc.offset,g.colorsAttrDesc.count);e.setVerticesData(n.b.ColorKind,x,!1,g.colorsAttrDesc.stride)}if(g.matricesIndicesAttrDesc&&g.matricesIndicesAttrDesc.count>0){for(var j=new Int32Array(t,g.matricesIndicesAttrDesc.offset,g.matricesIndicesAttrDesc.count),V=[],z=0;z<j.length;z++){var w=j[z];V.push(w&255),V.push((w&65280)>>8),V.push((w&16711680)>>16),V.push(w>>24&255)}e.setVerticesData(n.b.MatricesIndicesKind,V,!1)}if(g.matricesIndicesExtraAttrDesc&&g.matricesIndicesExtraAttrDesc.count>0){for(var j=new Int32Array(t,g.matricesIndicesExtraAttrDesc.offset,g.matricesIndicesExtraAttrDesc.count),V=[],z=0;z<j.length;z++){var w=j[z];V.push(w&255),V.push((w&65280)>>8),V.push((w&16711680)>>16),V.push(w>>24&255)}e.setVerticesData(n.b.MatricesIndicesExtraKind,V,!1)}if(g.matricesWeightsAttrDesc&&g.matricesWeightsAttrDesc.count>0){var R=new Float32Array(t,g.matricesWeightsAttrDesc.offset,g.matricesWeightsAttrDesc.count);e.setVerticesData(n.b.MatricesWeightsKind,R,!1)}if(g.indicesAttrDesc&&g.indicesAttrDesc.count>0){var L=new Int32Array(t,g.indicesAttrDesc.offset,g.indicesAttrDesc.count);e.setIndices(L,null)}if(g.subMeshesAttrDesc&&g.subMeshesAttrDesc.count>0){var N=new Int32Array(t,g.subMeshesAttrDesc.offset,g.subMeshesAttrDesc.count*5);e.subMeshes=[];for(var z=0;z<g.subMeshesAttrDesc.count;z++){var B=N[z*5+0],X=N[z*5+1],K=N[z*5+2],G=N[z*5+3],I=N[z*5+4];c.a.AddToMesh(B,X,K,G,I,e)}}}else if(t.positions&&t.normals&&t.indices){if(e.setVerticesData(n.b.PositionKind,t.positions,t.positions._updatable),e.setVerticesData(n.b.NormalKind,t.normals,t.normals._updatable),t.tangents&&e.setVerticesData(n.b.TangentKind,t.tangents,t.tangents._updatable),t.uvs&&e.setVerticesData(n.b.UVKind,t.uvs,t.uvs._updatable),t.uvs2&&e.setVerticesData(n.b.UV2Kind,t.uvs2,t.uvs2._updatable),t.uvs3&&e.setVerticesData(n.b.UV3Kind,t.uvs3,t.uvs3._updatable),t.uvs4&&e.setVerticesData(n.b.UV4Kind,t.uvs4,t.uvs4._updatable),t.uvs5&&e.setVerticesData(n.b.UV5Kind,t.uvs5,t.uvs5._updatable),t.uvs6&&e.setVerticesData(n.b.UV6Kind,t.uvs6,t.uvs6._updatable),t.colors&&e.setVerticesData(n.b.ColorKind,d.b.CheckColors4(t.colors,t.positions.length/3),t.colors._updatable),t.matricesIndices)if(t.matricesIndices._isExpanded)delete t.matricesIndices._isExpanded,e.setVerticesData(n.b.MatricesIndicesKind,t.matricesIndices,t.matricesIndices._updatable);else{for(var V=[],z=0;z<t.matricesIndices.length;z++){var A=t.matricesIndices[z];V.push(A&255),V.push((A&65280)>>8),V.push((A&16711680)>>16),V.push(A>>24&255)}e.setVerticesData(n.b.MatricesIndicesKind,V,t.matricesIndices._updatable)}if(t.matricesIndicesExtra)if(t.matricesIndicesExtra._isExpanded)delete t.matricesIndices._isExpanded,e.setVerticesData(n.b.MatricesIndicesExtraKind,t.matricesIndicesExtra,t.matricesIndicesExtra._updatable);else{for(var V=[],z=0;z<t.matricesIndicesExtra.length;z++){var A=t.matricesIndicesExtra[z];V.push(A&255),V.push((A&65280)>>8),V.push((A&16711680)>>16),V.push(A>>24&255)}e.setVerticesData(n.b.MatricesIndicesExtraKind,V,t.matricesIndicesExtra._updatable)}t.matricesWeights&&(h._CleanMatricesWeights(t,e),e.setVerticesData(n.b.MatricesWeightsKind,t.matricesWeights,t.matricesWeights._updatable)),t.matricesWeightsExtra&&e.setVerticesData(n.b.MatricesWeightsExtraKind,t.matricesWeightsExtra,t.matricesWeights._updatable),e.setIndices(t.indices,null)}if(t.subMeshes){e.subMeshes=[];for(var S=0;S<t.subMeshes.length;S++){var C=t.subMeshes[S];c.a.AddToMesh(C.materialIndex,C.verticesStart,C.verticesCount,C.indexStart,C.indexCount,e)}}e._shouldGenerateFlatShading&&(e.convertToFlatShadedMesh(),e._shouldGenerateFlatShading=!1),e.computeWorldMatrix(!0),i.onMeshImportedObservable.notifyObservers(e)},h._CleanMatricesWeights=function(t,e){var i=.001;if(!!a.a.CleanBoneMatrixWeights){var r=0;if(t.skeletonId>-1){var o=e.getScene().getLastSkeletonByID(t.skeletonId);if(!o)return;r=o.bones.length}else return;for(var g=e.getVerticesData(n.b.MatricesIndicesKind),y=e.getVerticesData(n.b.MatricesIndicesExtraKind),v=t.matricesWeights,f=t.matricesWeightsExtra,b=t.numBoneInfluencer,T=v.length,E=0;E<T;E+=4){for(var O=0,D=-1,F=0;F<4;F++){var x=v[E+F];O+=x,x<i&&D<0&&(D=F)}if(f)for(var F=0;F<4;F++){var x=f[E+F];O+=x,x<i&&D<0&&(D=F+4)}if((D<0||D>b-1)&&(D=b-1),O>i){for(var j=1/O,F=0;F<4;F++)v[E+F]*=j;if(f)for(var F=0;F<4;F++)f[E+F]*=j}else D>=4?(f[E+D-4]=1-O,y[E+D-4]=r):(v[E+D]=1-O,g[E+D]=r)}e.setVerticesData(n.b.MatricesIndicesKind,g),t.matricesWeightsExtra&&e.setVerticesData(n.b.MatricesIndicesExtraKind,y)}},h.Parse=function(t,e,i){if(e.getGeometryByID(t.id))return null;var r=new h(t.id,e,void 0,t.updatable);return u.a&&u.a.AddTagsTo(r,t.tags),t.delayLoadingFile?(r.delayLoadState=4,r.delayLoadingFile=i+t.delayLoadingFile,r._boundingInfo=new _.a(P.e.FromArray(t.boundingBoxMinimum),P.e.FromArray(t.boundingBoxMaximum)),r._delayInfo=[],t.hasUVs&&r._delayInfo.push(n.b.UVKind),t.hasUVs2&&r._delayInfo.push(n.b.UV2Kind),t.hasUVs3&&r._delayInfo.push(n.b.UV3Kind),t.hasUVs4&&r._delayInfo.push(n.b.UV4Kind),t.hasUVs5&&r._delayInfo.push(n.b.UV5Kind),t.hasUVs6&&r._delayInfo.push(n.b.UV6Kind),t.hasColors&&r._delayInfo.push(n.b.ColorKind),t.hasMatricesIndices&&r._delayInfo.push(n.b.MatricesIndicesKind),t.hasMatricesWeights&&r._delayInfo.push(n.b.MatricesWeightsKind),r._delayLoadingFunction=m.a.ImportVertexData):m.a.ImportVertexData(t,r),e.pushGeometry(r,!0),r},h}()},function($,W,M){"use strict";M.d(W,"b",function(){return h}),M.d(W,"d",function(){return t}),M.d(W,"c",function(){return e}),M.d(W,"a",function(){return i});var P=M(434),d=M(519),m=M(660),n=M(438),c=M(611),a=M(712),_=function(r){Object(P.d)(o,r);function o(){return r!==null&&r.apply(this,arguments)||this}return o._setPrototypeOf=Object.setPrototypeOf||function(g,y){return g.__proto__=y,g},o}(Error),s=M(473),u=M(800),p=M(467),l=M(448),h=function(r){Object(P.d)(o,r);function o(g,y){var v=r.call(this,g)||this;return v.name="LoadFileError",_._setPrototypeOf(v,o.prototype),y instanceof d.a?v.request=y:v.file=y,v}return o}(_),t=function(r){Object(P.d)(o,r);function o(g,y){var v=r.call(this,g)||this;return v.request=y,v.name="RequestFileError",_._setPrototypeOf(v,o.prototype),v}return o}(_),e=function(r){Object(P.d)(o,r);function o(g,y){var v=r.call(this,g)||this;return v.file=y,v.name="ReadFileError",_._setPrototypeOf(v,o.prototype),v}return o}(_),i=function(){function r(){}return r._CleanUrl=function(o){return o=o.replace(/#/mg,"%23"),o},r.SetCorsBehavior=function(o,g){if(!(o&&o.indexOf("data:")===0)&&r.CorsBehavior)if(typeof r.CorsBehavior=="string"||this.CorsBehavior instanceof String)g.crossOrigin=r.CorsBehavior;else{var y=r.CorsBehavior(o);y&&(g.crossOrigin=y)}},r.LoadImage=function(o,g,y,v,f){var b;f===void 0&&(f="");var T,E=!1;o instanceof ArrayBuffer||ArrayBuffer.isView(o)?typeof Blob!="undefined"?(T=URL.createObjectURL(new Blob([o],{type:f})),E=!0):T="data:"+f+";base64,"+s.a.EncodeArrayBufferToBase64(o):o instanceof Blob?(T=URL.createObjectURL(o),E=!0):(T=r._CleanUrl(o),T=r.PreprocessUrl(o));var O=l.a.LastCreatedEngine;if(typeof Image=="undefined"||((b=O==null?void 0:O._features.forceBitmapOverHTMLImageElement)!==null&&b!==void 0?b:!1))return r.LoadFile(T,function(R){createImageBitmap(new Blob([R],{type:f}),{premultiplyAlpha:"none"}).then(function(L){g(L),E&&URL.revokeObjectURL(T)}).catch(function(L){y&&y("Error while trying to load image: "+o,L)})},void 0,v||void 0,!0,function(R,L){y&&y("Error while trying to load image: "+o,L)}),null;var D=new Image;r.SetCorsBehavior(T,D);var F=function(){D.removeEventListener("load",F),D.removeEventListener("error",x),g(D),E&&D.src&&URL.revokeObjectURL(D.src)},x=function(R){if(D.removeEventListener("load",F),D.removeEventListener("error",x),y){var L=o.toString();y("Error while trying to load image: "+(L.length<32?L:L.slice(0,32)+"..."),R)}E&&D.src&&URL.revokeObjectURL(D.src)};D.addEventListener("load",F),D.addEventListener("error",x);var j=function(){D.src=T},V=function(){v&&v.loadImage(T,D)};if(T.substr(0,5)!=="data:"&&v&&v.enableTexturesOffline)v.open(V,j);else{if(T.indexOf("file:")!==-1){var z=decodeURIComponent(T.substring(5).toLowerCase());if(c.a.FilesToLoad[z]){try{var w;try{w=URL.createObjectURL(c.a.FilesToLoad[z])}catch(R){w=URL.createObjectURL(c.a.FilesToLoad[z])}D.src=w,E=!0}catch(R){D.src=""}return D}}j()}return D},r.ReadFile=function(o,g,y,v,f){var b=new FileReader,T={onCompleteObservable:new n.c,abort:function(){return b.abort()}};return b.onloadend=function(E){return T.onCompleteObservable.notifyObservers(T)},f&&(b.onerror=function(E){f(new e("Unable to read "+o.name,o))}),b.onload=function(E){g(E.target.result)},y&&(b.onprogress=y),v?b.readAsArrayBuffer(o):b.readAsText(o),T},r.LoadFile=function(o,g,y,v,f,b){if(o.indexOf("file:")!==-1){var T=decodeURIComponent(o.substring(5).toLowerCase());T.indexOf("./")===0&&(T=T.substring(2));var E=c.a.FilesToLoad[T];if(E)return r.ReadFile(E,g,y,f,b?function(O){return b(void 0,new h(O.message,O.file))}:void 0)}return r.RequestFile(o,function(O,D){g(O,D?D.responseURL:void 0)},y,v,f,b?function(O){b(O.request,new h(O.message,O.request))}:void 0)},r.RequestFile=function(o,g,y,v,f,b,T){o=r._CleanUrl(o),o=r.PreprocessUrl(o);var E=r.BaseUrl+o,O=!1,D={onCompleteObservable:new n.c,abort:function(){return O=!0}},F=function(){var V=new d.a,z=null;D.abort=function(){O=!0,V.readyState!==(XMLHttpRequest.DONE||4)&&V.abort(),z!==null&&(clearTimeout(z),z=null)};var w=function(R){V.open("GET",E),T&&T(V),f&&(V.responseType="arraybuffer"),y&&V.addEventListener("progress",y);var L=function(){V.removeEventListener("loadend",L),D.onCompleteObservable.notifyObservers(D),D.onCompleteObservable.clear()};V.addEventListener("loadend",L);var N=function(){if(!O&&V.readyState===(XMLHttpRequest.DONE||4)){if(V.removeEventListener("readystatechange",N),V.status>=200&&V.status<300||V.status===0&&(!m.a.IsWindowObjectExist()||r.IsFileURL())){g(f?V.response:V.responseText,V);return}var B=r.DefaultRetryStrategy;if(B){var X=B(E,V,R);if(X!==-1){V.removeEventListener("loadend",L),V=new d.a,z=setTimeout(function(){return w(R+1)},X);return}}var K=new t("Error status: "+V.status+" "+V.statusText+" - Unable to load "+E,V);b&&b(K)}};V.addEventListener("readystatechange",N),V.send()};w(0)};if(v&&v.enableSceneOffline){var x=function(V){V&&V.status>400?b&&b(V):F()},j=function(){v&&v.loadFile(r.BaseUrl+o,function(V){O||g(V),D.onCompleteObservable.notifyObservers(D)},y?function(V){O||y(V)}:void 0,x,f)};v.open(j,x)}else F();return D},r.IsFileURL=function(){return typeof location!="undefined"&&location.protocol==="file:"},r.DefaultRetryStrategy=a.a.ExponentialBackoff(),r.BaseUrl="",r.CorsBehavior="anonymous",r.PreprocessUrl=function(o){return o},r}();p.a._FileToolsLoadImage=i.LoadImage.bind(i),p.a._FileToolsLoadFile=i.LoadFile.bind(i),u.a._FileToolsLoadFile=i.LoadFile.bind(i)},function($,W,M){"use strict";M.d(W,"a",function(){return d});var P=M(711),d=function(){function m(){}return m.EnableFor=function(n){n._tags=n._tags||{},n.hasTags=function(){return m.HasTags(n)},n.addTags=function(c){return m.AddTagsTo(n,c)},n.removeTags=function(c){return m.RemoveTagsFrom(n,c)},n.matchesTagsQuery=function(c){return m.MatchesQuery(n,c)}},m.DisableFor=function(n){delete n._tags,delete n.hasTags,delete n.addTags,delete n.removeTags,delete n.matchesTagsQuery},m.HasTags=function(n){if(!n._tags)return!1;var c=n._tags;for(var a in c)if(c.hasOwnProperty(a))return!0;return!1},m.GetTags=function(n,c){if(c===void 0&&(c=!0),!n._tags)return null;if(c){var a=[];for(var _ in n._tags)n._tags.hasOwnProperty(_)&&n._tags[_]===!0&&a.push(_);return a.join(" ")}else return n._tags},m.AddTagsTo=function(n,c){if(!!c&&typeof c=="string"){var a=c.split(" ");a.forEach(function(_,s,u){m._AddTagTo(n,_)})}},m._AddTagTo=function(n,c){c=c.trim(),!(c===""||c==="true"||c==="false")&&(c.match(/[\s]/)||c.match(/^([!]|([|]|[&]){2})/)||(m.EnableFor(n),n._tags[c]=!0))},m.RemoveTagsFrom=function(n,c){if(!!m.HasTags(n)){var a=c.split(" ");for(var _ in a)m._RemoveTagFrom(n,a[_])}},m._RemoveTagFrom=function(n,c){delete n._tags[c]},m.MatchesQuery=function(n,c){return c===void 0?!0:c===""?m.HasTags(n):P.a.Eval(c,function(a){return m.HasTags(n)&&n._tags[a]})},m}()},,,,function($,W,M){"use strict";M.d(W,"a",function(){return P});var P=function(){function d(m,n,c){this.bu=m,this.bv=n,this.distance=c,this.faceId=0,this.subMeshId=0}return d}()},function($,W,M){"use strict";M.d(W,"a",function(){return P});var P=function(){function d(){}return Object.defineProperty(d,"ForceFullSceneLoadingForIncremental",{get:function(){return d._ForceFullSceneLoadingForIncremental},set:function(m){d._ForceFullSceneLoadingForIncremental=m},enumerable:!1,configurable:!0}),Object.defineProperty(d,"ShowLoadingScreen",{get:function(){return d._ShowLoadingScreen},set:function(m){d._ShowLoadingScreen=m},enumerable:!1,configurable:!0}),Object.defineProperty(d,"loggingLevel",{get:function(){return d._loggingLevel},set:function(m){d._loggingLevel=m},enumerable:!1,configurable:!0}),Object.defineProperty(d,"CleanBoneMatrixWeights",{get:function(){return d._CleanBoneMatrixWeights},set:function(m){d._CleanBoneMatrixWeights=m},enumerable:!1,configurable:!0}),d._ForceFullSceneLoadingForIncremental=!1,d._ShowLoadingScreen=!0,d._CleanBoneMatrixWeights=!1,d._loggingLevel=0,d}()},function($,W,M){"use strict";M.d(W,"a",function(){return P});var P=function(){function d(){this.hoverCursor="",this.actions=new Array,this.isRecursive=!1}return Object.defineProperty(d,"HasTriggers",{get:function(){for(var m in d.Triggers)if(d.Triggers.hasOwnProperty(m))return!0;return!1},enumerable:!1,configurable:!0}),Object.defineProperty(d,"HasPickTriggers",{get:function(){for(var m in d.Triggers)if(d.Triggers.hasOwnProperty(m)){var n=parseInt(m);if(n>=1&&n<=7)return!0}return!1},enumerable:!1,configurable:!0}),d.HasSpecificTrigger=function(m){for(var n in d.Triggers)if(d.Triggers.hasOwnProperty(n)){var c=parseInt(n);if(c===m)return!0}return!1},d.Triggers={},d}()},function($,W,M){"use strict";M.d(W,"a",function(){return P});var P=function(){function d(){}return d.SetMatrixPrecision=function(m){if(d.MatrixTrackPrecisionChange=!1,m&&!d.MatrixUse64Bits&&d.MatrixTrackedMatrices)for(var n=0;n<d.MatrixTrackedMatrices.length;++n){var c=d.MatrixTrackedMatrices[n],a=c._m;c._m=new Array(16);for(var _=0;_<16;++_)c._m[_]=a[_]}d.MatrixUse64Bits=m,d.MatrixCurrentType=d.MatrixUse64Bits?Array:Float32Array,d.MatrixTrackedMatrices=null},d.MatrixUse64Bits=!1,d.MatrixTrackPrecisionChange=!0,d.MatrixCurrentType=Float32Array,d.MatrixTrackedMatrices=[],d}()},function($,W,M){"use strict";M.d(W,"a",function(){return P});var P=function(){function d(m,n,c,a,_,s){this.source=m,this.pointerX=n,this.pointerY=c,this.meshUnderPointer=a,this.sourceEvent=_,this.additionalData=s}return d.CreateNew=function(m,n,c){var a=m.getScene();return new d(m,a.pointerX,a.pointerY,a.meshUnderPointer||m,n,c)},d.CreateNewFromSprite=function(m,n,c,a){return new d(m,n.pointerX,n.pointerY,n.meshUnderPointer,c,a)},d.CreateNewFromScene=function(m,n){return new d(null,m.pointerX,m.pointerY,m.meshUnderPointer,n)},d.CreateNewFromPrimitive=function(m,n,c,a){return new d(m,n.x,n.y,null,c,a)},d}()},function($,W,M){"use strict";M.d(W,"a",function(){return P});var P=function(){function d(m,n,c){this.name=m,this.from=n,this.to=c}return d.prototype.clone=function(){return new d(this.name,this.from,this.to)},d}()},function($,W,M){"use strict";M.d(W,"a",function(){return P}),M.d(W,"c",function(){return d}),M.d(W,"b",function(){return m}),M.d(W,"e",function(){return n}),M.d(W,"d",function(){return c});var P;(function(a){a[a.Generic=0]="Generic",a[a.Keyboard=1]="Keyboard",a[a.Mouse=2]="Mouse",a[a.Touch=3]="Touch",a[a.DualShock=4]="DualShock",a[a.Xbox=5]="Xbox",a[a.Switch=6]="Switch"})(P||(P={}));var d;(function(a){a[a.Horizontal=0]="Horizontal",a[a.Vertical=1]="Vertical",a[a.LeftClick=2]="LeftClick",a[a.MiddleClick=3]="MiddleClick",a[a.RightClick=4]="RightClick",a[a.BrowserBack=5]="BrowserBack",a[a.BrowserForward=6]="BrowserForward",a[a.MouseWheelX=7]="MouseWheelX",a[a.MouseWheelY=8]="MouseWheelY",a[a.MouseWheelZ=9]="MouseWheelZ",a[a.DeltaHorizontal=10]="DeltaHorizontal",a[a.DeltaVertical=11]="DeltaVertical"})(d||(d={}));var m;(function(a){a[a.Cross=0]="Cross",a[a.Circle=1]="Circle",a[a.Square=2]="Square",a[a.Triangle=3]="Triangle",a[a.L1=4]="L1",a[a.R1=5]="R1",a[a.L2=6]="L2",a[a.R2=7]="R2",a[a.Share=8]="Share",a[a.Options=9]="Options",a[a.L3=10]="L3",a[a.R3=11]="R3",a[a.DPadUp=12]="DPadUp",a[a.DPadDown=13]="DPadDown",a[a.DPadLeft=14]="DPadLeft",a[a.DPadRight=15]="DPadRight",a[a.Home=16]="Home",a[a.TouchPad=17]="TouchPad",a[a.LStickXAxis=18]="LStickXAxis",a[a.LStickYAxis=19]="LStickYAxis",a[a.RStickXAxis=20]="RStickXAxis",a[a.RStickYAxis=21]="RStickYAxis"})(m||(m={}));var n;(function(a){a[a.A=0]="A",a[a.B=1]="B",a[a.X=2]="X",a[a.Y=3]="Y",a[a.LB=4]="LB",a[a.RB=5]="RB",a[a.LT=6]="LT",a[a.RT=7]="RT",a[a.Back=8]="Back",a[a.Start=9]="Start",a[a.LS=10]="LS",a[a.RS=11]="RS",a[a.DPadUp=12]="DPadUp",a[a.DPadDown=13]="DPadDown",a[a.DPadLeft=14]="DPadLeft",a[a.DPadRight=15]="DPadRight",a[a.Home=16]="Home",a[a.LStickXAxis=17]="LStickXAxis",a[a.LStickYAxis=18]="LStickYAxis",a[a.RStickXAxis=19]="RStickXAxis",a[a.RStickYAxis=20]="RStickYAxis"})(n||(n={}));var c;(function(a){a[a.B=0]="B",a[a.A=1]="A",a[a.Y=2]="Y",a[a.X=3]="X",a[a.L=4]="L",a[a.R=5]="R",a[a.ZL=6]="ZL",a[a.ZR=7]="ZR",a[a.Minus=8]="Minus",a[a.Plus=9]="Plus",a[a.LS=10]="LS",a[a.RS=11]="RS",a[a.DPadUp=12]="DPadUp",a[a.DPadDown=13]="DPadDown",a[a.DPadLeft=14]="DPadLeft",a[a.DPadRight=15]="DPadRight",a[a.Home=16]="Home",a[a.Capture=17]="Capture",a[a.LStickXAxis=18]="LStickXAxis",a[a.LStickYAxis=19]="LStickYAxis",a[a.RStickXAxis=20]="RStickXAxis",a[a.RStickYAxis=21]="RStickYAxis"})(c||(c={}))},function($,W,M){"use strict";var P=M(435),d="sceneUboDeclaration",m=`layout(std140,column_major) uniform;
uniform Scene {
mat4 viewProjection;
#ifdef MULTIVIEW
mat4 viewProjectionR;
#endif
mat4 view;
mat4 projection;
vec4 vEyePosition;
};
`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},function($,W,M){"use strict";var P=M(435),d="bumpVertex",m=`#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)
#if defined(TANGENT) && defined(NORMAL)
vec3 tbnNormal=normalize(normalUpdated);
vec3 tbnTangent=normalize(tangentUpdated.xyz);
vec3 tbnBitangent=cross(tbnNormal,tbnTangent)*tangentUpdated.w;
vTBN=mat3(finalWorld)*mat3(tbnTangent,tbnBitangent,tbnNormal);
#endif
#endif`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},,,,,,function($,W,M){"use strict";M.d(W,"a",function(){return P});var P=function(){function d(m){m===void 0&&(m=!0),this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,m&&this.reset()}return Object.defineProperty(d.prototype,"isDirty",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"zOffset",{get:function(){return this._zOffset},set:function(m){this._zOffset!==m&&(this._zOffset=m,this._isZOffsetDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"cullFace",{get:function(){return this._cullFace},set:function(m){this._cullFace!==m&&(this._cullFace=m,this._isCullFaceDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"cull",{get:function(){return this._cull},set:function(m){this._cull!==m&&(this._cull=m,this._isCullDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(m){this._depthFunc!==m&&(this._depthFunc=m,this._isDepthFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"depthMask",{get:function(){return this._depthMask},set:function(m){this._depthMask!==m&&(this._depthMask=m,this._isDepthMaskDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"depthTest",{get:function(){return this._depthTest},set:function(m){this._depthTest!==m&&(this._depthTest=m,this._isDepthTestDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"frontFace",{get:function(){return this._frontFace},set:function(m){this._frontFace!==m&&(this._frontFace=m,this._isFrontFaceDirty=!0)},enumerable:!1,configurable:!0}),d.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1},d.prototype.apply=function(m){!this.isDirty||(this._isCullDirty&&(this.cull?m.enable(m.CULL_FACE):m.disable(m.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(m.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(m.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?m.enable(m.DEPTH_TEST):m.disable(m.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(m.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset?(m.enable(m.POLYGON_OFFSET_FILL),m.polygonOffset(this.zOffset,0)):m.disable(m.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(m.frontFace(this.frontFace),this._isFrontFaceDirty=!1))},d}()},function($,W,M){"use strict";M.d(W,"a",function(){return P});var P=function(){function d(m){m===void 0&&(m=!0),this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,m&&this.reset()}return Object.defineProperty(d.prototype,"isDirty",{get:function(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"stencilFunc",{get:function(){return this._stencilFunc},set:function(m){this._stencilFunc!==m&&(this._stencilFunc=m,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"stencilFuncRef",{get:function(){return this._stencilFuncRef},set:function(m){this._stencilFuncRef!==m&&(this._stencilFuncRef=m,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"stencilFuncMask",{get:function(){return this._stencilFuncMask},set:function(m){this._stencilFuncMask!==m&&(this._stencilFuncMask=m,this._isStencilFuncDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"stencilOpStencilFail",{get:function(){return this._stencilOpStencilFail},set:function(m){this._stencilOpStencilFail!==m&&(this._stencilOpStencilFail=m,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"stencilOpDepthFail",{get:function(){return this._stencilOpDepthFail},set:function(m){this._stencilOpDepthFail!==m&&(this._stencilOpDepthFail=m,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"stencilOpStencilDepthPass",{get:function(){return this._stencilOpStencilDepthPass},set:function(m){this._stencilOpStencilDepthPass!==m&&(this._stencilOpStencilDepthPass=m,this._isStencilOpDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"stencilMask",{get:function(){return this._stencilMask},set:function(m){this._stencilMask!==m&&(this._stencilMask=m,this._isStencilMaskDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"stencilTest",{get:function(){return this._stencilTest},set:function(m){this._stencilTest!==m&&(this._stencilTest=m,this._isStencilTestDirty=!0)},enumerable:!1,configurable:!0}),d.prototype.reset=function(){this._stencilTest=!1,this._stencilMask=255,this._stencilFunc=d.ALWAYS,this._stencilFuncRef=1,this._stencilFuncMask=255,this._stencilOpStencilFail=d.KEEP,this._stencilOpDepthFail=d.KEEP,this._stencilOpStencilDepthPass=d.REPLACE,this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0},d.prototype.apply=function(m){!this.isDirty||(this._isStencilTestDirty&&(this.stencilTest?m.enable(m.STENCIL_TEST):m.disable(m.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(m.stencilMask(this.stencilMask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(m.stencilFunc(this.stencilFunc,this.stencilFuncRef,this.stencilFuncMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(m.stencilOp(this.stencilOpStencilFail,this.stencilOpDepthFail,this.stencilOpStencilDepthPass),this._isStencilOpDirty=!1))},d.ALWAYS=519,d.KEEP=7680,d.REPLACE=7681,d}()},function($,W,M){"use strict";M.d(W,"a",function(){return P});var P=function(){function d(){}return d.prototype.attributeProcessor=function(m){return m.replace("attribute","in")},d.prototype.varyingProcessor=function(m,n){return m.replace("varying",n?"in":"out")},d.prototype.postProcessor=function(m,n,c,a,_){var s=m.search(/#extension.+GL_EXT_draw_buffers.+require/)!==-1,u=/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g;if(m=m.replace(u,""),m=m.replace(/texture2D\s*\(/g,"texture("),c)m=m.replace(/texture2DLodEXT\s*\(/g,"textureLod("),m=m.replace(/textureCubeLodEXT\s*\(/g,"textureLod("),m=m.replace(/textureCube\s*\(/g,"texture("),m=m.replace(/gl_FragDepthEXT/g,"gl_FragDepth"),m=m.replace(/gl_FragColor/g,"glFragColor"),m=m.replace(/gl_FragData/g,"glFragData"),m=m.replace(/void\s+?main\s*\(/g,(s?"":`out vec4 glFragColor;
`)+"void main(");else{var p=n.indexOf("#define MULTIVIEW")!==-1;if(p)return`#extension GL_OVR_multiview2 : require
layout (num_views = 2) in;
`+m}return m},d}()},function($,W,M){"use strict";M.d(W,"a",function(){return P});var P=function(){function d(){this._count=0,this._data={}}return d.prototype.copyFrom=function(m){var n=this;this.clear(),m.forEach(function(c,a){return n.add(c,a)})},d.prototype.get=function(m){var n=this._data[m];if(n!==void 0)return n},d.prototype.getOrAddWithFactory=function(m,n){var c=this.get(m);return c!==void 0||(c=n(m),c&&this.add(m,c)),c},d.prototype.getOrAdd=function(m,n){var c=this.get(m);return c!==void 0?c:(this.add(m,n),n)},d.prototype.contains=function(m){return this._data[m]!==void 0},d.prototype.add=function(m,n){return this._data[m]!==void 0?!1:(this._data[m]=n,++this._count,!0)},d.prototype.set=function(m,n){return this._data[m]===void 0?!1:(this._data[m]=n,!0)},d.prototype.getAndRemove=function(m){var n=this.get(m);return n!==void 0?(delete this._data[m],--this._count,n):null},d.prototype.remove=function(m){return this.contains(m)?(delete this._data[m],--this._count,!0):!1},d.prototype.clear=function(){this._data={},this._count=0},Object.defineProperty(d.prototype,"count",{get:function(){return this._count},enumerable:!1,configurable:!0}),d.prototype.forEach=function(m){for(var n in this._data){var c=this._data[n];m(n,c)}},d.prototype.first=function(m){for(var n in this._data){var c=this._data[n],a=m(n,c);if(a)return a}return null},d}()},function($,W,M){"use strict";var P=M(467);P.a.prototype._readTexturePixelsSync=function(d,m,n,c,a,_,s){var u,p;c===void 0&&(c=-1),a===void 0&&(a=0),_===void 0&&(_=null),s===void 0&&(s=!0);var l=this._gl;if(!l)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){var h=l.createFramebuffer();if(!h)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=h}l.bindFramebuffer(l.FRAMEBUFFER,this._dummyFramebuffer),c>-1?l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_CUBE_MAP_POSITIVE_X+c,(u=d._hardwareTexture)===null||u===void 0?void 0:u.underlyingResource,a):l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,(p=d._hardwareTexture)===null||p===void 0?void 0:p.underlyingResource,a);var t=d.type!==void 0?this._getWebGLTextureType(d.type):l.UNSIGNED_BYTE;switch(t){case l.UNSIGNED_BYTE:_||(_=new Uint8Array(4*m*n)),t=l.UNSIGNED_BYTE;break;default:_||(_=new Float32Array(4*m*n)),t=l.FLOAT;break}return s&&this.flushFramebuffer(),l.readPixels(0,0,m,n,l.RGBA,t,_),l.bindFramebuffer(l.FRAMEBUFFER,this._currentFramebuffer),_},P.a.prototype._readTexturePixels=function(d,m,n,c,a,_,s){return c===void 0&&(c=-1),a===void 0&&(a=0),_===void 0&&(_=null),s===void 0&&(s=!0),Promise.resolve(this._readTexturePixelsSync(d,m,n,c,a,_,s))}},function($,W,M){"use strict";M.d(W,"a",function(){return n});var P=M(588),d=M(436),m=M(515),n=function(){function c(a,_,s){this.vectors=P.a.BuildArray(8,d.e.Zero),this.center=d.e.Zero(),this.centerWorld=d.e.Zero(),this.extendSize=d.e.Zero(),this.extendSizeWorld=d.e.Zero(),this.directions=P.a.BuildArray(3,d.e.Zero),this.vectorsWorld=P.a.BuildArray(8,d.e.Zero),this.minimumWorld=d.e.Zero(),this.maximumWorld=d.e.Zero(),this.minimum=d.e.Zero(),this.maximum=d.e.Zero(),this.reConstruct(a,_,s)}return c.prototype.reConstruct=function(a,_,s){var u=a.x,p=a.y,l=a.z,h=_.x,t=_.y,e=_.z,i=this.vectors;this.minimum.copyFromFloats(u,p,l),this.maximum.copyFromFloats(h,t,e),i[0].copyFromFloats(u,p,l),i[1].copyFromFloats(h,t,e),i[2].copyFromFloats(h,p,l),i[3].copyFromFloats(u,t,l),i[4].copyFromFloats(u,p,e),i[5].copyFromFloats(h,t,l),i[6].copyFromFloats(u,t,e),i[7].copyFromFloats(h,p,e),_.addToRef(a,this.center).scaleInPlace(.5),_.subtractToRef(a,this.extendSize).scaleInPlace(.5),this._worldMatrix=s||d.a.IdentityReadOnly,this._update(this._worldMatrix)},c.prototype.scale=function(a){var _=c.TmpVector3,s=this.maximum.subtractToRef(this.minimum,_[0]),u=s.length();s.normalizeFromLength(u);var p=u*a,l=s.scaleInPlace(p*.5),h=this.center.subtractToRef(l,_[1]),t=this.center.addToRef(l,_[2]);return this.reConstruct(h,t,this._worldMatrix),this},c.prototype.getWorldMatrix=function(){return this._worldMatrix},c.prototype._update=function(a){var _=this.minimumWorld,s=this.maximumWorld,u=this.directions,p=this.vectorsWorld,l=this.vectors;if(a.isIdentity()){_.copyFrom(this.minimum),s.copyFrom(this.maximum);for(var h=0;h<8;++h)p[h].copyFrom(l[h]);this.extendSizeWorld.copyFrom(this.extendSize),this.centerWorld.copyFrom(this.center)}else{_.setAll(Number.MAX_VALUE),s.setAll(-Number.MAX_VALUE);for(var h=0;h<8;++h){var t=p[h];d.e.TransformCoordinatesToRef(l[h],a,t),_.minimizeInPlace(t),s.maximizeInPlace(t)}s.subtractToRef(_,this.extendSizeWorld).scaleInPlace(.5),s.addToRef(_,this.centerWorld).scaleInPlace(.5)}d.e.FromArrayToRef(a.m,0,u[0]),d.e.FromArrayToRef(a.m,4,u[1]),d.e.FromArrayToRef(a.m,8,u[2]),this._worldMatrix=a},c.prototype.isInFrustum=function(a){return c.IsInFrustum(this.vectorsWorld,a)},c.prototype.isCompletelyInFrustum=function(a){return c.IsCompletelyInFrustum(this.vectorsWorld,a)},c.prototype.intersectsPoint=function(a){var _=this.minimumWorld,s=this.maximumWorld,u=_.x,p=_.y,l=_.z,h=s.x,t=s.y,e=s.z,i=a.x,r=a.y,o=a.z,g=-m.a;return!(h-i<g||g>i-u||t-r<g||g>r-p||e-o<g||g>o-l)},c.prototype.intersectsSphere=function(a){return c.IntersectsSphere(this.minimumWorld,this.maximumWorld,a.centerWorld,a.radiusWorld)},c.prototype.intersectsMinMax=function(a,_){var s=this.minimumWorld,u=this.maximumWorld,p=s.x,l=s.y,h=s.z,t=u.x,e=u.y,i=u.z,r=a.x,o=a.y,g=a.z,y=_.x,v=_.y,f=_.z;return!(t<r||p>y||e<o||l>v||i<g||h>f)},c.Intersects=function(a,_){return a.intersectsMinMax(_.minimumWorld,_.maximumWorld)},c.IntersectsSphere=function(a,_,s,u){var p=c.TmpVector3[0];d.e.ClampToRef(s,a,_,p);var l=d.e.DistanceSquared(s,p);return l<=u*u},c.IsCompletelyInFrustum=function(a,_){for(var s=0;s<6;++s)for(var u=_[s],p=0;p<8;++p)if(u.dotCoordinate(a[p])<0)return!1;return!0},c.IsInFrustum=function(a,_){for(var s=0;s<6;++s){for(var u=!0,p=_[s],l=0;l<8;++l)if(p.dotCoordinate(a[l])>=0){u=!1;break}if(u)return!1}return!0},c.TmpVector3=P.a.BuildArray(3,d.e.Zero),c}()},function($,W,M){"use strict";M.d(W,"a",function(){return m});var P=M(588),d=M(436),m=function(){function n(c,a,_){this.center=d.e.Zero(),this.centerWorld=d.e.Zero(),this.minimum=d.e.Zero(),this.maximum=d.e.Zero(),this.reConstruct(c,a,_)}return n.prototype.reConstruct=function(c,a,_){this.minimum.copyFrom(c),this.maximum.copyFrom(a);var s=d.e.Distance(c,a);a.addToRef(c,this.center).scaleInPlace(.5),this.radius=s*.5,this._update(_||d.a.IdentityReadOnly)},n.prototype.scale=function(c){var a=this.radius*c,_=n.TmpVector3,s=_[0].setAll(a),u=this.center.subtractToRef(s,_[1]),p=this.center.addToRef(s,_[2]);return this.reConstruct(u,p,this._worldMatrix),this},n.prototype.getWorldMatrix=function(){return this._worldMatrix},n.prototype._update=function(c){if(c.isIdentity())this.centerWorld.copyFrom(this.center),this.radiusWorld=this.radius;else{d.e.TransformCoordinatesToRef(this.center,c,this.centerWorld);var a=n.TmpVector3[0];d.e.TransformNormalFromFloatsToRef(1,1,1,c,a),this.radiusWorld=Math.max(Math.abs(a.x),Math.abs(a.y),Math.abs(a.z))*this.radius}},n.prototype.isInFrustum=function(c){for(var a=this.centerWorld,_=this.radiusWorld,s=0;s<6;s++)if(c[s].dotCoordinate(a)<=-_)return!1;return!0},n.prototype.isCenterInFrustum=function(c){for(var a=this.centerWorld,_=0;_<6;_++)if(c[_].dotCoordinate(a)<0)return!1;return!0},n.prototype.intersectsPoint=function(c){var a=d.e.DistanceSquared(this.centerWorld,c);return!(this.radiusWorld*this.radiusWorld<a)},n.Intersects=function(c,a){var _=d.e.DistanceSquared(c.centerWorld,a.centerWorld),s=c.radiusWorld+a.radiusWorld;return!(s*s<_)},n.TmpVector3=P.a.BuildArray(3,d.e.Zero),n}()},function($,W,M){"use strict";M.d(W,"a",function(){return P}),M.d(W,"b",function(){return d});var P;(function(m){m[m.PointerMove=0]="PointerMove",m[m.PointerDown=1]="PointerDown",m[m.PointerUp=2]="PointerUp"})(P||(P={}));var d=function(){function m(){}return m.DOM_DELTA_PIXEL=0,m.DOM_DELTA_LINE=1,m.DOM_DELTA_PAGE=2,m}()},function($,W,M){"use strict";M.d(W,"a",function(){return m});var P=M(443),d=M(673),m=function(){function n(c){this.onDeviceDisconnected=function(){},this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._keyboardDownEvent=function(_){},this._keyboardUpEvent=function(_){},this._keyboardBlurEvent=function(_){},this._pointerMoveEvent=function(_){},this._pointerDownEvent=function(_){},this._pointerUpEvent=function(_){},this._pointerWheelEvent=function(_){},this._pointerBlurEvent=function(_){},this._gamepadConnectedEvent=function(_){},this._gamepadDisconnectedEvent=function(_){},this._onDeviceConnected=function(){};var a=c.getInputElement();this._eventPrefix=P.b.GetPointerPrefix(c),a&&(this._elementToAttachTo=a,this._elementToAttachTo.tabIndex=this._elementToAttachTo.tabIndex!==-1?this._elementToAttachTo.tabIndex:c.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._checkForConnectedDevices())}return Object.defineProperty(n.prototype,"onDeviceConnected",{get:function(){return this._onDeviceConnected},set:function(c){this._onDeviceConnected=c;for(var a=0;a<this._inputs.length;a++)if(this._inputs[a])for(var _=0;_<this._inputs[a].length;_++)this._inputs[a][_]&&this._onDeviceConnected(a,_)},enumerable:!1,configurable:!0}),n.Create=function(c){return typeof _native!="undefined"&&_native.DeviceInputSystem?new _native.DeviceInputSystem(c):new n(c)},n.prototype.pollInput=function(c,a,_){var s=this._inputs[c][a];if(!s)throw"Unable to find device "+d.a[c];if(this._updateDevice(c,a,_),s[_]===void 0)throw"Unable to find input "+_+" for device "+d.a[c]+" in slot "+a;if(c===d.a.Mouse&&_>=d.c.MouseWheelX&&_<=d.c.MouseWheelZ){var u=s[_];return s[_]=0,u}return s[_]},n.prototype.isDeviceAvailable=function(c){return this._inputs[c]!==void 0},n.prototype.dispose=function(){this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._keyboardActive&&(this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent)),this._pointerActive&&(this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent)),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)},n.prototype._checkForConnectedDevices=function(){for(var c=navigator.getGamepads(),a=0,_=c;a<_.length;a++){var s=_[a];s&&this._addGamePad(s)}matchMedia("(pointer:fine)").matches&&this._addPointerDevice(d.a.Mouse,0,0,0)},n.prototype._addGamePad=function(c){var a=this._getGamepadDeviceType(c.id),_=c.index;this._registerDevice(a,_,c.buttons.length+c.axes.length),this._gamepads=this._gamepads||new Array(c.index+1),this._gamepads[_]=a},n.prototype._addPointerDevice=function(c,a,_,s){this._pointerActive=!0,this._registerDevice(c,a,n._MAX_POINTER_INPUTS);var u=this._inputs[c][a];u[0]=_,u[1]=s},n.prototype._registerDevice=function(c,a,_){if(this._inputs[c]||(this._inputs[c]=[]),!this._inputs[c][a]){for(var s=new Array(_),u=0;u<_;u++)s[u]=0;this._inputs[c][a]=s,this.onDeviceConnected(c,a)}},n.prototype._unregisterDevice=function(c,a){this._inputs[c][a]&&(delete this._inputs[c][a],this.onDeviceDisconnected(c,a))},n.prototype._handleKeyActions=function(){var c=this;this._keyboardDownEvent=function(a){c._keyboardActive||(c._keyboardActive=!0,c._registerDevice(d.a.Keyboard,0,n._MAX_KEYCODES));var _=c._inputs[d.a.Keyboard][0];_&&(_[a.keyCode]=1,c.onInputChanged&&c.onInputChanged(d.a.Keyboard,0,a.keyCode,0,_[a.keyCode],a))},this._keyboardUpEvent=function(a){c._keyboardActive||(c._keyboardActive=!0,c._registerDevice(d.a.Keyboard,0,n._MAX_KEYCODES));var _=c._inputs[d.a.Keyboard][0];_&&(_[a.keyCode]=0,c.onInputChanged&&c.onInputChanged(d.a.Keyboard,0,a.keyCode,1,_[a.keyCode],a))},this._keyboardBlurEvent=function(a){if(c._keyboardActive)for(var _=c._inputs[d.a.Keyboard][0],s=0;s<_.length;s++)_[s]!==0&&(_[s]=0)},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)},n.prototype._handlePointerActions=function(){var c=this;this._pointerMoveEvent=function(u){var p=u.pointerType==="mouse"?d.a.Mouse:d.a.Touch,l=u.pointerType==="mouse"?0:u.pointerId;c._inputs[p]||(c._inputs[p]=[]),c._inputs[p][l]||c._addPointerDevice(p,l,u.clientX,u.clientY);var h=c._inputs[p][l];if(h){var t=h[d.c.Horizontal],e=h[d.c.Vertical],i=h[d.c.DeltaHorizontal],r=h[d.c.DeltaVertical];h[d.c.Horizontal]=u.clientX,h[d.c.Vertical]=u.clientY,h[d.c.DeltaHorizontal]=u.movementX,h[d.c.DeltaVertical]=u.movementY,c.onInputChanged&&(t!==u.clientX&&c.onInputChanged(p,l,d.c.Horizontal,t,h[d.c.Horizontal],u),e!==u.clientY&&c.onInputChanged(p,l,d.c.Vertical,e,h[d.c.Vertical],u),h[d.c.DeltaHorizontal]!==0&&c.onInputChanged(p,l,d.c.DeltaHorizontal,i,h[d.c.DeltaHorizontal],u),h[d.c.DeltaVertical]!==0&&c.onInputChanged(p,l,d.c.DeltaVertical,r,h[d.c.DeltaVertical],u))}},this._pointerDownEvent=function(u){var p=u.pointerType==="mouse"?d.a.Mouse:d.a.Touch,l=u.pointerType==="mouse"?0:u.pointerId;c._inputs[p]||(c._inputs[p]=[]),c._inputs[p][l]||c._addPointerDevice(p,l,u.clientX,u.clientY);var h=c._inputs[p][l];if(h){var t=h[d.c.Horizontal],e=h[d.c.Vertical],i=h[u.button+2];h[d.c.Horizontal]=u.clientX,h[d.c.Vertical]=u.clientY,h[u.button+2]=1,c.onInputChanged&&(t!==u.clientX&&c.onInputChanged(p,l,d.c.Horizontal,t,h[d.c.Horizontal],u),e!==u.clientY&&c.onInputChanged(p,l,d.c.Vertical,e,h[d.c.Vertical],u),c.onInputChanged(p,l,u.button+2,i,h[u.button+2],u))}},this._pointerUpEvent=function(u){var p=u.pointerType==="mouse"?d.a.Mouse:d.a.Touch,l=u.pointerType==="mouse"?0:u.pointerId,h=c._inputs[p][l];if(h){var t=h[d.c.Horizontal],e=h[d.c.Vertical],i=h[u.button+2];h[d.c.Horizontal]=u.clientX,h[d.c.Vertical]=u.clientY,h[u.button+2]=0,c.onInputChanged&&(t!==u.clientX&&c.onInputChanged(p,l,d.c.Horizontal,t,h[d.c.Horizontal],u),e!==u.clientY&&c.onInputChanged(p,l,d.c.Vertical,e,h[d.c.Vertical],u),c.onInputChanged(p,l,u.button+2,i,h[u.button+2],u))}u.pointerType!=="mouse"&&c._unregisterDevice(p,l)},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll";var a=!1,_=function(){};try{var s={passive:{get:function(){a=!0}}};this._elementToAttachTo.addEventListener("test",_,s),this._elementToAttachTo.removeEventListener("test",_,s)}catch(u){}this._pointerBlurEvent=function(u){var p;if(c.isDeviceAvailable(d.a.Mouse))for(var l=c._inputs[d.a.Mouse][0],h=0;h<=d.c.BrowserForward;h++)l[h+2]===1&&(l[h+2]=0,c.onInputChanged&&c.onInputChanged(d.a.Mouse,0,h+2,1,l[h+2]));if(c.isDeviceAvailable(d.a.Touch))for(var l=c._inputs[d.a.Touch],h=0;h<l.length;h++)((p=l[h])===null||p===void 0?void 0:p[d.c.LeftClick])===1&&(l[h][d.c.LeftClick]=0,c.onInputChanged&&c.onInputChanged(d.a.Touch,h,d.c.LeftClick,1,l[h][d.c.LeftClick]),c._unregisterDevice(d.a.Touch,h))},this._pointerWheelEvent=function(u){var p=d.a.Mouse,l=0;c._inputs[p]||(c._inputs[p]=[]),c._inputs[p][l]||(c._pointerActive=!0,c._registerDevice(p,l,n._MAX_POINTER_INPUTS));var h=c._inputs[p][l];if(h){var t=h[d.c.MouseWheelX],e=h[d.c.MouseWheelY],i=h[d.c.MouseWheelZ];h[d.c.MouseWheelX]=u.deltaX,h[d.c.MouseWheelY]=u.deltaY,h[d.c.MouseWheelZ]=u.deltaZ,c.onInputChanged&&(u.deltaX!==0&&c.onInputChanged(p,l,d.c.MouseWheelX,t,h[d.c.MouseWheelX],u),u.deltaY!==0&&c.onInputChanged(p,l,d.c.MouseWheelY,e,h[d.c.MouseWheelY],u),u.deltaZ!==0&&c.onInputChanged(p,l,d.c.MouseWheelZ,i,h[d.c.MouseWheelZ],u))}},this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,a?{passive:!1}:!1)},n.prototype._handleGamepadActions=function(){var c=this;this._gamepadConnectedEvent=function(a){c._addGamePad(a.gamepad)},this._gamepadDisconnectedEvent=function(a){if(c._gamepads){var _=c._getGamepadDeviceType(a.gamepad.id),s=a.gamepad.index;c._unregisterDevice(_,s),delete c._gamepads[s]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)},n.prototype._updateDevice=function(c,a,_){var s=navigator.getGamepads()[a];if(s&&c===this._gamepads[a]){var u=this._inputs[c][a];_>=s.buttons.length?u[_]=s.axes[_-s.buttons.length].valueOf():u[_]=s.buttons[_].value}},n.prototype._getGamepadDeviceType=function(c){return c.indexOf("054c")!==-1&&c.indexOf("0ce6")===-1?d.a.DualShock:c.indexOf("Xbox One")!==-1||c.search("Xbox 360")!==-1||c.search("xinput")!==-1?d.a.Xbox:c.indexOf("057e")!==-1?d.a.Switch:d.a.Generic},n._MAX_KEYCODES=255,n._MAX_POINTER_INPUTS=Object.keys(d.c).length/2,n}()},function($,W,M){"use strict";M.d(W,"a",function(){return P});var P=function(){function d(){}return d.BindClipPlane=function(m,n){if(n.clipPlane){var c=n.clipPlane;m.setFloat4("vClipPlane",c.normal.x,c.normal.y,c.normal.z,c.d)}if(n.clipPlane2){var c=n.clipPlane2;m.setFloat4("vClipPlane2",c.normal.x,c.normal.y,c.normal.z,c.d)}if(n.clipPlane3){var c=n.clipPlane3;m.setFloat4("vClipPlane3",c.normal.x,c.normal.y,c.normal.z,c.d)}if(n.clipPlane4){var c=n.clipPlane4;m.setFloat4("vClipPlane4",c.normal.x,c.normal.y,c.normal.z,c.d)}if(n.clipPlane5){var c=n.clipPlane5;m.setFloat4("vClipPlane5",c.normal.x,c.normal.y,c.normal.z,c.d)}if(n.clipPlane6){var c=n.clipPlane6;m.setFloat4("vClipPlane6",c.normal.x,c.normal.y,c.normal.z,c.d)}},d}()},function($,W,M){"use strict";M.d(W,"a",function(){return c});var P=M(434),d=M(439),m=M(443),n=M(464),c=function(){function a(){this.buttons=[0,1,2]}return a.prototype.attachControl=function(_){var s=this;_=m.b.BackCompatCameraNoPreventDefault(arguments);var u=this.camera.getEngine(),p=u.getInputElement(),l=0,h=null;this.pointA=null,this.pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=function(e,i){var r=e.event,o=r.pointerType==="touch";if(!u.isInVRExclusivePointerMode&&!(e.type!==n.a.POINTERMOVE&&s.buttons.indexOf(r.button)===-1)){var g=r.srcElement||r.target;if(s._altKey=r.altKey,s._ctrlKey=r.ctrlKey,s._metaKey=r.metaKey,s._shiftKey=r.shiftKey,s._buttonsPressed=r.buttons,u.isPointerLock){var y=r.movementX||r.mozMovementX||r.webkitMovementX||r.msMovementX||0,v=r.movementY||r.mozMovementY||r.webkitMovementY||r.msMovementY||0;s.onTouch(null,y,v),s.pointA=null,s.pointB=null}else if(e.type===n.a.POINTERDOWN&&g){try{g.setPointerCapture(r.pointerId)}catch(D){}s.pointA===null?s.pointA={x:r.clientX,y:r.clientY,pointerId:r.pointerId,type:r.pointerType}:s.pointB===null&&(s.pointB={x:r.clientX,y:r.clientY,pointerId:r.pointerId,type:r.pointerType}),s.onButtonDown(r),_||(r.preventDefault(),p&&p.focus())}else if(e.type===n.a.POINTERDOUBLETAP)s.onDoubleTap(r.pointerType);else if(e.type===n.a.POINTERUP&&g){try{g.releasePointerCapture(r.pointerId)}catch(D){}o||(s.pointB=null),u._badOS?s.pointA=s.pointB=null:s.pointB&&s.pointA&&s.pointA.pointerId==r.pointerId?(s.pointA=s.pointB,s.pointB=null):s.pointA&&s.pointB&&s.pointB.pointerId==r.pointerId?s.pointB=null:s.pointA=s.pointB=null,(l!==0||h)&&(s.onMultiTouch(s.pointA,s.pointB,l,0,h,null),l=0,h=null),s.onButtonUp(r),_||r.preventDefault()}else if(e.type===n.a.POINTERMOVE){if(_||r.preventDefault(),s.pointA&&s.pointB===null){var y=r.clientX-s.pointA.x,v=r.clientY-s.pointA.y;s.onTouch(s.pointA,y,v),s.pointA.x=r.clientX,s.pointA.y=r.clientY}else if(s.pointA&&s.pointB){var f=s.pointA.pointerId===r.pointerId?s.pointA:s.pointB;f.x=r.clientX,f.y=r.clientY;var b=s.pointA.x-s.pointB.x,T=s.pointA.y-s.pointB.y,E=b*b+T*T,O={x:(s.pointA.x+s.pointB.x)/2,y:(s.pointA.y+s.pointB.y)/2,pointerId:r.pointerId,type:e.type};s.onMultiTouch(s.pointA,s.pointB,l,E,h,O),h=O,l=E}}}},this._observer=this.camera.getScene().onPointerObservable.add(this._pointerInput,n.a.POINTERDOWN|n.a.POINTERUP|n.a.POINTERMOVE),this._onLostFocus=function(){s.pointA=s.pointB=null,l=0,h=null,s.onLostFocus()},p&&p.addEventListener("contextmenu",this.onContextMenu.bind(this),!1);var t=this.camera.getScene().getEngine().getHostWindow();t&&m.b.RegisterTopRootEvents(t,[{name:"blur",handler:this._onLostFocus}])},a.prototype.detachControl=function(_){if(this._onLostFocus){var s=this.camera.getScene().getEngine().getHostWindow();s&&m.b.UnregisterTopRootEvents(s,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this.onContextMenu){var u=this.camera.getScene().getEngine().getInputElement();u&&u.removeEventListener("contextmenu",this.onContextMenu)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0},a.prototype.getClassName=function(){return"BaseCameraPointersInput"},a.prototype.getSimpleName=function(){return"pointers"},a.prototype.onDoubleTap=function(_){},a.prototype.onTouch=function(_,s,u){},a.prototype.onMultiTouch=function(_,s,u,p,l,h){},a.prototype.onContextMenu=function(_){_.preventDefault()},a.prototype.onButtonDown=function(_){},a.prototype.onButtonUp=function(_){},a.prototype.onLostFocus=function(){},Object(P.c)([Object(d.c)()],a.prototype,"buttons",void 0),a}()},,,,,,,,,function($,W,M){"use strict";M.d(W,"a",function(){return P});var P=function(){function d(m,n){this.width=m,this.height=n}return d.prototype.toString=function(){return"{W: "+this.width+", H: "+this.height+"}"},d.prototype.getClassName=function(){return"Size"},d.prototype.getHashCode=function(){var m=this.width|0;return m=m*397^(this.height|0),m},d.prototype.copyFrom=function(m){this.width=m.width,this.height=m.height},d.prototype.copyFromFloats=function(m,n){return this.width=m,this.height=n,this},d.prototype.set=function(m,n){return this.copyFromFloats(m,n)},d.prototype.multiplyByFloats=function(m,n){return new d(this.width*m,this.height*n)},d.prototype.clone=function(){return new d(this.width,this.height)},d.prototype.equals=function(m){return m?this.width===m.width&&this.height===m.height:!1},Object.defineProperty(d.prototype,"surface",{get:function(){return this.width*this.height},enumerable:!1,configurable:!0}),d.Zero=function(){return new d(0,0)},d.prototype.add=function(m){var n=new d(this.width+m.width,this.height+m.height);return n},d.prototype.subtract=function(m){var n=new d(this.width-m.width,this.height-m.height);return n},d.Lerp=function(m,n,c){var a=m.width+(n.width-m.width)*c,_=m.height+(n.height-m.height)*c;return new d(a,_)},d}()},function($,W,M){"use strict";var P=M(435),d="logDepthFragment",m=`#ifdef LOGARITHMICDEPTH
gl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;
#endif`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},function($,W,M){"use strict";var P=M(435),d="fogVertex",m=`#ifdef FOG
vFogDistance=(view*worldPos).xyz;
#endif`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},function($,W,M){"use strict";var P=M(435),d="logDepthVertex",m=`#ifdef LOGARITHMICDEPTH
vFragmentDepth=1.0+gl_Position.w;
gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;
#endif`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},,,,function($,W,M){"use strict";M.d(W,"a",function(){return P});var P;(function(d){d[d.STEP=1]="STEP"})(P||(P={}))},function($,W,M){"use strict";M.d(W,"a",function(){return m});var P=M(434),d=M(563),m=function(n){Object(P.d)(c,n);function c(a){var _=n.call(this)||this;return _._buffer=a,_}return Object.defineProperty(c.prototype,"underlyingResource",{get:function(){return this._buffer},enumerable:!1,configurable:!0}),c}(d.a)},function($,W,M){"use strict";M.d(W,"a",function(){return P});var P=function(){function d(){}return d.RandomId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(m){var n=Math.random()*16|0,c=m==="x"?n:n&3|8;return c.toString(16)})},d}()},function($,W,M){"use strict";M.d(W,"b",function(){return d}),M.d(W,"a",function(){return m});var P=M(436);function d(n,c,a,_,s){s===void 0&&(s=null);for(var u=new P.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),p=new P.e(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),l=a;l<a+_;l++){var h=c[l]*3,t=n[h],e=n[h+1],i=n[h+2];u.minimizeInPlaceFromFloats(t,e,i),p.maximizeInPlaceFromFloats(t,e,i)}return s&&(u.x-=u.x*s.x+s.y,u.y-=u.y*s.x+s.y,u.z-=u.z*s.x+s.y,p.x+=p.x*s.x+s.y,p.y+=p.y*s.x+s.y,p.z+=p.z*s.x+s.y),{minimum:u,maximum:p}}function m(n,c,a,_,s){_===void 0&&(_=null);var u=new P.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),p=new P.e(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);s||(s=3);for(var l=c,h=c*s;l<c+a;l++,h+=s){var t=n[h],e=n[h+1],i=n[h+2];u.minimizeInPlaceFromFloats(t,e,i),p.maximizeInPlaceFromFloats(t,e,i)}return _&&(u.x-=u.x*_.x+_.y,u.y-=u.y*_.x+_.y,u.z-=u.z*_.x+_.y,p.x+=p.x*_.x+_.y,p.y+=p.y*_.x+_.y,p.z+=p.z*_.x+_.y),{minimum:u,maximum:p}}},function($,W,M){"use strict";M.d(W,"a",function(){return P});var P=function(){function d(){}return d.Eval=function(m,n){return m.match(/\([^\(\)]*\)/g)?m=m.replace(/\([^\(\)]*\)/g,function(c){return c=c.slice(1,c.length-1),d._HandleParenthesisContent(c,n)}):m=d._HandleParenthesisContent(m,n),m==="true"?!0:m==="false"?!1:d.Eval(m,n)},d._HandleParenthesisContent=function(m,n){n=n||function(h){return h==="true"};var c,a=m.split("||");for(var _ in a)if(a.hasOwnProperty(_)){var s=d._SimplifyNegation(a[_].trim()),u=s.split("&&");if(u.length>1)for(var p=0;p<u.length;++p){var l=d._SimplifyNegation(u[p].trim());if(l!=="true"&&l!=="false"?l[0]==="!"?c=!n(l.substring(1)):c=n(l):c=l==="true",!c){s="false";break}}if(c||s==="true"){c=!0;break}s!=="true"&&s!=="false"?s[0]==="!"?c=!n(s.substring(1)):c=n(s):c=s==="true"}return c?"true":"false"},d._SimplifyNegation=function(m){return m=m.replace(/^[\s!]+/,function(n){return n=n.replace(/[\s]/g,function(){return""}),n.length%2?"!":""}),m=m.trim(),m==="!true"?m="false":m==="!false"&&(m="true"),m},d}()},function($,W,M){"use strict";M.d(W,"a",function(){return P});var P=function(){function d(){}return d.ExponentialBackoff=function(m,n){return m===void 0&&(m=3),n===void 0&&(n=500),function(c,a,_){return a.status!==0||_>=m||c.indexOf("file:")!==-1?-1:Math.pow(2,_)*n}},d}()},function($,W,M){"use strict";M.d(W,"a",function(){return P});var P=function(){function d(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}return Object.defineProperty(d.prototype,"isDirty",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"alphaBlend",{get:function(){return this._alphaBlend},set:function(m){this._alphaBlend!==m&&(this._alphaBlend=m,this._isAlphaBlendDirty=!0)},enumerable:!1,configurable:!0}),d.prototype.setAlphaBlendConstants=function(m,n,c,a){this._blendConstants[0]===m&&this._blendConstants[1]===n&&this._blendConstants[2]===c&&this._blendConstants[3]===a||(this._blendConstants[0]=m,this._blendConstants[1]=n,this._blendConstants[2]=c,this._blendConstants[3]=a,this._isBlendConstantsDirty=!0)},d.prototype.setAlphaBlendFunctionParameters=function(m,n,c,a){this._blendFunctionParameters[0]===m&&this._blendFunctionParameters[1]===n&&this._blendFunctionParameters[2]===c&&this._blendFunctionParameters[3]===a||(this._blendFunctionParameters[0]=m,this._blendFunctionParameters[1]=n,this._blendFunctionParameters[2]=c,this._blendFunctionParameters[3]=a,this._isBlendFunctionParametersDirty=!0)},d.prototype.setAlphaEquationParameters=function(m,n){this._blendEquationParameters[0]===m&&this._blendEquationParameters[1]===n||(this._blendEquationParameters[0]=m,this._blendEquationParameters[1]=n,this._isBlendEquationParametersDirty=!0)},d.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1},d.prototype.apply=function(m){!this.isDirty||(this._isAlphaBlendDirty&&(this._alphaBlend?m.enable(m.BLEND):m.disable(m.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(m.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(m.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(m.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))},d}()},function($,W,M){"use strict";M.d(W,"a",function(){return P});var P=function(){function d(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null}return Object.defineProperty(d.prototype,"isAsync",{get:function(){return this.isParallelCompiled},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"isReady",{get:function(){return this.program?this.isParallelCompiled?this.engine._isRenderingStateCompiled(this):!0:!1},enumerable:!1,configurable:!0}),d.prototype._handlesSpectorRebuildCallback=function(m){m&&this.program&&m(this.program)},d.prototype._fillEffectInformation=function(m,n,c,a,_,s,u,p){var l=this.engine;if(l.supportsUniformBuffers)for(var h in n)m.bindUniformBlock(h,n[h]);var t=this.engine.getUniforms(this,c);t.forEach(function(y,v){a[c[v]]=y}),this._uniforms=a;var e;for(e=0;e<_.length;e++){var i=m.getUniform(_[e]);i==null&&(_.splice(e,1),e--)}_.forEach(function(y,v){s[y]=v});for(var r=0,o=l.getAttributes(this,u);r<o.length;r++){var g=o[r];p.push(g)}},d.prototype.dispose=function(){this._uniforms={}},d.prototype._cacheMatrix=function(m,n){var c=this._valueCache[m],a=n.updateFlag;return c!==void 0&&c===a?!1:(this._valueCache[m]=a,!0)},d.prototype._cacheFloat2=function(m,n,c){var a=this._valueCache[m];if(!a||a.length!==2)return a=[n,c],this._valueCache[m]=a,!0;var _=!1;return a[0]!==n&&(a[0]=n,_=!0),a[1]!==c&&(a[1]=c,_=!0),_},d.prototype._cacheFloat3=function(m,n,c,a){var _=this._valueCache[m];if(!_||_.length!==3)return _=[n,c,a],this._valueCache[m]=_,!0;var s=!1;return _[0]!==n&&(_[0]=n,s=!0),_[1]!==c&&(_[1]=c,s=!0),_[2]!==a&&(_[2]=a,s=!0),s},d.prototype._cacheFloat4=function(m,n,c,a,_){var s=this._valueCache[m];if(!s||s.length!==4)return s=[n,c,a,_],this._valueCache[m]=s,!0;var u=!1;return s[0]!==n&&(s[0]=n,u=!0),s[1]!==c&&(s[1]=c,u=!0),s[2]!==a&&(s[2]=a,u=!0),s[3]!==_&&(s[3]=_,u=!0),u},d.prototype.setInt=function(m,n){var c=this._valueCache[m];c!==void 0&&c===n||this.engine.setInt(this._uniforms[m],n)&&(this._valueCache[m]=n)},d.prototype.setInt2=function(m,n,c){this._cacheFloat2(m,n,c)&&(this.engine.setInt2(this._uniforms[m],n,c)||(this._valueCache[m]=null))},d.prototype.setInt3=function(m,n,c,a){this._cacheFloat3(m,n,c,a)&&(this.engine.setInt3(this._uniforms[m],n,c,a)||(this._valueCache[m]=null))},d.prototype.setInt4=function(m,n,c,a,_){this._cacheFloat4(m,n,c,a,_)&&(this.engine.setInt4(this._uniforms[m],n,c,a,_)||(this._valueCache[m]=null))},d.prototype.setIntArray=function(m,n){this._valueCache[m]=null,this.engine.setIntArray(this._uniforms[m],n)},d.prototype.setIntArray2=function(m,n){this._valueCache[m]=null,this.engine.setIntArray2(this._uniforms[m],n)},d.prototype.setIntArray3=function(m,n){this._valueCache[m]=null,this.engine.setIntArray3(this._uniforms[m],n)},d.prototype.setIntArray4=function(m,n){this._valueCache[m]=null,this.engine.setIntArray4(this._uniforms[m],n)},d.prototype.setArray=function(m,n){this._valueCache[m]=null,this.engine.setArray(this._uniforms[m],n)},d.prototype.setArray2=function(m,n){this._valueCache[m]=null,this.engine.setArray2(this._uniforms[m],n)},d.prototype.setArray3=function(m,n){this._valueCache[m]=null,this.engine.setArray3(this._uniforms[m],n)},d.prototype.setArray4=function(m,n){this._valueCache[m]=null,this.engine.setArray4(this._uniforms[m],n)},d.prototype.setMatrices=function(m,n){!n||(this._valueCache[m]=null,this.engine.setMatrices(this._uniforms[m],n))},d.prototype.setMatrix=function(m,n){this._cacheMatrix(m,n)&&(this.engine.setMatrices(this._uniforms[m],n.toArray())||(this._valueCache[m]=null))},d.prototype.setMatrix3x3=function(m,n){this._valueCache[m]=null,this.engine.setMatrix3x3(this._uniforms[m],n)},d.prototype.setMatrix2x2=function(m,n){this._valueCache[m]=null,this.engine.setMatrix2x2(this._uniforms[m],n)},d.prototype.setFloat=function(m,n){var c=this._valueCache[m];c!==void 0&&c===n||this.engine.setFloat(this._uniforms[m],n)&&(this._valueCache[m]=n)},d.prototype.setVector2=function(m,n){this._cacheFloat2(m,n.x,n.y)&&(this.engine.setFloat2(this._uniforms[m],n.x,n.y)||(this._valueCache[m]=null))},d.prototype.setFloat2=function(m,n,c){this._cacheFloat2(m,n,c)&&(this.engine.setFloat2(this._uniforms[m],n,c)||(this._valueCache[m]=null))},d.prototype.setVector3=function(m,n){this._cacheFloat3(m,n.x,n.y,n.z)&&(this.engine.setFloat3(this._uniforms[m],n.x,n.y,n.z)||(this._valueCache[m]=null))},d.prototype.setFloat3=function(m,n,c,a){this._cacheFloat3(m,n,c,a)&&(this.engine.setFloat3(this._uniforms[m],n,c,a)||(this._valueCache[m]=null))},d.prototype.setVector4=function(m,n){this._cacheFloat4(m,n.x,n.y,n.z,n.w)&&(this.engine.setFloat4(this._uniforms[m],n.x,n.y,n.z,n.w)||(this._valueCache[m]=null))},d.prototype.setFloat4=function(m,n,c,a,_){this._cacheFloat4(m,n,c,a,_)&&(this.engine.setFloat4(this._uniforms[m],n,c,a,_)||(this._valueCache[m]=null))},d.prototype.setColor3=function(m,n){this._cacheFloat3(m,n.r,n.g,n.b)&&(this.engine.setFloat3(this._uniforms[m],n.r,n.g,n.b)||(this._valueCache[m]=null))},d.prototype.setColor4=function(m,n,c){this._cacheFloat4(m,n.r,n.g,n.b,c)&&(this.engine.setFloat4(this._uniforms[m],n.r,n.g,n.b,c)||(this._valueCache[m]=null))},d.prototype.setDirectColor4=function(m,n){this._cacheFloat4(m,n.r,n.g,n.b,n.a)&&(this.engine.setFloat4(this._uniforms[m],n.r,n.g,n.b,n.a)||(this._valueCache[m]=null))},d.prototype._getVertexShaderCode=function(){return this.vertexShader?this.engine._getShaderSource(this.vertexShader):null},d.prototype._getFragmentShaderCode=function(){return this.fragmentShader?this.engine._getShaderSource(this.fragmentShader):null},d}()},function($,W,M){"use strict";M.d(W,"a",function(){return n});var P;(function(c){c[c.Pending=0]="Pending",c[c.Fulfilled=1]="Fulfilled",c[c.Rejected=2]="Rejected"})(P||(P={}));var d=function(){function c(){this.count=0,this.target=0,this.results=[]}return c}(),m=function(){function c(a){var _=this;if(this._state=P.Pending,this._children=new Array,this._rejectWasConsumed=!1,!!a)try{a(function(s){_._resolve(s)},function(s){_._reject(s)})}catch(s){this._reject(s)}}return Object.defineProperty(c.prototype,"_result",{get:function(){return this._resultValue},set:function(a){this._resultValue=a,this._parent&&this._parent._result===void 0&&(this._parent._result=a)},enumerable:!1,configurable:!0}),c.prototype.catch=function(a){return this.then(void 0,a)},c.prototype.then=function(a,_){var s=this,u=new c;return u._onFulfilled=a,u._onRejected=_,this._children.push(u),u._parent=this,this._state!==P.Pending&&setTimeout(function(){s._state===P.Fulfilled||s._rejectWasConsumed?u._resolve(s._result):u._reject(s._reason)}),u},c.prototype._moveChildren=function(a){var _,s=this;if((_=this._children).push.apply(_,a.splice(0,a.length)),this._children.forEach(function(e){e._parent=s}),this._state===P.Fulfilled)for(var u=0,p=this._children;u<p.length;u++){var l=p[u];l._resolve(this._result)}else if(this._state===P.Rejected)for(var h=0,t=this._children;h<t.length;h++){var l=t[h];l._reject(this._reason)}},c.prototype._resolve=function(a){try{this._state=P.Fulfilled;var _=null;if(this._onFulfilled&&(_=this._onFulfilled(a)),_!=null)if(_._state!==void 0){var s=_;s._parent=this,s._moveChildren(this._children),a=s._result}else a=_;this._result=a;for(var u=0,p=this._children;u<p.length;u++){var l=p[u];l._resolve(a)}this._children.length=0,delete this._onFulfilled,delete this._onRejected}catch(h){this._reject(h,!0)}},c.prototype._reject=function(a,_){if(_===void 0&&(_=!1),this._state=P.Rejected,this._reason=a,this._onRejected&&!_)try{this._onRejected(a),this._rejectWasConsumed=!0}catch(l){a=l}for(var s=0,u=this._children;s<u.length;s++){var p=u[s];this._rejectWasConsumed?p._resolve(null):p._reject(a)}this._children.length=0,delete this._onFulfilled,delete this._onRejected},c.resolve=function(a){var _=new c;return _._resolve(a),_},c._RegisterForFulfillment=function(a,_,s){a.then(function(u){return _.results[s]=u,_.count++,_.count===_.target&&_.rootPromise._resolve(_.results),null},function(u){_.rootPromise._state!==P.Rejected&&_.rootPromise._reject(u)})},c.all=function(a){var _=new c,s=new d;if(s.target=a.length,s.rootPromise=_,a.length)for(var u=0;u<a.length;u++)c._RegisterForFulfillment(a[u],s,u);else _._resolve([]);return _},c.race=function(a){var _=new c;if(a.length)for(var s=0,u=a;s<u.length;s++){var p=u[s];p.then(function(l){return _&&(_._resolve(l),_=null),null},function(l){_&&(_._reject(l),_=null)})}return _},c}(),n=function(){function c(){}return c.Apply=function(a){if(a===void 0&&(a=!1),a||typeof Promise=="undefined"){var _=window;_.Promise=m}},c}()},function($,W,M){"use strict";M.d(W,"a",function(){return d}),M.d(W,"b",function(){return m});var P=M(589),d=function(){function n(c){c===void 0&&(c=30),this._enabled=!0,this._rollingFrameTime=new m(c)}return n.prototype.sampleFrame=function(c){if(c===void 0&&(c=P.a.Now),!!this._enabled){if(this._lastFrameTimeMs!=null){var a=c-this._lastFrameTimeMs;this._rollingFrameTime.add(a)}this._lastFrameTimeMs=c}},Object.defineProperty(n.prototype,"averageFrameTime",{get:function(){return this._rollingFrameTime.average},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"averageFrameTimeVariance",{get:function(){return this._rollingFrameTime.variance},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"instantaneousFrameTime",{get:function(){return this._rollingFrameTime.history(0)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"averageFPS",{get:function(){return 1e3/this._rollingFrameTime.average},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"instantaneousFPS",{get:function(){var c=this._rollingFrameTime.history(0);return c===0?0:1e3/c},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isSaturated",{get:function(){return this._rollingFrameTime.isSaturated()},enumerable:!1,configurable:!0}),n.prototype.enable=function(){this._enabled=!0},n.prototype.disable=function(){this._enabled=!1,this._lastFrameTimeMs=null},Object.defineProperty(n.prototype,"isEnabled",{get:function(){return this._enabled},enumerable:!1,configurable:!0}),n.prototype.reset=function(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()},n}(),m=function(){function n(c){this._samples=new Array(c),this.reset()}return n.prototype.add=function(c){var a;if(this.isSaturated()){var _=this._samples[this._pos];a=_-this.average,this.average-=a/(this._sampleCount-1),this._m2-=a*(_-this.average)}else this._sampleCount++;a=c-this.average,this.average+=a/this._sampleCount,this._m2+=a*(c-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=c,this._pos++,this._pos%=this._samples.length},n.prototype.history=function(c){if(c>=this._sampleCount||c>=this._samples.length)return 0;var a=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(a-c)]},n.prototype.isSaturated=function(){return this._sampleCount>=this._samples.length},n.prototype.reset=function(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0},n.prototype._wrapPosition=function(c){var a=this._samples.length;return(c%a+a)%a},n}()},function($,W,M){"use strict";var P=M(467),d=M(708);P.a.prototype.createUniformBuffer=function(m){var n=this._gl.createBuffer();if(!n)throw new Error("Unable to create uniform buffer");var c=new d.a(n);return this.bindUniformBuffer(c),m instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,m,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(m),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),c.references=1,c},P.a.prototype.createDynamicUniformBuffer=function(m){var n=this._gl.createBuffer();if(!n)throw new Error("Unable to create dynamic uniform buffer");var c=new d.a(n);return this.bindUniformBuffer(c),m instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,m,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(m),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),c.references=1,c},P.a.prototype.updateUniformBuffer=function(m,n,c,a){this.bindUniformBuffer(m),c===void 0&&(c=0),a===void 0?n instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,c,n):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,c,new Float32Array(n)):n instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,n.subarray(c,c+a)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(n).subarray(c,c+a)),this.bindUniformBuffer(null)},P.a.prototype.bindUniformBuffer=function(m){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,m?m.underlyingResource:null)},P.a.prototype.bindUniformBufferBase=function(m,n,c){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,n,m?m.underlyingResource:null)},P.a.prototype.bindUniformBlock=function(m,n,c){var a=m.program,_=this._gl.getUniformBlockIndex(a,n);this._gl.uniformBlockBinding(a,_,c)}},function($,W,M){"use strict";M.d(W,"a",function(){return d});var P=M(436),d=function(){function m(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new P.e(0,0,0),this._diffPositionForCollisions=new P.e(0,0,0),this._collisionResponse=!0}return m}()},function($,W,M){"use strict";M.d(W,"a",function(){return n});var P=M(434),d=M(439),m=M(441),n=function(){function c(){this._dirty=!0,this._tempColor=new m.b(0,0,0,0),this._globalCurve=new m.b(0,0,0,0),this._highlightsCurve=new m.b(0,0,0,0),this._midtonesCurve=new m.b(0,0,0,0),this._shadowsCurve=new m.b(0,0,0,0),this._positiveCurve=new m.b(0,0,0,0),this._negativeCurve=new m.b(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}return Object.defineProperty(c.prototype,"globalHue",{get:function(){return this._globalHue},set:function(a){this._globalHue=a,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"globalDensity",{get:function(){return this._globalDensity},set:function(a){this._globalDensity=a,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"globalSaturation",{get:function(){return this._globalSaturation},set:function(a){this._globalSaturation=a,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"globalExposure",{get:function(){return this._globalExposure},set:function(a){this._globalExposure=a,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"highlightsHue",{get:function(){return this._highlightsHue},set:function(a){this._highlightsHue=a,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"highlightsDensity",{get:function(){return this._highlightsDensity},set:function(a){this._highlightsDensity=a,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"highlightsSaturation",{get:function(){return this._highlightsSaturation},set:function(a){this._highlightsSaturation=a,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"highlightsExposure",{get:function(){return this._highlightsExposure},set:function(a){this._highlightsExposure=a,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"midtonesHue",{get:function(){return this._midtonesHue},set:function(a){this._midtonesHue=a,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"midtonesDensity",{get:function(){return this._midtonesDensity},set:function(a){this._midtonesDensity=a,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"midtonesSaturation",{get:function(){return this._midtonesSaturation},set:function(a){this._midtonesSaturation=a,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"midtonesExposure",{get:function(){return this._midtonesExposure},set:function(a){this._midtonesExposure=a,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"shadowsHue",{get:function(){return this._shadowsHue},set:function(a){this._shadowsHue=a,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"shadowsDensity",{get:function(){return this._shadowsDensity},set:function(a){this._shadowsDensity=a,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"shadowsSaturation",{get:function(){return this._shadowsSaturation},set:function(a){this._shadowsSaturation=a,this._dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"shadowsExposure",{get:function(){return this._shadowsExposure},set:function(a){this._shadowsExposure=a,this._dirty=!0},enumerable:!1,configurable:!0}),c.prototype.getClassName=function(){return"ColorCurves"},c.Bind=function(a,_,s,u,p){s===void 0&&(s="vCameraColorCurvePositive"),u===void 0&&(u="vCameraColorCurveNeutral"),p===void 0&&(p="vCameraColorCurveNegative"),a._dirty&&(a._dirty=!1,a.getColorGradingDataToRef(a._globalHue,a._globalDensity,a._globalSaturation,a._globalExposure,a._globalCurve),a.getColorGradingDataToRef(a._highlightsHue,a._highlightsDensity,a._highlightsSaturation,a._highlightsExposure,a._tempColor),a._tempColor.multiplyToRef(a._globalCurve,a._highlightsCurve),a.getColorGradingDataToRef(a._midtonesHue,a._midtonesDensity,a._midtonesSaturation,a._midtonesExposure,a._tempColor),a._tempColor.multiplyToRef(a._globalCurve,a._midtonesCurve),a.getColorGradingDataToRef(a._shadowsHue,a._shadowsDensity,a._shadowsSaturation,a._shadowsExposure,a._tempColor),a._tempColor.multiplyToRef(a._globalCurve,a._shadowsCurve),a._highlightsCurve.subtractToRef(a._midtonesCurve,a._positiveCurve),a._midtonesCurve.subtractToRef(a._shadowsCurve,a._negativeCurve)),_&&(_.setFloat4(s,a._positiveCurve.r,a._positiveCurve.g,a._positiveCurve.b,a._positiveCurve.a),_.setFloat4(u,a._midtonesCurve.r,a._midtonesCurve.g,a._midtonesCurve.b,a._midtonesCurve.a),_.setFloat4(p,a._negativeCurve.r,a._negativeCurve.g,a._negativeCurve.b,a._negativeCurve.a))},c.PrepareUniforms=function(a){a.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")},c.prototype.getColorGradingDataToRef=function(a,_,s,u,p){a!=null&&(a=c.clamp(a,0,360),_=c.clamp(_,-100,100),s=c.clamp(s,-100,100),u=c.clamp(u,-100,100),_=c.applyColorGradingSliderNonlinear(_),_*=.5,u=c.applyColorGradingSliderNonlinear(u),_<0&&(_*=-1,a=(a+180)%360),c.fromHSBToRef(a,_,50+.25*u,p),p.scaleToRef(2,p),p.a=1+.01*s)},c.applyColorGradingSliderNonlinear=function(a){a/=100;var _=Math.abs(a);return _=Math.pow(_,2),a<0&&(_*=-1),_*=100,_},c.fromHSBToRef=function(a,_,s,u){var p=c.clamp(a,0,360),l=c.clamp(_/100,0,1),h=c.clamp(s/100,0,1);if(l===0)u.r=h,u.g=h,u.b=h;else{p/=60;var t=Math.floor(p),e=p-t,i=h*(1-l),r=h*(1-l*e),o=h*(1-l*(1-e));switch(t){case 0:u.r=h,u.g=o,u.b=i;break;case 1:u.r=r,u.g=h,u.b=i;break;case 2:u.r=i,u.g=h,u.b=o;break;case 3:u.r=i,u.g=r,u.b=h;break;case 4:u.r=o,u.g=i,u.b=h;break;default:u.r=h,u.g=i,u.b=r;break}}u.a=1},c.clamp=function(a,_,s){return Math.min(Math.max(a,_),s)},c.prototype.clone=function(){return d.a.Clone(function(){return new c},this)},c.prototype.serialize=function(){return d.a.Serialize(this)},c.Parse=function(a){return d.a.Parse(function(){return new c},a,null,null)},Object(P.c)([Object(d.c)()],c.prototype,"_globalHue",void 0),Object(P.c)([Object(d.c)()],c.prototype,"_globalDensity",void 0),Object(P.c)([Object(d.c)()],c.prototype,"_globalSaturation",void 0),Object(P.c)([Object(d.c)()],c.prototype,"_globalExposure",void 0),Object(P.c)([Object(d.c)()],c.prototype,"_highlightsHue",void 0),Object(P.c)([Object(d.c)()],c.prototype,"_highlightsDensity",void 0),Object(P.c)([Object(d.c)()],c.prototype,"_highlightsSaturation",void 0),Object(P.c)([Object(d.c)()],c.prototype,"_highlightsExposure",void 0),Object(P.c)([Object(d.c)()],c.prototype,"_midtonesHue",void 0),Object(P.c)([Object(d.c)()],c.prototype,"_midtonesDensity",void 0),Object(P.c)([Object(d.c)()],c.prototype,"_midtonesSaturation",void 0),Object(P.c)([Object(d.c)()],c.prototype,"_midtonesExposure",void 0),c}();d.a._ColorCurvesParser=n.Parse},function($,W,M){"use strict";M.d(W,"a",function(){return m});var P=M(490),d=M(436),m=function(){function n(c,a,_,s,u){_===void 0&&(_=null),s===void 0&&(s=null),u===void 0&&(u=null),this.index=c,this._opaqueSubMeshes=new P.a(256),this._transparentSubMeshes=new P.a(256),this._alphaTestSubMeshes=new P.a(256),this._depthOnlySubMeshes=new P.a(256),this._particleSystems=new P.a(256),this._spriteManagers=new P.a(256),this._edgesRenderers=new P.b(16),this._scene=a,this.opaqueSortCompareFn=_,this.alphaTestSortCompareFn=s,this.transparentSortCompareFn=u}return Object.defineProperty(n.prototype,"opaqueSortCompareFn",{set:function(c){this._opaqueSortCompareFn=c,c?this._renderOpaque=this.renderOpaqueSorted:this._renderOpaque=n.renderUnsorted},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"alphaTestSortCompareFn",{set:function(c){this._alphaTestSortCompareFn=c,c?this._renderAlphaTest=this.renderAlphaTestSorted:this._renderAlphaTest=n.renderUnsorted},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"transparentSortCompareFn",{set:function(c){c?this._transparentSortCompareFn=c:this._transparentSortCompareFn=n.defaultTransparentSortCompare,this._renderTransparent=this.renderTransparentSorted},enumerable:!1,configurable:!0}),n.prototype.render=function(c,a,_,s){if(c){c(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);return}var u=this._scene.getEngine();this._depthOnlySubMeshes.length!==0&&(u.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),u.setColorWrite(!0)),this._opaqueSubMeshes.length!==0&&this._renderOpaque(this._opaqueSubMeshes),this._alphaTestSubMeshes.length!==0&&this._renderAlphaTest(this._alphaTestSubMeshes);var p=u.getStencilBuffer();if(u.setStencilBuffer(!1),a&&this._renderSprites(),_&&this._renderParticles(s),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),this._transparentSubMeshes.length!==0&&(u.setStencilBuffer(p),this._renderTransparent(this._transparentSubMeshes),u.setAlphaMode(0)),u.setStencilBuffer(!1),this._edgesRenderers.length){for(var l=0;l<this._edgesRenderers.length;l++)this._edgesRenderers.data[l].render();u.setAlphaMode(0)}u.setStencilBuffer(p)},n.prototype.renderOpaqueSorted=function(c){return n.renderSorted(c,this._opaqueSortCompareFn,this._scene.activeCamera,!1)},n.prototype.renderAlphaTestSorted=function(c){return n.renderSorted(c,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)},n.prototype.renderTransparentSorted=function(c){return n.renderSorted(c,this._transparentSortCompareFn,this._scene.activeCamera,!0)},n.renderSorted=function(c,a,_,s){for(var u=0,p,l=_?_.globalPosition:n._zeroVector;u<c.length;u++)p=c.data[u],p._alphaIndex=p.getMesh().alphaIndex,p._distanceToCamera=d.e.Distance(p.getBoundingInfo().boundingSphere.centerWorld,l);var h=c.data.slice(0,c.length);for(a&&h.sort(a),u=0;u<h.length;u++){if(p=h[u],s){var t=p.getMaterial();if(t&&t.needDepthPrePass){var e=t.getScene().getEngine();e.setColorWrite(!1),e.setAlphaMode(0),p.render(!1),e.setColorWrite(!0)}}p.render(s)}},n.renderUnsorted=function(c){for(var a=0;a<c.length;a++){var _=c.data[a];_.render(!1)}},n.defaultTransparentSortCompare=function(c,a){return c._alphaIndex>a._alphaIndex?1:c._alphaIndex<a._alphaIndex?-1:n.backToFrontSortCompare(c,a)},n.backToFrontSortCompare=function(c,a){return c._distanceToCamera<a._distanceToCamera?1:c._distanceToCamera>a._distanceToCamera?-1:0},n.frontToBackSortCompare=function(c,a){return c._distanceToCamera<a._distanceToCamera?-1:c._distanceToCamera>a._distanceToCamera?1:0},n.prototype.prepare=function(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this._spriteManagers.reset(),this._edgesRenderers.reset()},n.prototype.dispose=function(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()},n.prototype.dispatch=function(c,a,_){a===void 0&&(a=c.getMesh()),_===void 0&&(_=c.getMaterial()),_!=null&&(_.needAlphaBlendingForMesh(a)?this._transparentSubMeshes.push(c):_.needAlphaTesting()?(_.needDepthPrePass&&this._depthOnlySubMeshes.push(c),this._alphaTestSubMeshes.push(c)):(_.needDepthPrePass&&this._depthOnlySubMeshes.push(c),this._opaqueSubMeshes.push(c)),a._renderingGroup=this,a._edgesRenderer&&a._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(a._edgesRenderer))},n.prototype.dispatchSprites=function(c){this._spriteManagers.push(c)},n.prototype.dispatchParticles=function(c){this._particleSystems.push(c)},n.prototype._renderParticles=function(c){if(this._particleSystems.length!==0){var a=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(var _=0;_<this._particleSystems.length;_++){var s=this._particleSystems.data[_];if((a&&a.layerMask&s.layerMask)!==0){var u=s.emitter;(!u.position||!c||c.indexOf(u)!==-1)&&this._scene._activeParticles.addCount(s.render(),!1)}}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}},n.prototype._renderSprites=function(){if(!(!this._scene.spritesEnabled||this._spriteManagers.length===0)){var c=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(var a=0;a<this._spriteManagers.length;a++){var _=this._spriteManagers.data[a];(c&&c.layerMask&_.layerMask)!==0&&_.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}},n._zeroVector=d.e.Zero(),n}()},function($,W,M){"use strict";M.d(W,"a",function(){return P});var P=function(){function d(m,n){this.distance=m,this.mesh=n}return d}()},function($,W,M){"use strict";M.d(W,"a",function(){return m});var P=M(464),d=M(589),m=function(){function n(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-Infinity,this._cameraRotationSpeed=0,this._lastFrameRadius=0}return Object.defineProperty(n.prototype,"name",{get:function(){return"AutoRotation"},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(c){this._zoomStopsAnimation=c},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"idleRotationSpeed",{get:function(){return this._idleRotationSpeed},set:function(c){this._idleRotationSpeed=c},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"idleRotationWaitTime",{get:function(){return this._idleRotationWaitTime},set:function(c){this._idleRotationWaitTime=c},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"idleRotationSpinupTime",{get:function(){return this._idleRotationSpinupTime},set:function(c){this._idleRotationSpinupTime=c},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"rotationInProgress",{get:function(){return Math.abs(this._cameraRotationSpeed)>0},enumerable:!1,configurable:!0}),n.prototype.init=function(){},n.prototype.attach=function(c){var a=this;this._attachedCamera=c;var _=this._attachedCamera.getScene();this._onPrePointerObservableObserver=_.onPrePointerObservable.add(function(s){if(s.type===P.a.POINTERDOWN){a._isPointerDown=!0;return}s.type===P.a.POINTERUP&&(a._isPointerDown=!1)}),this._onAfterCheckInputsObserver=c.onAfterCheckInputsObservable.add(function(){var s=d.a.Now,u=0;a._lastFrameTime!=null&&(u=s-a._lastFrameTime),a._lastFrameTime=s,a._applyUserInteraction();var p=s-a._lastInteractionTime-a._idleRotationWaitTime,l=Math.max(Math.min(p/a._idleRotationSpinupTime,1),0);a._cameraRotationSpeed=a._idleRotationSpeed*l,a._attachedCamera&&(a._attachedCamera.alpha-=a._cameraRotationSpeed*(u/1e3))})},n.prototype.detach=function(){if(!!this._attachedCamera){var c=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&c.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null}},n.prototype._userIsZooming=function(){return this._attachedCamera?this._attachedCamera.inertialRadiusOffset!==0:!1},n.prototype._shouldAnimationStopForInteraction=function(){if(!this._attachedCamera)return!1;var c=!1;return this._lastFrameRadius===this._attachedCamera.radius&&this._attachedCamera.inertialRadiusOffset!==0&&(c=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?c:this._userIsZooming()},n.prototype._applyUserInteraction=function(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=d.a.Now)},n.prototype._userIsMoving=function(){return this._attachedCamera?this._attachedCamera.inertialAlphaOffset!==0||this._attachedCamera.inertialBetaOffset!==0||this._attachedCamera.inertialRadiusOffset!==0||this._attachedCamera.inertialPanningX!==0||this._attachedCamera.inertialPanningY!==0||this._isPointerDown:!1},n}()},function($,W,M){"use strict";M.d(W,"a",function(){return m});var P=M(613),d=M(483),m=function(){function n(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}return Object.defineProperty(n.prototype,"name",{get:function(){return"Bouncing"},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"autoTransitionRange",{get:function(){return this._autoTransitionRange},set:function(c){var a=this;if(this._autoTransitionRange!==c){this._autoTransitionRange=c;var _=this._attachedCamera;!_||(c?this._onMeshTargetChangedObserver=_.onMeshTargetChangedObservable.add(function(s){if(!!s){s.computeWorldMatrix(!0);var u=s.getBoundingInfo().diagonalLength;a.lowerRadiusTransitionRange=u*.05,a.upperRadiusTransitionRange=u*.05}}):this._onMeshTargetChangedObserver&&_.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}},enumerable:!1,configurable:!0}),n.prototype.init=function(){},n.prototype.attach=function(c){var a=this;this._attachedCamera=c,this._onAfterCheckInputsObserver=c.onAfterCheckInputsObservable.add(function(){!a._attachedCamera||(a._isRadiusAtLimit(a._attachedCamera.lowerRadiusLimit)&&a._applyBoundRadiusAnimation(a.lowerRadiusTransitionRange),a._isRadiusAtLimit(a._attachedCamera.upperRadiusLimit)&&a._applyBoundRadiusAnimation(a.upperRadiusTransitionRange))})},n.prototype.detach=function(){!this._attachedCamera||(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)},n.prototype._isRadiusAtLimit=function(c){return this._attachedCamera?this._attachedCamera.radius===c&&!this._radiusIsAnimating:!1},n.prototype._applyBoundRadiusAnimation=function(c){var a=this;if(!!this._attachedCamera){this._radiusBounceTransition||(n.EasingFunction.setEasingMode(n.EasingMode),this._radiusBounceTransition=d.a.CreateAnimation("radius",d.a.ANIMATIONTYPE_FLOAT,60,n.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=Infinity,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;var _=d.a.TransitionTo("radius",this._attachedCamera.radius+c,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusBounceTransition,this.transitionDuration,function(){return a._clearAnimationLocks()});_&&this._animatables.push(_)}},n.prototype._clearAnimationLocks=function(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)},n.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()},n.EasingFunction=new P.a(.3),n.EasingMode=P.f.EASINGMODE_EASEOUT,n}()},function($,W,M){"use strict";M.d(W,"a",function(){return a});var P=M(613),d=M(464),m=M(589),n=M(436),c=M(483),a=function(){function _(){this._mode=_.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-Infinity,this._animatables=new Array,this._betaIsAnimating=!1}return Object.defineProperty(_.prototype,"name",{get:function(){return"Framing"},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"mode",{get:function(){return this._mode},set:function(s){this._mode=s},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"radiusScale",{get:function(){return this._radiusScale},set:function(s){this._radiusScale=s},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"positionScale",{get:function(){return this._positionScale},set:function(s){this._positionScale=s},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"defaultElevation",{get:function(){return this._defaultElevation},set:function(s){this._defaultElevation=s},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"elevationReturnTime",{get:function(){return this._elevationReturnTime},set:function(s){this._elevationReturnTime=s},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"elevationReturnWaitTime",{get:function(){return this._elevationReturnWaitTime},set:function(s){this._elevationReturnWaitTime=s},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"zoomStopsAnimation",{get:function(){return this._zoomStopsAnimation},set:function(s){this._zoomStopsAnimation=s},enumerable:!1,configurable:!0}),Object.defineProperty(_.prototype,"framingTime",{get:function(){return this._framingTime},set:function(s){this._framingTime=s},enumerable:!1,configurable:!0}),_.prototype.init=function(){},_.prototype.attach=function(s){var u=this;this._attachedCamera=s;var p=this._attachedCamera.getScene();_.EasingFunction.setEasingMode(_.EasingMode),this._onPrePointerObservableObserver=p.onPrePointerObservable.add(function(l){if(l.type===d.a.POINTERDOWN){u._isPointerDown=!0;return}l.type===d.a.POINTERUP&&(u._isPointerDown=!1)}),this._onMeshTargetChangedObserver=s.onMeshTargetChangedObservable.add(function(l){l&&u.zoomOnMesh(l)}),this._onAfterCheckInputsObserver=s.onAfterCheckInputsObservable.add(function(){u._applyUserInteraction(),u._maintainCameraAboveGround()})},_.prototype.detach=function(){if(!!this._attachedCamera){var s=this._attachedCamera.getScene();this._onPrePointerObservableObserver&&s.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}},_.prototype.zoomOnMesh=function(s,u,p){u===void 0&&(u=!1),p===void 0&&(p=null),s.computeWorldMatrix(!0);var l=s.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(l.minimumWorld,l.maximumWorld,u,p)},_.prototype.zoomOnMeshHierarchy=function(s,u,p){u===void 0&&(u=!1),p===void 0&&(p=null),s.computeWorldMatrix(!0);var l=s.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(l.min,l.max,u,p)},_.prototype.zoomOnMeshesHierarchy=function(s,u,p){u===void 0&&(u=!1),p===void 0&&(p=null);for(var l=new n.e(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),h=new n.e(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),t=0;t<s.length;t++){var e=s[t].getHierarchyBoundingVectors(!0);n.e.CheckExtends(e.min,l,h),n.e.CheckExtends(e.max,l,h)}this.zoomOnBoundingInfo(l,h,u,p)},_.prototype.zoomOnBoundingInfo=function(s,u,p,l){var h=this;p===void 0&&(p=!1),l===void 0&&(l=null);var t;if(!!this._attachedCamera){var e=s.y,i=u.y,r=e+(i-e)*this._positionScale,o=u.subtract(s).scale(.5);if(p)t=new n.e(0,r,0);else{var g=s.add(o);t=new n.e(g.x,r,g.z)}this._vectorTransition||(this._vectorTransition=c.a.CreateAnimation("target",c.a.ANIMATIONTYPE_VECTOR3,60,_.EasingFunction)),this._betaIsAnimating=!0;var y=c.a.TransitionTo("target",t,this._attachedCamera,this._attachedCamera.getScene(),60,this._vectorTransition,this._framingTime);y&&this._animatables.push(y);var v=0;if(this._mode===_.FitFrustumSidesMode){var f=this._calculateLowerRadiusFromModelBoundingSphere(s,u);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=o.length()+this._attachedCamera.minZ),v=f}else this._mode===_.IgnoreBoundsSizeMode&&(v=this._calculateLowerRadiusFromModelBoundingSphere(s,u),this.autoCorrectCameraLimitsAndSensibility&&this._attachedCamera.lowerRadiusLimit===null&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.minZ));if(this.autoCorrectCameraLimitsAndSensibility){var b=u.subtract(s).length();this._attachedCamera.panningSensibility=5e3/b,this._attachedCamera.wheelPrecision=100/v}this._radiusTransition||(this._radiusTransition=c.a.CreateAnimation("radius",c.a.ANIMATIONTYPE_FLOAT,60,_.EasingFunction)),y=c.a.TransitionTo("radius",v,this._attachedCamera,this._attachedCamera.getScene(),60,this._radiusTransition,this._framingTime,function(){h.stopAllAnimations(),l&&l(),h._attachedCamera&&h._attachedCamera.useInputToRestoreState&&h._attachedCamera.storeState()}),y&&this._animatables.push(y)}},_.prototype._calculateLowerRadiusFromModelBoundingSphere=function(s,u){var p=u.subtract(s),l=p.length(),h=this._getFrustumSlope(),t=l*.5,e=t*this._radiusScale,i=e*Math.sqrt(1+1/(h.x*h.x)),r=e*Math.sqrt(1+1/(h.y*h.y)),o=Math.max(i,r),g=this._attachedCamera;return g?(g.lowerRadiusLimit&&this._mode===_.IgnoreBoundsSizeMode&&(o=o<g.lowerRadiusLimit?g.lowerRadiusLimit:o),g.upperRadiusLimit&&(o=o>g.upperRadiusLimit?g.upperRadiusLimit:o),o):0},_.prototype._maintainCameraAboveGround=function(){var s=this;if(!(this._elevationReturnTime<0)){var u=m.a.Now-this._lastInteractionTime,p=Math.PI*.5-this._defaultElevation,l=Math.PI*.5;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>l&&u>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=c.a.CreateAnimation("beta",c.a.ANIMATIONTYPE_FLOAT,60,_.EasingFunction));var h=c.a.TransitionTo("beta",p,this._attachedCamera,this._attachedCamera.getScene(),60,this._betaTransition,this._elevationReturnTime,function(){s._clearAnimationLocks(),s.stopAllAnimations()});h&&this._animatables.push(h)}}},_.prototype._getFrustumSlope=function(){var s=this._attachedCamera;if(!s)return n.d.Zero();var u=s.getScene().getEngine(),p=u.getAspectRatio(s),l=Math.tan(s.fov/2),h=l*p;return new n.d(h,l)},_.prototype._clearAnimationLocks=function(){this._betaIsAnimating=!1},_.prototype._applyUserInteraction=function(){this.isUserIsMoving&&(this._lastInteractionTime=m.a.Now,this.stopAllAnimations(),this._clearAnimationLocks())},_.prototype.stopAllAnimations=function(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()},Object.defineProperty(_.prototype,"isUserIsMoving",{get:function(){return this._attachedCamera?this._attachedCamera.inertialAlphaOffset!==0||this._attachedCamera.inertialBetaOffset!==0||this._attachedCamera.inertialRadiusOffset!==0||this._attachedCamera.inertialPanningX!==0||this._attachedCamera.inertialPanningY!==0||this._isPointerDown:!1},enumerable:!1,configurable:!0}),_.EasingFunction=new P.h,_.EasingMode=P.f.EASINGMODE_EASEINOUT,_.IgnoreBoundsSizeMode=0,_.FitFrustumSidesMode=1,_}()},function($,W,M){"use strict";M.d(W,"a",function(){return d});var P=M(434),d=function(){function m(){}return m.GenerateBase64StringFromPixelData=function(n,c,a){a===void 0&&(a=!1);var _=c.width,s=c.height;if(n instanceof Float32Array){for(var u=n.byteLength/n.BYTES_PER_ELEMENT,p=new Uint8Array(u);--u>=0;){var l=n[u];l<0?l=0:l>1&&(l=1),p[u]=l*255}n=p}var h=document.createElement("canvas");h.width=_,h.height=s;var t=h.getContext("2d");if(!t)return null;var e=t.createImageData(_,s),i=e.data;if(i.set(n),t.putImageData(e,0,0),a){var r=document.createElement("canvas");r.width=_,r.height=s;var o=r.getContext("2d");return o?(o.translate(0,s),o.scale(1,-1),o.drawImage(h,0,0),r.toDataURL("image/png")):null}return h.toDataURL("image/png")},m.GenerateBase64StringFromTexture=function(n,c,a){c===void 0&&(c=0),a===void 0&&(a=0);var _=n.getInternalTexture();if(!_)return null;var s=n._readPixelsSync(c,a);return s?m.GenerateBase64StringFromPixelData(s,n.getSize(),_.invertY):null},m.GenerateBase64StringFromTextureAsync=function(n,c,a){return c===void 0&&(c=0),a===void 0&&(a=0),Object(P.b)(this,void 0,void 0,function(){var _,s;return Object(P.e)(this,function(u){switch(u.label){case 0:return _=n.getInternalTexture(),_?[4,n.readPixels(c,a)]:[2,null];case 1:return s=u.sent(),s?[2,m.GenerateBase64StringFromPixelData(s,n.getSize(),_.invertY)]:[2,null]}})})},m}()},function($,W,M){"use strict";M.d(W,"a",function(){return a});var P=M(434),d=M(439),m=M(460),n=M(562),c=M(443),a=function(){function _(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}return _.prototype.attachControl=function(s){var u=this;s=c.b.BackCompatCameraNoPreventDefault(arguments),!this._onCanvasBlurObserver&&(this._scene=this.camera.getScene(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add(function(){u._keys=[]}),this._onKeyboardObserver=this._scene.onKeyboardObservable.add(function(p){var l=p.event;if(!l.metaKey){if(p.type===n.a.KEYDOWN){if(u._ctrlPressed=l.ctrlKey,u._altPressed=l.altKey,u.keysUp.indexOf(l.keyCode)!==-1||u.keysDown.indexOf(l.keyCode)!==-1||u.keysLeft.indexOf(l.keyCode)!==-1||u.keysRight.indexOf(l.keyCode)!==-1||u.keysReset.indexOf(l.keyCode)!==-1){var h=u._keys.indexOf(l.keyCode);h===-1&&u._keys.push(l.keyCode),l.preventDefault&&(s||l.preventDefault())}}else if(u.keysUp.indexOf(l.keyCode)!==-1||u.keysDown.indexOf(l.keyCode)!==-1||u.keysLeft.indexOf(l.keyCode)!==-1||u.keysRight.indexOf(l.keyCode)!==-1||u.keysReset.indexOf(l.keyCode)!==-1){var h=u._keys.indexOf(l.keyCode);h>=0&&u._keys.splice(h,1),l.preventDefault&&(s||l.preventDefault())}}}))},_.prototype.detachControl=function(s){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys=[]},_.prototype.checkInputs=function(){if(this._onKeyboardObserver)for(var s=this.camera,u=0;u<this._keys.length;u++){var p=this._keys[u];this.keysLeft.indexOf(p)!==-1?this._ctrlPressed&&this.camera._useCtrlForPanning?s.inertialPanningX-=1/this.panningSensibility:s.inertialAlphaOffset-=this.angularSpeed:this.keysUp.indexOf(p)!==-1?this._ctrlPressed&&this.camera._useCtrlForPanning?s.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?s.inertialRadiusOffset+=1/this.zoomingSensibility:s.inertialBetaOffset-=this.angularSpeed:this.keysRight.indexOf(p)!==-1?this._ctrlPressed&&this.camera._useCtrlForPanning?s.inertialPanningX+=1/this.panningSensibility:s.inertialAlphaOffset+=this.angularSpeed:this.keysDown.indexOf(p)!==-1?this._ctrlPressed&&this.camera._useCtrlForPanning?s.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?s.inertialRadiusOffset-=1/this.zoomingSensibility:s.inertialBetaOffset+=this.angularSpeed:this.keysReset.indexOf(p)!==-1&&s.useInputToRestoreState&&s.restoreState()}},_.prototype.getClassName=function(){return"ArcRotateCameraKeyboardMoveInput"},_.prototype.getSimpleName=function(){return"keyboard"},Object(P.c)([Object(d.c)()],_.prototype,"keysUp",void 0),Object(P.c)([Object(d.c)()],_.prototype,"keysDown",void 0),Object(P.c)([Object(d.c)()],_.prototype,"keysLeft",void 0),Object(P.c)([Object(d.c)()],_.prototype,"keysRight",void 0),Object(P.c)([Object(d.c)()],_.prototype,"keysReset",void 0),Object(P.c)([Object(d.c)()],_.prototype,"panningSensibility",void 0),Object(P.c)([Object(d.c)()],_.prototype,"zoomingSensibility",void 0),Object(P.c)([Object(d.c)()],_.prototype,"useAltToZoom",void 0),Object(P.c)([Object(d.c)()],_.prototype,"angularSpeed",void 0),_}();m.a.ArcRotateCameraKeyboardMoveInput=a},function($,W,M){"use strict";M.d(W,"a",function(){return a});var P=M(434),d=M(439),m=M(460),n=M(464),c=M(443),a=function(){function _(){this.wheelPrecision=3,this.wheelDeltaPercentage=0}return _.prototype.attachControl=function(s){var u=this;s=c.b.BackCompatCameraNoPreventDefault(arguments),this._wheel=function(p,l){if(p.type===n.a.POINTERWHEEL){var h=p.event,t=0,e=0;u.wheelDeltaPercentage!==0?(e=(h.deltaY>0?-1:1)*u.camera.radius*u.wheelDeltaPercentage,t=e*(u.camera.inertia===1?1:1-u.camera.inertia)):(e=h.deltaY>0?-100:100,u.wheelPrecision!==0&&(t=e/(u.wheelPrecision*40))),t&&(u.camera.inertialRadiusOffset+=t),h.preventDefault&&(s||h.preventDefault())}},this._observer=this.camera.getScene().onPointerObservable.add(this._wheel,n.a.POINTERWHEEL)},_.prototype.detachControl=function(s){this._observer&&(this.camera.getScene().onPointerObservable.remove(this._observer),this._observer=null,this._wheel=null)},_.prototype.getClassName=function(){return"ArcRotateCameraMouseWheelInput"},_.prototype.getSimpleName=function(){return"mousewheel"},Object(P.c)([Object(d.c)()],_.prototype,"wheelPrecision",void 0),Object(P.c)([Object(d.c)()],_.prototype,"wheelDeltaPercentage",void 0),_}();m.a.ArcRotateCameraMouseWheelInput=a},function($,W,M){"use strict";M.d(W,"a",function(){return c});var P=M(434),d=M(439),m=M(460),n=M(691),c=function(a){Object(P.d)(_,a);function _(){var s=a!==null&&a.apply(this,arguments)||this;return s.buttons=[0,1,2],s.angularSensibilityX=1e3,s.angularSensibilityY=1e3,s.pinchPrecision=12,s.pinchDeltaPercentage=0,s.useNaturalPinchZoom=!1,s.pinchZoom=!0,s.panningSensibility=1e3,s.multiTouchPanning=!0,s.multiTouchPanAndZoom=!0,s.pinchInwards=!0,s._isPanClick=!1,s._twoFingerActivityCount=0,s._isPinching=!1,s}return _.prototype.getClassName=function(){return"ArcRotateCameraPointersInput"},_.prototype._computeMultiTouchPanning=function(s,u){if(this.panningSensibility!==0&&s&&u){var p=u.x-s.x,l=u.y-s.y;this.camera.inertialPanningX+=-p/this.panningSensibility,this.camera.inertialPanningY+=l/this.panningSensibility}},_.prototype._computePinchZoom=function(s,u){this.useNaturalPinchZoom?this.camera.radius=this.camera.radius*Math.sqrt(s)/Math.sqrt(u):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=(u-s)*.001*this.camera.radius*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(u-s)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)},_.prototype.onTouch=function(s,u,p){this.panningSensibility!==0&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-u/this.panningSensibility,this.camera.inertialPanningY+=p/this.panningSensibility):(this.camera.inertialAlphaOffset-=u/this.angularSensibilityX,this.camera.inertialBetaOffset-=p/this.angularSensibilityY)},_.prototype.onDoubleTap=function(s){this.camera.useInputToRestoreState&&this.camera.restoreState()},_.prototype.onMultiTouch=function(s,u,p,l,h,t){p===0&&h===null||l===0&&t===null||(this.multiTouchPanAndZoom?(this._computePinchZoom(p,l),this._computeMultiTouchPanning(h,t)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(l)-Math.sqrt(p))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(p,l),this._isPinching=!0):this._computeMultiTouchPanning(h,t)):this.multiTouchPanning?this._computeMultiTouchPanning(h,t):this.pinchZoom&&this._computePinchZoom(p,l))},_.prototype.onButtonDown=function(s){this._isPanClick=s.button===this.camera._panningMouseButton},_.prototype.onButtonUp=function(s){this._twoFingerActivityCount=0,this._isPinching=!1},_.prototype.onLostFocus=function(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1},Object(P.c)([Object(d.c)()],_.prototype,"buttons",void 0),Object(P.c)([Object(d.c)()],_.prototype,"angularSensibilityX",void 0),Object(P.c)([Object(d.c)()],_.prototype,"angularSensibilityY",void 0),Object(P.c)([Object(d.c)()],_.prototype,"pinchPrecision",void 0),Object(P.c)([Object(d.c)()],_.prototype,"pinchDeltaPercentage",void 0),Object(P.c)([Object(d.c)()],_.prototype,"useNaturalPinchZoom",void 0),Object(P.c)([Object(d.c)()],_.prototype,"pinchZoom",void 0),Object(P.c)([Object(d.c)()],_.prototype,"panningSensibility",void 0),Object(P.c)([Object(d.c)()],_.prototype,"multiTouchPanning",void 0),Object(P.c)([Object(d.c)()],_.prototype,"multiTouchPanAndZoom",void 0),_}(n.a);m.a.ArcRotateCameraPointersInput=c},function($,W,M){"use strict";var P=M(435),d="lightsFragmentFunctions",m=`
struct lightingInfo
{
vec3 diffuse;
#ifdef SPECULARTERM
vec3 specular;
#endif
#ifdef NDOTL
float ndl;
#endif
};
lightingInfo computeLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {
lightingInfo result;
vec3 lightVectorW;
float attenuation=1.0;
if (lightData.w == 0.)
{
vec3 direction=lightData.xyz-vPositionW;
attenuation=max(0.,1.0-length(direction)/range);
lightVectorW=normalize(direction);
}
else
{
lightVectorW=normalize(-lightData.xyz);
}

float ndl=max(0.,dot(vNormal,lightVectorW));
#ifdef NDOTL
result.ndl=ndl;
#endif
result.diffuse=ndl*diffuseColor*attenuation;
#ifdef SPECULARTERM

vec3 angleW=normalize(viewDirectionW+lightVectorW);
float specComp=max(0.,dot(vNormal,angleW));
specComp=pow(specComp,max(1.,glossiness));
result.specular=specComp*specularColor*attenuation;
#endif
return result;
}
lightingInfo computeSpotLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec4 lightDirection,vec3 diffuseColor,vec3 specularColor,float range,float glossiness) {
lightingInfo result;
vec3 direction=lightData.xyz-vPositionW;
vec3 lightVectorW=normalize(direction);
float attenuation=max(0.,1.0-length(direction)/range);

float cosAngle=max(0.,dot(lightDirection.xyz,-lightVectorW));
if (cosAngle>=lightDirection.w)
{
cosAngle=max(0.,pow(cosAngle,lightData.w));
attenuation*=cosAngle;

float ndl=max(0.,dot(vNormal,lightVectorW));
#ifdef NDOTL
result.ndl=ndl;
#endif
result.diffuse=ndl*diffuseColor*attenuation;
#ifdef SPECULARTERM

vec3 angleW=normalize(viewDirectionW+lightVectorW);
float specComp=max(0.,dot(vNormal,angleW));
specComp=pow(specComp,max(1.,glossiness));
result.specular=specComp*specularColor*attenuation;
#endif
return result;
}
result.diffuse=vec3(0.);
#ifdef SPECULARTERM
result.specular=vec3(0.);
#endif
#ifdef NDOTL
result.ndl=0.;
#endif
return result;
}
lightingInfo computeHemisphericLighting(vec3 viewDirectionW,vec3 vNormal,vec4 lightData,vec3 diffuseColor,vec3 specularColor,vec3 groundColor,float glossiness) {
lightingInfo result;

float ndl=dot(vNormal,lightData.xyz)*0.5+0.5;
#ifdef NDOTL
result.ndl=ndl;
#endif
result.diffuse=mix(groundColor,diffuseColor,ndl);
#ifdef SPECULARTERM

vec3 angleW=normalize(viewDirectionW+lightData.xyz);
float specComp=max(0.,dot(vNormal,angleW));
specComp=pow(specComp,max(1.,glossiness));
result.specular=specComp*specularColor;
#endif
return result;
}
#define inline
vec3 computeProjectionTextureDiffuseLighting(sampler2D projectionLightSampler,mat4 textureProjectionMatrix){
vec4 strq=textureProjectionMatrix*vec4(vPositionW,1.0);
strq/=strq.w;
vec3 textureColor=texture2D(projectionLightSampler,strq.xy).rgb;
return textureColor;
}`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},,,,,,,,,,,,,,,function($,W,M){"use strict";M.d(W,"a",function(){return d});var P=M(436),d=function(){function m(){this.previousWorldMatrices={},this.previousBones={}}return m.AddUniforms=function(n){n.push("previousWorld","previousViewProjection")},m.AddSamplers=function(n){},m.prototype.bindForSubMesh=function(n,c,a,_,s){c.prePassRenderer&&c.prePassRenderer.enabled&&c.prePassRenderer.currentRTisSceneRT&&c.prePassRenderer.getIndex(2)!==-1&&(this.previousWorldMatrices[a.uniqueId]||(this.previousWorldMatrices[a.uniqueId]=P.a.Identity()),this.previousViewProjection||(this.previousViewProjection=c.getTransformMatrix()),n.setMatrix("previousWorld",this.previousWorldMatrices[a.uniqueId]),n.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[a.uniqueId]=_.clone(),this.previousViewProjection=c.getTransformMatrix().clone())},m}()},function($,W,M){"use strict";var P=M(435),d="meshUboDeclaration",m=`layout(std140,column_major) uniform;
uniform Mesh
{
mat4 world;
float visibility;
};
`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},function($,W,M){"use strict";var P=M(435),d="prePassDeclaration",m=`#ifdef PREPASS
#extension GL_EXT_draw_buffers : require
layout(location=0) out highp vec4 glFragData[{X}];
highp vec4 gl_FragColor;
#ifdef PREPASS_DEPTH
varying highp vec3 vViewPos;
#endif
#ifdef PREPASS_VELOCITY
varying highp vec4 vCurrentPosition;
varying highp vec4 vPreviousPosition;
#endif
#endif
`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},function($,W,M){"use strict";var P=M(435),d="depthPrePass",m=`#ifdef DEPTHPREPASS
gl_FragColor=vec4(0.,0.,0.,1.0);
return;
#endif`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},function($,W,M){"use strict";var P=M(435),d="prePassVertexDeclaration",m=`#ifdef PREPASS
#ifdef PREPASS_DEPTH
varying vec3 vViewPos;
#endif
#ifdef PREPASS_VELOCITY
uniform mat4 previousWorld;
uniform mat4 previousViewProjection;
varying vec4 vCurrentPosition;
varying vec4 vPreviousPosition;
#endif
#endif`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},function($,W,M){"use strict";var P=M(435),d="bumpVertexDeclaration",m=`#if defined(BUMP) || defined(PARALLAX) || defined(CLEARCOAT_BUMP) || defined(ANISOTROPIC)
#if defined(TANGENT) && defined(NORMAL)
varying mat3 vTBN;
#endif
#endif
`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},function($,W,M){"use strict";var P=M(435),d="prePassVertex",m=`#ifdef PREPASS_DEPTH
vViewPos=(view*worldPos).rgb;
#endif
#if defined(PREPASS_VELOCITY) && defined(BONES_VELOCITY_ENABLED)
vCurrentPosition=viewProjection*worldPos;
#if NUM_BONE_INFLUENCERS>0
mat4 previousInfluence;
previousInfluence=mPreviousBones[int(matricesIndices[0])]*matricesWeights[0];
#if NUM_BONE_INFLUENCERS>1
previousInfluence+=mPreviousBones[int(matricesIndices[1])]*matricesWeights[1];
#endif
#if NUM_BONE_INFLUENCERS>2
previousInfluence+=mPreviousBones[int(matricesIndices[2])]*matricesWeights[2];
#endif
#if NUM_BONE_INFLUENCERS>3
previousInfluence+=mPreviousBones[int(matricesIndices[3])]*matricesWeights[3];
#endif
#if NUM_BONE_INFLUENCERS>4
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[0])]*matricesWeightsExtra[0];
#endif
#if NUM_BONE_INFLUENCERS>5
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[1])]*matricesWeightsExtra[1];
#endif
#if NUM_BONE_INFLUENCERS>6
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[2])]*matricesWeightsExtra[2];
#endif
#if NUM_BONE_INFLUENCERS>7
previousInfluence+=mPreviousBones[int(matricesIndicesExtra[3])]*matricesWeightsExtra[3];
#endif
vPreviousPosition=previousViewProjection*previousWorld*previousInfluence*vec4(positionUpdated,1.0);
#else
vPreviousPosition=previousViewProjection*previousWorld*vec4(positionUpdated,1.0);
#endif
#endif`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},function($,W,M){"use strict";M.d(W,"a",function(){return a});var P=M(434),d=M(459),m=M(439),n=M(480),c=M(454),a=function(){function _(s){this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=d.a.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=s}return _.prototype._markAllSubMeshesAsTexturesDirty=function(){this._internalMarkAllSubMeshesAsTexturesDirty()},_.prototype.isReadyForSubMesh=function(s,u){var p=u.getEngine();return!(s._areTexturesDirty&&u.texturesEnabled&&p.getCaps().standardDerivatives&&this._texture&&n.a.DetailTextureEnabled&&!this._texture.isReady())},_.prototype.prepareDefines=function(s,u){if(this._isEnabled){s.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;var p=u.getEngine();s._areTexturesDirty&&(p.getCaps().standardDerivatives&&this._texture&&n.a.DetailTextureEnabled&&this._isEnabled?(c.a.PrepareDefinesForMergedUV(this._texture,s,"DETAIL"),s.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):s.DETAIL=!1)}else s.DETAIL=!1},_.prototype.bindForSubMesh=function(s,u,p){!this._isEnabled||((!s.useUbo||!p||!s.isSync)&&this._texture&&n.a.DetailTextureEnabled&&(s.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),c.a.BindTextureMatrix(this._texture,s,"detail")),u.texturesEnabled&&this._texture&&n.a.DetailTextureEnabled&&s.setTexture("detailSampler",this._texture))},_.prototype.hasTexture=function(s){return this._texture===s},_.prototype.getActiveTextures=function(s){this._texture&&s.push(this._texture)},_.prototype.getAnimatables=function(s){this._texture&&this._texture.animations&&this._texture.animations.length>0&&s.push(this._texture)},_.prototype.dispose=function(s){var u;s&&((u=this._texture)===null||u===void 0||u.dispose())},_.prototype.getClassName=function(){return"DetailMap"},_.AddUniforms=function(s){s.push("vDetailInfos"),s.push("detailMatrix")},_.AddSamplers=function(s){s.push("detailSampler")},_.PrepareUniformBuffer=function(s){s.addUniform("vDetailInfos",4),s.addUniform("detailMatrix",16)},_.prototype.copyTo=function(s){m.a.Clone(function(){return s},this)},_.prototype.serialize=function(){return m.a.Serialize(this)},_.prototype.parse=function(s,u,p){var l=this;m.a.Parse(function(){return l},s,u,p)},Object(P.c)([Object(m.m)("detailTexture"),Object(m.b)("_markAllSubMeshesAsTexturesDirty")],_.prototype,"texture",void 0),Object(P.c)([Object(m.c)()],_.prototype,"diffuseBlendLevel",void 0),Object(P.c)([Object(m.c)()],_.prototype,"roughnessBlendLevel",void 0),Object(P.c)([Object(m.c)()],_.prototype,"bumpLevel",void 0),Object(P.c)([Object(m.c)(),Object(m.b)("_markAllSubMeshesAsTexturesDirty")],_.prototype,"normalBlendMethod",void 0),Object(P.c)([Object(m.c)(),Object(m.b)("_markAllSubMeshesAsTexturesDirty")],_.prototype,"isEnabled",void 0),_}()},,,,,function($,W,M){"use strict";M.d(W,"e",function(){return n}),M.d(W,"c",function(){return c}),M.d(W,"a",function(){return a}),M.d(W,"b",function(){return _}),M.d(W,"f",function(){return s}),M.d(W,"g",function(){return u}),M.d(W,"d",function(){return p});var P=M(450),d=M(436),m=M(515),n;(function(l){l[l.CW=0]="CW",l[l.CCW=1]="CCW"})(n||(n={}));var c=function(){function l(){}return l.Interpolate=function(h,t,e,i,r){for(var o=1-3*i+3*t,g=3*i-6*t,y=3*t,v=h,f=0;f<5;f++){var b=v*v,T=b*v,E=o*T+g*b+y*v,O=1/(3*o*b+2*g*v+y);v-=(E-h)*O,v=Math.min(1,Math.max(0,v))}return 3*Math.pow(1-v,2)*v*e+3*(1-v)*Math.pow(v,2)*r+Math.pow(v,3)},l}(),a=function(){function l(h){this._radians=h,this._radians<0&&(this._radians+=2*Math.PI)}return l.prototype.degrees=function(){return this._radians*180/Math.PI},l.prototype.radians=function(){return this._radians},l.BetweenTwoPoints=function(h,t){var e=t.subtract(h),i=Math.atan2(e.y,e.x);return new l(i)},l.FromRadians=function(h){return new l(h)},l.FromDegrees=function(h){return new l(h*Math.PI/180)},l}(),_=function(){function l(h,t,e){this.startPoint=h,this.midPoint=t,this.endPoint=e;var i=Math.pow(t.x,2)+Math.pow(t.y,2),r=(Math.pow(h.x,2)+Math.pow(h.y,2)-i)/2,o=(i-Math.pow(e.x,2)-Math.pow(e.y,2))/2,g=(h.x-t.x)*(t.y-e.y)-(t.x-e.x)*(h.y-t.y);this.centerPoint=new d.d((r*(t.y-e.y)-o*(h.y-t.y))/g,((h.x-t.x)*o-(t.x-e.x)*r)/g),this.radius=this.centerPoint.subtract(this.startPoint).length(),this.startAngle=a.BetweenTwoPoints(this.centerPoint,this.startPoint);var y=this.startAngle.degrees(),v=a.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),f=a.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();v-y>180&&(v-=360),v-y<-180&&(v+=360),f-v>180&&(f-=360),f-v<-180&&(f+=360),this.orientation=v-y<0?n.CW:n.CCW,this.angle=a.FromDegrees(this.orientation===n.CW?y-f:f-y)}return l}(),s=function(){function l(h,t){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new d.d(h,t))}return l.prototype.addLineTo=function(h,t){if(this.closed)return this;var e=new d.d(h,t),i=this._points[this._points.length-1];return this._points.push(e),this._length+=e.subtract(i).length(),this},l.prototype.addArcTo=function(h,t,e,i,r){if(r===void 0&&(r=36),this.closed)return this;var o=this._points[this._points.length-1],g=new d.d(h,t),y=new d.d(e,i),v=new _(o,g,y),f=v.angle.radians()/r;v.orientation===n.CW&&(f*=-1);for(var b=v.startAngle.radians()+f,T=0;T<r;T++){var E=Math.cos(b)*v.radius+v.centerPoint.x,O=Math.sin(b)*v.radius+v.centerPoint.y;this.addLineTo(E,O),b+=f}return this},l.prototype.close=function(){return this.closed=!0,this},l.prototype.length=function(){var h=this._length;if(this.closed){var t=this._points[this._points.length-1],e=this._points[0];h+=e.subtract(t).length()}return h},l.prototype.getPoints=function(){return this._points},l.prototype.getPointAtLengthPosition=function(h){if(h<0||h>1)return d.d.Zero();for(var t=h*this.length(),e=0,i=0;i<this._points.length;i++){var r=(i+1)%this._points.length,o=this._points[i],g=this._points[r],y=g.subtract(o),v=y.length()+e;if(t>=e&&t<=v){var f=y.normalize(),b=t-e;return new d.d(o.x+f.x*b,o.y+f.y*b)}e=v}return d.d.Zero()},l.StartingAt=function(h,t){return new l(h,t)},l}(),u=function(){function l(h,t,e,i){t===void 0&&(t=null),i===void 0&&(i=!1),this.path=h,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:d.e.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:d.a.Identity()};for(var r=0;r<h.length;r++)this._curve[r]=h[r].clone();this._raw=e||!1,this._alignTangentsWithPath=i,this._compute(t,i)}return l.prototype.getCurve=function(){return this._curve},l.prototype.getPoints=function(){return this._curve},l.prototype.length=function(){return this._distances[this._distances.length-1]},l.prototype.getTangents=function(){return this._tangents},l.prototype.getNormals=function(){return this._normals},l.prototype.getBinormals=function(){return this._binormals},l.prototype.getDistances=function(){return this._distances},l.prototype.getPointAt=function(h){return this._updatePointAtData(h).point},l.prototype.getTangentAt=function(h,t){return t===void 0&&(t=!1),this._updatePointAtData(h,t),t?d.e.TransformCoordinates(d.e.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]},l.prototype.getNormalAt=function(h,t){return t===void 0&&(t=!1),this._updatePointAtData(h,t),t?d.e.TransformCoordinates(d.e.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]},l.prototype.getBinormalAt=function(h,t){return t===void 0&&(t=!1),this._updatePointAtData(h,t),t?d.e.TransformCoordinates(d.e.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]},l.prototype.getDistanceAt=function(h){return this.length()*h},l.prototype.getPreviousPointIndexAt=function(h){return this._updatePointAtData(h),this._pointAtData.previousPointArrayIndex},l.prototype.getSubPositionAt=function(h){return this._updatePointAtData(h),this._pointAtData.subPosition},l.prototype.getClosestPositionTo=function(h){for(var t=Number.MAX_VALUE,e=0,i=0;i<this._curve.length-1;i++){var r=this._curve[i+0],o=this._curve[i+1].subtract(r).normalize(),g=this._distances[i+1]-this._distances[i+0],y=Math.min(Math.max(d.e.Dot(o,h.subtract(r).normalize()),0)*d.e.Distance(r,h)/g,1),v=d.e.Distance(r.add(o.scale(y*g)),h);v<t&&(t=v,e=(this._distances[i+0]+g*y)/this.length())}return e},l.prototype.slice=function(h,t){if(h===void 0&&(h=0),t===void 0&&(t=1),h<0&&(h=1-h*-1%1),t<0&&(t=1-t*-1%1),h>t){var e=h;h=t,t=e}var i=this.getCurve(),r=this.getPointAt(h),o=this.getPreviousPointIndexAt(h),g=this.getPointAt(t),y=this.getPreviousPointIndexAt(t)+1,v=[];return h!==0&&(o++,v.push(r)),v.push.apply(v,i.slice(o,y)),(t!==1||h===1)&&v.push(g),new l(v,this.getNormalAt(h),this._raw,this._alignTangentsWithPath)},l.prototype.update=function(h,t,e){t===void 0&&(t=null),e===void 0&&(e=!1);for(var i=0;i<h.length;i++)this._curve[i].x=h[i].x,this._curve[i].y=h[i].y,this._curve[i].z=h[i].z;return this._compute(t,e),this},l.prototype._compute=function(h,t){t===void 0&&(t=!1);var e=this._curve.length;if(!(e<2)){this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[e-1]=this._curve[e-1].subtract(this._curve[e-2]),this._raw||this._tangents[e-1].normalize();var i=this._tangents[0],r=this._normalVector(i,h);this._normals[0]=r,this._raw||this._normals[0].normalize(),this._binormals[0]=d.e.Cross(i,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(var o,g,y,v,f,b=1;b<e;b++)o=this._getLastNonNullVector(b),b<e-1&&(g=this._getFirstNonNullVector(b),this._tangents[b]=t?g:o.add(g),this._tangents[b].normalize()),this._distances[b]=this._distances[b-1]+this._curve[b].subtract(this._curve[b-1]).length(),y=this._tangents[b],f=this._binormals[b-1],this._normals[b]=d.e.Cross(f,y),this._raw||(this._normals[b].length()===0?(v=this._normals[b-1],this._normals[b]=v.clone()):this._normals[b].normalize()),this._binormals[b]=d.e.Cross(y,this._normals[b]),this._raw||this._binormals[b].normalize();this._pointAtData.id=NaN}},l.prototype._getFirstNonNullVector=function(h){for(var t=1,e=this._curve[h+t].subtract(this._curve[h]);e.length()===0&&h+t+1<this._curve.length;)t++,e=this._curve[h+t].subtract(this._curve[h]);return e},l.prototype._getLastNonNullVector=function(h){for(var t=1,e=this._curve[h].subtract(this._curve[h-t]);e.length()===0&&h>t+1;)t++,e=this._curve[h].subtract(this._curve[h-t]);return e},l.prototype._normalVector=function(h,t){var e,i=h.length();if(i===0&&(i=1),t==null){var r;P.a.WithinEpsilon(Math.abs(h.y)/i,1,m.a)?P.a.WithinEpsilon(Math.abs(h.x)/i,1,m.a)?P.a.WithinEpsilon(Math.abs(h.z)/i,1,m.a)?r=d.e.Zero():r=new d.e(0,0,1):r=new d.e(1,0,0):r=new d.e(0,-1,0),e=d.e.Cross(h,r)}else e=d.e.Cross(h,t),d.e.CrossToRef(e,h,e);return e.normalize(),e},l.prototype._updatePointAtData=function(h,t){if(t===void 0&&(t=!1),this._pointAtData.id===h)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=h;var e=this.getPoints();if(h<=0)return this._setPointAtData(0,0,e[0],0,t);if(h>=1)return this._setPointAtData(1,1,e[e.length-1],e.length-1,t);for(var i=e[0],r,o=0,g=h*this.length(),y=1;y<e.length;y++){r=e[y];var v=d.e.Distance(i,r);if(o+=v,o===g)return this._setPointAtData(h,1,r,y,t);if(o>g){var f=o-g,b=f/v,T=i.subtract(r),E=r.add(T.scaleInPlace(b));return this._setPointAtData(h,1-b,E,y-1,t)}i=r}return this._pointAtData},l.prototype._setPointAtData=function(h,t,e,i,r){return this._pointAtData.point=e,this._pointAtData.position=h,this._pointAtData.subPosition=t,this._pointAtData.previousPointArrayIndex=i,this._pointAtData.interpolateReady=r,r&&this._updateInterpolationMatrix(),this._pointAtData},l.prototype._updateInterpolationMatrix=function(){this._pointAtData.interpolationMatrix=d.a.Identity();var h=this._pointAtData.previousPointArrayIndex;if(h!==this._tangents.length-1){var t=h+1,e=this._tangents[h].clone(),i=this._normals[h].clone(),r=this._binormals[h].clone(),o=this._tangents[t].clone(),g=this._normals[t].clone(),y=this._binormals[t].clone(),v=d.b.RotationQuaternionFromAxis(i,r,e),f=d.b.RotationQuaternionFromAxis(g,y,o),b=d.b.Slerp(v,f,this._pointAtData.subPosition);b.toRotationMatrix(this._pointAtData.interpolationMatrix)}},l}(),p=function(){function l(h){this._length=0,this._points=h,this._length=this._computeLength(h)}return l.CreateQuadraticBezier=function(h,t,e,i){i=i>2?i:3;for(var r=new Array,o=function(y,v,f,b){var T=(1-y)*(1-y)*v+2*y*(1-y)*f+y*y*b;return T},g=0;g<=i;g++)r.push(new d.e(o(g/i,h.x,t.x,e.x),o(g/i,h.y,t.y,e.y),o(g/i,h.z,t.z,e.z)));return new l(r)},l.CreateCubicBezier=function(h,t,e,i,r){r=r>3?r:4;for(var o=new Array,g=function(v,f,b,T,E){var O=(1-v)*(1-v)*(1-v)*f+3*v*(1-v)*(1-v)*b+3*v*v*(1-v)*T+v*v*v*E;return O},y=0;y<=r;y++)o.push(new d.e(g(y/r,h.x,t.x,e.x,i.x),g(y/r,h.y,t.y,e.y,i.y),g(y/r,h.z,t.z,e.z,i.z)));return new l(o)},l.CreateHermiteSpline=function(h,t,e,i,r){for(var o=new Array,g=1/r,y=0;y<=r;y++)o.push(d.e.Hermite(h,t,e,i,y*g));return new l(o)},l.CreateCatmullRomSpline=function(h,t,e){var i=new Array,r=1/t,o=0;if(e){for(var g=h.length,y=0;y<g;y++){o=0;for(var v=0;v<t;v++)i.push(d.e.CatmullRom(h[y%g],h[(y+1)%g],h[(y+2)%g],h[(y+3)%g],o)),o+=r}i.push(i[0])}else{var f=new Array;f.push(h[0].clone()),Array.prototype.push.apply(f,h),f.push(h[h.length-1].clone());for(var y=0;y<f.length-3;y++){o=0;for(var v=0;v<t;v++)i.push(d.e.CatmullRom(f[y],f[y+1],f[y+2],f[y+3],o)),o+=r}y--,i.push(d.e.CatmullRom(f[y],f[y+1],f[y+2],f[y+3],o))}return new l(i)},l.prototype.getPoints=function(){return this._points},l.prototype.length=function(){return this._length},l.prototype.continue=function(h){for(var t=this._points[this._points.length-1],e=this._points.slice(),i=h.getPoints(),r=1;r<i.length;r++)e.push(i[r].subtract(i[0]).add(t));var o=new l(e);return o},l.prototype._computeLength=function(h){for(var t=0,e=1;e<h.length;e++)t+=h[e].subtract(h[e-1]).length();return t},l}()},function($,W,M){"use strict";M.d(W,"a",function(){return d});var P=M(603),d=function(){function m(){}return m.GetPlanes=function(n){for(var c=[],a=0;a<6;a++)c.push(new P.a(0,0,0,0));return m.GetPlanesToRef(n,c),c},m.GetNearPlaneToRef=function(n,c){var a=n.m;c.normal.x=a[3]+a[2],c.normal.y=a[7]+a[6],c.normal.z=a[11]+a[10],c.d=a[15]+a[14],c.normalize()},m.GetFarPlaneToRef=function(n,c){var a=n.m;c.normal.x=a[3]-a[2],c.normal.y=a[7]-a[6],c.normal.z=a[11]-a[10],c.d=a[15]-a[14],c.normalize()},m.GetLeftPlaneToRef=function(n,c){var a=n.m;c.normal.x=a[3]+a[0],c.normal.y=a[7]+a[4],c.normal.z=a[11]+a[8],c.d=a[15]+a[12],c.normalize()},m.GetRightPlaneToRef=function(n,c){var a=n.m;c.normal.x=a[3]-a[0],c.normal.y=a[7]-a[4],c.normal.z=a[11]-a[8],c.d=a[15]-a[12],c.normalize()},m.GetTopPlaneToRef=function(n,c){var a=n.m;c.normal.x=a[3]-a[1],c.normal.y=a[7]-a[5],c.normal.z=a[11]-a[9],c.d=a[15]-a[13],c.normalize()},m.GetBottomPlaneToRef=function(n,c){var a=n.m;c.normal.x=a[3]+a[1],c.normal.y=a[7]+a[5],c.normal.z=a[11]+a[9],c.d=a[15]+a[13],c.normalize()},m.GetPlanesToRef=function(n,c){m.GetNearPlaneToRef(n,c[0]),m.GetFarPlaneToRef(n,c[1]),m.GetLeftPlaneToRef(n,c[2]),m.GetRightPlaneToRef(n,c[3]),m.GetTopPlaneToRef(n,c[4]),m.GetBottomPlaneToRef(n,c[5])},m}()},,,function($,W,M){"use strict";M.d(W,"a",function(){return d});var P=M(660),d=function(){function m(){}return m.SetImmediate=function(n){P.a.IsWindowObjectExist()&&window.setImmediate?window.setImmediate(n):setTimeout(n,1)},m}()},function($,W,M){"use strict";M.d(W,"a",function(){return P});var P=function(){function d(){}return Object.defineProperty(d,"UniqueId",{get:function(){var m=this._UniqueIdCounter;return this._UniqueIdCounter++,m},enumerable:!1,configurable:!0}),d._UniqueIdCounter=0,d}()},function($,W,M){"use strict";var P=M(435),d="fresnelFunction",m=`#ifdef FRESNEL
float computeFresnelTerm(vec3 viewDirection,vec3 worldNormal,float bias,float power)
{
float fresnelTerm=pow(bias+abs(dot(viewDirection,worldNormal)),power);
return clamp(fresnelTerm,0.,1.);
}
#endif`;P.a.IncludesShadersStore[d]=m;var n={name:d,shader:m}},,,,,,,,,,,,,,,,,,,function($,W,M){"use strict";M.d(W,"b",function(){return d}),M.d(W,"a",function(){return m});var P=M(436),d=function(){function n(c,a){c===void 0&&(c=P.e.Zero()),a===void 0&&(a=P.e.Up()),this.position=c,this.normal=a}return n.prototype.clone=function(){return new n(this.position.clone(),this.normal.clone())},n}(),m=function(){function n(c,a,_){c===void 0&&(c=P.e.Zero()),a===void 0&&(a=P.e.Up()),_===void 0&&(_=P.d.Zero()),this.position=c,this.normal=a,this.uv=_}return n.prototype.clone=function(){return new n(this.position.clone(),this.normal.clone(),this.uv.clone())},n}()},,,,,,,function($,W,M){"use strict";M.d(W,"a",function(){return m});var P=M(440),d=M(437),m=function(){function n(){}return n.Instantiate=function(c){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[c])return this.RegisteredExternalClasses[c];var a=d.a.GetClass(c);if(a)return a;P.a.Warn(c+" not found, you may have missed an import.");for(var _=c.split("."),s=window||this,u=0,p=_.length;u<p;u++)s=s[_[u]];return typeof s!="function"?null:s},n.RegisteredExternalClasses={},n}()},function($,W,M){"use strict";M.d(W,"a",function(){return P});var P=function(){function d(){}return d.Slice=function(m,n,c){return m.slice?m.slice(n,c):Array.prototype.slice.call(m,n,c)},d.SliceToArray=function(m,n,c){return Array.isArray(m)?m.slice(n,c):Array.prototype.slice.call(m,n,c)},d}()},,,,,,,,,,,function($,W,M){"use strict";M.d(W,"a",function(){return i});var P=M(473),d=function(){function r(){this.children=[]}return r.prototype.isValid=function(o){return!0},r.prototype.process=function(o,g){var y="";if(this.line){var v=this.line,f=g.processor;if(f){if(f.lineProcessor&&(v=f.lineProcessor(v,g.isFragment,g.processingContext)),f.attributeProcessor&&P.a.StartsWith(this.line,"attribute"))v=f.attributeProcessor(this.line,o,g.processingContext);else if(f.varyingProcessor&&P.a.StartsWith(this.line,"varying"))v=f.varyingProcessor(this.line,g.isFragment,o,g.processingContext);else if((f.uniformProcessor||f.uniformBufferProcessor)&&P.a.StartsWith(this.line,"uniform")&&!g.lookForClosingBracketForUniformBuffer){var b=/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/;b.test(this.line)?f.uniformProcessor&&(v=f.uniformProcessor(this.line,g.isFragment,o,g.processingContext)):f.uniformBufferProcessor&&(v=f.uniformBufferProcessor(this.line,g.isFragment,g.processingContext),g.lookForClosingBracketForUniformBuffer=!0)}g.lookForClosingBracketForUniformBuffer&&this.line.indexOf("}")!==-1&&(g.lookForClosingBracketForUniformBuffer=!1,f.endOfUniformBufferProcessor&&(v=f.endOfUniformBufferProcessor(this.line,g.isFragment,g.processingContext)))}y+=v+`\r
`}return this.children.forEach(function(T){y+=T.process(o,g)}),this.additionalDefineKey&&(o[this.additionalDefineKey]=this.additionalDefineValue||"true"),y},r}(),m=function(){function r(){}return Object.defineProperty(r.prototype,"currentLine",{get:function(){return this._lines[this.lineIndex]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"canRead",{get:function(){return this.lineIndex<this._lines.length-1},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"lines",{set:function(o){this._lines=[];for(var g=0,y=o;g<y.length;g++){var v=y[g];if(v[0]==="#"){this._lines.push(v);continue}for(var f=v.split(";"),b=0;b<f.length;b++){var T=f[b];T=T.trim(),!!T&&this._lines.push(T+(b!==f.length-1?";":""))}}},enumerable:!1,configurable:!0}),r}(),n=M(434),c=function(r){Object(n.d)(o,r);function o(){return r!==null&&r.apply(this,arguments)||this}return o.prototype.process=function(g,y){for(var v=0;v<this.children.length;v++){var f=this.children[v];if(f.isValid(g))return f.process(g,y)}return""},o}(d),a=function(r){Object(n.d)(o,r);function o(){return r!==null&&r.apply(this,arguments)||this}return o.prototype.isValid=function(g){return this.testExpression.isTrue(g)},o}(d),_=function(){function r(){}return r.prototype.isTrue=function(o){return!0},r.postfixToInfix=function(o){for(var g=[],y=0,v=o;y<v.length;y++){var f=v[y];if(r._OperatorPriority[f]===void 0)g.push(f);else{var b=g[g.length-1],T=g[g.length-2];g.length-=2,g.push("("+T+f+b+")")}}return g[g.length-1]},r.infixToPostfix=function(o){for(var g=[],y=-1,v=function(){O=O.trim(),O!==""&&(g.push(O),O="")},f=function(x){y<r._Stack.length-1&&(r._Stack[++y]=x)},b=function(){return r._Stack[y]},T=function(){return y===-1?"!!INVALID EXPRESSION!!":r._Stack[y--]},E=0,O="";E<o.length;){var D=o.charAt(E),F=E<o.length-1?o.substr(E,2):"";if(D==="(")O="",f(D);else if(D===")"){for(v();y!==-1&&b()!=="(";)g.push(T());T()}else if(r._OperatorPriority[F]>1){for(v();y!==-1&&r._OperatorPriority[b()]>=r._OperatorPriority[F];)g.push(T());f(F),E++}else O+=D;E++}for(v();y!==-1;)b()==="("?T():g.push(T());return g},r._OperatorPriority={")":0,"(":1,"||":2,"&&":3},r._Stack=["","","","","","","","","","","","","","","","","","","",""],r}(),s=function(r){Object(n.d)(o,r);function o(g,y){y===void 0&&(y=!1);var v=r.call(this)||this;return v.define=g,v.not=y,v}return o.prototype.isTrue=function(g){var y=g[this.define]!==void 0;return this.not&&(y=!y),y},o}(_),u=function(r){Object(n.d)(o,r);function o(){return r!==null&&r.apply(this,arguments)||this}return o.prototype.isTrue=function(g){return this.leftOperand.isTrue(g)||this.rightOperand.isTrue(g)},o}(_),p=function(r){Object(n.d)(o,r);function o(){return r!==null&&r.apply(this,arguments)||this}return o.prototype.isTrue=function(g){return this.leftOperand.isTrue(g)&&this.rightOperand.isTrue(g)},o}(_),l=function(r){Object(n.d)(o,r);function o(g,y,v){var f=r.call(this)||this;return f.define=g,f.operand=y,f.testValue=v,f}return o.prototype.isTrue=function(g){var y=g[this.define];y===void 0&&(y=this.define);var v=!1,f=parseInt(y),b=parseInt(this.testValue);switch(this.operand){case">":v=f>b;break;case"<":v=f<b;break;case"<=":v=f<=b;break;case">=":v=f>=b;break;case"==":v=f===b;break}return v},o}(_),h=M(476),t=/defined\s*?\((.+?)\)/g,e=/defined\s*?\[(.+?)\]/g,i=function(){function r(){}return r.Initialize=function(o){o.processor&&o.processor.initializeShaders&&o.processor.initializeShaders(o.processingContext)},r.Process=function(o,g,y,v){var f=this;this._ProcessIncludes(o,g,function(b){var T=f._ProcessShaderConversion(b,g,v);y(T)})},r.Finalize=function(o,g,y){return!y.processor||!y.processor.finalizeShaders?{vertexCode:o,fragmentCode:g}:y.processor.finalizeShaders(o,g,y.processingContext)},r._ProcessPrecision=function(o,g){var y=g.shouldUseHighPrecisionShader;return o.indexOf("precision highp float")===-1?y?o=`precision highp float;
`+o:o=`precision mediump float;
`+o:y||(o=o.replace("precision highp float","precision mediump float")),o},r._ExtractOperation=function(o){var g=/defined\((.+)\)/,y=g.exec(o);if(y&&y.length)return new s(y[1].trim(),o[0]==="!");for(var v=["==",">=","<=","<",">"],f="",b=0,T=0,E=v;T<E.length&&(f=E[T],b=o.indexOf(f),!(b>-1));T++);if(b===-1)return new s(o);var O=o.substring(0,b).trim(),D=o.substring(b+f.length).trim();return new l(O,f,D)},r._BuildSubExpression=function(o){o=o.replace(t,"defined[$1]");for(var g=_.infixToPostfix(o),y=[],v=0,f=g;v<f.length;v++){var b=f[v];if(b!=="||"&&b!=="&&")y.push(b);else if(y.length>=2){var T=y[y.length-1],E=y[y.length-2];y.length-=2;var O=b=="&&"?new p:new u;typeof T=="string"&&(T=T.replace(e,"defined($1)")),typeof E=="string"&&(E=E.replace(e,"defined($1)")),O.leftOperand=typeof E=="string"?this._ExtractOperation(E):E,O.rightOperand=typeof T=="string"?this._ExtractOperation(T):T,y.push(O)}}var D=y[y.length-1];return typeof D=="string"&&(D=D.replace(e,"defined($1)")),typeof D=="string"?this._ExtractOperation(D):D},r._BuildExpression=function(o,g){var y=new a,v=o.substring(0,g),f=o.substring(g);return f=f.substring(0,(f.indexOf("//")+1||f.length+1)-1).trim(),v==="#ifdef"?y.testExpression=new s(f):v==="#ifndef"?y.testExpression=new s(f,!0):y.testExpression=this._BuildSubExpression(f),y},r._MoveCursorWithinIf=function(o,g,y){for(var v=o.currentLine;this._MoveCursor(o,y);){v=o.currentLine;var f=v.substring(0,5).toLowerCase();if(f==="#else"){var b=new d;g.children.push(b),this._MoveCursor(o,b);return}else if(f==="#elif"){var T=this._BuildExpression(v,5);g.children.push(T),y=T}}},r._MoveCursor=function(o,g){for(;o.canRead;){o.lineIndex++;var y=o.currentLine,v=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/,f=v.exec(y);if(f&&f.length){var b=f[0];switch(b){case"#ifdef":{var T=new c;g.children.push(T);var E=this._BuildExpression(y,6);T.children.push(E),this._MoveCursorWithinIf(o,T,E);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{var T=new c;g.children.push(T);var E=this._BuildExpression(y,7);T.children.push(E),this._MoveCursorWithinIf(o,T,E);break}case"#if":{var T=new c,E=this._BuildExpression(y,3);g.children.push(T),T.children.push(E),this._MoveCursorWithinIf(o,T,E);break}}}else{var O=new d;if(O.line=y,g.children.push(O),y[0]==="#"&&y[1]==="d"){var D=y.replace(";","").split(" ");O.additionalDefineKey=D[1],D.length===3&&(O.additionalDefineValue=D[2])}}}return!1},r._EvaluatePreProcessors=function(o,g,y){var v=new d,f=new m;return f.lineIndex=-1,f.lines=o.split(`
`),this._MoveCursor(f,v),v.process(g,y)},r._PreparePreProcessors=function(o){for(var g=o.defines,y={},v=0,f=g;v<f.length;v++){var b=f[v],T=b.replace("#define","").replace(";","").trim(),E=T.split(" ");y[E[0]]=E.length>1?E[1]:""}return y.GL_ES="true",y.__VERSION__=o.version,y[o.platformName]="true",y},r._ProcessShaderConversion=function(o,g,y){var v=this._ProcessPrecision(o,g);if(!g.processor)return v;if(v.indexOf("#version 3")!==-1)return v.replace("#version 300 es","");var f=g.defines,b=this._PreparePreProcessors(g);return g.processor.preProcessor&&(v=g.processor.preProcessor(v,f,g.isFragment,g.processingContext)),v=this._EvaluatePreProcessors(v,b,g),g.processor.postProcessor&&(v=g.processor.postProcessor(v,f,g.isFragment,g.processingContext,y)),v},r._ProcessIncludes=function(o,g,y){for(var v=this,f=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,b=f.exec(o),T=new String(o),E=!1;b!=null;){var O=b[1];if(O.indexOf("__decl__")!==-1&&(O=O.replace(/__decl__/,""),g.supportsUniformBuffers&&(O=O.replace(/Vertex/,"Ubo"),O=O.replace(/Fragment/,"Ubo")),O=O+"Declaration"),g.includesShadersStore[O]){var D=g.includesShadersStore[O];if(b[2])for(var F=b[3].split(","),x=0;x<F.length;x+=2){var j=new RegExp(F[x],"g"),V=F[x+1];D=D.replace(j,V)}if(b[4]){var z=b[5];if(z.indexOf("..")!==-1){var w=z.split(".."),R=parseInt(w[0]),L=parseInt(w[1]),N=D.slice(0);D="",isNaN(L)&&(L=g.indexParameters[w[1]]);for(var B=R;B<L;B++)g.supportsUniformBuffers||(N=N.replace(/light\{X\}.(\w*)/g,function(K,G){return G+"{X}"})),D+=N.replace(/\{X\}/g,B.toString())+`
`}else g.supportsUniformBuffers||(D=D.replace(/light\{X\}.(\w*)/g,function(K,G){return G+"{X}"})),D=D.replace(/\{X\}/g,z)}T=T.replace(b[0],D),E=E||D.indexOf("#include<")>=0||D.indexOf("#include <")>=0}else{var X=g.shadersRepository+"ShadersInclude/"+O+".fx";r._FileToolsLoadFile(X,function(K){g.includesShadersStore[O]=K,v._ProcessIncludes(T,g,y)});return}b=f.exec(o)}E?this._ProcessIncludes(T.toString(),g,y):y(T)},r._FileToolsLoadFile=function(o,g,y,v,f,b){throw h.a.WarnImport("FileTools")},r}()}])]);
