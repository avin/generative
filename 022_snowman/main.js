!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=20)}([function(e,t){e.exports=function(){for(var e=0;e<arguments.length;e++)if(void 0!==arguments[e])return arguments[e]}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(r){"object"===typeof window&&(n=window)}e.exports=n},function(e,t){e.exports=function(e,t,n){if("number"!==typeof t||"number"!==typeof n)throw new TypeError('Must specify "to" and "from" arguments as numbers');if(t>n){var r=t;t=n,n=r}var i=n-t;if(0===i)return n;return e-i*Math.floor((e-t)/i)}},function(e,t,n){"use strict";var r=Math.abs,i=Math.min;function a(e,t,n,o){var s=r(e-t);return null==n&&(n=a.DBL_EPSILON),null==o&&(o=n),s<=n||(s<=o*i(r(e),r(t))||e===t)}a.FLT_EPSILON=1.1920929e-7,a.DBL_EPSILON=2220446049250313e-31,e.exports=a},function(e,t,n){"use strict";t.a="#define GLSLIFY 1\nvarying vec2 vUv;\nvarying vec3 vpos;\n\nuniform float iTime;\nuniform float pSize;\nuniform vec3 camPosition;\n\nvoid main() {\n  vUv = uv;\n\n  vpos = position;\n\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( vpos, 1.0 );\n}\n"},function(e,t){e.exports=function(e){var t=0,n=0,r=0,i=0;return e.map((function(e){var a=(e=e.slice())[0],o=a.toUpperCase();if(a!=o)switch(e[0]=o,a){case"a":e[6]+=r,e[7]+=i;break;case"v":e[1]+=i;break;case"h":e[1]+=r;break;default:for(var s=1;s<e.length;)e[s++]+=r,e[s++]+=i}switch(o){case"Z":r=t,i=n;break;case"H":r=e[1];break;case"V":i=e[1];break;case"M":r=t=e[1],i=n=e[2];break;default:r=e[e.length-2],i=e[e.length-1]}return e}))}},function(e,t,n){(function(t){var n=function(){"use strict";function e(e,t){return null!=t&&e instanceof t}var n,r,i;try{n=Map}catch(c){n=function(){}}try{r=Set}catch(c){r=function(){}}try{i=Promise}catch(c){i=function(){}}function a(o,c,u,l,h){"object"===typeof c&&(u=c.depth,l=c.prototype,h=c.includeNonEnumerable,c=c.circular);var f=[],p=[],d="undefined"!=typeof t;return"undefined"==typeof c&&(c=!0),"undefined"==typeof u&&(u=1/0),function o(u,m){if(null===u)return null;if(0===m)return u;var v,g;if("object"!=typeof u)return u;if(e(u,n))v=new n;else if(e(u,r))v=new r;else if(e(u,i))v=new i((function(e,t){u.then((function(t){e(o(t,m-1))}),(function(e){t(o(e,m-1))}))}));else if(a.__isArray(u))v=[];else if(a.__isRegExp(u))v=new RegExp(u.source,s(u)),u.lastIndex&&(v.lastIndex=u.lastIndex);else if(a.__isDate(u))v=new Date(u.getTime());else{if(d&&t.isBuffer(u))return v=t.allocUnsafe?t.allocUnsafe(u.length):new t(u.length),u.copy(v),v;e(u,Error)?v=Object.create(u):"undefined"==typeof l?(g=Object.getPrototypeOf(u),v=Object.create(g)):(v=Object.create(l),g=l)}if(c){var y=f.indexOf(u);if(-1!=y)return p[y];f.push(u),p.push(v)}for(var x in e(u,n)&&u.forEach((function(e,t){var n=o(t,m-1),r=o(e,m-1);v.set(n,r)})),e(u,r)&&u.forEach((function(e){var t=o(e,m-1);v.add(t)})),u){var b;g&&(b=Object.getOwnPropertyDescriptor(g,x)),b&&null==b.set||(v[x]=o(u[x],m-1))}if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(u);for(x=0;x<w.length;x++){var _=w[x];(!(E=Object.getOwnPropertyDescriptor(u,_))||E.enumerable||h)&&(v[_]=o(u[_],m-1),E.enumerable||Object.defineProperty(v,_,{enumerable:!1}))}}if(h){var M=Object.getOwnPropertyNames(u);for(x=0;x<M.length;x++){var E,T=M[x];(E=Object.getOwnPropertyDescriptor(u,T))&&E.enumerable||(v[T]=o(u[T],m-1),Object.defineProperty(v,T,{enumerable:!1}))}}return v}(o,u)}function o(e){return Object.prototype.toString.call(e)}function s(e){var t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),t}return a.clonePrototype=function(e){if(null===e)return null;var t=function(){};return t.prototype=e,new t},a.__objToStr=o,a.__isDate=function(e){return"object"===typeof e&&"[object Date]"===o(e)},a.__isArray=function(e){return"object"===typeof e&&"[object Array]"===o(e)},a.__isRegExp=function(e){return"object"===typeof e&&"[object RegExp]"===o(e)},a.__getRegExpFlags=s,a}();e.exports&&(e.exports=n)}).call(this,n(38).Buffer)},function(e,t){e.exports.squaredDistance=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r}},function(e,t,n){var r=n(42),i=n(3),a=n(43),o=n(6),s=n(7).squaredDistance;e.exports.arePointsCollinear=function(e,t,n){var r=e[0],a=e[1],o=t[0],s=t[1],c=n[0],u=n[1];return i((a-s)*(r-c),(a-u)*(r-o))},e.exports.removeDuplicatePoints=function(e){for(var t,n=[],r=0;r<e.length;r++){var i=e[r];t&&a(t,i)||(n.push(i),t=i)}return o(n)},e.exports.removeCollinearPoints=function(t){for(var n=[],r=o(t);r.length>=3;){var i=r[0],a=r[1],c=r[2],u=e.exports.arePointsCollinear(i,a,c);if(u)s(i,a)>s(i,c)&&(u=!1);if(u)r.splice(1,1);else for(var l=0;l<1;l++)n.push(r.shift())}for(;r.length;)n.push(r.shift());return n},e.exports.clipSegmentToCircle=n(46),e.exports.clipLineToCircle=n(47),e.exports.clipPolylinesToBox=function(e,t,n,i){if(!Array.isArray(t)||2!==t.length&&4!==t.length)throw new Error("Expected box to either be format [ minPoint, maxPoint ] or [ minX, minY, maxX, maxY ]");if(2===t.length){var a=t[0],o=t[1];t=[a[0],a[1],o[0],o[1]]}return i=!1!==i,(n=Boolean(n))?e.map((function(e){var n=r.polygon(e,t);return i&&n.length>2&&n.push(n[0]),n})).filter((function(e){return e.length>0})):e.map((function(e){return r.polyline(e,t)})).reduce((function(e,t){return e.concat(t)}),[])},e.exports.createHatchLines=function(e,t,n,r){if(!Array.isArray(e)||2!==e.length&&4!==e.length)throw new Error("Expected box to either be format [ minPoint, maxPoint ] or [ minX, minY, maxX, maxY ]");if(2===e.length){var i=e[0],a=e[1];e=[i[0],i[1],a[0],a[1]]}null==t&&(t=-Math.PI/4);null==n&&(n=.5);null==r&&(r=[]);if(0===(n=Math.abs(n)))throw new Error("cannot use a spacing of zero as it will run an infinite loop!");var o=e[0],s=e[1],c=e[2],u=e[3],l=c-o,h=u-s;if(0===l||0===h)return r;var f=Math.sqrt(l*l+h*h)/2,p=Math.PI/2-t,d=Math.cos(p),m=Math.sin(p),v=o+l/2,g=s+h/2,y=-f;for(;y<=f;){var x=v+y*d+f*m,b=g+y*m-f*d,w=v+y*d-f*m,_=g+y*m+f*d;y+=n,x<o&&w<o||x>c&&w>c||(b<s&&_<s||b>u&&_>u||r.push([[x,b],[w,_]]))}return r},e.exports.getBounds=function(e){var t=e.length;if(0===t)throw new Error("Expected points to be a non-empty array");for(var n=e[0].length,r=e[0].slice(),i=e[0].slice(),a=1;a<t;++a)for(var o=e[a],s=0;s<n;++s){var c=o[s];r[s]=Math.min(r[s],c),i[s]=Math.max(i[s],c)}return[r,i]}},function(e){e.exports=JSON.parse('{"aliceblue":"#f0f8ff","antiquewhite":"#faebd7","aqua":"#00ffff","aquamarine":"#7fffd4","azure":"#f0ffff","beige":"#f5f5dc","bisque":"#ffe4c4","black":"#000000","blanchedalmond":"#ffebcd","blue":"#0000ff","blueviolet":"#8a2be2","brown":"#a52a2a","burlywood":"#deb887","cadetblue":"#5f9ea0","chartreuse":"#7fff00","chocolate":"#d2691e","coral":"#ff7f50","cornflowerblue":"#6495ed","cornsilk":"#fff8dc","crimson":"#dc143c","cyan":"#00ffff","darkblue":"#00008b","darkcyan":"#008b8b","darkgoldenrod":"#b8860b","darkgray":"#a9a9a9","darkgreen":"#006400","darkgrey":"#a9a9a9","darkkhaki":"#bdb76b","darkmagenta":"#8b008b","darkolivegreen":"#556b2f","darkorange":"#ff8c00","darkorchid":"#9932cc","darkred":"#8b0000","darksalmon":"#e9967a","darkseagreen":"#8fbc8f","darkslateblue":"#483d8b","darkslategray":"#2f4f4f","darkslategrey":"#2f4f4f","darkturquoise":"#00ced1","darkviolet":"#9400d3","deeppink":"#ff1493","deepskyblue":"#00bfff","dimgray":"#696969","dimgrey":"#696969","dodgerblue":"#1e90ff","firebrick":"#b22222","floralwhite":"#fffaf0","forestgreen":"#228b22","fuchsia":"#ff00ff","gainsboro":"#dcdcdc","ghostwhite":"#f8f8ff","gold":"#ffd700","goldenrod":"#daa520","gray":"#808080","green":"#008000","greenyellow":"#adff2f","grey":"#808080","honeydew":"#f0fff0","hotpink":"#ff69b4","indianred":"#cd5c5c","indigo":"#4b0082","ivory":"#fffff0","khaki":"#f0e68c","lavender":"#e6e6fa","lavenderblush":"#fff0f5","lawngreen":"#7cfc00","lemonchiffon":"#fffacd","lightblue":"#add8e6","lightcoral":"#f08080","lightcyan":"#e0ffff","lightgoldenrodyellow":"#fafad2","lightgray":"#d3d3d3","lightgreen":"#90ee90","lightgrey":"#d3d3d3","lightpink":"#ffb6c1","lightsalmon":"#ffa07a","lightseagreen":"#20b2aa","lightskyblue":"#87cefa","lightslategray":"#778899","lightslategrey":"#778899","lightsteelblue":"#b0c4de","lightyellow":"#ffffe0","lime":"#00ff00","limegreen":"#32cd32","linen":"#faf0e6","magenta":"#ff00ff","maroon":"#800000","mediumaquamarine":"#66cdaa","mediumblue":"#0000cd","mediumorchid":"#ba55d3","mediumpurple":"#9370db","mediumseagreen":"#3cb371","mediumslateblue":"#7b68ee","mediumspringgreen":"#00fa9a","mediumturquoise":"#48d1cc","mediumvioletred":"#c71585","midnightblue":"#191970","mintcream":"#f5fffa","mistyrose":"#ffe4e1","moccasin":"#ffe4b5","navajowhite":"#ffdead","navy":"#000080","oldlace":"#fdf5e6","olive":"#808000","olivedrab":"#6b8e23","orange":"#ffa500","orangered":"#ff4500","orchid":"#da70d6","palegoldenrod":"#eee8aa","palegreen":"#98fb98","paleturquoise":"#afeeee","palevioletred":"#db7093","papayawhip":"#ffefd5","peachpuff":"#ffdab9","peru":"#cd853f","pink":"#ffc0cb","plum":"#dda0dd","powderblue":"#b0e0e6","purple":"#800080","rebeccapurple":"#663399","red":"#ff0000","rosybrown":"#bc8f8f","royalblue":"#4169e1","saddlebrown":"#8b4513","salmon":"#fa8072","sandybrown":"#f4a460","seagreen":"#2e8b57","seashell":"#fff5ee","sienna":"#a0522d","silver":"#c0c0c0","skyblue":"#87ceeb","slateblue":"#6a5acd","slategray":"#708090","slategrey":"#708090","snow":"#fffafa","springgreen":"#00ff7f","steelblue":"#4682b4","tan":"#d2b48c","teal":"#008080","thistle":"#d8bfd8","tomato":"#ff6347","turquoise":"#40e0d0","violet":"#ee82ee","wheat":"#f5deb3","white":"#ffffff","whitesmoke":"#f5f5f5","yellow":"#ffff00","yellowgreen":"#9acd32"}')},function(e,t,n){var r=n(56),i=n(57),a=n(2);e.exports.RGBAToHSLA=function(e){var t=i([e[0]/255,e[1]/255,e[2]/255]);return[Math.max(0,Math.min(360,Math.round(360*t[0]))),Math.max(0,Math.min(100,Math.round(100*t[1]))),Math.max(0,Math.min(100,Math.round(100*t[2]))),e[3]]},e.exports.HSLAToRGBA=function(e){var t=a(e[0],0,360),n=r([t/360,e[1]/100,e[2]/100]);return[Math.max(0,Math.min(255,Math.round(255*n[0]))),Math.max(0,Math.min(255,Math.round(255*n[1]))),Math.max(0,Math.min(255,Math.round(255*n[2]))),e[3]]}},function(e,t){e.exports=function(e){if("string"!==typeof e)throw new TypeError("Hex code parsing must be performed on a string parameter");if(e=e.toLowerCase(),!/^#[a-f0-9]+$/.test(e))return null;var t=e.replace(/^#/,""),n=1;8===t.length&&(n=parseInt(t.slice(6,8),16)/255,t=t.slice(0,6));4===t.length&&(n=parseInt(t.slice(3,4).repeat(2),16)/255,t=t.slice(0,3));3===t.length&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]);var r=parseInt(t,16);return[r>>16,r>>8&255,255&r,n]}},function(e,t){e.exports=function(e){if(!e||!Array.isArray(e))throw new TypeError("Must specify an array to convert into a hex code");var t=Math.max(0,Math.min(255,Math.round(e[0]||0))),n=Math.max(0,Math.min(255,Math.round(e[1]||0))),r=Math.max(0,Math.min(255,Math.round(e[2]||0))),i=e[3];"undefined"!==typeof i&&isFinite(i)||(i=1);var a=Math.max(0,Math.min(255,Math.round(255*i))),o=255===a?"":(256|a).toString(16).slice(1);return"#"+((r|n<<8|t<<16|1<<24).toString(16).slice(1)+o)}},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t,n){(function(t){var n;n=function(){var e=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable;function i(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}var a=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(i){return!1}}()?Object.assign:function(t,a){for(var o,s,c=i(t),u=1;u<arguments.length;u++){for(var l in o=Object(arguments[u]))n.call(o,l)&&(c[l]=o[l]);if(e){s=e(o);for(var h=0;h<s.length;h++)r.call(o,s[h])&&(c[s[h]]=o[s[h]])}}return c},o="undefined"!==typeof window?window:"undefined"!==typeof t?t:"undefined"!==typeof self?self:{};function s(e,t){return e(t={exports:{}},t.exports),t.exports}var c=o.performance&&o.performance.now?function(){return performance.now()}:Date.now||function(){return+new Date},u=function(e){return!!e&&("object"===typeof e||"function"===typeof e)&&"function"===typeof e.then},l=function(e){return!(!e||"object"!==typeof e)&&("object"===typeof window&&"object"===typeof window.Node?e instanceof window.Node:"number"===typeof e.nodeType&&"string"===typeof e.nodeName)};function h(){return"undefined"!==typeof window&&window["canvas-sketch-cli"]}function f(){for(var e=arguments,t=0;t<arguments.length;t++)if(null!=e[t])return e[t]}function p(){return"undefined"!==typeof document}var d,m,v=s((function(e,t){function n(e){var t=[];for(var n in e)t.push(n);return t}(e.exports="function"===typeof Object.keys?Object.keys:n).shim=n})),g=(v.shim,s((function(e,t){var n="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();function r(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function i(e){return e&&"object"==typeof e&&"number"==typeof e.length&&Object.prototype.hasOwnProperty.call(e,"callee")&&!Object.prototype.propertyIsEnumerable.call(e,"callee")||!1}(t=e.exports=n?r:i).supported=r,t.unsupported=i}))),y=(g.supported,g.unsupported,s((function(e){var t=Array.prototype.slice,n=e.exports=function(e,a,o){return o||(o={}),e===a||(e instanceof Date&&a instanceof Date?e.getTime()===a.getTime():!e||!a||"object"!=typeof e&&"object"!=typeof a?o.strict?e===a:e==a:function(e,a,o){var s,c;if(r(e)||r(a))return!1;if(e.prototype!==a.prototype)return!1;if(g(e))return!!g(a)&&(e=t.call(e),a=t.call(a),n(e,a,o));if(i(e)){if(!i(a))return!1;if(e.length!==a.length)return!1;for(s=0;s<e.length;s++)if(e[s]!==a[s])return!1;return!0}try{var u=v(e),l=v(a)}catch(h){return!1}if(u.length!=l.length)return!1;for(u.sort(),l.sort(),s=u.length-1;s>=0;s--)if(u[s]!=l[s])return!1;for(s=u.length-1;s>=0;s--)if(c=u[s],!n(e[c],a[c],o))return!1;return typeof e===typeof a}(e,a,o))};function r(e){return null===e||void 0===e}function i(e){return!(!e||"object"!==typeof e||"number"!==typeof e.length)&&"function"===typeof e.copy&&"function"===typeof e.slice&&!(e.length>0&&"number"!==typeof e[0])}}))),x=s((function(e,t){!function(t){var n=function(){var e=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZWN]|"[^"]*"|'[^']*'/g,t=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,s=/[^-+\dA-Z]/g;return function(c,u,l,h){if(1!==arguments.length||"string"!==o(c)||/\d/.test(c)||(u=c,c=void 0),(c=c||new Date)instanceof Date||(c=new Date(c)),isNaN(c))throw TypeError("Invalid date");var f=(u=String(n.masks[u]||u||n.masks.default)).slice(0,4);"UTC:"!==f&&"GMT:"!==f||(u=u.slice(4),l=!0,"GMT:"===f&&(h=!0));var p=l?"getUTC":"get",d=c[p+"Date"](),m=c[p+"Day"](),v=c[p+"Month"](),g=c[p+"FullYear"](),y=c[p+"Hours"](),x=c[p+"Minutes"](),b=c[p+"Seconds"](),w=c[p+"Milliseconds"](),_=l?0:c.getTimezoneOffset(),M=i(c),E=a(c),T={d:d,dd:r(d),ddd:n.i18n.dayNames[m],dddd:n.i18n.dayNames[m+7],m:v+1,mm:r(v+1),mmm:n.i18n.monthNames[v],mmmm:n.i18n.monthNames[v+12],yy:String(g).slice(2),yyyy:g,h:y%12||12,hh:r(y%12||12),H:y,HH:r(y),M:x,MM:r(x),s:b,ss:r(b),l:r(w,3),L:r(Math.round(w/10)),t:y<12?n.i18n.timeNames[0]:n.i18n.timeNames[1],tt:y<12?n.i18n.timeNames[2]:n.i18n.timeNames[3],T:y<12?n.i18n.timeNames[4]:n.i18n.timeNames[5],TT:y<12?n.i18n.timeNames[6]:n.i18n.timeNames[7],Z:h?"GMT":l?"UTC":(String(c).match(t)||[""]).pop().replace(s,""),o:(_>0?"-":"+")+r(100*Math.floor(Math.abs(_)/60)+Math.abs(_)%60,4),S:["th","st","nd","rd"][d%10>3?0:(d%100-d%10!=10)*d%10],W:M,N:E};return u.replace(e,(function(e){return e in T?T[e]:e.slice(1,e.length-1)}))}}();function r(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e}function i(e){var t=new Date(e.getFullYear(),e.getMonth(),e.getDate());t.setDate(t.getDate()-(t.getDay()+6)%7+3);var n=new Date(t.getFullYear(),0,4);n.setDate(n.getDate()-(n.getDay()+6)%7+3);var r=t.getTimezoneOffset()-n.getTimezoneOffset();t.setHours(t.getHours()-r);var i=(t-n)/6048e5;return 1+Math.floor(i)}function a(e){var t=e.getDay();return 0===t&&(t=7),t}function o(e){return null===e?"null":void 0===e?"undefined":"object"!==typeof e?typeof e:Array.isArray(e)?"array":{}.toString.call(e).slice(8,-1).toLowerCase()}n.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},n.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],timeNames:["a","p","am","pm","A","P","AM","PM"]},e.exports=n}()})),b="",w=function(e,t){if("string"!==typeof e)throw new TypeError("expected a string");if(1===t)return e;if(2===t)return e+e;var n=e.length*t;if(d!==e||"undefined"===typeof d)d=e,b="";else if(b.length>=n)return b.substr(0,n);for(;n>b.length&&t>1;)1&t&&(b+=e),t>>=1,e+=e;return b=(b+=e).substr(0,n)},_=function(){},M={extension:"",prefix:"",suffix:""},E=["image/png","image/jpeg","image/webp"];function T(e,t){return void 0===t&&(t={}),new Promise((function(n,r){t=a({},M,t);var i=L(Object.assign({},t,{extension:"",frame:void 0})),o=e?"streamStart":"streamEnd",s=h();return s&&s.output&&"function"===typeof s[o]?s[o](a({},t,{filename:i})).then((function(e){return n(e)})):n({filename:i,client:!1})}))}function S(e,t){return void 0===t&&(t={}),function(e){return new Promise((function(t){var n=e.indexOf(",");if(-1!==n){for(var r=e.slice(n+1),i=window.atob(r),a=e.slice(0,n),o=/data:([^;]+)/.exec(a),s=(o?o[1]:"")||void 0,c=new ArrayBuffer(i.length),u=new Uint8Array(c),l=0;l<i.length;l++)u[l]=i.charCodeAt(l);t(new window.Blob([c],{type:s}))}else t(new window.Blob)}))}(e).then((function(e){return A(e,t)}))}function A(e,t){return void 0===t&&(t={}),new Promise((function(n){var r=(t=a({},M,t)).filename,i=h();if(i&&"function"===typeof i.saveBlob&&i.output)return i.saveBlob(e,a({},t,{filename:r})).then((function(e){return n(e)}));m||((m=document.createElement("a")).style.visibility="hidden",m.target="_blank"),m.download=r,m.href=window.URL.createObjectURL(e),document.body.appendChild(m),m.onclick=function(){m.onclick=_,setTimeout((function(){window.URL.revokeObjectURL(e),m.parentElement&&m.parentElement.removeChild(m),m.removeAttribute("href"),n({filename:r,client:!1})}))},m.click()}))}function L(e){if(void 0===e&&(e={}),"function"===typeof(e=a({},e)).file)return e.file(e);if(e.file)return e.file;var t,n,r,i,o=null,s="";"string"===typeof e.extension&&(s=e.extension),"number"===typeof e.frame&&(t="number"===typeof e.totalFrames?e.totalFrames:Math.max(1e4,e.frame),n=String(e.frame),r=String(t).length,i="0",n=n.toString(),o="undefined"===typeof r?n:(i=0===i?"0":i?i.toString():" ",w(i,r-n.length)+n));var c=isFinite(e.totalLayers)&&isFinite(e.layer)&&e.totalLayers>1?""+e.layer:"";if(null!=o)return[c,o].filter(Boolean).join("-")+s;var u=e.timeStamp;return[e.prefix,e.name||u,c,e.hash,e.suffix].filter(Boolean).join("-")+s}var R={dimension:"dimensions",animated:"animate",animating:"animate",unit:"units",P5:"p5",pixellated:"pixelated",looping:"loop",pixelPerInch:"pixels"},P=["dimensions","units","pixelsPerInch","orientation","scaleToFit","scaleToView","bleed","pixelRatio","exportPixelRatio","maxPixelRatio","scaleContext","resizeCanvas","styleCanvas","canvas","context","attributes","parent","file","name","prefix","suffix","animate","playing","loop","duration","totalFrames","fps","playbackRate","timeScale","frame","time","flush","pixelated","hotkeys","p5","id","scaleToFitPadding","data","params","encoding","encodingQuality"],C=function(e){Object.keys(e).forEach((function(e){if(e in R){var t=R[e];console.warn('[canvas-sketch] Could not recognize the setting "'+e+'", did you mean "'+t+'"?')}else P.includes(e)||console.warn('[canvas-sketch] Could not recognize the setting "'+e+'"')}))},O=[["postcard",101.6,152.4],["poster-small",280,430],["poster",460,610],["poster-large",610,910],["business-card",50.8,88.9],["2r",64,89],["3r",89,127],["4r",102,152],["5r",127,178],["6r",152,203],["8r",203,254],["10r",254,305],["11r",279,356],["12r",305,381],["a0",841,1189],["a1",594,841],["a2",420,594],["a3",297,420],["a4",210,297],["a5",148,210],["a6",105,148],["a7",74,105],["a8",52,74],["a9",37,52],["a10",26,37],["2a0",1189,1682],["4a0",1682,2378],["b0",1e3,1414],["b1",707,1e3],["b1+",720,1020],["b2",500,707],["b2+",520,720],["b3",353,500],["b4",250,353],["b5",176,250],["b6",125,176],["b7",88,125],["b8",62,88],["b9",44,62],["b10",31,44],["b11",22,32],["b12",16,22],["c0",917,1297],["c1",648,917],["c2",458,648],["c3",324,458],["c4",229,324],["c5",162,229],["c6",114,162],["c7",81,114],["c8",57,81],["c9",40,57],["c10",28,40],["c11",22,32],["c12",16,22],["half-letter",5.5,8.5,"in"],["letter",8.5,11,"in"],["legal",8.5,14,"in"],["junior-legal",5,8,"in"],["ledger",11,17,"in"],["tabloid",11,17,"in"],["ansi-a",8.5,11,"in"],["ansi-b",11,17,"in"],["ansi-c",17,22,"in"],["ansi-d",22,34,"in"],["ansi-e",34,44,"in"],["arch-a",9,12,"in"],["arch-b",12,18,"in"],["arch-c",18,24,"in"],["arch-d",24,36,"in"],["arch-e",36,48,"in"],["arch-e1",30,42,"in"],["arch-e2",26,38,"in"],["arch-e3",27,39,"in"]].reduce((function(e,t){var n={units:t[3]||"mm",dimensions:[t[1],t[2]]};return e[t[0]]=n,e[t[0].replace(/-/g," ")]=n,e}),{}),D=["mm","cm","m","pc","pt","in","ft","px"],I={m:{system:"metric",factor:1},cm:{system:"metric",factor:.01},mm:{system:"metric",factor:.001},pt:{system:"imperial",factor:1/72},pc:{system:"imperial",factor:1/6},in:{system:"imperial",factor:1},ft:{system:"imperial",factor:12}};const N={metric:{unit:"m",ratio:1/.0254},imperial:{unit:"in",ratio:.0254}};var z=function(e,t,n,r){if("number"!==typeof e||!isFinite(e))throw new Error("Value must be a finite number");if(!t||!n)throw new Error("Must specify from and to units");var i=function(){for(var e=0;e<arguments.length;e++)if(void 0!==arguments[e])return arguments[e]}((r=r||{}).pixelsPerInch,96),a=r.precision,o=!1!==r.roundPixel;if(t=t.toLowerCase(),n=n.toLowerCase(),-1===D.indexOf(t))throw new Error('Invalid from unit "'+t+'", must be one of: '+D.join(", "));if(-1===D.indexOf(n))throw new Error('Invalid from unit "'+n+'", must be one of: '+D.join(", "));if(t===n)return e;var s=1,c=1,u=!1;"px"===t&&(c=1/i,t="in"),"px"===n&&(u=!0,s=i,n="in");var l=I[t],h=I[n],f=e*l.factor*c;l.system!==h.system&&(f*=N[l.system].ratio);var p=f/h.factor*s;return u&&o?p=Math.round(p):"number"===typeof a&&isFinite(a)&&(p=function(e,t){return Number(Math.round(e+"e"+t)+"e-"+t)}(p,a)),p},k=D;function F(e,t,n,r){return void 0===t&&(t="px"),void 0===n&&(n="px"),void 0===r&&(r=72),z(e,t,n,{pixelsPerInch:r,precision:4,roundPixel:!0})}function B(e,t){var n,r,i,a,o,s,c=p(),u=t.dimensions,l=function(e){return!!e.dimensions&&("string"===typeof e.dimensions||!!(Array.isArray(e.dimensions)&&e.dimensions.length>=2))}(t),h=e.exporting,d=!!l&&!1!==t.scaleToFit,m=!(!h&&l)||t.scaleToView;c||(d=m=!1);var v,g,y=t.units,x="number"===typeof t.pixelsPerInch&&isFinite(t.pixelsPerInch)?t.pixelsPerInch:72,b=f(t.bleed,0),w=c?window.devicePixelRatio:1,_=m?w:1;"number"===typeof t.pixelRatio&&isFinite(t.pixelRatio)?(v=t.pixelRatio,g=f(t.exportPixelRatio,v)):l?(v=_,g=f(t.exportPixelRatio,1)):(v=w,g=f(t.exportPixelRatio,v)),"number"===typeof t.maxPixelRatio&&isFinite(t.maxPixelRatio)&&(v=Math.min(t.maxPixelRatio,v)),h&&(v=g);var M,E,T=function(e,t){if(!p())return[300,150];var n=t.parent||window;if(n===window||n===document||n===document.body)return[window.innerWidth,window.innerHeight];var r=n.getBoundingClientRect();return[r.width,r.height]}(0,t),S=T[0],A=T[1];if(l){var L=function(e,t,n){if(void 0===t&&(t="px"),void 0===n&&(n=72),"string"===typeof e){var r=e.toLowerCase();if(!(r in O))throw new Error('The dimension preset "'+e+'" is not supported or could not be found; try using a4, a3, postcard, letter, etc.');var i=O[r];return i.dimensions.map((function(e){return F(e,i.units,t,n)}))}return e}(u,y,x),R=Math.max(L[0],L[1]),P=Math.min(L[0],L[1]);if(t.orientation){var C="landscape"===t.orientation;n=C?R:P,r=C?P:R}else n=L[0],r=L[1];M=n,E=r,n+=2*b,r+=2*b}else M=n=S,E=r=A;var D=n,I=r;if(l&&y&&(D=F(n,y,"px",x),I=F(r,y,"px",x)),i=Math.round(D),a=Math.round(I),d&&!h&&l){var N=n/r,z=S/A,k=f(t.scaleToFitPadding,40),B=Math.round(S-2*k),U=Math.round(A-2*k);(i>B||a>U)&&(z>N?(a=U,i=Math.round(a*N)):(i=B,a=Math.round(i/N)))}return{bleed:b,pixelRatio:v,width:n,height:r,dimensions:[n,r],units:y||"px",scaleX:(o=m?Math.round(v*i):Math.round(v*D))/n,scaleY:(s=m?Math.round(v*a):Math.round(v*I))/r,pixelsPerInch:x,viewportWidth:m?Math.round(i):Math.round(D),viewportHeight:m?Math.round(a):Math.round(I),canvasWidth:o,canvasHeight:s,trimWidth:M,trimHeight:E,styleWidth:i,styleHeight:a}}z.units=k;var U=function(e,t){if("string"!==typeof e)throw new TypeError("must specify type string");if(t=t||{},"undefined"===typeof document&&!t.canvas)return null;var n=t.canvas||document.createElement("canvas");"number"===typeof t.width&&(n.width=t.width),"number"===typeof t.height&&(n.height=t.height);var r,i=t;try{var a=[e];0===e.indexOf("webgl")&&a.push("experimental-"+e);for(var o=0;o<a.length;o++)if(r=n.getContext(a[o],i))return r}catch(s){r=null}return r||null};function H(e){var t,n;void 0===e&&(e={});var r=!1;if(!1!==e.canvas){if(!(t=e.context)||"string"===typeof t){var i=e.canvas;i||(i=function(){if(!p())throw new Error("It appears you are runing from Node.js or a non-browser environment. Try passing in an existing { canvas } interface instead.");return document.createElement("canvas")}(),r=!0);var o=t||"2d";if("function"!==typeof i.getContext)throw new Error("The specified { canvas } element does not have a getContext() function, maybe it is not a <canvas> tag?");if(!(t=U(o,a({},e.attributes,{canvas:i}))))throw new Error("Failed at canvas.getContext('"+o+"') - the browser may not support this context, or a different context may already be in use with this canvas.")}if(n=t.canvas,e.canvas&&n!==e.canvas)throw new Error("The { canvas } and { context } settings must point to the same underlying canvas element");e.pixelated&&(t.imageSmoothingEnabled=!1,t.mozImageSmoothingEnabled=!1,t.oImageSmoothingEnabled=!1,t.webkitImageSmoothingEnabled=!1,t.msImageSmoothingEnabled=!1,n.style["image-rendering"]="pixelated")}return{canvas:n,context:t,ownsCanvas:r}}var G=function(){var e=this;this._settings={},this._props={},this._sketch=void 0,this._raf=null,this._recordTimeout=null,this._lastRedrawResult=void 0,this._isP5Resizing=!1,this._keyboardShortcuts=function(e){void 0===e&&(e={});var t=function(t){if(e.enabled()){var n=h();83!==t.keyCode||t.altKey||!t.metaKey&&!t.ctrlKey?32===t.keyCode?e.togglePlay(t):n&&!t.altKey&&75===t.keyCode&&(t.metaKey||t.ctrlKey)&&(t.preventDefault(),e.commit(t)):(t.preventDefault(),e.save(t))}};return{attach:function(){window.addEventListener("keydown",t)},detach:function(){window.removeEventListener("keydown",t)}}}({enabled:function(){return!1!==e.settings.hotkeys},save:function(t){t.shiftKey?e.props.recording?(e.endRecord(),e.run()):e.record():e.props.recording||e.exportFrame()},togglePlay:function(){e.props.playing?e.pause():e.play()},commit:function(t){e.exportFrame({commit:!0})}}),this._animateHandler=function(){return e.animate()},this._resizeHandler=function(){e.resize()&&e.render()}},j={sketch:{configurable:!0},settings:{configurable:!0},props:{configurable:!0}};j.sketch.get=function(){return this._sketch},j.settings.get=function(){return this._settings},j.props.get=function(){return this._props},G.prototype._computePlayhead=function(e,t){return"number"===typeof t&&isFinite(t)?e/t:0},G.prototype._computeFrame=function(e,t,n,r){return isFinite(n)&&n>1?Math.floor(e*(n-1)):Math.floor(r*t)},G.prototype._computeCurrentFrame=function(){return this._computeFrame(this.props.playhead,this.props.time,this.props.totalFrames,this.props.fps)},G.prototype._getSizeProps=function(){var e=this.props;return{width:e.width,height:e.height,pixelRatio:e.pixelRatio,canvasWidth:e.canvasWidth,canvasHeight:e.canvasHeight,viewportWidth:e.viewportWidth,viewportHeight:e.viewportHeight}},G.prototype.run=function(){if(!this.sketch)throw new Error("should wait until sketch is loaded before trying to play()");return!1!==this.settings.playing&&this.play(),"function"===typeof this.sketch.dispose&&console.warn("In canvas-sketch@0.0.23 the dispose() event has been renamed to unload()"),this.props.started||(this._signalBegin(),this.props.started=!0),this.tick(),this.render(),this},G.prototype._cancelTimeouts=function(){null!=this._raf&&"undefined"!==typeof window&&"function"===typeof window.cancelAnimationFrame&&(window.cancelAnimationFrame(this._raf),this._raf=null),null!=this._recordTimeout&&(clearTimeout(this._recordTimeout),this._recordTimeout=null)},G.prototype.play=function(){var e=this.settings.animate;"animation"in this.settings&&(e=!0,console.warn("[canvas-sketch] { animation } has been renamed to { animate }")),e&&(p()?this.props.playing||(this.props.started||(this._signalBegin(),this.props.started=!0),this.props.playing=!0,this._cancelTimeouts(),this._lastTime=c(),this._raf=window.requestAnimationFrame(this._animateHandler)):console.error("[canvas-sketch] WARN: Using { animate } in Node.js is not yet supported"))},G.prototype.pause=function(){this.props.recording&&this.endRecord(),this.props.playing=!1,this._cancelTimeouts()},G.prototype.togglePlay=function(){this.props.playing?this.pause():this.play()},G.prototype.stop=function(){this.pause(),this.props.frame=0,this.props.playhead=0,this.props.time=0,this.props.deltaTime=0,this.props.started=!1,this.render()},G.prototype.record=function(){var e=this;if(!this.props.recording)if(p()){this.stop(),this.props.playing=!0,this.props.recording=!0;var t=this._createExportOptions({sequence:!0}),n=1/this.props.fps;this._cancelTimeouts();var r,i=function(){return e.props.recording?(e.props.deltaTime=n,e.tick(),e.exportFrame(t).then((function(){e.props.recording&&(e.props.deltaTime=0,e.props.frame++,e.props.frame<e.props.totalFrames?(e.props.time+=n,e.props.playhead=e._computePlayhead(e.props.time,e.props.duration),e._recordTimeout=setTimeout(i,0)):(console.log("Finished recording"),e._signalEnd(),e.endRecord(),e.stop(),e.run()))}))):Promise.resolve()};this.props.started||(this._signalBegin(),this.props.started=!0),this.sketch&&"function"===typeof this.sketch.beginRecord&&this._wrapContextScale((function(t){return e.sketch.beginRecord(t)})),(r=t,void 0===r&&(r={}),T(!0,r)).catch((function(e){console.error(e)})).then((function(t){e._raf=window.requestAnimationFrame(i)}))}else console.error("[canvas-sketch] WARN: Recording from Node.js is not yet supported")},G.prototype._signalBegin=function(){var e=this;this.sketch&&"function"===typeof this.sketch.begin&&this._wrapContextScale((function(t){return e.sketch.begin(t)}))},G.prototype._signalEnd=function(){var e=this;this.sketch&&"function"===typeof this.sketch.end&&this._wrapContextScale((function(t){return e.sketch.end(t)}))},G.prototype.endRecord=function(){var e,t=this,n=this.props.recording;return this._cancelTimeouts(),this.props.recording=!1,this.props.deltaTime=0,this.props.playing=!1,(void 0===e&&(e={}),T(!1,e)).catch((function(e){console.error(e)})).then((function(){n&&t.sketch&&"function"===typeof t.sketch.endRecord&&t._wrapContextScale((function(e){return t.sketch.endRecord(e)}))}))},G.prototype._createExportOptions=function(e){return void 0===e&&(e={}),{sequence:e.sequence,save:e.save,fps:this.props.fps,frame:e.sequence?this.props.frame:void 0,file:this.settings.file,name:this.settings.name,prefix:this.settings.prefix,suffix:this.settings.suffix,encoding:this.settings.encoding,encodingQuality:this.settings.encodingQuality,timeStamp:e.timeStamp||x(new Date,"yyyy.mm.dd-HH.MM.ss"),totalFrames:isFinite(this.props.totalFrames)?Math.max(0,this.props.totalFrames):1e3}},G.prototype.exportFrame=function(e){var t=this;if(void 0===e&&(e={}),!this.sketch)return Promise.all([]);"function"===typeof this.sketch.preExport&&this.sketch.preExport();var n=this._createExportOptions(e),r=h(),i=Promise.resolve();if(r&&e.commit&&"function"===typeof r.commit){var o=a({},n),s=r.commit(o);i=u(s)?s:Promise.resolve(s)}return i.then((function(e){return t._doExportFrame(a({},n,{hash:e||""}))})).then((function(e){return 1===e.length?e[0]:e}))},G.prototype._doExportFrame=function(e){var t=this;void 0===e&&(e={}),this._props.exporting=!0,this.resize();var n=this.render(),r=this.props.canvas;return"undefined"===typeof n&&(n=[r]),n=(n=[].concat(n).filter(Boolean)).map((function(t){var n,r="object"===typeof t&&t&&("data"in t||"dataURL"in t),i=r?t.data:t,o=r?a({},t,{data:i}):{data:i};if(l(n=i)&&/canvas/i.test(n.nodeName)&&"function"===typeof n.getContext){var s=function(e,t){void 0===t&&(t={});var n=t.encoding||"image/png";if(!E.includes(n))throw new Error("Invalid canvas encoding "+n);var r=(n.split("/")[1]||"").replace(/jpeg/i,"jpg");return r&&(r=("."+r).toLowerCase()),{extension:r,type:n,dataURL:e.toDataURL(n,t.encodingQuality)}}(i,{encoding:o.encoding||e.encoding,encodingQuality:f(o.encodingQuality,e.encodingQuality,.95)}),c=s.dataURL,u=s.extension,h=s.type;return Object.assign(o,{dataURL:c,extension:u,type:h})}return o})),this._props.exporting=!1,this.resize(),this.render(),Promise.all(n.map((function(t,n,r){var i=a({extension:"",prefix:"",suffix:""},e,t,{layer:n,totalLayers:r.length}),o=!1!==e.save&&t.save;for(var s in i.save=!1!==o,i.filename=L(i),delete i.encoding,delete i.encodingQuality,i)"undefined"===typeof i[s]&&delete i[s];var c=Promise.resolve({});if(i.save){var u=i.data;c=i.dataURL?S(i.dataURL,i):function(e,t){void 0===t&&(t={});var n=Array.isArray(e)?e:[e];return A(new window.Blob(n,{type:t.type||""}),t)}(u,i)}return c.then((function(e){return Object.assign({},i,e)}))}))).then((function(n){var r=n.filter((function(e){return e.save}));if(r.length>0){var i,a=r.find((function(e){return e.outputName})),o=r.some((function(e){return e.client})),s=r.some((function(e){return e.stream}));i=r.length>1?r.length:a?a.outputName+"/"+r[0].filename:""+r[0].filename;var c="";e.sequence?c=isFinite(t.props.totalFrames)?" (frame "+(e.frame+1)+" / "+t.props.totalFrames+")":" (frame "+e.frame+")":r.length>1&&(c=" files");var u=o?"canvas-sketch-cli":"canvas-sketch",l=s?"Streaming into":"Exported";console.log("%c["+u+"]%c "+l+" %c"+i+"%c"+c,"color: #8e8e8e;","color: initial;","font-weight: bold;","font-weight: initial;")}return"function"===typeof t.sketch.postExport&&t.sketch.postExport(),n}))},G.prototype._wrapContextScale=function(e){this._preRender(),e(this.props),this._postRender()},G.prototype._preRender=function(){var e=this.props;this.props.gl||!e.context||e.p5?e.p5&&e.p5.scale(e.scaleX/e.pixelRatio,e.scaleY/e.pixelRatio):(e.context.save(),!1!==this.settings.scaleContext&&e.context.scale(e.scaleX,e.scaleY))},G.prototype._postRender=function(){var e=this.props;this.props.gl||!e.context||e.p5||e.context.restore(),e.gl&&!1!==this.settings.flush&&!e.p5&&e.gl.flush()},G.prototype.tick=function(){this.sketch&&"function"===typeof this.sketch.tick&&(this._preRender(),this.sketch.tick(this.props),this._postRender())},G.prototype.render=function(){return this.props.p5?(this._lastRedrawResult=void 0,this.props.p5.redraw(),this._lastRedrawResult):this.submitDrawCall()},G.prototype.submitDrawCall=function(){if(this.sketch){var e,t=this.props;return this._preRender(),"function"===typeof this.sketch?e=this.sketch(t):"function"===typeof this.sketch.render&&(e=this.sketch.render(t)),this._postRender(),e}},G.prototype.update=function(e){var t=this;void 0===e&&(e={});var n=["animate"];Object.keys(e).forEach((function(e){if(n.indexOf(e)>=0)throw new Error("Sorry, the { "+e+" } option is not yet supported with update().")}));var r=this._settings.canvas,i=this._settings.context;for(var a in e){var o=e[a];"undefined"!==typeof o&&(t._settings[a]=o)}var s=Object.assign({},this._settings,e);if("time"in e&&"frame"in e)throw new Error("You should specify { time } or { frame } but not both");if("time"in e?delete s.frame:"frame"in e&&delete s.time,"duration"in e&&"totalFrames"in e)throw new Error("You should specify { duration } or { totalFrames } but not both");"duration"in e?delete s.totalFrames:"totalFrames"in e&&delete s.duration,"data"in e&&(this._props.data=e.data);var c=this.getTimeProps(s);if(Object.assign(this._props,c),r!==this._settings.canvas||i!==this._settings.context){var u=H(this._settings),l=u.canvas,h=u.context;this.props.canvas=l,this.props.context=h,this._setupGLKey(),this._appendCanvasIfNeeded()}return e.p5&&"function"!==typeof e.p5&&(this.props.p5=e.p5,this.props.p5.draw=function(){t._isP5Resizing||(t._lastRedrawResult=t.submitDrawCall())}),"playing"in e&&(e.playing?this.play():this.pause()),C(this._settings),this.resize(),this.render(),this.props},G.prototype.resize=function(){var e=this._getSizeProps(),t=this.settings,n=this.props,r=B(n,t);Object.assign(this._props,r);var i=this.props,a=i.pixelRatio,o=i.canvasWidth,s=i.canvasHeight,c=i.styleWidth,u=i.styleHeight,l=this.props.canvas;l&&!1!==t.resizeCanvas&&(n.p5?l.width===o&&l.height===s||(this._isP5Resizing=!0,n.p5.pixelDensity(a),n.p5.resizeCanvas(o/a,s/a,!1),this._isP5Resizing=!1):(l.width!==o&&(l.width=o),l.height!==s&&(l.height=s)),p()&&!1!==t.styleCanvas&&(l.style.width=c+"px",l.style.height=u+"px"));var h=this._getSizeProps(),f=!y(e,h);return f&&this._sizeChanged(),f},G.prototype._sizeChanged=function(){this.sketch&&"function"===typeof this.sketch.resize&&this.sketch.resize(this.props)},G.prototype.animate=function(){if(this.props.playing)if(p()){this._raf=window.requestAnimationFrame(this._animateHandler);var e=c(),t=1e3/this.props.fps,n=e-this._lastTime,r=this.props.duration,i="number"===typeof r&&isFinite(r),a=!0,o=this.settings.playbackRate;"fixed"===o?n=t:"throttle"===o?n>t?(e-=n%t,this._lastTime=e):a=!1:this._lastTime=e;var s=n/1e3,u=this.props.time+s*this.props.timeScale;u<0&&i&&(u=r+u);var l=!1,h=!1,f=!1!==this.settings.loop;if(i&&u>=r&&(f?(a=!0,u%=r,h=!0):(a=!1,u=r,l=!0),this._signalEnd()),a){this.props.deltaTime=s,this.props.time=u,this.props.playhead=this._computePlayhead(u,r);var d=this.props.frame;this.props.frame=this._computeCurrentFrame(),h&&this._signalBegin(),d!==this.props.frame&&this.tick(),this.render(),this.props.deltaTime=0}l&&this.pause()}else console.error("[canvas-sketch] WARN: Animation in Node.js is not yet supported")},G.prototype.dispatch=function(e){if("function"!==typeof e)throw new Error("must pass function into dispatch()");e(this.props),this.render()},G.prototype.mount=function(){this._appendCanvasIfNeeded()},G.prototype.unmount=function(){p()&&(window.removeEventListener("resize",this._resizeHandler),this._keyboardShortcuts.detach()),this.props.canvas.parentElement&&this.props.canvas.parentElement.removeChild(this.props.canvas)},G.prototype._appendCanvasIfNeeded=function(){p()&&!1!==this.settings.parent&&this.props.canvas&&!this.props.canvas.parentElement&&(this.settings.parent||document.body).appendChild(this.props.canvas)},G.prototype._setupGLKey=function(){var e;this.props.context&&("function"===typeof(e=this.props.context).clear&&"function"===typeof e.clearColor&&"function"===typeof e.bufferData?this._props.gl=this.props.context:delete this._props.gl)},G.prototype.getTimeProps=function(e){void 0===e&&(e={});var t=e.duration,n=e.totalFrames,r=f(e.timeScale,1),i=f(e.fps,24),a="number"===typeof t&&isFinite(t),o="number"===typeof n&&isFinite(n),s=a?Math.floor(i*t):void 0,c=o?n/i:void 0;if(a&&o&&s!==n)throw new Error("You should specify either duration or totalFrames, but not both. Or, they must match exactly.");"undefined"===typeof e.dimensions&&"undefined"!==typeof e.units&&console.warn("You've specified a { units } setting but no { dimension }, so the units will be ignored."),n=f(n,s,1/0),t=f(t,c,1/0);var u=e.time,l=e.frame,h="number"===typeof u&&isFinite(u),p="number"===typeof l&&isFinite(l),d=0,m=0,v=0;if(h&&p)throw new Error("You should specify either start frame or time, but not both.");return h?(d=u,v=this._computePlayhead(d,t),m=this._computeFrame(v,d,n,i)):p&&(d=(m=l)/i,v=this._computePlayhead(d,t)),{playhead:v,time:d,frame:m,duration:t,totalFrames:n,fps:i,timeScale:r}},G.prototype.setup=function(e){var t=this;if(void 0===e&&(e={}),this.sketch)throw new Error("Multiple setup() calls not yet supported.");this._settings=Object.assign({},e,this._settings),C(this._settings);var n=H(this._settings),r=n.context,i=n.canvas,a=this.getTimeProps(this._settings);this._props=Object.assign({},a,{canvas:i,context:r,deltaTime:0,started:!1,exporting:!1,playing:!1,recording:!1,settings:this.settings,data:this.settings.data,render:function(){return t.render()},togglePlay:function(){return t.togglePlay()},dispatch:function(e){return t.dispatch(e)},tick:function(){return t.tick()},resize:function(){return t.resize()},update:function(e){return t.update(e)},exportFrame:function(e){return t.exportFrame(e)},record:function(){return t.record()},play:function(){return t.play()},pause:function(){return t.pause()},stop:function(){return t.stop()}}),this._setupGLKey(),this.resize()},G.prototype.loadAndRun=function(e,t){var n=this;return this.load(e,t).then((function(){return n.run(),n}))},G.prototype.unload=function(){var e=this;this.pause(),this.sketch&&("function"===typeof this.sketch.unload&&this._wrapContextScale((function(t){return e.sketch.unload(t)})),this._sketch=null)},G.prototype.destroy=function(){this.unload(),this.unmount()},G.prototype.load=function(e,t){var n=this;if("function"!==typeof e)throw new Error("The function must take in a function as the first parameter. Example:\n  canvasSketcher(() => { ... }, settings)");this.sketch&&this.unload(),"undefined"!==typeof t&&this.update(t),this._preRender();var r=Promise.resolve();if(this.settings.p5){if(!p())throw new Error("[canvas-sketch] ERROR: Using p5.js in Node.js is not supported");r=new Promise((function(e){var t,r=n.settings.p5;r.p5&&(t=r.preload,r=r.p5);var i=function(r){t&&(r.preload=function(){return t(r)}),r.setup=function(){var t=n.props,i="webgl"===n.settings.context,a=i?r.WEBGL:r.P2D;r.noLoop(),r.pixelDensity(t.pixelRatio),r.createCanvas(t.viewportWidth,t.viewportHeight,a),i&&n.settings.attributes&&r.setAttributes(n.settings.attributes),n.update({p5:r,canvas:r.canvas,context:r._renderer.drawingContext}),e()}};if("function"===typeof r)new r(i);else{if("function"!==typeof window.createCanvas)throw new Error("{ p5 } setting is passed but can't find p5.js in global (window) scope. Maybe you did not create it globally?\nnew p5(); // <-- attaches to global scope");i(window)}}))}return r.then((function(){var t=e(n.props);return u(t)||(t=Promise.resolve(t)),t})).then((function(e){return e||(e={}),n._sketch=e,p()&&(n._keyboardShortcuts.attach(),window.addEventListener("resize",n._resizeHandler)),n._postRender(),n._sizeChanged(),n})).catch((function(e){throw console.warn("Could not start sketch, the async loading function rejected with an error:\n    Error: "+e.message),e}))},Object.defineProperties(G.prototype,j);var V="hot-id-cache",W=[];function q(e,t){if(void 0===t&&(t={}),t.p5){if(t.canvas||t.context&&"string"!==typeof t.context)throw new Error('In { p5 } mode, you can\'t pass your own canvas or context, unless the context is a "webgl" or "2d" string');var n="string"===typeof t.context&&t.context;t=Object.assign({},t,{canvas:!1,context:n})}var r,i=function(){var e=h();return e&&e.hot}();i&&(r=f(t.id,"$__DEFAULT_CANVAS_SKETCH_ID__$"));var a=i&&"string"===typeof r;a&&W.includes(r)&&(console.warn("Warning: You have multiple calls to canvasSketch() in --hot mode. You must pass unique { id } strings in settings to enable hot reload across multiple sketches. ",r),a=!1);var o=Promise.resolve();if(a){W.push(r);var s=function(e){var t=h();if(t)return t[V]=t[V]||{},t[V][e]}(r);if(s){var c=function(){var e,n=(e=s.manager,t.animate?{time:e.props.time}:void 0);return s.manager.destroy(),n};o=s.load.then(c).catch(c)}}return o.then((function(n){var i,o=new G;return e?(t=Object.assign({},t,n),o.setup(t),o.mount(),i=o.loadAndRun(e)):i=Promise.resolve(o),a&&function(e,t){var n=h();n&&(n[V]=n[V]||{},n[V][e]=t)}(r,{load:i,manager:o}),i}))}return q.canvasSketch=q,q.PaperSizes=O,q},e.exports=n()}).call(this,n(1))},function(e,t,n){"use strict";t.a="precision highp float;\n#define GLSLIFY 1\n\nuniform vec2 iResolution;\nuniform float iTime;\nuniform float pSize;\n\nuniform mat3 uvTransform;\n\n#define BLACK_COL vec3(24,32,38)/255.\n#define WHITE_COL vec3(245,248,250)/255.\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord )\n{\n  vec2 uv = (fragCoord.xy - iResolution.xy * 0.5) / iResolution.y;\n\n  vec2 st = vec2(atan(uv.x, uv.y), length(uv));\n\n  st.x += iTime*.1 + floor(st.y * 5. - iTime*1.)*0.3925;\n\n  float g = st.x * 3.82 * 2.;\n  float b1 = fract(g);\n  float b2 = sin(st.y*100. - iTime * 10.) * .25 + .5;\n\n  float gf = floor(mod(g, 2.)) * .6;\n  float m = step(.125 - st.y*.25 * gf, abs(b2 - b1) );\n\n  m = (1.-m) * abs(1. - gf + .1);\n\n  vec3 col = mix(BLACK_COL, WHITE_COL, m);\n\n  fragColor = vec4(col, 1.0);\n}\n\nvarying vec2 vUv;\n\nvoid main() {\n  mainImage(gl_FragColor, vUv * iResolution.xy);\n}\n"},function(e,t,n){"use strict";t.a="precision highp float;\n#define GLSLIFY 1\n\nuniform vec2 iResolution;\nuniform float iTime;\nuniform float pSize;\n\nuniform mat3 uvTransform;\n\nvoid mainImage(out vec4 fragColor, in vec2 fragCoord)\n{\n  vec2 uv = (fragCoord - 0.5 * iResolution.xy) / iResolution.y;\n  vec2 st = vec2(atan(uv.x, uv.y), length(uv));\n  uv = vec2(st.x / 6.2831 + iTime * 2.0 - st.y * 5.0, st.y);\n  float smf = .1;\n  float m = fract(uv.x);\n  float mask = smoothstep(0., smf, abs(m-.5)-.25);\n  vec3 col = vec3(0.88, 0, 0.52) * mask;\n  fragColor = vec4(col, 1.0);\n}\n\nvarying vec2 vUv;\n\nvoid main() {\n  mainImage(gl_FragColor, vUv * iResolution.xy);\n}\n"},function(e,t,n){"use strict";t.a="precision highp float;\n#define GLSLIFY 1\n\nvarying vec3 vpos;\nvarying float hp;\nvarying float hp2;\nvarying float hp3;\n\nuniform vec2 iResolution;\nuniform float iTime;\nuniform float pSize;\n\nuniform mat3 uvTransform;\n\n#define hue(h) clamp( abs( fract(h + vec4(3,2,1,0)/3.) * 6. - 3.) -1. , 0., 1.)\n\nvoid mainImage( out vec4 fragColor, in vec2 fragCoord){\n  vec2 uv = (uvTransform * vec3(gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1)).xy - .5;\n\n  float t = iTime*.5 + hp; // \u0414\u0435\u043b\u0430\u0435\u043c \u0432\u0440\u0435\u043c\u044f \u0434\u043b\u044f \u0442\u043e\u0447\u043a\u0438 \u0442\u0430\u043a\u043e\u0435 \u0436\u0435 \u043a\u0430\u043a \u0432 vertexShader\n\n  float l = length(uv);\n  float g = l * pSize/2.;\n  float gx = clamp(.05 / smoothstep(.0, pSize, g), 0., 1.0);\n  float lim = smoothstep(.5, .3, l);\n\n  // \u041f\u0440\u043e\u0437\u0440\u0430\u0447\u043d\u043e\u0441\u0442\u044c \u0441\u0447\u0438\u0442\u0430\u0435\u043c \u043e\u0442 hp3 \u0447\u0442\u043e\u0431 \u0432\u0441\u0435 \u0442\u043e\u0447\u043a\u0438 \u0431\u044b\u043b\u0438 \u0441 \u0440\u0430\u0437\u043d\u043e\u0439 \u044f\u0440\u043a\u043e\u0441\u0442\u044c\u044e\n  fragColor = vec4(hue(hp3*.75 + iTime*hp2).rgb, hp3/(pSize*.25)*gx / g * lim);\n}\n\nvarying vec2 vUv;\n\nvoid main() {\n  mainImage(gl_FragColor, vUv * iResolution.xy);\n}\n"},function(e,t,n){"use strict";t.a='#define GLSLIFY 1\n//\n// Description : Array and textureless GLSL 2D/3D/4D simplex\n//               noise functions.\n//      Author : Ian McEwan, Ashima Arts.\n//  Maintainer : ijm\n//     Lastmod : 20110822 (ijm)\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\n//               Distributed under the MIT License. See LICENSE file.\n//               https://github.com/ashima/webgl-noise\n//\n\nvec3 mod289(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 mod289(vec4 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 permute(vec4 x) {\n     return mod289(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt(vec4 r)\n{\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nfloat snoise(vec3 v)\n  {\n  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\n// First corner\n  vec3 i  = floor(v + dot(v, C.yyy) );\n  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\n// Other corners\n  vec3 g = step(x0.yzx, x0.xyz);\n  vec3 l = 1.0 - g;\n  vec3 i1 = min( g.xyz, l.zxy );\n  vec3 i2 = max( g.xyz, l.zxy );\n\n  //   x0 = x0 - 0.0 + 0.0 * C.xxx;\n  //   x1 = x0 - i1  + 1.0 * C.xxx;\n  //   x2 = x0 - i2  + 2.0 * C.xxx;\n  //   x3 = x0 - 1.0 + 3.0 * C.xxx;\n  vec3 x1 = x0 - i1 + C.xxx;\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n  vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n\n// Permutations\n  i = mod289(i);\n  vec4 p = permute( permute( permute(\n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n// Gradients: 7x7 points over a square, mapped onto an octahedron.\n// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n  float n_ = 0.142857142857; // 1.0/7.0\n  vec3  ns = n_ * D.wyz - D.xzx;\n\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n\n  vec4 x_ = floor(j * ns.z);\n  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\n  vec4 x = x_ *ns.x + ns.yyyy;\n  vec4 y = y_ *ns.x + ns.yyyy;\n  vec4 h = 1.0 - abs(x) - abs(y);\n\n  vec4 b0 = vec4( x.xy, y.xy );\n  vec4 b1 = vec4( x.zw, y.zw );\n\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\n  vec4 s0 = floor(b0)*2.0 + 1.0;\n  vec4 s1 = floor(b1)*2.0 + 1.0;\n  vec4 sh = -step(h, vec4(0.0));\n\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\n  vec3 p0 = vec3(a0.xy,h.x);\n  vec3 p1 = vec3(a0.zw,h.y);\n  vec3 p2 = vec3(a1.xy,h.z);\n  vec3 p3 = vec3(a1.zw,h.w);\n\n//Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n\n// Mix final noise value\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n  m = m * m;\n  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\n                                dot(p2,x2), dot(p3,x3) ) );\n  }\n\nvarying vec2 vUv;\nvarying vec3 vpos;\nvarying float hp;\nvarying float hp2;\nvarying float hp3;\n\nuniform float iTime;\nuniform float pSize;\nuniform vec3 camPosition;\n\nfloat hash(vec3 p)// replace this by something better\n{\n  p  = fract(p*0.3183099+.1);\n  p *= 17.0;\n  return fract(p.x*p.y*p.z*(p.x+p.y+p.z));\n}\n\nvoid main() {\n  vUv = uv;\n\n  hp = hash(position); // \u0420\u0430\u043d\u0434\u043e\u043c\u043d\u044b\u0439 \u0444\u0430\u043a\u0442\u043e\u0440 \u0434\u043b\u044f \u0442\u043e\u0447\u043a\u0438 \u043f\u043e \u043f\u043e\u0437\u0438\u0446\u0438\u0438\n  hp2 = hash(position*3.3); // \u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u0440\u0430\u043d\u0434\u043e\u043c\u043d\u044b\u0439 \u0444\u0430\u043a\u0442\u043e\u0440\n  hp3 = hash(position*6.6); // \u0415\u0449\u0435 \u043e\u0434\u0438\u043d \u0440\u0430\u043d\u0434\u043e\u043c\u043d\u044b\u0439 \u0444\u0430\u043a\u0442\u043e\u0440\n\n  float t = iTime*.5 + hp; // \u0417\u0430\u043c\u0435\u0434\u043b\u044f\u0435\u043c \u0432\u0440\u0435\u043c\u044f \u0438 \u043f\u0440\u0438\u0431\u0430\u0432\u043b\u044f\u0435\u043c \u0440\u0430\u043d\u0434\u043e\u043c\u043d\u044b\u0439 \u0444\u0430\u043a\u0442\u043e\u0440 - \u0443 \u044d\u0442\u043e\u0439 \u0442\u043e\u0447\u043a\u0438 \u0431\u0443\u0434\u0435\u0442 "\u0441\u0432\u043e\u0451" \u0432\u0440\u0435\u043c\u044f\n\n  vpos = position;\n\n  // \u0438\u043d\u0434\u0438\u0432\u0438\u0434\u0443\u043b\u044c\u043d\u044b\u0439 \u0440\u0430\u043d\u0434\u043e\u043c\u043d\u0435\u044b\u0439 vec3 \u0434\u043b\u044f \u0442\u043e\u0447\u043a\u0438 \u0434\u043b\u044f \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0438\u044f \u0434\u0432\u0438\u0436\u0435\u043d\u0438\u044f \u0442\u043e\u0447\u043a\u0438\n  vec3 npp = vec3(hash(position), hash(position*10.), hash(position*20.))*2.;\n\n  // \u0424\u0430\u043a\u0442\u043e\u0440 \u0441\u043c\u0435\u0449\u0435\u043d\u0438\u044f \u0447\u0435\u0440\u0435\u0437 \u0441\u0438\u043c\u043f\u043b\u0435\u043a\u0441\u043d\u044b\u0439 \u0448\u0443\u043c\n  float nF = snoise((npp + vec3(iTime*.525)) * 1.) * (.25 + fract(t))*.5;\n\n  // \u0414\u0438\u0432\u0433\u0430\u0435\u043c \u0442\u043e\u0447\u043a\u0438\n  vpos.y -= (vpos.y * fract(t)*2. );\n\n  // \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c \u0444\u0430\u043a\u0442\u043e\u0440 \u043f\u043b\u0430\u0432\u0430\u044e\u0449\u0435\u0433\u043e \u0441\u043c\u0435\u0449\u0435\u043d\u0438\u044f\n  vpos.xyz += nF*2.;\n\n  gl_PointSize = pSize*35. / length(camPosition - vpos);\n\n  gl_Position = projectionMatrix * modelViewMatrix * vec4( vpos, 1.0 );\n}\n'},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(c){i=!0,a=c}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},i=2*Math.PI,a=function(e,t,n,r,i,a,o){var s=e.x,c=e.y;return{x:r*(s*=t)-i*(c*=n)+a,y:i*s+r*c+o}},o=function(e,t){var n=1.5707963267948966===t?.551915024494:-1.5707963267948966===t?-.551915024494:4/3*Math.tan(t/4),r=Math.cos(e),i=Math.sin(e),a=Math.cos(e+t),o=Math.sin(e+t);return[{x:r-i*n,y:i+r*n},{x:a+o*n,y:o-a*n},{x:a,y:o}]},s=function(e,t,n,r){var i=e*n+t*r;return i>1&&(i=1),i<-1&&(i=-1),(e*r-t*n<0?-1:1)*Math.acos(i)};t.default=function(e){var t=e.px,n=e.py,c=e.cx,u=e.cy,l=e.rx,h=e.ry,f=e.xAxisRotation,p=void 0===f?0:f,d=e.largeArcFlag,m=void 0===d?0:d,v=e.sweepFlag,g=void 0===v?0:v,y=[];if(0===l||0===h)return[];var x=Math.sin(p*i/360),b=Math.cos(p*i/360),w=b*(t-c)/2+x*(n-u)/2,_=-x*(t-c)/2+b*(n-u)/2;if(0===w&&0===_)return[];l=Math.abs(l),h=Math.abs(h);var M=Math.pow(w,2)/Math.pow(l,2)+Math.pow(_,2)/Math.pow(h,2);M>1&&(l*=Math.sqrt(M),h*=Math.sqrt(M));var E=function(e,t,n,r,a,o,c,u,l,h,f,p){var d=Math.pow(a,2),m=Math.pow(o,2),v=Math.pow(f,2),g=Math.pow(p,2),y=d*m-d*g-m*v;y<0&&(y=0),y/=d*g+m*v;var x=(y=Math.sqrt(y)*(c===u?-1:1))*a/o*p,b=y*-o/a*f,w=h*x-l*b+(e+n)/2,_=l*x+h*b+(t+r)/2,M=(f-x)/a,E=(p-b)/o,T=(-f-x)/a,S=(-p-b)/o,A=s(1,0,M,E),L=s(M,E,T,S);return 0===u&&L>0&&(L-=i),1===u&&L<0&&(L+=i),[w,_,A,L]}(t,n,c,u,l,h,m,g,x,b,w,_),T=r(E,4),S=T[0],A=T[1],L=T[2],R=T[3],P=Math.abs(R)/(i/4);Math.abs(1-P)<1e-7&&(P=1);var C=Math.max(Math.ceil(P),1);R/=C;for(var O=0;O<C;O++)y.push(o(L,R)),L+=R;return y.map((function(e){var t=a(e[0],l,h,b,x,S,A),n=t.x,r=t.y,i=a(e[1],l,h,b,x,S,A),o=i.x,s=i.y,c=a(e[2],l,h,b,x,S,A);return{x1:n,y1:r,x2:o,y2:s,x:c.x,y:c.y}}))},e.exports=t.default},function(e,t,n){"use strict";n.r(t);n(21)},function(e,t,n){"use strict";(function(e){var t=n(13),r=n.n(t),i=n(14),a=n.n(i),o=n(15),s=n(16),c=n(4),u=n(17),l=n(18);function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){r()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var p=n(22),d=n(23).random;e.THREE=p,n(59);var m=d.createRandom();m.setSeed("415761");var v={canvas:document.querySelector("#canvas"),context:"webgl",animate:!0};(new p.ShadowMaterial).opacity=.9182;a()((function(e){var t=e.context,n=e.canvas,r=!1,i=document.createElement("div");i.innerHTML="<span>Click to let it snow!</span>",i.style.cssText="position: absolute; font-size: 100px; font-weight: bold; cursor:pointer; font-family: cursive; height: 100%; width:100%; display: flex;justify-content: center; align-items: center;",n.parentNode.appendChild(i),n.parentNode.addEventListener("mousedown",(function(){r||(n.parentNode.removeChild(i),r=!0,new Audio("assets/songs/Let_It_Snow_(Trap_Remix).mp3").play())}));var a=new p.WebGLRenderer({canvas:t.canvas});a.setClearColor("hsl(200, 90%, 10%)",1),a.shadowMap.enabled=!0,a.shadowMap.type=p.PCFSoftShadowMap;var h=new p.PerspectiveCamera(25,2,.01,100);h.position.set(10,5,5);var d=new p.OrbitControls(h,t.canvas);d.minDistance=3,d.maxDistance=40,d.target.set(0,2,0);var v=new p.Scene,g=new p.HemisphereLight(16777215,16777215,.42);v.add(g);var y=new p.SpotLight(16777215,.98251,30,Math.PI/4,2,2);y.position.set(5,7,5),y.castShadow=!0,v.add(y),[y].forEach((function(e){e.shadow.mapSize.width=1024,e.shadow.mapSize.height=1024,e.shadow.camera.near=.15,e.shadow.camera.far=500,e.shadow.bias=1e-4;e.shadow.camera.top=15,e.shadow.camera.bottom=-15,e.shadow.camera.left=15,e.shadow.camera.right=-15}));var x=new p.ShaderMaterial({uniforms:{iTime:{value:0},iResolution:new p.Uniform(new p.Vector2(2e3,2e3))},fragmentShader:o.a,vertexShader:c.a}),b=new p.ShaderMaterial({uniforms:{iTime:{value:0},iResolution:new p.Uniform(new p.Vector2(100,100))},fragmentShader:s.a,vertexShader:c.a,side:p.DoubleSide}),w=function(){var e=f(f({},p.ShaderLib.points.uniforms),{},{iTime:{value:0},pSize:{value:10},camPosition:new p.Uniform(new p.Vector3)});return new p.ShaderMaterial({uniforms:e,transparent:!0,depthWrite:!1,blending:p.AdditiveBlending,fragmentShader:u.a,vertexShader:l.a})}(),_=new p.MeshLambertMaterial({color:3162189}),M=new p.MeshLambertMaterial({color:16739914}),E=new p.PlaneGeometry(200,200,100,100),T=new p.Mesh(E,x);T.rotation.x=.5*-Math.PI,v.add(T);var S=new p.Mesh(E,new p.ShadowMaterial({opacity:.5}));S.rotation.x=.5*-Math.PI,S.rotation.y=.01,S.receiveShadow=!0,S.castShadow=!0,v.add(S);for(var A=[],L=function(){var e=new p.MeshLambertMaterial({color:13689840});return e.emissive.setHex(16777215),e.emissiveIntensity=.2,e}(),R=0;R<3;R+=1){var P=1-.22*R,C=new p.DodecahedronGeometry(P,3);C.vertices.forEach((function(e){e.x+=m.range(-.01,.01),e.y+=m.range(-.01,.01),e.z+=m.range(-.01,.01)}));var O=new p.Mesh(C,L);O.castShadow=!0,O.receiveShadow=!0,O.radius=P,O.position.y+=.75+1.1*R,v.add(O),A.push(O)}for(var D=function(e){var t=new p.DodecahedronGeometry(.075,1);t.vertices.forEach((function(e){e.x+=m.range(-.00375,.00375),e.y+=m.range(-.00375,.00375),e.z+=m.range(-.00375,.00375)}));var n=new p.Mesh(t,_);n.castShadow=!0;var r=1.025*A[1].radius;n.position.x=r*Math.cos(Math.PI/4-e*(Math.PI/7)-.1),n.position.y=r*Math.sin(Math.PI/4-e*(Math.PI/7)-.1)+A[1].position.y,v.add(n)},I=0;I<3;I+=1)D(I);for(var N=.825*A[2].radius,z=function(e){var t=new p.DodecahedronGeometry(.075,1);t.vertices.forEach((function(e){e.x+=m.range(-.00375,.00375),e.y+=m.range(-.00375,.00375),e.z+=m.range(-.00375,.00375)}));var n=new p.Mesh(t,x);n.castShadow=!0,n.position.x=N*Math.cos(Math.PI/4-.25),n.position.y=N*Math.sin(Math.PI/4-.25)+A[2].position.y,n.position.x=N*Math.cos(.325*e),n.position.z=N*Math.sin(.325*e),v.add(n);var r=new p.CircleGeometry(.075*1.5,20),i=new p.Mesh(r,b);i.rotateY(Math.PI/2),i.castShadow=!0,i.position.copy(n.position),i.position.x+=.09,i.rotateX(-Math.PI/10),v.add(i)},k=-1;k<=1;k+=2)z(k);var F=new p.CylinderGeometry(.01,.01,.1,16,10),B=new p.Mesh(F,_);B.castShadow=!0,B.position.x=N*Math.cos(Math.PI/4-.25)+.125,B.position.y=N*Math.sin(Math.PI/4-.25)+A[2].position.y,B.rotateX(Math.PI/2),v.add(B);var U=new p.CylinderGeometry(0,.06375,.51,16,10);U.vertices.forEach((function(e){e.x+=m.range(-.00765,.00765),e.y+=m.range(-.00765,.00765),e.z+=m.range(-.00765,.00765)}));var H=new p.Mesh(U,M);H.castShadow=!0,H.position.y=A[2].position.y,H.position.x=.95*A[2].radius+.255,H.rotateZ(-Math.PI/2),v.add(H);var G=new p.MeshLambertMaterial({color:16737877}),j=new p.CylinderGeometry(.01785,.01785,.51,16,10);j.vertices.forEach((function(e){e.x-=e.y*e.y*1.5,e.z+=e.y*e.y*.25-e.x*e.x*5.25}));var V=new p.Mesh(j,G);V.castShadow=!0,V.position.y=A[2].position.y-.35*A[2].radius,V.position.x=.95*A[2].radius,V.rotateZ(-Math.PI/2),V.rotateX(-Math.PI/2),v.add(V);for(var W=-1;W<=1;W+=2){var q=new p.CylinderGeometry(.0159375,.0159375,.125,16,10),Y=new p.Mesh(q,G);Y.castShadow=!0,Y.position.y=A[2].position.y-.35*A[2].radius+.08925,Y.position.x=.95*A[2].radius-.03825,Y.position.z=.255*W,Y.rotateZ(-Math.PI/12),Y.rotateX(-Math.PI/10*W),v.add(Y)}var X=new p.MeshPhongMaterial({color:16075147}),Z=A[2].radius,J=new p.CylinderGeometry(.55*Z,.5*Z,Z,16,10);J.vertices.forEach((function(e){var t=.025*Z;e.y>-Z/2?(e.x+=m.range(-t,t),e.y+=m.range(-t,t),e.z+=m.range(-t,t)):(e.x*=2,e.z*=2,e.y+=m.range(2*-t,2*t))})),J.center();var Q=new p.Mesh(J,X);Q.castShadow=!0,Q.position.y=A[2].position.y+Z/2+.8*A[2].radius,Q.rotateX(-Math.PI/11),Q.rotateZ(Math.PI/15),Q.position.z-=.15,Q.position.x-=.1,v.add(Q);var K=[];!function(){for(var e=new p.MeshLambertMaterial({color:13397578}),t=-1;t<=1;t+=2){var n=new p.CylinderGeometry(.02,.075,.8,16,10);n.vertices.forEach((function(e){var t=.1*e.y;e.y+=.4+m.range(-t,t),e.x+=.02*Math.sin(10*e.y)+m.range(-t,t),e.z+=.02*Math.cos(10*e.y)+m.range(-t,t)}));var r=new p.Mesh(n,e);r.castShadow=!0,r.position.y=1.2*A[1].position.y,r.position.z=.8*A[1].radius*t,r.rotateX(-Math.PI/4+Math.PI/3*t),r.rotateX(Math.PI/4),r.originalRotationX=r.rotation.x,r.idx=t,K.push(r),v.add(r)}}();var $=new p.Geometry(40,40,50,50);$.vertices=$.vertices.map((function(e){return e.x+=.05*(m.value()-.5),e.y+=4*(m.value()-.5)+6,e.z+=.05*(m.value()-.5),e}));for(var ee=0;ee<5e4;ee+=1)$.vertices.push(new p.Vector3(40*(m.value()-.5),4*(m.value()-.5)+6,40*(m.value()-.5)));var te=new p.Points($,w);return te.position.y+=4,te.sortParticles=!0,v.add(te),{resize:function(e){var t=e.pixelRatio,n=e.viewportWidth,r=e.viewportHeight;a.setPixelRatio(t),a.setSize(n,r,!1),h.aspect=n/r,h.updateProjectionMatrix()},render:function(e){var t=e.time;r&&(K.forEach((function(e){e.rotation.x=e.originalRotationX+.3*Math.sin(7*t)})),x.uniforms.iTime.value=t,b.uniforms.iTime.value=t,w.uniforms.iTime.value=.2*t,w.uniforms.camPosition=new p.Uniform(h.position),h.position.y=Math.max(h.position.y,.1),d.update(),a.render(v,h))},unload:function(){d.dispose(),a.dispose(),scPlayer.stop()}}}),v)}).call(this,n(1))},function(e,t,n){"use strict";n.r(t),n.d(t,"ACESFilmicToneMapping",(function(){return ce})),n.d(t,"AddEquation",(function(){return P})),n.d(t,"AddOperation",(function(){return ne})),n.d(t,"AdditiveBlending",(function(){return S})),n.d(t,"AlphaFormat",(function(){return Ge})),n.d(t,"AlwaysDepth",(function(){return Y})),n.d(t,"AlwaysStencilFunc",(function(){return hn})),n.d(t,"AmbientLight",(function(){return Ql})),n.d(t,"AmbientLightProbe",(function(){return bh})),n.d(t,"AnimationClip",(function(){return il})),n.d(t,"AnimationLoader",(function(){return fl})),n.d(t,"AnimationMixer",(function(){return Jh})),n.d(t,"AnimationObjectGroup",(function(){return Xh})),n.d(t,"AnimationUtils",(function(){return Wu})),n.d(t,"ArcCurve",(function(){return bl})),n.d(t,"ArrayCamera",(function(){return ms})),n.d(t,"ArrowHelper",(function(){return Bf})),n.d(t,"Audio",(function(){return Ph})),n.d(t,"AudioAnalyser",(function(){return zh})),n.d(t,"AudioContext",(function(){return mh})),n.d(t,"AudioListener",(function(){return Rh})),n.d(t,"AudioLoader",(function(){return vh})),n.d(t,"AxesHelper",(function(){return Uf})),n.d(t,"AxisHelper",(function(){return Gp})),n.d(t,"BackSide",(function(){return g})),n.d(t,"BasicDepthPacking",(function(){return Wt})),n.d(t,"BasicShadowMap",(function(){return f})),n.d(t,"BinaryTextureLoader",(function(){return Yp})),n.d(t,"Bone",(function(){return Ys})),n.d(t,"BooleanKeyframeTrack",(function(){return Qu})),n.d(t,"BoundingBoxHelper",(function(){return jp})),n.d(t,"Box2",(function(){return of})),n.d(t,"Box3",(function(){return Er})),n.d(t,"Box3Helper",(function(){return If})),n.d(t,"BoxBufferGeometry",(function(){return ta})),n.d(t,"BoxGeometry",(function(){return ea})),n.d(t,"BoxHelper",(function(){return Df})),n.d(t,"BufferAttribute",(function(){return ui})),n.d(t,"BufferGeometry",(function(){return Li})),n.d(t,"BufferGeometryLoader",(function(){return rh})),n.d(t,"ByteType",(function(){return Ce})),n.d(t,"Cache",(function(){return ol})),n.d(t,"Camera",(function(){return oa})),n.d(t,"CameraHelper",(function(){return Pf})),n.d(t,"CanvasRenderer",(function(){return Jp})),n.d(t,"CanvasTexture",(function(){return xc})),n.d(t,"CatmullRomCurve3",(function(){return Sl})),n.d(t,"CineonToneMapping",(function(){return se})),n.d(t,"CircleBufferGeometry",(function(){return Ou})),n.d(t,"CircleGeometry",(function(){return Cu})),n.d(t,"ClampToEdgeWrapping",(function(){return ye})),n.d(t,"Clock",(function(){return Eh})),n.d(t,"ClosedSplineCurve3",(function(){return Bp})),n.d(t,"Color",(function(){return ei})),n.d(t,"ColorKeyframeTrack",(function(){return Ku})),n.d(t,"CompressedTexture",(function(){return yc})),n.d(t,"CompressedTextureLoader",(function(){return pl})),n.d(t,"ConeBufferGeometry",(function(){return Pu})),n.d(t,"ConeGeometry",(function(){return Ru})),n.d(t,"CubeCamera",(function(){return ca})),n.d(t,"CubeGeometry",(function(){return ea})),n.d(t,"CubeReflectionMapping",(function(){return le})),n.d(t,"CubeRefractionMapping",(function(){return he})),n.d(t,"CubeTexture",(function(){return Oa})),n.d(t,"CubeTextureLoader",(function(){return vl})),n.d(t,"CubeUVReflectionMapping",(function(){return me})),n.d(t,"CubeUVRefractionMapping",(function(){return ve})),n.d(t,"CubicBezierCurve",(function(){return Pl})),n.d(t,"CubicBezierCurve3",(function(){return Cl})),n.d(t,"CubicInterpolant",(function(){return Yu})),n.d(t,"CullFaceBack",(function(){return s})),n.d(t,"CullFaceFront",(function(){return c})),n.d(t,"CullFaceFrontBack",(function(){return u})),n.d(t,"CullFaceNone",(function(){return o})),n.d(t,"Curve",(function(){return yl})),n.d(t,"CurvePath",(function(){return Fl})),n.d(t,"CustomBlending",(function(){return R})),n.d(t,"CylinderBufferGeometry",(function(){return Lu})),n.d(t,"CylinderGeometry",(function(){return Au})),n.d(t,"Cylindrical",(function(){return rf})),n.d(t,"DataTexture",(function(){return la})),n.d(t,"DataTexture2DArray",(function(){return Da})),n.d(t,"DataTexture3D",(function(){return Ia})),n.d(t,"DataTextureLoader",(function(){return dl})),n.d(t,"DecrementStencilOp",(function(){return $t})),n.d(t,"DecrementWrapStencilOp",(function(){return tn})),n.d(t,"DefaultLoadingManager",(function(){return cl})),n.d(t,"DepthFormat",(function(){return Xe})),n.d(t,"DepthStencilFormat",(function(){return Ze})),n.d(t,"DepthTexture",(function(){return bc})),n.d(t,"DirectionalLight",(function(){return Jl})),n.d(t,"DirectionalLightHelper",(function(){return Af})),n.d(t,"DirectionalLightShadow",(function(){return Zl})),n.d(t,"DiscreteInterpolant",(function(){return Zu})),n.d(t,"DodecahedronBufferGeometry",(function(){return Dc})),n.d(t,"DodecahedronGeometry",(function(){return Oc})),n.d(t,"DoubleSide",(function(){return y})),n.d(t,"DstAlphaFactor",(function(){return H})),n.d(t,"DstColorFactor",(function(){return j})),n.d(t,"DynamicBufferAttribute",(function(){return Rp})),n.d(t,"DynamicCopyUsage",(function(){return xn})),n.d(t,"DynamicDrawUsage",(function(){return pn})),n.d(t,"DynamicReadUsage",(function(){return vn})),n.d(t,"EdgesGeometry",(function(){return Su})),n.d(t,"EdgesHelper",(function(){return Vp})),n.d(t,"EllipseCurve",(function(){return xl})),n.d(t,"EqualDepth",(function(){return J})),n.d(t,"EqualStencilFunc",(function(){return on})),n.d(t,"EquirectangularReflectionMapping",(function(){return fe})),n.d(t,"EquirectangularRefractionMapping",(function(){return pe})),n.d(t,"Euler",(function(){return Xn})),n.d(t,"EventDispatcher",(function(){return wn})),n.d(t,"ExtrudeBufferGeometry",(function(){return fu})),n.d(t,"ExtrudeGeometry",(function(){return hu})),n.d(t,"Face3",(function(){return ii})),n.d(t,"Face4",(function(){return gp})),n.d(t,"FaceColors",(function(){return _})),n.d(t,"FileLoader",(function(){return hl})),n.d(t,"FlatShading",(function(){return x})),n.d(t,"Float32Attribute",(function(){return kp})),n.d(t,"Float32BufferAttribute",(function(){return gi})),n.d(t,"Float64Attribute",(function(){return Fp})),n.d(t,"Float64BufferAttribute",(function(){return yi})),n.d(t,"FloatType",(function(){return ze})),n.d(t,"Fog",(function(){return bs})),n.d(t,"FogExp2",(function(){return xs})),n.d(t,"Font",(function(){return fh})),n.d(t,"FontLoader",(function(){return dh})),n.d(t,"FrontFaceDirectionCCW",(function(){return h})),n.d(t,"FrontFaceDirectionCW",(function(){return l})),n.d(t,"FrontSide",(function(){return v})),n.d(t,"Frustum",(function(){return pa})),n.d(t,"GammaEncoding",(function(){return Bt})),n.d(t,"Geometry",(function(){return $i})),n.d(t,"GeometryUtils",(function(){return Zp})),n.d(t,"GreaterDepth",(function(){return K})),n.d(t,"GreaterEqualDepth",(function(){return Q})),n.d(t,"GreaterEqualStencilFunc",(function(){return ln})),n.d(t,"GreaterStencilFunc",(function(){return cn})),n.d(t,"GridHelper",(function(){return _f})),n.d(t,"Group",(function(){return vs})),n.d(t,"HalfFloatType",(function(){return ke})),n.d(t,"HemisphereLight",(function(){return Gl})),n.d(t,"HemisphereLightHelper",(function(){return wf})),n.d(t,"HemisphereLightProbe",(function(){return xh})),n.d(t,"IcosahedronBufferGeometry",(function(){return Cc})),n.d(t,"IcosahedronGeometry",(function(){return Pc})),n.d(t,"ImageBitmapLoader",(function(){return lh})),n.d(t,"ImageLoader",(function(){return ml})),n.d(t,"ImageUtils",(function(){return Ln})),n.d(t,"ImmediateRenderObject",(function(){return lf})),n.d(t,"IncrementStencilOp",(function(){return Kt})),n.d(t,"IncrementWrapStencilOp",(function(){return en})),n.d(t,"InstancedBufferAttribute",(function(){return nh})),n.d(t,"InstancedBufferGeometry",(function(){return th})),n.d(t,"InstancedInterleavedBuffer",(function(){return Kh})),n.d(t,"InstancedMesh",(function(){return Ks})),n.d(t,"Int16Attribute",(function(){return Dp})),n.d(t,"Int16BufferAttribute",(function(){return pi})),n.d(t,"Int32Attribute",(function(){return Np})),n.d(t,"Int32BufferAttribute",(function(){return mi})),n.d(t,"Int8Attribute",(function(){return Pp})),n.d(t,"Int8BufferAttribute",(function(){return li})),n.d(t,"IntType",(function(){return Ie})),n.d(t,"InterleavedBuffer",(function(){return ws})),n.d(t,"InterleavedBufferAttribute",(function(){return Es})),n.d(t,"Interpolant",(function(){return qu})),n.d(t,"InterpolateDiscrete",(function(){return Lt})),n.d(t,"InterpolateLinear",(function(){return Rt})),n.d(t,"InterpolateSmooth",(function(){return Pt})),n.d(t,"InvertStencilOp",(function(){return nn})),n.d(t,"JSONLoader",(function(){return Qp})),n.d(t,"KeepStencilOp",(function(){return Jt})),n.d(t,"KeyframeTrack",(function(){return Ju})),n.d(t,"LOD",(function(){return Gs})),n.d(t,"LatheBufferGeometry",(function(){return _u})),n.d(t,"LatheGeometry",(function(){return wu})),n.d(t,"Layers",(function(){return Zn})),n.d(t,"LensFlare",(function(){return $p})),n.d(t,"LessDepth",(function(){return X})),n.d(t,"LessEqualDepth",(function(){return Z})),n.d(t,"LessEqualStencilFunc",(function(){return sn})),n.d(t,"LessStencilFunc",(function(){return an})),n.d(t,"Light",(function(){return Hl})),n.d(t,"LightProbe",(function(){return yh})),n.d(t,"LightShadow",(function(){return jl})),n.d(t,"Line",(function(){return ac})),n.d(t,"Line3",(function(){return uf})),n.d(t,"LineBasicMaterial",(function(){return $s})),n.d(t,"LineCurve",(function(){return Ol})),n.d(t,"LineCurve3",(function(){return Dl})),n.d(t,"LineDashedMaterial",(function(){return ju})),n.d(t,"LineLoop",(function(){return uc})),n.d(t,"LinePieces",(function(){return xp})),n.d(t,"LineSegments",(function(){return cc})),n.d(t,"LineStrip",(function(){return yp})),n.d(t,"LinearEncoding",(function(){return kt})),n.d(t,"LinearFilter",(function(){return Te})),n.d(t,"LinearInterpolant",(function(){return Xu})),n.d(t,"LinearMipMapLinearFilter",(function(){return Re})),n.d(t,"LinearMipMapNearestFilter",(function(){return Ae})),n.d(t,"LinearMipmapLinearFilter",(function(){return Le})),n.d(t,"LinearMipmapNearestFilter",(function(){return Se})),n.d(t,"LinearToneMapping",(function(){return ie})),n.d(t,"Loader",(function(){return ul})),n.d(t,"LoaderUtils",(function(){return eh})),n.d(t,"LoadingManager",(function(){return sl})),n.d(t,"LogLuvEncoding",(function(){return Ht})),n.d(t,"LoopOnce",(function(){return Tt})),n.d(t,"LoopPingPong",(function(){return At})),n.d(t,"LoopRepeat",(function(){return St})),n.d(t,"LuminanceAlphaFormat",(function(){return qe})),n.d(t,"LuminanceFormat",(function(){return We})),n.d(t,"MOUSE",(function(){return i})),n.d(t,"Material",(function(){return oi})),n.d(t,"MaterialLoader",(function(){return $l})),n.d(t,"Math",(function(){return Tn})),n.d(t,"MathUtils",(function(){return Tn})),n.d(t,"Matrix3",(function(){return An})),n.d(t,"Matrix4",(function(){return Wn})),n.d(t,"MaxEquation",(function(){return I})),n.d(t,"Mesh",(function(){return qi})),n.d(t,"MeshBasicMaterial",(function(){return si})),n.d(t,"MeshDepthMaterial",(function(){return ss})),n.d(t,"MeshDistanceMaterial",(function(){return cs})),n.d(t,"MeshFaceMaterial",(function(){return bp})),n.d(t,"MeshLambertMaterial",(function(){return Hu})),n.d(t,"MeshMatcapMaterial",(function(){return Gu})),n.d(t,"MeshNormalMaterial",(function(){return Uu})),n.d(t,"MeshPhongMaterial",(function(){return Fu})),n.d(t,"MeshPhysicalMaterial",(function(){return ku})),n.d(t,"MeshStandardMaterial",(function(){return zu})),n.d(t,"MeshToonMaterial",(function(){return Bu})),n.d(t,"MinEquation",(function(){return D})),n.d(t,"MirroredRepeatWrapping",(function(){return xe})),n.d(t,"MixOperation",(function(){return te})),n.d(t,"MultiMaterial",(function(){return wp})),n.d(t,"MultiplyBlending",(function(){return L})),n.d(t,"MultiplyOperation",(function(){return ee})),n.d(t,"NearestFilter",(function(){return be})),n.d(t,"NearestMipMapLinearFilter",(function(){return Ee})),n.d(t,"NearestMipMapNearestFilter",(function(){return _e})),n.d(t,"NearestMipmapLinearFilter",(function(){return Me})),n.d(t,"NearestMipmapNearestFilter",(function(){return we})),n.d(t,"NeverDepth",(function(){return q})),n.d(t,"NeverStencilFunc",(function(){return rn})),n.d(t,"NoBlending",(function(){return E})),n.d(t,"NoColors",(function(){return w})),n.d(t,"NoToneMapping",(function(){return re})),n.d(t,"NormalBlending",(function(){return T})),n.d(t,"NotEqualDepth",(function(){return $})),n.d(t,"NotEqualStencilFunc",(function(){return un})),n.d(t,"NumberKeyframeTrack",(function(){return $u})),n.d(t,"Object3D",(function(){return ur})),n.d(t,"ObjectLoader",(function(){return ah})),n.d(t,"ObjectSpaceNormalMap",(function(){return Xt})),n.d(t,"OctahedronBufferGeometry",(function(){return Rc})),n.d(t,"OctahedronGeometry",(function(){return Lc})),n.d(t,"OneFactor",(function(){return z})),n.d(t,"OneMinusDstAlphaFactor",(function(){return G})),n.d(t,"OneMinusDstColorFactor",(function(){return V})),n.d(t,"OneMinusSrcAlphaFactor",(function(){return U})),n.d(t,"OneMinusSrcColorFactor",(function(){return F})),n.d(t,"OrthographicCamera",(function(){return Xl})),n.d(t,"PCFShadowMap",(function(){return p})),n.d(t,"PCFSoftShadowMap",(function(){return d})),n.d(t,"PMREMGenerator",(function(){return ip})),n.d(t,"ParametricBufferGeometry",(function(){return Mc})),n.d(t,"ParametricGeometry",(function(){return _c})),n.d(t,"Particle",(function(){return Mp})),n.d(t,"ParticleBasicMaterial",(function(){return Sp})),n.d(t,"ParticleSystem",(function(){return Ep})),n.d(t,"ParticleSystemMaterial",(function(){return Ap})),n.d(t,"Path",(function(){return Bl})),n.d(t,"PerspectiveCamera",(function(){return sa})),n.d(t,"Plane",(function(){return Br})),n.d(t,"PlaneBufferGeometry",(function(){return ya})),n.d(t,"PlaneGeometry",(function(){return ga})),n.d(t,"PlaneHelper",(function(){return Nf})),n.d(t,"PointCloud",(function(){return _p})),n.d(t,"PointCloudMaterial",(function(){return Tp})),n.d(t,"PointLight",(function(){return Yl})),n.d(t,"PointLightHelper",(function(){return gf})),n.d(t,"Points",(function(){return mc})),n.d(t,"PointsMaterial",(function(){return lc})),n.d(t,"PolarGridHelper",(function(){return Mf})),n.d(t,"PolyhedronBufferGeometry",(function(){return Tc})),n.d(t,"PolyhedronGeometry",(function(){return Ec})),n.d(t,"PositionalAudio",(function(){return Nh})),n.d(t,"PropertyBinding",(function(){return Yh})),n.d(t,"PropertyMixer",(function(){return kh})),n.d(t,"QuadraticBezierCurve",(function(){return Il})),n.d(t,"QuadraticBezierCurve3",(function(){return Nl})),n.d(t,"Quaternion",(function(){return In})),n.d(t,"QuaternionKeyframeTrack",(function(){return tl})),n.d(t,"QuaternionLinearInterpolant",(function(){return el})),n.d(t,"REVISION",(function(){return r})),n.d(t,"RGBADepthPacking",(function(){return qt})),n.d(t,"RGBAFormat",(function(){return Ve})),n.d(t,"RGBAIntegerFormat",(function(){return tt})),n.d(t,"RGBA_ASTC_10x10_Format",(function(){return _t})),n.d(t,"RGBA_ASTC_10x5_Format",(function(){return xt})),n.d(t,"RGBA_ASTC_10x6_Format",(function(){return bt})),n.d(t,"RGBA_ASTC_10x8_Format",(function(){return wt})),n.d(t,"RGBA_ASTC_12x10_Format",(function(){return Mt})),n.d(t,"RGBA_ASTC_12x12_Format",(function(){return Et})),n.d(t,"RGBA_ASTC_4x4_Format",(function(){return ht})),n.d(t,"RGBA_ASTC_5x4_Format",(function(){return ft})),n.d(t,"RGBA_ASTC_5x5_Format",(function(){return pt})),n.d(t,"RGBA_ASTC_6x5_Format",(function(){return dt})),n.d(t,"RGBA_ASTC_6x6_Format",(function(){return mt})),n.d(t,"RGBA_ASTC_8x5_Format",(function(){return vt})),n.d(t,"RGBA_ASTC_8x6_Format",(function(){return gt})),n.d(t,"RGBA_ASTC_8x8_Format",(function(){return yt})),n.d(t,"RGBA_PVRTC_2BPPV1_Format",(function(){return ut})),n.d(t,"RGBA_PVRTC_4BPPV1_Format",(function(){return ct})),n.d(t,"RGBA_S3TC_DXT1_Format",(function(){return rt})),n.d(t,"RGBA_S3TC_DXT3_Format",(function(){return it})),n.d(t,"RGBA_S3TC_DXT5_Format",(function(){return at})),n.d(t,"RGBDEncoding",(function(){return Vt})),n.d(t,"RGBEEncoding",(function(){return Ut})),n.d(t,"RGBEFormat",(function(){return Ye})),n.d(t,"RGBFormat",(function(){return je})),n.d(t,"RGBIntegerFormat",(function(){return et})),n.d(t,"RGBM16Encoding",(function(){return jt})),n.d(t,"RGBM7Encoding",(function(){return Gt})),n.d(t,"RGB_ETC1_Format",(function(){return lt})),n.d(t,"RGB_PVRTC_2BPPV1_Format",(function(){return st})),n.d(t,"RGB_PVRTC_4BPPV1_Format",(function(){return ot})),n.d(t,"RGB_S3TC_DXT1_Format",(function(){return nt})),n.d(t,"RGFormat",(function(){return Ke})),n.d(t,"RGIntegerFormat",(function(){return $e})),n.d(t,"RawShaderMaterial",(function(){return Nu})),n.d(t,"Ray",(function(){return Nr})),n.d(t,"Raycaster",(function(){return $h})),n.d(t,"RectAreaLight",(function(){return Kl})),n.d(t,"RedFormat",(function(){return Je})),n.d(t,"RedIntegerFormat",(function(){return Qe})),n.d(t,"ReinhardToneMapping",(function(){return ae})),n.d(t,"RepeatWrapping",(function(){return ge})),n.d(t,"ReplaceStencilOp",(function(){return Qt})),n.d(t,"ReverseSubtractEquation",(function(){return O})),n.d(t,"RingBufferGeometry",(function(){return bu})),n.d(t,"RingGeometry",(function(){return xu})),n.d(t,"Scene",(function(){return lr})),n.d(t,"SceneUtils",(function(){return Kp})),n.d(t,"ShaderChunk",(function(){return xa})),n.d(t,"ShaderLib",(function(){return ba})),n.d(t,"ShaderMaterial",(function(){return aa})),n.d(t,"ShadowMaterial",(function(){return Iu})),n.d(t,"Shape",(function(){return Ul})),n.d(t,"ShapeBufferGeometry",(function(){return Eu})),n.d(t,"ShapeGeometry",(function(){return Mu})),n.d(t,"ShapePath",(function(){return hh})),n.d(t,"ShapeUtils",(function(){return cu})),n.d(t,"ShortType",(function(){return Oe})),n.d(t,"Skeleton",(function(){return qs})),n.d(t,"SkeletonHelper",(function(){return vf})),n.d(t,"SkinnedMesh",(function(){return js})),n.d(t,"SmoothShading",(function(){return b})),n.d(t,"Sphere",(function(){return Ar})),n.d(t,"SphereBufferGeometry",(function(){return yu})),n.d(t,"SphereGeometry",(function(){return gu})),n.d(t,"Spherical",(function(){return nf})),n.d(t,"SphericalHarmonics3",(function(){return gh})),n.d(t,"SphericalReflectionMapping",(function(){return de})),n.d(t,"Spline",(function(){return Hp})),n.d(t,"SplineCurve",(function(){return zl})),n.d(t,"SplineCurve3",(function(){return Up})),n.d(t,"SpotLight",(function(){return Wl})),n.d(t,"SpotLightHelper",(function(){return ff})),n.d(t,"SpotLightShadow",(function(){return Vl})),n.d(t,"Sprite",(function(){return Fs})),n.d(t,"SpriteMaterial",(function(){return Ts})),n.d(t,"SrcAlphaFactor",(function(){return B})),n.d(t,"SrcAlphaSaturateFactor",(function(){return W})),n.d(t,"SrcColorFactor",(function(){return k})),n.d(t,"StaticCopyUsage",(function(){return yn})),n.d(t,"StaticDrawUsage",(function(){return fn})),n.d(t,"StaticReadUsage",(function(){return mn})),n.d(t,"StereoCamera",(function(){return Mh})),n.d(t,"StreamCopyUsage",(function(){return bn})),n.d(t,"StreamDrawUsage",(function(){return dn})),n.d(t,"StreamReadUsage",(function(){return gn})),n.d(t,"StringKeyframeTrack",(function(){return nl})),n.d(t,"SubtractEquation",(function(){return C})),n.d(t,"SubtractiveBlending",(function(){return A})),n.d(t,"TOUCH",(function(){return a})),n.d(t,"TangentSpaceNormalMap",(function(){return Yt})),n.d(t,"TetrahedronBufferGeometry",(function(){return Ac})),n.d(t,"TetrahedronGeometry",(function(){return Sc})),n.d(t,"TextBufferGeometry",(function(){return vu})),n.d(t,"TextGeometry",(function(){return mu})),n.d(t,"Texture",(function(){return Pn})),n.d(t,"TextureLoader",(function(){return gl})),n.d(t,"TorusBufferGeometry",(function(){return Bc})),n.d(t,"TorusGeometry",(function(){return Fc})),n.d(t,"TorusKnotBufferGeometry",(function(){return kc})),n.d(t,"TorusKnotGeometry",(function(){return zc})),n.d(t,"Triangle",(function(){return Jr})),n.d(t,"TriangleFanDrawMode",(function(){return zt})),n.d(t,"TriangleStripDrawMode",(function(){return Nt})),n.d(t,"TrianglesDrawMode",(function(){return It})),n.d(t,"TubeBufferGeometry",(function(){return Nc})),n.d(t,"TubeGeometry",(function(){return Ic})),n.d(t,"UVMapping",(function(){return ue})),n.d(t,"Uint16Attribute",(function(){return Ip})),n.d(t,"Uint16BufferAttribute",(function(){return di})),n.d(t,"Uint32Attribute",(function(){return zp})),n.d(t,"Uint32BufferAttribute",(function(){return vi})),n.d(t,"Uint8Attribute",(function(){return Cp})),n.d(t,"Uint8BufferAttribute",(function(){return hi})),n.d(t,"Uint8ClampedAttribute",(function(){return Op})),n.d(t,"Uint8ClampedBufferAttribute",(function(){return fi})),n.d(t,"Uncharted2ToneMapping",(function(){return oe})),n.d(t,"Uniform",(function(){return Qh})),n.d(t,"UniformsLib",(function(){return da})),n.d(t,"UniformsUtils",(function(){return ia})),n.d(t,"UnsignedByteType",(function(){return Pe})),n.d(t,"UnsignedInt248Type",(function(){return He})),n.d(t,"UnsignedIntType",(function(){return Ne})),n.d(t,"UnsignedShort4444Type",(function(){return Fe})),n.d(t,"UnsignedShort5551Type",(function(){return Be})),n.d(t,"UnsignedShort565Type",(function(){return Ue})),n.d(t,"UnsignedShortType",(function(){return De})),n.d(t,"VSMShadowMap",(function(){return m})),n.d(t,"Vector2",(function(){return Sn})),n.d(t,"Vector3",(function(){return kn})),n.d(t,"Vector4",(function(){return Cn})),n.d(t,"VectorKeyframeTrack",(function(){return rl})),n.d(t,"Vertex",(function(){return Lp})),n.d(t,"VertexColors",(function(){return M})),n.d(t,"VideoTexture",(function(){return gc})),n.d(t,"WebGLCubeRenderTarget",(function(){return ua})),n.d(t,"WebGLMultisampleRenderTarget",(function(){return Dn})),n.d(t,"WebGLRenderTarget",(function(){return On})),n.d(t,"WebGLRenderTargetCube",(function(){return Xp})),n.d(t,"WebGLRenderer",(function(){return ys})),n.d(t,"WebGLUtils",(function(){return fs})),n.d(t,"WireframeGeometry",(function(){return wc})),n.d(t,"WireframeHelper",(function(){return Wp})),n.d(t,"WrapAroundEnding",(function(){return Dt})),n.d(t,"XHRLoader",(function(){return qp})),n.d(t,"ZeroCurvatureEnding",(function(){return Ct})),n.d(t,"ZeroFactor",(function(){return N})),n.d(t,"ZeroSlopeEnding",(function(){return Ot})),n.d(t,"ZeroStencilOp",(function(){return Zt})),n.d(t,"sRGBEncoding",(function(){return Ft})),void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"===typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),"name"in Function.prototype===!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(void 0!==r&&null!==r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t});var r="113",i={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},a={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},o=0,s=1,c=2,u=3,l=0,h=1,f=0,p=1,d=2,m=3,v=0,g=1,y=2,x=1,b=2,w=0,_=1,M=2,E=0,T=1,S=2,A=3,L=4,R=5,P=100,C=101,O=102,D=103,I=104,N=200,z=201,k=202,F=203,B=204,U=205,H=206,G=207,j=208,V=209,W=210,q=0,Y=1,X=2,Z=3,J=4,Q=5,K=6,$=7,ee=0,te=1,ne=2,re=0,ie=1,ae=2,oe=3,se=4,ce=5,ue=300,le=301,he=302,fe=303,pe=304,de=305,me=306,ve=307,ge=1e3,ye=1001,xe=1002,be=1003,we=1004,_e=1004,Me=1005,Ee=1005,Te=1006,Se=1007,Ae=1007,Le=1008,Re=1008,Pe=1009,Ce=1010,Oe=1011,De=1012,Ie=1013,Ne=1014,ze=1015,ke=1016,Fe=1017,Be=1018,Ue=1019,He=1020,Ge=1021,je=1022,Ve=1023,We=1024,qe=1025,Ye=Ve,Xe=1026,Ze=1027,Je=1028,Qe=1029,Ke=1030,$e=1031,et=1032,tt=1033,nt=33776,rt=33777,it=33778,at=33779,ot=35840,st=35841,ct=35842,ut=35843,lt=36196,ht=37808,ft=37809,pt=37810,dt=37811,mt=37812,vt=37813,gt=37814,yt=37815,xt=37816,bt=37817,wt=37818,_t=37819,Mt=37820,Et=37821,Tt=2200,St=2201,At=2202,Lt=2300,Rt=2301,Pt=2302,Ct=2400,Ot=2401,Dt=2402,It=0,Nt=1,zt=2,kt=3e3,Ft=3001,Bt=3007,Ut=3002,Ht=3003,Gt=3004,jt=3005,Vt=3006,Wt=3200,qt=3201,Yt=0,Xt=1,Zt=0,Jt=7680,Qt=7681,Kt=7682,$t=7683,en=34055,tn=34056,nn=5386,rn=512,an=513,on=514,sn=515,cn=516,un=517,ln=518,hn=519,fn=35044,pn=35048,dn=35040,mn=35045,vn=35049,gn=35041,yn=35046,xn=35050,bn=35042;function wn(){}Object.assign(wn.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=t.slice(0),r=0,i=n.length;r<i;r++)n[r].call(this,e)}}}});for(var _n=[],Mn=0;Mn<256;Mn++)_n[Mn]=(Mn<16?"0":"")+Mn.toString(16);var En,Tn={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(_n[255&e]+_n[e>>8&255]+_n[e>>16&255]+_n[e>>24&255]+"-"+_n[255&t]+_n[t>>8&255]+"-"+_n[t>>16&15|64]+_n[t>>24&255]+"-"+_n[63&n|128]+_n[n>>8&255]+"-"+_n[n>>16&255]+_n[n>>24&255]+_n[255&r]+_n[r>>8&255]+_n[r>>16&255]+_n[r>>24&255]).toUpperCase()},clamp:function(e,t,n){return Math.max(t,Math.min(n,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},lerp:function(e,t,n){return(1-n)*e+n*t},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*Tn.DEG2RAD},radToDeg:function(e){return e*Tn.RAD2DEG},isPowerOfTwo:function(e){return 0===(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,n,r,i){var a=Math.cos,o=Math.sin,s=a(n/2),c=o(n/2),u=a((t+r)/2),l=o((t+r)/2),h=a((t-r)/2),f=o((t-r)/2),p=a((r-t)/2),d=o((r-t)/2);"XYX"===i?e.set(s*l,c*h,c*f,s*u):"YZY"===i?e.set(c*f,s*l,c*h,s*u):"ZXZ"===i?e.set(c*h,c*f,s*l,s*u):"XZX"===i?e.set(s*l,c*d,c*p,s*u):"YXY"===i?e.set(c*p,s*l,c*d,s*u):"ZYZ"===i?e.set(c*d,c*p,s*l,s*u):console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order.")}};function Sn(e,t){this.x=e||0,this.y=t||0}function An(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.defineProperties(Sn.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(Sn.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this},clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,a=this.y-e.y;return this.x=i*n-a*r+e.x,this.y=i*r+a*n+e.y,this}}),Object.assign(An.prototype,{isMatrix3:!0,set:function(e,t,n,r,i,a,o,s,c){var u=this.elements;return u[0]=e,u[1]=r,u[2]=o,u[3]=t,u[4]=i,u[5]=s,u[6]=n,u[7]=a,u[8]=c,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var n=e.elements,r=t.elements,i=this.elements,a=n[0],o=n[3],s=n[6],c=n[1],u=n[4],l=n[7],h=n[2],f=n[5],p=n[8],d=r[0],m=r[3],v=r[6],g=r[1],y=r[4],x=r[7],b=r[2],w=r[5],_=r[8];return i[0]=a*d+o*g+s*b,i[3]=a*m+o*y+s*w,i[6]=a*v+o*x+s*_,i[1]=c*d+u*g+l*b,i[4]=c*m+u*y+l*w,i[7]=c*v+u*x+l*_,i[2]=h*d+f*g+p*b,i[5]=h*m+f*y+p*w,i[8]=h*v+f*x+p*_,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],c=e[7],u=e[8];return t*a*u-t*o*c-n*i*u+n*o*s+r*i*c-r*a*s},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var n=e.elements,r=this.elements,i=n[0],a=n[1],o=n[2],s=n[3],c=n[4],u=n[5],l=n[6],h=n[7],f=n[8],p=f*c-u*h,d=u*l-f*s,m=h*s-c*l,v=i*p+a*d+o*m;if(0===v){var g="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(g);return console.warn(g),this.identity()}var y=1/v;return r[0]=p*y,r[1]=(o*h-f*a)*y,r[2]=(u*a-o*c)*y,r[3]=d*y,r[4]=(f*i-o*l)*y,r[5]=(o*s-u*i)*y,r[6]=m*y,r[7]=(a*l-h*i)*y,r[8]=(c*i-a*s)*y,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,n,r,i,a,o){var s=Math.cos(i),c=Math.sin(i);this.set(n*s,n*c,-n*(s*a+c*o)+a+e,-r*c,r*s,-r*(-c*a+s*o)+o+t,0,0,1)},scale:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this},rotate:function(e){var t=Math.cos(e),n=Math.sin(e),r=this.elements,i=r[0],a=r[3],o=r[6],s=r[1],c=r[4],u=r[7];return r[0]=t*i+n*s,r[3]=t*a+n*c,r[6]=t*o+n*u,r[1]=-n*i+t*s,r[4]=-n*a+t*c,r[7]=-n*o+t*u,this},translate:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this},equals:function(e){for(var t=this.elements,n=e.elements,r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var n=0;n<9;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}});var Ln={getDataURL:function(e){var t;if("undefined"==typeof HTMLCanvasElement)return e.src;if(e instanceof HTMLCanvasElement)t=e;else{void 0===En&&(En=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),En.width=e.width,En.height=e.height;var n=En.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=En}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},Rn=0;function Pn(e,t,n,r,i,a,o,s,c,u){Object.defineProperty(this,"id",{value:Rn++}),this.uuid=Tn.generateUUID(),this.name="",this.image=void 0!==e?e:Pn.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:Pn.DEFAULT_MAPPING,this.wrapS=void 0!==n?n:ye,this.wrapT=void 0!==r?r:ye,this.magFilter=void 0!==i?i:Te,this.minFilter=void 0!==a?a:Le,this.anisotropy=void 0!==c?c:1,this.format=void 0!==o?o:Ve,this.internalFormat=null,this.type=void 0!==s?s:Pe,this.offset=new Sn(0,0),this.repeat=new Sn(1,1),this.center=new Sn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new An,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==u?u:kt,this.version=0,this.onUpdate=null}function Cn(e,t,n,r){this.x=e||0,this.y=t||0,this.z=n||0,this.w=void 0!==r?r:1}function On(e,t,n){this.width=e,this.height=t,this.scissor=new Cn(0,0,e,t),this.scissorTest=!1,this.viewport=new Cn(0,0,e,t),n=n||{},this.texture=new Pn(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:Te,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0===n.stencilBuffer||n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}function Dn(e,t,n){On.call(this,e,t,n),this.samples=4}function In(e,t,n,r){this._x=e||0,this._y=t||0,this._z=n||0,this._w=void 0!==r?r:1}Pn.DEFAULT_IMAGE=void 0,Pn.DEFAULT_MAPPING=ue,Pn.prototype=Object.assign(Object.create(wn.prototype),{constructor:Pn,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var r=this.image;if(void 0===r.uuid&&(r.uuid=Tn.generateUUID()),!t&&void 0===e.images[r.uuid]){var i;if(Array.isArray(r)){i=[];for(var a=0,o=r.length;a<o;a++)i.push(Ln.getDataURL(r[a]))}else i=Ln.getDataURL(r);e.images[r.uuid]={uuid:r.uuid,url:i}}n.image=r.uuid}return t||(e.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping!==ue)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ge:e.x=e.x-Math.floor(e.x);break;case ye:e.x=e.x<0?0:1;break;case xe:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case ge:e.y=e.y-Math.floor(e.y);break;case ye:e.y=e.y<0?0:1;break;case xe:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(Pn.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.defineProperties(Cn.prototype,{width:{get:function(){return this.z},set:function(e){this.z=e}},height:{get:function(){return this.w},set:function(e){this.w=e}}}),Object.assign(Cn.prototype,{isVector4:!0,set:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,i=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*r+a[12]*i,this.y=a[1]*t+a[5]*n+a[9]*r+a[13]*i,this.z=a[2]*t+a[6]*n+a[10]*r+a[14]*i,this.w=a[3]*t+a[7]*n+a[11]*r+a[15]*i,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,n,r,i,a=e.elements,o=a[0],s=a[4],c=a[8],u=a[1],l=a[5],h=a[9],f=a[2],p=a[6],d=a[10];if(Math.abs(s-u)<.01&&Math.abs(c-f)<.01&&Math.abs(h-p)<.01){if(Math.abs(s+u)<.1&&Math.abs(c+f)<.1&&Math.abs(h+p)<.1&&Math.abs(o+l+d-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var m=(o+1)/2,v=(l+1)/2,g=(d+1)/2,y=(s+u)/4,x=(c+f)/4,b=(h+p)/4;return m>v&&m>g?m<.01?(n=0,r=.707106781,i=.707106781):(r=y/(n=Math.sqrt(m)),i=x/n):v>g?v<.01?(n=.707106781,r=0,i=.707106781):(n=y/(r=Math.sqrt(v)),i=b/r):g<.01?(n=.707106781,r=.707106781,i=0):(n=x/(i=Math.sqrt(g)),r=b/i),this.set(n,r,i,t),this}var w=Math.sqrt((p-h)*(p-h)+(c-f)*(c-f)+(u-s)*(u-s));return Math.abs(w)<.001&&(w=1),this.x=(p-h)/w,this.y=(c-f)/w,this.z=(u-s)/w,this.w=Math.acos((o+l+d-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this},clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),On.prototype=Object.assign(Object.create(wn.prototype),{constructor:On,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Dn.prototype=Object.assign(Object.create(On.prototype),{constructor:Dn,isWebGLMultisampleRenderTarget:!0,copy:function(e){return On.prototype.copy.call(this,e),this.samples=e.samples,this}}),Object.assign(In,{slerp:function(e,t,n,r){return n.copy(e).slerp(t,r)},slerpFlat:function(e,t,n,r,i,a,o){var s=n[r+0],c=n[r+1],u=n[r+2],l=n[r+3],h=i[a+0],f=i[a+1],p=i[a+2],d=i[a+3];if(l!==d||s!==h||c!==f||u!==p){var m=1-o,v=s*h+c*f+u*p+l*d,g=v>=0?1:-1,y=1-v*v;if(y>Number.EPSILON){var x=Math.sqrt(y),b=Math.atan2(x,v*g);m=Math.sin(m*b)/x,o=Math.sin(o*b)/x}var w=o*g;if(s=s*m+h*w,c=c*m+f*w,u=u*m+p*w,l=l*m+d*w,m===1-o){var _=1/Math.sqrt(s*s+c*c+u*u+l*l);s*=_,c*=_,u*=_,l*=_}}e[t]=s,e[t+1]=c,e[t+2]=u,e[t+3]=l}}),Object.defineProperties(In.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}}}),Object.assign(In.prototype,{isQuaternion:!0,set:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e._x,r=e._y,i=e._z,a=e.order,o=Math.cos,s=Math.sin,c=o(n/2),u=o(r/2),l=o(i/2),h=s(n/2),f=s(r/2),p=s(i/2);return"XYZ"===a?(this._x=h*u*l+c*f*p,this._y=c*f*l-h*u*p,this._z=c*u*p+h*f*l,this._w=c*u*l-h*f*p):"YXZ"===a?(this._x=h*u*l+c*f*p,this._y=c*f*l-h*u*p,this._z=c*u*p-h*f*l,this._w=c*u*l+h*f*p):"ZXY"===a?(this._x=h*u*l-c*f*p,this._y=c*f*l+h*u*p,this._z=c*u*p+h*f*l,this._w=c*u*l-h*f*p):"ZYX"===a?(this._x=h*u*l-c*f*p,this._y=c*f*l+h*u*p,this._z=c*u*p-h*f*l,this._w=c*u*l+h*f*p):"YZX"===a?(this._x=h*u*l+c*f*p,this._y=c*f*l+h*u*p,this._z=c*u*p-h*f*l,this._w=c*u*l-h*f*p):"XZY"===a&&(this._x=h*u*l-c*f*p,this._y=c*f*l-h*u*p,this._z=c*u*p+h*f*l,this._w=c*u*l+h*f*p),!1!==t&&this._onChangeCallback(),this},setFromAxisAngle:function(e,t){var n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this},setFromRotationMatrix:function(e){var t,n=e.elements,r=n[0],i=n[4],a=n[8],o=n[1],s=n[5],c=n[9],u=n[2],l=n[6],h=n[10],f=r+s+h;return f>0?(t=.5/Math.sqrt(f+1),this._w=.25/t,this._x=(l-c)*t,this._y=(a-u)*t,this._z=(o-i)*t):r>s&&r>h?(t=2*Math.sqrt(1+r-s-h),this._w=(l-c)/t,this._x=.25*t,this._y=(i+o)/t,this._z=(a+u)/t):s>h?(t=2*Math.sqrt(1+s-r-h),this._w=(a-u)/t,this._x=(i+o)/t,this._y=.25*t,this._z=(c+l)/t):(t=2*Math.sqrt(1+h-r-s),this._w=(o-i)/t,this._x=(a+u)/t,this._y=(c+l)/t,this._z=.25*t),this._onChangeCallback(),this},setFromUnitVectors:function(e,t){var n=e.dot(t)+1;return n<1e-6?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()},angleTo:function(e){return 2*Math.acos(Math.abs(Tn.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var n=this.angleTo(e);if(0===n)return this;var r=Math.min(1,t/n);return this.slerp(e,r),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var n=e._x,r=e._y,i=e._z,a=e._w,o=t._x,s=t._y,c=t._z,u=t._w;return this._x=n*u+a*o+r*c-i*s,this._y=r*u+a*s+i*o-n*c,this._z=i*u+a*c+n*s-r*o,this._w=a*u-n*o-r*s-i*c,this._onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,r=this._y,i=this._z,a=this._w,o=a*e._w+n*e._x+r*e._y+i*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=n,this._y=r,this._z=i,this;var s=1-o*o;if(s<=Number.EPSILON){var c=1-t;return this._w=c*a+t*this._w,this._x=c*n+t*this._x,this._y=c*r+t*this._y,this._z=c*i+t*this._z,this.normalize(),this._onChangeCallback(),this}var u=Math.sqrt(s),l=Math.atan2(u,o),h=Math.sin((1-t)*l)/u,f=Math.sin(t*l)/u;return this._w=a*h+this._w*f,this._x=n*h+this._x*f,this._y=r*h+this._y*f,this._z=i*h+this._z*f,this._onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}});var Nn=new kn,zn=new In;function kn(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0}Object.assign(kn.prototype,{isVector3:!0,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(zn.setFromEuler(e))},applyAxisAngle:function(e,t){return this.applyQuaternion(zn.setFromAxisAngle(e,t))},applyMatrix3:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this},applyNormalMatrix:function(e){return this.applyMatrix3(e).normalize()},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements,a=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*a,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*a,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*a,this},applyQuaternion:function(e){var t=this.x,n=this.y,r=this.z,i=e.x,a=e.y,o=e.z,s=e.w,c=s*t+a*r-o*n,u=s*n+o*t-i*r,l=s*r+i*n-a*t,h=-i*t-a*n-o*r;return this.x=c*s+h*-i+u*-o-l*-a,this.y=u*s+h*-a+l*-i-c*-o,this.z=l*s+h*-o+c*-a-u*-i,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)},transformDirection:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this},clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},cross:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var n=e.x,r=e.y,i=e.z,a=t.x,o=t.y,s=t.z;return this.x=r*s-i*o,this.y=i*a-n*s,this.z=n*o-r*a,this},projectOnVector:function(e){var t=e.lengthSq();if(0===t)return this.set(0,0,0);var n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)},projectOnPlane:function(e){return Nn.copy(this).projectOnVector(e),this.sub(Nn)},reflect:function(e){return this.sub(Nn.copy(e).multiplyScalar(2*this.dot(e)))},angleTo:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;var n=this.dot(e)/t;return Math.acos(Tn.clamp(n,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,n){var r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},setFromMatrix3Column:function(e,t){return this.fromArray(e.elements,3*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}});var Fn=new kn,Bn=new Wn,Un=new kn(0,0,0),Hn=new kn(1,1,1),Gn=new kn,jn=new kn,Vn=new kn;function Wn(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(Wn.prototype,{isMatrix4:!0,set:function(e,t,n,r,i,a,o,s,c,u,l,h,f,p,d,m){var v=this.elements;return v[0]=e,v[4]=t,v[8]=n,v[12]=r,v[1]=i,v[5]=a,v[9]=o,v[13]=s,v[2]=c,v[6]=u,v[10]=l,v[14]=h,v[3]=f,v[7]=p,v[11]=d,v[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new Wn).fromArray(this.elements)},copy:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this},copyPosition:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this},extractBasis:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this},extractRotation:function(e){var t=this.elements,n=e.elements,r=1/Fn.setFromMatrixColumn(e,0).length(),i=1/Fn.setFromMatrixColumn(e,1).length(),a=1/Fn.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,n=e.x,r=e.y,i=e.z,a=Math.cos(n),o=Math.sin(n),s=Math.cos(r),c=Math.sin(r),u=Math.cos(i),l=Math.sin(i);if("XYZ"===e.order){var h=a*u,f=a*l,p=o*u,d=o*l;t[0]=s*u,t[4]=-s*l,t[8]=c,t[1]=f+p*c,t[5]=h-d*c,t[9]=-o*s,t[2]=d-h*c,t[6]=p+f*c,t[10]=a*s}else if("YXZ"===e.order){var m=s*u,v=s*l,g=c*u,y=c*l;t[0]=m+y*o,t[4]=g*o-v,t[8]=a*c,t[1]=a*l,t[5]=a*u,t[9]=-o,t[2]=v*o-g,t[6]=y+m*o,t[10]=a*s}else if("ZXY"===e.order){m=s*u,v=s*l,g=c*u,y=c*l;t[0]=m-y*o,t[4]=-a*l,t[8]=g+v*o,t[1]=v+g*o,t[5]=a*u,t[9]=y-m*o,t[2]=-a*c,t[6]=o,t[10]=a*s}else if("ZYX"===e.order){h=a*u,f=a*l,p=o*u,d=o*l;t[0]=s*u,t[4]=p*c-f,t[8]=h*c+d,t[1]=s*l,t[5]=d*c+h,t[9]=f*c-p,t[2]=-c,t[6]=o*s,t[10]=a*s}else if("YZX"===e.order){var x=a*s,b=a*c,w=o*s,_=o*c;t[0]=s*u,t[4]=_-x*l,t[8]=w*l+b,t[1]=l,t[5]=a*u,t[9]=-o*u,t[2]=-c*u,t[6]=b*l+w,t[10]=x-_*l}else if("XZY"===e.order){x=a*s,b=a*c,w=o*s,_=o*c;t[0]=s*u,t[4]=-l,t[8]=c*u,t[1]=x*l+_,t[5]=a*u,t[9]=b*l-w,t[2]=w*l-b,t[6]=o*u,t[10]=_*l+x}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){return this.compose(Un,e,Hn)},lookAt:function(e,t,n){var r=this.elements;return Vn.subVectors(e,t),0===Vn.lengthSq()&&(Vn.z=1),Vn.normalize(),Gn.crossVectors(n,Vn),0===Gn.lengthSq()&&(1===Math.abs(n.z)?Vn.x+=1e-4:Vn.z+=1e-4,Vn.normalize(),Gn.crossVectors(n,Vn)),Gn.normalize(),jn.crossVectors(Vn,Gn),r[0]=Gn.x,r[4]=jn.x,r[8]=Vn.x,r[1]=Gn.y,r[5]=jn.y,r[9]=Vn.y,r[2]=Gn.z,r[6]=jn.z,r[10]=Vn.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var n=e.elements,r=t.elements,i=this.elements,a=n[0],o=n[4],s=n[8],c=n[12],u=n[1],l=n[5],h=n[9],f=n[13],p=n[2],d=n[6],m=n[10],v=n[14],g=n[3],y=n[7],x=n[11],b=n[15],w=r[0],_=r[4],M=r[8],E=r[12],T=r[1],S=r[5],A=r[9],L=r[13],R=r[2],P=r[6],C=r[10],O=r[14],D=r[3],I=r[7],N=r[11],z=r[15];return i[0]=a*w+o*T+s*R+c*D,i[4]=a*_+o*S+s*P+c*I,i[8]=a*M+o*A+s*C+c*N,i[12]=a*E+o*L+s*O+c*z,i[1]=u*w+l*T+h*R+f*D,i[5]=u*_+l*S+h*P+f*I,i[9]=u*M+l*A+h*C+f*N,i[13]=u*E+l*L+h*O+f*z,i[2]=p*w+d*T+m*R+v*D,i[6]=p*_+d*S+m*P+v*I,i[10]=p*M+d*A+m*C+v*N,i[14]=p*E+d*L+m*O+v*z,i[3]=g*w+y*T+x*R+b*D,i[7]=g*_+y*S+x*P+b*I,i[11]=g*M+y*A+x*C+b*N,i[15]=g*E+y*L+x*O+b*z,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},determinant:function(){var e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],a=e[1],o=e[5],s=e[9],c=e[13],u=e[2],l=e[6],h=e[10],f=e[14];return e[3]*(+i*s*l-r*c*l-i*o*h+n*c*h+r*o*f-n*s*f)+e[7]*(+t*s*f-t*c*h+i*a*h-r*a*f+r*c*u-i*s*u)+e[11]*(+t*c*l-t*o*f-i*a*l+n*a*f+i*o*u-n*c*u)+e[15]*(-r*o*u-t*s*l+t*o*h+r*a*l-n*a*h+n*s*u)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e,t,n){var r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this},getInverse:function(e,t){var n=this.elements,r=e.elements,i=r[0],a=r[1],o=r[2],s=r[3],c=r[4],u=r[5],l=r[6],h=r[7],f=r[8],p=r[9],d=r[10],m=r[11],v=r[12],g=r[13],y=r[14],x=r[15],b=p*y*h-g*d*h+g*l*m-u*y*m-p*l*x+u*d*x,w=v*d*h-f*y*h-v*l*m+c*y*m+f*l*x-c*d*x,_=f*g*h-v*p*h+v*u*m-c*g*m-f*u*x+c*p*x,M=v*p*l-f*g*l-v*u*d+c*g*d+f*u*y-c*p*y,E=i*b+a*w+o*_+s*M;if(0===E){var T="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(T);return console.warn(T),this.identity()}var S=1/E;return n[0]=b*S,n[1]=(g*d*s-p*y*s-g*o*m+a*y*m+p*o*x-a*d*x)*S,n[2]=(u*y*s-g*l*s+g*o*h-a*y*h-u*o*x+a*l*x)*S,n[3]=(p*l*s-u*d*s-p*o*h+a*d*h+u*o*m-a*l*m)*S,n[4]=w*S,n[5]=(f*y*s-v*d*s+v*o*m-i*y*m-f*o*x+i*d*x)*S,n[6]=(v*l*s-c*y*s-v*o*h+i*y*h+c*o*x-i*l*x)*S,n[7]=(c*d*s-f*l*s+f*o*h-i*d*h-c*o*m+i*l*m)*S,n[8]=_*S,n[9]=(v*p*s-f*g*s-v*a*m+i*g*m+f*a*x-i*p*x)*S,n[10]=(c*g*s-v*u*s+v*a*h-i*g*h-c*a*x+i*u*x)*S,n[11]=(f*u*s-c*p*s-f*a*h+i*p*h+c*a*m-i*u*m)*S,n[12]=M*S,n[13]=(f*g*o-v*p*o+v*a*d-i*g*d-f*a*y+i*p*y)*S,n[14]=(v*u*o-c*g*o-v*a*l+i*g*l+c*a*y-i*u*y)*S,n[15]=(c*p*o-f*u*o+f*a*l-i*p*l-c*a*d+i*u*d)*S,this},scale:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=1-n,a=e.x,o=e.y,s=e.z,c=i*a,u=i*o;return this.set(c*a+n,c*o-r*s,c*s+r*o,0,c*o+r*s,u*o+n,u*s-r*a,0,c*s-r*o,u*s+r*a,i*s*s+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,n){var r=this.elements,i=t._x,a=t._y,o=t._z,s=t._w,c=i+i,u=a+a,l=o+o,h=i*c,f=i*u,p=i*l,d=a*u,m=a*l,v=o*l,g=s*c,y=s*u,x=s*l,b=n.x,w=n.y,_=n.z;return r[0]=(1-(d+v))*b,r[1]=(f+x)*b,r[2]=(p-y)*b,r[3]=0,r[4]=(f-x)*w,r[5]=(1-(h+v))*w,r[6]=(m+g)*w,r[7]=0,r[8]=(p+y)*_,r[9]=(m-g)*_,r[10]=(1-(h+d))*_,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this},decompose:function(e,t,n){var r=this.elements,i=Fn.set(r[0],r[1],r[2]).length(),a=Fn.set(r[4],r[5],r[6]).length(),o=Fn.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],Bn.copy(this);var s=1/i,c=1/a,u=1/o;return Bn.elements[0]*=s,Bn.elements[1]*=s,Bn.elements[2]*=s,Bn.elements[4]*=c,Bn.elements[5]*=c,Bn.elements[6]*=c,Bn.elements[8]*=u,Bn.elements[9]*=u,Bn.elements[10]*=u,t.setFromRotationMatrix(Bn),n.x=i,n.y=a,n.z=o,this},makePerspective:function(e,t,n,r,i,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,s=2*i/(t-e),c=2*i/(n-r),u=(t+e)/(t-e),l=(n+r)/(n-r),h=-(a+i)/(a-i),f=-2*a*i/(a-i);return o[0]=s,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=c,o[9]=l,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=f,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makeOrthographic:function(e,t,n,r,i,a){var o=this.elements,s=1/(t-e),c=1/(n-r),u=1/(a-i),l=(t+e)*s,h=(n+r)*c,f=(a+i)*u;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-l,o[1]=0,o[5]=2*c,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*u,o[14]=-f,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(e){for(var t=this.elements,n=e.elements,r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var n=0;n<16;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}});var qn=new Wn,Yn=new In;function Xn(e,t,n,r){this._x=e||0,this._y=t||0,this._z=n||0,this._order=r||Xn.DefaultOrder}function Zn(){this.mask=1}Xn.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Xn.DefaultOrder="XYZ",Object.defineProperties(Xn.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}}}),Object.assign(Xn.prototype,{isEuler:!0,set:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._order=r||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this},setFromRotationMatrix:function(e,t,n){var r=Tn.clamp,i=e.elements,a=i[0],o=i[4],s=i[8],c=i[1],u=i[5],l=i[9],h=i[2],f=i[6],p=i[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(r(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-l,p),this._z=Math.atan2(-o,a)):(this._x=Math.atan2(f,u),this._z=0)):"YXZ"===t?(this._x=Math.asin(-r(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(s,p),this._z=Math.atan2(c,u)):(this._y=Math.atan2(-h,a),this._z=0)):"ZXY"===t?(this._x=Math.asin(r(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-o,u)):(this._y=0,this._z=Math.atan2(c,a))):"ZYX"===t?(this._y=Math.asin(-r(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(f,p),this._z=Math.atan2(c,a)):(this._x=0,this._z=Math.atan2(-o,u))):"YZX"===t?(this._z=Math.asin(r(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-l,u),this._y=Math.atan2(-h,a)):(this._x=0,this._y=Math.atan2(s,p))):"XZY"===t?(this._z=Math.asin(-r(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(f,u),this._y=Math.atan2(s,a)):(this._x=Math.atan2(-l,p),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==n&&this._onChangeCallback(),this},setFromQuaternion:function(e,t,n){return qn.makeRotationFromQuaternion(e),this.setFromRotationMatrix(qn,t,n)},setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(e){return Yn.setFromEuler(this),this.setFromQuaternion(Yn,e)},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new kn(this._x,this._y,this._z)},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}}),Object.assign(Zn.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},enableAll:function(){this.mask=-1},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},disableAll:function(){this.mask=0},test:function(e){return 0!==(this.mask&e.mask)}});var Jn=0,Qn=new kn,Kn=new In,$n=new Wn,er=new kn,tr=new kn,nr=new kn,rr=new In,ir=new kn(1,0,0),ar=new kn(0,1,0),or=new kn(0,0,1),sr={type:"added"},cr={type:"removed"};function ur(){Object.defineProperty(this,"id",{value:Jn++}),this.uuid=Tn.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ur.DefaultUp.clone();var e=new kn,t=new Xn,n=new In,r=new kn(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Wn},normalMatrix:{value:new An}}),this.matrix=new Wn,this.matrixWorld=new Wn,this.matrixAutoUpdate=ur.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Zn,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function lr(){ur.call(this),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}ur.DefaultUp=new kn(0,1,0),ur.DefaultMatrixAutoUpdate=!0,ur.prototype=Object.assign(Object.create(wn.prototype),{constructor:ur,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return Kn.setFromAxisAngle(e,t),this.quaternion.multiply(Kn),this},rotateOnWorldAxis:function(e,t){return Kn.setFromAxisAngle(e,t),this.quaternion.premultiply(Kn),this},rotateX:function(e){return this.rotateOnAxis(ir,e)},rotateY:function(e){return this.rotateOnAxis(ar,e)},rotateZ:function(e){return this.rotateOnAxis(or,e)},translateOnAxis:function(e,t){return Qn.copy(e).applyQuaternion(this.quaternion),this.position.add(Qn.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(ir,e)},translateY:function(e){return this.translateOnAxis(ar,e)},translateZ:function(e){return this.translateOnAxis(or,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4($n.getInverse(this.matrixWorld))},lookAt:function(e,t,n){e.isVector3?er.copy(e):er.set(e,t,n);var r=this.parent;this.updateWorldMatrix(!0,!1),tr.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?$n.lookAt(tr,er,this.up):$n.lookAt(er,tr,this.up),this.quaternion.setFromRotationMatrix($n),r&&($n.extractRotation(r.matrixWorld),Kn.setFromRotationMatrix($n),this.quaternion.premultiply(Kn.inverse()))},add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(sr)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var n=this.children.indexOf(e);return-1!==n&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(cr)),this},attach:function(e){return this.updateWorldMatrix(!0,!1),$n.getInverse(this.matrixWorld),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),$n.multiply(e.parent.matrixWorld)),e.applyMatrix4($n),e.updateWorldMatrix(!1,!1),this.add(e),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new kn),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new In),this.updateMatrixWorld(!0),this.matrixWorld.decompose(tr,e,nr),e},getWorldScale:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new kn),this.updateMatrixWorld(!0),this.matrixWorld.decompose(tr,rr,e),e},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new kn),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var r=this.children,i=0,a=r.length;i<a;i++)r[i].updateWorldMatrix(!1,!0)},toJSON:function(e){var t=void 0===e||"string"===typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var r={};function i(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){r.geometry=i(e.geometries,this.geometry);var a=this.geometry.parameters;if(void 0!==a&&void 0!==a.shapes){var o=a.shapes;if(Array.isArray(o))for(var s=0,c=o.length;s<c;s++){var u=o[s];i(e.shapes,u)}else i(e.shapes,o)}}if(void 0!==this.material)if(Array.isArray(this.material)){var l=[];for(s=0,c=this.material.length;s<c;s++)l.push(i(e.materials,this.material[s]));r.material=l}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[];for(s=0;s<this.children.length;s++)r.children.push(this.children[s].toJSON(e).object)}if(t){var h=m(e.geometries),f=m(e.materials),p=m(e.textures),d=m(e.images);o=m(e.shapes);h.length>0&&(n.geometries=h),f.length>0&&(n.materials=f),p.length>0&&(n.textures=p),d.length>0&&(n.images=d),o.length>0&&(n.shapes=o)}return n.object=r,n;function m(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var n=0;n<e.children.length;n++){var r=e.children[n];this.add(r.clone())}return this}}),lr.prototype=Object.assign(Object.create(ur.prototype),{constructor:lr,isScene:!0,copy:function(e,t){return ur.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=ur.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.environment&&(t.object.environment=this.environment.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t},dispose:function(){this.dispatchEvent({type:"dispose"})}});var hr=[new kn,new kn,new kn,new kn,new kn,new kn,new kn,new kn],fr=new kn,pr=new Er,dr=new kn,mr=new kn,vr=new kn,gr=new kn,yr=new kn,xr=new kn,br=new kn,wr=new kn,_r=new kn,Mr=new kn;function Er(e,t){this.min=void 0!==e?e:new kn(1/0,1/0,1/0),this.max=void 0!==t?t:new kn(-1/0,-1/0,-1/0)}function Tr(e,t,n,r,i){var a,o;for(a=0,o=e.length-3;a<=o;a+=3){Mr.fromArray(e,a);var s=i.x*Math.abs(Mr.x)+i.y*Math.abs(Mr.y)+i.z*Math.abs(Mr.z),c=t.dot(Mr),u=n.dot(Mr),l=r.dot(Mr);if(Math.max(-Math.max(c,u,l),Math.min(c,u,l))>s)return!1}return!0}Object.assign(Er.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,n=1/0,r=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,c=e.length;s<c;s+=3){var u=e[s],l=e[s+1],h=e[s+2];u<t&&(t=u),l<n&&(n=l),h<r&&(r=h),u>i&&(i=u),l>a&&(a=l),h>o&&(o=h)}return this.min.set(t,n,r),this.max.set(i,a,o),this},setFromBufferAttribute:function(e){for(var t=1/0,n=1/0,r=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,c=e.count;s<c;s++){var u=e.getX(s),l=e.getY(s),h=e.getZ(s);u<t&&(t=u),l<n&&(n=l),h<r&&(r=h),u>i&&(i=u),l>a&&(a=l),h>o&&(o=h)}return this.min.set(t,n,r),this.max.set(i,a,o),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){var n=fr.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this},setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new kn),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new kn),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(e){e.updateWorldMatrix(!1,!1);var t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),pr.copy(t.boundingBox),pr.applyMatrix4(e.matrixWorld),this.expandByPoint(pr.min),this.expandByPoint(pr.max));for(var n=e.children,r=0,i=n.length;r<i;r++)this.expandByObject(n[r]);return this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new kn),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(e){return this.clampPoint(e.center,fr),fr.distanceToSquared(e.center)<=e.radius*e.radius},intersectsPlane:function(e){var t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant},intersectsTriangle:function(e){if(this.isEmpty())return!1;this.getCenter(br),wr.subVectors(this.max,br),dr.subVectors(e.a,br),mr.subVectors(e.b,br),vr.subVectors(e.c,br),gr.subVectors(mr,dr),yr.subVectors(vr,mr),xr.subVectors(dr,vr);var t=[0,-gr.z,gr.y,0,-yr.z,yr.y,0,-xr.z,xr.y,gr.z,0,-gr.x,yr.z,0,-yr.x,xr.z,0,-xr.x,-gr.y,gr.x,0,-yr.y,yr.x,0,-xr.y,xr.x,0];return!!Tr(t,dr,mr,vr,wr)&&(!!Tr(t=[1,0,0,0,1,0,0,0,1],dr,mr,vr,wr)&&(_r.crossVectors(gr,yr),Tr(t=[_r.x,_r.y,_r.z],dr,mr,vr,wr)))},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new kn),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return fr.copy(e).clamp(this.min,this.max).sub(e).length()},getBoundingSphere:function(e){return void 0===e&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(fr).length(),e},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(e){return this.isEmpty()||(hr[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),hr[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),hr[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),hr[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),hr[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),hr[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),hr[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),hr[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(hr)),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var Sr=new Er;function Ar(e,t){this.center=void 0!==e?e:new kn,this.radius=void 0!==t?t:0}Object.assign(Ar.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(e,t){var n=this.center;void 0!==t?n.copy(t):Sr.setFromPoints(e).getCenter(n);for(var r=0,i=0,a=e.length;i<a;i++)r=Math.max(r,n.distanceToSquared(e[i]));return this.radius=Math.sqrt(r),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var n=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new kn),t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new Er),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}});var Lr=new kn,Rr=new kn,Pr=new kn,Cr=new kn,Or=new kn,Dr=new kn,Ir=new kn;function Nr(e,t){this.origin=void 0!==e?e:new kn,this.direction=void 0!==t?t:new kn(0,0,-1)}Object.assign(Nr.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new kn),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(e){return this.origin.copy(this.at(e,Lr)),this},closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new kn),t.subVectors(e,this.origin);var n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(e){var t=Lr.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Lr.copy(this.direction).multiplyScalar(t).add(this.origin),Lr.distanceToSquared(e))},distanceSqToSegment:function(e,t,n,r){Rr.copy(e).add(t).multiplyScalar(.5),Pr.copy(t).sub(e).normalize(),Cr.copy(this.origin).sub(Rr);var i,a,o,s,c=.5*e.distanceTo(t),u=-this.direction.dot(Pr),l=Cr.dot(this.direction),h=-Cr.dot(Pr),f=Cr.lengthSq(),p=Math.abs(1-u*u);if(p>0)if(a=u*l-h,s=c*p,(i=u*h-l)>=0)if(a>=-s)if(a<=s){var d=1/p;o=(i*=d)*(i+u*(a*=d)+2*l)+a*(u*i+a+2*h)+f}else a=c,o=-(i=Math.max(0,-(u*a+l)))*i+a*(a+2*h)+f;else a=-c,o=-(i=Math.max(0,-(u*a+l)))*i+a*(a+2*h)+f;else a<=-s?o=-(i=Math.max(0,-(-u*c+l)))*i+(a=i>0?-c:Math.min(Math.max(-c,-h),c))*(a+2*h)+f:a<=s?(i=0,o=(a=Math.min(Math.max(-c,-h),c))*(a+2*h)+f):o=-(i=Math.max(0,-(u*c+l)))*i+(a=i>0?c:Math.min(Math.max(-c,-h),c))*(a+2*h)+f;else a=u>0?-c:c,o=-(i=Math.max(0,-(u*a+l)))*i+a*(a+2*h)+f;return n&&n.copy(this.direction).multiplyScalar(i).add(this.origin),r&&r.copy(Pr).multiplyScalar(a).add(Rr),o},intersectSphere:function(e,t){Lr.subVectors(e.center,this.origin);var n=Lr.dot(this.direction),r=Lr.dot(Lr)-n*n,i=e.radius*e.radius;if(r>i)return null;var a=Math.sqrt(i-r),o=n-a,s=n+a;return o<0&&s<0?null:o<0?this.at(s,t):this.at(o,t)},intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null},intersectPlane:function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},intersectBox:function(e,t){var n,r,i,a,o,s,c=1/this.direction.x,u=1/this.direction.y,l=1/this.direction.z,h=this.origin;return c>=0?(n=(e.min.x-h.x)*c,r=(e.max.x-h.x)*c):(n=(e.max.x-h.x)*c,r=(e.min.x-h.x)*c),u>=0?(i=(e.min.y-h.y)*u,a=(e.max.y-h.y)*u):(i=(e.max.y-h.y)*u,a=(e.min.y-h.y)*u),n>a||i>r?null:((i>n||n!==n)&&(n=i),(a<r||r!==r)&&(r=a),l>=0?(o=(e.min.z-h.z)*l,s=(e.max.z-h.z)*l):(o=(e.max.z-h.z)*l,s=(e.min.z-h.z)*l),n>s||o>r?null:((o>n||n!==n)&&(n=o),(s<r||r!==r)&&(r=s),r<0?null:this.at(n>=0?n:r,t)))},intersectsBox:function(e){return null!==this.intersectBox(e,Lr)},intersectTriangle:function(e,t,n,r,i){Or.subVectors(t,e),Dr.subVectors(n,e),Ir.crossVectors(Or,Dr);var a,o=this.direction.dot(Ir);if(o>0){if(r)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}Cr.subVectors(this.origin,e);var s=a*this.direction.dot(Dr.crossVectors(Cr,Dr));if(s<0)return null;var c=a*this.direction.dot(Or.cross(Cr));if(c<0)return null;if(s+c>o)return null;var u=-a*Cr.dot(Ir);return u<0?null:this.at(u/o,i)},applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}});var zr=new kn,kr=new kn,Fr=new An;function Br(e,t){this.normal=void 0!==e?e:new kn(1,0,0),this.constant=void 0!==t?t:0}Object.assign(Br.prototype,{isPlane:!0,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(e,t,n){var r=zr.subVectors(n,t).cross(kr.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new kn),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(e,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new kn);var n=e.delta(zr),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):void 0;var i=-(e.start.dot(this.normal)+this.constant)/r;return i<0||i>1?void 0:t.copy(n).multiplyScalar(i).add(e.start)},intersectsLine:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new kn),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(e,t){var n=t||Fr.getNormalMatrix(e),r=this.coplanarPoint(zr).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this},translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}});var Ur=new kn,Hr=new kn,Gr=new kn,jr=new kn,Vr=new kn,Wr=new kn,qr=new kn,Yr=new kn,Xr=new kn,Zr=new kn;function Jr(e,t,n){this.a=void 0!==e?e:new kn,this.b=void 0!==t?t:new kn,this.c=void 0!==n?n:new kn}Object.assign(Jr,{getNormal:function(e,t,n,r){void 0===r&&(console.warn("THREE.Triangle: .getNormal() target is now required"),r=new kn),r.subVectors(n,t),Ur.subVectors(e,t),r.cross(Ur);var i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)},getBarycoord:function(e,t,n,r,i){Ur.subVectors(r,t),Hr.subVectors(n,t),Gr.subVectors(e,t);var a=Ur.dot(Ur),o=Ur.dot(Hr),s=Ur.dot(Gr),c=Hr.dot(Hr),u=Hr.dot(Gr),l=a*c-o*o;if(void 0===i&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),i=new kn),0===l)return i.set(-2,-1,-1);var h=1/l,f=(c*s-o*u)*h,p=(a*u-o*s)*h;return i.set(1-f-p,p,f)},containsPoint:function(e,t,n,r){return Jr.getBarycoord(e,t,n,r,jr),jr.x>=0&&jr.y>=0&&jr.x+jr.y<=1},getUV:function(e,t,n,r,i,a,o,s){return this.getBarycoord(e,t,n,r,jr),s.set(0,0),s.addScaledVector(i,jr.x),s.addScaledVector(a,jr.y),s.addScaledVector(o,jr.z),s},isFrontFacing:function(e,t,n,r){return Ur.subVectors(n,t),Hr.subVectors(e,t),Ur.cross(Hr).dot(r)<0}}),Object.assign(Jr.prototype,{set:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this},setFromPointsAndIndices:function(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){return Ur.subVectors(this.c,this.b),Hr.subVectors(this.a,this.b),.5*Ur.cross(Hr).length()},getMidpoint:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new kn),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return Jr.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new Br),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return Jr.getBarycoord(e,this.a,this.b,this.c,t)},getUV:function(e,t,n,r,i){return Jr.getUV(e,this.a,this.b,this.c,t,n,r,i)},containsPoint:function(e){return Jr.containsPoint(e,this.a,this.b,this.c)},isFrontFacing:function(e){return Jr.isFrontFacing(this.a,this.b,this.c,e)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new kn);var n,r,i=this.a,a=this.b,o=this.c;Vr.subVectors(a,i),Wr.subVectors(o,i),Yr.subVectors(e,i);var s=Vr.dot(Yr),c=Wr.dot(Yr);if(s<=0&&c<=0)return t.copy(i);Xr.subVectors(e,a);var u=Vr.dot(Xr),l=Wr.dot(Xr);if(u>=0&&l<=u)return t.copy(a);var h=s*l-u*c;if(h<=0&&s>=0&&u<=0)return n=s/(s-u),t.copy(i).addScaledVector(Vr,n);Zr.subVectors(e,o);var f=Vr.dot(Zr),p=Wr.dot(Zr);if(p>=0&&f<=p)return t.copy(o);var d=f*c-s*p;if(d<=0&&c>=0&&p<=0)return r=c/(c-p),t.copy(i).addScaledVector(Wr,r);var m=u*p-f*l;if(m<=0&&l-u>=0&&f-p>=0)return qr.subVectors(o,a),r=(l-u)/(l-u+(f-p)),t.copy(a).addScaledVector(qr,r);var v=1/(m+d+h);return n=d*v,r=h*v,t.copy(i).addScaledVector(Vr,n).addScaledVector(Wr,r)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}});var Qr={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Kr={h:0,s:0,l:0},$r={h:0,s:0,l:0};function ei(e,t,n){return void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}function ti(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function ni(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function ri(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}function ii(e,t,n,r,i,a){this.a=e,this.b=t,this.c=n,this.normal=r&&r.isVector3?r:new kn,this.vertexNormals=Array.isArray(r)?r:[],this.color=i&&i.isColor?i:new ei,this.vertexColors=Array.isArray(i)?i:[],this.materialIndex=void 0!==a?a:0}Object.assign(ei.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"===typeof e?this.setHex(e):"string"===typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSL:function(e,t,n){if(e=Tn.euclideanModulo(e,1),t=Tn.clamp(t,0,1),n=Tn.clamp(n,0,1),0===t)this.r=this.g=this.b=n;else{var r=n<=.5?n*(1+t):n+t-n*t,i=2*n-r;this.r=ti(i,r,e+1/3),this.g=ti(i,r,e),this.b=ti(i,r,e-1/3)}return this},setStyle:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var r,i=n[1],a=n[2];switch(i){case"rgb":case"rgba":if(r=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,t(r[5]),this;if(r=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,t(r[5]),this;break;case"hsl":case"hsla":if(r=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a)){var o=parseFloat(r[1])/360,s=parseInt(r[2],10)/100,c=parseInt(r[3],10)/100;return t(r[5]),this.setHSL(o,s,c)}}}else if(n=/^\#([A-Fa-f0-9]+)$/.exec(e)){var u=n[1],l=u.length;if(3===l)return this.r=parseInt(u.charAt(0)+u.charAt(0),16)/255,this.g=parseInt(u.charAt(1)+u.charAt(1),16)/255,this.b=parseInt(u.charAt(2)+u.charAt(2),16)/255,this;if(6===l)return this.r=parseInt(u.charAt(0)+u.charAt(1),16)/255,this.g=parseInt(u.charAt(2)+u.charAt(3),16)/255,this.b=parseInt(u.charAt(4)+u.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this},setColorName:function(e){var t=Qr[e];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(e){return this.r=ni(e.r),this.g=ni(e.g),this.b=ni(e.b),this},copyLinearToSRGB:function(e){return this.r=ri(e.r),this.g=ri(e.g),this.b=ri(e.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,n,r=this.r,i=this.g,a=this.b,o=Math.max(r,i,a),s=Math.min(r,i,a),c=(s+o)/2;if(s===o)t=0,n=0;else{var u=o-s;switch(n=c<=.5?u/(o+s):u/(2-o-s),o){case r:t=(i-a)/u+(i<a?6:0);break;case i:t=(a-r)/u+2;break;case a:t=(r-i)/u+4}t/=6}return e.h=t,e.s=n,e.l=c,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,n){return this.getHSL(Kr),Kr.h+=e,Kr.s+=t,Kr.l+=n,this.setHSL(Kr.h,Kr.s,Kr.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:function(e,t){this.getHSL(Kr),e.getHSL($r);var n=Tn.lerp(Kr.h,$r.h,t),r=Tn.lerp(Kr.s,$r.s,t),i=Tn.lerp(Kr.l,$r.l,t);return this.setHSL(n,r,i),this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}}),ei.NAMES=Qr,Object.assign(ii.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,n=e.vertexColors.length;t<n;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}});var ai=0;function oi(){Object.defineProperty(this,"id",{value:ai++}),this.uuid=Tn.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=T,this.side=v,this.flatShading=!1,this.vertexTangents=!1,this.vertexColors=w,this.opacity=1,this.transparent=!1,this.blendSrc=B,this.blendDst=U,this.blendEquation=P,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Z,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=hn,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Jt,this.stencilZFail=Jt,this.stencilZPass=Jt,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function si(e){oi.call(this),this.type="MeshBasicMaterial",this.color=new ei(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ee,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}oi.prototype=Object.assign(Object.create(wn.prototype),{constructor:oi,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0!==n)if("shading"!==t){var r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===x;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t=void 0===e||"string"===typeof e;t&&(e={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,n.reflectivity=this.reflectivity,n.refractionRatio=this.refractionRatio,void 0!==this.combine&&(n.combine=this.combine),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==T&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),this.side!==v&&(n.side=this.side),this.vertexColors!==w&&(n.vertexColors=this.vertexColors),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){var i=r(e.textures),a=r(e.images);i.length>0&&(n.textures=i),a.length>0&&(n.images=a)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexTangents=e.vertexTangents,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,n=null;if(null!==t){var r=t.length;n=new Array(r);for(var i=0;i!==r;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(oi.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),si.prototype=Object.create(oi.prototype),si.prototype.constructor=si,si.prototype.isMeshBasicMaterial=!0,si.prototype.copy=function(e){return oi.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this};var ci=new kn;function ui(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=fn,this.updateRange={offset:0,count:-1},this.version=0}function li(e,t,n){ui.call(this,new Int8Array(e),t,n)}function hi(e,t,n){ui.call(this,new Uint8Array(e),t,n)}function fi(e,t,n){ui.call(this,new Uint8ClampedArray(e),t,n)}function pi(e,t,n){ui.call(this,new Int16Array(e),t,n)}function di(e,t,n){ui.call(this,new Uint16Array(e),t,n)}function mi(e,t,n){ui.call(this,new Int32Array(e),t,n)}function vi(e,t,n){ui.call(this,new Uint32Array(e),t,n)}function gi(e,t,n){ui.call(this,new Float32Array(e),t,n)}function yi(e,t,n){ui.call(this,new Float64Array(e),t,n)}function xi(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function bi(e){if(0===e.length)return-1/0;for(var t=e[0],n=1,r=e.length;n<r;++n)e[n]>t&&(t=e[n]);return t}Object.defineProperty(ui.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(ui.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this},copyAt:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),a=new ei),t[n++]=a.r,t[n++]=a.g,t[n++]=a.b}return this},copyVector2sArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),a=new Sn),t[n++]=a.x,t[n++]=a.y}return this},copyVector3sArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),a=new kn),t[n++]=a.x,t[n++]=a.y,t[n++]=a.z}return this},copyVector4sArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),a=new Cn),t[n++]=a.x,t[n++]=a.y,t[n++]=a.z,t[n++]=a.w}return this},applyMatrix3:function(e){for(var t=0,n=this.count;t<n;t++)ci.x=this.getX(t),ci.y=this.getY(t),ci.z=this.getZ(t),ci.applyMatrix3(e),this.setXYZ(t,ci.x,ci.y,ci.z);return this},applyMatrix4:function(e){for(var t=0,n=this.count;t<n;t++)ci.x=this.getX(t),ci.y=this.getY(t),ci.z=this.getZ(t),ci.applyMatrix4(e),this.setXYZ(t,ci.x,ci.y,ci.z);return this},applyNormalMatrix:function(e){for(var t=0,n=this.count;t<n;t++)ci.x=this.getX(t),ci.y=this.getY(t),ci.z=this.getZ(t),ci.applyNormalMatrix(e),this.setXYZ(t,ci.x,ci.y,ci.z);return this},transformDirection:function(e){for(var t=0,n=this.count;t<n;t++)ci.x=this.getX(t),ci.y=this.getY(t),ci.z=this.getZ(t),ci.transformDirection(e),this.setXYZ(t,ci.x,ci.y,ci.z);return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this},setXYZ:function(e,t,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this},setXYZW:function(e,t,n,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),li.prototype=Object.create(ui.prototype),li.prototype.constructor=li,hi.prototype=Object.create(ui.prototype),hi.prototype.constructor=hi,fi.prototype=Object.create(ui.prototype),fi.prototype.constructor=fi,pi.prototype=Object.create(ui.prototype),pi.prototype.constructor=pi,di.prototype=Object.create(ui.prototype),di.prototype.constructor=di,mi.prototype=Object.create(ui.prototype),mi.prototype.constructor=mi,vi.prototype=Object.create(ui.prototype),vi.prototype.constructor=vi,gi.prototype=Object.create(ui.prototype),gi.prototype.constructor=gi,yi.prototype=Object.create(ui.prototype),yi.prototype.constructor=yi,Object.assign(xi.prototype,{computeGroups:function(e){for(var t,n=[],r=void 0,i=e.faces,a=0;a<i.length;a++){var o=i[a];o.materialIndex!==r&&(r=o.materialIndex,void 0!==t&&(t.count=3*a-t.start,n.push(t)),t={start:3*a,materialIndex:r})}void 0!==t&&(t.count=3*a-t.start,n.push(t)),this.groups=n},fromGeometry:function(e){var t,n=e.faces,r=e.vertices,i=e.faceVertexUvs,a=i[0]&&i[0].length>0,o=i[1]&&i[1].length>0,s=e.morphTargets,c=s.length;if(c>0){t=[];for(var u=0;u<c;u++)t[u]={name:s[u].name,data:[]};this.morphTargets.position=t}var l,h=e.morphNormals,f=h.length;if(f>0){l=[];for(u=0;u<f;u++)l[u]={name:h[u].name,data:[]};this.morphTargets.normal=l}var p=e.skinIndices,d=e.skinWeights,m=p.length===r.length,v=d.length===r.length;r.length>0&&0===n.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(u=0;u<n.length;u++){var g=n[u];this.vertices.push(r[g.a],r[g.b],r[g.c]);var y=g.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var x=g.normal;this.normals.push(x,x,x)}var b,w=g.vertexColors;if(3===w.length)this.colors.push(w[0],w[1],w[2]);else{var _=g.color;this.colors.push(_,_,_)}if(!0===a)void 0!==(b=i[0][u])?this.uvs.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",u),this.uvs.push(new Sn,new Sn,new Sn));if(!0===o)void 0!==(b=i[1][u])?this.uvs2.push(b[0],b[1],b[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",u),this.uvs2.push(new Sn,new Sn,new Sn));for(var M=0;M<c;M++){var E=s[M].vertices;t[M].data.push(E[g.a],E[g.b],E[g.c])}for(M=0;M<f;M++){var T=h[M].vertexNormals[u];l[M].data.push(T.a,T.b,T.c)}m&&this.skinIndices.push(p[g.a],p[g.b],p[g.c]),v&&this.skinWeights.push(d[g.a],d[g.b],d[g.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this}});var wi=1,_i=new Wn,Mi=new ur,Ei=new kn,Ti=new Er,Si=new Er,Ai=new kn;function Li(){Object.defineProperty(this,"id",{value:wi+=2}),this.uuid=Tn.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}Li.prototype=Object.assign(Object.create(wn.prototype),{constructor:Li,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(bi(e)>65535?vi:di)(e,1):this.index=e},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,this},deleteAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,n){this.groups.push({start:e,count:t,materialIndex:void 0!==n?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix4:function(e){var t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);var n=this.attributes.normal;if(void 0!==n){var r=(new An).getNormalMatrix(e);n.applyNormalMatrix(r),n.needsUpdate=!0}var i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(e){return _i.makeRotationX(e),this.applyMatrix4(_i),this},rotateY:function(e){return _i.makeRotationY(e),this.applyMatrix4(_i),this},rotateZ:function(e){return _i.makeRotationZ(e),this.applyMatrix4(_i),this},translate:function(e,t,n){return _i.makeTranslation(e,t,n),this.applyMatrix4(_i),this},scale:function(e,t,n){return _i.makeScale(e,t,n),this.applyMatrix4(_i),this},lookAt:function(e){return Mi.lookAt(e),Mi.updateMatrix(),this.applyMatrix4(Mi.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ei).negate(),this.translate(Ei.x,Ei.y,Ei.z),this},setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var n=new gi(3*t.vertices.length,3),r=new gi(3*t.colors.length,3);if(this.setAttribute("position",n.copyVector3sArray(t.vertices)),this.setAttribute("color",r.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var i=new gi(t.lineDistances.length,1);this.setAttribute("lineDistance",i.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new gi(t,3)),this},updateFromObject:function(e){var t,n=e.geometry;if(e.isMesh){var r=n.__directGeometry;if(!0===n.elementsNeedUpdate&&(r=void 0,n.elementsNeedUpdate=!1),void 0===r)return this.fromGeometry(n);r.verticesNeedUpdate=n.verticesNeedUpdate,r.normalsNeedUpdate=n.normalsNeedUpdate,r.colorsNeedUpdate=n.colorsNeedUpdate,r.uvsNeedUpdate=n.uvsNeedUpdate,r.groupsNeedUpdate=n.groupsNeedUpdate,n.verticesNeedUpdate=!1,n.normalsNeedUpdate=!1,n.colorsNeedUpdate=!1,n.uvsNeedUpdate=!1,n.groupsNeedUpdate=!1,n=r}return!0===n.verticesNeedUpdate&&(void 0!==(t=this.attributes.position)&&(t.copyVector3sArray(n.vertices),t.needsUpdate=!0),n.verticesNeedUpdate=!1),!0===n.normalsNeedUpdate&&(void 0!==(t=this.attributes.normal)&&(t.copyVector3sArray(n.normals),t.needsUpdate=!0),n.normalsNeedUpdate=!1),!0===n.colorsNeedUpdate&&(void 0!==(t=this.attributes.color)&&(t.copyColorsArray(n.colors),t.needsUpdate=!0),n.colorsNeedUpdate=!1),n.uvsNeedUpdate&&(void 0!==(t=this.attributes.uv)&&(t.copyVector2sArray(n.uvs),t.needsUpdate=!0),n.uvsNeedUpdate=!1),n.lineDistancesNeedUpdate&&(void 0!==(t=this.attributes.lineDistance)&&(t.copyArray(n.lineDistances),t.needsUpdate=!0),n.lineDistancesNeedUpdate=!1),n.groupsNeedUpdate&&(n.computeGroups(e.geometry),this.groups=n.groups,n.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new xi).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.setAttribute("position",new ui(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var n=new Float32Array(3*e.normals.length);this.setAttribute("normal",new ui(n,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var r=new Float32Array(3*e.colors.length);this.setAttribute("color",new ui(r,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var i=new Float32Array(2*e.uvs.length);this.setAttribute("uv",new ui(i,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var a=new Float32Array(2*e.uvs2.length);this.setAttribute("uv2",new ui(a,2).copyVector2sArray(e.uvs2))}for(var o in this.groups=e.groups,e.morphTargets){for(var s=[],c=e.morphTargets[o],u=0,l=c.length;u<l;u++){var h=c[u],f=new gi(3*h.data.length,3);f.name=h.name,s.push(f.copyVector3sArray(h.data))}this.morphAttributes[o]=s}if(e.skinIndices.length>0){var p=new gi(4*e.skinIndices.length,4);this.setAttribute("skinIndex",p.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var d=new gi(4*e.skinWeights.length,4);this.setAttribute("skinWeight",d.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Er);var e=this.attributes.position,t=this.morphAttributes.position;if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(var n=0,r=t.length;n<r;n++){var i=t[n];Ti.setFromBufferAttribute(i),this.morphTargetsRelative?(Ai.addVectors(this.boundingBox.min,Ti.min),this.boundingBox.expandByPoint(Ai),Ai.addVectors(this.boundingBox.max,Ti.max),this.boundingBox.expandByPoint(Ai)):(this.boundingBox.expandByPoint(Ti.min),this.boundingBox.expandByPoint(Ti.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Ar);var e=this.attributes.position,t=this.morphAttributes.position;if(e){var n=this.boundingSphere.center;if(Ti.setFromBufferAttribute(e),t)for(var r=0,i=t.length;r<i;r++){var a=t[r];Si.setFromBufferAttribute(a),this.morphTargetsRelative?(Ai.addVectors(Ti.min,Si.min),Ti.expandByPoint(Ai),Ai.addVectors(Ti.max,Si.max),Ti.expandByPoint(Ai)):(Ti.expandByPoint(Si.min),Ti.expandByPoint(Si.max))}Ti.getCenter(n);var o=0;for(r=0,i=e.count;r<i;r++)Ai.fromBufferAttribute(e,r),o=Math.max(o,n.distanceToSquared(Ai));if(t)for(r=0,i=t.length;r<i;r++){a=t[r];for(var s=this.morphTargetsRelative,c=0,u=a.count;c<u;c++)Ai.fromBufferAttribute(a,c),s&&(Ei.fromBufferAttribute(e,c),Ai.add(Ei)),o=Math.max(o,n.distanceToSquared(Ai))}this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes;if(t.position){var n=t.position.array;if(void 0===t.normal)this.setAttribute("normal",new ui(new Float32Array(n.length),3));else for(var r=t.normal.array,i=0,a=r.length;i<a;i++)r[i]=0;var o,s,c,u=t.normal.array,l=new kn,h=new kn,f=new kn,p=new kn,d=new kn;if(e){var m=e.array;for(i=0,a=e.count;i<a;i+=3)o=3*m[i+0],s=3*m[i+1],c=3*m[i+2],l.fromArray(n,o),h.fromArray(n,s),f.fromArray(n,c),p.subVectors(f,h),d.subVectors(l,h),p.cross(d),u[o]+=p.x,u[o+1]+=p.y,u[o+2]+=p.z,u[s]+=p.x,u[s+1]+=p.y,u[s+2]+=p.z,u[c]+=p.x,u[c+1]+=p.y,u[c+2]+=p.z}else for(i=0,a=n.length;i<a;i+=9)l.fromArray(n,i),h.fromArray(n,i+3),f.fromArray(n,i+6),p.subVectors(f,h),d.subVectors(l,h),p.cross(d),u[i]=p.x,u[i+1]=p.y,u[i+2]=p.z,u[i+3]=p.x,u[i+4]=p.y,u[i+5]=p.z,u[i+6]=p.x,u[i+7]=p.y,u[i+8]=p.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(var r in n)if(void 0!==e.attributes[r])for(var i=n[r].array,a=e.attributes[r],o=a.array,s=a.itemSize*t,c=Math.min(o.length,i.length-s),u=0,l=s;u<c;u++,l++)i[l]=o[u];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){for(var e=this.attributes.normal,t=0,n=e.count;t<n;t++)Ai.x=e.getX(t),Ai.y=e.getY(t),Ai.z=e.getZ(t),Ai.normalize(),e.setXYZ(t,Ai.x,Ai.y,Ai.z)},toNonIndexed:function(){function e(e,t){for(var n=e.array,r=e.itemSize,i=new n.constructor(t.length*r),a=0,o=0,s=0,c=t.length;s<c;s++){a=t[s]*r;for(var u=0;u<r;u++)i[o++]=n[a++]}return new ui(i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new Li,n=this.index.array,r=this.attributes;for(var i in r){var a=e(r[i],n);t.setAttribute(i,a)}var o=this.morphAttributes;for(i in o){for(var s=[],c=o[i],u=0,l=c.length;u<l;u++){a=e(c[u],n);s.push(a)}t.morphAttributes[i]=s}t.morphTargetsRelative=this.morphTargetsRelative;for(var h=this.groups,f=(u=0,h.length);u<f;u++){var p=h[u];t.addGroup(p.start,p.count,p.materialIndex)}return t},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};var r=this.index;null!==r&&(e.data.index={type:r.array.constructor.name,array:Array.prototype.slice.call(r.array)});var i=this.attributes;for(var n in i){var a=(f=i[n]).toJSON();""!==f.name&&(a.name=f.name),e.data.attributes[n]=a}var o={},s=!1;for(var n in this.morphAttributes){for(var c=this.morphAttributes[n],u=[],l=0,h=c.length;l<h;l++){var f;a=(f=c[l]).toJSON();""!==f.name&&(a.name=f.name),u.push(a)}u.length>0&&(o[n]=u,s=!0)}s&&(e.data.morphAttributes=o,e.data.morphTargetsRelative=this.morphTargetsRelative);var p=this.groups;p.length>0&&(e.data.groups=JSON.parse(JSON.stringify(p)));var d=this.boundingSphere;return null!==d&&(e.data.boundingSphere={center:d.center.toArray(),radius:d.radius}),e},clone:function(){return(new Li).copy(this)},copy:function(e){var t,n,r;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var i=e.index;null!==i&&this.setIndex(i.clone());var a=e.attributes;for(t in a){var o=a[t];this.setAttribute(t,o.clone())}var s=e.morphAttributes;for(t in s){var c=[],u=s[t];for(n=0,r=u.length;n<r;n++)c.push(u[n].clone());this.morphAttributes[t]=c}this.morphTargetsRelative=e.morphTargetsRelative;var l=e.groups;for(n=0,r=l.length;n<r;n++){var h=l[n];this.addGroup(h.start,h.count,h.materialIndex)}var f=e.boundingBox;null!==f&&(this.boundingBox=f.clone());var p=e.boundingSphere;return null!==p&&(this.boundingSphere=p.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Ri=new Wn,Pi=new Nr,Ci=new Ar,Oi=new kn,Di=new kn,Ii=new kn,Ni=new kn,zi=new kn,ki=new kn,Fi=new kn,Bi=new kn,Ui=new kn,Hi=new Sn,Gi=new Sn,ji=new Sn,Vi=new kn,Wi=new kn;function qi(e,t){ur.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new Li,this.material=void 0!==t?t:new si,this.updateMorphTargets()}function Yi(e,t,n,r,i,a,o,s){if(null===(t.side===g?r.intersectTriangle(o,a,i,!0,s):r.intersectTriangle(i,a,o,t.side!==y,s)))return null;Wi.copy(s),Wi.applyMatrix4(e.matrixWorld);var c=n.ray.origin.distanceTo(Wi);return c<n.near||c>n.far?null:{distance:c,point:Wi.clone(),object:e}}function Xi(e,t,n,r,i,a,o,s,c,u,l,h){Oi.fromBufferAttribute(i,u),Di.fromBufferAttribute(i,l),Ii.fromBufferAttribute(i,h);var f=e.morphTargetInfluences;if(t.morphTargets&&a&&f){Fi.set(0,0,0),Bi.set(0,0,0),Ui.set(0,0,0);for(var p=0,d=a.length;p<d;p++){var m=f[p],v=a[p];0!==m&&(Ni.fromBufferAttribute(v,u),zi.fromBufferAttribute(v,l),ki.fromBufferAttribute(v,h),o?(Fi.addScaledVector(Ni,m),Bi.addScaledVector(zi,m),Ui.addScaledVector(ki,m)):(Fi.addScaledVector(Ni.sub(Oi),m),Bi.addScaledVector(zi.sub(Di),m),Ui.addScaledVector(ki.sub(Ii),m)))}Oi.add(Fi),Di.add(Bi),Ii.add(Ui)}var g=Yi(e,t,n,r,Oi,Di,Ii,Vi);if(g){s&&(Hi.fromBufferAttribute(s,u),Gi.fromBufferAttribute(s,l),ji.fromBufferAttribute(s,h),g.uv=Jr.getUV(Vi,Oi,Di,Ii,Hi,Gi,ji,new Sn)),c&&(Hi.fromBufferAttribute(c,u),Gi.fromBufferAttribute(c,l),ji.fromBufferAttribute(c,h),g.uv2=Jr.getUV(Vi,Oi,Di,Ii,Hi,Gi,ji,new Sn));var y=new ii(u,l,h);Jr.getNormal(Oi,Di,Ii,y.normal),g.face=y}return g}qi.prototype=Object.assign(Object.create(ur.prototype),{constructor:qi,isMesh:!0,copy:function(e){return ur.prototype.copy.call(this,e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e,t,n,r=this.geometry;if(r.isBufferGeometry){var i=r.morphAttributes,a=Object.keys(i);if(a.length>0){var o=i[a[0]];if(void 0!==o)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=o.length;e<t;e++)n=o[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}else{var s=r.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(e,t){var n,r=this.geometry,i=this.material,a=this.matrixWorld;if(void 0!==i&&(null===r.boundingSphere&&r.computeBoundingSphere(),Ci.copy(r.boundingSphere),Ci.applyMatrix4(a),!1!==e.ray.intersectsSphere(Ci)&&(Ri.getInverse(a),Pi.copy(e.ray).applyMatrix4(Ri),null===r.boundingBox||!1!==Pi.intersectsBox(r.boundingBox))))if(r.isBufferGeometry){var o,s,c,u,l,h,f,p,d,m=r.index,v=r.attributes.position,g=r.morphAttributes.position,y=r.morphTargetsRelative,x=r.attributes.uv,b=r.attributes.uv2,w=r.groups,_=r.drawRange;if(null!==m)if(Array.isArray(i))for(u=0,h=w.length;u<h;u++)for(d=i[(p=w[u]).materialIndex],l=Math.max(p.start,_.start),f=Math.min(p.start+p.count,_.start+_.count);l<f;l+=3)o=m.getX(l),s=m.getX(l+1),c=m.getX(l+2),(n=Xi(this,d,e,Pi,v,g,y,x,b,o,s,c))&&(n.faceIndex=Math.floor(l/3),n.face.materialIndex=p.materialIndex,t.push(n));else for(u=Math.max(0,_.start),h=Math.min(m.count,_.start+_.count);u<h;u+=3)o=m.getX(u),s=m.getX(u+1),c=m.getX(u+2),(n=Xi(this,i,e,Pi,v,g,y,x,b,o,s,c))&&(n.faceIndex=Math.floor(u/3),t.push(n));else if(void 0!==v)if(Array.isArray(i))for(u=0,h=w.length;u<h;u++)for(d=i[(p=w[u]).materialIndex],l=Math.max(p.start,_.start),f=Math.min(p.start+p.count,_.start+_.count);l<f;l+=3)(n=Xi(this,d,e,Pi,v,g,y,x,b,o=l,s=l+1,c=l+2))&&(n.faceIndex=Math.floor(l/3),n.face.materialIndex=p.materialIndex,t.push(n));else for(u=Math.max(0,_.start),h=Math.min(v.count,_.start+_.count);u<h;u+=3)(n=Xi(this,i,e,Pi,v,g,y,x,b,o=u,s=u+1,c=u+2))&&(n.faceIndex=Math.floor(u/3),t.push(n))}else if(r.isGeometry){var M,E,T,S,A=Array.isArray(i),L=r.vertices,R=r.faces,P=r.faceVertexUvs[0];P.length>0&&(S=P);for(var C=0,O=R.length;C<O;C++){var D=R[C],I=A?i[D.materialIndex]:i;if(void 0!==I&&(M=L[D.a],E=L[D.b],T=L[D.c],n=Yi(this,I,e,Pi,M,E,T,Vi))){if(S&&S[C]){var N=S[C];Hi.copy(N[0]),Gi.copy(N[1]),ji.copy(N[2]),n.uv=Jr.getUV(Vi,M,E,T,Hi,Gi,ji,new Sn)}n.face=D,n.faceIndex=C,t.push(n)}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Zi=0,Ji=new Wn,Qi=new ur,Ki=new kn;function $i(){Object.defineProperty(this,"id",{value:Zi+=2}),this.uuid=Tn.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}$i.prototype=Object.assign(Object.create(wn.prototype),{constructor:$i,isGeometry:!0,applyMatrix4:function(e){for(var t=(new An).getNormalMatrix(e),n=0,r=this.vertices.length;n<r;n++){this.vertices[n].applyMatrix4(e)}for(n=0,r=this.faces.length;n<r;n++){var i=this.faces[n];i.normal.applyMatrix3(t).normalize();for(var a=0,o=i.vertexNormals.length;a<o;a++)i.vertexNormals[a].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(e){return Ji.makeRotationX(e),this.applyMatrix4(Ji),this},rotateY:function(e){return Ji.makeRotationY(e),this.applyMatrix4(Ji),this},rotateZ:function(e){return Ji.makeRotationZ(e),this.applyMatrix4(Ji),this},translate:function(e,t,n){return Ji.makeTranslation(e,t,n),this.applyMatrix4(Ji),this},scale:function(e,t,n){return Ji.makeScale(e,t,n),this.applyMatrix4(Ji),this},lookAt:function(e){return Qi.lookAt(e),Qi.updateMatrix(),this.applyMatrix4(Qi.matrix),this},fromBufferGeometry:function(e){var t=this,n=null!==e.index?e.index.array:void 0,r=e.attributes;if(void 0===r.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var i=r.position.array,a=void 0!==r.normal?r.normal.array:void 0,o=void 0!==r.color?r.color.array:void 0,s=void 0!==r.uv?r.uv.array:void 0,c=void 0!==r.uv2?r.uv2.array:void 0;void 0!==c&&(this.faceVertexUvs[1]=[]);for(var u=0;u<i.length;u+=3)t.vertices.push((new kn).fromArray(i,u)),void 0!==o&&t.colors.push((new ei).fromArray(o,u));function l(e,n,r,i){var u=void 0===o?[]:[t.colors[e].clone(),t.colors[n].clone(),t.colors[r].clone()],l=new ii(e,n,r,void 0===a?[]:[(new kn).fromArray(a,3*e),(new kn).fromArray(a,3*n),(new kn).fromArray(a,3*r)],u,i);t.faces.push(l),void 0!==s&&t.faceVertexUvs[0].push([(new Sn).fromArray(s,2*e),(new Sn).fromArray(s,2*n),(new Sn).fromArray(s,2*r)]),void 0!==c&&t.faceVertexUvs[1].push([(new Sn).fromArray(c,2*e),(new Sn).fromArray(c,2*n),(new Sn).fromArray(c,2*r)])}var h=e.groups;if(h.length>0)for(u=0;u<h.length;u++)for(var f=h[u],p=f.start,d=p,m=p+f.count;d<m;d+=3)void 0!==n?l(n[d],n[d+1],n[d+2],f.materialIndex):l(d,d+1,d+2,f.materialIndex);else if(void 0!==n)for(u=0;u<n.length;u+=3)l(n[u],n[u+1],n[u+2]);else for(u=0;u<i.length/3;u+=3)l(u,u+1,u+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ki).negate(),this.translate(Ki.x,Ki.y,Ki.z),this},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,n=0===t?1:1/t,r=new Wn;return r.set(n,0,0,-n*e.x,0,n,0,-n*e.y,0,0,n,-n*e.z,0,0,0,1),this.applyMatrix4(r),this},computeFaceNormals:function(){for(var e=new kn,t=new kn,n=0,r=this.faces.length;n<r;n++){var i=this.faces[n],a=this.vertices[i.a],o=this.vertices[i.b],s=this.vertices[i.c];e.subVectors(s,o),t.subVectors(a,o),e.cross(t),e.normalize(),i.normal.copy(e)}},computeVertexNormals:function(e){var t,n,r,i,a,o;for(void 0===e&&(e=!0),o=new Array(this.vertices.length),t=0,n=this.vertices.length;t<n;t++)o[t]=new kn;if(e){var s,c,u,l=new kn,h=new kn;for(r=0,i=this.faces.length;r<i;r++)a=this.faces[r],s=this.vertices[a.a],c=this.vertices[a.b],u=this.vertices[a.c],l.subVectors(u,c),h.subVectors(s,c),l.cross(h),o[a.a].add(l),o[a.b].add(l),o[a.c].add(l)}else for(this.computeFaceNormals(),r=0,i=this.faces.length;r<i;r++)o[(a=this.faces[r]).a].add(a.normal),o[a.b].add(a.normal),o[a.c].add(a.normal);for(t=0,n=this.vertices.length;t<n;t++)o[t].normalize();for(r=0,i=this.faces.length;r<i;r++){var f=(a=this.faces[r]).vertexNormals;3===f.length?(f[0].copy(o[a.a]),f[1].copy(o[a.b]),f[2].copy(o[a.c])):(f[0]=o[a.a].clone(),f[1]=o[a.b].clone(),f[2]=o[a.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,n;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){var r=(n=this.faces[e]).vertexNormals;3===r.length?(r[0].copy(n.normal),r[1].copy(n.normal),r[2].copy(n.normal)):(r[0]=n.normal.clone(),r[1]=n.normal.clone(),r[2]=n.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,n,r,i;for(n=0,r=this.faces.length;n<r;n++)for((i=this.faces[n]).__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),e=0,t=i.vertexNormals.length;e<t;e++)i.__originalVertexNormals[e]?i.__originalVertexNormals[e].copy(i.vertexNormals[e]):i.__originalVertexNormals[e]=i.vertexNormals[e].clone();var a=new $i;for(a.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var o=this.morphNormals[e].faceNormals,s=this.morphNormals[e].vertexNormals;for(n=0,r=this.faces.length;n<r;n++)c=new kn,u={a:new kn,b:new kn,c:new kn},o.push(c),s.push(u)}var c,u,l=this.morphNormals[e];for(a.vertices=this.morphTargets[e].vertices,a.computeFaceNormals(),a.computeVertexNormals(),n=0,r=this.faces.length;n<r;n++)i=this.faces[n],c=l.faceNormals[n],u=l.vertexNormals[n],c.copy(i.normal),u.a.copy(i.vertexNormals[0]),u.b.copy(i.vertexNormals[1]),u.c.copy(i.vertexNormals[2])}for(n=0,r=this.faces.length;n<r;n++)(i=this.faces[n]).normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Er),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Ar),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,n){if(e&&e.isGeometry){var r,i=this.vertices.length,a=this.vertices,o=e.vertices,s=this.faces,c=e.faces,u=this.colors,l=e.colors;void 0===n&&(n=0),void 0!==t&&(r=(new An).getNormalMatrix(t));for(var h=0,f=o.length;h<f;h++){var p=o[h].clone();void 0!==t&&p.applyMatrix4(t),a.push(p)}for(h=0,f=l.length;h<f;h++)u.push(l[h].clone());for(h=0,f=c.length;h<f;h++){var d,m,v,g=c[h],y=g.vertexNormals,x=g.vertexColors;(d=new ii(g.a+i,g.b+i,g.c+i)).normal.copy(g.normal),void 0!==r&&d.normal.applyMatrix3(r).normalize();for(var b=0,w=y.length;b<w;b++)m=y[b].clone(),void 0!==r&&m.applyMatrix3(r).normalize(),d.vertexNormals.push(m);d.color.copy(g.color);for(b=0,w=x.length;b<w;b++)v=x[b],d.vertexColors.push(v.clone());d.materialIndex=g.materialIndex+n,s.push(d)}for(h=0,f=e.faceVertexUvs.length;h<f;h++){var _=e.faceVertexUvs[h];void 0===this.faceVertexUvs[h]&&(this.faceVertexUvs[h]=[]);for(b=0,w=_.length;b<w;b++){for(var M=_[b],E=[],T=0,S=M.length;T<S;T++)E.push(M[T].clone());this.faceVertexUvs[h].push(E)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t,n,r,i,a,o,s,c={},u=[],l=[],h=Math.pow(10,4);for(n=0,r=this.vertices.length;n<r;n++)e=this.vertices[n],void 0===c[t=Math.round(e.x*h)+"_"+Math.round(e.y*h)+"_"+Math.round(e.z*h)]?(c[t]=n,u.push(this.vertices[n]),l[n]=u.length-1):l[n]=l[c[t]];var f=[];for(n=0,r=this.faces.length;n<r;n++){(i=this.faces[n]).a=l[i.a],i.b=l[i.b],i.c=l[i.c],a=[i.a,i.b,i.c];for(var p=0;p<3;p++)if(a[p]===a[(p+1)%3]){f.push(n);break}}for(n=f.length-1;n>=0;n--){var d=f[n];for(this.faces.splice(d,1),o=0,s=this.faceVertexUvs.length;o<s;o++)this.faceVertexUvs[o].splice(d,1)}var m=this.vertices.length-u.length;return this.vertices=u,m},setFromPoints:function(e){this.vertices=[];for(var t=0,n=e.length;t<n;t++){var r=e[t];this.vertices.push(new kn(r.x,r.y,r.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,n=0;n<t;n++)e[n]._id=n;e.sort((function(e,t){return e.materialIndex-t.materialIndex}));var r,i,a=this.faceVertexUvs[0],o=this.faceVertexUvs[1];a&&a.length===t&&(r=[]),o&&o.length===t&&(i=[]);for(n=0;n<t;n++){var s=e[n]._id;r&&r.push(a[s]),i&&i.push(o[s])}r&&(this.faceVertexUvs[0]=r),i&&(this.faceVertexUvs[1]=i)},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}for(var r=[],i=0;i<this.vertices.length;i++){var a=this.vertices[i];r.push(a.x,a.y,a.z)}var o=[],s=[],c={},u=[],l={},h=[],f={};for(i=0;i<this.faces.length;i++){var p=this.faces[i],d=void 0!==this.faceVertexUvs[0][i],m=p.normal.length()>0,v=p.vertexNormals.length>0,g=1!==p.color.r||1!==p.color.g||1!==p.color.b,y=p.vertexColors.length>0,x=0;if(x=M(x,0,0),x=M(x,1,!0),x=M(x,2,!1),x=M(x,3,d),x=M(x,4,m),x=M(x,5,v),x=M(x,6,g),x=M(x,7,y),o.push(x),o.push(p.a,p.b,p.c),o.push(p.materialIndex),d){var b=this.faceVertexUvs[0][i];o.push(S(b[0]),S(b[1]),S(b[2]))}if(m&&o.push(E(p.normal)),v){var w=p.vertexNormals;o.push(E(w[0]),E(w[1]),E(w[2]))}if(g&&o.push(T(p.color)),y){var _=p.vertexColors;o.push(T(_[0]),T(_[1]),T(_[2]))}}function M(e,t,n){return n?e|1<<t:e&~(1<<t)}function E(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==c[t]||(c[t]=s.length/3,s.push(e.x,e.y,e.z)),c[t]}function T(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==l[t]||(l[t]=u.length,u.push(e.getHex())),l[t]}function S(e){var t=e.x.toString()+e.y.toString();return void 0!==f[t]||(f[t]=h.length/2,h.push(e.x,e.y)),f[t]}return e.data={},e.data.vertices=r,e.data.normals=s,u.length>0&&(e.data.colors=u),h.length>0&&(e.data.uvs=[h]),e.data.faces=o,e},clone:function(){return(new $i).copy(this)},copy:function(e){var t,n,r,i,a,o;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var s=e.vertices;for(t=0,n=s.length;t<n;t++)this.vertices.push(s[t].clone());var c=e.colors;for(t=0,n=c.length;t<n;t++)this.colors.push(c[t].clone());var u=e.faces;for(t=0,n=u.length;t<n;t++)this.faces.push(u[t].clone());for(t=0,n=e.faceVertexUvs.length;t<n;t++){var l=e.faceVertexUvs[t];for(void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]),r=0,i=l.length;r<i;r++){var h=l[r],f=[];for(a=0,o=h.length;a<o;a++){var p=h[a];f.push(p.clone())}this.faceVertexUvs[t].push(f)}}var d=e.morphTargets;for(t=0,n=d.length;t<n;t++){var m={};if(m.name=d[t].name,void 0!==d[t].vertices)for(m.vertices=[],r=0,i=d[t].vertices.length;r<i;r++)m.vertices.push(d[t].vertices[r].clone());if(void 0!==d[t].normals)for(m.normals=[],r=0,i=d[t].normals.length;r<i;r++)m.normals.push(d[t].normals[r].clone());this.morphTargets.push(m)}var v=e.morphNormals;for(t=0,n=v.length;t<n;t++){var g={};if(void 0!==v[t].vertexNormals)for(g.vertexNormals=[],r=0,i=v[t].vertexNormals.length;r<i;r++){var y=v[t].vertexNormals[r],x={};x.a=y.a.clone(),x.b=y.b.clone(),x.c=y.c.clone(),g.vertexNormals.push(x)}if(void 0!==v[t].faceNormals)for(g.faceNormals=[],r=0,i=v[t].faceNormals.length;r<i;r++)g.faceNormals.push(v[t].faceNormals[r].clone());this.morphNormals.push(g)}var b=e.skinWeights;for(t=0,n=b.length;t<n;t++)this.skinWeights.push(b[t].clone());var w=e.skinIndices;for(t=0,n=w.length;t<n;t++)this.skinIndices.push(w[t].clone());var _=e.lineDistances;for(t=0,n=_.length;t<n;t++)this.lineDistances.push(_[t]);var M=e.boundingBox;null!==M&&(this.boundingBox=M.clone());var E=e.boundingSphere;return null!==E&&(this.boundingSphere=E.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});class ea extends $i{constructor(e,t,n,r,i,a){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:a},this.fromBufferGeometry(new ta(e,t,n,r,i,a)),this.mergeVertices()}}class ta extends Li{constructor(e,t,n,r,i,a){super(),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:a};var o=this;e=e||1,t=t||1,n=n||1,r=Math.floor(r)||1,i=Math.floor(i)||1,a=Math.floor(a)||1;var s=[],c=[],u=[],l=[],h=0,f=0;function p(e,t,n,r,i,a,p,d,m,v,g){var y,x,b=a/m,w=p/v,_=a/2,M=p/2,E=d/2,T=m+1,S=v+1,A=0,L=0,R=new kn;for(x=0;x<S;x++){var P=x*w-M;for(y=0;y<T;y++){var C=y*b-_;R[e]=C*r,R[t]=P*i,R[n]=E,c.push(R.x,R.y,R.z),R[e]=0,R[t]=0,R[n]=d>0?1:-1,u.push(R.x,R.y,R.z),l.push(y/m),l.push(1-x/v),A+=1}}for(x=0;x<v;x++)for(y=0;y<m;y++){var O=h+y+T*x,D=h+y+T*(x+1),I=h+(y+1)+T*(x+1),N=h+(y+1)+T*x;s.push(O,D,N),s.push(D,I,N),L+=6}o.addGroup(f,L,g),f+=L,h+=A}p("z","y","x",-1,-1,n,t,e,a,i,0),p("z","y","x",1,-1,n,t,-e,a,i,1),p("x","z","y",1,1,e,n,t,r,a,2),p("x","z","y",1,-1,e,n,-t,r,a,3),p("x","y","z",1,-1,e,t,n,r,i,4),p("x","y","z",-1,-1,e,t,-n,r,i,5),this.setIndex(s),this.setAttribute("position",new gi(c,3)),this.setAttribute("normal",new gi(u,3)),this.setAttribute("uv",new gi(l,2))}}function na(e){var t={};for(var n in e)for(var r in t[n]={},e[n]){var i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}return t}function ra(e){for(var t={},n=0;n<e.length;n++){var r=na(e[n]);for(var i in r)t[i]=r[i]}return t}var ia={clone:na,merge:ra};function aa(e){oi.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function oa(){ur.call(this),this.type="Camera",this.matrixWorldInverse=new Wn,this.projectionMatrix=new Wn,this.projectionMatrixInverse=new Wn}function sa(e,t,n,r){oa.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==n?n:.1,this.far=void 0!==r?r:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}aa.prototype=Object.create(oi.prototype),aa.prototype.constructor=aa,aa.prototype.isShaderMaterial=!0,aa.prototype.copy=function(e){return oi.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=na(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},aa.prototype.toJSON=function(e){var t=oi.prototype.toJSON.call(this,e);for(var n in t.uniforms={},this.uniforms){var r=this.uniforms[n].value;r&&r.isTexture?t.uniforms[n]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[n]={type:"m4",value:r.toArray()}:t.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var i={};for(var a in this.extensions)!0===this.extensions[a]&&(i[a]=!0);return Object.keys(i).length>0&&(t.extensions=i),t},oa.prototype=Object.assign(Object.create(ur.prototype),{constructor:oa,isCamera:!0,copy:function(e,t){return ur.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new kn),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){ur.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(e,t){ur.prototype.updateWorldMatrix.call(this,e,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),sa.prototype=Object.assign(Object.create(oa.prototype),{constructor:sa,isPerspectiveCamera:!0,copy:function(e,t){return oa.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*Tn.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*Tn.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*Tn.RAD2DEG*Math.atan(Math.tan(.5*Tn.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,n,r,i,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*Tn.DEG2RAD*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r,a=this.view;if(null!==this.view&&this.view.enabled){var o=a.fullWidth,s=a.fullHeight;i+=a.offsetX*r/o,t-=a.offsetY*n/s,r*=a.width/o,n*=a.height/s}var c=this.filmOffset;0!==c&&(i+=e*c/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=ur.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}});function ca(e,t,n,r){ur.call(this),this.type="CubeCamera";var i=new sa(90,1,e,t);i.up.set(0,-1,0),i.lookAt(new kn(1,0,0)),this.add(i);var a=new sa(90,1,e,t);a.up.set(0,-1,0),a.lookAt(new kn(-1,0,0)),this.add(a);var o=new sa(90,1,e,t);o.up.set(0,0,1),o.lookAt(new kn(0,1,0)),this.add(o);var s=new sa(90,1,e,t);s.up.set(0,0,-1),s.lookAt(new kn(0,-1,0)),this.add(s);var c=new sa(90,1,e,t);c.up.set(0,-1,0),c.lookAt(new kn(0,0,1)),this.add(c);var u=new sa(90,1,e,t);u.up.set(0,-1,0),u.lookAt(new kn(0,0,-1)),this.add(u),r=r||{format:je,magFilter:Te,minFilter:Te},this.renderTarget=new ua(n,r),this.renderTarget.texture.name="CubeCamera",this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var n=e.getRenderTarget(),r=this.renderTarget,l=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0),e.render(t,i),e.setRenderTarget(r,1),e.render(t,a),e.setRenderTarget(r,2),e.render(t,o),e.setRenderTarget(r,3),e.render(t,s),e.setRenderTarget(r,4),e.render(t,c),r.texture.generateMipmaps=l,e.setRenderTarget(r,5),e.render(t,u),e.setRenderTarget(n)},this.clear=function(e,t,n,r){for(var i=e.getRenderTarget(),a=this.renderTarget,o=0;o<6;o++)e.setRenderTarget(a,o),e.clear(t,n,r);e.setRenderTarget(i)}}function ua(e,t,n){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=n),On.call(this,e,e,t)}function la(e,t,n,r,i,a,o,s,c,u,l,h){Pn.call(this,null,a,o,s,c,u,r,i,l,h),this.image={data:e||null,width:t||1,height:n||1},this.magFilter=void 0!==c?c:be,this.minFilter=void 0!==u?u:be,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}ca.prototype=Object.create(ur.prototype),ca.prototype.constructor=ca,ua.prototype=Object.create(On.prototype),ua.prototype.constructor=ua,ua.prototype.isWebGLCubeRenderTarget=!0,ua.prototype.fromEquirectangularTexture=function(e,t){this.texture.type=t.type,this.texture.format=t.format,this.texture.encoding=t.encoding;var n=new lr,r={uniforms:{tEquirect:{value:null}},vertexShader:["varying vec3 vWorldDirection;","vec3 transformDirection( in vec3 dir, in mat4 matrix ) {","\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );","}","void main() {","\tvWorldDirection = transformDirection( position, modelMatrix );","\t#include <begin_vertex>","\t#include <project_vertex>","}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","varying vec3 vWorldDirection;","#define RECIPROCAL_PI 0.31830988618","#define RECIPROCAL_PI2 0.15915494","void main() {","\tvec3 direction = normalize( vWorldDirection );","\tvec2 sampleUV;","\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;","\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","\tgl_FragColor = texture2D( tEquirect, sampleUV );","}"].join("\n")},i=new aa({type:"CubemapFromEquirect",uniforms:na(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:g,blending:E});i.uniforms.tEquirect.value=t;var a=new qi(new ta(5,5,5),i);n.add(a);var o=new ca(1,10,1);return o.renderTarget=this,o.renderTarget.texture.name="CubeCameraTexture",o.update(e,n),a.geometry.dispose(),a.material.dispose(),this},la.prototype=Object.create(Pn.prototype),la.prototype.constructor=la,la.prototype.isDataTexture=!0;var ha=new Ar,fa=new kn;function pa(e,t,n,r,i,a){this.planes=[void 0!==e?e:new Br,void 0!==t?t:new Br,void 0!==n?n:new Br,void 0!==r?r:new Br,void 0!==i?i:new Br,void 0!==a?a:new Br]}Object.assign(pa.prototype,{set:function(e,t,n,r,i,a){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(a),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,n=0;n<6;n++)t[n].copy(e.planes[n]);return this},setFromProjectionMatrix:function(e){var t=this.planes,n=e.elements,r=n[0],i=n[1],a=n[2],o=n[3],s=n[4],c=n[5],u=n[6],l=n[7],h=n[8],f=n[9],p=n[10],d=n[11],m=n[12],v=n[13],g=n[14],y=n[15];return t[0].setComponents(o-r,l-s,d-h,y-m).normalize(),t[1].setComponents(o+r,l+s,d+h,y+m).normalize(),t[2].setComponents(o+i,l+c,d+f,y+v).normalize(),t[3].setComponents(o-i,l-c,d-f,y-v).normalize(),t[4].setComponents(o-a,l-u,d-p,y-g).normalize(),t[5].setComponents(o+a,l+u,d+p,y+g).normalize(),this},intersectsObject:function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),ha.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(ha)},intersectsSprite:function(e){return ha.center.set(0,0,0),ha.radius=.7071067811865476,ha.applyMatrix4(e.matrixWorld),this.intersectsSphere(ha)},intersectsSphere:function(e){for(var t=this.planes,n=e.center,r=-e.radius,i=0;i<6;i++){if(t[i].distanceToPoint(n)<r)return!1}return!0},intersectsBox:function(e){for(var t=this.planes,n=0;n<6;n++){var r=t[n];if(fa.x=r.normal.x>0?e.max.x:e.min.x,fa.y=r.normal.y>0?e.max.y:e.min.y,fa.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(fa)<0)return!1}return!0},containsPoint:function(e){for(var t=this.planes,n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}});var da={common:{diffuse:{value:new ei(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new An},uv2Transform:{value:new An},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Sn(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ei(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new ei(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new An}},sprite:{diffuse:{value:new ei(15658734)},opacity:{value:1},center:{value:new Sn(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new An}}};function ma(){var e=null,t=!1,n=null;function r(i,a){!1!==t&&(n(i,a),e.requestAnimationFrame(r))}return{start:function(){!0!==t&&null!==n&&(e.requestAnimationFrame(r),t=!0)},stop:function(){t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function va(e,t){var n=t.isWebGL2,r=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),r.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);var n=r.get(t);n&&(e.deleteBuffer(n.buffer),r.delete(t))},update:function(t,i){t.isInterleavedBufferAttribute&&(t=t.data);var a=r.get(t);void 0===a?r.set(t,function(t,n){var r=t.array,i=t.usage,a=e.createBuffer();e.bindBuffer(n,a),e.bufferData(n,r,i),t.onUploadCallback();var o=5126;return r instanceof Float32Array?o=5126:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?o=5123:r instanceof Int16Array?o=5122:r instanceof Uint32Array?o=5125:r instanceof Int32Array?o=5124:r instanceof Int8Array?o=5120:r instanceof Uint8Array&&(o=5121),{buffer:a,type:o,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}(t,i)):a.version<t.version&&(!function(t,r,i){var a=r.array,o=r.updateRange;e.bindBuffer(i,t),-1===o.count?e.bufferSubData(i,0,a):(n?e.bufferSubData(i,o.offset*a.BYTES_PER_ELEMENT,a,o.offset,o.count):e.bufferSubData(i,o.offset*a.BYTES_PER_ELEMENT,a.subarray(o.offset,o.offset+o.count)),o.count=-1)}(a.buffer,t,i),a.version=t.version)}}}function ga(e,t,n,r){$i.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r},this.fromBufferGeometry(new ya(e,t,n,r)),this.mergeVertices()}function ya(e,t,n,r){Li.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};var i,a,o=(e=e||1)/2,s=(t=t||1)/2,c=Math.floor(n)||1,u=Math.floor(r)||1,l=c+1,h=u+1,f=e/c,p=t/u,d=[],m=[],v=[],g=[];for(a=0;a<h;a++){var y=a*p-s;for(i=0;i<l;i++){var x=i*f-o;m.push(x,-y,0),v.push(0,0,1),g.push(i/c),g.push(1-a/u)}}for(a=0;a<u;a++)for(i=0;i<c;i++){var b=i+l*a,w=i+l*(a+1),_=i+1+l*(a+1),M=i+1+l*a;d.push(b,w,M),d.push(w,_,M)}this.setIndex(d),this.setAttribute("position",new gi(m,3)),this.setAttribute("normal",new gi(v,3)),this.setAttribute("uv",new gi(g,2))}ga.prototype=Object.create($i.prototype),ga.prototype.constructor=ga,ya.prototype=Object.create(Li.prototype),ya.prototype.constructor=ya;var xa={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha  = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvarying vec3 vViewPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n  return m[ 2 ][ 3 ] == - 1.0;\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_maxMipLevel 8.0\n#define cubeUV_minMipLevel 4.0\n#define cubeUV_maxTileSize 256.0\n#define cubeUV_minTileSize 16.0\nfloat getFace(vec3 direction) {\n    vec3 absDirection = abs(direction);\n    float face = -1.0;\n    if (absDirection.x > absDirection.z) {\n      if (absDirection.x > absDirection.y)\n        face = direction.x > 0.0 ? 0.0 : 3.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    } else {\n      if (absDirection.z > absDirection.y)\n        face = direction.z > 0.0 ? 2.0 : 5.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    }\n    return face;\n}\nvec2 getUV(vec3 direction, float face) {\n    vec2 uv;\n    if (face == 0.0) {\n      uv = vec2(-direction.z, direction.y) / abs(direction.x);\n    } else if (face == 1.0) {\n      uv = vec2(direction.x, -direction.z) / abs(direction.y);\n    } else if (face == 2.0) {\n      uv = direction.xy / abs(direction.z);\n    } else if (face == 3.0) {\n      uv = vec2(direction.z, direction.y) / abs(direction.x);\n    } else if (face == 4.0) {\n      uv = direction.xz / abs(direction.y);\n    } else {\n      uv = vec2(-direction.x, direction.y) / abs(direction.z);\n    }\n    return 0.5 * (uv + 1.0);\n}\nvec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n  float face = getFace(direction);\n  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n  mipInt = max(mipInt, cubeUV_minMipLevel);\n  float faceSize = exp2(mipInt);\n  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n  vec2 uv = getUV(direction, face) * (faceSize - 1.0);\n  vec2 f = fract(uv);\n  uv += 0.5 - f;\n  if (face > 2.0) {\n    uv.y += faceSize;\n    face -= 3.0;\n  }\n  uv.x += face * faceSize;\n  if(mipInt < cubeUV_maxMipLevel){\n    uv.y += 2.0 * cubeUV_maxTileSize;\n  }\n  uv.y += filterInt * 2.0 * cubeUV_minTileSize;\n  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n  uv *= texelSize;\n  vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x += texelSize;\n  vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.y += texelSize;\n  vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x -= texelSize;\n  vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  vec3 tm = mix(tl, tr, f.x);\n  vec3 bm = mix(bl, br, f.x);\n  return mix(tm, bm, f.y);\n}\n#define r0 1.0\n#define v0 0.339\n#define m0 -2.0\n#define r1 0.8\n#define v1 0.276\n#define m1 -1.0\n#define r4 0.4\n#define v4 0.046\n#define m4 2.0\n#define r5 0.305\n#define v5 0.016\n#define m5 3.0\n#define r6 0.21\n#define v6 0.0038\n#define m6 4.0\nfloat roughnessToMip(float roughness) {\n  float mip = 0.0;\n  if (roughness >= r1) {\n    mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n  } else if (roughness >= r4) {\n    mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n  } else if (roughness >= r5) {\n    mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n  } else if (roughness >= r6) {\n    mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n  } else {\n    mip = -2.0 * log2(1.16 * roughness);  }\n  return mip;\n}\nvec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {\n  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);\n  float mipF = fract(mip);\n  float mipInt = floor(mip);\n  vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);\n  if (mipF == 0.0) {\n    return vec4(color0, 1.0);\n  } else {\n    vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);\n    return vec4(mix(color0, color1, mipF), 1.0);\n  }\n}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\ttransformedNormal = mat3( instanceMatrix ) * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\t\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t}  else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t  vec3 reflectVec = reflect( -viewDir, normal );\n\t\t  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) { \n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = saturate( clearcoat );\tmaterial.clearcoatRoughness = max( clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( pointLight.shadow, directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( spotLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectLight.color *= all( bvec3( directionalLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_normalmap_pars_fragment:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLight directionalLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= all( bvec2( directionalLight.shadow, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLight spotLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= all( bvec2( spotLight.shadow, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLight pointLight;\n\t#pragma unroll_loop\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= all( bvec2( pointLight.shadow, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n}",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSPARENCY\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSPARENCY\n\tuniform float transparency;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSPARENCY\n\t\tdiffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},ba={basic:{uniforms:ra([da.common,da.specularmap,da.envmap,da.aomap,da.lightmap,da.fog]),vertexShader:xa.meshbasic_vert,fragmentShader:xa.meshbasic_frag},lambert:{uniforms:ra([da.common,da.specularmap,da.envmap,da.aomap,da.lightmap,da.emissivemap,da.fog,da.lights,{emissive:{value:new ei(0)}}]),vertexShader:xa.meshlambert_vert,fragmentShader:xa.meshlambert_frag},phong:{uniforms:ra([da.common,da.specularmap,da.envmap,da.aomap,da.lightmap,da.emissivemap,da.bumpmap,da.normalmap,da.displacementmap,da.fog,da.lights,{emissive:{value:new ei(0)},specular:{value:new ei(1118481)},shininess:{value:30}}]),vertexShader:xa.meshphong_vert,fragmentShader:xa.meshphong_frag},standard:{uniforms:ra([da.common,da.envmap,da.aomap,da.lightmap,da.emissivemap,da.bumpmap,da.normalmap,da.displacementmap,da.roughnessmap,da.metalnessmap,da.fog,da.lights,{emissive:{value:new ei(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:xa.meshphysical_vert,fragmentShader:xa.meshphysical_frag},toon:{uniforms:ra([da.common,da.specularmap,da.aomap,da.lightmap,da.emissivemap,da.bumpmap,da.normalmap,da.displacementmap,da.gradientmap,da.fog,da.lights,{emissive:{value:new ei(0)},specular:{value:new ei(1118481)},shininess:{value:30}}]),vertexShader:xa.meshtoon_vert,fragmentShader:xa.meshtoon_frag},matcap:{uniforms:ra([da.common,da.bumpmap,da.normalmap,da.displacementmap,da.fog,{matcap:{value:null}}]),vertexShader:xa.meshmatcap_vert,fragmentShader:xa.meshmatcap_frag},points:{uniforms:ra([da.points,da.fog]),vertexShader:xa.points_vert,fragmentShader:xa.points_frag},dashed:{uniforms:ra([da.common,da.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:xa.linedashed_vert,fragmentShader:xa.linedashed_frag},depth:{uniforms:ra([da.common,da.displacementmap]),vertexShader:xa.depth_vert,fragmentShader:xa.depth_frag},normal:{uniforms:ra([da.common,da.bumpmap,da.normalmap,da.displacementmap,{opacity:{value:1}}]),vertexShader:xa.normal_vert,fragmentShader:xa.normal_frag},sprite:{uniforms:ra([da.sprite,da.fog]),vertexShader:xa.sprite_vert,fragmentShader:xa.sprite_frag},background:{uniforms:{uvTransform:{value:new An},t2D:{value:null}},vertexShader:xa.background_vert,fragmentShader:xa.background_frag},cube:{uniforms:ra([da.envmap,{opacity:{value:1}}]),vertexShader:xa.cube_vert,fragmentShader:xa.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:xa.equirect_vert,fragmentShader:xa.equirect_frag},distanceRGBA:{uniforms:ra([da.common,da.displacementmap,{referencePosition:{value:new kn},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:xa.distanceRGBA_vert,fragmentShader:xa.distanceRGBA_frag},shadow:{uniforms:ra([da.lights,da.fog,{color:{value:new ei(0)},opacity:{value:1}}]),vertexShader:xa.shadow_vert,fragmentShader:xa.shadow_frag}};function wa(e,t,n,r){var i,a,o=new ei(0),s=0,c=null,u=0,l=null;function h(e,n){t.buffers.color.setClear(e.r,e.g,e.b,n,r)}return{getClearColor:function(){return o},setClearColor:function(e,t){o.set(e),h(o,s=void 0!==t?t:1)},getClearAlpha:function(){return s},setClearAlpha:function(e){h(o,s=e)},render:function(t,r,f,p){var d=r.background,m=e.xr,y=m.getSession&&m.getSession();if(y&&"additive"===y.environmentBlendMode&&(d=null),null===d?h(o,s):d&&d.isColor&&(h(d,1),p=!0),(e.autoClear||p)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),d&&(d.isCubeTexture||d.isWebGLCubeRenderTarget||d.mapping===me)){void 0===a&&((a=new qi(new ta(1,1,1),new aa({type:"BackgroundCubeMaterial",uniforms:na(ba.cube.uniforms),vertexShader:ba.cube.vertexShader,fragmentShader:ba.cube.fragmentShader,side:g,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(a.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(a));var x=d.isWebGLCubeRenderTarget?d.texture:d;a.material.uniforms.envMap.value=x,a.material.uniforms.flipEnvMap.value=x.isCubeTexture?-1:1,c===d&&u===x.version&&l===e.toneMapping||(a.material.needsUpdate=!0,c=d,u=x.version,l=e.toneMapping),t.unshift(a,a.geometry,a.material,0,0,null)}else d&&d.isTexture&&(void 0===i&&((i=new qi(new ya(2,2),new aa({type:"BackgroundMaterial",uniforms:na(ba.background.uniforms),vertexShader:ba.background.vertexShader,fragmentShader:ba.background.fragmentShader,side:v,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(i.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(i)),i.material.uniforms.t2D.value=d,!0===d.matrixAutoUpdate&&d.updateMatrix(),i.material.uniforms.uvTransform.value.copy(d.matrix),c===d&&u===d.version&&l===e.toneMapping||(i.material.needsUpdate=!0,c=d,u=d.version,l=e.toneMapping),t.unshift(i,i.geometry,i.material,0,0,null))}}}function _a(e,t,n,r){var i,a=r.isWebGL2;this.setMode=function(e){i=e},this.render=function(t,r){e.drawArrays(i,t,r),n.update(r,i)},this.renderInstances=function(r,o,s,c){if(0!==c){var u,l;if(a)u=e,l="drawArraysInstanced";else if(l="drawArraysInstancedANGLE",null===(u=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[l](i,o,s,c),n.update(s,i,c)}}}function Ma(e,t,n){var r;function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var a="undefined"!==typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!==typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext,o=void 0!==n.precision?n.precision:"highp",s=i(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var c=!0===n.logarithmicDepthBuffer,u=e.getParameter(34930),l=e.getParameter(35660),h=e.getParameter(3379),f=e.getParameter(34076),p=e.getParameter(34921),d=e.getParameter(36347),m=e.getParameter(36348),v=e.getParameter(36349),g=l>0,y=a||!!t.get("OES_texture_float");return{isWebGL2:a,getMaxAnisotropy:function(){if(void 0!==r)return r;var n=t.get("EXT_texture_filter_anisotropic");return r=null!==n?e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:i,precision:o,logarithmicDepthBuffer:c,maxTextures:u,maxVertexTextures:l,maxTextureSize:h,maxCubemapSize:f,maxAttributes:p,maxVertexUniforms:d,maxVaryings:m,maxFragmentUniforms:v,vertexTextures:g,floatFragmentTextures:y,floatVertexTextures:g&&y,maxSamples:a?e.getParameter(36183):0}}function Ea(){var e=this,t=null,n=0,r=!1,i=!1,a=new Br,o=new An,s={value:null,needsUpdate:!1};function c(){s.value!==t&&(s.value=t,s.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function u(t,n,r,i){var c=null!==t?t.length:0,u=null;if(0!==c){if(u=s.value,!0!==i||null===u){var l=r+4*c,h=n.matrixWorldInverse;o.getNormalMatrix(h),(null===u||u.length<l)&&(u=new Float32Array(l));for(var f=0,p=r;f!==c;++f,p+=4)a.copy(t[f]).applyMatrix4(h,o),a.normal.toArray(u,p),u[p+3]=a.constant}s.value=u,s.needsUpdate=!0}return e.numPlanes=c,u}this.uniform=s,this.numPlanes=0,this.numIntersection=0,this.init=function(e,i,a){var o=0!==e.length||i||0!==n||r;return r=i,t=u(e,a,0),n=e.length,o},this.beginShadows=function(){i=!0,u(null)},this.endShadows=function(){i=!1,c()},this.setState=function(e,a,o,l,h,f){if(!r||null===e||0===e.length||i&&!o)i?u(null):c();else{var p=i?0:n,d=4*p,m=h.clippingState||null;s.value=m,m=u(e,l,d,f);for(var v=0;v!==d;++v)m[v]=t[v];h.clippingState=m,this.numIntersection=a?this.numPlanes:0,this.numPlanes+=p}}}function Ta(e){var t={};return{get:function(n){if(void 0!==t[n])return t[n];var r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return null===r&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),t[n]=r,r}}}function Sa(e,t,n){var r=new WeakMap,i=new WeakMap;function a(e){var o=e.target,s=r.get(o);for(var c in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[c]);o.removeEventListener("dispose",a),r.delete(o);var u=i.get(s);u&&(t.remove(u),i.delete(s)),n.memory.geometries--}function o(e){var n=[],r=e.index,a=e.attributes.position,o=0;if(null!==r){var s=r.array;o=r.version;for(var c=0,u=s.length;c<u;c+=3){var l=s[c+0],h=s[c+1],f=s[c+2];n.push(l,h,h,f,f,l)}}else{s=a.array;o=a.version;for(c=0,u=s.length/3-1;c<u;c+=3){l=c+0,h=c+1,f=c+2;n.push(l,h,h,f,f,l)}}var p=new(bi(n)>65535?vi:di)(n,1);p.version=o,t.update(p,34963);var d=i.get(e);d&&t.remove(d),i.set(e,p)}return{get:function(e,t){var i=r.get(t);return i||(t.addEventListener("dispose",a),t.isBufferGeometry?i=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new Li).setFromObject(e)),i=t._bufferGeometry),r.set(t,i),n.memory.geometries++,i)},update:function(e){var n=e.index,r=e.attributes;for(var i in null!==n&&t.update(n,34963),r)t.update(r[i],34962);var a=e.morphAttributes;for(var i in a)for(var o=a[i],s=0,c=o.length;s<c;s++)t.update(o[s],34962)},getWireframeAttribute:function(e){var t=i.get(e);if(t){var n=e.index;null!==n&&t.version<n.version&&o(e)}else o(e);return i.get(e)}}}function Aa(e,t,n,r){var i,a,o,s=r.isWebGL2;this.setMode=function(e){i=e},this.setIndex=function(e){a=e.type,o=e.bytesPerElement},this.render=function(t,r){e.drawElements(i,r,a,t*o),n.update(r,i)},this.renderInstances=function(r,c,u,l){if(0!==l){var h,f;if(s)h=e,f="drawElementsInstanced";else if(f="drawElementsInstancedANGLE",null===(h=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[f](i,u,a,c*o,l),n.update(u,i,l)}}}function La(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,r){switch(r=r||1,t.calls++,n){case 4:t.triangles+=r*(e/3);break;case 1:t.lines+=r*(e/2);break;case 3:t.lines+=r*(e-1);break;case 2:t.lines+=r*e;break;case 0:t.points+=r*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function Ra(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Pa(e){var t={},n=new Float32Array(8);return{update:function(r,i,a,o){var s=r.morphTargetInfluences,c=void 0===s?0:s.length,u=t[i.id];if(void 0===u){u=[];for(var l=0;l<c;l++)u[l]=[l,0];t[i.id]=u}var h=a.morphTargets&&i.morphAttributes.position,f=a.morphNormals&&i.morphAttributes.normal;for(l=0;l<c;l++){0!==(d=u[l])[1]&&(h&&i.deleteAttribute("morphTarget"+l),f&&i.deleteAttribute("morphNormal"+l))}for(l=0;l<c;l++){(d=u[l])[0]=l,d[1]=s[l]}u.sort(Ra);var p=0;for(l=0;l<8;l++){var d;if(d=u[l]){var m=d[0],v=d[1];if(v){h&&i.setAttribute("morphTarget"+l,h[m]),f&&i.setAttribute("morphNormal"+l,f[m]),n[l]=v,p+=v;continue}}n[l]=0}var g=i.morphTargetsRelative?1:1-p;o.getUniforms().setValue(e,"morphTargetBaseInfluence",g),o.getUniforms().setValue(e,"morphTargetInfluences",n)}}}function Ca(e,t,n,r){var i={};return{update:function(e){var a=r.render.frame,o=e.geometry,s=t.get(e,o);return i[s.id]!==a&&(o.isGeometry&&s.updateFromObject(e),t.update(s),i[s.id]=a),e.isInstancedMesh&&n.update(e.instanceMatrix,34962),s},dispose:function(){i={}}}}function Oa(e,t,n,r,i,a,o,s,c,u){e=void 0!==e?e:[],t=void 0!==t?t:le,o=void 0!==o?o:je,Pn.call(this,e,t,n,r,i,a,o,s,c,u),this.flipY=!1}function Da(e,t,n,r){Pn.call(this,null),this.image={data:e||null,width:t||1,height:n||1,depth:r||1},this.magFilter=be,this.minFilter=be,this.wrapR=ye,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function Ia(e,t,n,r){Pn.call(this,null),this.image={data:e||null,width:t||1,height:n||1,depth:r||1},this.magFilter=be,this.minFilter=be,this.wrapR=ye,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}ba.physical={uniforms:ra([ba.standard.uniforms,{transparency:{value:0},clearcoat:{value:0},clearcoatRoughness:{value:0},sheen:{value:new ei(0)},clearcoatNormalScale:{value:new Sn(1,1)},clearcoatNormalMap:{value:null}}]),vertexShader:xa.meshphysical_vert,fragmentShader:xa.meshphysical_frag},Oa.prototype=Object.create(Pn.prototype),Oa.prototype.constructor=Oa,Oa.prototype.isCubeTexture=!0,Object.defineProperty(Oa.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),Da.prototype=Object.create(Pn.prototype),Da.prototype.constructor=Da,Da.prototype.isDataTexture2DArray=!0,Ia.prototype=Object.create(Pn.prototype),Ia.prototype.constructor=Ia,Ia.prototype.isDataTexture3D=!0;var Na=new Pn,za=new Da,ka=new Ia,Fa=new Oa,Ba=[],Ua=[],Ha=new Float32Array(16),Ga=new Float32Array(9),ja=new Float32Array(4);function Va(e,t,n){var r=e[0];if(r<=0||r>0)return e;var i=t*n,a=Ba[i];if(void 0===a&&(a=new Float32Array(i),Ba[i]=a),0!==t){r.toArray(a,0);for(var o=1,s=0;o!==t;++o)s+=n,e[o].toArray(a,s)}return a}function Wa(e,t){if(e.length!==t.length)return!1;for(var n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function qa(e,t){for(var n=0,r=t.length;n<r;n++)e[n]=t[n]}function Ya(e,t){var n=Ua[t];void 0===n&&(n=new Int32Array(t),Ua[t]=n);for(var r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function Xa(e,t){var n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function Za(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Wa(n,t))return;e.uniform2fv(this.addr,t),qa(n,t)}}function Ja(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(Wa(n,t))return;e.uniform3fv(this.addr,t),qa(n,t)}}function Qa(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Wa(n,t))return;e.uniform4fv(this.addr,t),qa(n,t)}}function Ka(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(Wa(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),qa(n,t)}else{if(Wa(n,r))return;ja.set(r),e.uniformMatrix2fv(this.addr,!1,ja),qa(n,r)}}function $a(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(Wa(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),qa(n,t)}else{if(Wa(n,r))return;Ga.set(r),e.uniformMatrix3fv(this.addr,!1,Ga),qa(n,r)}}function eo(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(Wa(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),qa(n,t)}else{if(Wa(n,r))return;Ha.set(r),e.uniformMatrix4fv(this.addr,!1,Ha),qa(n,r)}}function to(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTexture2D(t||Na,i)}function no(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||za,i)}function ro(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||ka,i)}function io(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTextureCube(t||Fa,i)}function ao(e,t){var n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function oo(e,t){var n=this.cache;Wa(n,t)||(e.uniform2iv(this.addr,t),qa(n,t))}function so(e,t){var n=this.cache;Wa(n,t)||(e.uniform3iv(this.addr,t),qa(n,t))}function co(e,t){var n=this.cache;Wa(n,t)||(e.uniform4iv(this.addr,t),qa(n,t))}function uo(e,t){var n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function lo(e,t){e.uniform1fv(this.addr,t)}function ho(e,t){e.uniform1iv(this.addr,t)}function fo(e,t){e.uniform2iv(this.addr,t)}function po(e,t){e.uniform3iv(this.addr,t)}function mo(e,t){e.uniform4iv(this.addr,t)}function vo(e,t){var n=Va(t,this.size,2);e.uniform2fv(this.addr,n)}function go(e,t){var n=Va(t,this.size,3);e.uniform3fv(this.addr,n)}function yo(e,t){var n=Va(t,this.size,4);e.uniform4fv(this.addr,n)}function xo(e,t){var n=Va(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function bo(e,t){var n=Va(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function wo(e,t){var n=Va(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function _o(e,t,n){var r=t.length,i=Ya(n,r);e.uniform1iv(this.addr,i);for(var a=0;a!==r;++a)n.safeSetTexture2D(t[a]||Na,i[a])}function Mo(e,t,n){var r=t.length,i=Ya(n,r);e.uniform1iv(this.addr,i);for(var a=0;a!==r;++a)n.safeSetTextureCube(t[a]||Fa,i[a])}function Eo(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Xa;case 35664:return Za;case 35665:return Ja;case 35666:return Qa;case 35674:return Ka;case 35675:return $a;case 35676:return eo;case 5124:case 35670:return ao;case 35667:case 35671:return oo;case 35668:case 35672:return so;case 35669:case 35673:return co;case 5125:return uo;case 35678:case 36198:case 36298:case 36306:case 35682:return to;case 35679:case 36299:case 36307:return ro;case 35680:case 36300:case 36308:case 36293:return io;case 36289:case 36303:case 36311:case 36292:return no}}(t.type)}function To(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return lo;case 35664:return vo;case 35665:return go;case 35666:return yo;case 35674:return xo;case 35675:return bo;case 35676:return wo;case 5124:case 35670:return ho;case 35667:case 35671:return fo;case 35668:case 35672:return po;case 35669:case 35673:return mo;case 35678:case 36198:case 36298:case 36306:case 35682:return _o;case 35680:case 36300:case 36308:case 36293:return Mo}}(t.type)}function So(e){this.id=e,this.seq=[],this.map={}}To.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),qa(t,e)},So.prototype.setValue=function(e,t,n){for(var r=this.seq,i=0,a=r.length;i!==a;++i){var o=r[i];o.setValue(e,t[o.id],n)}};var Ao=/([\w\d_]+)(\])?(\[|\.)?/g;function Lo(e,t){e.seq.push(t),e.map[t.id]=t}function Ro(e,t,n){var r=e.name,i=r.length;for(Ao.lastIndex=0;;){var a=Ao.exec(r),o=Ao.lastIndex,s=a[1],c="]"===a[2],u=a[3];if(c&&(s|=0),void 0===u||"["===u&&o+2===i){Lo(n,void 0===u?new Eo(s,e,t):new To(s,e,t));break}var l=n.map[s];void 0===l&&Lo(n,l=new So(s)),n=l}}function Po(e,t){this.seq=[],this.map={};for(var n=e.getProgramParameter(t,35718),r=0;r<n;++r){var i=e.getActiveUniform(t,r);Ro(i,e.getUniformLocation(t,i.name),this)}}function Co(e,t,n){var r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}Po.prototype.setValue=function(e,t,n,r){var i=this.map[t];void 0!==i&&i.setValue(e,n,r)},Po.prototype.setOptional=function(e,t,n){var r=t[n];void 0!==r&&this.setValue(e,n,r)},Po.upload=function(e,t,n,r){for(var i=0,a=t.length;i!==a;++i){var o=t[i],s=n[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,r)}},Po.seqWithValue=function(e,t){for(var n=[],r=0,i=e.length;r!==i;++r){var a=e[r];a.id in t&&n.push(a)}return n};var Oo=0;function Do(e){switch(e){case kt:return["Linear","( value )"];case Ft:return["sRGB","( value )"];case Ut:return["RGBE","( value )"];case Gt:return["RGBM","( value, 7.0 )"];case jt:return["RGBM","( value, 16.0 )"];case Vt:return["RGBD","( value, 256.0 )"];case Bt:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case Ht:return["LogLuv","( value )"];default:throw new Error("unsupported encoding: "+e)}}function Io(e,t,n){var r=e.getShaderParameter(t,35713),i=e.getShaderInfoLog(t).trim();return r&&""===i?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+i+function(e){for(var t=e.split("\n"),n=0;n<t.length;n++)t[n]=n+1+": "+t[n];return t.join("\n")}(e.getShaderSource(t))}function No(e,t){var n=Do(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function zo(e,t){var n=Do(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function ko(e,t){var n;switch(t){case ie:n="Linear";break;case ae:n="Reinhard";break;case oe:n="Uncharted2";break;case se:n="OptimizedCineon";break;case ce:n="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function Fo(e){return""!==e}function Bo(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Uo(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var Ho=/^[ \t]*#include +<([\w\d./]+)>/gm;function Go(e){return e.replace(Ho,jo)}function jo(e,t){var n=xa[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return Go(n)}var Vo=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;function Wo(e){return e.replace(Vo,qo)}function qo(e,t,n,r){for(var i="",a=parseInt(t);a<parseInt(n);a++)i+=r.replace(/\[ i \]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return i}function Yo(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Xo(e,t,n){var r,i,a=e.getContext(),o=n.defines,s=n.vertexShader,c=n.fragmentShader,u=function(e){var t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===p?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===d?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===m&&(t="SHADOWMAP_TYPE_VSM"),t}(n),l=function(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case le:case he:t="ENVMAP_TYPE_CUBE";break;case me:case ve:t="ENVMAP_TYPE_CUBE_UV";break;case fe:case pe:t="ENVMAP_TYPE_EQUIREC";break;case de:t="ENVMAP_TYPE_SPHERE"}return t}(n),h=function(e){var t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case he:case pe:t="ENVMAP_MODE_REFRACTION"}return t}(n),f=function(e){var t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case ee:t="ENVMAP_BLENDING_MULTIPLY";break;case te:t="ENVMAP_BLENDING_MIX";break;case ne:t="ENVMAP_BLENDING_ADD"}return t}(n),v=e.gammaFactor>0?e.gammaFactor:1,g=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Fo).join("\n")}(n),y=function(e){var t=[];for(var n in e){var r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(o),x=a.createProgram(),b=n.numMultiviewViews;if(n.isRawShaderMaterial?((r=[y].filter(Fo).join("\n")).length>0&&(r+="\n"),(i=[g,y].filter(Fo).join("\n")).length>0&&(i+="\n")):(r=[Yo(n),"#define SHADER_NAME "+n.shaderName,y,n.instancing?"#define USE_INSTANCING":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+v,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+h:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+u:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Fo).join("\n"),i=[g,Yo(n),"#define SHADER_NAME "+n.shaderName,y,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+v,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+l:"",n.envMap?"#define "+h:"",n.envMap?"#define "+f:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+u:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==re?"#define TONE_MAPPING":"",n.toneMapping!==re?xa.tonemapping_pars_fragment:"",n.toneMapping!==re?ko("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.outputEncoding||n.mapEncoding||n.matcapEncoding||n.envMapEncoding||n.emissiveMapEncoding||n.lightMapEncoding?xa.encodings_pars_fragment:"",n.mapEncoding?No("mapTexelToLinear",n.mapEncoding):"",n.matcapEncoding?No("matcapTexelToLinear",n.matcapEncoding):"",n.envMapEncoding?No("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMapEncoding?No("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMapEncoding?No("lightMapTexelToLinear",n.lightMapEncoding):"",n.outputEncoding?zo("linearToOutputTexel",n.outputEncoding):"",n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(Fo).join("\n")),s=Uo(s=Bo(s=Go(s),n),n),c=Uo(c=Bo(c=Go(c),n),n),s=Wo(s),c=Wo(c),n.isWebGL2&&!n.isRawShaderMaterial){var w=!1,_=/^\s*#version\s+300\s+es\s*\n/;n.isShaderMaterial&&null!==s.match(_)&&null!==c.match(_)&&(w=!0,s=s.replace(_,""),c=c.replace(_,"")),r=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+r,i=["#version 300 es\n","#define varying in",w?"":"out highp vec4 pc_fragColor;",w?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+i,b>0&&(r=(r=r.replace("#version 300 es\n",["#version 300 es\n","#extension GL_OVR_multiview2 : require","layout(num_views = "+b+") in;","#define VIEW_ID gl_ViewID_OVR"].join("\n"))).replace(["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;"].join("\n"),["uniform mat4 modelViewMatrices["+b+"];","uniform mat4 projectionMatrices["+b+"];","uniform mat4 viewMatrices["+b+"];","uniform mat3 normalMatrices["+b+"];","#define modelViewMatrix modelViewMatrices[VIEW_ID]","#define projectionMatrix projectionMatrices[VIEW_ID]","#define viewMatrix viewMatrices[VIEW_ID]","#define normalMatrix normalMatrices[VIEW_ID]"].join("\n")),i=(i=i.replace("#version 300 es\n",["#version 300 es\n","#extension GL_OVR_multiview2 : require","#define VIEW_ID gl_ViewID_OVR"].join("\n"))).replace("uniform mat4 viewMatrix;",["uniform mat4 viewMatrices["+b+"];","#define viewMatrix viewMatrices[VIEW_ID]"].join("\n")))}var M,E,T=i+c,S=Co(a,35633,r+s),A=Co(a,35632,T);if(a.attachShader(x,S),a.attachShader(x,A),void 0!==n.index0AttributeName?a.bindAttribLocation(x,0,n.index0AttributeName):!0===n.morphTargets&&a.bindAttribLocation(x,0,"position"),a.linkProgram(x),e.debug.checkShaderErrors){var L=a.getProgramInfoLog(x).trim(),R=a.getShaderInfoLog(S).trim(),P=a.getShaderInfoLog(A).trim(),C=!0,O=!0;if(!1===a.getProgramParameter(x,35714)){C=!1;var D=Io(a,S,"vertex"),I=Io(a,A,"fragment");console.error("THREE.WebGLProgram: shader error: ",a.getError(),"35715",a.getProgramParameter(x,35715),"gl.getProgramInfoLog",L,D,I)}else""!==L?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",L):""!==R&&""!==P||(O=!1);O&&(this.diagnostics={runnable:C,programLog:L,vertexShader:{log:R,prefix:r},fragmentShader:{log:P,prefix:i}})}return a.deleteShader(S),a.deleteShader(A),this.getUniforms=function(){return void 0===M&&(M=new Po(a,x)),M},this.getAttributes=function(){return void 0===E&&(E=function(e,t){for(var n={},r=e.getProgramParameter(t,35721),i=0;i<r;i++){var a=e.getActiveAttrib(t,i).name;n[a]=e.getAttribLocation(t,a)}return n}(a,x)),E},this.destroy=function(){a.deleteProgram(x),this.program=void 0},this.name=n.shaderName,this.id=Oo++,this.cacheKey=t,this.usedTimes=1,this.program=x,this.vertexShader=S,this.fragmentShader=A,this.numMultiviewViews=b,this}function Zo(e,t,n){var r=[],i=n.isWebGL2,a=n.logarithmicDepthBuffer,o=n.floatVertexTextures,s=n.precision,c=n.maxVertexUniforms,u=n.vertexTextures,l={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},h=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","numMultiviewViews","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen"];function f(e){var t;return e?e.isTexture?t=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=kt,t}this.getParameters=function(r,h,p,d,m,v,x){var b=d.fog,w=r.isMeshStandardMaterial?d.environment:null,_=r.envMap||w,M=l[r.type],E=x.isSkinnedMesh?function(e){var t=e.skeleton.bones;if(o)return 1024;var n=c,r=Math.floor((n-20)/4),i=Math.min(r,t.length);return i<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+i+"."),0):i}(x):0;null!==r.precision&&(s=n.getMaxPrecision(r.precision))!==r.precision&&console.warn("THREE.WebGLProgram.getParameters:",r.precision,"not supported, using",s,"instead.");var T=function(e,t){var n;if(t){var r=ba[t];n={name:e.type,uniforms:ia.clone(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader}}else n={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};return n}(r,M);r.onBeforeCompile(T,e);var S=e.getRenderTarget(),A=S&&S.isWebGLMultiviewRenderTarget?S.numViews:0;return{isWebGL2:i,shaderID:M,shaderName:T.name,uniforms:T.uniforms,vertexShader:T.vertexShader,fragmentShader:T.fragmentShader,defines:r.defines,isRawShaderMaterial:r.isRawShaderMaterial,isShaderMaterial:r.isShaderMaterial,precision:s,instancing:!0===x.isInstancedMesh,supportsVertexTextures:u,numMultiviewViews:A,outputEncoding:null!==S?f(S.texture):e.outputEncoding,map:!!r.map,mapEncoding:f(r.map),matcap:!!r.matcap,matcapEncoding:f(r.matcap),envMap:!!_,envMapMode:_&&_.mapping,envMapEncoding:f(_),envMapCubeUV:!!_&&(_.mapping===me||_.mapping===ve),lightMap:!!r.lightMap,lightMapEncoding:f(r.lightMap),aoMap:!!r.aoMap,emissiveMap:!!r.emissiveMap,emissiveMapEncoding:f(r.emissiveMap),bumpMap:!!r.bumpMap,normalMap:!!r.normalMap,objectSpaceNormalMap:r.normalMapType===Xt,tangentSpaceNormalMap:r.normalMapType===Yt,clearcoatNormalMap:!!r.clearcoatNormalMap,displacementMap:!!r.displacementMap,roughnessMap:!!r.roughnessMap,metalnessMap:!!r.metalnessMap,specularMap:!!r.specularMap,alphaMap:!!r.alphaMap,gradientMap:!!r.gradientMap,sheen:!!r.sheen,combine:r.combine,vertexTangents:r.normalMap&&r.vertexTangents,vertexColors:r.vertexColors,vertexUvs:!!r.map||!!r.bumpMap||!!r.normalMap||!!r.specularMap||!!r.alphaMap||!!r.emissiveMap||!!r.roughnessMap||!!r.metalnessMap||!!r.clearcoatNormalMap||!!r.displacementMap,uvsVertexOnly:!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatNormalMap)&&!!r.displacementMap,fog:!!b,useFog:r.fog,fogExp2:b&&b.isFogExp2,flatShading:r.flatShading,sizeAttenuation:r.sizeAttenuation,logarithmicDepthBuffer:a,skinning:r.skinning&&E>0,maxBones:E,useVertexTexture:o,morphTargets:r.morphTargets,morphNormals:r.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:h.directional.length,numPointLights:h.point.length,numSpotLights:h.spot.length,numRectAreaLights:h.rectArea.length,numHemiLights:h.hemi.length,numDirLightShadows:h.directionalShadowMap.length,numPointLightShadows:h.pointShadowMap.length,numSpotLightShadows:h.spotShadowMap.length,numClippingPlanes:m,numClipIntersection:v,dithering:r.dithering,shadowMapEnabled:e.shadowMap.enabled&&p.length>0,shadowMapType:e.shadowMap.type,toneMapping:r.toneMapped?e.toneMapping:re,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:r.premultipliedAlpha,alphaTest:r.alphaTest,doubleSided:r.side===y,flipSided:r.side===g,depthPacking:void 0!==r.depthPacking&&r.depthPacking,index0AttributeName:r.index0AttributeName,extensionDerivatives:r.extensions&&r.extensions.derivatives,extensionFragDepth:r.extensions&&r.extensions.frawbuffers,extensionDrawbuffers:r.extensions&&r.extensions.drawbuffers,extensionShaderTextureLOD:r.extensions&&r.extensions.shaderTextureLOD,rendererExtensionFragDepth:i||null!==t.get("EXT_frag_depth"),rendererExtensionDrawBuffers:i||null!==t.get("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:i||null!==t.get("EXT_shader_texture_lod"),onBeforeCompile:r.onBeforeCompile}},this.getProgramCacheKey=function(t){var n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(var r in t.defines)n.push(r),n.push(t.defines[r]);if(void 0===t.isRawShaderMaterial){for(var i=0;i<h.length;i++)n.push(t[h[i]]);n.push(e.outputEncoding),n.push(e.gammaFactor)}return n.push(t.onBeforeCompile.toString()),n.join()},this.acquireProgram=function(t,n){for(var i,a=0,o=r.length;a<o;a++){var s=r[a];if(s.cacheKey===n){++(i=s).usedTimes;break}}return void 0===i&&(i=new Xo(e,n,t),r.push(i)),i},this.releaseProgram=function(e){if(0===--e.usedTimes){var t=r.indexOf(e);r[t]=r[r.length-1],r.pop(),e.destroy()}},this.programs=r}function Jo(){var e=new WeakMap;return{get:function(t){var n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function Qo(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Ko(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function $o(){var e=[],t=0,n=[],r=[],i={id:-1};function a(n,r,a,o,s,c){var u=e[t];return void 0===u?(u={id:n.id,object:n,geometry:r,material:a,program:a.program||i,groupOrder:o,renderOrder:n.renderOrder,z:s,group:c},e[t]=u):(u.id=n.id,u.object=n,u.geometry=r,u.material=a,u.program=a.program||i,u.groupOrder=o,u.renderOrder=n.renderOrder,u.z=s,u.group=c),t++,u}return{opaque:n,transparent:r,init:function(){t=0,n.length=0,r.length=0},push:function(e,t,i,o,s,c){var u=a(e,t,i,o,s,c);(!0===i.transparent?r:n).push(u)},unshift:function(e,t,i,o,s,c){var u=a(e,t,i,o,s,c);(!0===i.transparent?r:n).unshift(u)},sort:function(e,t){n.length>1&&n.sort(e||Qo),r.length>1&&r.sort(t||Ko)}}}function es(){var e=new WeakMap;function t(n){var r=n.target;r.removeEventListener("dispose",t),e.delete(r)}return{get:function(n,r){var i,a=e.get(n);return void 0===a?(i=new $o,e.set(n,new WeakMap),e.get(n).set(r,i),n.addEventListener("dispose",t)):void 0===(i=a.get(r))&&(i=new $o,a.set(r,i)),i},dispose:function(){e=new WeakMap}}}function ts(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":n={direction:new kn,color:new ei,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Sn};break;case"SpotLight":n={position:new kn,direction:new kn,color:new ei,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Sn};break;case"PointLight":n={position:new kn,color:new ei,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Sn,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":n={direction:new kn,skyColor:new ei,groundColor:new ei};break;case"RectAreaLight":n={color:new ei,position:new kn,halfWidth:new kn,halfHeight:new kn}}return e[t.id]=n,n}}}var ns=0;function rs(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function is(){for(var e=new ts,t={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},n=0;n<9;n++)t.probe.push(new kn);var r=new kn,i=new Wn,a=new Wn;return{setup:function(n,o,s){for(var c=0,u=0,l=0,h=0;h<9;h++)t.probe[h].set(0,0,0);var f=0,p=0,d=0,m=0,v=0,g=0,y=0,x=0,b=s.matrixWorldInverse;n.sort(rs),h=0;for(var w=n.length;h<w;h++){var _=n[h],M=_.color,E=_.intensity,T=_.distance,S=_.shadow&&_.shadow.map?_.shadow.map.texture:null;if(_.isAmbientLight)c+=M.r*E,u+=M.g*E,l+=M.b*E;else if(_.isLightProbe)for(var A=0;A<9;A++)t.probe[A].addScaledVector(_.sh.coefficients[A],E);else if(_.isDirectionalLight){if((R=e.get(_)).color.copy(_.color).multiplyScalar(_.intensity),R.direction.setFromMatrixPosition(_.matrixWorld),r.setFromMatrixPosition(_.target.matrixWorld),R.direction.sub(r),R.direction.transformDirection(b),R.shadow=_.castShadow,_.castShadow){var L=_.shadow;R.shadowBias=L.bias,R.shadowRadius=L.radius,R.shadowMapSize=L.mapSize,t.directionalShadowMap[f]=S,t.directionalShadowMatrix[f]=_.shadow.matrix,g++}t.directional[f]=R,f++}else if(_.isSpotLight){if((R=e.get(_)).position.setFromMatrixPosition(_.matrixWorld),R.position.applyMatrix4(b),R.color.copy(M).multiplyScalar(E),R.distance=T,R.direction.setFromMatrixPosition(_.matrixWorld),r.setFromMatrixPosition(_.target.matrixWorld),R.direction.sub(r),R.direction.transformDirection(b),R.coneCos=Math.cos(_.angle),R.penumbraCos=Math.cos(_.angle*(1-_.penumbra)),R.decay=_.decay,R.shadow=_.castShadow,_.castShadow){L=_.shadow;R.shadowBias=L.bias,R.shadowRadius=L.radius,R.shadowMapSize=L.mapSize,t.spotShadowMap[d]=S,t.spotShadowMatrix[d]=_.shadow.matrix,x++}t.spot[d]=R,d++}else if(_.isRectAreaLight){(R=e.get(_)).color.copy(M).multiplyScalar(E),R.position.setFromMatrixPosition(_.matrixWorld),R.position.applyMatrix4(b),a.identity(),i.copy(_.matrixWorld),i.premultiply(b),a.extractRotation(i),R.halfWidth.set(.5*_.width,0,0),R.halfHeight.set(0,.5*_.height,0),R.halfWidth.applyMatrix4(a),R.halfHeight.applyMatrix4(a),t.rectArea[m]=R,m++}else if(_.isPointLight){if((R=e.get(_)).position.setFromMatrixPosition(_.matrixWorld),R.position.applyMatrix4(b),R.color.copy(_.color).multiplyScalar(_.intensity),R.distance=_.distance,R.decay=_.decay,R.shadow=_.castShadow,_.castShadow){L=_.shadow;R.shadowBias=L.bias,R.shadowRadius=L.radius,R.shadowMapSize=L.mapSize,R.shadowCameraNear=L.camera.near,R.shadowCameraFar=L.camera.far,t.pointShadowMap[p]=S,t.pointShadowMatrix[p]=_.shadow.matrix,y++}t.point[p]=R,p++}else if(_.isHemisphereLight){var R;(R=e.get(_)).direction.setFromMatrixPosition(_.matrixWorld),R.direction.transformDirection(b),R.direction.normalize(),R.skyColor.copy(_.color).multiplyScalar(E),R.groundColor.copy(_.groundColor).multiplyScalar(E),t.hemi[v]=R,v++}}t.ambient[0]=c,t.ambient[1]=u,t.ambient[2]=l;var P=t.hash;P.directionalLength===f&&P.pointLength===p&&P.spotLength===d&&P.rectAreaLength===m&&P.hemiLength===v&&P.numDirectionalShadows===g&&P.numPointShadows===y&&P.numSpotShadows===x||(t.directional.length=f,t.spot.length=d,t.rectArea.length=m,t.point.length=p,t.hemi.length=v,t.directionalShadowMap.length=g,t.pointShadowMap.length=y,t.spotShadowMap.length=x,t.directionalShadowMatrix.length=g,t.pointShadowMatrix.length=y,t.spotShadowMatrix.length=x,P.directionalLength=f,P.pointLength=p,P.spotLength=d,P.rectAreaLength=m,P.hemiLength=v,P.numDirectionalShadows=g,P.numPointShadows=y,P.numSpotShadows=x,t.version=ns++)},state:t}}function as(){var e=new is,t=[],n=[];return{init:function(){t.length=0,n.length=0},state:{lightsArray:t,shadowsArray:n,lights:e},setupLights:function(r){e.setup(t,n,r)},pushLight:function(e){t.push(e)},pushShadow:function(e){n.push(e)}}}function os(){var e=new WeakMap;function t(n){var r=n.target;r.removeEventListener("dispose",t),e.delete(r)}return{get:function(n,r){var i;return!1===e.has(n)?(i=new as,e.set(n,new WeakMap),e.get(n).set(r,i),n.addEventListener("dispose",t)):!1===e.get(n).has(r)?(i=new as,e.get(n).set(r,i)):i=e.get(n).get(r),i},dispose:function(){e=new WeakMap}}}function ss(e){oi.call(this),this.type="MeshDepthMaterial",this.depthPacking=Wt,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}function cs(e){oi.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new kn,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}ss.prototype=Object.create(oi.prototype),ss.prototype.constructor=ss,ss.prototype.isMeshDepthMaterial=!0,ss.prototype.copy=function(e){return oi.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},cs.prototype=Object.create(oi.prototype),cs.prototype.constructor=cs,cs.prototype.isMeshDistanceMaterial=!0,cs.prototype.copy=function(e){return oi.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this};function us(e,t,n){var r=new pa,i=new Sn,a=new Sn,o=new Cn,s=[],c=[],u={},l={0:g,1:v,2:y},h=new aa({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Sn},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n  float mean = 0.0;\n  float squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );\n  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n    #ifdef HORIZONAL_PASS\n      vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n      mean += distribution.x;\n      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n    #else\n      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );\n      mean += depth;\n      squared_mean += depth * depth;\n    #endif\n  }\n  mean = mean * HALF_SAMPLE_RATE;\n  squared_mean = squared_mean * HALF_SAMPLE_RATE;\n  float std_dev = sqrt( squared_mean - mean * mean );\n  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),f=h.clone();f.defines.HORIZONAL_PASS=1;var d=new Li;d.setAttribute("position",new ui(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var x=new qi(d,h),b=this;function w(n,r){var i=t.update(x);h.uniforms.shadow_pass.value=n.map.texture,h.uniforms.resolution.value=n.mapSize,h.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,i,h,x,null),f.uniforms.shadow_pass.value=n.mapPass.texture,f.uniforms.resolution.value=n.mapSize,f.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,i,f,x,null)}function _(e,t,n){var r=e<<0|t<<1|n<<2,i=s[r];return void 0===i&&(i=new ss({depthPacking:qt,morphTargets:e,skinning:t}),s[r]=i),i}function M(e,t,n){var r=e<<0|t<<1|n<<2,i=c[r];return void 0===i&&(i=new cs({morphTargets:e,skinning:t}),c[r]=i),i}function T(t,n,r,i,a,o){var s=t.geometry,c=null,h=_,f=t.customDepthMaterial;if(!0===r.isPointLight&&(h=M,f=t.customDistanceMaterial),void 0===f){var p=!1;!0===n.morphTargets&&(!0===s.isBufferGeometry?p=s.morphAttributes&&s.morphAttributes.position&&s.morphAttributes.position.length>0:!0===s.isGeometry&&(p=s.morphTargets&&s.morphTargets.length>0));var d=!1;!0===t.isSkinnedMesh&&(!0===n.skinning?d=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t)),c=h(p,d,!0===t.isInstancedMesh)}else c=f;if(e.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length){var v=c.uuid,g=n.uuid,y=u[v];void 0===y&&(y={},u[v]=y);var x=y[g];void 0===x&&(x=c.clone(),y[g]=x),c=x}return c.visible=n.visible,c.wireframe=n.wireframe,c.side=o===m?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:l[n.side],c.clipShadows=n.clipShadows,c.clippingPlanes=n.clippingPlanes,c.clipIntersection=n.clipIntersection,c.wireframeLinewidth=n.wireframeLinewidth,c.linewidth=n.linewidth,!0===r.isPointLight&&!0===c.isMeshDistanceMaterial&&(c.referencePosition.setFromMatrixPosition(r.matrixWorld),c.nearDistance=i,c.farDistance=a),c}function S(n,i,a,o,s){if(!1!==n.visible){if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&s===m)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,n.matrixWorld);var c=t.update(n),u=n.material;if(Array.isArray(u))for(var l=c.groups,h=0,f=l.length;h<f;h++){var p=l[h],d=u[p.materialIndex];if(d&&d.visible){var v=T(n,d,o,a.near,a.far,s);e.renderBufferDirect(a,null,c,v,n,p)}}else if(u.visible){v=T(n,u,o,a.near,a.far,s);e.renderBufferDirect(a,null,c,v,n,null)}}for(var g=n.children,y=0,x=g.length;y<x;y++)S(g[y],i,a,o,s)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=p,this.render=function(t,s,c){if(!1!==b.enabled&&(!1!==b.autoUpdate||!1!==b.needsUpdate)&&0!==t.length){var u=e.getRenderTarget(),l=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),f=e.state;f.setBlending(E),f.buffers.color.setClear(1,1,1,1),f.buffers.depth.setTest(!0),f.setScissorTest(!1);for(var p=0,d=t.length;p<d;p++){var v=t[p],g=v.shadow;if(void 0!==g){i.copy(g.mapSize);var y=g.getFrameExtents();if(i.multiply(y),a.copy(g.mapSize),(i.x>n||i.y>n)&&(console.warn("THREE.WebGLShadowMap:",v,"has shadow exceeding max texture size, reducing"),i.x>n&&(a.x=Math.floor(n/y.x),i.x=a.x*y.x,g.mapSize.x=a.x),i.y>n&&(a.y=Math.floor(n/y.y),i.y=a.y*y.y,g.mapSize.y=a.y)),null===g.map&&!g.isPointLightShadow&&this.type===m){var x={minFilter:Te,magFilter:Te,format:Ve};g.map=new On(i.x,i.y,x),g.map.texture.name=v.name+".shadowMap",g.mapPass=new On(i.x,i.y,x),g.camera.updateProjectionMatrix()}if(null===g.map){x={minFilter:be,magFilter:be,format:Ve};g.map=new On(i.x,i.y,x),g.map.texture.name=v.name+".shadowMap",g.camera.updateProjectionMatrix()}e.setRenderTarget(g.map),e.clear();for(var _=g.getViewportCount(),M=0;M<_;M++){var T=g.getViewport(M);o.set(a.x*T.x,a.y*T.y,a.x*T.z,a.y*T.w),f.viewport(o),g.updateMatrices(v,M),r=g.getFrustum(),S(s,c,g.camera,v,this.type)}g.isPointLightShadow||this.type!==m||w(g,c)}else console.warn("THREE.WebGLShadowMap:",v,"has no shadow.")}b.needsUpdate=!1,e.setRenderTarget(u,l,h)}}}function ls(e,t,n){var r=n.isWebGL2;var i=new function(){var t=!1,n=new Cn,r=null,i=new Cn(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,a,o,s){!0===s&&(t*=o,r*=o,a*=o),n.set(t,r,a,o),!1===i.equals(n)&&(e.clearColor(t,r,a,o),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}},a=new function(){var t=!1,n=null,r=null,i=null;return{setTest:function(e){e?xe(2929):be(2929)},setMask:function(r){n===r||t||(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){if(t)switch(t){case q:e.depthFunc(512);break;case Y:e.depthFunc(519);break;case X:e.depthFunc(513);break;case Z:e.depthFunc(515);break;case J:e.depthFunc(514);break;case Q:e.depthFunc(518);break;case K:e.depthFunc(516);break;case $:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);r=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,n=null,r=null,i=null}}},u=new function(){var t=!1,n=null,r=null,i=null,a=null,o=null,s=null,c=null,u=null;return{setTest:function(e){t||(e?xe(2960):be(2960))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,o){r===t&&i===n&&a===o||(e.stencilFunc(t,n,o),r=t,i=n,a=o)},setOp:function(t,n,r){o===t&&s===n&&c===r||(e.stencilOp(t,n,r),o=t,s=n,c=r)},setLocked:function(e){t=e},setClear:function(t){u!==t&&(e.clearStencil(t),u=t)},reset:function(){t=!1,n=null,r=null,i=null,a=null,o=null,s=null,c=null,u=null}}},l=e.getParameter(34921),h=new Uint8Array(l),f=new Uint8Array(l),p=new Uint8Array(l),d={},m=null,v=null,x=null,b=null,w=null,_=null,M=null,ee=null,te=null,ne=!1,re=null,ie=null,ae=null,oe=null,se=null,ce=e.getParameter(35661),ue=!1,le=0,he=e.getParameter(7938);-1!==he.indexOf("WebGL")?(le=parseFloat(/^WebGL\ ([0-9])/.exec(he)[1]),ue=le>=1):-1!==he.indexOf("OpenGL ES")&&(le=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(he)[1]),ue=le>=2);var fe=null,pe={},de=new Cn,me=new Cn;function ve(t,n,r){var i=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(var o=0;o<r;o++)e.texImage2D(n+o,0,6408,1,1,0,6408,5121,i);return a}var ge={};function ye(n,i){(h[n]=1,0===f[n]&&(e.enableVertexAttribArray(n),f[n]=1),p[n]!==i)&&((r?e:t.get("ANGLE_instanced_arrays"))[r?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),p[n]=i)}function xe(t){!0!==d[t]&&(e.enable(t),d[t]=!0)}function be(t){!1!==d[t]&&(e.disable(t),d[t]=!1)}ge[3553]=ve(3553,3553,1),ge[34067]=ve(34067,34069,6),i.setClear(0,0,0,1),a.setClear(1),u.setClear(0),xe(2929),a.setFunc(Z),Te(!1),Se(s),xe(2884),Ee(E);var we={[P]:32774,[C]:32778,[O]:32779};if(r)we[D]=32775,we[I]=32776;else{var _e=t.get("EXT_blend_minmax");null!==_e&&(we[D]=_e.MIN_EXT,we[I]=_e.MAX_EXT)}var Me={[N]:0,[z]:1,[k]:768,[B]:770,[W]:776,[j]:774,[H]:772,[F]:769,[U]:771,[V]:775,[G]:773};function Ee(t,n,r,i,a,o,s,c){if(t!==E){if(v||(xe(3042),v=!0),t===R)a=a||n,o=o||r,s=s||i,n===b&&a===M||(e.blendEquationSeparate(we[n],we[a]),b=n,M=a),r===w&&i===_&&o===ee&&s===te||(e.blendFuncSeparate(Me[r],Me[i],Me[o],Me[s]),w=r,_=i,ee=o,te=s),x=t,ne=null;else if(t!==x||c!==ne){if(b===P&&M===P||(e.blendEquation(32774),b=P,M=P),c)switch(t){case T:e.blendFuncSeparate(1,771,1,771);break;case S:e.blendFunc(1,1);break;case A:e.blendFuncSeparate(0,0,769,771);break;case L:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case T:e.blendFuncSeparate(770,771,1,771);break;case S:e.blendFunc(770,1);break;case A:e.blendFunc(0,769);break;case L:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}w=null,_=null,ee=null,te=null,x=t,ne=c}}else v&&(be(3042),v=!1)}function Te(t){re!==t&&(t?e.frontFace(2304):e.frontFace(2305),re=t)}function Se(t){t!==o?(xe(2884),t!==ie&&(t===s?e.cullFace(1029):t===c?e.cullFace(1028):e.cullFace(1032))):be(2884),ie=t}function Ae(t,n,r){t?(xe(32823),oe===n&&se===r||(e.polygonOffset(n,r),oe=n,se=r)):be(32823)}function Le(t){void 0===t&&(t=33984+ce-1),fe!==t&&(e.activeTexture(t),fe=t)}return{buffers:{color:i,depth:a,stencil:u},initAttributes:function(){for(var e=0,t=h.length;e<t;e++)h[e]=0},enableAttribute:function(e){ye(e,0)},enableAttributeAndDivisor:ye,disableUnusedAttributes:function(){for(var t=0,n=f.length;t!==n;++t)f[t]!==h[t]&&(e.disableVertexAttribArray(t),f[t]=0)},enable:xe,disable:be,useProgram:function(t){return m!==t&&(e.useProgram(t),m=t,!0)},setBlending:Ee,setMaterial:function(e,t){e.side===y?be(2884):xe(2884);var n=e.side===g;t&&(n=!n),Te(n),e.blending===T&&!1===e.transparent?Ee(E):Ee(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),a.setFunc(e.depthFunc),a.setTest(e.depthTest),a.setMask(e.depthWrite),i.setMask(e.colorWrite);var r=e.stencilWrite;u.setTest(r),r&&(u.setMask(e.stencilWriteMask),u.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),u.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),Ae(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:Te,setCullFace:Se,setLineWidth:function(t){t!==ae&&(ue&&e.lineWidth(t),ae=t)},setPolygonOffset:Ae,setScissorTest:function(e){e?xe(3089):be(3089)},activeTexture:Le,bindTexture:function(t,n){null===fe&&Le();var r=pe[fe];void 0===r&&(r={type:void 0,texture:void 0},pe[fe]=r),r.type===t&&r.texture===n||(e.bindTexture(t,n||ge[t]),r.type=t,r.texture=n)},unbindTexture:function(){var t=pe[fe];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(t){!1===de.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),de.copy(t))},viewport:function(t){!1===me.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),me.copy(t))},reset:function(){for(var t=0;t<f.length;t++)1===f[t]&&(e.disableVertexAttribArray(t),f[t]=0);d={},fe=null,pe={},m=null,x=null,re=null,ie=null,i.reset(),a.reset(),u.reset()}}}function hs(e,t,n,r,i,a,o){var s,c=i.isWebGL2,u=i.maxTextures,l=i.maxCubemapSize,h=i.maxTextureSize,f=i.maxSamples,p=new WeakMap,d=!1;try{d="undefined"!==typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(B){}function m(e,t){return d?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function v(e,t,n,r){var i=1;if((e.width>r||e.height>r)&&(i=r/Math.max(e.width,e.height)),i<1||!0===t){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){var a=t?Tn.floorPowerOfTwo:Math.floor,o=a(i*e.width),c=a(i*e.height);void 0===s&&(s=m(o,c));var u=n?m(o,c):s;return u.width=o,u.height=c,u.getContext("2d").drawImage(e,0,0,o,c),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+c+")."),u}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function g(e){return Tn.isPowerOfTwo(e.width)&&Tn.isPowerOfTwo(e.height)}function y(e,t){return e.generateMipmaps&&t&&e.minFilter!==be&&e.minFilter!==Te}function x(t,n,i,a){e.generateMipmap(t),r.get(n).__maxMipLevel=Math.log(Math.max(i,a))*Math.LOG2E}function b(n,r,i){if(!1===c)return r;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}var a=r;return 6403===r&&(5126===i&&(a=33326),5131===i&&(a=33325),5121===i&&(a=33321)),6407===r&&(5126===i&&(a=34837),5131===i&&(a=34843),5121===i&&(a=32849)),6408===r&&(5126===i&&(a=34836),5131===i&&(a=34842),5121===i&&(a=32856)),33325===a||33326===a||34842===a||34836===a?t.get("EXT_color_buffer_float"):34843!==a&&34837!==a||console.warn("THREE.WebGLRenderer: Floating point textures with RGB format not supported. Please use RGBA instead."),a}function w(e){return e===be||e===we||e===Me?9728:9729}function _(t){var n=t.target;n.removeEventListener("dispose",_),function(t){var n=r.get(t);if(void 0===n.__webglInit)return;e.deleteTexture(n.__webglTexture),r.remove(t)}(n),n.isVideoTexture&&p.delete(n),o.memory.textures--}function M(t){var n=t.target;n.removeEventListener("dispose",M),function(t){var n=r.get(t),i=r.get(t.texture);if(!t)return;void 0!==i.__webglTexture&&e.deleteTexture(i.__webglTexture);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(var a=0;a<6;a++)e.deleteFramebuffer(n.__webglFramebuffer[a]),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[a]);else e.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer);if(t.isWebGLMultiviewRenderTarget){e.deleteTexture(n.__webglColorTexture),e.deleteTexture(n.__webglDepthStencilTexture),o.memory.textures-=2;a=0;for(var s=n.__webglViewFramebuffers.length;a<s;a++)e.deleteFramebuffer(n.__webglViewFramebuffers[a])}r.remove(t.texture),r.remove(t)}(n),o.memory.textures--}var E=0;function T(e,t){var i=r.get(e);if(e.isVideoTexture&&function(e){var t=o.render.frame;p.get(e)!==t&&(p.set(e,t),e.update())}(e),e.version>0&&i.__version!==e.version){var a=e.image;if(void 0===a)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==a.complete)return void O(i,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+t),n.bindTexture(3553,i.__webglTexture)}function S(t,i){if(6===t.image.length){var o=r.get(t);if(t.version>0&&o.__version!==t.version){C(o,t),n.activeTexture(33984+i),n.bindTexture(34067,o.__webglTexture),e.pixelStorei(37440,t.flipY);for(var s=t&&(t.isCompressedTexture||t.image[0].isCompressedTexture),u=t.image[0]&&t.image[0].isDataTexture,h=[],f=0;f<6;f++)h[f]=s||u?u?t.image[f].image:t.image[f]:v(t.image[f],!1,!0,l);var p,d=h[0],m=g(d)||c,w=a.convert(t.format),_=a.convert(t.type),M=b(t.internalFormat,w,_);if(P(34067,t,m),s){for(f=0;f<6;f++){p=h[f].mipmaps;for(var E=0;E<p.length;E++){var T=p[E];t.format!==Ve&&t.format!==je?null!==w?n.compressedTexImage2D(34069+f,E,M,T.width,T.height,0,T.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+f,E,M,T.width,T.height,0,w,_,T.data)}}o.__maxMipLevel=p.length-1}else{p=t.mipmaps;for(f=0;f<6;f++)if(u){n.texImage2D(34069+f,0,M,h[f].width,h[f].height,0,w,_,h[f].data);for(E=0;E<p.length;E++){var S=(T=p[E]).image[f].image;n.texImage2D(34069+f,E+1,M,S.width,S.height,0,w,_,S.data)}}else{n.texImage2D(34069+f,0,M,w,_,h[f]);for(E=0;E<p.length;E++){T=p[E];n.texImage2D(34069+f,E+1,M,w,_,T.image[f])}}o.__maxMipLevel=p.length}y(t,m)&&x(34067,t,d.width,d.height),o.__version=t.version,t.onUpdate&&t.onUpdate(t)}else n.activeTexture(33984+i),n.bindTexture(34067,o.__webglTexture)}}function A(e,t){n.activeTexture(33984+t),n.bindTexture(34067,r.get(e).__webglTexture)}var L={[ge]:10497,[ye]:33071,[xe]:33648},R={[be]:9728,[we]:9984,[Me]:9986,[Te]:9729,[Se]:9985,[Le]:9987};function P(n,a,o){o?(e.texParameteri(n,10242,L[a.wrapS]),e.texParameteri(n,10243,L[a.wrapT]),32879!==n&&35866!==n||e.texParameteri(n,32882,L[a.wrapR]),e.texParameteri(n,10240,R[a.magFilter]),e.texParameteri(n,10241,R[a.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),a.wrapS===ye&&a.wrapT===ye||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,w(a.magFilter)),e.texParameteri(n,10241,w(a.minFilter)),a.minFilter!==be&&a.minFilter!==Te&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));var s=t.get("EXT_texture_filter_anisotropic");if(s){if(a.type===ze&&null===t.get("OES_texture_float_linear"))return;if(a.type===ke&&null===(c||t.get("OES_texture_half_float_linear")))return;(a.anisotropy>1||r.get(a).__currentAnisotropy)&&(e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,i.getMaxAnisotropy())),r.get(a).__currentAnisotropy=a.anisotropy)}}function C(t,n){void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",_),t.__webglTexture=e.createTexture(),o.memory.textures++)}function O(t,r,i){var o=3553;r.isDataTexture2DArray&&(o=35866),r.isDataTexture3D&&(o=32879),C(t,r),n.activeTexture(33984+i),n.bindTexture(o,t.__webglTexture),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment);var s=function(e){return!c&&(e.wrapS!==ye||e.wrapT!==ye||e.minFilter!==be&&e.minFilter!==Te)}(r)&&!1===g(r.image),u=v(r.image,s,!1,h),l=g(u)||c,f=a.convert(r.format),p=a.convert(r.type),d=b(r.internalFormat,f,p);P(o,r,l);var m,w=r.mipmaps;if(r.isDepthTexture){if(d=6402,r.type===ze){if(!1===c)throw new Error("Float Depth Texture only supported in WebGL2.0");d=36012}else c&&(d=33189);r.format===Xe&&6402===d&&r.type!==De&&r.type!==Ne&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=De,p=a.convert(r.type)),r.format===Ze&&(d=34041,r.type!==He&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=He,p=a.convert(r.type))),n.texImage2D(3553,0,d,u.width,u.height,0,f,p,null)}else if(r.isDataTexture)if(w.length>0&&l){for(var _=0,M=w.length;_<M;_++)m=w[_],n.texImage2D(3553,_,d,m.width,m.height,0,f,p,m.data);r.generateMipmaps=!1,t.__maxMipLevel=w.length-1}else n.texImage2D(3553,0,d,u.width,u.height,0,f,p,u.data),t.__maxMipLevel=0;else if(r.isCompressedTexture){for(_=0,M=w.length;_<M;_++)m=w[_],r.format!==Ve&&r.format!==je?null!==f?n.compressedTexImage2D(3553,_,d,m.width,m.height,0,m.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,_,d,m.width,m.height,0,f,p,m.data);t.__maxMipLevel=w.length-1}else if(r.isDataTexture2DArray)n.texImage3D(35866,0,d,u.width,u.height,u.depth,0,f,p,u.data),t.__maxMipLevel=0;else if(r.isDataTexture3D)n.texImage3D(32879,0,d,u.width,u.height,u.depth,0,f,p,u.data),t.__maxMipLevel=0;else if(w.length>0&&l){for(_=0,M=w.length;_<M;_++)m=w[_],n.texImage2D(3553,_,d,f,p,m);r.generateMipmaps=!1,t.__maxMipLevel=w.length-1}else n.texImage2D(3553,0,d,f,p,u),t.__maxMipLevel=0;y(r,l)&&x(o,r,u.width,u.height),t.__version=r.version,r.onUpdate&&r.onUpdate(r)}function D(t,i,o,s){var c=a.convert(i.texture.format),u=a.convert(i.texture.type),l=b(i.texture.internalFormat,c,u);n.texImage2D(s,0,l,i.width,i.height,0,c,u,null),e.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,o,s,r.get(i.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function I(t,n,r){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){if(r){var i=z(n);e.renderbufferStorageMultisample(36161,i,33189,n.width,n.height)}else e.renderbufferStorage(36161,33189,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){if(r){i=z(n);e.renderbufferStorageMultisample(36161,i,35056,n.width,n.height)}else e.renderbufferStorage(36161,34041,n.width,n.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{var o=a.convert(n.texture.format),s=a.convert(n.texture.type),c=b(n.texture.internalFormat,o,s);if(r){i=z(n);e.renderbufferStorageMultisample(36161,i,c,n.width,n.height)}else e.renderbufferStorage(36161,c,n.width,n.height)}e.bindRenderbuffer(36161,null)}function N(t){var n=r.get(t),i=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,n){if(n&&n.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,t),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),T(n.depthTexture,0);var i=r.get(n.depthTexture).__webglTexture;if(n.depthTexture.format===Xe)e.framebufferTexture2D(36160,36096,3553,i,0);else{if(n.depthTexture.format!==Ze)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,i,0)}}(n.__webglFramebuffer,t)}else if(i){n.__webglDepthbuffer=[];for(var a=0;a<6;a++)e.bindFramebuffer(36160,n.__webglFramebuffer[a]),n.__webglDepthbuffer[a]=e.createRenderbuffer(),I(n.__webglDepthbuffer[a],t)}else e.bindFramebuffer(36160,n.__webglFramebuffer),n.__webglDepthbuffer=e.createRenderbuffer(),I(n.__webglDepthbuffer,t);e.bindFramebuffer(36160,null)}function z(e){return c&&e.isWebGLMultisampleRenderTarget?Math.min(f,e.samples):0}var k=!1,F=!1;this.allocateTextureUnit=function(){var e=E;return e>=u&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+u),E+=1,e},this.resetTextureUnits=function(){E=0},this.setTexture2D=T,this.setTexture2DArray=function(e,t){var i=r.get(e);e.version>0&&i.__version!==e.version?O(i,e,t):(n.activeTexture(33984+t),n.bindTexture(35866,i.__webglTexture))},this.setTexture3D=function(e,t){var i=r.get(e);e.version>0&&i.__version!==e.version?O(i,e,t):(n.activeTexture(33984+t),n.bindTexture(32879,i.__webglTexture))},this.setTextureCube=S,this.setTextureCubeDynamic=A,this.setupRenderTarget=function(i){var s=r.get(i),u=r.get(i.texture);i.addEventListener("dispose",M),u.__webglTexture=e.createTexture(),o.memory.textures++;var l=!0===i.isWebGLCubeRenderTarget,h=!0===i.isWebGLMultisampleRenderTarget,f=!0===i.isWebGLMultiviewRenderTarget,p=g(i)||c;if(l){s.__webglFramebuffer=[];for(var d=0;d<6;d++)s.__webglFramebuffer[d]=e.createFramebuffer()}else if(s.__webglFramebuffer=e.createFramebuffer(),h)if(c){s.__webglMultisampledFramebuffer=e.createFramebuffer(),s.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,s.__webglColorRenderbuffer);var m=a.convert(i.texture.format),v=a.convert(i.texture.type),w=b(i.texture.internalFormat,m,v),_=z(i);e.renderbufferStorageMultisample(36161,_,w,i.width,i.height),e.bindFramebuffer(36160,s.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,s.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),i.depthBuffer&&(s.__webglDepthRenderbuffer=e.createRenderbuffer(),I(s.__webglDepthRenderbuffer,i,!0)),e.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");else if(f){var E=i.width,T=i.height,S=i.numViews;e.bindFramebuffer(36160,s.__webglFramebuffer);var A=t.get("OVR_multiview2");o.memory.textures+=2;var L=e.createTexture();e.bindTexture(35866,L),e.texParameteri(35866,10240,9728),e.texParameteri(35866,10241,9728),e.texImage3D(35866,0,32856,E,T,S,0,6408,5121,null),A.framebufferTextureMultiviewOVR(36160,36064,L,0,0,S);var R=e.createTexture();e.bindTexture(35866,R),e.texParameteri(35866,10240,9728),e.texParameteri(35866,10241,9728),e.texImage3D(35866,0,35056,E,T,S,0,34041,34042,null),A.framebufferTextureMultiviewOVR(36160,33306,R,0,0,S);var C=new Array(S);for(d=0;d<S;++d)C[d]=e.createFramebuffer(),e.bindFramebuffer(36160,C[d]),e.framebufferTextureLayer(36160,36064,L,0,d);s.__webglColorTexture=L,s.__webglDepthStencilTexture=R,s.__webglViewFramebuffers=C,e.bindFramebuffer(36160,null),e.bindTexture(35866,null)}if(l){n.bindTexture(34067,u.__webglTexture),P(34067,i.texture,p);for(d=0;d<6;d++)D(s.__webglFramebuffer[d],i,36064,34069+d);y(i.texture,p)&&x(34067,i.texture,i.width,i.height),n.bindTexture(34067,null)}else f||(n.bindTexture(3553,u.__webglTexture),P(3553,i.texture,p),D(s.__webglFramebuffer,i,36064,3553),y(i.texture,p)&&x(3553,i.texture,i.width,i.height),n.bindTexture(3553,null));i.depthBuffer&&N(i)},this.updateRenderTargetMipmap=function(e){var t=e.texture;if(y(t,g(e)||c)){var i=e.isWebGLCubeRenderTarget?34067:3553,a=r.get(t).__webglTexture;n.bindTexture(i,a),x(i,t,e.width,e.height),n.bindTexture(i,null)}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(c){var n=r.get(t);e.bindFramebuffer(36008,n.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,n.__webglFramebuffer);var i=t.width,a=t.height,o=16384;t.depthBuffer&&(o|=256),t.stencilBuffer&&(o|=1024),e.blitFramebuffer(0,0,i,a,0,0,i,a,o,9728)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===k&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),k=!0),e=e.texture),T(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===F&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),F=!0),e=e.texture),e&&e.isCubeTexture||Array.isArray(e.image)&&6===e.image.length?S(e,t):A(e,t)}}function fs(e,t,n){var r=n.isWebGL2;return{convert:function(e){var n;if(e===Pe)return 5121;if(e===Fe)return 32819;if(e===Be)return 32820;if(e===Ue)return 33635;if(e===Ce)return 5120;if(e===Oe)return 5122;if(e===De)return 5123;if(e===Ie)return 5124;if(e===Ne)return 5125;if(e===ze)return 5126;if(e===ke)return r?5131:null!==(n=t.get("OES_texture_half_float"))?n.HALF_FLOAT_OES:null;if(e===Ge)return 6406;if(e===je)return 6407;if(e===Ve)return 6408;if(e===We)return 6409;if(e===qe)return 6410;if(e===Xe)return 6402;if(e===Ze)return 34041;if(e===Je)return 6403;if(e===Qe)return 36244;if(e===Ke)return 33319;if(e===$e)return 33320;if(e===et)return 36248;if(e===tt)return 36249;if(e===nt||e===rt||e===it||e===at){if(null===(n=t.get("WEBGL_compressed_texture_s3tc")))return null;if(e===nt)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===rt)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===it)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===at)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===ot||e===st||e===ct||e===ut){if(null===(n=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(e===ot)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===st)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===ct)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===ut)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}return e===lt?null!==(n=t.get("WEBGL_compressed_texture_etc1"))?n.COMPRESSED_RGB_ETC1_WEBGL:null:e===ht||e===ft||e===pt||e===dt||e===mt||e===vt||e===gt||e===yt||e===xt||e===bt||e===wt||e===_t||e===Mt||e===Et?null!==(n=t.get("WEBGL_compressed_texture_astc"))?e:null:e===He?r?34042:null!==(n=t.get("WEBGL_depth_texture"))?n.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function ps(e,t,n,r){On.call(this,e,t,r),this.depthBuffer=!1,this.stencilBuffer=!1,this.numViews=n}function ds(e,t){var n,r,i,a,o,s,c,u=e.extensions,l=e.properties,h=0;function f(e){return e.isArrayCamera?e.cameras:(o[0]=e,o)}this.isAvailable=function(){if(void 0===c){var e=u.get("OVR_multiview2");if(c=null!==e&&!1===t.getContextAttributes().antialias){h=t.getParameter(e.MAX_VIEWS_OVR),n=new ps(0,0,2),s=new Sn,a=[],i=[],o=[];for(var r=0;r<h;r++)a[r]=new Wn,i[r]=new An}}return c},this.attachCamera=function(t){!1!==function(e){if(void 0===e.isArrayCamera)return!0;var t=e.cameras;if(t.length>h)return!1;for(var n=1,r=t.length;n<r;n++)if(t[0].viewport.z!==t[n].viewport.z||t[0].viewport.w!==t[n].viewport.w)return!1;return!0}(t)&&(r=e.getRenderTarget(),function(t){if(r?s.set(r.width,r.height):e.getDrawingBufferSize(s),t.isArrayCamera){var i=t.cameras[0].viewport;n.setSize(i.z,i.w),n.setNumViews(t.cameras.length)}else n.setSize(s.x,s.y),n.setNumViews(2)}(t),e.setRenderTarget(n))},this.detachCamera=function(i){n===e.getRenderTarget()&&(e.setRenderTarget(r),function(e){var r=n,i=r.numViews,a=l.get(r).__webglViewFramebuffers,o=r.width,c=r.height;if(e.isArrayCamera)for(var u=0;u<i;u++){var h=e.cameras[u].viewport,f=h.x,p=h.y,d=f+h.z,m=p+h.w;t.bindFramebuffer(36008,a[u]),t.blitFramebuffer(0,0,o,c,f,p,d,m,16384,9728)}else t.bindFramebuffer(36008,a[0]),t.blitFramebuffer(0,0,o,c,0,0,s.x,s.y,16384,9728)}(i))},this.updateCameraProjectionMatricesUniform=function(e,n){for(var r=f(e),i=0;i<r.length;i++)a[i].copy(r[i].projectionMatrix);n.setValue(t,"projectionMatrices",a)},this.updateCameraViewMatricesUniform=function(e,n){for(var r=f(e),i=0;i<r.length;i++)a[i].copy(r[i].matrixWorldInverse);n.setValue(t,"viewMatrices",a)},this.updateObjectMatricesUniforms=function(e,n,r){for(var o=f(n),s=0;s<o.length;s++)a[s].multiplyMatrices(o[s].matrixWorldInverse,e.matrixWorld),i[s].getNormalMatrix(a[s]);r.setValue(t,"modelViewMatrices",a),r.setValue(t,"normalMatrices",i)}}function ms(e){sa.call(this),this.cameras=e||[]}function vs(){ur.call(this),this.type="Group"}function gs(e,t){var n=this,r=null,i=null,a="local-floor",o=null,s=[],c=new Map,u=new sa;u.layers.enable(1),u.viewport=new Cn;var l=new sa;l.layers.enable(2),l.viewport=new Cn;var h=new ms([u,l]);h.layers.enable(1),h.layers.enable(2);var f=null,p=null;function d(e){var t=c.get(e.inputSource);t&&(t.targetRay&&t.targetRay.dispatchEvent({type:e.type}),t.grip&&t.grip.dispatchEvent({type:e.type}))}function m(){c.forEach((function(e,t){e.targetRay&&(e.targetRay.dispatchEvent({type:"disconnected",data:t}),e.targetRay.visible=!1),e.grip&&(e.grip.dispatchEvent({type:"disconnected",data:t}),e.grip.visible=!1)})),c.clear(),e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),_.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function v(e){i=e,_.setContext(r),_.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}function g(e){for(var t=r.inputSources,n=0;n<s.length;n++)c.set(t[n],s[n]);for(n=0;n<e.removed.length;n++){var i=e.removed[n];(a=c.get(i))&&(a.targetRay&&a.targetRay.dispatchEvent({type:"disconnected",data:i}),a.grip&&a.grip.dispatchEvent({type:"disconnected",data:i}),c.delete(i))}for(n=0;n<e.added.length;n++){var a;i=e.added[n];(a=c.get(i))&&(a.targetRay&&a.targetRay.dispatchEvent({type:"connected",data:i}),a.grip&&a.grip.dispatchEvent({type:"connected",data:i}))}}this.enabled=!1,this.isPresenting=!1,this.getController=function(e){var t=s[e];return void 0===t&&(t={},s[e]=t),void 0===t.targetRay&&(t.targetRay=new vs,t.targetRay.matrixAutoUpdate=!1,t.targetRay.visible=!1),t.targetRay},this.getControllerGrip=function(e){var t=s[e];return void 0===t&&(t={},s[e]=t),void 0===t.grip&&(t.grip=new vs,t.grip.matrixAutoUpdate=!1,t.grip.visible=!1),t.grip},this.setFramebufferScaleFactor=function(){},this.setReferenceSpaceType=function(e){a=e},this.getReferenceSpace=function(){return i},this.getSession=function(){return r},this.setSession=function(e){if(null!==(r=e)){r.addEventListener("select",d),r.addEventListener("selectstart",d),r.addEventListener("selectend",d),r.addEventListener("squeeze",d),r.addEventListener("squeezestart",d),r.addEventListener("squeezeend",d),r.addEventListener("end",m);var n=t.getContextAttributes(),i={antialias:n.antialias,alpha:n.alpha,depth:n.depth,stencil:n.stencil},o=new XRWebGLLayer(r,t,i);r.updateRenderState({baseLayer:o}),r.requestReferenceSpace(a).then(v),r.addEventListener("inputsourceschange",g)}};var y=new kn,x=new kn;function b(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.getInverse(e.matrixWorld)}this.getCamera=function(e){h.near=l.near=u.near=e.near,h.far=l.far=u.far=e.far,f===h.near&&p===h.far||(r.updateRenderState({depthNear:h.near,depthFar:h.far}),f=h.near,p=h.far);var t=e.parent,n=h.cameras;b(h,t);for(var i=0;i<n.length;i++)b(n[i],t);e.matrixWorld.copy(h.matrixWorld);for(var a=e.children,o=(i=0,a.length);i<o;i++)a[i].updateMatrixWorld(!0);return function(e,t,n){y.setFromMatrixPosition(t.matrixWorld),x.setFromMatrixPosition(n.matrixWorld);var r=y.distanceTo(x),i=t.projectionMatrix.elements,a=n.projectionMatrix.elements,o=i[14]/(i[10]-1),s=i[14]/(i[10]+1),c=(i[9]+1)/i[5],u=(i[9]-1)/i[5],l=(i[8]-1)/i[0],h=(a[8]+1)/a[0],f=o*l,p=o*h,d=r/(-l+h),m=d*-l;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(d),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.getInverse(e.matrixWorld);var v=o+d,g=s+d,b=f-m,w=p+(r-m),_=c*s/g*v,M=u*s/g*v;e.projectionMatrix.makePerspective(b,w,_,M,v,g)}(h,u,l),h};var w=null;var _=new ma;_.setAnimationLoop((function(t,n){if(null!==(o=n.getViewerPose(i))){var a=o.views,c=r.renderState.baseLayer;e.setFramebuffer(c.framebuffer);for(var u=0;u<a.length;u++){var l=a[u],f=c.getViewport(l),p=h.cameras[u];p.matrix.fromArray(l.transform.matrix),p.projectionMatrix.fromArray(l.projectionMatrix),p.viewport.set(f.x,f.y,f.width,f.height),0===u&&h.matrix.copy(p.matrix)}}var d=r.inputSources;for(u=0;u<s.length;u++){var m=s[u],v=d[u],g=null,y=null;v&&(m.targetRay&&null!==(g=n.getPose(v.targetRaySpace,i))&&(m.targetRay.matrix.fromArray(g.transform.matrix),m.targetRay.matrix.decompose(m.targetRay.position,m.targetRay.rotation,m.targetRay.scale)),m.grip&&v.gripSpace&&null!==(y=n.getPose(v.gripSpace,i))&&(m.grip.matrix.fromArray(y.transform.matrix),m.grip.matrix.decompose(m.grip.position,m.grip.rotation,m.grip.scale))),m.targetRay&&(m.targetRay.visible=null!==g),m.grip&&(m.grip.visible=null!==y)}w&&w(t,n)})),this.setAnimationLoop=function(e){w=e},this.dispose=function(){}}function ys(e){var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=void 0!==e.context?e.context:null,r=void 0!==e.alpha&&e.alpha,i=void 0===e.depth||e.depth,a=void 0===e.stencil||e.stencil,o=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,c=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,u=void 0!==e.powerPreference?e.powerPreference:"default",l=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat,h=null,f=null;this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=kt,this.physicallyCorrectLights=!1,this.toneMapping=ie,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var p,d,m,v,y,x,b,w,_,M,E,T,S,A,L,R,P,C,O=this,D=!1,I=null,N=0,z=0,k=null,F=null,B=-1,U={geometry:null,program:null,wireframe:!1},H=null,G=null,j=new Cn,V=new Cn,W=null,q=t.width,Y=t.height,X=1,Z=null,J=null,Q=new Cn(0,0,q,Y),K=new Cn(0,0,q,Y),$=!1,ee=new pa,te=new Ea,ne=!1,re=!1,ae=new Wn,oe=new kn;function se(){return null===k?X:1}try{var ce={alpha:r,depth:i,stencil:a,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:c,powerPreference:u,failIfMajorPerformanceCaveat:l,xrCompatible:!0};if(t.addEventListener("webglcontextlost",pe,!1),t.addEventListener("webglcontextrestored",de,!1),null===(p=n||t.getContext("webgl",ce)||t.getContext("experimental-webgl",ce)))throw null!==t.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===p.getShaderPrecisionFormat&&(p.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Ae){throw console.error("THREE.WebGLRenderer: "+Ae.message),Ae}function ue(){d=new Ta(p),!1===(m=new Ma(p,d,e)).isWebGL2&&(d.get("WEBGL_depth_texture"),d.get("OES_texture_float"),d.get("OES_texture_half_float"),d.get("OES_texture_half_float_linear"),d.get("OES_standard_derivatives"),d.get("OES_element_index_uint"),d.get("ANGLE_instanced_arrays")),d.get("OES_texture_float_linear"),C=new fs(p,d,m),(v=new ls(p,d,m)).scissor(V.copy(K).multiplyScalar(X).floor()),v.viewport(j.copy(Q).multiplyScalar(X).floor()),y=new La(p),x=new Jo,b=new hs(p,d,v,x,m,C,y),w=new va(p,m),_=new Sa(p,w,y),M=new Ca(p,_,w,y),L=new Pa(p),E=new Zo(O,d,m),T=new es,S=new os,A=new wa(O,v,M,s),R=new _a(p,d,y,m),P=new Aa(p,d,y,m),y.programs=E.programs,O.capabilities=m,O.extensions=d,O.properties=x,O.renderLists=T,O.state=v,O.info=y}ue();var le=new gs(O,p);this.xr=le;var he=new ds(O,p),fe=new us(O,M,m.maxTextureSize);function pe(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),D=!0}function de(){console.log("THREE.WebGLRenderer: Context Restored."),D=!1,ue()}function me(e){var t=e.target;t.removeEventListener("dispose",me),function(e){ve(e),x.remove(e)}(t)}function ve(e){var t=x.get(e).program;e.program=void 0,void 0!==t&&E.releaseProgram(t)}this.shadowMap=fe,this.getContext=function(){return p},this.getContextAttributes=function(){return p.getContextAttributes()},this.forceContextLoss=function(){var e=d.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=d.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return X},this.setPixelRatio=function(e){void 0!==e&&(X=e,this.setSize(q,Y,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new Sn),e.set(q,Y)},this.setSize=function(e,n,r){le.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(q=e,Y=n,t.width=Math.floor(e*X),t.height=Math.floor(n*X),!1!==r&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new Sn),e.set(q*X,Y*X).floor()},this.setDrawingBufferSize=function(e,n,r){q=e,Y=n,X=r,t.width=Math.floor(e*r),t.height=Math.floor(n*r),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new Cn),e.copy(j)},this.getViewport=function(e){return e.copy(Q)},this.setViewport=function(e,t,n,r){e.isVector4?Q.set(e.x,e.y,e.z,e.w):Q.set(e,t,n,r),v.viewport(j.copy(Q).multiplyScalar(X).floor())},this.getScissor=function(e){return e.copy(K)},this.setScissor=function(e,t,n,r){e.isVector4?K.set(e.x,e.y,e.z,e.w):K.set(e,t,n,r),v.scissor(V.copy(K).multiplyScalar(X).floor())},this.getScissorTest=function(){return $},this.setScissorTest=function(e){v.setScissorTest($=e)},this.setOpaqueSort=function(e){Z=e},this.setTransparentSort=function(e){J=e},this.getClearColor=function(){return A.getClearColor()},this.setClearColor=function(){A.setClearColor.apply(A,arguments)},this.getClearAlpha=function(){return A.getClearAlpha()},this.setClearAlpha=function(){A.setClearAlpha.apply(A,arguments)},this.clear=function(e,t,n){var r=0;(void 0===e||e)&&(r|=16384),(void 0===t||t)&&(r|=256),(void 0===n||n)&&(r|=1024),p.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",pe,!1),t.removeEventListener("webglcontextrestored",de,!1),T.dispose(),S.dispose(),x.dispose(),M.dispose(),le.dispose(),xe.stop()},this.renderBufferImmediate=function(e,t){v.initAttributes();var n=x.get(e);e.hasPositions&&!n.position&&(n.position=p.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=p.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=p.createBuffer()),e.hasColors&&!n.color&&(n.color=p.createBuffer());var r=t.getAttributes();e.hasPositions&&(p.bindBuffer(34962,n.position),p.bufferData(34962,e.positionArray,35048),v.enableAttribute(r.position),p.vertexAttribPointer(r.position,3,5126,!1,0,0)),e.hasNormals&&(p.bindBuffer(34962,n.normal),p.bufferData(34962,e.normalArray,35048),v.enableAttribute(r.normal),p.vertexAttribPointer(r.normal,3,5126,!1,0,0)),e.hasUvs&&(p.bindBuffer(34962,n.uv),p.bufferData(34962,e.uvArray,35048),v.enableAttribute(r.uv),p.vertexAttribPointer(r.uv,2,5126,!1,0,0)),e.hasColors&&(p.bindBuffer(34962,n.color),p.bufferData(34962,e.colorArray,35048),v.enableAttribute(r.color),p.vertexAttribPointer(r.color,3,5126,!1,0,0)),v.disableUnusedAttributes(),p.drawArrays(4,0,e.count),e.count=0};var ge=new lr;this.renderBufferDirect=function(e,t,n,r,i,a){null===t&&(t=ge);var o=i.isMesh&&i.matrixWorld.determinant()<0,s=Ee(e,t,r,i);v.setMaterial(r,o);var c=!1;U.geometry===n.id&&U.program===s.id&&U.wireframe===(!0===r.wireframe)||(U.geometry=n.id,U.program=s.id,U.wireframe=!0===r.wireframe,c=!0),(r.morphTargets||r.morphNormals)&&(L.update(i,n,r,s),c=!0);var u=n.index,l=n.attributes.position;if(null===u){if(void 0===l||0===l.count)return}else if(0===u.count)return;var h,f=1;!0===r.wireframe&&(u=_.getWireframeAttribute(n),f=2);var g=R;null!==u&&(h=w.get(u),(g=P).setIndex(h)),c&&(!function(e,t,n,r){if(!1===m.isWebGL2&&(e.isInstancedMesh||t.isInstancedBufferGeometry)&&null===d.get("ANGLE_instanced_arrays"))return;v.initAttributes();var i=t.attributes,a=r.getAttributes(),o=n.defaultAttributeValues;for(var s in a){var c=a[s];if(c>=0){var u=i[s];if(void 0!==u){var l=u.normalized,h=u.itemSize;if(void 0===(M=w.get(u)))continue;var f=M.buffer,g=M.type,y=M.bytesPerElement;if(u.isInterleavedBufferAttribute){var x=u.data,b=x.stride,_=u.offset;x&&x.isInstancedInterleavedBuffer?(v.enableAttributeAndDivisor(c,x.meshPerAttribute),void 0===t.maxInstancedCount&&(t.maxInstancedCount=x.meshPerAttribute*x.count)):v.enableAttribute(c),p.bindBuffer(34962,f),p.vertexAttribPointer(c,h,g,l,b*y,_*y)}else u.isInstancedBufferAttribute?(v.enableAttributeAndDivisor(c,u.meshPerAttribute),void 0===t.maxInstancedCount&&(t.maxInstancedCount=u.meshPerAttribute*u.count)):v.enableAttribute(c),p.bindBuffer(34962,f),p.vertexAttribPointer(c,h,g,l,0,0)}else if("instanceMatrix"===s){var M;if(void 0===(M=w.get(e.instanceMatrix)))continue;f=M.buffer,g=M.type;v.enableAttributeAndDivisor(c+0,1),v.enableAttributeAndDivisor(c+1,1),v.enableAttributeAndDivisor(c+2,1),v.enableAttributeAndDivisor(c+3,1),p.bindBuffer(34962,f),p.vertexAttribPointer(c+0,4,g,!1,64,0),p.vertexAttribPointer(c+1,4,g,!1,64,16),p.vertexAttribPointer(c+2,4,g,!1,64,32),p.vertexAttribPointer(c+3,4,g,!1,64,48)}else if(void 0!==o){var E=o[s];if(void 0!==E)switch(E.length){case 2:p.vertexAttrib2fv(c,E);break;case 3:p.vertexAttrib3fv(c,E);break;case 4:p.vertexAttrib4fv(c,E);break;default:p.vertexAttrib1fv(c,E)}}}}v.disableUnusedAttributes()}(i,n,r,s),null!==u&&p.bindBuffer(34963,h.buffer));var y=null!==u?u.count:l.count,x=n.drawRange.start*f,b=n.drawRange.count*f,M=null!==a?a.start*f:0,E=null!==a?a.count*f:1/0,T=Math.max(x,M),S=Math.min(y,x+b,M+E)-1,A=Math.max(0,S-T+1);if(0!==A){if(i.isMesh)!0===r.wireframe?(v.setLineWidth(r.wireframeLinewidth*se()),g.setMode(1)):g.setMode(4);else if(i.isLine){var C=r.linewidth;void 0===C&&(C=1),v.setLineWidth(C*se()),i.isLineSegments?g.setMode(1):i.isLineLoop?g.setMode(2):g.setMode(3)}else i.isPoints?g.setMode(0):i.isSprite&&g.setMode(4);i.isInstancedMesh?g.renderInstances(n,T,A,i.count):n.isInstancedBufferGeometry?g.renderInstances(n,T,A,n.maxInstancedCount):g.render(T,A)}},this.compile=function(e,t){(f=S.get(e,t)).init(),e.traverse((function(e){e.isLight&&(f.pushLight(e),e.castShadow&&f.pushShadow(e))})),f.setupLights(t);var n={};e.traverse((function(t){if(t.material)if(Array.isArray(t.material))for(var r=0;r<t.material.length;r++)t.material[r].uuid in n===!1&&(Me(t.material[r],e,t),n[t.material[r].uuid]=!0);else t.material.uuid in n===!1&&(Me(t.material,e,t),n[t.material.uuid]=!0)}))};var ye=null;var xe=new ma;function be(e,t,n,r){if(!1!==e.visible){if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)f.pushLight(e),e.castShadow&&f.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||ee.intersectsSprite(e)){r&&oe.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ae);var i=M.update(e);(a=e.material).visible&&h.push(e,i,a,n,oe.z,null)}}else if(e.isImmediateRenderObject)r&&oe.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ae),h.push(e,null,e.material,n,oe.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==y.render.frame&&(e.skeleton.update(),e.skeleton.frame=y.render.frame),!e.frustumCulled||ee.intersectsObject(e))){r&&oe.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ae);i=M.update(e);var a=e.material;if(Array.isArray(a))for(var o=i.groups,s=0,c=o.length;s<c;s++){var u=o[s],l=a[u.materialIndex];l&&l.visible&&h.push(e,i,l,n,oe.z,u)}else a.visible&&h.push(e,i,a,n,oe.z,null)}var p=e.children;for(s=0,c=p.length;s<c;s++)be(p[s],t,n,r)}}function we(e,t,n,r){for(var i=0,a=e.length;i<a;i++){var o=e[i],s=o.object,c=o.geometry,u=void 0===r?o.material:r,l=o.group;if(n.isArrayCamera)if(G=n,le.enabled&&he.isAvailable())_e(s,t,n,c,u,l);else for(var h=n.cameras,p=0,d=h.length;p<d;p++){var m=h[p];s.layers.test(m.layers)&&(v.viewport(j.copy(m.viewport)),f.setupLights(m),_e(s,t,m,c,u,l))}else G=null,_e(s,t,n,c,u,l)}}function _e(e,t,n,r,i,a){if(e.onBeforeRender(O,t,n,r,i,a),f=S.get(t,G||n),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){var o=Ee(n,t,i,e);v.setMaterial(i),U.geometry=null,U.program=null,U.wireframe=!1,function(e,t){e.render((function(e){O.renderBufferImmediate(e,t)}))}(e,o)}else O.renderBufferDirect(n,t,r,i,e,a);e.onAfterRender(O,t,n,r,i,a),f=S.get(t,G||n)}function Me(e,t,n){var r=x.get(e),i=f.state.lights,a=f.state.shadowsArray,o=i.state.version,s=E.getParameters(e,i.state,a,t,te.numPlanes,te.numIntersection,n),c=E.getProgramCacheKey(s),u=r.program,l=!0;if(void 0===u)e.addEventListener("dispose",me);else if(u.cacheKey!==c)ve(e);else if(r.lightsStateVersion!==o)r.lightsStateVersion=o,l=!1;else{if(void 0!==s.shaderID)return;l=!1}l&&(u=E.acquireProgram(s,c),r.program=u,r.uniforms=s.uniforms,r.environment=e.isMeshStandardMaterial?t.environment:null,r.outputEncoding=O.outputEncoding,e.program=u);var h=u.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var p=0;p<O.maxMorphTargets;p++)h["morphTarget"+p]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;for(p=0;p<O.maxMorphNormals;p++)h["morphNormal"+p]>=0&&e.numSupportedMorphNormals++}var d=r.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(r.numClippingPlanes=te.numPlanes,r.numIntersection=te.numIntersection,d.clippingPlanes=te.uniform),r.fog=t.fog,r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=o,r.needsLights&&(d.ambientLightColor.value=i.state.ambient,d.lightProbe.value=i.state.probe,d.directionalLights.value=i.state.directional,d.spotLights.value=i.state.spot,d.rectAreaLights.value=i.state.rectArea,d.pointLights.value=i.state.point,d.hemisphereLights.value=i.state.hemi,d.directionalShadowMap.value=i.state.directionalShadowMap,d.directionalShadowMatrix.value=i.state.directionalShadowMatrix,d.spotShadowMap.value=i.state.spotShadowMap,d.spotShadowMatrix.value=i.state.spotShadowMatrix,d.pointShadowMap.value=i.state.pointShadowMap,d.pointShadowMatrix.value=i.state.pointShadowMatrix);var m=r.program.getUniforms(),v=Po.seqWithValue(m.seq,d);r.uniformsList=v}function Ee(e,t,n,r){b.resetTextureUnits();var i=t.fog,a=n.isMeshStandardMaterial?t.environment:null,o=x.get(n),s=f.state.lights;if(ne&&(re||e!==H)){var c=e===H&&n.id===B;te.setState(n.clippingPlanes,n.clipIntersection,n.clipShadows,e,o,c)}n.version===o.__version?void 0===o.program||n.fog&&o.fog!==i||o.environment!==a||o.needsLights&&o.lightsStateVersion!==s.state.version?Me(n,t,r):void 0===o.numClippingPlanes||o.numClippingPlanes===te.numPlanes&&o.numIntersection===te.numIntersection?o.outputEncoding!==O.outputEncoding&&Me(n,t,r):Me(n,t,r):(Me(n,t,r),o.__version=n.version);var u,l,h=!1,d=!1,y=!1,w=o.program,_=w.getUniforms(),M=o.uniforms;if(v.useProgram(w.program)&&(h=!0,d=!0,y=!0),n.id!==B&&(B=n.id,d=!0),h||H!==e){if(w.numMultiviewViews>0?he.updateCameraProjectionMatricesUniform(e,_):_.setValue(p,"projectionMatrix",e.projectionMatrix),m.logarithmicDepthBuffer&&_.setValue(p,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),H!==e&&(H=e,d=!0,y=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){var E=_.map.cameraPosition;void 0!==E&&E.setValue(p,oe.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&_.setValue(p,"isOrthographic",!0===e.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.skinning)&&(w.numMultiviewViews>0?he.updateCameraViewMatricesUniform(e,_):_.setValue(p,"viewMatrix",e.matrixWorldInverse))}if(n.skinning){_.setOptional(p,r,"bindMatrix"),_.setOptional(p,r,"bindMatrixInverse");var T=r.skeleton;if(T){var S=T.bones;if(m.floatVertexTextures){if(void 0===T.boneTexture){var A=Math.sqrt(4*S.length);A=Tn.ceilPowerOfTwo(A),A=Math.max(A,4);var L=new Float32Array(A*A*4);L.set(T.boneMatrices);var R=new la(L,A,A,Ve,ze);T.boneMatrices=L,T.boneTexture=R,T.boneTextureSize=A}_.setValue(p,"boneTexture",T.boneTexture,b),_.setValue(p,"boneTextureSize",T.boneTextureSize)}else _.setOptional(p,T,"boneMatrices")}}return(d||o.receiveShadow!==r.receiveShadow)&&(o.receiveShadow=r.receiveShadow,_.setValue(p,"receiveShadow",r.receiveShadow)),d&&(_.setValue(p,"toneMappingExposure",O.toneMappingExposure),_.setValue(p,"toneMappingWhitePoint",O.toneMappingWhitePoint),o.needsLights&&(l=y,(u=M).ambientLightColor.needsUpdate=l,u.lightProbe.needsUpdate=l,u.directionalLights.needsUpdate=l,u.pointLights.needsUpdate=l,u.spotLights.needsUpdate=l,u.rectAreaLights.needsUpdate=l,u.hemisphereLights.needsUpdate=l),i&&n.fog&&function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}(M,i),n.isMeshBasicMaterial?Te(M,n):n.isMeshLambertMaterial?(Te(M,n),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(M,n)):n.isMeshToonMaterial?(Te(M,n),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.gradientMap&&(e.gradientMap.value=t.gradientMap);t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===g&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===g&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(M,n)):n.isMeshPhongMaterial?(Te(M,n),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===g&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===g&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(M,n)):n.isMeshStandardMaterial?(Te(M,n,a),n.isMeshPhysicalMaterial?function(e,t,n){Se(e,t,n),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen);t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===g&&e.clearcoatNormalScale.value.negate());e.transparency.value=t.transparency}(M,n,a):Se(M,n,a)):n.isMeshMatcapMaterial?(Te(M,n),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===g&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===g&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(M,n)):n.isMeshDepthMaterial?(Te(M,n),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(M,n)):n.isMeshDistanceMaterial?(Te(M,n),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(M,n)):n.isMeshNormalMaterial?(Te(M,n),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===g&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===g&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(M,n)):n.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(M,n),n.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(M,n)):n.isPointsMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*X,e.scale.value=.5*Y,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);var n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(M,n):n.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);var n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(M,n):n.isShadowMaterial&&(M.color.value.copy(n.color),M.opacity.value=n.opacity),void 0!==M.ltc_1&&(M.ltc_1.value=da.LTC_1),void 0!==M.ltc_2&&(M.ltc_2.value=da.LTC_2),Po.upload(p,o.uniformsList,M,b),n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(Po.upload(p,o.uniformsList,M,b),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&_.setValue(p,"center",r.center),w.numMultiviewViews>0?he.updateObjectMatricesUniforms(r,e,_):(_.setValue(p,"modelViewMatrix",r.modelViewMatrix),_.setValue(p,"normalMatrix",r.normalMatrix)),_.setValue(p,"modelMatrix",r.matrixWorld),w}function Te(e,t,n){e.opacity.value=t.opacity,t.color&&e.diffuse.value.copy(t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap);var r,i,a=t.envMap||n;a&&(e.envMap.value=a,e.flipEnvMap.value=a.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.maxMipLevel.value=x.get(a).__maxMipLevel),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity),t.map?r=t.map:t.specularMap?r=t.specularMap:t.displacementMap?r=t.displacementMap:t.normalMap?r=t.normalMap:t.bumpMap?r=t.bumpMap:t.roughnessMap?r=t.roughnessMap:t.metalnessMap?r=t.metalnessMap:t.alphaMap?r=t.alphaMap:t.emissiveMap&&(r=t.emissiveMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix)),t.aoMap?i=t.aoMap:t.lightMap&&(i=t.lightMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uv2Transform.value.copy(i.matrix))}function Se(e,t,n){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===g&&(e.bumpScale.value*=-1)),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===g&&e.normalScale.value.negate()),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),(t.envMap||n)&&(e.envMapIntensity.value=t.envMapIntensity)}xe.setAnimationLoop((function(e){le.isPresenting||ye&&ye(e)})),"undefined"!==typeof window&&xe.setContext(window),this.setAnimationLoop=function(e){ye=e,le.setAnimationLoop(e),xe.start()},this.render=function(e,t){var n,r;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),n=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),r=arguments[3]),t&&t.isCamera){if(!D){U.geometry=null,U.program=null,U.wireframe=!1,B=-1,H=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),le.enabled&&le.isPresenting&&(t=le.getCamera(t)),(f=S.get(e,t)).init(),e.onBeforeRender(O,e,t,n||k),ae.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),ee.setFromProjectionMatrix(ae),re=this.localClippingEnabled,ne=te.init(this.clippingPlanes,re,t),(h=T.get(e,t)).init(),be(e,t,0,O.sortObjects),!0===O.sortObjects&&h.sort(Z,J),ne&&te.beginShadows();var i=f.state.shadowsArray;fe.render(i,e,t),f.setupLights(t),ne&&te.endShadows(),this.info.autoReset&&this.info.reset(),void 0!==n&&this.setRenderTarget(n),le.enabled&&he.isAvailable()&&he.attachCamera(t),A.render(h,e,t,r);var a=h.opaque,o=h.transparent;if(e.overrideMaterial){var s=e.overrideMaterial;a.length&&we(a,e,t,s),o.length&&we(o,e,t,s)}else a.length&&we(a,e,t),o.length&&we(o,e,t);e.onAfterRender(O,e,t),null!==k&&(b.updateRenderTargetMipmap(k),b.updateMultisampleRenderTarget(k)),v.buffers.depth.setTest(!0),v.buffers.depth.setMask(!0),v.buffers.color.setMask(!0),v.setPolygonOffset(!1),le.enabled&&he.isAvailable()&&he.detachCamera(t),h=null,f=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(e){I!==e&&null===k&&p.bindFramebuffer(36160,e),I=e},this.getActiveCubeFace=function(){return N},this.getActiveMipmapLevel=function(){return z},this.getRenderTarget=function(){return k},this.setRenderTarget=function(e,t,n){k=e,N=t,z=n,e&&void 0===x.get(e).__webglFramebuffer&&b.setupRenderTarget(e);var r=I,i=!1;if(e){var a=x.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=a[t||0],i=!0):r=e.isWebGLMultisampleRenderTarget?x.get(e).__webglMultisampledFramebuffer:a,j.copy(e.viewport),V.copy(e.scissor),W=e.scissorTest}else j.copy(Q).multiplyScalar(X).floor(),V.copy(K).multiplyScalar(X).floor(),W=$;if(F!==r&&(p.bindFramebuffer(36160,r),F=r),v.viewport(j),v.scissor(V),v.setScissorTest(W),i){var o=x.get(e.texture);p.framebufferTexture2D(36160,36064,34069+(t||0),o.__webglTexture,n||0)}},this.readRenderTargetPixels=function(e,t,n,r,i,a,o){if(e&&e.isWebGLRenderTarget){var s=x.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(s=s[o]),s){var c=!1;s!==F&&(p.bindFramebuffer(36160,s),c=!0);try{var u=e.texture,l=u.format,h=u.type;if(l!==Ve&&C.convert(l)!==p.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(h!==Pe&&C.convert(h)!==p.getParameter(35738)&&(h!==ze||!(m.isWebGL2||d.get("OES_texture_float")||d.get("WEBGL_color_buffer_float")))&&(h!==ke||!(m.isWebGL2?d.get("EXT_color_buffer_float"):d.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===p.checkFramebufferStatus(36160)?t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&p.readPixels(t,n,r,i,C.convert(l),C.convert(h),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{c&&p.bindFramebuffer(36160,F)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t,n){void 0===n&&(n=0);var r=Math.pow(2,-n),i=Math.floor(t.image.width*r),a=Math.floor(t.image.height*r),o=C.convert(t.format);b.setTexture2D(t,0),p.copyTexImage2D(3553,n,o,e.x,e.y,i,a,0),v.unbindTexture()},this.copyTextureToTexture=function(e,t,n,r){var i=t.image.width,a=t.image.height,o=C.convert(n.format),s=C.convert(n.type);b.setTexture2D(n,0),t.isDataTexture?p.texSubImage2D(3553,r||0,e.x,e.y,i,a,o,s,t.image.data):p.texSubImage2D(3553,r||0,e.x,e.y,o,s,t.image),v.unbindTexture()},this.initTexture=function(e){b.setTexture2D(e,0),v.unbindTexture()},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function xs(e,t){this.name="",this.color=new ei(e),this.density=void 0!==t?t:25e-5}function bs(e,t,n){this.name="",this.color=new ei(e),this.near=void 0!==t?t:1,this.far=void 0!==n?n:1e3}function ws(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=fn,this.updateRange={offset:0,count:-1},this.version=0}ps.prototype=Object.assign(Object.create(On.prototype),{constructor:ps,isWebGLMultiviewRenderTarget:!0,copy:function(e){return On.prototype.copy.call(this,e),this.numViews=e.numViews,this},setNumViews:function(e){return this.numViews!==e&&(this.numViews=e,this.dispose()),this}}),ms.prototype=Object.assign(Object.create(sa.prototype),{constructor:ms,isArrayCamera:!0}),vs.prototype=Object.assign(Object.create(ur.prototype),{constructor:vs,isGroup:!0}),Object.assign(gs.prototype,wn.prototype),Object.assign(xs.prototype,{isFogExp2:!0,clone:function(){return new xs(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(bs.prototype,{isFog:!0,clone:function(){return new bs(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.defineProperty(ws.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(ws.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this},copyAt:function(e,t,n){e*=this.stride,n*=t.stride;for(var r=0,i=this.stride;r<i;r++)this.array[e+r]=t.array[n+r];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}});var _s,Ms=new kn;function Es(e,t,n,r){this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===r}function Ts(e){oi.call(this),this.type="SpriteMaterial",this.color=new ei(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}Object.defineProperties(Es.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(Es.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(e){for(var t=0,n=this.data.count;t<n;t++)Ms.x=this.getX(t),Ms.y=this.getY(t),Ms.z=this.getZ(t),Ms.applyMatrix4(e),this.setXYZ(t,Ms.x,Ms.y,Ms.z);return this},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this},setXYZ:function(e,t,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this},setXYZW:function(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this}}),Ts.prototype=Object.create(oi.prototype),Ts.prototype.constructor=Ts,Ts.prototype.isSpriteMaterial=!0,Ts.prototype.copy=function(e){return oi.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this};var Ss=new kn,As=new kn,Ls=new kn,Rs=new Sn,Ps=new Sn,Cs=new Wn,Os=new kn,Ds=new kn,Is=new kn,Ns=new Sn,zs=new Sn,ks=new Sn;function Fs(e){if(ur.call(this),this.type="Sprite",void 0===_s){_s=new Li;var t=new ws(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);_s.setIndex([0,1,2,0,2,3]),_s.setAttribute("position",new Es(t,3,0,!1)),_s.setAttribute("uv",new Es(t,2,3,!1))}this.geometry=_s,this.material=void 0!==e?e:new Ts,this.center=new Sn(.5,.5)}function Bs(e,t,n,r,i,a){Rs.subVectors(e,n).addScalar(.5).multiply(r),void 0!==i?(Ps.x=a*Rs.x-i*Rs.y,Ps.y=i*Rs.x+a*Rs.y):Ps.copy(Rs),e.copy(t),e.x+=Ps.x,e.y+=Ps.y,e.applyMatrix4(Cs)}Fs.prototype=Object.assign(Object.create(ur.prototype),{constructor:Fs,isSprite:!0,raycast:function(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),As.setFromMatrixScale(this.matrixWorld),Cs.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Ls.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&As.multiplyScalar(-Ls.z);var n,r,i=this.material.rotation;0!==i&&(r=Math.cos(i),n=Math.sin(i));var a=this.center;Bs(Os.set(-.5,-.5,0),Ls,a,As,n,r),Bs(Ds.set(.5,-.5,0),Ls,a,As,n,r),Bs(Is.set(.5,.5,0),Ls,a,As,n,r),Ns.set(0,0),zs.set(1,0),ks.set(1,1);var o=e.ray.intersectTriangle(Os,Ds,Is,!1,Ss);if(null!==o||(Bs(Ds.set(-.5,.5,0),Ls,a,As,n,r),zs.set(0,1),null!==(o=e.ray.intersectTriangle(Os,Is,Ds,!1,Ss)))){var s=e.ray.origin.distanceTo(Ss);s<e.near||s>e.far||t.push({distance:s,point:Ss.clone(),uv:Jr.getUV(Ss,Os,Ds,Is,Ns,zs,ks,new Sn),face:null,object:this})}},clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return ur.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this}});var Us=new kn,Hs=new kn;function Gs(){ur.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function js(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),qi.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Wn,this.bindMatrixInverse=new Wn}Gs.prototype=Object.assign(Object.create(ur.prototype),{constructor:Gs,isLOD:!0,copy:function(e){ur.prototype.copy.call(this,e,!1);for(var t=e.levels,n=0,r=t.length;n<r;n++){var i=t[n];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=e.autoUpdate,this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var n=this.levels,r=0;r<n.length&&!(t<n[r].distance);r++);return n.splice(r,0,{distance:t,object:e}),this.add(e),this},getObjectForDistance:function(e){var t=this.levels;if(t.length>0){for(var n=1,r=t.length;n<r&&!(e<t[n].distance);n++);return t[n-1].object}return null},raycast:function(e,t){if(this.levels.length>0){Us.setFromMatrixPosition(this.matrixWorld);var n=e.ray.origin.distanceTo(Us);this.getObjectForDistance(n).raycast(e,t)}},update:function(e){var t=this.levels;if(t.length>1){Us.setFromMatrixPosition(e.matrixWorld),Hs.setFromMatrixPosition(this.matrixWorld);var n=Us.distanceTo(Hs);t[0].object.visible=!0;for(var r=1,i=t.length;r<i&&n>=t[r].distance;r++)t[r-1].object.visible=!1,t[r].object.visible=!0;for(;r<i;r++)t[r].object.visible=!1}},toJSON:function(e){var t=ur.prototype.toJSON.call(this,e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];for(var n=this.levels,r=0,i=n.length;r<i;r++){var a=n[r];t.object.levels.push({object:a.object.uuid,distance:a.distance})}return t}}),js.prototype=Object.assign(Object.create(qi.prototype),{constructor:js,isSkinnedMesh:!0,bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new Cn,t=this.geometry.attributes.skinWeight,n=0,r=t.count;n<r;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);var i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){qi.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Vs=new Wn,Ws=new Wn;function qs(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var n=0,r=this.bones.length;n<r;n++)this.boneInverses.push(new Wn)}}function Ys(){ur.call(this),this.type="Bone"}Object.assign(qs.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var n=new Wn;this.bones[e]&&n.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(n)}},pose:function(){var e,t,n;for(t=0,n=this.bones.length;t<n;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,n=this.bones.length;t<n;t++)(e=this.bones[t])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:function(){for(var e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture,i=0,a=e.length;i<a;i++){var o=e[i]?e[i].matrixWorld:Ws;Vs.multiplyMatrices(o,t[i]),Vs.toArray(n,16*i)}void 0!==r&&(r.needsUpdate=!0)},clone:function(){return new qs(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,n=this.bones.length;t<n;t++){var r=this.bones[t];if(r.name===e)return r}}}),Ys.prototype=Object.assign(Object.create(ur.prototype),{constructor:Ys,isBone:!0});var Xs=new Wn,Zs=new Wn,Js=[],Qs=new qi;function Ks(e,t,n){qi.call(this,e,t),this.instanceMatrix=new ui(new Float32Array(16*n),16),this.count=n,this.frustumCulled=!1}function $s(e){oi.call(this),this.type="LineBasicMaterial",this.color=new ei(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}Ks.prototype=Object.assign(Object.create(qi.prototype),{constructor:Ks,isInstancedMesh:!0,getMatrixAt:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)},raycast:function(e,t){var n=this.matrixWorld,r=this.count;if(Qs.geometry=this.geometry,Qs.material=this.material,void 0!==Qs.material)for(var i=0;i<r;i++)this.getMatrixAt(i,Xs),Zs.multiplyMatrices(n,Xs),Qs.matrixWorld=Zs,Qs.raycast(e,Js),Js.length>0&&(Js[0].instanceId=i,Js[0].object=this,t.push(Js[0]),Js.length=0)},setMatrixAt:function(e,t){t.toArray(this.instanceMatrix.array,16*e)},updateMorphTargets:function(){}}),$s.prototype=Object.create(oi.prototype),$s.prototype.constructor=$s,$s.prototype.isLineBasicMaterial=!0,$s.prototype.copy=function(e){return oi.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this};var ec=new kn,tc=new kn,nc=new Wn,rc=new Nr,ic=new Ar;function ac(e,t,n){1===n&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),ur.call(this),this.type="Line",this.geometry=void 0!==e?e:new Li,this.material=void 0!==t?t:new $s}ac.prototype=Object.assign(Object.create(ur.prototype),{constructor:ac,isLine:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,n=[0],r=1,i=t.count;r<i;r++)ec.fromBufferAttribute(t,r-1),tc.fromBufferAttribute(t,r),n[r]=n[r-1],n[r]+=ec.distanceTo(tc);e.setAttribute("lineDistance",new gi(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var a=e.vertices;(n=e.lineDistances)[0]=0;for(r=1,i=a.length;r<i;r++)n[r]=n[r-1],n[r]+=a[r-1].distanceTo(a[r])}return this},raycast:function(e,t){var n=e.linePrecision,r=this.geometry,i=this.matrixWorld;if(null===r.boundingSphere&&r.computeBoundingSphere(),ic.copy(r.boundingSphere),ic.applyMatrix4(i),ic.radius+=n,!1!==e.ray.intersectsSphere(ic)){nc.getInverse(i),rc.copy(e.ray).applyMatrix4(nc);var a=n/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,s=new kn,c=new kn,u=new kn,l=new kn,h=this&&this.isLineSegments?2:1;if(r.isBufferGeometry){var f=r.index,p=r.attributes.position.array;if(null!==f)for(var d=f.array,m=0,v=d.length-1;m<v;m+=h){var g=d[m],y=d[m+1];if(s.fromArray(p,3*g),c.fromArray(p,3*y),!(rc.distanceSqToSegment(s,c,l,u)>o))l.applyMatrix4(this.matrixWorld),(w=e.ray.origin.distanceTo(l))<e.near||w>e.far||t.push({distance:w,point:u.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}else for(m=0,v=p.length/3-1;m<v;m+=h){if(s.fromArray(p,3*m),c.fromArray(p,3*m+3),!(rc.distanceSqToSegment(s,c,l,u)>o))l.applyMatrix4(this.matrixWorld),(w=e.ray.origin.distanceTo(l))<e.near||w>e.far||t.push({distance:w,point:u.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}else if(r.isGeometry){var x=r.vertices,b=x.length;for(m=0;m<b-1;m+=h){var w;if(!(rc.distanceSqToSegment(x[m],x[m+1],l,u)>o))l.applyMatrix4(this.matrixWorld),(w=e.ray.origin.distanceTo(l))<e.near||w>e.far||t.push({distance:w,point:u.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var oc=new kn,sc=new kn;function cc(e,t){ac.call(this,e,t),this.type="LineSegments"}function uc(e,t){ac.call(this,e,t),this.type="LineLoop"}function lc(e){oi.call(this),this.type="PointsMaterial",this.color=new ei(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}cc.prototype=Object.assign(Object.create(ac.prototype),{constructor:cc,isLineSegments:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,n=[],r=0,i=t.count;r<i;r+=2)oc.fromBufferAttribute(t,r),sc.fromBufferAttribute(t,r+1),n[r]=0===r?0:n[r-1],n[r+1]=n[r]+oc.distanceTo(sc);e.setAttribute("lineDistance",new gi(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var a=e.vertices;for(n=e.lineDistances,r=0,i=a.length;r<i;r+=2)oc.copy(a[r]),sc.copy(a[r+1]),n[r]=0===r?0:n[r-1],n[r+1]=n[r]+oc.distanceTo(sc)}return this}}),uc.prototype=Object.assign(Object.create(ac.prototype),{constructor:uc,isLineLoop:!0}),lc.prototype=Object.create(oi.prototype),lc.prototype.constructor=lc,lc.prototype.isPointsMaterial=!0,lc.prototype.copy=function(e){return oi.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this};var hc=new Wn,fc=new Nr,pc=new Ar,dc=new kn;function mc(e,t){ur.call(this),this.type="Points",this.geometry=void 0!==e?e:new Li,this.material=void 0!==t?t:new lc,this.updateMorphTargets()}function vc(e,t,n,r,i,a,o){var s=fc.distanceSqToPoint(e);if(s<n){var c=new kn;fc.closestPointToPoint(e,c),c.applyMatrix4(r);var u=i.ray.origin.distanceTo(c);if(u<i.near||u>i.far)return;a.push({distance:u,distanceToRay:Math.sqrt(s),point:c,index:t,face:null,object:o})}}function gc(e,t,n,r,i,a,o,s,c){Pn.call(this,e,t,n,r,i,a,o,s,c),this.format=void 0!==o?o:je,this.minFilter=void 0!==a?a:Te,this.magFilter=void 0!==i?i:Te,this.generateMipmaps=!1}function yc(e,t,n,r,i,a,o,s,c,u,l,h){Pn.call(this,null,a,o,s,c,u,r,i,l,h),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function xc(e,t,n,r,i,a,o,s,c){Pn.call(this,e,t,n,r,i,a,o,s,c),this.needsUpdate=!0}function bc(e,t,n,r,i,a,o,s,c,u){if((u=void 0!==u?u:Xe)!==Xe&&u!==Ze)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&u===Xe&&(n=De),void 0===n&&u===Ze&&(n=He),Pn.call(this,null,r,i,a,o,s,u,n,c),this.image={width:e,height:t},this.magFilter=void 0!==o?o:be,this.minFilter=void 0!==s?s:be,this.flipY=!1,this.generateMipmaps=!1}function wc(e){Li.call(this),this.type="WireframeGeometry";var t,n,r,i,a,o,s,c,u,l,h=[],f=[0,0],p={},d=["a","b","c"];if(e&&e.isGeometry){var m=e.faces;for(t=0,r=m.length;t<r;t++){var v=m[t];for(n=0;n<3;n++)s=v[d[n]],c=v[d[(n+1)%3]],f[0]=Math.min(s,c),f[1]=Math.max(s,c),void 0===p[u=f[0]+","+f[1]]&&(p[u]={index1:f[0],index2:f[1]})}for(u in p)o=p[u],l=e.vertices[o.index1],h.push(l.x,l.y,l.z),l=e.vertices[o.index2],h.push(l.x,l.y,l.z)}else if(e&&e.isBufferGeometry){var g,y,x,b,w,_,M;if(l=new kn,null!==e.index){for(g=e.attributes.position,y=e.index,0===(x=e.groups).length&&(x=[{start:0,count:y.count,materialIndex:0}]),i=0,a=x.length;i<a;++i)for(t=w=(b=x[i]).start,r=w+b.count;t<r;t+=3)for(n=0;n<3;n++)s=y.getX(t+n),c=y.getX(t+(n+1)%3),f[0]=Math.min(s,c),f[1]=Math.max(s,c),void 0===p[u=f[0]+","+f[1]]&&(p[u]={index1:f[0],index2:f[1]});for(u in p)o=p[u],l.fromBufferAttribute(g,o.index1),h.push(l.x,l.y,l.z),l.fromBufferAttribute(g,o.index2),h.push(l.x,l.y,l.z)}else for(t=0,r=(g=e.attributes.position).count/3;t<r;t++)for(n=0;n<3;n++)_=3*t+n,l.fromBufferAttribute(g,_),h.push(l.x,l.y,l.z),M=3*t+(n+1)%3,l.fromBufferAttribute(g,M),h.push(l.x,l.y,l.z)}this.setAttribute("position",new gi(h,3))}function _c(e,t,n){$i.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n},this.fromBufferGeometry(new Mc(e,t,n)),this.mergeVertices()}function Mc(e,t,n){Li.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:n};var r,i,a=[],o=[],s=[],c=[],u=1e-5,l=new kn,h=new kn,f=new kn,p=new kn,d=new kn;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var m=t+1;for(r=0;r<=n;r++){var v=r/n;for(i=0;i<=t;i++){var g=i/t;e(g,v,h),o.push(h.x,h.y,h.z),g-u>=0?(e(g-u,v,f),p.subVectors(h,f)):(e(g+u,v,f),p.subVectors(f,h)),v-u>=0?(e(g,v-u,f),d.subVectors(h,f)):(e(g,v+u,f),d.subVectors(f,h)),l.crossVectors(p,d).normalize(),s.push(l.x,l.y,l.z),c.push(g,v)}}for(r=0;r<n;r++)for(i=0;i<t;i++){var y=r*m+i,x=r*m+i+1,b=(r+1)*m+i+1,w=(r+1)*m+i;a.push(y,x,w),a.push(x,b,w)}this.setIndex(a),this.setAttribute("position",new gi(o,3)),this.setAttribute("normal",new gi(s,3)),this.setAttribute("uv",new gi(c,2))}function Ec(e,t,n,r){$i.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r},this.fromBufferGeometry(new Tc(e,t,n,r)),this.mergeVertices()}function Tc(e,t,n,r){Li.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r},n=n||1;var i=[],a=[];function o(e,t,n,r){var i,a,o=Math.pow(2,r),c=[];for(i=0;i<=o;i++){c[i]=[];var u=e.clone().lerp(n,i/o),l=t.clone().lerp(n,i/o),h=o-i;for(a=0;a<=h;a++)c[i][a]=0===a&&i===o?u:u.clone().lerp(l,a/h)}for(i=0;i<o;i++)for(a=0;a<2*(o-i)-1;a++){var f=Math.floor(a/2);a%2===0?(s(c[i][f+1]),s(c[i+1][f]),s(c[i][f])):(s(c[i][f+1]),s(c[i+1][f+1]),s(c[i+1][f]))}}function s(e){i.push(e.x,e.y,e.z)}function c(t,n){var r=3*t;n.x=e[r+0],n.y=e[r+1],n.z=e[r+2]}function u(e,t,n,r){r<0&&1===e.x&&(a[t]=e.x-1),0===n.x&&0===n.z&&(a[t]=r/2/Math.PI+.5)}function l(e){return Math.atan2(e.z,-e.x)}!function(e){for(var n=new kn,r=new kn,i=new kn,a=0;a<t.length;a+=3)c(t[a+0],n),c(t[a+1],r),c(t[a+2],i),o(n,r,i,e)}(r=r||0),function(e){for(var t=new kn,n=0;n<i.length;n+=3)t.x=i[n+0],t.y=i[n+1],t.z=i[n+2],t.normalize().multiplyScalar(e),i[n+0]=t.x,i[n+1]=t.y,i[n+2]=t.z}(n),function(){for(var e=new kn,t=0;t<i.length;t+=3){e.x=i[t+0],e.y=i[t+1],e.z=i[t+2];var n=l(e)/2/Math.PI+.5,r=(o=e,Math.atan2(-o.y,Math.sqrt(o.x*o.x+o.z*o.z))/Math.PI+.5);a.push(n,1-r)}var o;(function(){for(var e=new kn,t=new kn,n=new kn,r=new kn,o=new Sn,s=new Sn,c=new Sn,h=0,f=0;h<i.length;h+=9,f+=6){e.set(i[h+0],i[h+1],i[h+2]),t.set(i[h+3],i[h+4],i[h+5]),n.set(i[h+6],i[h+7],i[h+8]),o.set(a[f+0],a[f+1]),s.set(a[f+2],a[f+3]),c.set(a[f+4],a[f+5]),r.copy(e).add(t).add(n).divideScalar(3);var p=l(r);u(o,f+0,e,p),u(s,f+2,t,p),u(c,f+4,n,p)}})(),function(){for(var e=0;e<a.length;e+=6){var t=a[e+0],n=a[e+2],r=a[e+4],i=Math.max(t,n,r),o=Math.min(t,n,r);i>.9&&o<.1&&(t<.2&&(a[e+0]+=1),n<.2&&(a[e+2]+=1),r<.2&&(a[e+4]+=1))}}()}(),this.setAttribute("position",new gi(i,3)),this.setAttribute("normal",new gi(i.slice(),3)),this.setAttribute("uv",new gi(a,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}function Sc(e,t){$i.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Ac(e,t)),this.mergeVertices()}function Ac(e,t){Tc.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Lc(e,t){$i.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Rc(e,t)),this.mergeVertices()}function Rc(e,t){Tc.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Pc(e,t){$i.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Cc(e,t)),this.mergeVertices()}function Cc(e,t){var n=(1+Math.sqrt(5))/2,r=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1];Tc.call(this,r,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Oc(e,t){$i.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Dc(e,t)),this.mergeVertices()}function Dc(e,t){var n=(1+Math.sqrt(5))/2,r=1/n,i=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r];Tc.call(this,i,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Ic(e,t,n,r,i,a){$i.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:i},void 0!==a&&console.warn("THREE.TubeGeometry: taper has been removed.");var o=new Nc(e,t,n,r,i);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals,this.fromBufferGeometry(o),this.mergeVertices()}function Nc(e,t,n,r,i){Li.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:i},t=t||64,n=n||1,r=r||8,i=i||!1;var a=e.computeFrenetFrames(t,i);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;var o,s,c=new kn,u=new kn,l=new Sn,h=new kn,f=[],p=[],d=[],m=[];function v(i){h=e.getPointAt(i/t,h);var o=a.normals[i],l=a.binormals[i];for(s=0;s<=r;s++){var d=s/r*Math.PI*2,m=Math.sin(d),v=-Math.cos(d);u.x=v*o.x+m*l.x,u.y=v*o.y+m*l.y,u.z=v*o.z+m*l.z,u.normalize(),p.push(u.x,u.y,u.z),c.x=h.x+n*u.x,c.y=h.y+n*u.y,c.z=h.z+n*u.z,f.push(c.x,c.y,c.z)}}!function(){for(o=0;o<t;o++)v(o);v(!1===i?t:0),function(){for(o=0;o<=t;o++)for(s=0;s<=r;s++)l.x=o/t,l.y=s/r,d.push(l.x,l.y)}(),function(){for(s=1;s<=t;s++)for(o=1;o<=r;o++){var e=(r+1)*(s-1)+(o-1),n=(r+1)*s+(o-1),i=(r+1)*s+o,a=(r+1)*(s-1)+o;m.push(e,n,a),m.push(n,i,a)}}()}(),this.setIndex(m),this.setAttribute("position",new gi(f,3)),this.setAttribute("normal",new gi(p,3)),this.setAttribute("uv",new gi(d,2))}function zc(e,t,n,r,i,a,o){$i.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:i,q:a},void 0!==o&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new kc(e,t,n,r,i,a)),this.mergeVertices()}function kc(e,t,n,r,i,a){Li.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:i,q:a},e=e||1,t=t||.4,n=Math.floor(n)||64,r=Math.floor(r)||8,i=i||2,a=a||3;var o,s,c=[],u=[],l=[],h=[],f=new kn,p=new kn,d=new kn,m=new kn,v=new kn,g=new kn,y=new kn;for(o=0;o<=n;++o){var x=o/n*i*Math.PI*2;for(A(x,i,a,e,d),A(x+.01,i,a,e,m),g.subVectors(m,d),y.addVectors(m,d),v.crossVectors(g,y),y.crossVectors(v,g),v.normalize(),y.normalize(),s=0;s<=r;++s){var b=s/r*Math.PI*2,w=-t*Math.cos(b),_=t*Math.sin(b);f.x=d.x+(w*y.x+_*v.x),f.y=d.y+(w*y.y+_*v.y),f.z=d.z+(w*y.z+_*v.z),u.push(f.x,f.y,f.z),p.subVectors(f,d).normalize(),l.push(p.x,p.y,p.z),h.push(o/n),h.push(s/r)}}for(s=1;s<=n;s++)for(o=1;o<=r;o++){var M=(r+1)*(s-1)+(o-1),E=(r+1)*s+(o-1),T=(r+1)*s+o,S=(r+1)*(s-1)+o;c.push(M,E,S),c.push(E,T,S)}function A(e,t,n,r,i){var a=Math.cos(e),o=Math.sin(e),s=n/t*e,c=Math.cos(s);i.x=r*(2+c)*.5*a,i.y=r*(2+c)*o*.5,i.z=r*Math.sin(s)*.5}this.setIndex(c),this.setAttribute("position",new gi(u,3)),this.setAttribute("normal",new gi(l,3)),this.setAttribute("uv",new gi(h,2))}function Fc(e,t,n,r,i){$i.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:i},this.fromBufferGeometry(new Bc(e,t,n,r,i)),this.mergeVertices()}function Bc(e,t,n,r,i){Li.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:i},e=e||1,t=t||.4,n=Math.floor(n)||8,r=Math.floor(r)||6,i=i||2*Math.PI;var a,o,s=[],c=[],u=[],l=[],h=new kn,f=new kn,p=new kn;for(a=0;a<=n;a++)for(o=0;o<=r;o++){var d=o/r*i,m=a/n*Math.PI*2;f.x=(e+t*Math.cos(m))*Math.cos(d),f.y=(e+t*Math.cos(m))*Math.sin(d),f.z=t*Math.sin(m),c.push(f.x,f.y,f.z),h.x=e*Math.cos(d),h.y=e*Math.sin(d),p.subVectors(f,h).normalize(),u.push(p.x,p.y,p.z),l.push(o/r),l.push(a/n)}for(a=1;a<=n;a++)for(o=1;o<=r;o++){var v=(r+1)*a+o-1,g=(r+1)*(a-1)+o-1,y=(r+1)*(a-1)+o,x=(r+1)*a+o;s.push(v,g,x),s.push(g,y,x)}this.setIndex(s),this.setAttribute("position",new gi(c,3)),this.setAttribute("normal",new gi(u,3)),this.setAttribute("uv",new gi(l,2))}mc.prototype=Object.assign(Object.create(ur.prototype),{constructor:mc,isPoints:!0,raycast:function(e,t){var n=this.geometry,r=this.matrixWorld,i=e.params.Points.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),pc.copy(n.boundingSphere),pc.applyMatrix4(r),pc.radius+=i,!1!==e.ray.intersectsSphere(pc)){hc.getInverse(r),fc.copy(e.ray).applyMatrix4(hc);var a=i/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a;if(n.isBufferGeometry){var s=n.index,c=n.attributes.position.array;if(null!==s)for(var u=s.array,l=0,h=u.length;l<h;l++){var f=u[l];dc.fromArray(c,3*f),vc(dc,f,o,r,e,t,this)}else{l=0;for(var p=c.length/3;l<p;l++)dc.fromArray(c,3*l),vc(dc,l,o,r,e,t,this)}}else{var d=n.vertices;for(l=0,p=d.length;l<p;l++)vc(d[l],l,o,r,e,t,this)}}},updateMorphTargets:function(){var e,t,n,r=this.geometry;if(r.isBufferGeometry){var i=r.morphAttributes,a=Object.keys(i);if(a.length>0){var o=i[a[0]];if(void 0!==o)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=o.length;e<t;e++)n=o[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}else{var s=r.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),gc.prototype=Object.assign(Object.create(Pn.prototype),{constructor:gc,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),yc.prototype=Object.create(Pn.prototype),yc.prototype.constructor=yc,yc.prototype.isCompressedTexture=!0,xc.prototype=Object.create(Pn.prototype),xc.prototype.constructor=xc,xc.prototype.isCanvasTexture=!0,bc.prototype=Object.create(Pn.prototype),bc.prototype.constructor=bc,bc.prototype.isDepthTexture=!0,wc.prototype=Object.create(Li.prototype),wc.prototype.constructor=wc,_c.prototype=Object.create($i.prototype),_c.prototype.constructor=_c,Mc.prototype=Object.create(Li.prototype),Mc.prototype.constructor=Mc,Ec.prototype=Object.create($i.prototype),Ec.prototype.constructor=Ec,Tc.prototype=Object.create(Li.prototype),Tc.prototype.constructor=Tc,Sc.prototype=Object.create($i.prototype),Sc.prototype.constructor=Sc,Ac.prototype=Object.create(Tc.prototype),Ac.prototype.constructor=Ac,Lc.prototype=Object.create($i.prototype),Lc.prototype.constructor=Lc,Rc.prototype=Object.create(Tc.prototype),Rc.prototype.constructor=Rc,Pc.prototype=Object.create($i.prototype),Pc.prototype.constructor=Pc,Cc.prototype=Object.create(Tc.prototype),Cc.prototype.constructor=Cc,Oc.prototype=Object.create($i.prototype),Oc.prototype.constructor=Oc,Dc.prototype=Object.create(Tc.prototype),Dc.prototype.constructor=Dc,Ic.prototype=Object.create($i.prototype),Ic.prototype.constructor=Ic,Nc.prototype=Object.create(Li.prototype),Nc.prototype.constructor=Nc,Nc.prototype.toJSON=function(){var e=Li.prototype.toJSON.call(this);return e.path=this.parameters.path.toJSON(),e},zc.prototype=Object.create($i.prototype),zc.prototype.constructor=zc,kc.prototype=Object.create(Li.prototype),kc.prototype.constructor=kc,Fc.prototype=Object.create($i.prototype),Fc.prototype.constructor=Fc,Bc.prototype=Object.create(Li.prototype),Bc.prototype.constructor=Bc;var Uc=function(e,t,n){n=n||2;var r,i,a,o,s,c,u,l=t&&t.length,h=l?t[0]*n:e.length,f=Hc(e,0,h,n,!0),p=[];if(!f||f.next===f.prev)return p;if(l&&(f=function(e,t,n,r){var i,a,o,s,c,u=[];for(i=0,a=t.length;i<a;i++)o=t[i]*r,s=i<a-1?t[i+1]*r:e.length,(c=Hc(e,o,s,r,!1))===c.next&&(c.steiner=!0),u.push(Qc(c));for(u.sort(Xc),i=0;i<u.length;i++)Zc(u[i],n),n=Gc(n,n.next);return n}(e,t,f,n)),e.length>80*n){r=a=e[0],i=o=e[1];for(var d=n;d<h;d+=n)(s=e[d])<r&&(r=s),(c=e[d+1])<i&&(i=c),s>a&&(a=s),c>o&&(o=c);u=0!==(u=Math.max(a-r,o-i))?1/u:0}return jc(f,p,n,r,i,u),p};function Hc(e,t,n,r,i){var a,o;if(i===function(e,t,n,r){for(var i=0,a=t,o=n-r;a<n;a+=r)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}(e,t,n,r)>0)for(a=t;a<n;a+=r)o=au(a,e[a],e[a+1],o);else for(a=n-r;a>=t;a-=r)o=au(a,e[a],e[a+1],o);return o&&tu(o,o.next)&&(ou(o),o=o.next),o}function Gc(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!tu(r,r.next)&&0!==eu(r.prev,r,r.next))r=r.next;else{if(ou(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function jc(e,t,n,r,i,a,o){if(e){!o&&a&&function(e,t,n,r){var i=e;do{null===i.z&&(i.z=Jc(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,a,o,s,c,u=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,r=n,s=0,t=0;t<u&&(s++,r=r.nextZ);t++);for(c=u;s>0||c>0&&r;)0!==s&&(0===c||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,c--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;n=r}a.nextZ=null,u*=2}while(o>1)}(i)}(e,r,i,a);for(var s,c,u=e;e.prev!==e.next;)if(s=e.prev,c=e.next,a?Wc(e,r,i,a):Vc(e))t.push(s.i/n),t.push(e.i/n),t.push(c.i/n),ou(e),e=c.next,u=c.next;else if((e=c)===u){o?1===o?jc(e=qc(e,t,n),t,n,r,i,a,2):2===o&&Yc(e,t,n,r,i,a):jc(Gc(e),t,n,r,i,a,1);break}}}function Vc(e){var t=e.prev,n=e,r=e.next;if(eu(t,n,r)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(Kc(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&eu(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Wc(e,t,n,r){var i=e.prev,a=e,o=e.next;if(eu(i,a,o)>=0)return!1;for(var s=i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,c=i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,u=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,l=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,h=Jc(s,c,t,n,r),f=Jc(u,l,t,n,r),p=e.prevZ,d=e.nextZ;p&&p.z>=h&&d&&d.z<=f;){if(p!==e.prev&&p!==e.next&&Kc(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&eu(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,d!==e.prev&&d!==e.next&&Kc(i.x,i.y,a.x,a.y,o.x,o.y,d.x,d.y)&&eu(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&Kc(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&eu(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;d&&d.z<=f;){if(d!==e.prev&&d!==e.next&&Kc(i.x,i.y,a.x,a.y,o.x,o.y,d.x,d.y)&&eu(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function qc(e,t,n){var r=e;do{var i=r.prev,a=r.next.next;!tu(i,a)&&nu(i,r,r.next,a)&&ru(i,a)&&ru(a,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(a.i/n),ou(r),ou(r.next),r=e=a),r=r.next}while(r!==e);return r}function Yc(e,t,n,r,i,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&$c(o,s)){var c=iu(o,s);return o=Gc(o,o.next),c=Gc(c,c.next),jc(o,t,n,r,i,a),void jc(c,t,n,r,i,a)}s=s.next}o=o.next}while(o!==e)}function Xc(e,t){return e.x-t.x}function Zc(e,t){if(t=function(e,t){var n,r=t,i=e.x,a=e.y,o=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var s=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>o){if(o=s,s===i){if(a===r.y)return r;if(a===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===o)return n.prev;var c,u=n,l=n.x,h=n.y,f=1/0;r=n.next;for(;r!==u;)i>=r.x&&r.x>=l&&i!==r.x&&Kc(a<h?i:o,a,l,h,a<h?o:i,a,r.x,r.y)&&((c=Math.abs(a-r.y)/(i-r.x))<f||c===f&&r.x>n.x)&&ru(r,e)&&(n=r,f=c),r=r.next;return n}(e,t)){var n=iu(t,e);Gc(n,n.next)}}function Jc(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Qc(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Kc(e,t,n,r,i,a,o,s){return(i-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(r-s)-(n-o)*(t-s)>=0&&(n-o)*(a-s)-(i-o)*(r-s)>=0}function $c(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&nu(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&ru(e,t)&&ru(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!==n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)}function eu(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function tu(e,t){return e.x===t.x&&e.y===t.y}function nu(e,t,n,r){return!!(tu(e,n)&&tu(t,r)||tu(e,r)&&tu(n,t))||eu(e,t,n)>0!==eu(e,t,r)>0&&eu(n,r,e)>0!==eu(n,r,t)>0}function ru(e,t){return eu(e.prev,e,e.next)<0?eu(e,t,e.next)>=0&&eu(e,e.prev,t)>=0:eu(e,t,e.prev)<0||eu(e,e.next,t)<0}function iu(e,t){var n=new su(e.i,e.x,e.y),r=new su(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function au(e,t,n,r){var i=new su(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function ou(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function su(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var cu={area:function(e){for(var t=e.length,n=0,r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n},isClockWise:function(e){return cu.area(e)<0},triangulateShape:function(e,t){var n=[],r=[],i=[];uu(e),lu(n,e);var a=e.length;t.forEach(uu);for(var o=0;o<t.length;o++)r.push(a),a+=t[o].length,lu(n,t[o]);var s=Uc(n,r);for(o=0;o<s.length;o+=3)i.push(s.slice(o,o+3));return i}};function uu(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function lu(e,t){for(var n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}function hu(e,t){$i.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new fu(e,t)),this.mergeVertices()}function fu(e,t){Li.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];for(var n=this,r=[],i=[],a=0,o=e.length;a<o;a++){s(e[a])}function s(e){var a=[],o=void 0!==t.curveSegments?t.curveSegments:12,s=void 0!==t.steps?t.steps:1,c=void 0!==t.depth?t.depth:100,u=void 0===t.bevelEnabled||t.bevelEnabled,l=void 0!==t.bevelThickness?t.bevelThickness:6,h=void 0!==t.bevelSize?t.bevelSize:l-2,f=void 0!==t.bevelOffset?t.bevelOffset:0,p=void 0!==t.bevelSegments?t.bevelSegments:3,d=t.extrudePath,m=void 0!==t.UVGenerator?t.UVGenerator:pu;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),c=t.amount);var v,g,y,x,b,w,_,M,E=!1;d&&(v=d.getSpacedPoints(s),E=!0,u=!1,g=d.computeFrenetFrames(s,!1),y=new kn,x=new kn,b=new kn),u||(p=0,l=0,h=0,f=0);var T=e.extractPoints(o),S=T.shape,A=T.holes;if(!cu.isClockWise(S))for(S=S.reverse(),_=0,M=A.length;_<M;_++)w=A[_],cu.isClockWise(w)&&(A[_]=w.reverse());var L=cu.triangulateShape(S,A),R=S;for(_=0,M=A.length;_<M;_++)w=A[_],S=S.concat(w);function P(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}var C,O,D,I,N,z,k=S.length,F=L.length;function B(e,t,n){var r,i,a,o=e.x-t.x,s=e.y-t.y,c=n.x-e.x,u=n.y-e.y,l=o*o+s*s,h=o*u-s*c;if(Math.abs(h)>Number.EPSILON){var f=Math.sqrt(l),p=Math.sqrt(c*c+u*u),d=t.x-s/f,m=t.y+o/f,v=((n.x-u/p-d)*u-(n.y+c/p-m)*c)/(o*u-s*c),g=(r=d+o*v-e.x)*r+(i=m+s*v-e.y)*i;if(g<=2)return new Sn(r,i);a=Math.sqrt(g/2)}else{var y=!1;o>Number.EPSILON?c>Number.EPSILON&&(y=!0):o<-Number.EPSILON?c<-Number.EPSILON&&(y=!0):Math.sign(s)===Math.sign(u)&&(y=!0),y?(r=-s,i=o,a=Math.sqrt(l)):(r=o,i=s,a=Math.sqrt(l/2))}return new Sn(r/a,i/a)}for(var U=[],H=0,G=R.length,j=G-1,V=H+1;H<G;H++,j++,V++)j===G&&(j=0),V===G&&(V=0),U[H]=B(R[H],R[j],R[V]);var W,q,Y=[],X=U.concat();for(_=0,M=A.length;_<M;_++){for(w=A[_],W=[],H=0,j=(G=w.length)-1,V=H+1;H<G;H++,j++,V++)j===G&&(j=0),V===G&&(V=0),W[H]=B(w[H],w[j],w[V]);Y.push(W),X=X.concat(W)}for(C=0;C<p;C++){for(D=C/p,I=l*Math.cos(D*Math.PI/2),O=h*Math.sin(D*Math.PI/2)+f,H=0,G=R.length;H<G;H++)J((N=P(R[H],U[H],O)).x,N.y,-I);for(_=0,M=A.length;_<M;_++)for(w=A[_],W=Y[_],H=0,G=w.length;H<G;H++)J((N=P(w[H],W[H],O)).x,N.y,-I)}for(O=h+f,H=0;H<k;H++)N=u?P(S[H],X[H],O):S[H],E?(x.copy(g.normals[0]).multiplyScalar(N.x),y.copy(g.binormals[0]).multiplyScalar(N.y),b.copy(v[0]).add(x).add(y),J(b.x,b.y,b.z)):J(N.x,N.y,0);for(q=1;q<=s;q++)for(H=0;H<k;H++)N=u?P(S[H],X[H],O):S[H],E?(x.copy(g.normals[q]).multiplyScalar(N.x),y.copy(g.binormals[q]).multiplyScalar(N.y),b.copy(v[q]).add(x).add(y),J(b.x,b.y,b.z)):J(N.x,N.y,c/s*q);for(C=p-1;C>=0;C--){for(D=C/p,I=l*Math.cos(D*Math.PI/2),O=h*Math.sin(D*Math.PI/2)+f,H=0,G=R.length;H<G;H++)J((N=P(R[H],U[H],O)).x,N.y,c+I);for(_=0,M=A.length;_<M;_++)for(w=A[_],W=Y[_],H=0,G=w.length;H<G;H++)N=P(w[H],W[H],O),E?J(N.x,N.y+v[s-1].y,v[s-1].x+I):J(N.x,N.y,c+I)}function Z(e,t){var n,r;for(H=e.length;--H>=0;){n=H,(r=H-1)<0&&(r=e.length-1);var i=0,a=s+2*p;for(i=0;i<a;i++){var o=k*i,c=k*(i+1);K(t+n+o,t+r+o,t+r+c,t+n+c)}}}function J(e,t,n){a.push(e),a.push(t),a.push(n)}function Q(e,t,i){$(e),$(t),$(i);var a=r.length/3,o=m.generateTopUV(n,r,a-3,a-2,a-1);ee(o[0]),ee(o[1]),ee(o[2])}function K(e,t,i,a){$(e),$(t),$(a),$(t),$(i),$(a);var o=r.length/3,s=m.generateSideWallUV(n,r,o-6,o-3,o-2,o-1);ee(s[0]),ee(s[1]),ee(s[3]),ee(s[1]),ee(s[2]),ee(s[3])}function $(e){r.push(a[3*e+0]),r.push(a[3*e+1]),r.push(a[3*e+2])}function ee(e){i.push(e.x),i.push(e.y)}!function(){var e=r.length/3;if(u){var t=0,i=k*t;for(H=0;H<F;H++)Q((z=L[H])[2]+i,z[1]+i,z[0]+i);for(i=k*(t=s+2*p),H=0;H<F;H++)Q((z=L[H])[0]+i,z[1]+i,z[2]+i)}else{for(H=0;H<F;H++)Q((z=L[H])[2],z[1],z[0]);for(H=0;H<F;H++)Q((z=L[H])[0]+k*s,z[1]+k*s,z[2]+k*s)}n.addGroup(e,r.length/3-e,0)}(),function(){var e=r.length/3,t=0;for(Z(R,t),t+=R.length,_=0,M=A.length;_<M;_++)Z(w=A[_],t),t+=w.length;n.addGroup(e,r.length/3-e,1)}()}this.setAttribute("position",new gi(r,3)),this.setAttribute("uv",new gi(i,2)),this.computeVertexNormals()}hu.prototype=Object.create($i.prototype),hu.prototype.constructor=hu,hu.prototype.toJSON=function(){var e=$i.prototype.toJSON.call(this);return du(this.parameters.shapes,this.parameters.options,e)},fu.prototype=Object.create(Li.prototype),fu.prototype.constructor=fu,fu.prototype.toJSON=function(){var e=Li.prototype.toJSON.call(this);return du(this.parameters.shapes,this.parameters.options,e)};var pu={generateTopUV:function(e,t,n,r,i){var a=t[3*n],o=t[3*n+1],s=t[3*r],c=t[3*r+1],u=t[3*i],l=t[3*i+1];return[new Sn(a,o),new Sn(s,c),new Sn(u,l)]},generateSideWallUV:function(e,t,n,r,i,a){var o=t[3*n],s=t[3*n+1],c=t[3*n+2],u=t[3*r],l=t[3*r+1],h=t[3*r+2],f=t[3*i],p=t[3*i+1],d=t[3*i+2],m=t[3*a],v=t[3*a+1],g=t[3*a+2];return Math.abs(s-l)<.01?[new Sn(o,1-c),new Sn(u,1-h),new Sn(f,1-d),new Sn(m,1-g)]:[new Sn(s,1-c),new Sn(l,1-h),new Sn(p,1-d),new Sn(v,1-g)]}};function du(e,t,n){if(n.shapes=[],Array.isArray(e))for(var r=0,i=e.length;r<i;r++){var a=e[r];n.shapes.push(a.uuid)}else n.shapes.push(e.uuid);return void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON()),n}function mu(e,t){$i.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new vu(e,t)),this.mergeVertices()}function vu(e,t){var n=(t=t||{}).font;if(!n||!n.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new $i;var r=n.generateShapes(e,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),fu.call(this,r,t),this.type="TextBufferGeometry"}function gu(e,t,n,r,i,a,o){$i.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:a,thetaLength:o},this.fromBufferGeometry(new yu(e,t,n,r,i,a,o)),this.mergeVertices()}function yu(e,t,n,r,i,a,o){Li.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:a,thetaLength:o},e=e||1,t=Math.max(3,Math.floor(t)||8),n=Math.max(2,Math.floor(n)||6),r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI,a=void 0!==a?a:0,o=void 0!==o?o:Math.PI;var s,c,u=Math.min(a+o,Math.PI),l=0,h=[],f=new kn,p=new kn,d=[],m=[],v=[],g=[];for(c=0;c<=n;c++){var y=[],x=c/n,b=0;for(0==c&&0==a?b=.5/t:c==n&&u==Math.PI&&(b=-.5/t),s=0;s<=t;s++){var w=s/t;f.x=-e*Math.cos(r+w*i)*Math.sin(a+x*o),f.y=e*Math.cos(a+x*o),f.z=e*Math.sin(r+w*i)*Math.sin(a+x*o),m.push(f.x,f.y,f.z),p.copy(f).normalize(),v.push(p.x,p.y,p.z),g.push(w+b,1-x),y.push(l++)}h.push(y)}for(c=0;c<n;c++)for(s=0;s<t;s++){var _=h[c][s+1],M=h[c][s],E=h[c+1][s],T=h[c+1][s+1];(0!==c||a>0)&&d.push(_,M,T),(c!==n-1||u<Math.PI)&&d.push(M,E,T)}this.setIndex(d),this.setAttribute("position",new gi(m,3)),this.setAttribute("normal",new gi(v,3)),this.setAttribute("uv",new gi(g,2))}function xu(e,t,n,r,i,a){$i.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:a},this.fromBufferGeometry(new bu(e,t,n,r,i,a)),this.mergeVertices()}function bu(e,t,n,r,i,a){Li.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:a},e=e||.5,t=t||1,i=void 0!==i?i:0,a=void 0!==a?a:2*Math.PI,n=void 0!==n?Math.max(3,n):8;var o,s,c,u=[],l=[],h=[],f=[],p=e,d=(t-e)/(r=void 0!==r?Math.max(1,r):1),m=new kn,v=new Sn;for(s=0;s<=r;s++){for(c=0;c<=n;c++)o=i+c/n*a,m.x=p*Math.cos(o),m.y=p*Math.sin(o),l.push(m.x,m.y,m.z),h.push(0,0,1),v.x=(m.x/t+1)/2,v.y=(m.y/t+1)/2,f.push(v.x,v.y);p+=d}for(s=0;s<r;s++){var g=s*(n+1);for(c=0;c<n;c++){var y=o=c+g,x=o+n+1,b=o+n+2,w=o+1;u.push(y,x,w),u.push(x,b,w)}}this.setIndex(u),this.setAttribute("position",new gi(l,3)),this.setAttribute("normal",new gi(h,3)),this.setAttribute("uv",new gi(f,2))}function wu(e,t,n,r){$i.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},this.fromBufferGeometry(new _u(e,t,n,r)),this.mergeVertices()}function _u(e,t,n,r){Li.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},t=Math.floor(t)||12,n=n||0,r=r||2*Math.PI,r=Tn.clamp(r,0,2*Math.PI);var i,a,o,s=[],c=[],u=[],l=1/t,h=new kn,f=new Sn;for(a=0;a<=t;a++){var p=n+a*l*r,d=Math.sin(p),m=Math.cos(p);for(o=0;o<=e.length-1;o++)h.x=e[o].x*d,h.y=e[o].y,h.z=e[o].x*m,c.push(h.x,h.y,h.z),f.x=a/t,f.y=o/(e.length-1),u.push(f.x,f.y)}for(a=0;a<t;a++)for(o=0;o<e.length-1;o++){var v=i=o+a*e.length,g=i+e.length,y=i+e.length+1,x=i+1;s.push(v,g,x),s.push(g,y,x)}if(this.setIndex(s),this.setAttribute("position",new gi(c,3)),this.setAttribute("uv",new gi(u,2)),this.computeVertexNormals(),r===2*Math.PI){var b=this.attributes.normal.array,w=new kn,_=new kn,M=new kn;for(i=t*e.length*3,a=0,o=0;a<e.length;a++,o+=3)w.x=b[o+0],w.y=b[o+1],w.z=b[o+2],_.x=b[i+o+0],_.y=b[i+o+1],_.z=b[i+o+2],M.addVectors(w,_).normalize(),b[o+0]=b[i+o+0]=M.x,b[o+1]=b[i+o+1]=M.y,b[o+2]=b[i+o+2]=M.z}}function Mu(e,t){$i.call(this),this.type="ShapeGeometry","object"===typeof t&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new Eu(e,t)),this.mergeVertices()}function Eu(e,t){Li.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;var n=[],r=[],i=[],a=[],o=0,s=0;if(!1===Array.isArray(e))u(e);else for(var c=0;c<e.length;c++)u(e[c]),this.addGroup(o,s,c),o+=s,s=0;function u(e){var o,c,u,l=r.length/3,h=e.extractPoints(t),f=h.shape,p=h.holes;for(!1===cu.isClockWise(f)&&(f=f.reverse()),o=0,c=p.length;o<c;o++)u=p[o],!0===cu.isClockWise(u)&&(p[o]=u.reverse());var d=cu.triangulateShape(f,p);for(o=0,c=p.length;o<c;o++)u=p[o],f=f.concat(u);for(o=0,c=f.length;o<c;o++){var m=f[o];r.push(m.x,m.y,0),i.push(0,0,1),a.push(m.x,m.y)}for(o=0,c=d.length;o<c;o++){var v=d[o],g=v[0]+l,y=v[1]+l,x=v[2]+l;n.push(g,y,x),s+=3}}this.setIndex(n),this.setAttribute("position",new gi(r,3)),this.setAttribute("normal",new gi(i,3)),this.setAttribute("uv",new gi(a,2))}function Tu(e,t){if(t.shapes=[],Array.isArray(e))for(var n=0,r=e.length;n<r;n++){var i=e[n];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}function Su(e,t){Li.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1;var n,r,i,a,o=[],s=Math.cos(Tn.DEG2RAD*t),c=[0,0],u={},l=["a","b","c"];e.isBufferGeometry?(a=new $i).fromBufferGeometry(e):a=e.clone(),a.mergeVertices(),a.computeFaceNormals();for(var h=a.vertices,f=a.faces,p=0,d=f.length;p<d;p++)for(var m=f[p],v=0;v<3;v++)n=m[l[v]],r=m[l[(v+1)%3]],c[0]=Math.min(n,r),c[1]=Math.max(n,r),void 0===u[i=c[0]+","+c[1]]?u[i]={index1:c[0],index2:c[1],face1:p,face2:void 0}:u[i].face2=p;for(i in u){var g=u[i];if(void 0===g.face2||f[g.face1].normal.dot(f[g.face2].normal)<=s){var y=h[g.index1];o.push(y.x,y.y,y.z),y=h[g.index2],o.push(y.x,y.y,y.z)}}this.setAttribute("position",new gi(o,3))}function Au(e,t,n,r,i,a,o,s){$i.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:a,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new Lu(e,t,n,r,i,a,o,s)),this.mergeVertices()}function Lu(e,t,n,r,i,a,o,s){Li.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:a,thetaStart:o,thetaLength:s};var c=this;e=void 0!==e?e:1,t=void 0!==t?t:1,n=n||1,r=Math.floor(r)||8,i=Math.floor(i)||1,a=void 0!==a&&a,o=void 0!==o?o:0,s=void 0!==s?s:2*Math.PI;var u=[],l=[],h=[],f=[],p=0,d=[],m=n/2,v=0;function g(n){var i,a,d,g=new Sn,y=new kn,x=0,b=!0===n?e:t,w=!0===n?1:-1;for(a=p,i=1;i<=r;i++)l.push(0,m*w,0),h.push(0,w,0),f.push(.5,.5),p++;for(d=p,i=0;i<=r;i++){var _=i/r*s+o,M=Math.cos(_),E=Math.sin(_);y.x=b*E,y.y=m*w,y.z=b*M,l.push(y.x,y.y,y.z),h.push(0,w,0),g.x=.5*M+.5,g.y=.5*E*w+.5,f.push(g.x,g.y),p++}for(i=0;i<r;i++){var T=a+i,S=d+i;!0===n?u.push(S,S+1,T):u.push(S+1,S,T),x+=3}c.addGroup(v,x,!0===n?1:2),v+=x}!function(){var a,g,y=new kn,x=new kn,b=0,w=(t-e)/n;for(g=0;g<=i;g++){var _=[],M=g/i,E=M*(t-e)+e;for(a=0;a<=r;a++){var T=a/r,S=T*s+o,A=Math.sin(S),L=Math.cos(S);x.x=E*A,x.y=-M*n+m,x.z=E*L,l.push(x.x,x.y,x.z),y.set(A,w,L).normalize(),h.push(y.x,y.y,y.z),f.push(T,1-M),_.push(p++)}d.push(_)}for(a=0;a<r;a++)for(g=0;g<i;g++){var R=d[g][a],P=d[g+1][a],C=d[g+1][a+1],O=d[g][a+1];u.push(R,P,O),u.push(P,C,O),b+=6}c.addGroup(v,b,0),v+=b}(),!1===a&&(e>0&&g(!0),t>0&&g(!1)),this.setIndex(u),this.setAttribute("position",new gi(l,3)),this.setAttribute("normal",new gi(h,3)),this.setAttribute("uv",new gi(f,2))}function Ru(e,t,n,r,i,a,o){Au.call(this,0,e,t,n,r,i,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:a,thetaLength:o}}function Pu(e,t,n,r,i,a,o){Lu.call(this,0,e,t,n,r,i,a,o),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:a,thetaLength:o}}function Cu(e,t,n,r){$i.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},this.fromBufferGeometry(new Ou(e,t,n,r)),this.mergeVertices()}function Ou(e,t,n,r){Li.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},e=e||1,t=void 0!==t?Math.max(3,t):8,n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI;var i,a,o=[],s=[],c=[],u=[],l=new kn,h=new Sn;for(s.push(0,0,0),c.push(0,0,1),u.push(.5,.5),a=0,i=3;a<=t;a++,i+=3){var f=n+a/t*r;l.x=e*Math.cos(f),l.y=e*Math.sin(f),s.push(l.x,l.y,l.z),c.push(0,0,1),h.x=(s[i]/e+1)/2,h.y=(s[i+1]/e+1)/2,u.push(h.x,h.y)}for(i=1;i<=t;i++)o.push(i,i+1,0);this.setIndex(o),this.setAttribute("position",new gi(s,3)),this.setAttribute("normal",new gi(c,3)),this.setAttribute("uv",new gi(u,2))}mu.prototype=Object.create($i.prototype),mu.prototype.constructor=mu,vu.prototype=Object.create(fu.prototype),vu.prototype.constructor=vu,gu.prototype=Object.create($i.prototype),gu.prototype.constructor=gu,yu.prototype=Object.create(Li.prototype),yu.prototype.constructor=yu,xu.prototype=Object.create($i.prototype),xu.prototype.constructor=xu,bu.prototype=Object.create(Li.prototype),bu.prototype.constructor=bu,wu.prototype=Object.create($i.prototype),wu.prototype.constructor=wu,_u.prototype=Object.create(Li.prototype),_u.prototype.constructor=_u,Mu.prototype=Object.create($i.prototype),Mu.prototype.constructor=Mu,Mu.prototype.toJSON=function(){var e=$i.prototype.toJSON.call(this);return Tu(this.parameters.shapes,e)},Eu.prototype=Object.create(Li.prototype),Eu.prototype.constructor=Eu,Eu.prototype.toJSON=function(){var e=Li.prototype.toJSON.call(this);return Tu(this.parameters.shapes,e)},Su.prototype=Object.create(Li.prototype),Su.prototype.constructor=Su,Au.prototype=Object.create($i.prototype),Au.prototype.constructor=Au,Lu.prototype=Object.create(Li.prototype),Lu.prototype.constructor=Lu,Ru.prototype=Object.create(Au.prototype),Ru.prototype.constructor=Ru,Pu.prototype=Object.create(Lu.prototype),Pu.prototype.constructor=Pu,Cu.prototype=Object.create($i.prototype),Cu.prototype.constructor=Cu,Ou.prototype=Object.create(Li.prototype),Ou.prototype.constructor=Ou;var Du=Object.freeze({__proto__:null,WireframeGeometry:wc,ParametricGeometry:_c,ParametricBufferGeometry:Mc,TetrahedronGeometry:Sc,TetrahedronBufferGeometry:Ac,OctahedronGeometry:Lc,OctahedronBufferGeometry:Rc,IcosahedronGeometry:Pc,IcosahedronBufferGeometry:Cc,DodecahedronGeometry:Oc,DodecahedronBufferGeometry:Dc,PolyhedronGeometry:Ec,PolyhedronBufferGeometry:Tc,TubeGeometry:Ic,TubeBufferGeometry:Nc,TorusKnotGeometry:zc,TorusKnotBufferGeometry:kc,TorusGeometry:Fc,TorusBufferGeometry:Bc,TextGeometry:mu,TextBufferGeometry:vu,SphereGeometry:gu,SphereBufferGeometry:yu,RingGeometry:xu,RingBufferGeometry:bu,PlaneGeometry:ga,PlaneBufferGeometry:ya,LatheGeometry:wu,LatheBufferGeometry:_u,ShapeGeometry:Mu,ShapeBufferGeometry:Eu,ExtrudeGeometry:hu,ExtrudeBufferGeometry:fu,EdgesGeometry:Su,ConeGeometry:Ru,ConeBufferGeometry:Pu,CylinderGeometry:Au,CylinderBufferGeometry:Lu,CircleGeometry:Cu,CircleBufferGeometry:Ou,BoxGeometry:ea,BoxBufferGeometry:ta});function Iu(e){oi.call(this),this.type="ShadowMaterial",this.color=new ei(0),this.transparent=!0,this.setValues(e)}function Nu(e){aa.call(this,e),this.type="RawShaderMaterial"}function zu(e){oi.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ei(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ei(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Yt,this.normalScale=new Sn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function ku(e){zu.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearcoat=0,this.clearcoatRoughness=0,this.sheen=null,this.clearcoatNormalScale=new Sn(1,1),this.clearcoatNormalMap=null,this.transparency=0,this.setValues(e)}function Fu(e){oi.call(this),this.type="MeshPhongMaterial",this.color=new ei(16777215),this.specular=new ei(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ei(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Yt,this.normalScale=new Sn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ee,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Bu(e){oi.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ei(16777215),this.specular=new ei(1118481),this.shininess=30,this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ei(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Yt,this.normalScale=new Sn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Uu(e){oi.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Yt,this.normalScale=new Sn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Hu(e){oi.call(this),this.type="MeshLambertMaterial",this.color=new ei(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ei(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=ee,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Gu(e){oi.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ei(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Yt,this.normalScale=new Sn(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function ju(e){$s.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}Iu.prototype=Object.create(oi.prototype),Iu.prototype.constructor=Iu,Iu.prototype.isShadowMaterial=!0,Iu.prototype.copy=function(e){return oi.prototype.copy.call(this,e),this.color.copy(e.color),this},Nu.prototype=Object.create(aa.prototype),Nu.prototype.constructor=Nu,Nu.prototype.isRawShaderMaterial=!0,zu.prototype=Object.create(oi.prototype),zu.prototype.constructor=zu,zu.prototype.isMeshStandardMaterial=!0,zu.prototype.copy=function(e){return oi.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},ku.prototype=Object.create(zu.prototype),ku.prototype.constructor=ku,ku.prototype.isMeshPhysicalMaterial=!0,ku.prototype.copy=function(e){return zu.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearcoat=e.clearcoat,this.clearcoatRoughness=e.clearcoatRoughness,e.sheen?this.sheen=(this.sheen||new ei).copy(e.sheen):this.sheen=null,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.transparency=e.transparency,this},Fu.prototype=Object.create(oi.prototype),Fu.prototype.constructor=Fu,Fu.prototype.isMeshPhongMaterial=!0,Fu.prototype.copy=function(e){return oi.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Bu.prototype=Object.create(oi.prototype),Bu.prototype.constructor=Bu,Bu.prototype.isMeshToonMaterial=!0,Bu.prototype.copy=function(e){return oi.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Uu.prototype=Object.create(oi.prototype),Uu.prototype.constructor=Uu,Uu.prototype.isMeshNormalMaterial=!0,Uu.prototype.copy=function(e){return oi.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Hu.prototype=Object.create(oi.prototype),Hu.prototype.constructor=Hu,Hu.prototype.isMeshLambertMaterial=!0,Hu.prototype.copy=function(e){return oi.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Gu.prototype=Object.create(oi.prototype),Gu.prototype.constructor=Gu,Gu.prototype.isMeshMatcapMaterial=!0,Gu.prototype.copy=function(e){return oi.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},ju.prototype=Object.create($s.prototype),ju.prototype.constructor=ju,ju.prototype.isLineDashedMaterial=!0,ju.prototype.copy=function(e){return $s.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var Vu=Object.freeze({__proto__:null,ShadowMaterial:Iu,SpriteMaterial:Ts,RawShaderMaterial:Nu,ShaderMaterial:aa,PointsMaterial:lc,MeshPhysicalMaterial:ku,MeshStandardMaterial:zu,MeshPhongMaterial:Fu,MeshToonMaterial:Bu,MeshNormalMaterial:Uu,MeshLambertMaterial:Hu,MeshDepthMaterial:ss,MeshDistanceMaterial:cs,MeshBasicMaterial:si,MeshMatcapMaterial:Gu,LineDashedMaterial:ju,LineBasicMaterial:$s,Material:oi}),Wu={arraySlice:function(e,t,n){return Wu.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"===typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,n=new Array(t),r=0;r!==t;++r)n[r]=r;return n.sort((function(t,n){return e[t]-e[n]})),n},sortedArray:function(e,t,n){for(var r=e.length,i=new e.constructor(r),a=0,o=0;o!==r;++a)for(var s=n[a]*t,c=0;c!==t;++c)i[o++]=e[s+c];return i},flattenJSON:function(e,t,n,r){for(var i=1,a=e[0];void 0!==a&&void 0===a[r];)a=e[i++];if(void 0!==a){var o=a[r];if(void 0!==o)if(Array.isArray(o))do{void 0!==(o=a[r])&&(t.push(a.time),n.push.apply(n,o)),a=e[i++]}while(void 0!==a);else if(void 0!==o.toArray)do{void 0!==(o=a[r])&&(t.push(a.time),o.toArray(n,n.length)),a=e[i++]}while(void 0!==a);else do{void 0!==(o=a[r])&&(t.push(a.time),n.push(o)),a=e[i++]}while(void 0!==a)}},subclip:function(e,t,n,r,i){i=i||30;var a=e.clone();a.name=t;for(var o=[],s=0;s<a.tracks.length;++s){for(var c=a.tracks[s],u=c.getValueSize(),l=[],h=[],f=0;f<c.times.length;++f){var p=c.times[f]*i;if(!(p<n||p>=r)){l.push(c.times[f]);for(var d=0;d<u;++d)h.push(c.values[f*u+d])}}0!==l.length&&(c.times=Wu.convertArray(l,c.times.constructor),c.values=Wu.convertArray(h,c.values.constructor),o.push(c))}a.tracks=o;var m=1/0;for(s=0;s<a.tracks.length;++s)m>a.tracks[s].times[0]&&(m=a.tracks[s].times[0]);for(s=0;s<a.tracks.length;++s)a.tracks[s].shift(-1*m);return a.resetDuration(),a}};function qu(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n}function Yu(e,t,n,r){qu.call(this,e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function Xu(e,t,n,r){qu.call(this,e,t,n,r)}function Zu(e,t,n,r){qu.call(this,e,t,n,r)}function Ju(e,t,n,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Wu.convertArray(t,this.TimeBufferType),this.values=Wu.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}function Qu(e,t,n){Ju.call(this,e,t,n)}function Ku(e,t,n,r){Ju.call(this,e,t,n,r)}function $u(e,t,n,r){Ju.call(this,e,t,n,r)}function el(e,t,n,r){qu.call(this,e,t,n,r)}function tl(e,t,n,r){Ju.call(this,e,t,n,r)}function nl(e,t,n,r){Ju.call(this,e,t,n,r)}function rl(e,t,n,r){Ju.call(this,e,t,n,r)}function il(e,t,n){this.name=e,this.tracks=n,this.duration=void 0!==t?t:-1,this.uuid=Tn.generateUUID(),this.duration<0&&this.resetDuration()}function al(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return $u;case"vector":case"vector2":case"vector3":case"vector4":return rl;case"color":return Ku;case"quaternion":return tl;case"bool":case"boolean":return Qu;case"string":return nl}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var n=[],r=[];Wu.flattenJSON(e.keys,n,r,"value"),e.times=n,e.values=r}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign(qu.prototype,{evaluate:function(e){var t=this.parameterPositions,n=this._cachedIndex,r=t[n],i=t[n-1];e:{t:{var a;n:{r:if(!(e<r)){for(var o=n+2;;){if(void 0===r){if(e<i)break r;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,i)}if(n===o)break;if(i=r,e<(r=t[++n]))break t}a=t.length;break n}if(e>=i)break e;var s=t[1];e<s&&(n=2,i=s);for(o=n-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(n===o)break;if(r=i,e>=(i=t[--n-1]))break t}a=n,n=0}for(;n<a;){var c=n+a>>>1;e<t[c]?a=c:n=c+1}if(r=t[n],void 0===(i=t[n-1]))return this._cachedIndex=0,this.beforeStart_(0,e,r);if(void 0===r)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,i,e)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,e,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r,a=0;a!==r;++a)t[a]=n[i+a];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(qu.prototype,{beforeStart_:qu.prototype.copySampleValue_,afterEnd_:qu.prototype.copySampleValue_}),Yu.prototype=Object.assign(Object.create(qu.prototype),{constructor:Yu,DefaultSettings_:{endingStart:Ct,endingEnd:Ct},intervalChanged_:function(e,t,n){var r=this.parameterPositions,i=e-2,a=e+1,o=r[i],s=r[a];if(void 0===o)switch(this.getSettings_().endingStart){case Ot:i=e,o=2*t-n;break;case Dt:o=t+r[i=r.length-2]-r[i+1];break;default:i=e,o=n}if(void 0===s)switch(this.getSettings_().endingEnd){case Ot:a=e,s=2*n-t;break;case Dt:a=1,s=n+r[1]-r[0];break;default:a=e-1,s=t}var c=.5*(n-t),u=this.valueSize;this._weightPrev=c/(t-o),this._weightNext=c/(s-n),this._offsetPrev=i*u,this._offsetNext=a*u},interpolate_:function(e,t,n,r){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,c=s-o,u=this._offsetPrev,l=this._offsetNext,h=this._weightPrev,f=this._weightNext,p=(n-t)/(r-t),d=p*p,m=d*p,v=-h*m+2*h*d-h*p,g=(1+h)*m+(-1.5-2*h)*d+(-.5+h)*p+1,y=(-1-f)*m+(1.5+f)*d+.5*p,x=f*m-f*d,b=0;b!==o;++b)i[b]=v*a[u+b]+g*a[c+b]+y*a[s+b]+x*a[l+b];return i}}),Xu.prototype=Object.assign(Object.create(qu.prototype),{constructor:Xu,interpolate_:function(e,t,n,r){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,c=s-o,u=(n-t)/(r-t),l=1-u,h=0;h!==o;++h)i[h]=a[c+h]*l+a[s+h]*u;return i}}),Zu.prototype=Object.assign(Object.create(qu.prototype),{constructor:Zu,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(Ju,{toJSON:function(e){var t,n=e.constructor;if(void 0!==n.toJSON)t=n.toJSON(e);else{t={name:e.name,times:Wu.convertArray(e.times,Array),values:Wu.convertArray(e.values,Array)};var r=e.getInterpolation();r!==e.DefaultInterpolation&&(t.interpolation=r)}return t.type=e.ValueTypeName,t}}),Object.assign(Ju.prototype,{constructor:Ju,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:Rt,InterpolantFactoryMethodDiscrete:function(e){return new Zu(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new Xu(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new Yu(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case Lt:t=this.InterpolantFactoryMethodDiscrete;break;case Rt:t=this.InterpolantFactoryMethodLinear;break;case Pt:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Lt;case this.InterpolantFactoryMethodLinear:return Rt;case this.InterpolantFactoryMethodSmooth:return Pt}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,n=0,r=t.length;n!==r;++n)t[n]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,n=0,r=t.length;n!==r;++n)t[n]*=e;return this},trim:function(e,t){for(var n=this.times,r=n.length,i=0,a=r-1;i!==r&&n[i]<e;)++i;for(;-1!==a&&n[a]>t;)--a;if(++a,0!==i||a!==r){i>=a&&(i=(a=Math.max(a,1))-1);var o=this.getValueSize();this.times=Wu.arraySlice(n,i,a),this.values=Wu.arraySlice(this.values,i*o,a*o)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var a=null,o=0;o!==i;o++){var s=n[o];if("number"===typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,s),e=!1;break}if(null!==a&&a>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,s,a),e=!1;break}a=s}if(void 0!==r&&Wu.isTypedArray(r)){o=0;for(var c=r.length;o!==c;++o){var u=r[o];if(isNaN(u)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,o,u),e=!1;break}}}return e},optimize:function(){for(var e=Wu.arraySlice(this.times),t=Wu.arraySlice(this.values),n=this.getValueSize(),r=this.getInterpolation()===Pt,i=1,a=e.length-1,o=1;o<a;++o){var s=!1,c=e[o];if(c!==e[o+1]&&(1!==o||c!==c[0]))if(r)s=!0;else for(var u=o*n,l=u-n,h=u+n,f=0;f!==n;++f){var p=t[u+f];if(p!==t[l+f]||p!==t[h+f]){s=!0;break}}if(s){if(o!==i){e[i]=e[o];var d=o*n,m=i*n;for(f=0;f!==n;++f)t[m+f]=t[d+f]}++i}}if(a>0){e[i]=e[a];for(d=a*n,m=i*n,f=0;f!==n;++f)t[m+f]=t[d+f];++i}return i!==e.length?(this.times=Wu.arraySlice(e,0,i),this.values=Wu.arraySlice(t,0,i*n)):(this.times=e,this.values=t),this},clone:function(){var e=Wu.arraySlice(this.times,0),t=Wu.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}),Qu.prototype=Object.assign(Object.create(Ju.prototype),{constructor:Qu,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:Lt,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Ku.prototype=Object.assign(Object.create(Ju.prototype),{constructor:Ku,ValueTypeName:"color"}),$u.prototype=Object.assign(Object.create(Ju.prototype),{constructor:$u,ValueTypeName:"number"}),el.prototype=Object.assign(Object.create(qu.prototype),{constructor:el,interpolate_:function(e,t,n,r){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,c=(n-t)/(r-t),u=s+o;s!==u;s+=4)In.slerpFlat(i,0,a,s-o,a,s,c);return i}}),tl.prototype=Object.assign(Object.create(Ju.prototype),{constructor:tl,ValueTypeName:"quaternion",DefaultInterpolation:Rt,InterpolantFactoryMethodLinear:function(e){return new el(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),nl.prototype=Object.assign(Object.create(Ju.prototype),{constructor:nl,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:Lt,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),rl.prototype=Object.assign(Object.create(Ju.prototype),{constructor:rl,ValueTypeName:"vector"}),Object.assign(il,{parse:function(e){for(var t=[],n=e.tracks,r=1/(e.fps||1),i=0,a=n.length;i!==a;++i)t.push(al(n[i]).scale(r));return new il(e.name,e.duration,t)},toJSON:function(e){for(var t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid},i=0,a=n.length;i!==a;++i)t.push(Ju.toJSON(n[i]));return r},CreateFromMorphTargetSequence:function(e,t,n,r){for(var i=t.length,a=[],o=0;o<i;o++){var s=[],c=[];s.push((o+i-1)%i,o,(o+1)%i),c.push(0,1,0);var u=Wu.getKeyframeOrder(s);s=Wu.sortedArray(s,1,u),c=Wu.sortedArray(c,1,u),r||0!==s[0]||(s.push(i),c.push(c[0])),a.push(new $u(".morphTargetInfluences["+t[o].name+"]",s,c).scale(1/n))}return new il(e,-1,a)},findByName:function(e,t){var n=e;if(!Array.isArray(e)){var r=e;n=r.geometry&&r.geometry.animations||r.animations}for(var i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null},CreateClipsFromMorphTargetSequences:function(e,t,n){for(var r={},i=/^([\w-]*?)([\d]+)$/,a=0,o=e.length;a<o;a++){var s=e[a],c=s.name.match(i);if(c&&c.length>1){var u=r[h=c[1]];u||(r[h]=u=[]),u.push(s)}}var l=[];for(var h in r)l.push(il.CreateFromMorphTargetSequence(h,r[h],t,n));return l},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(e,t,n,r,i){if(0!==n.length){var a=[],o=[];Wu.flattenJSON(n,a,o,r),0!==a.length&&i.push(new e(t,a,o))}},r=[],i=e.name||"default",a=e.length||-1,o=e.fps||30,s=e.hierarchy||[],c=0;c<s.length;c++){var u=s[c].keys;if(u&&0!==u.length)if(u[0].morphTargets){for(var l={},h=0;h<u.length;h++)if(u[h].morphTargets)for(var f=0;f<u[h].morphTargets.length;f++)l[u[h].morphTargets[f]]=-1;for(var p in l){var d=[],m=[];for(f=0;f!==u[h].morphTargets.length;++f){var v=u[h];d.push(v.time),m.push(v.morphTarget===p?1:0)}r.push(new $u(".morphTargetInfluence["+p+"]",d,m))}a=l.length*(o||1)}else{var g=".bones["+t[c].name+"]";n(rl,g+".position",u,"pos",r),n(tl,g+".quaternion",u,"rot",r),n(rl,g+".scale",u,"scl",r)}}return 0===r.length?null:new il(i,a,r)}}),Object.assign(il.prototype,{resetDuration:function(){for(var e=0,t=0,n=this.tracks.length;t!==n;++t){var r=this.tracks[t];e=Math.max(e,r.times[r.times.length-1])}return this.duration=e,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new il(this.name,this.duration,e)}});var ol={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function sl(e,t,n){var r=this,i=!1,a=0,o=0,s=void 0,c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){o++,!1===i&&void 0!==r.onStart&&r.onStart(e,a,o),i=!0},this.itemEnd=function(e){a++,void 0!==r.onProgress&&r.onProgress(e,a,o),a===o&&(i=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this},this.addHandler=function(e,t){return c.push(e,t),this},this.removeHandler=function(e){var t=c.indexOf(e);return-1!==t&&c.splice(t,2),this},this.getHandler=function(e){for(var t=0,n=c.length;t<n;t+=2){var r=c[t],i=c[t+1];if(r.global&&(r.lastIndex=0),r.test(e))return i}return null}}var cl=new sl;function ul(e){this.manager=void 0!==e?e:cl,this.crossOrigin="anonymous",this.path="",this.resourcePath=""}Object.assign(ul.prototype,{load:function(){},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this}});var ll={};function hl(e){ul.call(this,e)}function fl(e){ul.call(this,e)}function pl(e){ul.call(this,e)}function dl(e){ul.call(this,e)}function ml(e){ul.call(this,e)}function vl(e){ul.call(this,e)}function gl(e){ul.call(this,e)}function yl(){this.type="Curve",this.arcLengthDivisions=200}function xl(e,t,n,r,i,a,o,s){yl.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=n||1,this.yRadius=r||1,this.aStartAngle=i||0,this.aEndAngle=a||2*Math.PI,this.aClockwise=o||!1,this.aRotation=s||0}function bl(e,t,n,r,i,a){xl.call(this,e,t,n,n,r,i,a),this.type="ArcCurve"}function wl(){var e=0,t=0,n=0,r=0;function i(i,a,o,s){e=i,t=o,n=-3*i+3*a-2*o-s,r=2*i-2*a+o+s}return{initCatmullRom:function(e,t,n,r,a){i(t,n,a*(n-e),a*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,a,o,s){var c=(t-e)/a-(n-e)/(a+o)+(n-t)/o,u=(n-t)/o-(r-t)/(o+s)+(r-n)/s;i(t,n,c*=o,u*=o)},calc:function(i){var a=i*i;return e+t*i+n*a+r*(a*i)}}}hl.prototype=Object.assign(Object.create(ul.prototype),{constructor:hl,load:function(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,a=ol.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout((function(){t&&t(a),i.manager.itemEnd(e)}),0),a;if(void 0===ll[e]){var o=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(o){var s=o[1],c=!!o[2],u=o[3];u=decodeURIComponent(u),c&&(u=atob(u));try{var l,h=(this.responseType||"").toLowerCase();switch(h){case"arraybuffer":case"blob":for(var f=new Uint8Array(u.length),p=0;p<u.length;p++)f[p]=u.charCodeAt(p);l="blob"===h?new Blob([f.buffer],{type:s}):f.buffer;break;case"document":var d=new DOMParser;l=d.parseFromString(u,s);break;case"json":l=JSON.parse(u);break;default:l=u}setTimeout((function(){t&&t(l),i.manager.itemEnd(e)}),0)}catch(g){setTimeout((function(){r&&r(g),i.manager.itemError(e),i.manager.itemEnd(e)}),0)}}else{ll[e]=[],ll[e].push({onLoad:t,onProgress:n,onError:r});var m=new XMLHttpRequest;for(var v in m.open("GET",e,!0),m.addEventListener("load",(function(t){var n=this.response,r=ll[e];if(delete ll[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),ol.add(e,n);for(var a=0,o=r.length;a<o;a++){(s=r[a]).onLoad&&s.onLoad(n)}i.manager.itemEnd(e)}else{for(a=0,o=r.length;a<o;a++){var s;(s=r[a]).onError&&s.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}}),!1),m.addEventListener("progress",(function(t){for(var n=ll[e],r=0,i=n.length;r<i;r++){var a=n[r];a.onProgress&&a.onProgress(t)}}),!1),m.addEventListener("error",(function(t){var n=ll[e];delete ll[e];for(var r=0,a=n.length;r<a;r++){var o=n[r];o.onError&&o.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}),!1),m.addEventListener("abort",(function(t){var n=ll[e];delete ll[e];for(var r=0,a=n.length;r<a;r++){var o=n[r];o.onError&&o.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}),!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(v,this.requestHeader[v]);m.send(null)}return i.manager.itemStart(e),m}ll[e].push({onLoad:t,onProgress:n,onError:r})},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),fl.prototype=Object.assign(Object.create(ul.prototype),{constructor:fl,load:function(e,t,n,r){var i=this,a=new hl(i.manager);a.setPath(i.path),a.load(e,(function(e){t(i.parse(JSON.parse(e)))}),n,r)},parse:function(e){for(var t=[],n=0;n<e.length;n++){var r=il.parse(e[n]);t.push(r)}return t}}),pl.prototype=Object.assign(Object.create(ul.prototype),{constructor:pl,load:function(e,t,n,r){var i=this,a=[],o=new yc;o.image=a;var s=new hl(this.manager);function c(c){s.load(e[c],(function(e){var n=i.parse(e,!0);a[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},6===(u+=1)&&(1===n.mipmapCount&&(o.minFilter=Te),o.format=n.format,o.needsUpdate=!0,t&&t(o))}),n,r)}if(s.setPath(this.path),s.setResponseType("arraybuffer"),Array.isArray(e))for(var u=0,l=0,h=e.length;l<h;++l)c(l);else s.load(e,(function(e){var n=i.parse(e,!0);if(n.isCubemap)for(var r=n.mipmaps.length/n.mipmapCount,s=0;s<r;s++){a[s]={mipmaps:[]};for(var c=0;c<n.mipmapCount;c++)a[s].mipmaps.push(n.mipmaps[s*n.mipmapCount+c]),a[s].format=n.format,a[s].width=n.width,a[s].height=n.height}else o.image.width=n.width,o.image.height=n.height,o.mipmaps=n.mipmaps;1===n.mipmapCount&&(o.minFilter=Te),o.format=n.format,o.needsUpdate=!0,t&&t(o)}),n,r);return o}}),dl.prototype=Object.assign(Object.create(ul.prototype),{constructor:dl,load:function(e,t,n,r){var i=this,a=new la,o=new hl(this.manager);return o.setResponseType("arraybuffer"),o.setPath(this.path),o.load(e,(function(e){var n=i.parse(e);n&&(void 0!==n.image?a.image=n.image:void 0!==n.data&&(a.image.width=n.width,a.image.height=n.height,a.image.data=n.data),a.wrapS=void 0!==n.wrapS?n.wrapS:ye,a.wrapT=void 0!==n.wrapT?n.wrapT:ye,a.magFilter=void 0!==n.magFilter?n.magFilter:Te,a.minFilter=void 0!==n.minFilter?n.minFilter:Te,a.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.format&&(a.format=n.format),void 0!==n.type&&(a.type=n.type),void 0!==n.mipmaps&&(a.mipmaps=n.mipmaps,a.minFilter=Le),1===n.mipmapCount&&(a.minFilter=Te),a.needsUpdate=!0,t&&t(a,n))}),n,r),a}}),ml.prototype=Object.assign(Object.create(ul.prototype),{constructor:ml,load:function(e,t,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,a=ol.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout((function(){t&&t(a),i.manager.itemEnd(e)}),0),a;var o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){o.removeEventListener("load",s,!1),o.removeEventListener("error",c,!1),ol.add(e,this),t&&t(this),i.manager.itemEnd(e)}function c(t){o.removeEventListener("load",s,!1),o.removeEventListener("error",c,!1),r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}return o.addEventListener("load",s,!1),o.addEventListener("error",c,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),i.manager.itemStart(e),o.src=e,o}}),vl.prototype=Object.assign(Object.create(ul.prototype),{constructor:vl,load:function(e,t,n,r){var i=new Oa,a=new ml(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);var o=0;function s(n){a.load(e[n],(function(e){i.images[n]=e,6===++o&&(i.needsUpdate=!0,t&&t(i))}),void 0,r)}for(var c=0;c<e.length;++c)s(c);return i}}),gl.prototype=Object.assign(Object.create(ul.prototype),{constructor:gl,load:function(e,t,n,r){var i=new Pn,a=new ml(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,(function(n){i.image=n;var r=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);i.format=r?je:Ve,i.needsUpdate=!0,void 0!==t&&t(i)}),n,r),i}}),Object.assign(yl.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var n=this.getUtoTmapping(e);return this.getPoint(n,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n,r=[],i=this.getPoint(0),a=0;for(r.push(0),n=1;n<=e;n++)a+=(t=this.getPoint(n/e)).distanceTo(i),r.push(a),i=t;return this.cacheArcLengths=r,r},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var n,r=this.getLengths(),i=0,a=r.length;n=t||e*r[a-1];for(var o,s=0,c=a-1;s<=c;)if((o=r[i=Math.floor(s+(c-s)/2)]-n)<0)s=i+1;else{if(!(o>0)){c=i;break}c=i-1}if(r[i=c]===n)return i/(a-1);var u=r[i];return(i+(n-u)/(r[i+1]-u))/(a-1)},getTangent:function(e){var t=e-1e-4,n=e+1e-4;t<0&&(t=0),n>1&&(n=1);var r=this.getPoint(t);return this.getPoint(n).clone().sub(r).normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},computeFrenetFrames:function(e,t){var n,r,i,a=new kn,o=[],s=[],c=[],u=new kn,l=new Wn;for(n=0;n<=e;n++)r=n/e,o[n]=this.getTangentAt(r),o[n].normalize();s[0]=new kn,c[0]=new kn;var h=Number.MAX_VALUE,f=Math.abs(o[0].x),p=Math.abs(o[0].y),d=Math.abs(o[0].z);for(f<=h&&(h=f,a.set(1,0,0)),p<=h&&(h=p,a.set(0,1,0)),d<=h&&a.set(0,0,1),u.crossVectors(o[0],a).normalize(),s[0].crossVectors(o[0],u),c[0].crossVectors(o[0],s[0]),n=1;n<=e;n++)s[n]=s[n-1].clone(),c[n]=c[n-1].clone(),u.crossVectors(o[n-1],o[n]),u.length()>Number.EPSILON&&(u.normalize(),i=Math.acos(Tn.clamp(o[n-1].dot(o[n]),-1,1)),s[n].applyMatrix4(l.makeRotationAxis(u,i))),c[n].crossVectors(o[n],s[n]);if(!0===t)for(i=Math.acos(Tn.clamp(s[0].dot(s[e]),-1,1)),i/=e,o[0].dot(u.crossVectors(s[0],s[e]))>0&&(i=-i),n=1;n<=e;n++)s[n].applyMatrix4(l.makeRotationAxis(o[n],i*n)),c[n].crossVectors(o[n],s[n]);return{tangents:o,normals:s,binormals:c}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),xl.prototype=Object.create(yl.prototype),xl.prototype.constructor=xl,xl.prototype.isEllipseCurve=!0,xl.prototype.getPoint=function(e,t){for(var n=t||new Sn,r=2*Math.PI,i=this.aEndAngle-this.aStartAngle,a=Math.abs(i)<Number.EPSILON;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=a?0:r),!0!==this.aClockwise||a||(i===r?i=-r:i-=r);var o=this.aStartAngle+e*i,s=this.aX+this.xRadius*Math.cos(o),c=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){var u=Math.cos(this.aRotation),l=Math.sin(this.aRotation),h=s-this.aX,f=c-this.aY;s=h*u-f*l+this.aX,c=h*l+f*u+this.aY}return n.set(s,c)},xl.prototype.copy=function(e){return yl.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},xl.prototype.toJSON=function(){var e=yl.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},xl.prototype.fromJSON=function(e){return yl.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},bl.prototype=Object.create(xl.prototype),bl.prototype.constructor=bl,bl.prototype.isArcCurve=!0;var _l=new kn,Ml=new wl,El=new wl,Tl=new wl;function Sl(e,t,n,r){yl.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=n||"centripetal",this.tension=r||.5}function Al(e,t,n,r,i){var a=.5*(r-t),o=.5*(i-n),s=e*e;return(2*n-2*r+a+o)*(e*s)+(-3*n+3*r-2*a-o)*s+a*e+n}function Ll(e,t,n,r){return function(e,t){var n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,r)}function Rl(e,t,n,r,i){return function(e,t){var n=1-e;return n*n*n*t}(e,t)+function(e,t){var n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,i)}function Pl(e,t,n,r){yl.call(this),this.type="CubicBezierCurve",this.v0=e||new Sn,this.v1=t||new Sn,this.v2=n||new Sn,this.v3=r||new Sn}function Cl(e,t,n,r){yl.call(this),this.type="CubicBezierCurve3",this.v0=e||new kn,this.v1=t||new kn,this.v2=n||new kn,this.v3=r||new kn}function Ol(e,t){yl.call(this),this.type="LineCurve",this.v1=e||new Sn,this.v2=t||new Sn}function Dl(e,t){yl.call(this),this.type="LineCurve3",this.v1=e||new kn,this.v2=t||new kn}function Il(e,t,n){yl.call(this),this.type="QuadraticBezierCurve",this.v0=e||new Sn,this.v1=t||new Sn,this.v2=n||new Sn}function Nl(e,t,n){yl.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new kn,this.v1=t||new kn,this.v2=n||new kn}function zl(e){yl.call(this),this.type="SplineCurve",this.points=e||[]}Sl.prototype=Object.create(yl.prototype),Sl.prototype.constructor=Sl,Sl.prototype.isCatmullRomCurve3=!0,Sl.prototype.getPoint=function(e,t){var n,r,i,a,o=t||new kn,s=this.points,c=s.length,u=(c-(this.closed?0:1))*e,l=Math.floor(u),h=u-l;if(this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/c)+1)*c:0===h&&l===c-1&&(l=c-2,h=1),this.closed||l>0?n=s[(l-1)%c]:(_l.subVectors(s[0],s[1]).add(s[0]),n=_l),r=s[l%c],i=s[(l+1)%c],this.closed||l+2<c?a=s[(l+2)%c]:(_l.subVectors(s[c-1],s[c-2]).add(s[c-1]),a=_l),"centripetal"===this.curveType||"chordal"===this.curveType){var f="chordal"===this.curveType?.5:.25,p=Math.pow(n.distanceToSquared(r),f),d=Math.pow(r.distanceToSquared(i),f),m=Math.pow(i.distanceToSquared(a),f);d<1e-4&&(d=1),p<1e-4&&(p=d),m<1e-4&&(m=d),Ml.initNonuniformCatmullRom(n.x,r.x,i.x,a.x,p,d,m),El.initNonuniformCatmullRom(n.y,r.y,i.y,a.y,p,d,m),Tl.initNonuniformCatmullRom(n.z,r.z,i.z,a.z,p,d,m)}else"catmullrom"===this.curveType&&(Ml.initCatmullRom(n.x,r.x,i.x,a.x,this.tension),El.initCatmullRom(n.y,r.y,i.y,a.y,this.tension),Tl.initCatmullRom(n.z,r.z,i.z,a.z,this.tension));return o.set(Ml.calc(h),El.calc(h),Tl.calc(h)),o},Sl.prototype.copy=function(e){yl.prototype.copy.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Sl.prototype.toJSON=function(){var e=yl.prototype.toJSON.call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},Sl.prototype.fromJSON=function(e){yl.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push((new kn).fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Pl.prototype=Object.create(yl.prototype),Pl.prototype.constructor=Pl,Pl.prototype.isCubicBezierCurve=!0,Pl.prototype.getPoint=function(e,t){var n=t||new Sn,r=this.v0,i=this.v1,a=this.v2,o=this.v3;return n.set(Rl(e,r.x,i.x,a.x,o.x),Rl(e,r.y,i.y,a.y,o.y)),n},Pl.prototype.copy=function(e){return yl.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Pl.prototype.toJSON=function(){var e=yl.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Pl.prototype.fromJSON=function(e){return yl.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Cl.prototype=Object.create(yl.prototype),Cl.prototype.constructor=Cl,Cl.prototype.isCubicBezierCurve3=!0,Cl.prototype.getPoint=function(e,t){var n=t||new kn,r=this.v0,i=this.v1,a=this.v2,o=this.v3;return n.set(Rl(e,r.x,i.x,a.x,o.x),Rl(e,r.y,i.y,a.y,o.y),Rl(e,r.z,i.z,a.z,o.z)),n},Cl.prototype.copy=function(e){return yl.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Cl.prototype.toJSON=function(){var e=yl.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Cl.prototype.fromJSON=function(e){return yl.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Ol.prototype=Object.create(yl.prototype),Ol.prototype.constructor=Ol,Ol.prototype.isLineCurve=!0,Ol.prototype.getPoint=function(e,t){var n=t||new Sn;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},Ol.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Ol.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},Ol.prototype.copy=function(e){return yl.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Ol.prototype.toJSON=function(){var e=yl.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Ol.prototype.fromJSON=function(e){return yl.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Dl.prototype=Object.create(yl.prototype),Dl.prototype.constructor=Dl,Dl.prototype.isLineCurve3=!0,Dl.prototype.getPoint=function(e,t){var n=t||new kn;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},Dl.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Dl.prototype.copy=function(e){return yl.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Dl.prototype.toJSON=function(){var e=yl.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Dl.prototype.fromJSON=function(e){return yl.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Il.prototype=Object.create(yl.prototype),Il.prototype.constructor=Il,Il.prototype.isQuadraticBezierCurve=!0,Il.prototype.getPoint=function(e,t){var n=t||new Sn,r=this.v0,i=this.v1,a=this.v2;return n.set(Ll(e,r.x,i.x,a.x),Ll(e,r.y,i.y,a.y)),n},Il.prototype.copy=function(e){return yl.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Il.prototype.toJSON=function(){var e=yl.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Il.prototype.fromJSON=function(e){return yl.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Nl.prototype=Object.create(yl.prototype),Nl.prototype.constructor=Nl,Nl.prototype.isQuadraticBezierCurve3=!0,Nl.prototype.getPoint=function(e,t){var n=t||new kn,r=this.v0,i=this.v1,a=this.v2;return n.set(Ll(e,r.x,i.x,a.x),Ll(e,r.y,i.y,a.y),Ll(e,r.z,i.z,a.z)),n},Nl.prototype.copy=function(e){return yl.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Nl.prototype.toJSON=function(){var e=yl.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Nl.prototype.fromJSON=function(e){return yl.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},zl.prototype=Object.create(yl.prototype),zl.prototype.constructor=zl,zl.prototype.isSplineCurve=!0,zl.prototype.getPoint=function(e,t){var n=t||new Sn,r=this.points,i=(r.length-1)*e,a=Math.floor(i),o=i-a,s=r[0===a?a:a-1],c=r[a],u=r[a>r.length-2?r.length-1:a+1],l=r[a>r.length-3?r.length-1:a+2];return n.set(Al(o,s.x,c.x,u.x,l.x),Al(o,s.y,c.y,u.y,l.y)),n},zl.prototype.copy=function(e){yl.prototype.copy.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push(r.clone())}return this},zl.prototype.toJSON=function(){var e=yl.prototype.toJSON.call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var r=this.points[t];e.points.push(r.toArray())}return e},zl.prototype.fromJSON=function(e){yl.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push((new Sn).fromArray(r))}return this};var kl=Object.freeze({__proto__:null,ArcCurve:bl,CatmullRomCurve3:Sl,CubicBezierCurve:Pl,CubicBezierCurve3:Cl,EllipseCurve:xl,LineCurve:Ol,LineCurve3:Dl,QuadraticBezierCurve:Il,QuadraticBezierCurve3:Nl,SplineCurve:zl});function Fl(){yl.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function Bl(e){Fl.call(this),this.type="Path",this.currentPoint=new Sn,e&&this.setFromPoints(e)}function Ul(e){Bl.call(this,e),this.uuid=Tn.generateUUID(),this.type="Shape",this.holes=[]}function Hl(e,t){ur.call(this),this.type="Light",this.color=new ei(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function Gl(e,t,n){Hl.call(this,e,n),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(ur.DefaultUp),this.updateMatrix(),this.groundColor=new ei(t)}function jl(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new Sn(512,512),this.map=null,this.mapPass=null,this.matrix=new Wn,this._frustum=new pa,this._frameExtents=new Sn(1,1),this._viewportCount=1,this._viewports=[new Cn(0,0,1,1)]}function Vl(){jl.call(this,new sa(50,1,.5,500))}function Wl(e,t,n,r,i,a){Hl.call(this,e,t),this.type="SpotLight",this.position.copy(ur.DefaultUp),this.updateMatrix(),this.target=new ur,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==n?n:0,this.angle=void 0!==r?r:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==a?a:1,this.shadow=new Vl}function ql(){jl.call(this,new sa(90,1,.5,500)),this._frameExtents=new Sn(4,2),this._viewportCount=6,this._viewports=[new Cn(2,1,1,1),new Cn(0,1,1,1),new Cn(3,1,1,1),new Cn(1,1,1,1),new Cn(3,0,1,1),new Cn(1,0,1,1)],this._cubeDirections=[new kn(1,0,0),new kn(-1,0,0),new kn(0,0,1),new kn(0,0,-1),new kn(0,1,0),new kn(0,-1,0)],this._cubeUps=[new kn(0,1,0),new kn(0,1,0),new kn(0,1,0),new kn(0,1,0),new kn(0,0,1),new kn(0,0,-1)]}function Yl(e,t,n,r){Hl.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==r?r:1,this.shadow=new ql}function Xl(e,t,n,r,i,a){oa.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==e?e:-1,this.right=void 0!==t?t:1,this.top=void 0!==n?n:1,this.bottom=void 0!==r?r:-1,this.near=void 0!==i?i:.1,this.far=void 0!==a?a:2e3,this.updateProjectionMatrix()}function Zl(){jl.call(this,new Xl(-5,5,5,-5,.5,500))}function Jl(e,t){Hl.call(this,e,t),this.type="DirectionalLight",this.position.copy(ur.DefaultUp),this.updateMatrix(),this.target=new ur,this.shadow=new Zl}function Ql(e,t){Hl.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function Kl(e,t,n,r){Hl.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==n?n:10,this.height=void 0!==r?r:10}function $l(e){ul.call(this,e),this.textures={}}Fl.prototype=Object.assign(Object.create(yl.prototype),{constructor:Fl,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Ol(t,e))},getPoint:function(e){for(var t=e*this.getLength(),n=this.getCurveLengths(),r=0;r<n.length;){if(n[r]>=t){var i=n[r]-t,a=this.curves[r],o=a.getLength(),s=0===o?0:1-i/o;return a.getPointAt(s)}r++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,n=[],r=0,i=this.curves;r<i.length;r++)for(var a=i[r],o=a&&a.isEllipseCurve?2*e:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?e*a.points.length:e,s=a.getPoints(o),c=0;c<s.length;c++){var u=s[c];t&&t.equals(u)||(n.push(u),t=u)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n},copy:function(e){yl.prototype.copy.call(this,e),this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=yl.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,n=this.curves.length;t<n;t++){var r=this.curves[t];e.curves.push(r.toJSON())}return e},fromJSON:function(e){yl.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var r=e.curves[t];this.curves.push((new kl[r.type]).fromJSON(r))}return this}}),Bl.prototype=Object.assign(Object.create(Fl.prototype),{constructor:Bl,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this},moveTo:function(e,t){return this.currentPoint.set(e,t),this},lineTo:function(e,t){var n=new Ol(this.currentPoint.clone(),new Sn(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this},quadraticCurveTo:function(e,t,n,r){var i=new Il(this.currentPoint.clone(),new Sn(e,t),new Sn(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this},bezierCurveTo:function(e,t,n,r,i,a){var o=new Pl(this.currentPoint.clone(),new Sn(e,t),new Sn(n,r),new Sn(i,a));return this.curves.push(o),this.currentPoint.set(i,a),this},splineThru:function(e){var t=new zl([this.currentPoint.clone()].concat(e));return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this},arc:function(e,t,n,r,i,a){var o=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+o,t+s,n,r,i,a),this},absarc:function(e,t,n,r,i,a){return this.absellipse(e,t,n,n,r,i,a),this},ellipse:function(e,t,n,r,i,a,o,s){var c=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+c,t+u,n,r,i,a,o,s),this},absellipse:function(e,t,n,r,i,a,o,s){var c=new xl(e,t,n,r,i,a,o,s);if(this.curves.length>0){var u=c.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(c);var l=c.getPoint(1);return this.currentPoint.copy(l),this},copy:function(e){return Fl.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=Fl.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return Fl.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),Ul.prototype=Object.assign(Object.create(Bl.prototype),{constructor:Ul,getPointsHoles:function(e){for(var t=[],n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){Bl.prototype.copy.call(this,e),this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var r=e.holes[t];this.holes.push(r.clone())}return this},toJSON:function(){var e=Bl.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,n=this.holes.length;t<n;t++){var r=this.holes[t];e.holes.push(r.toJSON())}return e},fromJSON:function(e){Bl.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var r=e.holes[t];this.holes.push((new Bl).fromJSON(r))}return this}}),Hl.prototype=Object.assign(Object.create(ur.prototype),{constructor:Hl,isLight:!0,copy:function(e){return ur.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=ur.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),Gl.prototype=Object.assign(Object.create(Hl.prototype),{constructor:Gl,isHemisphereLight:!0,copy:function(e){return Hl.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(jl.prototype,{_projScreenMatrix:new Wn,_lightPositionWorld:new kn,_lookTarget:new kn,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(e){var t=this.camera,n=this.matrix,r=this._projScreenMatrix,i=this._lookTarget,a=this._lightPositionWorld;a.setFromMatrixPosition(e.matrixWorld),t.position.copy(a),i.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(i),t.updateMatrixWorld(),r.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(r),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)},getViewport:function(e){return this._viewports[e]},getFrameExtents:function(){return this._frameExtents},copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),Vl.prototype=Object.assign(Object.create(jl.prototype),{constructor:Vl,isSpotLightShadow:!0,updateMatrices:function(e){var t=this.camera,n=2*Tn.RAD2DEG*e.angle,r=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;n===t.fov&&r===t.aspect&&i===t.far||(t.fov=n,t.aspect=r,t.far=i,t.updateProjectionMatrix()),jl.prototype.updateMatrices.call(this,e)}}),Wl.prototype=Object.assign(Object.create(Hl.prototype),{constructor:Wl,isSpotLight:!0,copy:function(e){return Hl.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),ql.prototype=Object.assign(Object.create(jl.prototype),{constructor:ql,isPointLightShadow:!0,updateMatrices:function(e,t){void 0===t&&(t=0);var n=this.camera,r=this.matrix,i=this._lightPositionWorld,a=this._lookTarget,o=this._projScreenMatrix;i.setFromMatrixPosition(e.matrixWorld),n.position.copy(i),a.copy(n.position),a.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(a),n.updateMatrixWorld(),r.makeTranslation(-i.x,-i.y,-i.z),o.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(o)}}),Yl.prototype=Object.assign(Object.create(Hl.prototype),{constructor:Yl,isPointLight:!0,copy:function(e){return Hl.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),Xl.prototype=Object.assign(Object.create(oa.prototype),{constructor:Xl,isOrthographicCamera:!0,copy:function(e,t){return oa.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,n,r,i,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,i=n-e,a=n+e,o=r+t,s=r-t;if(null!==this.view&&this.view.enabled){var c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a=(i+=c*this.view.offsetX)+c*this.view.width,s=(o-=u*this.view.offsetY)-u*this.view.height}this.projectionMatrix.makeOrthographic(i,a,o,s,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=ur.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),Zl.prototype=Object.assign(Object.create(jl.prototype),{constructor:Zl,isDirectionalLightShadow:!0,updateMatrices:function(e){jl.prototype.updateMatrices.call(this,e)}}),Jl.prototype=Object.assign(Object.create(Hl.prototype),{constructor:Jl,isDirectionalLight:!0,copy:function(e){return Hl.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Ql.prototype=Object.assign(Object.create(Hl.prototype),{constructor:Ql,isAmbientLight:!0}),Kl.prototype=Object.assign(Object.create(Hl.prototype),{constructor:Kl,isRectAreaLight:!0,copy:function(e){return Hl.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=Hl.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}),$l.prototype=Object.assign(Object.create(ul.prototype),{constructor:$l,load:function(e,t,n,r){var i=this,a=new hl(i.manager);a.setPath(i.path),a.load(e,(function(e){t(i.parse(JSON.parse(e)))}),n,r)},parse:function(e){var t=this.textures;function n(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}var r=new Vu[e.type];if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.sheen&&(r.sheen=(new ei).setHex(e.sheen)),void 0!==e.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&r.specular.setHex(e.specular),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearcoat&&(r.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(r.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.vertexColors&&(r.vertexColors=e.vertexColors),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(r.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(r.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(r.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(r.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(r.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(r.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(r.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(r.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),1!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(r.skinning=e.skinning),void 0!==e.morphTargets&&(r.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(r.morphNormals=e.morphNormals),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.toneMapped&&(r.toneMapped=e.toneMapped),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.uniforms)for(var i in e.uniforms){var a=e.uniforms[i];switch(r.uniforms[i]={},a.type){case"t":r.uniforms[i].value=n(a.value);break;case"c":r.uniforms[i].value=(new ei).setHex(a.value);break;case"v2":r.uniforms[i].value=(new Sn).fromArray(a.value);break;case"v3":r.uniforms[i].value=(new kn).fromArray(a.value);break;case"v4":r.uniforms[i].value=(new Cn).fromArray(a.value);break;case"m3":r.uniforms[i].value=(new An).fromArray(a.value);case"m4":r.uniforms[i].value=(new Wn).fromArray(a.value);break;default:r.uniforms[i].value=a.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(var o in e.extensions)r.extensions[o]=e.extensions[o];if(void 0!==e.shading&&(r.flatShading=1===e.shading),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=n(e.map)),void 0!==e.matcap&&(r.matcap=n(e.matcap)),void 0!==e.alphaMap&&(r.alphaMap=n(e.alphaMap),r.transparent=!0),void 0!==e.bumpMap&&(r.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){var s=e.normalScale;!1===Array.isArray(s)&&(s=[s,s]),r.normalScale=(new Sn).fromArray(s)}return void 0!==e.displacementMap&&(r.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=n(e.specularMap)),void 0!==e.envMap&&(r.envMap=n(e.envMap)),void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(r.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(r.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatNormalMap&&(r.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(r.clearcoatNormalScale=(new Sn).fromArray(e.clearcoatNormalScale)),r},setTextures:function(e){return this.textures=e,this}});var eh={decodeText:function(e){if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(i){return t}},extractUrlBase:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};function th(){Li.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function nh(e,t,n,r){"number"===typeof n&&(r=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),ui.call(this,e,t,n),this.meshPerAttribute=r||1}function rh(e){ul.call(this,e)}th.prototype=Object.assign(Object.create(Li.prototype),{constructor:th,isInstancedBufferGeometry:!0,copy:function(e){return Li.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e=Li.prototype.toJSON.call(this);return e.maxInstancedCount=this.maxInstancedCount,e.isInstancedBufferGeometry=!0,e}}),nh.prototype=Object.assign(Object.create(ui.prototype),{constructor:nh,isInstancedBufferAttribute:!0,copy:function(e){return ui.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){var e=ui.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}),rh.prototype=Object.assign(Object.create(ul.prototype),{constructor:rh,load:function(e,t,n,r){var i=this,a=new hl(i.manager);a.setPath(i.path),a.load(e,(function(e){t(i.parse(JSON.parse(e)))}),n,r)},parse:function(e){var t=e.isInstancedBufferGeometry?new th:new Li,n=e.data.index;if(void 0!==n){var r=new ih[n.type](n.array);t.setIndex(new ui(r,1))}var i=e.data.attributes;for(var a in i){var o=i[a],s=(r=new ih[o.type](o.array),new(o.isInstancedBufferAttribute?nh:ui)(r,o.itemSize,o.normalized));void 0!==o.name&&(s.name=o.name),t.setAttribute(a,s)}var c=e.data.morphAttributes;if(c)for(var a in c){for(var u=c[a],l=[],h=0,f=u.length;h<f;h++){o=u[h],s=new ui(r=new ih[o.type](o.array),o.itemSize,o.normalized);void 0!==o.name&&(s.name=o.name),l.push(s)}t.morphAttributes[a]=l}e.data.morphTargetsRelative&&(t.morphTargetsRelative=!0);var p=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==p){h=0;for(var d=p.length;h!==d;++h){var m=p[h];t.addGroup(m.start,m.count,m.materialIndex)}}var v=e.data.boundingSphere;if(void 0!==v){var g=new kn;void 0!==v.center&&g.fromArray(v.center),t.boundingSphere=new Ar(g,v.radius)}return e.name&&(t.name=e.name),e.userData&&(t.userData=e.userData),t}});var ih={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!==typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function ah(e){ul.call(this,e)}ah.prototype=Object.assign(Object.create(ul.prototype),{constructor:ah,load:function(e,t,n,r){var i=this,a=""===this.path?eh.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;var o=new hl(i.manager);o.setPath(this.path),o.load(e,(function(n){var a=null;try{a=JSON.parse(n)}catch(s){return void 0!==r&&r(s),void console.error("THREE:ObjectLoader: Can't parse "+e+".",s.message)}var o=a.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()?i.parse(a,t):console.error("THREE.ObjectLoader: Can't load "+e)}),n,r)},parse:function(e,t){var n=this.parseShape(e.shapes),r=this.parseGeometries(e.geometries,n),i=this.parseImages(e.images,(function(){void 0!==t&&t(s)})),a=this.parseTextures(e.textures,i),o=this.parseMaterials(e.materials,a),s=this.parseObject(e.object,r,o);return e.animations&&(s.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(s),s},parseShape:function(e){var t={};if(void 0!==e)for(var n=0,r=e.length;n<r;n++){var i=(new Ul).fromJSON(e[n]);t[i.uuid]=i}return t},parseGeometries:function(e,t){var n={};if(void 0!==e)for(var r=new rh,i=0,a=e.length;i<a;i++){var o,s=e[i];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":o=new Du[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":o=new Du[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":o=new Du[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":o=new Du[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":o=new Du[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":o=new Du[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":o=new Du[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":o=new Du[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":o=new Du[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":o=new Du[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"TubeGeometry":case"TubeBufferGeometry":o=new Du[s.type]((new kl[s.path.type]).fromJSON(s.path),s.tubularSegments,s.radius,s.radialSegments,s.closed);break;case"LatheGeometry":case"LatheBufferGeometry":o=new Du[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":o=new Du[s.type](s.vertices,s.indices,s.radius,s.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var c=[],u=0,l=s.shapes.length;u<l;u++){var h=t[s.shapes[u]];c.push(h)}o=new Du[s.type](c,s.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(c=[],u=0,l=s.shapes.length;u<l;u++){h=t[s.shapes[u]];c.push(h)}var f=s.options.extrudePath;void 0!==f&&(s.options.extrudePath=(new kl[f.type]).fromJSON(f)),o=new Du[s.type](c,s.options);break;case"BufferGeometry":case"InstancedBufferGeometry":o=r.parse(s);break;case"Geometry":if("THREE"in window&&"LegacyJSONLoader"in THREE)o=(new THREE.LegacyJSONLoader).parse(s,this.resourcePath).geometry;else console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),!0===o.isBufferGeometry&&void 0!==s.userData&&(o.userData=s.userData),n[s.uuid]=o}return n},parseMaterials:function(e,t){var n={},r={};if(void 0!==e){var i=new $l;i.setTextures(t);for(var a=0,o=e.length;a<o;a++){var s=e[a];if("MultiMaterial"===s.type){for(var c=[],u=0;u<s.materials.length;u++){var l=s.materials[u];void 0===n[l.uuid]&&(n[l.uuid]=i.parse(l)),c.push(n[l.uuid])}r[s.uuid]=c}else void 0===n[s.uuid]&&(n[s.uuid]=i.parse(s)),r[s.uuid]=n[s.uuid]}}return r},parseAnimations:function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n],i=il.parse(r);void 0!==r.uuid&&(i.uuid=r.uuid),t.push(i)}return t},parseImages:function(e,t){var n=this,r={};function i(e){return n.manager.itemStart(e),a.load(e,(function(){n.manager.itemEnd(e)}),void 0,(function(){n.manager.itemError(e),n.manager.itemEnd(e)}))}if(void 0!==e&&e.length>0){var a=new ml(new sl(t));a.setCrossOrigin(this.crossOrigin);for(var o=0,s=e.length;o<s;o++){var c=e[o],u=c.url;if(Array.isArray(u)){r[c.uuid]=[];for(var l=0,h=u.length;l<h;l++){var f=u[l],p=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(f)?f:n.resourcePath+f;r[c.uuid].push(i(p))}}else{p=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c.url)?c.url:n.resourcePath+c.url;r[c.uuid]=i(p)}}}return r},parseTextures:function(e,t){function n(e,t){return"number"===typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var r={};if(void 0!==e)for(var i=0,a=e.length;i<a;i++){var o,s=e[i];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image),(o=Array.isArray(t[s.image])?new Oa(t[s.image]):new Pn(t[s.image])).needsUpdate=!0,o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),void 0!==s.mapping&&(o.mapping=n(s.mapping,sh)),void 0!==s.offset&&o.offset.fromArray(s.offset),void 0!==s.repeat&&o.repeat.fromArray(s.repeat),void 0!==s.center&&o.center.fromArray(s.center),void 0!==s.rotation&&(o.rotation=s.rotation),void 0!==s.wrap&&(o.wrapS=n(s.wrap[0],ch),o.wrapT=n(s.wrap[1],ch)),void 0!==s.format&&(o.format=s.format),void 0!==s.type&&(o.type=s.type),void 0!==s.encoding&&(o.encoding=s.encoding),void 0!==s.minFilter&&(o.minFilter=n(s.minFilter,uh)),void 0!==s.magFilter&&(o.magFilter=n(s.magFilter,uh)),void 0!==s.anisotropy&&(o.anisotropy=s.anisotropy),void 0!==s.flipY&&(o.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(o.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(o.unpackAlignment=s.unpackAlignment),r[s.uuid]=o}return r},parseObject:function(e,t,n){var r;function i(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function a(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],r=0,i=e.length;r<i;r++){var a=e[r];void 0===n[a]&&console.warn("THREE.ObjectLoader: Undefined material",a),t.push(n[a])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}switch(e.type){case"Scene":r=new lr,void 0!==e.background&&Number.isInteger(e.background)&&(r.background=new ei(e.background)),void 0!==e.fog&&("Fog"===e.fog.type?r.fog=new bs(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(r.fog=new xs(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":r=new sa(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(r.focus=e.focus),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.filmGauge&&(r.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(r.filmOffset=e.filmOffset),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"OrthographicCamera":r=new Xl(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"AmbientLight":r=new Ql(e.color,e.intensity);break;case"DirectionalLight":r=new Jl(e.color,e.intensity);break;case"PointLight":r=new Yl(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":r=new Kl(e.color,e.intensity,e.width,e.height);break;case"SpotLight":r=new Wl(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":r=new Gl(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var o=i(e.geometry),s=a(e.material);r=o.bones&&o.bones.length>0?new js(o,s):new qi(o,s);break;case"InstancedMesh":o=i(e.geometry),s=a(e.material);var c=e.count,u=e.instanceMatrix;(r=new Ks(o,s,c)).instanceMatrix=new ui(new Float32Array(u.array),16);break;case"LOD":r=new Gs;break;case"Line":r=new ac(i(e.geometry),a(e.material),e.mode);break;case"LineLoop":r=new uc(i(e.geometry),a(e.material));break;case"LineSegments":r=new cc(i(e.geometry),a(e.material));break;case"PointCloud":case"Points":r=new mc(i(e.geometry),a(e.material));break;case"Sprite":r=new Fs(a(e.material));break;case"Group":r=new vs;break;default:r=new ur}if(r.uuid=e.uuid,void 0!==e.name&&(r.name=e.name),void 0!==e.matrix?(r.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(r.matrixAutoUpdate=e.matrixAutoUpdate),r.matrixAutoUpdate&&r.matrix.decompose(r.position,r.quaternion,r.scale)):(void 0!==e.position&&r.position.fromArray(e.position),void 0!==e.rotation&&r.rotation.fromArray(e.rotation),void 0!==e.quaternion&&r.quaternion.fromArray(e.quaternion),void 0!==e.scale&&r.scale.fromArray(e.scale)),void 0!==e.castShadow&&(r.castShadow=e.castShadow),void 0!==e.receiveShadow&&(r.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(r.shadow.bias=e.shadow.bias),void 0!==e.shadow.radius&&(r.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&r.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(r.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.frustumCulled&&(r.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(r.renderOrder=e.renderOrder),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.layers&&(r.layers.mask=e.layers),void 0!==e.children)for(var l=e.children,h=0;h<l.length;h++)r.add(this.parseObject(l[h],t,n));if("LOD"===e.type){void 0!==e.autoUpdate&&(r.autoUpdate=e.autoUpdate);for(var f=e.levels,p=0;p<f.length;p++){var d=f[p],m=r.getObjectByProperty("uuid",d.object);void 0!==m&&r.addLevel(m,d.distance)}}return r}});var oh,sh={UVMapping:ue,CubeReflectionMapping:le,CubeRefractionMapping:he,EquirectangularReflectionMapping:fe,EquirectangularRefractionMapping:pe,SphericalReflectionMapping:de,CubeUVReflectionMapping:me,CubeUVRefractionMapping:ve},ch={RepeatWrapping:ge,ClampToEdgeWrapping:ye,MirroredRepeatWrapping:xe},uh={NearestFilter:be,NearestMipmapNearestFilter:we,NearestMipmapLinearFilter:Me,LinearFilter:Te,LinearMipmapNearestFilter:Se,LinearMipmapLinearFilter:Le};function lh(e){"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),ul.call(this,e),this.options=void 0}function hh(){this.type="ShapePath",this.color=new ei,this.subPaths=[],this.currentPath=null}function fh(e){this.type="Font",this.data=e}function ph(e,t,n,r,i){var a=i.glyphs[e]||i.glyphs["?"];if(a){var o,s,c,u,l,h,f,p,d=new hh;if(a.o)for(var m=a._cachedOutline||(a._cachedOutline=a.o.split(" ")),v=0,g=m.length;v<g;){switch(m[v++]){case"m":o=m[v++]*t+n,s=m[v++]*t+r,d.moveTo(o,s);break;case"l":o=m[v++]*t+n,s=m[v++]*t+r,d.lineTo(o,s);break;case"q":c=m[v++]*t+n,u=m[v++]*t+r,l=m[v++]*t+n,h=m[v++]*t+r,d.quadraticCurveTo(l,h,c,u);break;case"b":c=m[v++]*t+n,u=m[v++]*t+r,l=m[v++]*t+n,h=m[v++]*t+r,f=m[v++]*t+n,p=m[v++]*t+r,d.bezierCurveTo(l,h,f,p,c,u)}}return{offsetX:a.ha*t,path:d}}console.error('THREE.Font: character "'+e+'" does not exists in font family '+i.familyName+".")}function dh(e){ul.call(this,e)}lh.prototype=Object.assign(Object.create(ul.prototype),{constructor:lh,setOptions:function(e){return this.options=e,this},load:function(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,a=ol.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout((function(){t&&t(a),i.manager.itemEnd(e)}),0),a;fetch(e).then((function(e){return e.blob()})).then((function(e){return void 0===i.options?createImageBitmap(e):createImageBitmap(e,i.options)})).then((function(n){ol.add(e,n),t&&t(n),i.manager.itemEnd(e)})).catch((function(t){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)})),i.manager.itemStart(e)}}),Object.assign(hh.prototype,{moveTo:function(e,t){return this.currentPath=new Bl,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this},lineTo:function(e,t){return this.currentPath.lineTo(e,t),this},quadraticCurveTo:function(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this},bezierCurveTo:function(e,t,n,r,i,a){return this.currentPath.bezierCurveTo(e,t,n,r,i,a),this},splineThru:function(e){return this.currentPath.splineThru(e),this},toShapes:function(e,t){function n(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n],a=new Ul;a.curves=i.curves,t.push(a)}return t}function r(e,t){for(var n=t.length,r=!1,i=n-1,a=0;a<n;i=a++){var o=t[i],s=t[a],c=s.x-o.x,u=s.y-o.y;if(Math.abs(u)>Number.EPSILON){if(u<0&&(o=t[a],c=-c,s=t[i],u=-u),e.y<o.y||e.y>s.y)continue;if(e.y===o.y){if(e.x===o.x)return!0}else{var l=u*(e.x-o.x)-c*(e.y-o.y);if(0===l)return!0;if(l<0)continue;r=!r}}else{if(e.y!==o.y)continue;if(s.x<=e.x&&e.x<=o.x||o.x<=e.x&&e.x<=s.x)return!0}}return r}var i=cu.isClockWise,a=this.subPaths;if(0===a.length)return[];if(!0===t)return n(a);var o,s,c,u=[];if(1===a.length)return s=a[0],(c=new Ul).curves=s.curves,u.push(c),u;var l=!i(a[0].getPoints());l=e?!l:l;var h,f,p=[],d=[],m=[],v=0;d[v]=void 0,m[v]=[];for(var g=0,y=a.length;g<y;g++)o=i(h=(s=a[g]).getPoints()),(o=e?!o:o)?(!l&&d[v]&&v++,d[v]={s:new Ul,p:h},d[v].s.curves=s.curves,l&&v++,m[v]=[]):m[v].push({h:s,p:h[0]});if(!d[0])return n(a);if(d.length>1){for(var x=!1,b=[],w=0,_=d.length;w<_;w++)p[w]=[];for(w=0,_=d.length;w<_;w++)for(var M=m[w],E=0;E<M.length;E++){for(var T=M[E],S=!0,A=0;A<d.length;A++)r(T.p,d[A].p)&&(w!==A&&b.push({froms:w,tos:A,hole:E}),S?(S=!1,p[A].push(T)):x=!0);S&&p[w].push(T)}b.length>0&&(x||(m=p))}g=0;for(var L=d.length;g<L;g++){c=d[g].s,u.push(c);for(var R=0,P=(f=m[g]).length;R<P;R++)c.holes.push(f[R].h)}return u}}),Object.assign(fh.prototype,{isFont:!0,generateShapes:function(e,t){void 0===t&&(t=100);for(var n=[],r=function(e,t,n){for(var r=Array.from?Array.from(e):String(e).split(""),i=t/n.resolution,a=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*i,o=[],s=0,c=0,u=0;u<r.length;u++){var l=r[u];if("\n"===l)s=0,c-=a;else{var h=ph(l,i,s,c,n);s+=h.offsetX,o.push(h.path)}}return o}(e,t,this.data),i=0,a=r.length;i<a;i++)Array.prototype.push.apply(n,r[i].toShapes());return n}}),dh.prototype=Object.assign(Object.create(ul.prototype),{constructor:dh,load:function(e,t,n,r){var i=this,a=new hl(this.manager);a.setPath(this.path),a.load(e,(function(e){var n;try{n=JSON.parse(e)}catch(a){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(e.substring(65,e.length-2))}var r=i.parse(n);t&&t(r)}),n,r)},parse:function(e){return new fh(e)}});var mh={getContext:function(){return void 0===oh&&(oh=new(window.AudioContext||window.webkitAudioContext)),oh},setContext:function(e){oh=e}};function vh(e){ul.call(this,e)}function gh(){this.coefficients=[];for(var e=0;e<9;e++)this.coefficients.push(new kn)}function yh(e,t){Hl.call(this,void 0,t),this.sh=void 0!==e?e:new gh}function xh(e,t,n){yh.call(this,void 0,n);var r=(new ei).set(e),i=(new ei).set(t),a=new kn(r.r,r.g,r.b),o=new kn(i.r,i.g,i.b),s=Math.sqrt(Math.PI),c=s*Math.sqrt(.75);this.sh.coefficients[0].copy(a).add(o).multiplyScalar(s),this.sh.coefficients[1].copy(a).sub(o).multiplyScalar(c)}function bh(e,t){yh.call(this,void 0,t);var n=(new ei).set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}vh.prototype=Object.assign(Object.create(ul.prototype),{constructor:vh,load:function(e,t,n,r){var i=new hl(this.manager);i.setResponseType("arraybuffer"),i.setPath(this.path),i.load(e,(function(e){var n=e.slice(0);mh.getContext().decodeAudioData(n,(function(e){t(e)}))}),n,r)}}),Object.assign(gh.prototype,{isSphericalHarmonics3:!0,set:function(e){for(var t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this},zero:function(){for(var e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this},getAt:function(e,t){var n=e.x,r=e.y,i=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScale(a[1],.488603*r),t.addScale(a[2],.488603*i),t.addScale(a[3],.488603*n),t.addScale(a[4],n*r*1.092548),t.addScale(a[5],r*i*1.092548),t.addScale(a[6],.315392*(3*i*i-1)),t.addScale(a[7],n*i*1.092548),t.addScale(a[8],.546274*(n*n-r*r)),t},getIrradianceAt:function(e,t){var n=e.x,r=e.y,i=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScale(a[1],1.023328*r),t.addScale(a[2],1.023328*i),t.addScale(a[3],1.023328*n),t.addScale(a[4],.858086*n*r),t.addScale(a[5],.858086*r*i),t.addScale(a[6],.743125*i*i-.247708),t.addScale(a[7],.858086*n*i),t.addScale(a[8],.429043*(n*n-r*r)),t},add:function(e){for(var t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this},scale:function(e){for(var t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this},lerp:function(e,t){for(var n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this},equals:function(e){for(var t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0},copy:function(e){return this.set(e.coefficients)},clone:function(){return(new this.constructor).copy(this)},fromArray:function(e,t){void 0===t&&(t=0);for(var n=this.coefficients,r=0;r<9;r++)n[r].fromArray(e,t+3*r);return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);for(var n=this.coefficients,r=0;r<9;r++)n[r].toArray(e,t+3*r);return e}}),Object.assign(gh,{getBasisAt:function(e,t){var n=e.x,r=e.y,i=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*i,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*n*i,t[8]=.546274*(n*n-r*r)}}),yh.prototype=Object.assign(Object.create(Hl.prototype),{constructor:yh,isLightProbe:!0,copy:function(e){return Hl.prototype.copy.call(this,e),this.sh.copy(e.sh),this.intensity=e.intensity,this},toJSON:function(e){return Hl.prototype.toJSON.call(this,e)}}),xh.prototype=Object.assign(Object.create(yh.prototype),{constructor:xh,isHemisphereLightProbe:!0,copy:function(e){return yh.prototype.copy.call(this,e),this},toJSON:function(e){return yh.prototype.toJSON.call(this,e)}}),bh.prototype=Object.assign(Object.create(yh.prototype),{constructor:bh,isAmbientLightProbe:!0,copy:function(e){return yh.prototype.copy.call(this,e),this},toJSON:function(e){return yh.prototype.toJSON.call(this,e)}});var wh=new Wn,_h=new Wn;function Mh(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new sa,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new sa,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}function Eh(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}Object.assign(Mh.prototype,{update:function(e){var t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;var n,r,i=e.projectionMatrix.clone(),a=t.eyeSep/2,o=a*t.near/t.focus,s=t.near*Math.tan(Tn.DEG2RAD*t.fov*.5)/t.zoom;_h.elements[12]=-a,wh.elements[12]=a,n=-s*t.aspect+o,r=s*t.aspect+o,i.elements[0]=2*t.near/(r-n),i.elements[8]=(r+n)/(r-n),this.cameraL.projectionMatrix.copy(i),n=-s*t.aspect-o,r=s*t.aspect-o,i.elements[0]=2*t.near/(r-n),i.elements[8]=(r+n)/(r-n),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(_h),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(wh)}}),Object.assign(Eh.prototype,{start:function(){this.startTime=("undefined"===typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"===typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}});var Th=new kn,Sh=new In,Ah=new kn,Lh=new kn;function Rh(){ur.call(this),this.type="AudioListener",this.context=mh.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Eh}function Ph(e){ur.call(this),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this._startedAt=0,this._pausedAt=0,this.filters=[]}Rh.prototype=Object.assign(Object.create(ur.prototype),{constructor:Rh,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(e){ur.prototype.updateMatrixWorld.call(this,e);var t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Th,Sh,Ah),Lh.set(0,0,-1).applyQuaternion(Sh),t.positionX){var r=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Th.x,r),t.positionY.linearRampToValueAtTime(Th.y,r),t.positionZ.linearRampToValueAtTime(Th.z,r),t.forwardX.linearRampToValueAtTime(Lh.x,r),t.forwardY.linearRampToValueAtTime(Lh.y,r),t.forwardZ.linearRampToValueAtTime(Lh.z,r),t.upX.linearRampToValueAtTime(n.x,r),t.upY.linearRampToValueAtTime(n.y,r),t.upZ.linearRampToValueAtTime(n.z,r)}else t.setPosition(Th.x,Th.y,Th.z),t.setOrientation(Lh.x,Lh.y,Lh.z,n.x,n.y,n.z)}}),Ph.prototype=Object.assign(Object.create(ur.prototype),{constructor:Ph,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setMediaStreamSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(e){if(void 0===e&&(e=0),!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+e;var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._pausedAt+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._pausedAt=(this.context.currentTime-this._startedAt)*this.playbackRate,this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this._pausedAt=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},setDetune:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},setLoopStart:function(e){return this.loopStart=e,this},setLoopEnd:function(e){return this.loopEnd=e,this},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}});var Ch=new kn,Oh=new In,Dh=new kn,Ih=new kn;function Nh(e){Ph.call(this,e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function zh(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function kh(e,t,n){this.binding=e,this.valueSize=n;var r,i=Float64Array;switch(t){case"quaternion":r=this._slerp;break;case"string":case"bool":i=Array,r=this._select;break;default:r=this._lerp}this.buffer=new i(4*n),this._mixBufferRegion=r,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}Nh.prototype=Object.assign(Object.create(Ph.prototype),{constructor:Nh,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this},updateMatrixWorld:function(e){if(ur.prototype.updateMatrixWorld.call(this,e),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(Ch,Oh,Dh),Ih.set(0,0,1).applyQuaternion(Oh);var t=this.panner;if(t.positionX){var n=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Ch.x,n),t.positionY.linearRampToValueAtTime(Ch.y,n),t.positionZ.linearRampToValueAtTime(Ch.z,n),t.orientationX.linearRampToValueAtTime(Ih.x,n),t.orientationY.linearRampToValueAtTime(Ih.y,n),t.orientationZ.linearRampToValueAtTime(Ih.z,n)}else t.setPosition(Ch.x,Ch.y,Ch.z),t.setOrientation(Ih.x,Ih.y,Ih.z)}}}),Object.assign(zh.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),n=0;n<t.length;n++)e+=t[n];return e/t.length}}),Object.assign(kh.prototype,{accumulate:function(e,t){var n=this.buffer,r=this.valueSize,i=e*r+r,a=this.cumulativeWeight;if(0===a){for(var o=0;o!==r;++o)n[i+o]=n[o];a=t}else{var s=t/(a+=t);this._mixBufferRegion(n,i,0,s,r)}this.cumulativeWeight=a},apply:function(e){var t=this.valueSize,n=this.buffer,r=e*t+t,i=this.cumulativeWeight,a=this.binding;if(this.cumulativeWeight=0,i<1){var o=3*t;this._mixBufferRegion(n,r,o,1-i,t)}for(var s=t,c=t+t;s!==c;++s)if(n[s]!==n[s+t]){a.setValue(n,r);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,n=this.valueSize,r=3*n;e.getValue(t,r);for(var i=n,a=r;i!==a;++i)t[i]=t[r+i%n];this.cumulativeWeight=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function(e,t,n,r,i){if(r>=.5)for(var a=0;a!==i;++a)e[t+a]=e[n+a]},_slerp:function(e,t,n,r){In.slerpFlat(e,t,e,t,e,n,r)},_lerp:function(e,t,n,r,i){for(var a=1-r,o=0;o!==i;++o){var s=t+o;e[s]=e[s]*a+e[n+o]*r}}});var Fh=new RegExp("[\\[\\]\\.:\\/]","g"),Bh="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",Uh=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),Hh=/(WCOD+)?/.source.replace("WCOD",Bh),Gh=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),jh=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),Vh=new RegExp("^"+Uh+Hh+Gh+jh+"$"),Wh=["material","materials","bones"];function qh(e,t,n){var r=n||Yh.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}function Yh(e,t,n){this.path=t,this.parsedPath=n||Yh.parseTrackName(t),this.node=Yh.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function Xh(){this.uuid=Tn.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,n=arguments.length;t!==n;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}function Zh(e,t,n){this._mixer=e,this._clip=t,this._localRoot=n||null;for(var r=t.tracks,i=r.length,a=new Array(i),o={endingStart:Ct,endingEnd:Ct},s=0;s!==i;++s){var c=r[s].createInterpolant(null);a[s]=c,c.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(i),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=St,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function Jh(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function Qh(e){"string"===typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}function Kh(e,t,n){ws.call(this,e,t),this.meshPerAttribute=n||1}function $h(e,t,n,r){this.ray=new Nr(e,t),this.near=n||0,this.far=r||1/0,this.camera=null,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function ef(e,t){return e.distance-t.distance}function tf(e,t,n,r){if(!1!==e.visible&&(e.raycast(t,n),!0===r))for(var i=e.children,a=0,o=i.length;a<o;a++)tf(i[a],t,n,!0)}function nf(e,t,n){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==n?n:0,this}function rf(e,t,n){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==n?n:0,this}Object.assign(qh.prototype,{getValue:function(e,t){this.bind();var n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)},setValue:function(e,t){for(var n=this._bindings,r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}),Object.assign(Yh,{Composite:qh,create:function(e,t,n){return e&&e.isAnimationObjectGroup?new Yh.Composite(e,t,n):new Yh(e,t,n)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(Fh,"")},parseTrackName:function(e){var t=Vh.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){var i=n.nodeName.substring(r+1);-1!==Wh.indexOf(i)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=i)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n},findNode:function(e,t){if(!t||""===t||"root"===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){var r=function(e){for(var n=0;n<e.length;n++){var i=e[n];if(i.name===t||i.uuid===t)return i;var a=r(i.children);if(a)return a}return null},i=r(e.children);if(i)return i}return null}}),Object.assign(Yh.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)e[t++]=n[r]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++]},function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,n=t.objectName,r=t.propertyName,i=t.propertyIndex;if(e||(e=Yh.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(n){var a=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var o=0;o<e.length;o++)if(e[o].name===a){a=o;break}break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==a){if(void 0===e[a])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[a]}}var s=e[r];if(void 0!==s){var c=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?c=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(c=this.Versioning.MatrixWorldNeedsUpdate);var u=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(o=0;o<this.node.geometry.morphAttributes.position.length;o++)if(e.geometry.morphAttributes.position[o].name===i){i=o;break}}else{if(!e.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(o=0;o<this.node.geometry.morphTargets.length;o++)if(e.geometry.morphTargets[o].name===i){i=o;break}}}u=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(u=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(u=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[u],this.setValue=this.SetterByBindingTypeAndVersioning[u][c]}else{var l=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+l+"."+r+" but it wasn't found.",e)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(Yh.prototype,{_getValue_unbound:Yh.prototype.getValue,_setValue_unbound:Yh.prototype.setValue}),Object.assign(Xh.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=e.length,n=this.nCachedObjects_,r=this._indicesByUUID,i=this._paths,a=this._parsedPaths,o=this._bindings,s=o.length,c=void 0,u=0,l=arguments.length;u!==l;++u){var h=arguments[u],f=h.uuid,p=r[f];if(void 0===p){p=t++,r[f]=p,e.push(h);for(var d=0,m=s;d!==m;++d)o[d].push(new Yh(h,i[d],a[d]))}else if(p<n){c=e[p];var v=--n,g=e[v];r[g.uuid]=p,e[p]=g,r[f]=v,e[v]=h;for(d=0,m=s;d!==m;++d){var y=o[d],x=y[v],b=y[p];y[p]=x,void 0===b&&(b=new Yh(h,i[d],a[d])),y[v]=b}}else e[p]!==c&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=n},remove:function(){for(var e=this._objects,t=this.nCachedObjects_,n=this._indicesByUUID,r=this._bindings,i=r.length,a=0,o=arguments.length;a!==o;++a){var s=arguments[a],c=s.uuid,u=n[c];if(void 0!==u&&u>=t){var l=t++,h=e[l];n[h.uuid]=u,e[u]=h,n[c]=l,e[l]=s;for(var f=0,p=i;f!==p;++f){var d=r[f],m=d[l],v=d[u];d[u]=m,d[l]=v}}}this.nCachedObjects_=t},uncache:function(){for(var e=this._objects,t=e.length,n=this.nCachedObjects_,r=this._indicesByUUID,i=this._bindings,a=i.length,o=0,s=arguments.length;o!==s;++o){var c=arguments[o],u=c.uuid,l=r[u];if(void 0!==l)if(delete r[u],l<n){var h=--n,f=e[h],p=e[y=--t];r[f.uuid]=l,e[l]=f,r[p.uuid]=h,e[h]=p,e.pop();for(var d=0,m=a;d!==m;++d){var v=(x=i[d])[h],g=x[y];x[l]=v,x[h]=g,x.pop()}}else{var y;r[(p=e[y=--t]).uuid]=l,e[l]=p,e.pop();for(d=0,m=a;d!==m;++d){var x;(x=i[d])[l]=x[y],x.pop()}}}this.nCachedObjects_=n},subscribe_:function(e,t){var n=this._bindingsIndicesByPath,r=n[e],i=this._bindings;if(void 0!==r)return i[r];var a=this._paths,o=this._parsedPaths,s=this._objects,c=s.length,u=this.nCachedObjects_,l=new Array(c);r=i.length,n[e]=r,a.push(e),o.push(t),i.push(l);for(var h=u,f=s.length;h!==f;++h){var p=s[h];l[h]=new Yh(p,e,t)}return l},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){var r=this._paths,i=this._parsedPaths,a=this._bindings,o=a.length-1,s=a[o];t[e[o]]=n,a[n]=s,a.pop(),i[n]=i[o],i.pop(),r[n]=r[o],r.pop()}}}),Object.assign(Zh.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){var r=this._clip.duration,i=e._clip.duration,a=i/r,o=r/i;e.warp(1,a,t),this.warp(o,1,t)}return this},crossFadeTo:function(e,t,n){return e.crossFadeFrom(this,t,n)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,n){var r=this._mixer,i=r.time,a=this._timeScaleInterpolant,o=this.timeScale;null===a&&(a=r._lendControlInterpolant(),this._timeScaleInterpolant=a);var s=a.parameterPositions,c=a.sampleValues;return s[0]=i,s[1]=i+n,c[0]=e/o,c[1]=t/o,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,n,r){if(this.enabled){var i=this._startTime;if(null!==i){var a=(e-i)*n;if(a<0||0===n)return;this._startTime=null,t=n*a}t*=this._updateTimeScale(e);var o=this._updateTime(t),s=this._updateWeight(e);if(s>0)for(var c=this._interpolants,u=this._propertyBindings,l=0,h=c.length;l!==h;++l)c[l].evaluate(o),u[l].accumulate(r,s)}else this._updateWeight(e)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var n=this._weightInterpolant;if(null!==n){var r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var n=this._timeScaleInterpolant;if(null!==n)t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}return this._effectiveTimeScale=t,t},_updateTime:function(e){var t=this.time+e,n=this._clip.duration,r=this.loop,i=this._loopCount,a=r===At;if(0===e)return-1===i?t:a&&1===(1&i)?n-t:t;if(r===Tt){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(t>=n)t=n;else{if(!(t<0)){this.time=t;break e}t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===i&&(e>=0?(i=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),t>=n||t<0){var o=Math.floor(t/n);t-=n*o,i+=Math.abs(o);var s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=e>0?n:0,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){var c=e<0;this._setEndings(c,!c,a)}else this._setEndings(!1,!1,a);this._loopCount=i,this.time=t,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=t;if(a&&1===(1&i))return n-t}return t},_setEndings:function(e,t,n){var r=this._interpolantSettings;n?(r.endingStart=Ot,r.endingEnd=Ot):(r.endingStart=e?this.zeroSlopeAtStart?Ot:Ct:Dt,r.endingEnd=t?this.zeroSlopeAtEnd?Ot:Ct:Dt)},_scheduleFading:function(e,t,n){var r=this._mixer,i=r.time,a=this._weightInterpolant;null===a&&(a=r._lendControlInterpolant(),this._weightInterpolant=a);var o=a.parameterPositions,s=a.sampleValues;return o[0]=i,s[0]=t,o[1]=i+e,s[1]=n,this}}),Jh.prototype=Object.assign(Object.create(wn.prototype),{constructor:Jh,_bindAction:function(e,t){var n=e._localRoot||this._root,r=e._clip.tracks,i=r.length,a=e._propertyBindings,o=e._interpolants,s=n.uuid,c=this._bindingsByRootAndName,u=c[s];void 0===u&&(u={},c[s]=u);for(var l=0;l!==i;++l){var h=r[l],f=h.name,p=u[f];if(void 0!==p)a[l]=p;else{if(void 0!==(p=a[l])){null===p._cacheIndex&&(++p.referenceCount,this._addInactiveBinding(p,s,f));continue}var d=t&&t._propertyBindings[l].binding.parsedPath;++(p=new kh(Yh.create(n,f,d),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(p,s,f),a[l]=p}o[l].resultBuffer=p.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,t)}for(var i=e._propertyBindings,a=0,o=i.length;a!==o;++a){var s=i[a];0===s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,n=0,r=t.length;n!==r;++n){var i=t[n];0===--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,n){var r=this._actions,i=this._actionsByClip,a=i[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=a;else{var o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=r.length,r.push(e),a.actionByRoot[n]=e},_removeInactiveAction:function(e){var t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;var i=e._clip.uuid,a=this._actionsByClip,o=a[i],s=o.knownActions,c=s[s.length-1],u=e._byClipCacheIndex;c._byClipCacheIndex=u,s[u]=c,s.pop(),e._byClipCacheIndex=null,delete o.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete a[i],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,n=0,r=t.length;n!==r;++n){var i=t[n];0===--i.referenceCount&&this._removeInactiveBinding(i)}},_lendAction:function(e){var t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_takeBackAction:function(e){var t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_addInactiveBinding:function(e,t,n){var r=this._bindingsByRootAndName,i=r[t],a=this._bindings;void 0===i&&(i={},r[t]=i),i[n]=e,e._cacheIndex=a.length,a.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,n=e.binding,r=n.rootNode.uuid,i=n.path,a=this._bindingsByRootAndName,o=a[r],s=t[t.length-1],c=e._cacheIndex;s._cacheIndex=c,t[c]=s,t.pop(),delete o[i],0===Object.keys(o).length&&delete a[r]},_lendBinding:function(e){var t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_takeBackBinding:function(e){var t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,n=e[t];return void 0===n&&((n=new Xu(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=n),n},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,i=t[r];e.__cacheIndex=r,t[r]=e,i.__cacheIndex=n,t[n]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var n=t||this._root,r=n.uuid,i="string"===typeof e?il.findByName(n,e):e,a=null!==i?i.uuid:e,o=this._actionsByClip[a],s=null;if(void 0!==o){var c=o.actionByRoot[r];if(void 0!==c)return c;s=o.knownActions[0],null===i&&(i=s._clip)}if(null===i)return null;var u=new Zh(this,i,t);return this._bindAction(u,s),this._addInactiveAction(u,a,r),u},existingAction:function(e,t){var n=t||this._root,r=n.uuid,i="string"===typeof e?il.findByName(n,e):e,a=i?i.uuid:e,o=this._actionsByClip[a];return void 0!==o&&o.actionByRoot[r]||null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,n=this._bindings,r=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var i=0;i!==t;++i)e[i].reset();for(i=0;i!==r;++i)n[i].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,n=this._nActiveActions,r=this.time+=e,i=Math.sign(e),a=this._accuIndex^=1,o=0;o!==n;++o){t[o]._update(r,e,i,a)}var s=this._bindings,c=this._nActiveBindings;for(o=0;o!==c;++o)s[o].apply(a);return this},setTime:function(e){this.time=0;for(var t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,n=e.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){for(var a=i.knownActions,o=0,s=a.length;o!==s;++o){var c=a[o];this._deactivateAction(c);var u=c._cacheIndex,l=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,l._cacheIndex=u,t[u]=l,t.pop(),this._removeInactiveBindingsForAction(c)}delete r[n]}},uncacheRoot:function(e){var t=e.uuid,n=this._actionsByClip;for(var r in n){var i=n[r].actionByRoot[t];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var a=this._bindingsByRootAndName[t];if(void 0!==a)for(var o in a){var s=a[o];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(e,t){var n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}),Qh.prototype.clone=function(){return new Qh(void 0===this.value.clone?this.value:this.value.clone())},Kh.prototype=Object.assign(Object.create(ws.prototype),{constructor:Kh,isInstancedInterleavedBuffer:!0,copy:function(e){return ws.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign($h.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,n){var r=n||[];return tf(e,this,r,t),r.sort(ef),r},intersectObjects:function(e,t,n){var r=n||[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),r;for(var i=0,a=e.length;i<a;i++)tf(e[i],this,r,t);return r.sort(ef),r}}),Object.assign(nf.prototype,{set:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Tn.clamp(t/this.radius,-1,1))),this}}),Object.assign(rf.prototype,{set:function(e,t,n){return this.radius=e,this.theta=t,this.y=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}});var af=new Sn;function of(e,t){this.min=void 0!==e?e:new Sn(1/0,1/0),this.max=void 0!==t?t:new Sn(-1/0,-1/0)}Object.assign(of.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){var n=af.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new Sn),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new Sn),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new Sn),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new Sn),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return af.copy(e).clamp(this.min,this.max).sub(e).length()},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var sf=new kn,cf=new kn;function uf(e,t){this.start=void 0!==e?e:new kn,this.end=void 0!==t?t:new kn}function lf(e){ur.call(this),this.material=e,this.render=function(){}}Object.assign(uf.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new kn),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new kn),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new kn),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(e,t){sf.subVectors(e,this.start),cf.subVectors(this.end,this.start);var n=cf.dot(cf),r=cf.dot(sf)/n;return t&&(r=Tn.clamp(r,0,1)),r},closestPointToPoint:function(e,t,n){var r=this.closestPointToPointParameter(e,t);return void 0===n&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new kn),this.delta(n).multiplyScalar(r).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),lf.prototype=Object.create(ur.prototype),lf.prototype.constructor=lf,lf.prototype.isImmediateRenderObject=!0;var hf=new kn;function ff(e,t){ur.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var n=new Li,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],i=0,a=1;i<32;i++,a++){var o=i/32*Math.PI*2,s=a/32*Math.PI*2;r.push(Math.cos(o),Math.sin(o),1,Math.cos(s),Math.sin(s),1)}n.setAttribute("position",new gi(r,3));var c=new $s({fog:!1});this.cone=new cc(n,c),this.add(this.cone),this.update()}ff.prototype=Object.create(ur.prototype),ff.prototype.constructor=ff,ff.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},ff.prototype.update=function(){this.light.updateMatrixWorld();var e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),hf.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(hf),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};var pf=new kn,df=new Wn,mf=new Wn;function vf(e){for(var t=function e(t){var n=[];t&&t.isBone&&n.push(t);for(var r=0;r<t.children.length;r++)n.push.apply(n,e(t.children[r]));return n}(e),n=new Li,r=[],i=[],a=new ei(0,0,1),o=new ei(0,1,0),s=0;s<t.length;s++){var c=t[s];c.parent&&c.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(a.r,a.g,a.b),i.push(o.r,o.g,o.b))}n.setAttribute("position",new gi(r,3)),n.setAttribute("color",new gi(i,3));var u=new $s({vertexColors:M,depthTest:!1,depthWrite:!1,transparent:!0});cc.call(this,n,u),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}function gf(e,t,n){this.light=e,this.light.updateMatrixWorld(),this.color=n;var r=new yu(t,4,2),i=new si({wireframe:!0,fog:!1});qi.call(this,r,i),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}vf.prototype=Object.create(cc.prototype),vf.prototype.constructor=vf,vf.prototype.updateMatrixWorld=function(e){var t=this.bones,n=this.geometry,r=n.getAttribute("position");mf.getInverse(this.root.matrixWorld);for(var i=0,a=0;i<t.length;i++){var o=t[i];o.parent&&o.parent.isBone&&(df.multiplyMatrices(mf,o.matrixWorld),pf.setFromMatrixPosition(df),r.setXYZ(a,pf.x,pf.y,pf.z),df.multiplyMatrices(mf,o.parent.matrixWorld),pf.setFromMatrixPosition(df),r.setXYZ(a+1,pf.x,pf.y,pf.z),a+=2)}n.getAttribute("position").needsUpdate=!0,ur.prototype.updateMatrixWorld.call(this,e)},gf.prototype=Object.create(qi.prototype),gf.prototype.constructor=gf,gf.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},gf.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)};var yf=new kn,xf=new ei,bf=new ei;function wf(e,t,n){ur.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;var r=new Rc(t);r.rotateY(.5*Math.PI),this.material=new si({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=M);var i=r.getAttribute("position"),a=new Float32Array(3*i.count);r.setAttribute("color",new ui(a,3)),this.add(new qi(r,this.material)),this.update()}function _f(e,t,n,r){e=e||10,t=t||10,n=new ei(void 0!==n?n:4473924),r=new ei(void 0!==r?r:8947848);for(var i=t/2,a=e/t,o=e/2,s=[],c=[],u=0,l=0,h=-o;u<=t;u++,h+=a){s.push(-o,0,h,o,0,h),s.push(h,0,-o,h,0,o);var f=u===i?n:r;f.toArray(c,l),l+=3,f.toArray(c,l),l+=3,f.toArray(c,l),l+=3,f.toArray(c,l),l+=3}var p=new Li;p.setAttribute("position",new gi(s,3)),p.setAttribute("color",new gi(c,3));var d=new $s({vertexColors:M});cc.call(this,p,d)}function Mf(e,t,n,r,i,a){e=e||10,t=t||16,n=n||8,r=r||64,i=new ei(void 0!==i?i:4473924),a=new ei(void 0!==a?a:8947848);var o,s,c,u,l,h,f,p=[],d=[];for(u=0;u<=t;u++)c=u/t*(2*Math.PI),o=Math.sin(c)*e,s=Math.cos(c)*e,p.push(0,0,0),p.push(o,0,s),f=1&u?i:a,d.push(f.r,f.g,f.b),d.push(f.r,f.g,f.b);for(u=0;u<=n;u++)for(f=1&u?i:a,h=e-e/n*u,l=0;l<r;l++)c=l/r*(2*Math.PI),o=Math.sin(c)*h,s=Math.cos(c)*h,p.push(o,0,s),d.push(f.r,f.g,f.b),c=(l+1)/r*(2*Math.PI),o=Math.sin(c)*h,s=Math.cos(c)*h,p.push(o,0,s),d.push(f.r,f.g,f.b);var m=new Li;m.setAttribute("position",new gi(p,3)),m.setAttribute("color",new gi(d,3));var v=new $s({vertexColors:M});cc.call(this,m,v)}wf.prototype=Object.create(ur.prototype),wf.prototype.constructor=wf,wf.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},wf.prototype.update=function(){var e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var t=e.geometry.getAttribute("color");xf.copy(this.light.color),bf.copy(this.light.groundColor);for(var n=0,r=t.count;n<r;n++){var i=n<r/2?xf:bf;t.setXYZ(n,i.r,i.g,i.b)}t.needsUpdate=!0}e.lookAt(yf.setFromMatrixPosition(this.light.matrixWorld).negate())},_f.prototype=Object.assign(Object.create(cc.prototype),{constructor:_f,copy:function(e){return cc.prototype.copy.call(this,e),this.geometry.copy(e.geometry),this.material.copy(e.material),this},clone:function(){return(new this.constructor).copy(this)}}),Mf.prototype=Object.create(cc.prototype),Mf.prototype.constructor=Mf;var Ef=new kn,Tf=new kn,Sf=new kn;function Af(e,t,n){ur.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===t&&(t=1);var r=new Li;r.setAttribute("position",new gi([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var i=new $s({fog:!1});this.lightPlane=new ac(r,i),this.add(this.lightPlane),(r=new Li).setAttribute("position",new gi([0,0,0,0,0,1],3)),this.targetLine=new ac(r,i),this.add(this.targetLine),this.update()}Af.prototype=Object.create(ur.prototype),Af.prototype.constructor=Af,Af.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},Af.prototype.update=function(){Ef.setFromMatrixPosition(this.light.matrixWorld),Tf.setFromMatrixPosition(this.light.target.matrixWorld),Sf.subVectors(Tf,Ef),this.lightPlane.lookAt(Tf),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Tf),this.targetLine.scale.z=Sf.length()};var Lf=new kn,Rf=new oa;function Pf(e){var t=new Li,n=new $s({color:16777215,vertexColors:_}),r=[],i=[],a={},o=new ei(16755200),s=new ei(16711680),c=new ei(43775),u=new ei(16777215),l=new ei(3355443);function h(e,t,n){f(e,n),f(t,n)}function f(e,t){r.push(0,0,0),i.push(t.r,t.g,t.b),void 0===a[e]&&(a[e]=[]),a[e].push(r.length/3-1)}h("n1","n2",o),h("n2","n4",o),h("n4","n3",o),h("n3","n1",o),h("f1","f2",o),h("f2","f4",o),h("f4","f3",o),h("f3","f1",o),h("n1","f1",o),h("n2","f2",o),h("n3","f3",o),h("n4","f4",o),h("p","n1",s),h("p","n2",s),h("p","n3",s),h("p","n4",s),h("u1","u2",c),h("u2","u3",c),h("u3","u1",c),h("c","t",u),h("p","c",l),h("cn1","cn2",l),h("cn3","cn4",l),h("cf1","cf2",l),h("cf3","cf4",l),t.setAttribute("position",new gi(r,3)),t.setAttribute("color",new gi(i,3)),cc.call(this,t,n),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update()}function Cf(e,t,n,r,i,a,o){Lf.set(i,a,o).unproject(r);var s=t[e];if(void 0!==s)for(var c=n.getAttribute("position"),u=0,l=s.length;u<l;u++)c.setXYZ(s[u],Lf.x,Lf.y,Lf.z)}Pf.prototype=Object.create(cc.prototype),Pf.prototype.constructor=Pf,Pf.prototype.update=function(){var e=this.geometry,t=this.pointMap;Rf.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Cf("c",t,e,Rf,0,0,-1),Cf("t",t,e,Rf,0,0,1),Cf("n1",t,e,Rf,-1,-1,-1),Cf("n2",t,e,Rf,1,-1,-1),Cf("n3",t,e,Rf,-1,1,-1),Cf("n4",t,e,Rf,1,1,-1),Cf("f1",t,e,Rf,-1,-1,1),Cf("f2",t,e,Rf,1,-1,1),Cf("f3",t,e,Rf,-1,1,1),Cf("f4",t,e,Rf,1,1,1),Cf("u1",t,e,Rf,.7,1.1,-1),Cf("u2",t,e,Rf,-.7,1.1,-1),Cf("u3",t,e,Rf,0,2,-1),Cf("cf1",t,e,Rf,-1,0,1),Cf("cf2",t,e,Rf,1,0,1),Cf("cf3",t,e,Rf,0,-1,1),Cf("cf4",t,e,Rf,0,1,1),Cf("cn1",t,e,Rf,-1,0,-1),Cf("cn2",t,e,Rf,1,0,-1),Cf("cn3",t,e,Rf,0,-1,-1),Cf("cn4",t,e,Rf,0,1,-1),e.getAttribute("position").needsUpdate=!0};var Of=new Er;function Df(e,t){this.object=e,void 0===t&&(t=16776960);var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),i=new Li;i.setIndex(new ui(n,1)),i.setAttribute("position",new ui(r,3)),cc.call(this,i,new $s({color:t})),this.matrixAutoUpdate=!1,this.update()}function If(e,t){this.type="Box3Helper",this.box=e,t=t||16776960;var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Li;r.setIndex(new ui(n,1)),r.setAttribute("position",new gi([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),cc.call(this,r,new $s({color:t})),this.geometry.computeBoundingSphere()}function Nf(e,t,n){this.type="PlaneHelper",this.plane=e,this.size=void 0===t?1:t;var r=void 0!==n?n:16776960,i=new Li;i.setAttribute("position",new gi([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),ac.call(this,i,new $s({color:r}));var a=new Li;a.setAttribute("position",new gi([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),a.computeBoundingSphere(),this.add(new qi(a,new si({color:r,opacity:.2,transparent:!0,depthWrite:!1})))}Df.prototype=Object.create(cc.prototype),Df.prototype.constructor=Df,Df.prototype.update=function(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Of.setFromObject(this.object),!Of.isEmpty()){var t=Of.min,n=Of.max,r=this.geometry.attributes.position,i=r.array;i[0]=n.x,i[1]=n.y,i[2]=n.z,i[3]=t.x,i[4]=n.y,i[5]=n.z,i[6]=t.x,i[7]=t.y,i[8]=n.z,i[9]=n.x,i[10]=t.y,i[11]=n.z,i[12]=n.x,i[13]=n.y,i[14]=t.z,i[15]=t.x,i[16]=n.y,i[17]=t.z,i[18]=t.x,i[19]=t.y,i[20]=t.z,i[21]=n.x,i[22]=t.y,i[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}},Df.prototype.setFromObject=function(e){return this.object=e,this.update(),this},Df.prototype.copy=function(e){return cc.prototype.copy.call(this,e),this.object=e.object,this},Df.prototype.clone=function(){return(new this.constructor).copy(this)},If.prototype=Object.create(cc.prototype),If.prototype.constructor=If,If.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),ur.prototype.updateMatrixWorld.call(this,e))},Nf.prototype=Object.create(ac.prototype),Nf.prototype.constructor=Nf,Nf.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?g:v,this.lookAt(this.plane.normal),ur.prototype.updateMatrixWorld.call(this,e)};var zf,kf,Ff=new kn;function Bf(e,t,n,r,i,a){ur.call(this),void 0===e&&(e=new kn(0,0,1)),void 0===t&&(t=new kn(0,0,0)),void 0===n&&(n=1),void 0===r&&(r=16776960),void 0===i&&(i=.2*n),void 0===a&&(a=.2*i),void 0===zf&&((zf=new Li).setAttribute("position",new gi([0,0,0,0,1,0],3)),(kf=new Lu(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new ac(zf,new $s({color:r})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new qi(kf,new si({color:r})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,i,a)}function Uf(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new Li;n.setAttribute("position",new gi(t,3)),n.setAttribute("color",new gi([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var r=new $s({vertexColors:M});cc.call(this,n,r)}Bf.prototype=Object.create(ur.prototype),Bf.prototype.constructor=Bf,Bf.prototype.setDirection=function(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Ff.set(e.z,0,-e.x).normalize();var t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Ff,t)}},Bf.prototype.setLength=function(e,t,n){void 0===t&&(t=.2*e),void 0===n&&(n=.2*t),this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()},Bf.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},Bf.prototype.copy=function(e){return ur.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this},Bf.prototype.clone=function(){return(new this.constructor).copy(this)},Uf.prototype=Object.create(cc.prototype),Uf.prototype.constructor=Uf;var Hf=Math.pow(2,8),Gf=[.125,.215,.35,.446,.526,.582],jf=5+Gf.length,Vf={[kt]:0,[Ft]:1,[Ut]:2,[Gt]:3,[jt]:4,[Vt]:5,[Bt]:6},Wf=new Xl,qf=function(e){var t=new Float32Array(e),n=new kn(0,1,0),r=new Nu({defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n},inputEncoding:{value:Vf[kt]},outputEncoding:{value:Vf[kt]}},vertexShader:mp(),fragmentShader:`\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform int samples;\nuniform float weights[n];\nuniform bool latitudinal;\nuniform float dTheta;\nuniform float mipInt;\nuniform vec3 poleAxis;\n\n${vp()}\n\n#define ENVMAP_TYPE_CUBE_UV\n#include <cube_uv_reflection_fragment>\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tfor (int i = 0; i < n; i++) {\n\t\tif (i >= samples)\n\t\t\tbreak;\n\t\tfor (int dir = -1; dir < 2; dir += 2) {\n\t\t\tif (i == 0 && dir == 1)\n\t\t\t\tcontinue;\n\t\t\tvec3 axis = latitudinal ? poleAxis : cross(poleAxis, vOutputDirection);\n\t\t\tif (all(equal(axis, vec3(0.0))))\n\t\t\t\taxis = cross(vec3(0.0, 1.0, 0.0), vOutputDirection);\n\t\t\taxis = normalize(axis);\n\t\t\tfloat theta = dTheta * float(dir * i);\n\t\t\tfloat cosTheta = cos(theta);\n\t\t\t// Rodrigues' axis-angle rotation\n\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross(axis, vOutputDirection) * sin(theta)\n\t\t\t\t\t+ axis * dot(axis, vOutputDirection) * (1.0 - cosTheta);\n\t\t\tgl_FragColor.rgb +=\n\t\t\t\t\tweights[i] * bilinearCubeUV(envMap, sampleDirection, mipInt);\n\t\t}\n\t}\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t`,blending:E,depthTest:!1,depthWrite:!1});return r.type="SphericalGaussianBlur",r}(20),Yf=null,Xf=null,{_lodPlanes:Zf,_sizeLods:Jf,_sigmas:Qf}=function(){for(var e=[],t=[],n=[],r=8,i=0;i<jf;i++){var a=Math.pow(2,r);t.push(a);var o=1/a;i>4?o=Gf[i-8+4-1]:0==i&&(o=0),n.push(o);for(var s=1/(a-1),c=-s/2,u=1+s/2,l=[c,c,u,c,u,u,c,c,u,u,c,u],h=new Float32Array(108),f=new Float32Array(72),p=new Float32Array(36),d=0;d<6;d++){var m=d%3*2/3-1,v=d>2?0:-1,g=[m,v,0,m+2/3,v,0,m+2/3,v+1,0,m,v,0,m+2/3,v+1,0,m,v+1,0];h.set(g,18*d),f.set(l,12*d);var y=[d,d,d,d,d,d];p.set(y,6*d)}var x=new Li;x.setAttribute("position",new ui(h,3)),x.setAttribute("uv",new ui(f,2)),x.setAttribute("faceIndex",new ui(p,1)),e.push(x),r>4&&r--}return{_lodPlanes:e,_sizeLods:t,_sigmas:n}}(),Kf=null,$f=null,ep=null,tp=(1+Math.sqrt(5))/2,np=1/tp,rp=[new kn(1,1,1),new kn(-1,1,1),new kn(1,1,-1),new kn(-1,1,-1),new kn(0,tp,np),new kn(0,tp,-np),new kn(np,0,tp),new kn(-np,0,tp),new kn(tp,np,0),new kn(-tp,np,0)];function ip(e){$f=e,sp(qf)}function ap(e){var t={magFilter:be,minFilter:be,generateMipmaps:!1,type:e?e.type:Pe,format:e?e.format:Ye,encoding:e?e.encoding:Ut,depthBuffer:!1,stencilBuffer:!1},n=cp(t);return n.depthBuffer=!e,Kf=cp(t),n}function op(e){Kf.dispose(),$f.setRenderTarget(ep),e.scissorTest=!1,e.setSize(e.width,e.height)}function sp(e){var t=new lr;t.add(new qi(Zf[0],e)),$f.compile(t,Wf)}function cp(e){var t=new On(3*Hf,3*Hf,e);return t.texture.mapping=me,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function up(e,t,n,r,i){e.viewport.set(t,n,r,i),e.scissor.set(t,n,r,i)}function lp(e){var t=$f.autoClear;$f.autoClear=!1;for(var n=1;n<jf;n++){hp(e,n-1,n,Math.sqrt(Qf[n]*Qf[n]-Qf[n-1]*Qf[n-1]),rp[(n-1)%rp.length])}$f.autoClear=t}function hp(e,t,n,r,i){fp(e,Kf,t,n,r,"latitudinal",i),fp(Kf,e,n,n,r,"longitudinal",i)}function fp(e,t,n,r,i,a,o){"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");var s=new lr;s.add(new qi(Zf[r],qf));var c=qf.uniforms,u=Jf[n]-1,l=isFinite(i)?Math.PI/(2*u):2*Math.PI/39,h=i/l,f=isFinite(i)?1+Math.floor(3*h):20;f>20&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);for(var p=[],d=0,m=0;m<20;++m){var v=m/h,g=Math.exp(-v*v/2);p.push(g),0==m?d+=g:m<f&&(d+=2*g)}for(m=0;m<p.length;m++)p[m]=p[m]/d;c.envMap.value=e.texture,c.samples.value=f,c.weights.value=p,c.latitudinal.value="latitudinal"===a,o&&(c.poleAxis.value=o),c.dTheta.value=l,c.mipInt.value=8-n,c.inputEncoding.value=Vf[e.texture.encoding],c.outputEncoding.value=Vf[e.texture.encoding];var y=Jf[r];up(t,v=3*Math.max(0,Hf-2*y),(0===r?0:2*Hf)+2*y*(r>4?r-8+4:0),3*y,2*y),$f.setRenderTarget(t),$f.render(s,Wf)}function pp(){var e=new Nu({uniforms:{envMap:{value:null},texelSize:{value:new Sn(1,1)},inputEncoding:{value:Vf[kt]},outputEncoding:{value:Vf[kt]}},vertexShader:mp(),fragmentShader:`\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform vec2 texelSize;\n\n${vp()}\n\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tvec3 outputDirection = normalize(vOutputDirection);\n\tvec2 uv;\n\tuv.y = asin(clamp(outputDirection.y, -1.0, 1.0)) * RECIPROCAL_PI + 0.5;\n\tuv.x = atan(outputDirection.z, outputDirection.x) * RECIPROCAL_PI2 + 0.5;\n\tvec2 f = fract(uv / texelSize - 0.5);\n\tuv -= f * texelSize;\n\tvec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x += texelSize.x;\n\tvec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.y += texelSize.y;\n\tvec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x -= texelSize.x;\n\tvec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tvec3 tm = mix(tl, tr, f.x);\n\tvec3 bm = mix(bl, br, f.x);\n\tgl_FragColor.rgb = mix(tm, bm, f.y);\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t`,blending:E,depthTest:!1,depthWrite:!1});return e.type="EquirectangularToCubeUV",e}function dp(){var e=new Nu({uniforms:{envMap:{value:null},inputEncoding:{value:Vf[kt]},outputEncoding:{value:Vf[kt]}},vertexShader:mp(),fragmentShader:`\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform samplerCube envMap;\n\n${vp()}\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tgl_FragColor.rgb = envMapTexelToLinear(textureCube(envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ))).rgb;\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t`,blending:E,depthTest:!1,depthWrite:!1});return e.type="CubemapToCubeUV",e}function mp(){return"\nprecision mediump float;\nprecision mediump int;\nattribute vec3 position;\nattribute vec2 uv;\nattribute float faceIndex;\nvarying vec3 vOutputDirection;\nvec3 getDirection(vec2 uv, float face) {\n\tuv = 2.0 * uv - 1.0;\n\tvec3 direction = vec3(uv, 1.0);\n\tif (face == 0.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 1.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.z *= -1.0;\n\t} else if (face == 3.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.x *= -1.0;\n\t} else if (face == 4.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.y *= -1.0;\n\t} else if (face == 5.0) {\n\t\tdirection.xz *= -1.0;\n\t}\n\treturn direction;\n}\nvoid main() {\n\tvOutputDirection = getDirection(uv, faceIndex);\n\tgl_Position = vec4( position, 1.0 );\n}\n\t"}function vp(){return"\nuniform int inputEncoding;\nuniform int outputEncoding;\n\n#include <encodings_pars_fragment>\n\nvec4 inputTexelToLinear(vec4 value){\n\tif(inputEncoding == 0){\n\t\treturn value;\n\t}else if(inputEncoding == 1){\n\t\treturn sRGBToLinear(value);\n\t}else if(inputEncoding == 2){\n\t\treturn RGBEToLinear(value);\n\t}else if(inputEncoding == 3){\n\t\treturn RGBMToLinear(value, 7.0);\n\t}else if(inputEncoding == 4){\n\t\treturn RGBMToLinear(value, 16.0);\n\t}else if(inputEncoding == 5){\n\t\treturn RGBDToLinear(value, 256.0);\n\t}else{\n\t\treturn GammaToLinear(value, 2.2);\n\t}\n}\n\nvec4 linearToOutputTexel(vec4 value){\n\tif(outputEncoding == 0){\n\t\treturn value;\n\t}else if(outputEncoding == 1){\n\t\treturn LinearTosRGB(value);\n\t}else if(outputEncoding == 2){\n\t\treturn LinearToRGBE(value);\n\t}else if(outputEncoding == 3){\n\t\treturn LinearToRGBM(value, 7.0);\n\t}else if(outputEncoding == 4){\n\t\treturn LinearToRGBM(value, 16.0);\n\t}else if(outputEncoding == 5){\n\t\treturn LinearToRGBD(value, 256.0);\n\t}else{\n\t\treturn LinearToGamma(value, 2.2);\n\t}\n}\n\nvec4 envMapTexelToLinear(vec4 color) {\n\treturn inputTexelToLinear(color);\n}\n\t"}function gp(e,t,n,r,i,a,o){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new ii(e,t,n,i,a,o)}ip.prototype={constructor:ip,fromScene:function(e,t=0,n=.1,r=100){ep=$f.getRenderTarget();var i=ap();return function(e,t,n,r){var i=new sa(90,1,t,n),a=[1,1,1,1,-1,1],o=[1,1,-1,-1,-1,1],s=$f.outputEncoding,c=$f.toneMapping,u=$f.toneMappingExposure,l=$f.getClearColor(),h=$f.getClearAlpha();$f.toneMapping=ie,$f.toneMappingExposure=1,$f.outputEncoding=kt,e.scale.z*=-1;var f=e.background;if(f&&f.isColor){f.convertSRGBToLinear();var p=Math.max(f.r,f.g,f.b),d=Math.min(Math.max(Math.ceil(Math.log2(p)),-128),127);f=f.multiplyScalar(Math.pow(2,-d));var m=(d+128)/255;$f.setClearColor(f,m),e.background=null}for(var v=0;v<6;v++){var g=v%3;0==g?(i.up.set(0,a[v],0),i.lookAt(o[v],0,0)):1==g?(i.up.set(0,0,a[v]),i.lookAt(0,o[v],0)):(i.up.set(0,a[v],0),i.lookAt(0,0,o[v])),up(r,g*Hf,v>2?Hf:0,Hf,Hf),$f.setRenderTarget(r),$f.render(e,i)}$f.toneMapping=c,$f.toneMappingExposure=u,$f.outputEncoding=s,$f.setClearColor(l,h),e.scale.z*=-1}(e,n,r,i),t>0&&hp(i,0,0,t),lp(i),op(i),i},fromEquirectangular:function(e){return e.magFilter=be,e.minFilter=be,e.generateMipmaps=!1,this.fromCubemap(e)},fromCubemap:function(e){ep=$f.getRenderTarget();var t=ap(e);return function(e,t){var n=new lr;e.isCubeTexture?null==Xf&&(Xf=dp()):null==Yf&&(Yf=pp());var r=e.isCubeTexture?Xf:Yf;n.add(new qi(Zf[0],r));var i=r.uniforms;i.envMap.value=e,e.isCubeTexture||i.texelSize.value.set(1/e.image.width,1/e.image.height);i.inputEncoding.value=Vf[e.encoding],i.outputEncoding.value=Vf[e.encoding],up(t,0,0,3*Hf,2*Hf),$f.setRenderTarget(t),$f.render(n,Wf)}(e,t),lp(t),op(t),t},compileCubemapShader:function(){null==Xf&&sp(Xf=dp())},compileEquirectangularShader:function(){null==Yf&&sp(Yf=pp())},dispose:function(){qf.dispose(),null!=Xf&&Xf.dispose(),null!=Yf&&Yf.dispose();for(var e=0;e<Zf.length;e++)Zf[e].dispose()}};var yp=0,xp=1;function bp(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e}function wp(e){return void 0===e&&(e=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e}function _p(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new mc(e,t)}function Mp(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Fs(e)}function Ep(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new mc(e,t)}function Tp(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new lc(e)}function Sp(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new lc(e)}function Ap(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new lc(e)}function Lp(e,t,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new kn(e,t,n)}function Rp(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new ui(e,t).setUsage(pn)}function Pp(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new li(e,t)}function Cp(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new hi(e,t)}function Op(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new fi(e,t)}function Dp(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new pi(e,t)}function Ip(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new di(e,t)}function Np(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new mi(e,t)}function zp(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new vi(e,t)}function kp(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new gi(e,t)}function Fp(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new yi(e,t)}function Bp(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Sl.call(this,e),this.type="catmullrom",this.closed=!0}function Up(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Sl.call(this,e),this.type="catmullrom"}function Hp(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Sl.call(this,e),this.type="catmullrom"}function Gp(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Uf(e)}function jp(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Df(e,t)}function Vp(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new cc(new Su(e.geometry),new $s({color:void 0!==t?t:16777215}))}function Wp(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new cc(new wc(e.geometry),new $s({color:void 0!==t?t:16777215}))}function qp(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new hl(e)}function Yp(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new dl(e)}function Xp(e,t,n){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new ua(e,n)}yl.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(yl.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(Fl.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new $i,n=0,r=e.length;n<r;n++){var i=e[n];t.vertices.push(new kn(i.x,i.y,i.z||0))}return t}}),Object.assign(Bl.prototype,{fromPoints:function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),Bp.prototype=Object.create(Sl.prototype),Up.prototype=Object.create(Sl.prototype),Hp.prototype=Object.create(Sl.prototype),Object.assign(Hp.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),_f.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},vf.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(ul.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),eh.extractUrlBase(e)}}),ul.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(ah.prototype,{setTexturePath:function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}),Object.assign(of.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(Er.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),pa.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},uf.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(Tn,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Tn.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Tn.ceilPowerOfTwo(e)}}),Object.assign(An.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(Wn.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new kn).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,n,r,i,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,r,n,i,a)}}),Br.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},In.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(Nr.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(Jr.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(Jr,{barycoordFromPoint:function(e,t,n,r,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Jr.getBarycoord(e,t,n,r,i)},normal:function(e,t,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Jr.getNormal(e,t,n,r)}}),Object.assign(Ul.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new hu(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Mu(this,e)}}),Object.assign(Sn.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(kn.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Cn.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign($i.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.assign(ur.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(ur.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(qi.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(qi.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),It},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(Gs.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(qs.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),js.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(yl.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),sa.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(Hl.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(ui.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===pn},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(pn)}}}),Object.assign(ui.prototype,{setDynamic:function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?pn:fn),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Li.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addAttribute:function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new ui(arguments[1],arguments[2])))},addDrawCall:function(e,t,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},applyMatrix:function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(Li.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(ws.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===pn},set:function(e){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(e)}}}),Object.assign(ws.prototype,{setDynamic:function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?pn:fn),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(fu.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(Qh.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(oi.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new ei}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===x}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties(Fu.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(aa.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(ys.prototype,{clearTarget:function(e,t,n,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,r)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(ys.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?Ft:kt}}}),Object.defineProperties(us.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(On.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(Ph.prototype,{load:{value:function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return(new vh).load(e,(function(e){t.setBuffer(e)})),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),zh.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},ca.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)};var Zp={merge:function(e,t,n){var r;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),r=t.matrix,t=t.geometry),e.merge(t,r,n)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}};function Jp(){console.error("THREE.CanvasRenderer has been removed")}function Qp(){console.error("THREE.JSONLoader has been removed.")}Ln.crossOrigin=void 0,Ln.loadTexture=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var i=new gl;i.setCrossOrigin(this.crossOrigin);var a=i.load(e,n,void 0,r);return t&&(a.mapping=t),a},Ln.loadTextureCube=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var i=new vl;i.setCrossOrigin(this.crossOrigin);var a=i.load(e,n,void 0,r);return t&&(a.mapping=t),a},Ln.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Ln.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};var Kp={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}};function $p(){console.error("THREE.LensFlare has been moved to /examples/js/objects/Lensflare.js")}"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:r}}))},function(e,t,n){e.exports={random:n(24),math:n(27),penplot:n(28),geometry:n(8),shader:n(48),color:n(54)}},function(e,t,n){var r=n(25),i=n(26),a=n(0);e.exports=function e(t){t=a(t,null);var n,o,s,c=Math.random,u=null,l=!1;return h(t),{value:f,createRandom:function(t){return e(t)},setSeed:h,getSeed:function(){return n},getRandomSeed:function(){return String(Math.floor(1e6*Math.random()))},valueNonZero:function(){var e=0;for(;0===e;)e=f();return e},permuteNoise:function(){s=p()},noise1D:function(e,t,n){if(!isFinite(e))throw new TypeError("x component for noise() must be finite");return t=a(t,1),(n=a(n,1))*s.noise2D(e*t,0)},noise2D:function(e,t,n,r){if(!isFinite(e))throw new TypeError("x component for noise() must be finite");if(!isFinite(t))throw new TypeError("y component for noise() must be finite");return n=a(n,1),(r=a(r,1))*s.noise2D(e*n,t*n)},noise3D:function(e,t,n,r,i){if(!isFinite(e))throw new TypeError("x component for noise() must be finite");if(!isFinite(t))throw new TypeError("y component for noise() must be finite");if(!isFinite(n))throw new TypeError("z component for noise() must be finite");return r=a(r,1),(i=a(i,1))*s.noise3D(e*r,t*r,n*r)},noise4D:function(e,t,n,r,i,o){if(!isFinite(e))throw new TypeError("x component for noise() must be finite");if(!isFinite(t))throw new TypeError("y component for noise() must be finite");if(!isFinite(n))throw new TypeError("z component for noise() must be finite");if(!isFinite(r))throw new TypeError("w component for noise() must be finite");return i=a(i,1),(o=a(o,1))*s.noise4D(e*i,t*i,n*i,r*i)},sign:function(){return d()?1:-1},boolean:d,chance:function(e){if("number"!==typeof(e=a(e,.5)))throw new TypeError("expected n to be a number");return f()<e},range:m,rangeFloor:v,pick:function(e){return 0===e.length?void 0:e[v(0,e.length)]},shuffle:function(e){if(!Array.isArray(e))throw new TypeError("Expected Array, got "+typeof e);var t,n,r=e.length,i=e.slice();for(;r;)t=Math.floor(f()*r--),n=i[r],i[r]=i[t],i[t]=n;return i},onCircle:g,insideCircle:function(e,t){e=a(e,1),g(1,t=t||[]);var n=e*Math.sqrt(f());return t[0]*=n,t[1]*=n,t},onSphere:function(e,t){e=a(e,1),t=t||[];var n=f()*Math.PI*2,r=2*f()-1,i=n,o=Math.acos(r);return t[0]=e*Math.sin(o)*Math.cos(i),t[1]=e*Math.sin(o)*Math.sin(i),t[2]=e*Math.cos(o),t},insideSphere:function(e,t){e=a(e,1),t=t||[];var n=f()*Math.PI*2,r=2*f()-1,i=f(),o=n,s=Math.acos(r),c=e*Math.cbrt(i);return t[0]=c*Math.sin(s)*Math.cos(o),t[1]=c*Math.sin(s)*Math.sin(o),t[2]=c*Math.cos(s),t},quaternion:function(e){e=e||[];var t=f(),n=f(),r=f(),i=Math.sqrt(1-t),a=Math.sqrt(t),o=2*Math.PI*n,s=2*Math.PI*r,c=Math.sin(o)*i,u=Math.cos(o)*i,l=Math.sin(s)*a,h=Math.cos(s)*a;return e[0]=c,e[1]=u,e[2]=l,e[3]=h,e},weighted:x,weightedSet:function(e){return 0===(e=e||[]).length?null:e[y(e)].value},weightedSetIndex:y,gaussian:function(e,t){if(e=a(e,0),t=a(t,1),l){l=!1;var n=u;return u=null,e+t*n}var r=0,i=0,o=0;do{r=2*f()-1,i=2*f()-1,o=r*r+i*i}while(o>=1||0===o);var s=Math.sqrt(-2*Math.log(o)/o);return u=i*s,l=!0,e+t*(r*s)}};function h(e,t){"number"===typeof e||"string"===typeof e?o=r(n=e,t):(n=void 0,o=c),s=p(),u=null,l=!1}function f(){return o()}function p(){return new i(o)}function d(){return f()>.5}function m(e,t){if(void 0===t&&(t=e,e=0),"number"!==typeof e||"number"!==typeof t)throw new TypeError("Expected all arguments to be numbers");return f()*(t-e)+e}function v(e,t){if(void 0===t&&(t=e,e=0),"number"!==typeof e||"number"!==typeof t)throw new TypeError("Expected all arguments to be numbers");return Math.floor(m(e,t))}function g(e,t){e=a(e,1),t=t||[];var n=2*f()*Math.PI;return t[0]=e*Math.cos(n),t[1]=e*Math.sin(n),t}function y(e){return 0===(e=e||[]).length?-1:x(e.map((function(e){return e.weight})))}function x(e){if(0===(e=e||[]).length)return-1;var t,n=0;for(t=0;t<e.length;t++)n+=e[t];if(n<=0)throw new Error("Weights must sum to > 0");var r=f()*n;for(t=0;t<e.length;t++){if(r<e[t])return t;r-=e[t]}return 0}}()},function(e,t,n){"use strict";(function(t){var n=[],r="undefined"===typeof t?window:t,i=Math.pow(256,6),a=Math.pow(2,52),o=2*a,s=Math.random;function c(e){var t,n=e.length,r=this,i=0,a=r.i=r.j=0,o=r.S=[];for(n||(e=[n++]);i<256;)o[i]=i++;for(i=0;i<256;i++)o[i]=o[a=255&a+e[i%n]+(t=o[i])],o[a]=t;(r.g=function(e){for(var t,n=0,i=r.i,a=r.j,o=r.S;e--;)t=o[i=255&i+1],n=256*n+o[255&(o[i]=o[a=255&a+t])+(o[a]=t)];return r.i=i,r.j=a,n})(256)}function u(e,t){var n,r=[],i=(typeof e)[0];if(t&&"o"==i)for(n in e)try{r.push(u(e[n],t-1))}catch(a){}return r.length?r:"s"==i?e:e+"\0"}function l(e,t){for(var n,r=e+"",i=0;i<r.length;)t[255&i]=255&(n^=19*t[255&i])+r.charCodeAt(i++);return f(t)}function h(e){try{return r.crypto.getRandomValues(e=new Uint8Array(256)),f(e)}catch(t){return[+new Date,r,r.navigator&&r.navigator.plugins,r.screen,f(n)]}}function f(e){return String.fromCharCode.apply(0,e)}e.exports=function(t,r){if(r&&!0===r.global)return r.global=!1,Math.random=e.exports(t,r),r.global=!0,Math.random;var s=r&&r.entropy||!1,p=[],d=(l(u(s?[t,f(n)]:0 in arguments?t:h(),3),p),new c(p));return l(f(d.S),n),function(){for(var e=d.g(6),t=i,n=0;e<a;)e=256*(e+n),t*=256,n=d.g(1);for(;e>=o;)e/=2,t/=2,n>>>=1;return(e+n)/t}},e.exports.resetGlobal=function(){Math.random=s},l(Math.random(),n)}).call(this,n(1))},function(e,t,n){var r;!function(){"use strict";var i=.5*(Math.sqrt(3)-1),a=(3-Math.sqrt(3))/6,o=1/6,s=(Math.sqrt(5)-1)/4,c=(5-Math.sqrt(5))/20;function u(e){var t;t="function"==typeof e?e:e?function(){var e=0,t=0,n=0,r=1,i=h();e=i(" "),t=i(" "),n=i(" ");for(var a=0;a<arguments.length;a++)(e-=i(arguments[a]))<0&&(e+=1),(t-=i(arguments[a]))<0&&(t+=1),(n-=i(arguments[a]))<0&&(n+=1);return i=null,function(){var i=2091639*e+2.3283064365386963e-10*r;return e=t,t=n,n=i-(r=0|i)}}(e):Math.random,this.p=l(t),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(var n=0;n<512;n++)this.perm[n]=this.p[255&n],this.permMod12[n]=this.perm[n]%12}function l(e){var t,n=new Uint8Array(256);for(t=0;t<256;t++)n[t]=t;for(t=0;t<255;t++){var r=t+~~(e()*(256-t)),i=n[t];n[t]=n[r],n[r]=i}return n}function h(){var e=4022871197;return function(t){t=t.toString();for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)}}u.prototype={grad3:new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),grad4:new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]),noise2D:function(e,t){var n,r,o=this.permMod12,s=this.perm,c=this.grad3,u=0,l=0,h=0,f=(e+t)*i,p=Math.floor(e+f),d=Math.floor(t+f),m=(p+d)*a,v=e-(p-m),g=t-(d-m);v>g?(n=1,r=0):(n=0,r=1);var y=v-n+a,x=g-r+a,b=v-1+2*a,w=g-1+2*a,_=255&p,M=255&d,E=.5-v*v-g*g;if(E>=0){var T=3*o[_+s[M]];u=(E*=E)*E*(c[T]*v+c[T+1]*g)}var S=.5-y*y-x*x;if(S>=0){var A=3*o[_+n+s[M+r]];l=(S*=S)*S*(c[A]*y+c[A+1]*x)}var L=.5-b*b-w*w;if(L>=0){var R=3*o[_+1+s[M+1]];h=(L*=L)*L*(c[R]*b+c[R+1]*w)}return 70*(u+l+h)},noise3D:function(e,t,n){var r,i,a,s,c,u,l,h,f,p,d=this.permMod12,m=this.perm,v=this.grad3,g=(e+t+n)*(1/3),y=Math.floor(e+g),x=Math.floor(t+g),b=Math.floor(n+g),w=(y+x+b)*o,_=e-(y-w),M=t-(x-w),E=n-(b-w);_>=M?M>=E?(c=1,u=0,l=0,h=1,f=1,p=0):_>=E?(c=1,u=0,l=0,h=1,f=0,p=1):(c=0,u=0,l=1,h=1,f=0,p=1):M<E?(c=0,u=0,l=1,h=0,f=1,p=1):_<E?(c=0,u=1,l=0,h=0,f=1,p=1):(c=0,u=1,l=0,h=1,f=1,p=0);var T=_-c+o,S=M-u+o,A=E-l+o,L=_-h+2*o,R=M-f+2*o,P=E-p+2*o,C=_-1+.5,O=M-1+.5,D=E-1+.5,I=255&y,N=255&x,z=255&b,k=.6-_*_-M*M-E*E;if(k<0)r=0;else{var F=3*d[I+m[N+m[z]]];r=(k*=k)*k*(v[F]*_+v[F+1]*M+v[F+2]*E)}var B=.6-T*T-S*S-A*A;if(B<0)i=0;else{var U=3*d[I+c+m[N+u+m[z+l]]];i=(B*=B)*B*(v[U]*T+v[U+1]*S+v[U+2]*A)}var H=.6-L*L-R*R-P*P;if(H<0)a=0;else{var G=3*d[I+h+m[N+f+m[z+p]]];a=(H*=H)*H*(v[G]*L+v[G+1]*R+v[G+2]*P)}var j=.6-C*C-O*O-D*D;if(j<0)s=0;else{var V=3*d[I+1+m[N+1+m[z+1]]];s=(j*=j)*j*(v[V]*C+v[V+1]*O+v[V+2]*D)}return 32*(r+i+a+s)},noise4D:function(e,t,n,r){var i,a,o,u,l,h,f,p,d,m,v,g,y,x,b,w,_,M=this.perm,E=this.grad4,T=(e+t+n+r)*s,S=Math.floor(e+T),A=Math.floor(t+T),L=Math.floor(n+T),R=Math.floor(r+T),P=(S+A+L+R)*c,C=e-(S-P),O=t-(A-P),D=n-(L-P),I=r-(R-P),N=0,z=0,k=0,F=0;C>O?N++:z++,C>D?N++:k++,C>I?N++:F++,O>D?z++:k++,O>I?z++:F++,D>I?k++:F++;var B=C-(h=N>=3?1:0)+c,U=O-(f=z>=3?1:0)+c,H=D-(p=k>=3?1:0)+c,G=I-(d=F>=3?1:0)+c,j=C-(m=N>=2?1:0)+2*c,V=O-(v=z>=2?1:0)+2*c,W=D-(g=k>=2?1:0)+2*c,q=I-(y=F>=2?1:0)+2*c,Y=C-(x=N>=1?1:0)+3*c,X=O-(b=z>=1?1:0)+3*c,Z=D-(w=k>=1?1:0)+3*c,J=I-(_=F>=1?1:0)+3*c,Q=C-1+4*c,K=O-1+4*c,$=D-1+4*c,ee=I-1+4*c,te=255&S,ne=255&A,re=255&L,ie=255&R,ae=.6-C*C-O*O-D*D-I*I;if(ae<0)i=0;else{var oe=M[te+M[ne+M[re+M[ie]]]]%32*4;i=(ae*=ae)*ae*(E[oe]*C+E[oe+1]*O+E[oe+2]*D+E[oe+3]*I)}var se=.6-B*B-U*U-H*H-G*G;if(se<0)a=0;else{var ce=M[te+h+M[ne+f+M[re+p+M[ie+d]]]]%32*4;a=(se*=se)*se*(E[ce]*B+E[ce+1]*U+E[ce+2]*H+E[ce+3]*G)}var ue=.6-j*j-V*V-W*W-q*q;if(ue<0)o=0;else{var le=M[te+m+M[ne+v+M[re+g+M[ie+y]]]]%32*4;o=(ue*=ue)*ue*(E[le]*j+E[le+1]*V+E[le+2]*W+E[le+3]*q)}var he=.6-Y*Y-X*X-Z*Z-J*J;if(he<0)u=0;else{var fe=M[te+x+M[ne+b+M[re+w+M[ie+_]]]]%32*4;u=(he*=he)*he*(E[fe]*Y+E[fe+1]*X+E[fe+2]*Z+E[fe+3]*J)}var pe=.6-Q*Q-K*K-$*$-ee*ee;if(pe<0)l=0;else{var de=M[te+1+M[ne+1+M[re+1+M[ie+1]]]]%32*4;l=(pe*=pe)*pe*(E[de]*Q+E[de+1]*K+E[de+2]*$+E[de+3]*ee)}return 27*(i+a+o+u+l)}},u._buildPermutationTable=l,void 0===(r=function(){return u}.call(t,n,t,e))||(e.exports=r),t.SimplexNoise=u,e.exports=u}()},function(e,t,n){var r=n(0),i=n(2),a=Number.EPSILON;function o(e,t,n){return t<n?e<t?t:e>n?n:e:e<n?n:e>t?t:e}function s(e,t,n){return e*(1-n)+t*n}function c(e,t,n){return Math.abs(e-t)<a?0:(n-e)/(t-e)}function u(e,t){return t=r(t,0),"number"===typeof e&&isFinite(e)?e:t}function l(e){if("number"!==typeof e)throw new TypeError("Expected dims argument");return function(t,n){var i;n=r(n,0),null==t?i=n:"number"===typeof t&&isFinite(t)&&(i=t);var a,o=[];if(null==i)for(a=0;a<e;a++)o[a]=u(t[a],n);else for(a=0;a<e;a++)o[a]=i;return o}}function h(e,t,n,r){if(r=r||[],e.length!==t.length)throw new TypeError("min and max array are expected to have the same length");for(var i=0;i<e.length;i++)r[i]=s(e[i],t[i],n);return r}function f(e,t){if("number"!==typeof(e=r(e,0)))throw new TypeError("Expected n argument to be a number");for(var n=[],i=0;i<e;i++)n.push(t);return n}function p(e,t){return(e%t+t)%t}function d(e,t,n,r){return s(e,t,1-Math.exp(-n*r))}e.exports={mod:p,fract:function(e){return e-Math.floor(e)},sign:function(e){return e>0?1:e<0?-1:0},degToRad:function(e){return e*Math.PI/180},radToDeg:function(e){return 180*e/Math.PI},wrap:i,pingPong:function(e,t){return e=p(e,2*t),t-Math.abs(e-t)},linspace:function(e,t){if("number"!==typeof(e=r(e,0)))throw new TypeError("Expected n argument to be a number");"boolean"===typeof(t=t||{})&&(t={endpoint:!0});var n=r(t.offset,0);return t.endpoint?f(e).map((function(t,r){return e<=1?0:(r+n)/(e-1)})):f(e).map((function(t,r){return(r+n)/e}))},lerp:s,lerpArray:h,inverseLerp:c,lerpFrames:function(e,t,n){t=o(t,0,1);var r=e.length-1,i=t*r,a=Math.floor(i),c=i-a,u=Math.min(a+1,r),l=e[a%e.length],f=e[u%e.length];if("number"===typeof l&&"number"===typeof f)return s(l,f,c);if(Array.isArray(l)&&Array.isArray(f))return h(l,f,c,n);throw new TypeError("Mismatch in value type of two array elements: "+a+" and "+u)},clamp:o,clamp01:function(e){return o(e,0,1)},smoothstep:function(e,t,n){var r=o(c(e,t,n),0,1);return r*r*(3-2*r)},damp:d,dampArray:function(e,t,n,r,i){i=i||[];for(var a=0;a<e.length;a++)i[a]=d(e[a],t[a],n,r);return i},mapRange:function(e,t,n,r,i,o){if(Math.abs(t-n)<a)return r;var s=(e-t)/(n-t)*(i-r)+r;return o&&(i<r?s<i?s=i:s>r&&(s=r):s>i?s=i:s<r&&(s=r)),s},expand2D:l(2),expand3D:l(3),expand4D:l(4)}},function(e,t,n){var r=n(0),i=n(29),a=n(60),o=n(30),s=n(35),c=n(5),u=n(36),l=n(37),h=n(8);function f(e,t){var n=g(e,t=t||{});return(Array.isArray(n)?n:[n]).filter(Boolean)}function p(e,t){var n;if(null!=(t=t||{}).curveResolution&&isFinite(t.curveResolution)&&"number"===typeof t.curveResolution)n=t.curveResolution;else{var r=t.units||"px";n=Math.max(1,i(4,r,"px"))}var a=[];return y(e,(function(e){if("string"===typeof e){var t=s(e);o(t,n).forEach((function(e){a.push(e)}))}else{var r=e.map((function(e){return[e[0]||0,e[1]||0]}));a.push(r)}})),a}function d(e,t){var n=(t=t||{}).width,a=t.height;if("undefined"===typeof n||"undefined"===typeof a)throw new Error('Must specify "width" and "height" options');var o=t.units||"px",s={units:o,viewUnits:"px",roundPixel:!1,precision:r(t.precision,5),pixelsPerInch:90};if(e=p(e,Object.assign({},s,{curveResolution:t.curveResolution||void 0})),t.optimize){var c="object"===typeof t.optimize?t.optimize:{sort:!0,merge:!0,removeDuplicates:!0,removeCollinear:!0},u=!1!==c.sort,d=!1!==c.merge,v=!1!==c.removeDuplicates,g=!1!==c.removeCollinear;if(v&&(e=e.map((function(e){return h.removeDuplicatePoints(e)}))),g&&(e=e.map((function(e){return h.removeCollinearPoints(e)}))),u&&(e=l.sort(e)),d){var y=null!=c.mergeThreshold?c.mergeThreshold:i(.25,"mm",o,{pixelsPerInch:90});e=l.merge(e,y)}}var x=f(e,s),b=i(n,o,"px",s).toString(),w=i(a,o,"px",s).toString(),_=t.fillStyle||"none",M=t.strokeStyle||"black",E=t.lineWidth,T=t.lineJoin,S=t.lineCap;"undefined"===typeof E&&(E=i(.03,"cm",o,s).toString());var A=x.map((function(e){return"    <path "+m([["d",e]])+" />"})).join("\n");return['<?xml version="1.0" standalone="no"?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" ','    "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">','<svg width="'+n+o+'" height="'+a+o+'"','    xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 '+b+" "+w+'">',"  <g "+m([["fill",_],["stroke",M],["stroke-width",E+""+o],!!T&&["stroke-linejoin",T],!!S&&["stroke-linecap",S]])+">",A,"  </g>","</svg>"].join("\n")}function m(e){return e.filter(Boolean).map((function(e){return e[0]+'="'+e[1]+'"'})).join(" ")}function v(e,t){var n=(t=t||{}).context;if(!n)throw new Error('Must specify "context" options');var r=t.units||"px",a=t.width,o=t.height;if("undefined"===typeof a||"undefined"===typeof o)throw new Error('Must specify "width" and "height" options');var s=t.lineWidth;return"undefined"===typeof s&&(s=i(.03,"cm",r,{roundPixel:!1,pixelsPerInch:90})),n.clearRect(0,0,a,o),n.fillStyle=t.background||"white",n.fillRect(0,0,a,o),n.strokeStyle=t.foreground||t.strokeStyle||"black",n.lineWidth=s,n.lineJoin=t.lineJoin||"miter",n.lineCap=t.lineCap||"butt",y(e,(function(e){n.beginPath(),"string"===typeof e?x(n,e):e.forEach((function(e){n.lineTo(e[0],e[1])})),n.stroke()})),[n.canvas,{data:d(e,t),extension:".svg"}]}function g(e,t){return w(e)?"":"string"===typeof e?e:_(e)?e.toString():M(e)?b(e,t):Array.isArray(e)?e.map((function(e){return g(e,t)})).reduce((function(e,t){return e.concat(t)}),[]):""}function y(e,t){w(e)||("string"===typeof e||_(e)?t(e.toString()):M(e)?t(e):Array.isArray(e)&&e.forEach((function(e){return y(e,t)})))}function x(e,t){for(var n=u(c(s(t))),r=0;r<n.length;r++){var i=n[r],a=i[0];if("M"===a)e.moveTo(i[1],i[2]);else{if("C"!==a)throw new Error('Illegal type "'+a+'" in SVG commands');e.bezierCurveTo(i[1],i[2],i[3],i[4],i[5],i[6])}}}function b(e,t){var n=(t=t||{}).units||"px",a=t.viewUnits||n,o=[],s={roundPixel:!1,precision:r(t.precision,5),pixelsPerInch:90};return e.forEach((function(e,t){var r=0===t?"M":"L",c=i(e[0],n,a,s).toString(),u=i(e[1],n,a,s).toString();o.push(r+c+" "+u)})),o.join(" ")}function w(e){return!e||Array.isArray(e)&&0===e.length}function _(e){return"object"===typeof e&&e&&!Array.isArray(e)}function M(e){return!(!e||!Array.isArray(e)||0===e.length)&&(t=e[0],Array.isArray(t)&&t.length>=2&&t.every((function(e){return"number"===typeof e})));var t}e.exports.createPath=function(e){var t=a.path();"function"===typeof e&&e(t);return t.lineTo=n(t.lineTo),t.quadraticCurveTo=n(t.quadraticCurveTo),t.bezierCurveTo=n(t.bezierCurveTo),t;function n(e){return function(){var n=Array.prototype.slice.call(arguments);return null==t._x1&&null==t._y1&&t.moveTo(n[0],n[1]),e.apply(t,n)}}},e.exports.pathsToSVGPaths=f,e.exports.pathsToPolylines=p,e.exports.pathsToSVG=d,e.exports.renderPaths=v,e.exports.convertToSVGPath=g,e.exports.eachPath=y,e.exports.drawSVGPath=x,e.exports.polylineToSVGPath=b,e.exports.polylinesToSVG=function(e,t){if(!Array.isArray(e))throw new Error("Expected array of arrays for polylines");return console.warn("polylinesToSVG is deprecated, use pathsToSVG instead which has the same functionality"),d(e,t)},e.exports.renderPolylines=function(e,t){if(!Array.isArray(e))throw new Error("Expected array of arrays for polylines");return console.warn("renderPolylines is deprecated, use renderPaths instead which has the same functionality"),v(e,t)}},function(e,t,n){var r=n(0),i=["mm","cm","m","pc","pt","in","ft","px"],a={m:{system:"metric",factor:1},cm:{system:"metric",factor:.01},mm:{system:"metric",factor:.001},pt:{system:"imperial",factor:1/72},pc:{system:"imperial",factor:1/6},in:{system:"imperial",factor:1},ft:{system:"imperial",factor:12}};const o={metric:{unit:"m",ratio:1/.0254},imperial:{unit:"in",ratio:.0254}};e.exports=function(e,t,n,s){if("number"!==typeof e||!isFinite(e))throw new Error("Value must be a finite number");if(!t||!n)throw new Error("Must specify from and to units");var c=r((s=s||{}).pixelsPerInch,96),u=s.precision,l=!1!==s.roundPixel;if(t=t.toLowerCase(),n=n.toLowerCase(),-1===i.indexOf(t))throw new Error('Invalid from unit "'+t+'", must be one of: '+i.join(", "));if(-1===i.indexOf(n))throw new Error('Invalid from unit "'+n+'", must be one of: '+i.join(", "));if(t===n)return e;var h=1,f=1,p=!1;"px"===t&&(f=1/c,t="in"),"px"===n&&(p=!0,h=c,n="in");var d=a[t],m=a[n],v=e*d.factor*f;d.system!==m.system&&(v*=o[d.system].ratio);var g=v/m.factor*h;return p&&l?g=Math.round(g):"number"===typeof u&&isFinite(u)&&(g=function(e,t){return Number(Math.round(e+"e"+t)+"e-"+t)}(g,u)),g},e.exports.units=i},function(e,t,n){var r=n(31),i=n(5),a=n(33),o=n(34);function s(e,t,n){return e[0]=t,e[1]=n,e}var c=[0,0],u=[0,0],l=[0,0];e.exports=function(e,t){var n=[],h=[],f=[0,0];return a(i(e)).forEach((function(e,i,a){if("M"===e[0])o(f,e.slice(1)),h.length>0&&(n.push(h),h=[]);else{if("C"!==e[0])throw new Error("illegal type in SVG: "+e[0]);!function(e,t,n,i){r(n,s(c,i[1],i[2]),s(u,i[3],i[4]),s(l,i[5],i[6]),t,e)}(h,t,f,e),s(f,e[5],e[6])}})),h.length>0&&n.push(h),n}},function(e,t,n){e.exports=n(32)()},function(e,t){function n(e){return[e[0],e[1]]}function r(e,t){return[e,t]}e.exports=function(e){var t="number"===typeof(e=e||{}).recursion?e.recursion:8,i="number"===typeof e.epsilon?e.epsilon:1.1920929e-7,a="number"===typeof e.pathEpsilon?e.pathEpsilon:1,o="number"===typeof e.angleEpsilon?e.angleEpsilon:.01,s=e.angleTolerance||0,c=e.cuspLimit||0;return function(e,u,l,h,f,p){p||(p=[]);var d=a/(f="number"===typeof f?f:1);return function(e,a,u,l,h,f){h.push(n(e));var p=e[0],d=e[1],m=a[0],v=a[1],g=u[0],y=u[1],x=l[0],b=l[1];(function e(n,a,u,l,h,f,p,d,m,v,g){if(g>t)return;var y=Math.PI,x=(n+u)/2,b=(a+l)/2,w=(u+h)/2,_=(l+f)/2,M=(h+p)/2,E=(f+d)/2,T=(x+w)/2,S=(b+_)/2,A=(w+M)/2,L=(_+E)/2,R=(T+A)/2,P=(S+L)/2;if(g>0){var C,O,D=p-n,I=d-a,N=Math.abs((u-p)*I-(l-d)*D),z=Math.abs((h-p)*I-(f-d)*D);if(N>i&&z>i){if((N+z)*(N+z)<=v*(D*D+I*I)){if(s<o)return void m.push(r(R,P));var k=Math.atan2(f-l,h-u);if(C=Math.abs(k-Math.atan2(l-a,u-n)),O=Math.abs(Math.atan2(d-f,p-h)-k),C>=y&&(C=2*y-C),O>=y&&(O=2*y-O),C+O<s)return void m.push(r(R,P));if(0!==c){if(C>c)return void m.push(r(u,l));if(O>c)return void m.push(r(h,f))}}}else if(N>i){if(N*N<=v*(D*D+I*I)){if(s<o)return void m.push(r(R,P));if((C=Math.abs(Math.atan2(f-l,h-u)-Math.atan2(l-a,u-n)))>=y&&(C=2*y-C),C<s)return m.push(r(u,l)),void m.push(r(h,f));if(0!==c&&C>c)return void m.push(r(u,l))}}else if(z>i){if(z*z<=v*(D*D+I*I)){if(s<o)return void m.push(r(R,P));if((C=Math.abs(Math.atan2(d-f,p-h)-Math.atan2(f-l,h-u)))>=y&&(C=2*y-C),C<s)return m.push(r(u,l)),void m.push(r(h,f));if(0!==c&&C>c)return void m.push(r(h,f))}}else if((D=R-(n+p)/2)*D+(I=P-(a+d)/2)*I<=v)return void m.push(r(R,P))}e(n,a,x,b,T,S,R,P,m,v,g+1),e(R,P,A,L,M,E,p,d,m,v,g+1)})(p,d,m,v,g,y,x,b,h,f,0),h.push(n(l))}(e,u,l,h,p,d*=d),p}}},function(e,t){var n=Math.PI,r=c(120);function i(e,t,n,r){return["C",e,t,n,r,n,r]}function a(e,t,n,r,i,a){return["C",e/3+2/3*n,t/3+2/3*r,i/3+2/3*n,a/3+2/3*r,i,a]}function o(e,t,i,a,c,u,l,h,f,p){if(p)M=p[0],E=p[1],w=p[2],_=p[3];else{var d=s(e,t,-c);e=d.x,t=d.y;var m=(e-(h=(d=s(h,f,-c)).x))/2,v=(t-(f=d.y))/2,g=m*m/(i*i)+v*v/(a*a);g>1&&(i*=g=Math.sqrt(g),a*=g);var y=i*i,x=a*a,b=(u==l?-1:1)*Math.sqrt(Math.abs((y*x-y*v*v-x*m*m)/(y*v*v+x*m*m)));b==1/0&&(b=1);var w=b*i*v/a+(e+h)/2,_=b*-a*m/i+(t+f)/2,M=Math.asin(((t-_)/a).toFixed(9)),E=Math.asin(((f-_)/a).toFixed(9));(M=e<w?n-M:M)<0&&(M=2*n+M),(E=h<w?n-E:E)<0&&(E=2*n+E),l&&M>E&&(M-=2*n),!l&&E>M&&(E-=2*n)}if(Math.abs(E-M)>r){var T=E,S=h,A=f;E=M+r*(l&&E>M?1:-1);var L=o(h=w+i*Math.cos(E),f=_+a*Math.sin(E),i,a,c,0,l,S,A,[E,T,w,_])}var R=Math.tan((E-M)/4),P=4/3*i*R,C=4/3*a*R,O=[2*e-(e+P*Math.sin(M)),2*t-(t-C*Math.cos(M)),h+P*Math.sin(E),f-C*Math.cos(E),h,f];if(p)return O;L&&(O=O.concat(L));for(var D=0;D<O.length;){var I=s(O[D],O[D+1],c);O[D++]=I.x,O[D++]=I.y}return O}function s(e,t,n){return{x:e*Math.cos(n)-t*Math.sin(n),y:e*Math.sin(n)+t*Math.cos(n)}}function c(e){return e*(n/180)}e.exports=function(e){for(var t,n=[],r=0,s=0,u=0,l=0,h=null,f=null,p=0,d=0,m=0,v=e.length;m<v;m++){var g=e[m],y=g[0];switch(y){case"M":u=g[1],l=g[2];break;case"A":(g=o(p,d,g[1],g[2],c(g[3]),g[4],g[5],g[6],g[7])).unshift("C"),g.length>7&&(n.push(g.splice(0,7)),g.unshift("C"));break;case"S":var x=p,b=d;"C"!=t&&"S"!=t||(x+=x-r,b+=b-s),g=["C",x,b,g[1],g[2],g[3],g[4]];break;case"T":"Q"==t||"T"==t?(h=2*p-h,f=2*d-f):(h=p,f=d),g=a(p,d,h,f,g[1],g[2]);break;case"Q":h=g[1],f=g[2],g=a(p,d,g[1],g[2],g[3],g[4]);break;case"L":g=i(p,d,g[1],g[2]);break;case"H":g=i(p,d,g[1],d);break;case"V":g=i(p,d,p,g[1]);break;case"Z":g=i(p,d,u,l)}t=y,p=g[g.length-2],d=g[g.length-1],g.length>4?(r=g[g.length-4],s=g[g.length-3]):(r=p,s=d),n.push(g)}return n}},function(e,t){e.exports=function(e,t){return e[0]=t[0],e[1]=t[1],e}},function(e,t){e.exports=function(e){var t=[];return e.replace(r,(function(e,r,a){var o=r.toLowerCase();for(a=function(e){var t=e.match(i);return t?t.map(Number):[]}(a),"m"==o&&a.length>2&&(t.push([r].concat(a.splice(0,2))),o="l",r="m"==r?"l":"L");;){if(a.length==n[o])return a.unshift(r),t.push(a);if(a.length<n[o])throw new Error("malformed path data");t.push([r].concat(a.splice(0,n[o])))}})),t};var n={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},r=/([astvzqmhlc])([^astvzqmhlc]*)/gi;var i=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/gi},function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var r=n(19);function i(e){for(var t,n=[],i=0,s=0,c=0,u=0,l=null,h=null,f=0,p=0,d=0,m=e.length;d<m;d++){var v=e[d],g=v[0];switch(g){case"M":c=v[1],u=v[2];break;case"A":var y=r({px:f,py:p,cx:v[6],cy:v[7],rx:v[1],ry:v[2],xAxisRotation:v[3],largeArcFlag:v[4],sweepFlag:v[5]});if(!y.length)continue;for(var x,b=0;b<y.length;b++)v=["C",(x=y[b]).x1,x.y1,x.x2,x.y2,x.x,x.y],b<y.length-1&&n.push(v);break;case"S":var w=f,_=p;"C"!=t&&"S"!=t||(w+=w-i,_+=_-s),v=["C",w,_,v[1],v[2],v[3],v[4]];break;case"T":"Q"==t||"T"==t?(l=2*f-l,h=2*p-h):(l=f,h=p),v=o(f,p,l,h,v[1],v[2]);break;case"Q":l=v[1],h=v[2],v=o(f,p,v[1],v[2],v[3],v[4]);break;case"L":v=a(f,p,v[1],v[2]);break;case"H":v=a(f,p,v[1],p);break;case"V":v=a(f,p,f,v[1]);break;case"Z":v=a(f,p,c,u)}t=g,f=v[v.length-2],p=v[v.length-1],v.length>4?(i=v[v.length-4],s=v[v.length-3]):(i=f,s=p),n.push(v)}return n}function a(e,t,n,r){return["C",e,t,n,r,n,r]}function o(e,t,n,r,i,a){return["C",e/3+2/3*n,t/3+2/3*r,i/3+2/3*n,a/3+2/3*r,i,a]}},function(e,t,n){var r=n(6),i=n(7).squaredDistance;function a(e,t,n){var r=Math.min(t,n),i=Math.max(t,n),a=(e=e.slice())[r],o=e[i],s=a.concat(o.slice(1));return e.splice(i,1),e.splice(r,1,s),e}e.exports.sort=function(e){if(!(e=r(e)).length)return e;var t=[];for(t.push(e[0]),e=e.slice(1);e.length;){var n=t[t.length-1],a=n[n.length-1],o=e.reduce((function(e,t,n){var r=t[0],o=t[t.length-1],s=i(a,r),c=i(a,o);return e?s<e.distance?{idx:n,distance:s,reverse:!1}:c<e.distance?{idx:n,distance:c,reverse:!0}:e:{idx:n,distance:Math.min(s,c),reverse:c<s}}),null),s=o.idx,c=o.reverse,u=e.splice(s,1)[0].slice();c&&u.reverse(),t.push(u)}return t},e.exports.merge=function(e,t){var n=(t=null!=t?t:.05)*t;e=r(e);for(var o=1;o<e.length;o++){var s=e[o-1],c=e[o];i(c[0],s[s.length-1])<n&&(e=a(e,o-1,o),o-=1)}return e}},function(e,t,n){"use strict";(function(e){var r=n(39),i=n(40),a=n(41);function o(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,n){if(!c.TYPED_ARRAY_SUPPORT&&!(this instanceof c))return new c(e,t,n);if("number"===typeof e){if("string"===typeof t)throw new Error("If encoding is specified then the first argument must be a string");return h(this,e)}return u(this,e,t,n)}function u(e,t,n,r){if("number"===typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!==typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=f(e,t);return e}(e,t,n,r):"string"===typeof t?function(e,t,n){"string"===typeof n&&""!==n||(n="utf8");if(!c.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|d(t,n),i=(e=s(e,r)).write(t,n);i!==r&&(e=e.slice(0,i));return e}(e,t,n):function(e,t){if(c.isBuffer(t)){var n=0|p(t.length);return 0===(e=s(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!==typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!==typeof t.length||(r=t.length)!==r?s(e,0):f(e,t);if("Buffer"===t.type&&a(t.data))return f(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!==typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function h(e,t){if(l(t),e=s(e,t<0?0:0|p(t)),!c.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function f(e,t){var n=t.length<0?0:0|p(t.length);e=s(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function p(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function d(e,t){if(c.isBuffer(e))return e.length;if("undefined"!==typeof ArrayBuffer&&"function"===typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!==typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return U(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return H(e).length;default:if(r)return U(e).length;t=(""+t).toLowerCase(),r=!0}}function m(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return R(this,t,n);case"utf8":case"utf-8":return S(this,t,n);case"ascii":return A(this,t,n);case"latin1":case"binary":return L(this,t,n);case"base64":return T(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function v(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function g(e,t,n,r,i){if(0===e.length)return-1;if("string"===typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"===typeof t&&(t=c.from(t,r)),c.isBuffer(t))return 0===t.length?-1:y(e,t,n,r,i);if("number"===typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"===typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):y(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function y(e,t,n,r,i){var a,o=1,s=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,s/=2,c/=2,n/=2}function u(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var l=-1;for(a=n;a<s;a++)if(u(e,a)===u(t,-1===l?0:a-l)){if(-1===l&&(l=a),a-l+1===c)return l*o}else-1!==l&&(a-=a-l),l=-1}else for(n+c>s&&(n=s-c),a=n;a>=0;a--){for(var h=!0,f=0;f<c;f++)if(u(e,a+f)!==u(t,f)){h=!1;break}if(h)return a}return-1}function x(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var a=t.length;if(a%2!==0)throw new TypeError("Invalid hex string");r>a/2&&(r=a/2);for(var o=0;o<r;++o){var s=parseInt(t.substr(2*o,2),16);if(isNaN(s))return o;e[n+o]=s}return o}function b(e,t,n,r){return G(U(t,e.length-n),e,n,r)}function w(e,t,n,r){return G(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function _(e,t,n,r){return w(e,t,n,r)}function M(e,t,n,r){return G(H(t),e,n,r)}function E(e,t,n,r){return G(function(e,t){for(var n,r,i,a=[],o=0;o<e.length&&!((t-=2)<0);++o)n=e.charCodeAt(o),r=n>>8,i=n%256,a.push(i),a.push(r);return a}(t,e.length-n),e,n,r)}function T(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function S(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var a,o,s,c,u=e[i],l=null,h=u>239?4:u>223?3:u>191?2:1;if(i+h<=n)switch(h){case 1:u<128&&(l=u);break;case 2:128===(192&(a=e[i+1]))&&(c=(31&u)<<6|63&a)>127&&(l=c);break;case 3:a=e[i+1],o=e[i+2],128===(192&a)&&128===(192&o)&&(c=(15&u)<<12|(63&a)<<6|63&o)>2047&&(c<55296||c>57343)&&(l=c);break;case 4:a=e[i+1],o=e[i+2],s=e[i+3],128===(192&a)&&128===(192&o)&&128===(192&s)&&(c=(15&u)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&c<1114112&&(l=c)}null===l?(l=65533,h=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),i+=h}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=4096));return n}(r)}t.Buffer=c,t.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"===typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(t){return!1}}(),t.kMaxLength=o(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,n){return u(null,e,t,n)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!==typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,n){return function(e,t,n,r){return l(t),t<=0?s(e,t):void 0!==n?"string"===typeof r?s(e,t).fill(n,r):s(e,t).fill(n):s(e,t)}(null,e,t,n)},c.allocUnsafe=function(e){return h(null,e)},c.allocUnsafeSlow=function(e){return h(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,a=Math.min(n,r);i<a;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!a(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=c.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var o=e[n];if(!c.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},c.byteLength=d,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)v(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)v(this,t,t+3),v(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)v(this,t,t+7),v(this,t+1,t+6),v(this,t+2,t+5),v(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?S(this,0,e):m.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,n,r,i){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var a=(i>>>=0)-(r>>>=0),o=(n>>>=0)-(t>>>=0),s=Math.min(a,o),u=this.slice(r,i),l=e.slice(t,n),h=0;h<s;++h)if(u[h]!==l[h]){a=u[h],o=l[h];break}return a<o?-1:o<a?1:0},c.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},c.prototype.indexOf=function(e,t,n){return g(this,e,t,n,!0)},c.prototype.lastIndexOf=function(e,t,n){return g(this,e,t,n,!1)},c.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"===typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var a=!1;;)switch(r){case"hex":return x(this,e,t,n);case"utf8":case"utf-8":return b(this,e,t,n);case"ascii":return w(this,e,t,n);case"latin1":case"binary":return _(this,e,t,n);case"base64":return M(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,e,t,n);default:if(a)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),a=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function A(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function L(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function R(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",a=t;a<n;++a)i+=B(e[a]);return i}function P(e,t,n){for(var r=e.slice(t,n),i="",a=0;a<r.length;a+=2)i+=String.fromCharCode(r[a]+256*r[a+1]);return i}function C(e,t,n){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function O(e,t,n,r,i,a){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function D(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,a=Math.min(e.length-n,2);i<a;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function I(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,a=Math.min(e.length-n,4);i<a;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function N(e,t,n,r,i,a){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function z(e,t,n,r,a){return a||N(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function k(e,t,n,r,a){return a||N(e,0,n,8),i.write(e,t,n,r,52,8),n+8}c.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=c.prototype;else{var i=t-e;n=new c(i,void 0);for(var a=0;a<i;++a)n[a]=this[a+e]}return n},c.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||C(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r},c.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||C(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},c.prototype.readUInt8=function(e,t){return t||C(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||C(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||C(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||C(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||C(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||C(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},c.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||C(e,t,this.length);for(var r=t,i=1,a=this[e+--r];r>0&&(i*=256);)a+=this[e+--r]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},c.prototype.readInt8=function(e,t){return t||C(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||C(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(e,t){t||C(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(e,t){return t||C(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||C(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||C(e,4,this.length),i.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||C(e,4,this.length),i.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||C(e,8,this.length),i.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||C(e,8,this.length),i.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||O(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,a=0;for(this[t]=255&e;++a<n&&(i*=256);)this[t+a]=e/i&255;return t+n},c.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||O(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+n},c.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):D(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):D(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):I(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):I(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);O(this,e,t,n,i-1,-i)}var a=0,o=1,s=0;for(this[t]=255&e;++a<n&&(o*=256);)e<0&&0===s&&0!==this[t+a-1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},c.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);O(this,e,t,n,i-1,-i)}var a=n-1,o=1,s=0;for(this[t+a]=255&e;--a>=0&&(o*=256);)e<0&&0===s&&0!==this[t+a+1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},c.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):D(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):D(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):I(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||O(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):I(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,n){return z(this,e,t,!0,n)},c.prototype.writeFloatBE=function(e,t,n){return z(this,e,t,!1,n)},c.prototype.writeDoubleLE=function(e,t,n){return k(this,e,t,!0,n)},c.prototype.writeDoubleBE=function(e,t,n){return k(this,e,t,!1,n)},c.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,a=r-n;if(this===e&&n<t&&t<r)for(i=a-1;i>=0;--i)e[i+t]=this[i+n];else if(a<1e3||!c.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+a),t);return a},c.prototype.fill=function(e,t,n,r){if("string"===typeof e){if("string"===typeof t?(r=t,t=0,n=this.length):"string"===typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!==typeof r)throw new TypeError("encoding must be a string");if("string"===typeof r&&!c.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"===typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var a;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"===typeof e)for(a=t;a<n;++a)this[a]=e;else{var o=c.isBuffer(e)?e:U(new c(e,r).toString()),s=o.length;for(a=0;a<n-t;++a)this[a+t]=o[a%s]}return this};var F=/[^+\/0-9A-Za-z-_]/g;function B(e){return e<16?"0"+e.toString(16):e.toString(16)}function U(e,t){var n;t=t||1/0;for(var r=e.length,i=null,a=[],o=0;o<r;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&a.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&a.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;a.push(n)}else if(n<2048){if((t-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function H(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(F,"")).length<2)return"";for(;e.length%4!==0;)e+="=";return e}(e))}function G(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(this,n(1))},function(e,t,n){"use strict";t.byteLength=function(e){var t=u(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,r=u(e),o=r[0],s=r[1],c=new a(function(e,t,n){return 3*(t+n)/4-n}(0,o,s)),l=0,h=s>0?o-4:o;for(n=0;n<h;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],c[l++]=t>>16&255,c[l++]=t>>8&255,c[l++]=255&t;2===s&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,c[l++]=255&t);1===s&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,c[l++]=t>>8&255,c[l++]=255&t);return c},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,a=[],o=0,s=n-i;o<s;o+=16383)a.push(l(e,o,o+16383>s?s:o+16383));1===i?(t=e[n-1],a.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],a.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return a.join("")};for(var r=[],i=[],a="undefined"!==typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,c=o.length;s<c;++s)r[s]=o[s],i[o.charCodeAt(s)]=s;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,n){for(var i,a,o=[],s=t;s<n;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(r[(a=i)>>18&63]+r[a>>12&63]+r[a>>6&63]+r[63&a]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,r,i){var a,o,s=8*i-r-1,c=(1<<s)-1,u=c>>1,l=-7,h=n?i-1:0,f=n?-1:1,p=e[t+h];for(h+=f,a=p&(1<<-l)-1,p>>=-l,l+=s;l>0;a=256*a+e[t+h],h+=f,l-=8);for(o=a&(1<<-l)-1,a>>=-l,l+=r;l>0;o=256*o+e[t+h],h+=f,l-=8);if(0===a)a=1-u;else{if(a===c)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,r),a-=u}return(p?-1:1)*o*Math.pow(2,a-r)},t.write=function(e,t,n,r,i,a){var o,s,c,u=8*a-i-1,l=(1<<u)-1,h=l>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:a-1,d=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),(t+=o+h>=1?f/c:f*Math.pow(2,1-h))*c>=2&&(o++,c/=2),o+h>=l?(s=0,o=l):o+h>=1?(s=(t*c-1)*Math.pow(2,i),o+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[n+p]=255&s,p+=d,s/=256,i-=8);for(o=o<<i|s,u+=i;u>0;e[n+p]=255&o,p+=d,o/=256,u-=8);e[n+p-d]|=128*m}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){"use strict";function r(e,t,n){var r,o,s,c,u,l=e.length,h=a(e[0],t),f=[];for(n||(n=[]),r=1;r<l;r++){for(o=e[r-1],c=u=a(s=e[r],t);;){if(!(h|c)){f.push(o),c!==u?(f.push(s),r<l-1&&(n.push(f),f=[])):r===l-1&&f.push(s);break}if(h&c)break;h?h=a(o=i(o,s,h,t),t):c=a(s=i(o,s,c,t),t)}h=u}return f.length&&n.push(f),n}function i(e,t,n,r){return 8&n?[e[0]+(t[0]-e[0])*(r[3]-e[1])/(t[1]-e[1]),r[3]]:4&n?[e[0]+(t[0]-e[0])*(r[1]-e[1])/(t[1]-e[1]),r[1]]:2&n?[r[2],e[1]+(t[1]-e[1])*(r[2]-e[0])/(t[0]-e[0])]:1&n?[r[0],e[1]+(t[1]-e[1])*(r[0]-e[0])/(t[0]-e[0])]:null}function a(e,t){var n=0;return e[0]<t[0]?n|=1:e[0]>t[2]&&(n|=2),e[1]<t[1]?n|=4:e[1]>t[3]&&(n|=8),n}e.exports=r,r.polyline=r,r.polygon=function(e,t){var n,r,o,s,c,u,l;for(r=1;r<=8;r*=2){for(n=[],o=e[e.length-1],s=!(a(o,t)&r),c=0;c<e.length;c++)u=e[c],(l=!(a(u,t)&r))!==s&&n.push(i(o,u,r,t)),l&&n.push(u),o=u,s=l;if(!(e=n).length)break}return n}},function(e,t,n){var r=n(44),i=n(45);e.exports=function(e,t,n,a){return!!(e&&t&&r(e)&&r(t))&&(e.length===t.length&&("number"!==typeof n&&(n=i.FLT_EPSILON),"number"!==typeof a&&(a=n),Array.prototype.slice.call(e).every((function(e,r){var o=t[r];return e===o||i(e,o,n,a)}))))}},function(e,t){var n=Object.prototype.toString;e.exports=function(e){return e.BYTES_PER_ELEMENT&&"[object ArrayBuffer]"===n.call(e.buffer)||Array.isArray(e)}},function(e,t,n){"use strict";var r=Math.abs,i=Math.min;function a(e,t,n,a){var o=r(e-t);return o<=n||(o<=a*i(r(e),r(t))||e===t)}a.FLT_EPSILON=1.1920929e-7,a.DBL_EPSILON=2220446049250313e-31,e.exports=a},function(e,t,n){var r=n(3);function i(e,t,n,r,i){return function(e,t,n,r){var i=n-e,a=r-t;return i*i+a*a}(e,t,n,r)<=i*i}function a(e,t,n,r){var i=e-n,a=t-r;return Math.sqrt(i*i+a*a)}function o(e,t,n,r,i){var o=i/a(e,t,n,r);return[e+o*(n-e),t+o*(r-t)]}e.exports=function(e,t,n,s,c){return function(e,t,n,s,c,u,l,h){null==h&&(h=[]);var f,p,d,m,v,g=i(e,t,c,u,l),y=i(n,s,c,u,l);if(g&&y)return h.push([e,t]),h.push([n,s]),!0;if(g||y){d=function(e,t,n,r,i,a){var o=n-e,s=r-t,c=(o*(i-e)+s*(a-t))/(o*o+s*s);return[e+c*o,t+c*s]}(e,t,n,s,c,u),m=d[0],v=d[1],f=a(m,v,c,u),p=Math.sqrt(l*l-f*f);var x=g?[e,t]:[n,s],b=g?o(m,v,n,s,p):o(m,v,e,t,p);return r(x[0],b[0])&&r(x[1],b[1])?(h.push(x),!0):(h.push(x),h.push(b),!0)}return d=function(e,t,n,r,i,a){var o=n-e,s=r-t,c=o*(i-e)+s*(a-t);if(c<=0)return[e,t];var u=o*o+s*s;if(u<=c)return[n,r];var l=c/u;return[e+l*o,t+l*s]}(e,t,n,s,c,u),m=d[0],v=d[1],!(r(e,m)&&r(t,v)||r(n,m)&&r(s,v))&&(!((f=a(m,v,c,u))>l)&&(r(f,l)?(h.push([m,v]),!0):r(f,0)?(h.push(o(c,u,e,t,l)),h.push(o(c,u,n,s,l)),!0):(p=Math.sqrt(l*l-f*f),h.push(o(m,v,e,t,p)),h.push(o(m,v,n,s,p)),!0)))}(e[0],e[1],t[0],t[1],n[0],n[1],s,c)}},function(e,t,n){var r=n(3);function i(e){return e*e}e.exports=function(e,t,n,a,o){null==o&&(o=[]);var s,c=i(t[0]-e[0])+i(t[1]-e[1]),u=2*((t[0]-e[0])*(e[0]-n[0])+(t[1]-e[1])*(e[1]-n[1])),l=i(n[0])+i(n[1])+i(e[0])+i(e[1])-2*(n[0]*e[0]+n[1]*e[1])-i(a),h=u*u-4*c*l;if(h<0)return!1;if(r(h,0))return s=-u/(2*c),o.push([e[0]+s*(t[0]-e[0]),e[1]+s*(t[1]-e[1])]),!0;if(h>0){var f=Math.sqrt(h);return s=(-u+f)/(2*c),o.push([e[0]+s*(t[0]-e[0]),e[1]+s*(t[1]-e[1])]),s=(-u-f)/(2*c),o.push([e[0]+s*(t[0]-e[0]),e[1]+s*(t[1]-e[1])]),!0}return null}},function(e,t,n){var r=n(49),i=n(50),a=n(51),o=n(0);function s(e){return e&&!Array.isArray(e)&&"object"===typeof e}e.exports=function(e){if(!(e=e||{}).gl)throw new Error('Must specify { context: "webgl" } in sketch settings, or a WebGL-enabled canvas');var t=e.gl,n={gl:t};"undefined"!==typeof e.extensions&&(n.extensions=e.extensions);"undefined"!==typeof e.optionalExtensions&&(n.optionalExtensions=e.optionalExtensions);"undefined"!==typeof e.profile&&(n.profile=e.profile);"undefined"!==typeof e.onDone&&(n.onDone=e.onDone);var c,u=r(n),l=i(),h=new Map,f=e.uniforms||{},p=Object.assign({},f);Object.keys(f).forEach((function(e){var t=f[e];"function"===typeof t?p[e]=function(e,n,r){var i=t.call(f,n,r);if(s(i))if(h.has(t)){var a=h.get(t);a(i),i=a}else{var o=u.texture(i);h.set(t,o),i=o}return i}:s(t)?p[e]=u.texture(t):p[e]=t}));try{c=u({scissor:!!e.scissor&&{enable:!0,box:{x:u.prop("scissorX"),y:u.prop("scissorY"),width:u.prop("scissorWidth"),height:u.prop("scissorHeight")}},uniforms:p,frag:e.frag||["precision highp float;","","void main () {","  gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","}"].join("\n"),vert:e.vert||["precision highp float;","attribute vec3 position;","varying vec2 vUv;","","void main () {","  gl_Position = vec4(position.xyz, 1.0);","  vUv = gl_Position.xy * 0.5 + 0.5;","}"].join("\n"),blend:!1!==e.blend?{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:1}}:void 0,attributes:{position:l.positions},elements:l.cells})}catch(b){x(b)}var d=o(e.clearColor,"black");if("string"===typeof d){var m=a(d);if(!m.rgb)throw new Error('Error parsing { clearColor } color string "'+d+'"');d=m.rgb.slice(0,3).map((function(e){return e/255}))}else if(d&&(!Array.isArray(d)||d.length<3))throw new Error("Error with { clearColor } option, must be a string or [ r, g, b ] float array");var v=o(e.clearAlpha,1),g=!!d&&d.concat([v||0]);return{render:function(e){u.poll(),g&&u.clear({color:g,depth:1,stencil:0}),y(e),t.flush()},regl:u,drawQuad:y,unload:function(){h.clear(),u.destroy()}};function y(e){if(e=e||{},c)try{c(e)}catch(b){x(b)&&null==e&&console.warn('Warning: shader.render() is not called with any "props" parameter')}}function x(e){if(/^\(regl\)/.test(e.message))return!0;throw e}}},function(e,t,n){e.exports=function(){"use strict";var e=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},t=function(e,t){for(var n=Object.keys(t),r=0;r<n.length;++r)e[n[r]]=t[n[r]];return e};function n(e){var t=new Error("(regl) "+e);throw console.error(t),t}function r(e,t){e||n(t)}function i(e){return e?": "+e:""}function a(e,t){switch(t){case"number":return"number"===typeof e;case"object":return"object"===typeof e;case"string":return"string"===typeof e;case"boolean":return"boolean"===typeof e;case"function":return"function"===typeof e;case"undefined":return"undefined"===typeof e;case"symbol":return"symbol"===typeof e}}function o(e,t,r){t.indexOf(e)<0&&n("invalid value"+i(r)+". must be one of: "+t)}var s=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function c(e,t){for(e+="";e.length<t;)e=" "+e;return e}function u(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function l(e,t){this.number=e,this.line=t,this.errors=[]}function h(e,t,n){this.file=e,this.line=t,this.message=n}function f(){var e=new Error,t=(e.stack||e).toString(),n=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(t);return r?r[1]:"unknown"}function p(){var e=new Error,t=(e.stack||e).toString(),n=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(t);return r?r[1]:"unknown"}function d(e,t){var n,r=e.split("\n"),i=1,a=0,o={unknown:new u,0:new u};o.unknown.name=o[0].name=t||f(),o.unknown.lines.push(new l(0,""));for(var s=0;s<r.length;++s){var c=r[s],h=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(c);if(h)switch(h[1]){case"line":var p=/(\d+)(\s+\d+)?/.exec(h[2]);p&&(i=0|p[1],p[2]&&((a=0|p[2])in o||(o[a]=new u)));break;case"define":var d=/SHADER_NAME(_B64)?\s+(.*)$/.exec(h[2]);d&&(o[a].name=d[1]?(n=d[2],"undefined"!==typeof atob?atob(n):"base64:"+n):d[2])}o[a].lines.push(new l(i++,c))}return Object.keys(o).forEach((function(e){var t=o[e];t.lines.forEach((function(e){t.index[e.number]=e}))})),o}function m(e){e._commandRef=f()}function v(e,t){var r=p();n(e+" in command "+(t||f())+("unknown"===r?"":" called from "+r))}function g(e,t,n,r){a(e,t)||v("invalid parameter type"+i(n)+". expected "+t+", got "+typeof e,r||f())}var y={};function x(e,t){return 32820===e||32819===e||33635===e?2:34042===e?4:y[e]*t}function b(e){return!(e&e-1)&&!!e}y[5120]=y[5121]=1,y[5122]=y[5123]=y[36193]=y[33635]=y[32819]=y[32820]=2,y[5124]=y[5125]=y[5126]=y[34042]=4;var w=t(r,{optional:function(e){e()},raise:n,commandRaise:v,command:function(e,t,n){e||v(t,n||f())},parameter:function(e,t,r){e in t||n("unknown parameter ("+e+")"+i(r)+". possible values: "+Object.keys(t).join())},commandParameter:function(e,t,n,r){e in t||v("unknown parameter ("+e+")"+i(n)+". possible values: "+Object.keys(t).join(),r||f())},constructor:function(e){Object.keys(e).forEach((function(e){s.indexOf(e)<0&&n('invalid regl constructor argument "'+e+'". must be one of '+s)}))},type:function(e,t,r){a(e,t)||n("invalid parameter type"+i(r)+". expected "+t+", got "+typeof e)},commandType:g,isTypedArray:function(t,r){e(t)||n("invalid parameter type"+i(r)+". must be a typed array")},nni:function(e,t){e>=0&&(0|e)===e||n("invalid parameter type, ("+e+")"+i(t)+". must be a nonnegative integer")},oneOf:o,shaderError:function(e,t,n,i,a){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){var o=e.getShaderInfoLog(t),s=i===e.FRAGMENT_SHADER?"fragment":"vertex";g(n,"string",s+" shader source must be a string",a);var u=d(n,a),l=function(e){var t=[];return e.split("\n").forEach((function(e){if(!(e.length<5)){var n=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(e);n?t.push(new h(0|n[1],0|n[2],n[3].trim())):e.length>0&&t.push(new h("unknown",0,e))}})),t}(o);!function(e,t){t.forEach((function(t){var n=e[t.file];if(n){var r=n.index[t.line];if(r)return r.errors.push(t),void(n.hasErrors=!0)}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(t)}))}(u,l),Object.keys(u).forEach((function(e){var t=u[e];if(t.hasErrors){var n=[""],r=[""];i("file number "+e+": "+t.name+"\n","color:red;text-decoration:underline;font-weight:bold"),t.lines.forEach((function(e){if(e.errors.length>0){i(c(e.number,4)+"|  ","background-color:yellow; font-weight:bold"),i(e.line+"\n","color:red; background-color:yellow; font-weight:bold");var t=0;e.errors.forEach((function(n){var r=n.message,a=/^\s*'(.*)'\s*:\s*(.*)$/.exec(r);if(a){var o=a[1];switch(r=a[2],o){case"assign":o="="}t=Math.max(e.line.indexOf(o,t),0)}else t=0;i(c("| ",6)),i(c("^^^",t+3)+"\n","font-weight:bold"),i(c("| ",6)),i(r+"\n","font-weight:bold")})),i(c("| ",6)+"\n")}else i(c(e.number,4)+"|  "),i(e.line+"\n","color:red")})),"undefined"===typeof document||window.chrome?console.log(n.join("")):(r[0]=n.join("%c"),console.log.apply(console,r))}function i(e,t){n.push(e),r.push(t||"")}})),r.raise("Error compiling "+s+" shader, "+u[0].name)}},linkError:function(e,t,n,i,a){if(!e.getProgramParameter(t,e.LINK_STATUS)){var o=e.getProgramInfoLog(t),s=d(n,a),c='Error linking program with vertex shader, "'+d(i,a)[0].name+'", and fragment shader "'+s[0].name+'"';"undefined"!==typeof document?console.log("%c"+c+"\n%c"+o,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(c+"\n"+o),r.raise(c)}},callSite:p,saveCommandRef:m,saveDrawInfo:function(e,t,n,r){function i(e){return e?r.id(e):0}function a(e,t){Object.keys(t).forEach((function(t){e[r.id(t)]=!0}))}m(e),e._fragId=i(e.static.frag),e._vertId=i(e.static.vert);var o=e._uniformSet={};a(o,t.static),a(o,t.dynamic);var s=e._attributeSet={};a(s,n.static),a(s,n.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic},framebufferFormat:function(e,t,n){e.texture?o(e.texture._texture.internalformat,t,"unsupported texture format for attachment"):o(e.renderbuffer._renderbuffer.format,n,"unsupported renderbuffer format for attachment")},guessCommand:f,texture2D:function(e,t,n){var i,a=t.width,o=t.height,s=t.channels;r(a>0&&a<=n.maxTextureSize&&o>0&&o<=n.maxTextureSize,"invalid texture shape"),33071===e.wrapS&&33071===e.wrapT||r(b(a)&&b(o),"incompatible wrap mode for texture, both width and height must be power of 2"),1===t.mipmask?1!==a&&1!==o&&r(9984!==e.minFilter&&9986!==e.minFilter&&9985!==e.minFilter&&9987!==e.minFilter,"min filter requires mipmap"):(r(b(a)&&b(o),"texture must be a square power of 2 to support mipmapping"),r(t.mipmask===(a<<1)-1,"missing or incomplete mipmap data")),5126===t.type&&(n.extensions.indexOf("oes_texture_float_linear")<0&&r(9728===e.minFilter&&9728===e.magFilter,"filter not supported, must enable oes_texture_float_linear"),r(!e.genMipmaps,"mipmap generation not supported with float textures"));var c=t.images;for(i=0;i<16;++i)if(c[i]){var u=a>>i,l=o>>i;r(t.mipmask&1<<i,"missing mipmap data");var h=c[i];if(r(h.width===u&&h.height===l,"invalid shape for mip images"),r(h.format===t.format&&h.internalformat===t.internalformat&&h.type===t.type,"incompatible type for mip image"),h.compressed);else if(h.data){var f=Math.ceil(x(h.type,s)*u/h.unpackAlignment)*h.unpackAlignment;r(h.data.byteLength===f*l,"invalid data for image, buffer size is inconsistent with image format")}else h.element||h.copy}else e.genMipmaps||r(0===(t.mipmask&1<<i),"extra mipmap data");t.compressed&&r(!e.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(e,t,n,i){var a=e.width,o=e.height,s=e.channels;r(a>0&&a<=i.maxTextureSize&&o>0&&o<=i.maxTextureSize,"invalid texture shape"),r(a===o,"cube map must be square"),r(33071===t.wrapS&&33071===t.wrapT,"wrap mode not supported by cube map");for(var c=0;c<n.length;++c){var u=n[c];r(u.width===a&&u.height===o,"inconsistent cube map face shape"),t.genMipmaps&&(r(!u.compressed,"can not generate mipmap for compressed textures"),r(1===u.mipmask,"can not specify mipmaps and generate mipmaps"));for(var l=u.images,h=0;h<16;++h){var f=l[h];if(f){var p=a>>h,d=o>>h;r(u.mipmask&1<<h,"missing mipmap data"),r(f.width===p&&f.height===d,"invalid shape for mip images"),r(f.format===e.format&&f.internalformat===e.internalformat&&f.type===e.type,"incompatible type for mip image"),f.compressed||(f.data?r(f.data.byteLength===p*d*Math.max(x(f.type,s),f.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):f.element||f.copy)}}}}}),_=0;function M(e,t){this.id=_++,this.type=e,this.data=t}function E(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function T(e){return"["+function e(t){if(0===t.length)return[];var n=t.charAt(0),r=t.charAt(t.length-1);if(t.length>1&&n===r&&('"'===n||"'"===n))return['"'+E(t.substr(1,t.length-2))+'"'];var i=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(t);if(i)return e(t.substr(0,i.index)).concat(e(i[1])).concat(e(t.substr(i.index+i[0].length)));var a=t.split(".");if(1===a.length)return['"'+E(t)+'"'];for(var o=[],s=0;s<a.length;++s)o=o.concat(e(a[s]));return o}(e).join("][")+"]"}var S={DynamicVariable:M,define:function(e,t){return new M(e,T(t+""))},isDynamic:function(e){return"function"===typeof e&&!e._reglType||e instanceof M},unbox:function e(t,n){return"function"===typeof t?new M(0,t):"number"===typeof t||"boolean"===typeof t?new M(5,t):Array.isArray(t)?new M(6,t.map((t,r)=>e(t,n+"["+r+"]"))):t instanceof M?t:void w(!1,"invalid option type in uniform "+n)},accessor:T},A={next:"function"===typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:"function"===typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout},L="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function R(e){return"string"===typeof e?e.split():(w(Array.isArray(e),"invalid extension array"),e)}function P(e){return"string"===typeof e?(w("undefined"!==typeof document,"not supported outside of DOM"),document.querySelector(e)):e}function C(e){var n,r,i,a,o,s=e||{},c={},u=[],l=[],h="undefined"===typeof window?1:window.devicePixelRatio,f=!1,p=function(e){e&&w.raise(e)},d=function(){};if("string"===typeof s?(w("undefined"!==typeof document,"selector queries only supported in DOM enviroments"),n=document.querySelector(s),w(n,"invalid query string for element")):"object"===typeof s?"string"===typeof(o=s).nodeName&&"function"===typeof o.appendChild&&"function"===typeof o.getBoundingClientRect?n=s:function(e){return"function"===typeof e.drawArrays||"function"===typeof e.drawElements}(s)?i=(a=s).canvas:(w.constructor(s),"gl"in s?a=s.gl:"canvas"in s?i=P(s.canvas):"container"in s&&(r=P(s.container)),"attributes"in s&&(c=s.attributes,w.type(c,"object","invalid context attributes")),"extensions"in s&&(u=R(s.extensions)),"optionalExtensions"in s&&(l=R(s.optionalExtensions)),"onDone"in s&&(w.type(s.onDone,"function","invalid or missing onDone callback"),p=s.onDone),"profile"in s&&(f=!!s.profile),"pixelRatio"in s&&(h=+s.pixelRatio,w(h>0,"invalid pixel ratio"))):w.raise("invalid arguments to regl"),n&&("canvas"===n.nodeName.toLowerCase()?i=n:r=n),!a){if(!i){w("undefined"!==typeof document,"must manually specify webgl context outside of DOM environments");var m=function(e,n,r){var i,a=document.createElement("canvas");function o(){var n=window.innerWidth,i=window.innerHeight;if(e!==document.body){var o=e.getBoundingClientRect();n=o.right-o.left,i=o.bottom-o.top}a.width=r*n,a.height=r*i,t(a.style,{width:n+"px",height:i+"px"})}return t(a.style,{border:0,margin:0,padding:0,top:0,left:0}),e.appendChild(a),e===document.body&&(a.style.position="absolute",t(e.style,{margin:0,padding:0})),e!==document.body&&"function"===typeof ResizeObserver?(i=new ResizeObserver((function(){setTimeout(o)}))).observe(e):window.addEventListener("resize",o,!1),o(),{canvas:a,onDestroy:function(){i?i.disconnect():window.removeEventListener("resize",o),e.removeChild(a)}}}(r||document.body,0,h);if(!m)return null;i=m.canvas,d=m.onDestroy}void 0===c.premultipliedAlpha&&(c.premultipliedAlpha=!0),a=function(e,t){function n(n){try{return e.getContext(n,t)}catch(r){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}(i,c)}return a?{gl:a,canvas:i,container:r,extensions:u,optionalExtensions:l,pixelRatio:h,profile:f,onDone:p,onDestroy:d}:(d(),p("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function O(e,t){for(var n=Array(e),r=0;r<e;++r)n[r]=t(r);return n}function D(e){var t,n;return t=(e>65535)<<4,t|=n=((e>>>=t)>255)<<3,t|=n=((e>>>=n)>15)<<2,(t|=n=((e>>>=n)>3)<<1)|(e>>>=n)>>1}function I(){var e=O(8,(function(){return[]}));function t(t){var n=function(e){for(var t=16;t<=1<<28;t*=16)if(e<=t)return t;return 0}(t),r=e[D(n)>>2];return r.length>0?r.pop():new ArrayBuffer(n)}function n(t){e[D(t.byteLength)>>2].push(t)}return{alloc:t,free:n,allocType:function(e,n){var r=null;switch(e){case 5120:r=new Int8Array(t(n),0,n);break;case 5121:r=new Uint8Array(t(n),0,n);break;case 5122:r=new Int16Array(t(2*n),0,n);break;case 5123:r=new Uint16Array(t(2*n),0,n);break;case 5124:r=new Int32Array(t(4*n),0,n);break;case 5125:r=new Uint32Array(t(4*n),0,n);break;case 5126:r=new Float32Array(t(4*n),0,n);break;default:return null}return r.length!==n?r.subarray(0,n):r},freeType:function(e){n(e.buffer)}}}var N=I();function z(t){return!!t&&"object"===typeof t&&Array.isArray(t.shape)&&Array.isArray(t.stride)&&"number"===typeof t.offset&&t.shape.length===t.stride.length&&(Array.isArray(t.data)||e(t.data))}N.zero=I();var k=function(e){return Object.keys(e).map((function(t){return e[t]}))},F={shape:function(e){for(var t=[],n=e;n.length;n=n[0])t.push(n.length);return t},flatten:function(e,t,n,r){var i=1;if(t.length)for(var a=0;a<t.length;++a)i*=t[a];else i=0;var o=r||N.allocType(n,i);switch(t.length){case 0:break;case 1:!function(e,t,n){for(var r=0;r<t;++r)n[r]=e[r]}(e,t[0],o);break;case 2:!function(e,t,n,r){for(var i=0,a=0;a<t;++a)for(var o=e[a],s=0;s<n;++s)r[i++]=o[s]}(e,t[0],t[1],o);break;case 3:B(e,t[0],t[1],t[2],o,0);break;default:!function e(t,n,r,i,a){for(var o=1,s=r+1;s<n.length;++s)o*=n[s];var c=n[r];if(n.length-r===4){var u=n[r+1],l=n[r+2],h=n[r+3];for(s=0;s<c;++s)B(t[s],u,l,h,i,a),a+=o}else for(s=0;s<c;++s)e(t[s],n,r+1,i,a),a+=o}(e,t,0,o,0)}return o}};function B(e,t,n,r,i,a){for(var o=a,s=0;s<t;++s)for(var c=e[s],u=0;u<n;++u)for(var l=c[u],h=0;h<r;++h)i[o++]=l[h]}var U={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},H={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},G={dynamic:35048,stream:35040,static:35044},j=F.flatten,V=F.shape,W=[];function q(e){return 0|U[Object.prototype.toString.call(e)]}function Y(e,t){for(var n=0;n<t.length;++n)e[n]=t[n]}function X(e,t,n,r,i,a,o){for(var s=0,c=0;c<n;++c)for(var u=0;u<r;++u)e[s++]=t[i*c+a*u+o]}W[5120]=1,W[5122]=2,W[5124]=4,W[5121]=1,W[5123]=2,W[5125]=4,W[5126]=4;var Z={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},J=new Float32Array(1),Q=new Uint32Array(J.buffer);function K(e){for(var t=N.allocType(5123,e.length),n=0;n<e.length;++n)if(isNaN(e[n]))t[n]=65535;else if(e[n]===1/0)t[n]=31744;else if(e[n]===-1/0)t[n]=64512;else{J[0]=e[n];var r=Q[0],i=r>>>31<<15,a=(r<<1>>>24)-127,o=r>>13&1023;if(a<-24)t[n]=i;else if(a<-14){var s=-14-a;t[n]=i+(o+1024>>s)}else t[n]=a>15?i+31744:i+(a+15<<10)+o}return t}function $(t){return Array.isArray(t)||e(t)}var ee=function(e){return!(e&e-1)&&!!e},te=[9984,9986,9985,9987],ne=[0,6409,6410,6407,6408],re={};function ie(e){return"[object "+e+"]"}re[6409]=re[6406]=re[6402]=1,re[34041]=re[6410]=2,re[6407]=re[35904]=3,re[6408]=re[35906]=4;var ae=ie("HTMLCanvasElement"),oe=ie("OffscreenCanvas"),se=ie("CanvasRenderingContext2D"),ce=ie("ImageBitmap"),ue=ie("HTMLImageElement"),le=ie("HTMLVideoElement"),he=Object.keys(U).concat([ae,oe,se,ce,ue,le]),fe=[];fe[5121]=1,fe[5126]=4,fe[36193]=2,fe[5123]=2,fe[5125]=4;var pe=[];function de(e){return Array.isArray(e)&&(0===e.length||"number"===typeof e[0])}function me(e){return!!Array.isArray(e)&&!(0===e.length||!$(e[0]))}function ve(e){return Object.prototype.toString.call(e)}function ge(e){return ve(e)===ae}function ye(e){return ve(e)===oe}function xe(e){if(!e)return!1;var t=ve(e);return he.indexOf(t)>=0||de(e)||me(e)||z(e)}function be(e){return 0|U[Object.prototype.toString.call(e)]}function we(e,t){return N.allocType(36193===e.type?5126:e.type,t)}function _e(e,t){36193===e.type?(e.data=K(t),N.freeType(t)):e.data=t}function Me(e,t,n,r,i,a){var o;if(o="undefined"!==typeof pe[e]?pe[e]:re[e]*fe[t],a&&(o*=6),i){for(var s=0,c=n;c>=1;)s+=o*c*c,c/=2;return s}return o*n*r}function Ee(n,r,i,a,o,s,c){var u={"don't care":4352,"dont care":4352,nice:4354,fast:4353},l={repeat:10497,clamp:33071,mirror:33648},h={nearest:9728,linear:9729},f=t({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987},h),p={none:0,browser:37444},d={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},m={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},v={};r.ext_srgb&&(m.srgb=35904,m.srgba=35906),r.oes_texture_float&&(d.float32=d.float=5126),r.oes_texture_half_float&&(d.float16=d["half float"]=36193),r.webgl_depth_texture&&(t(m,{depth:6402,"depth stencil":34041}),t(d,{uint16:5123,uint32:5125,"depth stencil":34042})),r.webgl_compressed_texture_s3tc&&t(v,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779}),r.webgl_compressed_texture_atc&&t(v,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798}),r.webgl_compressed_texture_pvrtc&&t(v,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843}),r.webgl_compressed_texture_etc1&&(v["rgb etc1"]=36196);var g=Array.prototype.slice.call(n.getParameter(34467));Object.keys(v).forEach((function(e){var t=v[e];g.indexOf(t)>=0&&(m[e]=t)}));var y=Object.keys(m);i.textureFormats=y;var x=[];Object.keys(m).forEach((function(e){var t=m[e];x[t]=e}));var b=[];Object.keys(d).forEach((function(e){var t=d[e];b[t]=e}));var _=[];Object.keys(h).forEach((function(e){_[h[e]]=e}));var M=[];Object.keys(f).forEach((function(e){var t=f[e];M[t]=e}));var E=[];Object.keys(l).forEach((function(e){E[l[e]]=e}));var T=y.reduce((function(e,t){var n=m[t];return 6409===n||6406===n||6409===n||6410===n||6402===n||34041===n||r.ext_srgb&&(35904===n||35906===n)?e[n]=n:32855===n||t.indexOf("rgba")>=0?e[n]=6408:e[n]=6407,e}),{});function S(){this.internalformat=6408,this.format=6408,this.type=5121,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=37444,this.width=0,this.height=0,this.channels=0}function A(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function L(e,t){if("object"===typeof t&&t){if("premultiplyAlpha"in t&&(w.type(t.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),e.premultiplyAlpha=t.premultiplyAlpha),"flipY"in t&&(w.type(t.flipY,"boolean","invalid texture flip"),e.flipY=t.flipY),"alignment"in t&&(w.oneOf(t.alignment,[1,2,4,8],"invalid texture unpack alignment"),e.unpackAlignment=t.alignment),"colorSpace"in t&&(w.parameter(t.colorSpace,p,"invalid colorSpace"),e.colorSpace=p[t.colorSpace]),"type"in t){var n=t.type;w(r.oes_texture_float||!("float"===n||"float32"===n),"you must enable the OES_texture_float extension in order to use floating point textures."),w(r.oes_texture_half_float||!("half float"===n||"float16"===n),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),w(r.webgl_depth_texture||!("uint16"===n||"uint32"===n||"depth stencil"===n),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),w.parameter(n,d,"invalid texture type"),e.type=d[n]}var a=e.width,o=e.height,s=e.channels,c=!1;"shape"in t?(w(Array.isArray(t.shape)&&t.shape.length>=2,"shape must be an array"),a=t.shape[0],o=t.shape[1],3===t.shape.length&&(s=t.shape[2],w(s>0&&s<=4,"invalid number of channels"),c=!0),w(a>=0&&a<=i.maxTextureSize,"invalid width"),w(o>=0&&o<=i.maxTextureSize,"invalid height")):("radius"in t&&(a=o=t.radius,w(a>=0&&a<=i.maxTextureSize,"invalid radius")),"width"in t&&(a=t.width,w(a>=0&&a<=i.maxTextureSize,"invalid width")),"height"in t&&(o=t.height,w(o>=0&&o<=i.maxTextureSize,"invalid height")),"channels"in t&&(s=t.channels,w(s>0&&s<=4,"invalid number of channels"),c=!0)),e.width=0|a,e.height=0|o,e.channels=0|s;var u=!1;if("format"in t){var l=t.format;w(r.webgl_depth_texture||!("depth"===l||"depth stencil"===l),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),w.parameter(l,m,"invalid texture format");var h=e.internalformat=m[l];e.format=T[h],l in d&&("type"in t||(e.type=d[l])),l in v&&(e.compressed=!0),u=!0}!c&&u?e.channels=re[e.format]:c&&!u?e.channels!==ne[e.format]&&(e.format=e.internalformat=ne[e.channels]):u&&c&&w(e.channels===re[e.format],"number of channels inconsistent with specified format")}}function R(e){n.pixelStorei(37440,e.flipY),n.pixelStorei(37441,e.premultiplyAlpha),n.pixelStorei(37443,e.colorSpace),n.pixelStorei(3317,e.unpackAlignment)}function P(){S.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function C(t,n){var r=null;if(xe(n)?r=n:n&&(w.type(n,"object","invalid pixel data type"),L(t,n),"x"in n&&(t.xOffset=0|n.x),"y"in n&&(t.yOffset=0|n.y),xe(n.data)&&(r=n.data)),w(!t.compressed||r instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),n.copy){w(!r,"can not specify copy and data field for the same texture");var a=o.viewportWidth,s=o.viewportHeight;t.width=t.width||a-t.xOffset,t.height=t.height||s-t.yOffset,t.needsCopy=!0,w(t.xOffset>=0&&t.xOffset<a&&t.yOffset>=0&&t.yOffset<s&&t.width>0&&t.width<=a&&t.height>0&&t.height<=s,"copy texture read out of bounds")}else if(r){if(e(r))t.channels=t.channels||4,t.data=r,"type"in n||5121!==t.type||(t.type=be(r));else if(de(r))t.channels=t.channels||4,function(e,t){var n=t.length;switch(e.type){case 5121:case 5123:case 5125:case 5126:var r=N.allocType(e.type,n);r.set(t),e.data=r;break;case 36193:e.data=K(t);break;default:w.raise("unsupported texture type, must specify a typed array")}}(t,r),t.alignment=1,t.needsFree=!0;else if(z(r)){var c=r.data;Array.isArray(c)||5121!==t.type||(t.type=be(c));var u,l,h,f,p,d,m=r.shape,v=r.stride;3===m.length?(h=m[2],d=v[2]):(w(2===m.length,"invalid ndarray pixel data, must be 2 or 3D"),h=1,d=1),u=m[0],l=m[1],f=v[0],p=v[1],t.alignment=1,t.width=u,t.height=l,t.channels=h,t.format=t.internalformat=ne[h],t.needsFree=!0,function(e,t,n,r,i,a){for(var o=e.width,s=e.height,c=e.channels,u=we(e,o*s*c),l=0,h=0;h<s;++h)for(var f=0;f<o;++f)for(var p=0;p<c;++p)u[l++]=t[n*f+r*h+i*p+a];_e(e,u)}(t,c,f,p,d,r.offset)}else if(ge(r)||ye(r)||ve(r)===se)ge(r)||ye(r)?t.element=r:t.element=r.canvas,t.width=t.element.width,t.height=t.element.height,t.channels=4;else if(function(e){return ve(e)===ce}(r))t.element=r,t.width=r.width,t.height=r.height,t.channels=4;else if(function(e){return ve(e)===ue}(r))t.element=r,t.width=r.naturalWidth,t.height=r.naturalHeight,t.channels=4;else if(function(e){return ve(e)===le}(r))t.element=r,t.width=r.videoWidth,t.height=r.videoHeight,t.channels=4;else if(me(r)){var g=t.width||r[0].length,y=t.height||r.length,x=t.channels;x=$(r[0][0])?x||r[0][0].length:x||1;for(var b=F.shape(r),_=1,M=0;M<b.length;++M)_*=b[M];var E=we(t,_);F.flatten(r,b,"",E),_e(t,E),t.alignment=1,t.width=g,t.height=y,t.channels=x,t.format=t.internalformat=ne[x],t.needsFree=!0}}else t.width=t.width||1,t.height=t.height||1,t.channels=t.channels||4;5126===t.type?w(i.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):36193===t.type&&w(i.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function O(e,t,r){var i=e.element,o=e.data,s=e.internalformat,c=e.format,u=e.type,l=e.width,h=e.height;R(e),i?n.texImage2D(t,r,c,c,u,i):e.compressed?n.compressedTexImage2D(t,r,s,l,h,0,o):e.needsCopy?(a(),n.copyTexImage2D(t,r,c,e.xOffset,e.yOffset,l,h,0)):n.texImage2D(t,r,c,l,h,0,c,u,o||null)}function D(e,t,r,i,o){var s=e.element,c=e.data,u=e.internalformat,l=e.format,h=e.type,f=e.width,p=e.height;R(e),s?n.texSubImage2D(t,o,r,i,l,h,s):e.compressed?n.compressedTexSubImage2D(t,o,r,i,u,f,p,c):e.needsCopy?(a(),n.copyTexSubImage2D(t,o,r,i,e.xOffset,e.yOffset,f,p)):n.texSubImage2D(t,o,r,i,f,p,l,h,c)}var I=[];function B(){return I.pop()||new P}function U(e){e.needsFree&&N.freeType(e.data),P.call(e),I.push(e)}function H(){S.call(this),this.genMipmaps=!1,this.mipmapHint=4352,this.mipmask=0,this.images=Array(16)}function G(e,t,n){var r=e.images[0]=B();e.mipmask=1,r.width=e.width=t,r.height=e.height=n,r.channels=e.channels=4}function j(e,t){var n=null;if(xe(t))A(n=e.images[0]=B(),e),C(n,t),e.mipmask=1;else if(L(e,t),Array.isArray(t.mipmap))for(var r=t.mipmap,i=0;i<r.length;++i)A(n=e.images[i]=B(),e),n.width>>=i,n.height>>=i,C(n,r[i]),e.mipmask|=1<<i;else A(n=e.images[0]=B(),e),C(n,t),e.mipmask=1;A(e,e.images[0]),!e.compressed||33776!==e.internalformat&&33777!==e.internalformat&&33778!==e.internalformat&&33779!==e.internalformat||w(e.width%4===0&&e.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function V(e,t){for(var n=e.images,r=0;r<n.length;++r){if(!n[r])return;O(n[r],t,r)}}var W=[];function q(){var e=W.pop()||new H;S.call(e),e.mipmask=0;for(var t=0;t<16;++t)e.images[t]=null;return e}function Y(e){for(var t=e.images,n=0;n<t.length;++n)t[n]&&U(t[n]),t[n]=null;W.push(e)}function X(){this.minFilter=9728,this.magFilter=9728,this.wrapS=33071,this.wrapT=33071,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=4352}function Z(e,t){if("min"in t){var n=t.min;w.parameter(n,f),e.minFilter=f[n],te.indexOf(e.minFilter)>=0&&!("faces"in t)&&(e.genMipmaps=!0)}if("mag"in t){var r=t.mag;w.parameter(r,h),e.magFilter=h[r]}var a=e.wrapS,o=e.wrapT;if("wrap"in t){var s=t.wrap;"string"===typeof s?(w.parameter(s,l),a=o=l[s]):Array.isArray(s)&&(w.parameter(s[0],l),w.parameter(s[1],l),a=l[s[0]],o=l[s[1]])}else{if("wrapS"in t){var c=t.wrapS;w.parameter(c,l),a=l[c]}if("wrapT"in t){var p=t.wrapT;w.parameter(p,l),o=l[p]}}if(e.wrapS=a,e.wrapT=o,"anisotropic"in t){var d=t.anisotropic;w("number"===typeof d&&d>=1&&d<=i.maxAnisotropic,"aniso samples must be between 1 and "),e.anisotropic=t.anisotropic}if("mipmap"in t){var m=!1;switch(typeof t.mipmap){case"string":w.parameter(t.mipmap,u,"invalid mipmap hint"),e.mipmapHint=u[t.mipmap],e.genMipmaps=!0,m=!0;break;case"boolean":m=e.genMipmaps=t.mipmap;break;case"object":w(Array.isArray(t.mipmap),"invalid mipmap type"),e.genMipmaps=!1,m=!0;break;default:w.raise("invalid mipmap type")}m&&!("min"in t)&&(e.minFilter=9984)}}function J(e,t){n.texParameteri(t,10241,e.minFilter),n.texParameteri(t,10240,e.magFilter),n.texParameteri(t,10242,e.wrapS),n.texParameteri(t,10243,e.wrapT),r.ext_texture_filter_anisotropic&&n.texParameteri(t,34046,e.anisotropic),e.genMipmaps&&(n.hint(33170,e.mipmapHint),n.generateMipmap(t))}var Q=0,ie={},ae=i.maxTextureUnits,oe=Array(ae).map((function(){return null}));function he(e){S.call(this),this.mipmask=0,this.internalformat=6408,this.id=Q++,this.refCount=1,this.target=e,this.texture=n.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new X,c.profile&&(this.stats={size:0})}function fe(e){n.activeTexture(33984),n.bindTexture(e.target,e.texture)}function pe(){var e=oe[0];e?n.bindTexture(e.target,e.texture):n.bindTexture(3553,null)}function Ee(e){var t=e.texture;w(t,"must not double destroy texture");var r=e.unit,i=e.target;r>=0&&(n.activeTexture(33984+r),n.bindTexture(i,null),oe[r]=null),n.deleteTexture(t),e.texture=null,e.params=null,e.pixels=null,e.refCount=0,delete ie[e.id],s.textureCount--}return t(he.prototype,{bind:function(){this.bindCount+=1;var e=this.unit;if(e<0){for(var t=0;t<ae;++t){var r=oe[t];if(r){if(r.bindCount>0)continue;r.unit=-1}oe[t]=this,e=t;break}e>=ae&&w.raise("insufficient number of texture units"),c.profile&&s.maxTextureUnits<e+1&&(s.maxTextureUnits=e+1),this.unit=e,n.activeTexture(33984+e),n.bindTexture(this.target,this.texture)}return e},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Ee(this)}}),c.profile&&(s.getTotalTextureSize=function(){var e=0;return Object.keys(ie).forEach((function(t){e+=ie[t].stats.size})),e}),{create2D:function(e,t){var r=new he(3553);function a(e,t){var n=r.texInfo;X.call(n);var o=q();return"number"===typeof e?G(o,0|e,"number"===typeof t?0|t:0|e):e?(w.type(e,"object","invalid arguments to regl.texture"),Z(n,e),j(o,e)):G(o,1,1),n.genMipmaps&&(o.mipmask=(o.width<<1)-1),r.mipmask=o.mipmask,A(r,o),w.texture2D(n,o,i),r.internalformat=o.internalformat,a.width=o.width,a.height=o.height,fe(r),V(o,3553),J(n,3553),pe(),Y(o),c.profile&&(r.stats.size=Me(r.internalformat,r.type,o.width,o.height,n.genMipmaps,!1)),a.format=x[r.internalformat],a.type=b[r.type],a.mag=_[n.magFilter],a.min=M[n.minFilter],a.wrapS=E[n.wrapS],a.wrapT=E[n.wrapT],a}return ie[r.id]=r,s.textureCount++,a(e,t),a.subimage=function(e,t,n,i){w(!!e,"must specify image data");var o=0|t,s=0|n,c=0|i,u=B();return A(u,r),u.width=0,u.height=0,C(u,e),u.width=u.width||(r.width>>c)-o,u.height=u.height||(r.height>>c)-s,w(r.type===u.type&&r.format===u.format&&r.internalformat===u.internalformat,"incompatible format for texture.subimage"),w(o>=0&&s>=0&&o+u.width<=r.width&&s+u.height<=r.height,"texture.subimage write out of bounds"),w(r.mipmask&1<<c,"missing mipmap data"),w(u.data||u.element||u.needsCopy,"missing image data"),fe(r),D(u,3553,o,s,c),pe(),U(u),a},a.resize=function(e,t){var i=0|e,o=0|t||i;if(i===r.width&&o===r.height)return a;a.width=r.width=i,a.height=r.height=o,fe(r);for(var s=0;r.mipmask>>s;++s){var u=i>>s,l=o>>s;if(!u||!l)break;n.texImage2D(3553,s,r.format,u,l,0,r.format,r.type,null)}return pe(),c.profile&&(r.stats.size=Me(r.internalformat,r.type,i,o,!1,!1)),a},a._reglType="texture2d",a._texture=r,c.profile&&(a.stats=r.stats),a.destroy=function(){r.decRef()},a},createCube:function(e,t,r,a,o,u){var l=new he(34067);ie[l.id]=l,s.cubeCount++;var h=new Array(6);function f(e,t,n,r,a,o){var s,u=l.texInfo;for(X.call(u),s=0;s<6;++s)h[s]=q();if("number"!==typeof e&&e)if("object"===typeof e)if(t)j(h[0],e),j(h[1],t),j(h[2],n),j(h[3],r),j(h[4],a),j(h[5],o);else if(Z(u,e),L(l,e),"faces"in e){var p=e.faces;for(w(Array.isArray(p)&&6===p.length,"cube faces must be a length 6 array"),s=0;s<6;++s)w("object"===typeof p[s]&&!!p[s],"invalid input for cube map face"),A(h[s],l),j(h[s],p[s])}else for(s=0;s<6;++s)j(h[s],e);else w.raise("invalid arguments to cube map");else{var d=0|e||1;for(s=0;s<6;++s)G(h[s],d,d)}for(A(l,h[0]),i.npotTextureCube||w(ee(l.width)&&ee(l.height),"your browser does not support non power or two texture dimensions"),u.genMipmaps?l.mipmask=(h[0].width<<1)-1:l.mipmask=h[0].mipmask,w.textureCube(l,u,h,i),l.internalformat=h[0].internalformat,f.width=h[0].width,f.height=h[0].height,fe(l),s=0;s<6;++s)V(h[s],34069+s);for(J(u,34067),pe(),c.profile&&(l.stats.size=Me(l.internalformat,l.type,f.width,f.height,u.genMipmaps,!0)),f.format=x[l.internalformat],f.type=b[l.type],f.mag=_[u.magFilter],f.min=M[u.minFilter],f.wrapS=E[u.wrapS],f.wrapT=E[u.wrapT],s=0;s<6;++s)Y(h[s]);return f}return f(e,t,r,a,o,u),f.subimage=function(e,t,n,r,i){w(!!t,"must specify image data"),w("number"===typeof e&&e===(0|e)&&e>=0&&e<6,"invalid face");var a=0|n,o=0|r,s=0|i,c=B();return A(c,l),c.width=0,c.height=0,C(c,t),c.width=c.width||(l.width>>s)-a,c.height=c.height||(l.height>>s)-o,w(l.type===c.type&&l.format===c.format&&l.internalformat===c.internalformat,"incompatible format for texture.subimage"),w(a>=0&&o>=0&&a+c.width<=l.width&&o+c.height<=l.height,"texture.subimage write out of bounds"),w(l.mipmask&1<<s,"missing mipmap data"),w(c.data||c.element||c.needsCopy,"missing image data"),fe(l),D(c,34069+e,a,o,s),pe(),U(c),f},f.resize=function(e){var t=0|e;if(t!==l.width){f.width=l.width=t,f.height=l.height=t,fe(l);for(var r=0;r<6;++r)for(var i=0;l.mipmask>>i;++i)n.texImage2D(34069+r,i,l.format,t>>i,t>>i,0,l.format,l.type,null);return pe(),c.profile&&(l.stats.size=Me(l.internalformat,l.type,f.width,f.height,!1,!0)),f}},f._reglType="textureCube",f._texture=l,c.profile&&(f.stats=l.stats),f.destroy=function(){l.decRef()},f},clear:function(){for(var e=0;e<ae;++e)n.activeTexture(33984+e),n.bindTexture(3553,null),oe[e]=null;k(ie).forEach(Ee),s.cubeCount=0,s.textureCount=0},getTexture:function(e){return null},restore:function(){for(var e=0;e<ae;++e){var t=oe[e];t&&(t.bindCount=0,t.unit=-1,oe[e]=null)}k(ie).forEach((function(e){e.texture=n.createTexture(),n.bindTexture(e.target,e.texture);for(var t=0;t<32;++t)if(0!==(e.mipmask&1<<t))if(3553===e.target)n.texImage2D(3553,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);else for(var r=0;r<6;++r)n.texImage2D(34069+r,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);J(e.texInfo,e.target)}))},refresh:function(){for(var e=0;e<ae;++e){var t=oe[e];t&&(t.bindCount=0,t.unit=-1,oe[e]=null),n.activeTexture(33984+e),n.bindTexture(3553,null),n.bindTexture(34067,null)}}}}pe[32854]=2,pe[32855]=2,pe[36194]=2,pe[34041]=4,pe[33776]=.5,pe[33777]=.5,pe[33778]=1,pe[33779]=1,pe[35986]=.5,pe[35987]=1,pe[34798]=1,pe[35840]=.5,pe[35841]=.25,pe[35842]=.5,pe[35843]=.25,pe[36196]=.5;var Te=[];function Se(e,t,n){return Te[e]*t*n}Te[32854]=2,Te[32855]=2,Te[36194]=2,Te[33189]=2,Te[36168]=1,Te[34041]=4,Te[35907]=4,Te[34836]=16,Te[34842]=8,Te[34843]=6;var Ae=[6407,6408],Le=[];Le[6408]=4,Le[6407]=3;var Re=[];Re[5121]=1,Re[5126]=4,Re[36193]=2;var Pe=[32854,32855,36194,35907,34842,34843,34836],Ce={};function Oe(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=5126,this.offset=0,this.stride=0,this.divisor=0}function De(t,n,r,i,a,o,s){function c(c){var u;null===n.next?(w(a.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),u=5121):(w(null!==n.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),u=n.next.colorAttachments[0].texture._texture.type,o.oes_texture_float?(w(5121===u||5126===u,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),5126===u&&w(s.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):w(5121===u,"Reading from a framebuffer is only allowed for the type 'uint8'"));var l=0,h=0,f=i.framebufferWidth,p=i.framebufferHeight,d=null;e(c)?d=c:c&&(w.type(c,"object","invalid arguments to regl.read()"),l=0|c.x,h=0|c.y,w(l>=0&&l<i.framebufferWidth,"invalid x offset for regl.read"),w(h>=0&&h<i.framebufferHeight,"invalid y offset for regl.read"),f=0|(c.width||i.framebufferWidth-l),p=0|(c.height||i.framebufferHeight-h),d=c.data||null),d&&(5121===u?w(d instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):5126===u&&w(d instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),w(f>0&&f+l<=i.framebufferWidth,"invalid width for read pixels"),w(p>0&&p+h<=i.framebufferHeight,"invalid height for read pixels"),r();var m=f*p*4;return d||(5121===u?d=new Uint8Array(m):5126===u&&(d=d||new Float32Array(m))),w.isTypedArray(d,"data buffer for regl.read() must be a typedarray"),w(d.byteLength>=m,"data buffer for regl.read() too small"),t.pixelStorei(3333,4),t.readPixels(l,h,f,p,6408,u,d),d}return function(e){return e&&"framebuffer"in e?function(e){var t;return n.setFBO({framebuffer:e.framebuffer},(function(){t=c(e)})),t}(e):c(e)}}function Ie(e){return Array.prototype.slice.call(e)}function Ne(e){return Ie(e).join("")}Ce[36053]="complete",Ce[36054]="incomplete attachment",Ce[36057]="incomplete dimensions",Ce[36055]="incomplete, missing attachment",Ce[36061]="unsupported";var ze="xyzw".split(""),ke="profile",Fe="framebuffer",Be="vert",Ue="frag",He="elements",Ge="primitive",je="count",Ve="offset",We="instances",qe="vao",Ye=Fe+"Width",Xe=Fe+"Height",Ze=["blend.func","blend.equation","stencil.func","stencil.opFront","stencil.opBack","sample.coverage","viewport","scissor.box","polygonOffset.offset"],Je={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Qe=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Ke={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},$e={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},et={frag:35632,vert:35633},tt={cw:2304,ccw:2305};function nt(t){return Array.isArray(t)||e(t)||z(t)}function rt(e){return e.sort((function(e,t){return"viewport"===e?-1:"viewport"===t?1:e<t?-1:1}))}function it(e,t,n,r){this.thisDep=e,this.contextDep=t,this.propDep=n,this.append=r}function at(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function ot(e){return new it(!1,!1,!1,e)}function st(e,t){var n=e.type;if(0===n){var r=e.data.length;return new it(!0,r>=1,r>=2,t)}if(4===n){var i=e.data;return new it(i.thisDep,i.contextDep,i.propDep,t)}if(5===n)return new it(!1,!1,!1,t);if(6===n){for(var a=!1,o=!1,s=!1,c=0;c<e.data.length;++c){var u=e.data[c];if(1===u.type)s=!0;else if(2===u.type)o=!0;else if(3===u.type)a=!0;else if(0===u.type){a=!0;var l=u.data;l>=1&&(o=!0),l>=2&&(s=!0)}else 4===u.type&&(a=a||u.data.thisDep,o=o||u.data.contextDep,s=s||u.data.propDep)}return new it(a,o,s,t)}return new it(3===n,2===n,1===n,t)}var ct=new it(!1,!1,!1,(function(){}));function ut(e,n,r,i,a,o,s,c,u,l,h,f,p,d,m){var v=l.Record,g={add:32774,subtract:32778,"reverse subtract":32779};r.ext_blend_minmax&&(g.min=32775,g.max=32776);var y=r.angle_instanced_arrays,x=r.webgl_draw_buffers,b={dirty:!0,profile:m.profile},_={},M=[],E={},T={};function A(e){return e.replace(".","_")}function L(e,t,n){var r=A(e);M.push(e),_[r]=b[r]=!!n,E[r]=t}function R(e,t,n){var r=A(e);M.push(e),Array.isArray(n)?(b[r]=n.slice(),_[r]=n.slice()):b[r]=_[r]=n,T[r]=t}L("dither",3024),L("blend.enable",3042),R("blend.color","blendColor",[0,0,0,0]),R("blend.equation","blendEquationSeparate",[32774,32774]),R("blend.func","blendFuncSeparate",[1,0,1,0]),L("depth.enable",2929,!0),R("depth.func","depthFunc",513),R("depth.range","depthRange",[0,1]),R("depth.mask","depthMask",!0),R("colorMask","colorMask",[!0,!0,!0,!0]),L("cull.enable",2884),R("cull.face","cullFace",1029),R("frontFace","frontFace",2305),R("lineWidth","lineWidth",1),L("polygonOffset.enable",32823),R("polygonOffset.offset","polygonOffset",[0,0]),L("sample.alpha",32926),L("sample.enable",32928),R("sample.coverage","sampleCoverage",[1,!1]),L("stencil.enable",2960),R("stencil.mask","stencilMask",-1),R("stencil.func","stencilFunc",[519,0,-1]),R("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]),R("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]),L("scissor.enable",3089),R("scissor.box","scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),R("viewport","viewport",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var P={gl:e,context:p,strings:n,next:_,current:b,draw:f,elements:o,buffer:a,shader:h,attributes:l.state,vao:l,uniforms:u,framebuffer:c,extensions:r,timer:d,isBufferArgs:nt},C={primTypes:Z,compareFuncs:Ke,blendFuncs:Je,blendEquations:g,stencilOps:$e,glTypes:H,orientationType:tt};w.optional((function(){P.isArrayLike=$})),x&&(C.backBuffer=[1029],C.drawBuffer=O(i.maxDrawbuffers,(function(e){return 0===e?[0]:O(e,(function(e){return 36064+e}))})));var D=0;function I(){var e=function(){var e=0,n=[],r=[];function i(){var n=[],r=[];return t((function(){n.push.apply(n,Ie(arguments))}),{def:function(){var t="v"+e++;return r.push(t),arguments.length>0&&(n.push(t,"="),n.push.apply(n,Ie(arguments)),n.push(";")),t},toString:function(){return Ne([r.length>0?"var "+r.join(",")+";":"",Ne(n)])}})}function a(){var e=i(),n=i(),r=e.toString,a=n.toString;function o(t,r){n(t,r,"=",e.def(t,r),";")}return t((function(){e.apply(e,Ie(arguments))}),{def:e.def,entry:e,exit:n,save:o,set:function(t,n,r){o(t,n),e(t,n,"=",r,";")},toString:function(){return r()+a()}})}var o=i(),s={};return{global:o,link:function(t){for(var i=0;i<r.length;++i)if(r[i]===t)return n[i];var a="g"+e++;return n.push(a),r.push(t),a},block:i,proc:function(e,n){var r=[];function i(){var e="a"+r.length;return r.push(e),e}n=n||0;for(var o=0;o<n;++o)i();var c=a(),u=c.toString;return s[e]=t(c,{arg:i,toString:function(){return Ne(["function(",r.join(),"){",u(),"}"])}})},scope:a,cond:function(){var e=Ne(arguments),n=a(),r=a(),i=n.toString,o=r.toString;return t(n,{then:function(){return n.apply(n,Ie(arguments)),this},else:function(){return r.apply(r,Ie(arguments)),this},toString:function(){var t=o();return t&&(t="else{"+t+"}"),Ne(["if(",e,"){",i(),"}",t])}})},compile:function(){var e=['"use strict";',o,"return {"];Object.keys(s).forEach((function(t){e.push('"',t,'":',s[t].toString(),",")})),e.push("}");var t=Ne(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,n.concat(t)).apply(null,r)}}}(),r=e.link,i=e.global;e.id=D++,e.batchId="0";var a=r(P),o=e.shared={props:"a0"};Object.keys(P).forEach((function(e){o[e]=i.def(a,".",e)})),w.optional((function(){e.CHECK=r(w),e.commandStr=w.guessCommand(),e.command=r(e.commandStr),e.assert=function(e,t,n){e("if(!(",t,"))",this.CHECK,".commandRaise(",r(n),",",this.command,");")},C.invalidBlendCombinations=Qe}));var s=e.next={},c=e.current={};Object.keys(T).forEach((function(e){Array.isArray(b[e])&&(s[e]=i.def(o.next,".",e),c[e]=i.def(o.current,".",e))}));var u=e.constants={};Object.keys(C).forEach((function(e){u[e]=i.def(JSON.stringify(C[e]))})),e.invoke=function(t,n){switch(n.type){case 0:var i=["this",o.context,o.props,e.batchId];return t.def(r(n.data),".call(",i.slice(0,Math.max(n.data.length+1,4)),")");case 1:return t.def(o.props,n.data);case 2:return t.def(o.context,n.data);case 3:return t.def("this",n.data);case 4:return n.data.append(e,t),n.data.ref;case 5:return n.data.toString();case 6:return n.data.map((function(n){return e.invoke(t,n)}))}},e.attribCache={};var h={};return e.scopeAttrib=function(e){var t=n.id(e);if(t in h)return h[t];var i=l.scope[t];return i||(i=l.scope[t]=new v),h[t]=r(i)},e}function N(e,t,s,u,f){var p=e.static,d=e.dynamic;w.optional((function(){var e=[Fe,Be,Ue,He,Ge,Ve,je,We,ke,qe].concat(M);function t(t){Object.keys(t).forEach((function(t){w.command(e.indexOf(t)>=0,'unknown parameter "'+t+'"',f.commandStr)}))}t(p),t(d)}));var m=function(e,t){var n=e.static;if("string"===typeof n[Ue]&&"string"===typeof n[Be]){if(Object.keys(t.dynamic).length>0)return null;var r=t.static,i=Object.keys(r);if(i.length>0&&"number"===typeof r[i[0]]){for(var a=[],o=0;o<i.length;++o)w("number"===typeof r[i[o]],"must specify all vertex attribute locations when using vaos"),a.push([0|r[i[o]],i[o]]);return a}}return null}(e,t),x=function(e,t){var n=e.static,r=e.dynamic;if(Fe in n){var i=n[Fe];return i?(i=c.getFramebuffer(i),w.command(i,"invalid framebuffer object"),ot((function(e,t){var n=e.link(i),r=e.shared;t.set(r.framebuffer,".next",n);var a=r.context;return t.set(a,"."+Ye,n+".width"),t.set(a,"."+Xe,n+".height"),n}))):ot((function(e,t){var n=e.shared;t.set(n.framebuffer,".next","null");var r=n.context;return t.set(r,"."+Ye,r+".drawingBufferWidth"),t.set(r,"."+Xe,r+".drawingBufferHeight"),"null"}))}if(Fe in r){var a=r[Fe];return st(a,(function(e,t){var n=e.invoke(t,a),r=e.shared,i=r.framebuffer,o=t.def(i,".getFramebuffer(",n,")");w.optional((function(){e.assert(t,"!"+n+"||"+o,"invalid framebuffer object")})),t.set(i,".next",o);var s=r.context;return t.set(s,"."+Ye,o+"?"+o+".width:"+s+".drawingBufferWidth"),t.set(s,"."+Xe,o+"?"+o+".height:"+s+".drawingBufferHeight"),o}))}return null}(e),b=function(e,t,n){var r=e.static,i=e.dynamic;function a(e){if(e in r){var a=r[e];w.commandType(a,"object","invalid "+e,n.commandStr);var o,s,c=!0,u=0|a.x,l=0|a.y;return"width"in a?(o=0|a.width,w.command(o>=0,"invalid "+e,n.commandStr)):c=!1,"height"in a?(s=0|a.height,w.command(s>=0,"invalid "+e,n.commandStr)):c=!1,new it(!c&&t&&t.thisDep,!c&&t&&t.contextDep,!c&&t&&t.propDep,(function(e,t){var n=e.shared.context,r=o;"width"in a||(r=t.def(n,".",Ye,"-",u));var i=s;return"height"in a||(i=t.def(n,".",Xe,"-",l)),[u,l,r,i]}))}if(e in i){var h=i[e],f=st(h,(function(t,n){var r=t.invoke(n,h);w.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)}));var i=t.shared.context,a=n.def(r,".x|0"),o=n.def(r,".y|0"),s=n.def('"width" in ',r,"?",r,".width|0:","(",i,".",Ye,"-",a,")"),c=n.def('"height" in ',r,"?",r,".height|0:","(",i,".",Xe,"-",o,")");return w.optional((function(){t.assert(n,s+">=0&&"+c+">=0","invalid "+e)})),[a,o,s,c]}));return t&&(f.thisDep=f.thisDep||t.thisDep,f.contextDep=f.contextDep||t.contextDep,f.propDep=f.propDep||t.propDep),f}return t?new it(t.thisDep,t.contextDep,t.propDep,(function(e,t){var n=e.shared.context;return[0,0,t.def(n,".",Ye),t.def(n,".",Xe)]})):null}var o=a("viewport");if(o){var s=o;o=new it(o.thisDep,o.contextDep,o.propDep,(function(e,t){var n=s.append(e,t),r=e.shared.context;return t.set(r,".viewportWidth",n[2]),t.set(r,".viewportHeight",n[3]),n}))}return{viewport:o,scissor_box:a("scissor.box")}}(e,x,f),_=function(e,t){var n=e.static,r=e.dynamic,i=function(){if(He in n){var e=n[He];nt(e)?e=o.getElements(o.create(e,!0)):e&&(e=o.getElements(e),w.command(e,"invalid elements",t.commandStr));var i=ot((function(t,n){if(e){var r=t.link(e);return t.ELEMENTS=r,r}return t.ELEMENTS=null,null}));return i.value=e,i}if(He in r){var a=r[He];return st(a,(function(e,t){var n=e.shared,r=n.isBufferArgs,i=n.elements,o=e.invoke(t,a),s=t.def("null"),c=t.def(r,"(",o,")"),u=e.cond(c).then(s,"=",i,".createStream(",o,");").else(s,"=",i,".getElements(",o,");");return w.optional((function(){e.assert(u.else,"!"+o+"||"+s,"invalid elements")})),t.entry(u),t.exit(e.cond(c).then(i,".destroyStream(",s,");")),e.ELEMENTS=s,s}))}return null}();function a(e,a){if(e in n){var o=0|n[e];return w.command(!a||o>=0,"invalid "+e,t.commandStr),ot((function(e,t){return a&&(e.OFFSET=o),o}))}if(e in r){var s=r[e];return st(s,(function(t,n){var r=t.invoke(n,s);return a&&(t.OFFSET=r,w.optional((function(){t.assert(n,r+">=0","invalid "+e)}))),r}))}return a&&i?ot((function(e,t){return e.OFFSET="0",0})):null}var s=a(Ve,!0);return{elements:i,primitive:function(){if(Ge in n){var e=n[Ge];return w.commandParameter(e,Z,"invalid primitve",t.commandStr),ot((function(t,n){return Z[e]}))}if(Ge in r){var a=r[Ge];return st(a,(function(e,t){var n=e.constants.primTypes,r=e.invoke(t,a);return w.optional((function(){e.assert(t,r+" in "+n,"invalid primitive, must be one of "+Object.keys(Z))})),t.def(n,"[",r,"]")}))}return i?at(i)?i.value?ot((function(e,t){return t.def(e.ELEMENTS,".primType")})):ot((function(){return 4})):new it(i.thisDep,i.contextDep,i.propDep,(function(e,t){var n=e.ELEMENTS;return t.def(n,"?",n,".primType:",4)})):null}(),count:function(){if(je in n){var e=0|n[je];return w.command("number"===typeof e&&e>=0,"invalid vertex count",t.commandStr),ot((function(){return e}))}if(je in r){var a=r[je];return st(a,(function(e,t){var n=e.invoke(t,a);return w.optional((function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">=0&&"+n+"===("+n+"|0)","invalid vertex count")})),n}))}if(i){if(at(i)){if(i)return s?new it(s.thisDep,s.contextDep,s.propDep,(function(e,t){var n=t.def(e.ELEMENTS,".vertCount-",e.OFFSET);return w.optional((function(){e.assert(t,n+">=0","invalid vertex offset/element buffer too small")})),n})):ot((function(e,t){return t.def(e.ELEMENTS,".vertCount")}));var o=ot((function(){return-1}));return w.optional((function(){o.MISSING=!0})),o}var c=new it(i.thisDep||s.thisDep,i.contextDep||s.contextDep,i.propDep||s.propDep,(function(e,t){var n=e.ELEMENTS;return e.OFFSET?t.def(n,"?",n,".vertCount-",e.OFFSET,":-1"):t.def(n,"?",n,".vertCount:-1")}));return w.optional((function(){c.DYNAMIC=!0})),c}return null}(),instances:a(We,!1),offset:s}}(e,f),E=function(e,t){var n=e.static,r=e.dynamic,a={};return M.forEach((function(e){var o=A(e);function s(t,i){if(e in n){var s=t(n[e]);a[o]=ot((function(){return s}))}else if(e in r){var c=r[e];a[o]=st(c,(function(e,t){return i(e,t,e.invoke(t,c))}))}}switch(e){case"cull.enable":case"blend.enable":case"dither":case"stencil.enable":case"depth.enable":case"scissor.enable":case"polygonOffset.enable":case"sample.alpha":case"sample.enable":case"depth.mask":return s((function(n){return w.commandType(n,"boolean",e,t.commandStr),n}),(function(t,n,r){return w.optional((function(){t.assert(n,"typeof "+r+'==="boolean"',"invalid flag "+e,t.commandStr)})),r}));case"depth.func":return s((function(n){return w.commandParameter(n,Ke,"invalid "+e,t.commandStr),Ke[n]}),(function(t,n,r){var i=t.constants.compareFuncs;return w.optional((function(){t.assert(n,r+" in "+i,"invalid "+e+", must be one of "+Object.keys(Ke))})),n.def(i,"[",r,"]")}));case"depth.range":return s((function(e){return w.command($(e)&&2===e.length&&"number"===typeof e[0]&&"number"===typeof e[1]&&e[0]<=e[1],"depth range is 2d array",t.commandStr),e}),(function(e,t,n){return w.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===2&&typeof "+n+'[0]==="number"&&typeof '+n+'[1]==="number"&&'+n+"[0]<="+n+"[1]","depth range must be a 2d array")})),[t.def("+",n,"[0]"),t.def("+",n,"[1]")]}));case"blend.func":return s((function(e){w.commandType(e,"object","blend.func",t.commandStr);var n="srcRGB"in e?e.srcRGB:e.src,r="srcAlpha"in e?e.srcAlpha:e.src,i="dstRGB"in e?e.dstRGB:e.dst,a="dstAlpha"in e?e.dstAlpha:e.dst;return w.commandParameter(n,Je,o+".srcRGB",t.commandStr),w.commandParameter(r,Je,o+".srcAlpha",t.commandStr),w.commandParameter(i,Je,o+".dstRGB",t.commandStr),w.commandParameter(a,Je,o+".dstAlpha",t.commandStr),w.command(-1===Qe.indexOf(n+", "+i),"unallowed blending combination (srcRGB, dstRGB) = ("+n+", "+i+")",t.commandStr),[Je[n],Je[i],Je[r],Je[a]]}),(function(t,n,r){var i=t.constants.blendFuncs;function a(a,o){var s=n.def('"',a,o,'" in ',r,"?",r,".",a,o,":",r,".",a);return w.optional((function(){t.assert(n,s+" in "+i,"invalid "+e+"."+a+o+", must be one of "+Object.keys(Je))})),s}w.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid blend func, must be an object")}));var o=a("src","RGB"),s=a("dst","RGB");w.optional((function(){var e=t.constants.invalidBlendCombinations;t.assert(n,e+".indexOf("+o+'+", "+'+s+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")}));var c=n.def(i,"[",o,"]"),u=n.def(i,"[",a("src","Alpha"),"]");return[c,n.def(i,"[",s,"]"),u,n.def(i,"[",a("dst","Alpha"),"]")]}));case"blend.equation":return s((function(n){return"string"===typeof n?(w.commandParameter(n,g,"invalid "+e,t.commandStr),[g[n],g[n]]):"object"===typeof n?(w.commandParameter(n.rgb,g,e+".rgb",t.commandStr),w.commandParameter(n.alpha,g,e+".alpha",t.commandStr),[g[n.rgb],g[n.alpha]]):void w.commandRaise("invalid blend.equation",t.commandStr)}),(function(t,n,r){var i=t.constants.blendEquations,a=n.def(),o=n.def(),s=t.cond("typeof ",r,'==="string"');return w.optional((function(){function n(e,n,r){t.assert(e,r+" in "+i,"invalid "+n+", must be one of "+Object.keys(g))}n(s.then,e,r),t.assert(s.else,r+"&&typeof "+r+'==="object"',"invalid "+e),n(s.else,e+".rgb",r+".rgb"),n(s.else,e+".alpha",r+".alpha")})),s.then(a,"=",o,"=",i,"[",r,"];"),s.else(a,"=",i,"[",r,".rgb];",o,"=",i,"[",r,".alpha];"),n(s),[a,o]}));case"blend.color":return s((function(e){return w.command($(e)&&4===e.length,"blend.color must be a 4d array",t.commandStr),O(4,(function(t){return+e[t]}))}),(function(e,t,n){return w.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","blend.color must be a 4d array")})),O(4,(function(e){return t.def("+",n,"[",e,"]")}))}));case"stencil.mask":return s((function(e){return w.commandType(e,"number",o,t.commandStr),0|e}),(function(e,t,n){return w.optional((function(){e.assert(t,"typeof "+n+'==="number"',"invalid stencil.mask")})),t.def(n,"|0")}));case"stencil.func":return s((function(n){w.commandType(n,"object",o,t.commandStr);var r=n.cmp||"keep",i=n.ref||0,a="mask"in n?n.mask:-1;return w.commandParameter(r,Ke,e+".cmp",t.commandStr),w.commandType(i,"number",e+".ref",t.commandStr),w.commandType(a,"number",e+".mask",t.commandStr),[Ke[r],i,a]}),(function(e,t,n){var r=e.constants.compareFuncs;return w.optional((function(){function i(){e.assert(t,Array.prototype.join.call(arguments,""),"invalid stencil.func")}i(n+"&&typeof ",n,'==="object"'),i('!("cmp" in ',n,")||(",n,".cmp in ",r,")")})),[t.def('"cmp" in ',n,"?",r,"[",n,".cmp]",":",7680),t.def(n,".ref|0"),t.def('"mask" in ',n,"?",n,".mask|0:-1")]}));case"stencil.opFront":case"stencil.opBack":return s((function(n){w.commandType(n,"object",o,t.commandStr);var r=n.fail||"keep",i=n.zfail||"keep",a=n.zpass||"keep";return w.commandParameter(r,$e,e+".fail",t.commandStr),w.commandParameter(i,$e,e+".zfail",t.commandStr),w.commandParameter(a,$e,e+".zpass",t.commandStr),["stencil.opBack"===e?1029:1028,$e[r],$e[i],$e[a]]}),(function(t,n,r){var i=t.constants.stencilOps;function a(a){return w.optional((function(){t.assert(n,'!("'+a+'" in '+r+")||("+r+"."+a+" in "+i+")","invalid "+e+"."+a+", must be one of "+Object.keys($e))})),n.def('"',a,'" in ',r,"?",i,"[",r,".",a,"]:",7680)}return w.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)})),["stencil.opBack"===e?1029:1028,a("fail"),a("zfail"),a("zpass")]}));case"polygonOffset.offset":return s((function(e){w.commandType(e,"object",o,t.commandStr);var n=0|e.factor,r=0|e.units;return w.commandType(n,"number",o+".factor",t.commandStr),w.commandType(r,"number",o+".units",t.commandStr),[n,r]}),(function(t,n,r){return w.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)})),[n.def(r,".factor|0"),n.def(r,".units|0")]}));case"cull.face":return s((function(e){var n=0;return"front"===e?n=1028:"back"===e&&(n=1029),w.command(!!n,o,t.commandStr),n}),(function(e,t,n){return w.optional((function(){e.assert(t,n+'==="front"||'+n+'==="back"',"invalid cull.face")})),t.def(n,'==="front"?',1028,":",1029)}));case"lineWidth":return s((function(e){return w.command("number"===typeof e&&e>=i.lineWidthDims[0]&&e<=i.lineWidthDims[1],"invalid line width, must be a positive number between "+i.lineWidthDims[0]+" and "+i.lineWidthDims[1],t.commandStr),e}),(function(e,t,n){return w.optional((function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">="+i.lineWidthDims[0]+"&&"+n+"<="+i.lineWidthDims[1],"invalid line width")})),n}));case"frontFace":return s((function(e){return w.commandParameter(e,tt,o,t.commandStr),tt[e]}),(function(e,t,n){return w.optional((function(){e.assert(t,n+'==="cw"||'+n+'==="ccw"',"invalid frontFace, must be one of cw,ccw")})),t.def(n+'==="cw"?2304:2305')}));case"colorMask":return s((function(e){return w.command($(e)&&4===e.length,"color.mask must be length 4 array",t.commandStr),e.map((function(e){return!!e}))}),(function(e,t,n){return w.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","invalid color.mask")})),O(4,(function(e){return"!!"+n+"["+e+"]"}))}));case"sample.coverage":return s((function(e){w.command("object"===typeof e&&e,o,t.commandStr);var n="value"in e?e.value:1,r=!!e.invert;return w.command("number"===typeof n&&n>=0&&n<=1,"sample.coverage.value must be a number between 0 and 1",t.commandStr),[n,r]}),(function(e,t,n){return w.optional((function(){e.assert(t,n+"&&typeof "+n+'==="object"',"invalid sample.coverage")})),[t.def('"value" in ',n,"?+",n,".value:1"),t.def("!!",n,".invert")]}))}})),a}(e,f),T=function(e,t,r){var i=e.static,a=e.dynamic;function o(e){if(e in i){var t=n.id(i[e]);w.optional((function(){h.shader(et[e],t,w.guessCommand())}));var r=ot((function(){return t}));return r.id=t,r}if(e in a){var o=a[e];return st(o,(function(t,n){var r=t.invoke(n,o),i=n.def(t.shared.strings,".id(",r,")");return w.optional((function(){n(t.shared.shader,".shader(",et[e],",",i,",",t.command,");")})),i}))}return null}var s,c=o(Ue),u=o(Be),l=null;return at(c)&&at(u)?(l=h.program(u.id,c.id,null,r),s=ot((function(e,t){return e.link(l)}))):s=new it(c&&c.thisDep||u&&u.thisDep,c&&c.contextDep||u&&u.contextDep,c&&c.propDep||u&&u.propDep,(function(e,t){var n,r=e.shared.shader;n=c?c.append(e,t):t.def(r,".",Ue);var i=r+".program("+(u?u.append(e,t):t.def(r,".",Be))+","+n;return w.optional((function(){i+=","+e.command})),t.def(i+")")})),{frag:c,vert:u,progVar:s,program:l}}(e,0,m);function S(e){var t=b[e];t&&(E[e]=t)}S("viewport"),S(A("scissor.box"));var L=Object.keys(E).length>0,R={framebuffer:x,draw:_,shader:T,state:E,dirty:L,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(R.profile=function(e){var t,n=e.static,r=e.dynamic;if(ke in n){var i=!!n[ke];(t=ot((function(e,t){return i}))).enable=i}else if(ke in r){var a=r[ke];t=st(a,(function(e,t){return e.invoke(t,a)}))}return t}(e),R.uniforms=function(e,t){var n=e.static,r=e.dynamic,i={};return Object.keys(n).forEach((function(e){var r,a=n[e];if("number"===typeof a||"boolean"===typeof a)r=ot((function(){return a}));else if("function"===typeof a){var o=a._reglType;"texture2d"===o||"textureCube"===o?r=ot((function(e){return e.link(a)})):"framebuffer"===o||"framebufferCube"===o?(w.command(a.color.length>0,'missing color attachment for framebuffer sent to uniform "'+e+'"',t.commandStr),r=ot((function(e){return e.link(a.color[0])}))):w.commandRaise('invalid data for uniform "'+e+'"',t.commandStr)}else $(a)?r=ot((function(t){return t.global.def("[",O(a.length,(function(n){return w.command("number"===typeof a[n]||"boolean"===typeof a[n],"invalid uniform "+e,t.commandStr),a[n]})),"]")})):w.commandRaise('invalid or missing data for uniform "'+e+'"',t.commandStr);r.value=a,i[e]=r})),Object.keys(r).forEach((function(e){var t=r[e];i[e]=st(t,(function(e,n){return e.invoke(n,t)}))})),i}(s,f),R.drawVAO=R.scopeVAO=function(e,t){var n=e.static,r=e.dynamic;if(qe in n){var i=n[qe];return null!==i&&null===l.getVAO(i)&&(i=l.createVAO(i)),ot((function(e){return e.link(l.getVAO(i))}))}if(qe in r){var a=r[qe];return st(a,(function(e,t){var n=e.invoke(t,a);return t.def(e.shared.vao+".getVAO("+n+")")}))}return null}(e),!R.drawVAO&&T.program&&!m&&r.angle_instanced_arrays){var P=!0,C=T.program.attributes.map((function(e){var n=t.static[e];return P=P&&!!n,n}));if(P&&C.length>0){var D=l.getVAO(l.createVAO(C));R.drawVAO=new it(null,null,null,(function(e,t){return e.link(D)})),R.useVAO=!0}}return m?R.useVAO=!0:R.attributes=function(e,t){var r=e.static,i=e.dynamic,o={};return Object.keys(r).forEach((function(e){var i=r[e],s=n.id(e),c=new v;if(nt(i))c.state=1,c.buffer=a.getBuffer(a.create(i,34962,!1,!0)),c.type=0;else{var u=a.getBuffer(i);if(u)c.state=1,c.buffer=u,c.type=0;else if(w.command("object"===typeof i&&i,"invalid data for attribute "+e,t.commandStr),"constant"in i){var l=i.constant;c.buffer="null",c.state=2,"number"===typeof l?c.x=l:(w.command($(l)&&l.length>0&&l.length<=4,"invalid constant for attribute "+e,t.commandStr),ze.forEach((function(e,t){t<l.length&&(c[e]=l[t])})))}else{u=nt(i.buffer)?a.getBuffer(a.create(i.buffer,34962,!1,!0)):a.getBuffer(i.buffer),w.command(!!u,'missing buffer for attribute "'+e+'"',t.commandStr);var h=0|i.offset;w.command(h>=0,'invalid offset for attribute "'+e+'"',t.commandStr);var f=0|i.stride;w.command(f>=0&&f<256,'invalid stride for attribute "'+e+'", must be integer betweeen [0, 255]',t.commandStr);var p=0|i.size;w.command(!("size"in i)||p>0&&p<=4,'invalid size for attribute "'+e+'", must be 1,2,3,4',t.commandStr);var d=!!i.normalized,m=0;"type"in i&&(w.commandParameter(i.type,H,"invalid type for attribute "+e,t.commandStr),m=H[i.type]);var g=0|i.divisor;"divisor"in i&&(w.command(0===g||y,'cannot specify divisor for attribute "'+e+'", instancing not supported',t.commandStr),w.command(g>=0,'invalid divisor for attribute "'+e+'"',t.commandStr)),w.optional((function(){var n=t.commandStr,r=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(i).forEach((function(t){w.command(r.indexOf(t)>=0,'unknown parameter "'+t+'" for attribute pointer "'+e+'" (valid parameters are '+r+")",n)}))})),c.buffer=u,c.state=1,c.size=p,c.normalized=d,c.type=m||u.dtype,c.offset=h,c.stride=f,c.divisor=g}}o[e]=ot((function(e,t){var n=e.attribCache;if(s in n)return n[s];var r={isStream:!1};return Object.keys(c).forEach((function(e){r[e]=c[e]})),c.buffer&&(r.buffer=e.link(c.buffer),r.type=r.type||r.buffer+".dtype"),n[s]=r,r}))})),Object.keys(i).forEach((function(e){var t=i[e];o[e]=st(t,(function(n,r){var i=n.invoke(r,t),a=n.shared,o=n.constants,s=a.isBufferArgs,c=a.buffer;w.optional((function(){n.assert(r,i+"&&(typeof "+i+'==="object"||typeof '+i+'==="function")&&('+s+"("+i+")||"+c+".getBuffer("+i+")||"+c+".getBuffer("+i+".buffer)||"+s+"("+i+'.buffer)||("constant" in '+i+"&&(typeof "+i+'.constant==="number"||'+a.isArrayLike+"("+i+".constant))))",'invalid dynamic attribute "'+e+'"')}));var u={isStream:r.def(!1)},l=new v;l.state=1,Object.keys(l).forEach((function(e){u[e]=r.def(""+l[e])}));var h=u.buffer,f=u.type;function p(e){r(u[e],"=",i,".",e,"|0;")}return r("if(",s,"(",i,")){",u.isStream,"=true;",h,"=",c,".createStream(",34962,",",i,");",f,"=",h,".dtype;","}else{",h,"=",c,".getBuffer(",i,");","if(",h,"){",f,"=",h,".dtype;",'}else if("constant" in ',i,"){",u.state,"=",2,";","if(typeof "+i+'.constant === "number"){',u[ze[0]],"=",i,".constant;",ze.slice(1).map((function(e){return u[e]})).join("="),"=0;","}else{",ze.map((function(e,t){return u[e]+"="+i+".constant.length>"+t+"?"+i+".constant["+t+"]:0;"})).join(""),"}}else{","if(",s,"(",i,".buffer)){",h,"=",c,".createStream(",34962,",",i,".buffer);","}else{",h,"=",c,".getBuffer(",i,".buffer);","}",f,'="type" in ',i,"?",o.glTypes,"[",i,".type]:",h,".dtype;",u.normalized,"=!!",i,".normalized;"),p("size"),p("offset"),p("stride"),p("divisor"),r("}}"),r.exit("if(",u.isStream,"){",c,".destroyStream(",h,");","}"),u}))})),o}(t,f),R.context=function(e){var t=e.static,n=e.dynamic,r={};return Object.keys(t).forEach((function(e){var n=t[e];r[e]=ot((function(e,t){return"number"===typeof n||"boolean"===typeof n?""+n:e.link(n)}))})),Object.keys(n).forEach((function(e){var t=n[e];r[e]=st(t,(function(e,n){return e.invoke(n,t)}))})),r}(u),R}function z(e,t,n){var r=e.shared.context,i=e.scope();Object.keys(n).forEach((function(a){t.save(r,"."+a);var o=n[a].append(e,t);Array.isArray(o)?i(r,".",a,"=[",o.join(),"];"):i(r,".",a,"=",o,";")})),t(i)}function k(e,t,n,r){var i,a=e.shared,o=a.gl,s=a.framebuffer;x&&(i=t.def(a.extensions,".webgl_draw_buffers"));var c,u=e.constants,l=u.drawBuffer,h=u.backBuffer;c=n?n.append(e,t):t.def(s,".next"),r||t("if(",c,"!==",s,".cur){"),t("if(",c,"){",o,".bindFramebuffer(",36160,",",c,".framebuffer);"),x&&t(i,".drawBuffersWEBGL(",l,"[",c,".colorAttachments.length]);"),t("}else{",o,".bindFramebuffer(",36160,",null);"),x&&t(i,".drawBuffersWEBGL(",h,");"),t("}",s,".cur=",c,";"),r||t("}")}function F(e,t,n){var r=e.shared,i=r.gl,a=e.current,o=e.next,s=r.current,c=r.next,u=e.cond(s,".dirty");M.forEach((function(t){var r,l,h=A(t);if(!(h in n.state))if(h in o){r=o[h],l=a[h];var f=O(b[h].length,(function(e){return u.def(r,"[",e,"]")}));u(e.cond(f.map((function(e,t){return e+"!=="+l+"["+t+"]"})).join("||")).then(i,".",T[h],"(",f,");",f.map((function(e,t){return l+"["+t+"]="+e})).join(";"),";"))}else{r=u.def(c,".",h);var p=e.cond(r,"!==",s,".",h);u(p),h in E?p(e.cond(r).then(i,".enable(",E[h],");").else(i,".disable(",E[h],");"),s,".",h,"=",r,";"):p(i,".",T[h],"(",r,");",s,".",h,"=",r,";")}})),0===Object.keys(n.state).length&&u(s,".dirty=false;"),t(u)}function B(e,t,n,r){var i=e.shared,a=e.current,o=i.current,s=i.gl;rt(Object.keys(n)).forEach((function(i){var c=n[i];if(!r||r(c)){var u=c.append(e,t);if(E[i]){var l=E[i];at(c)?t(s,u?".enable(":".disable(",l,");"):t(e.cond(u).then(s,".enable(",l,");").else(s,".disable(",l,");")),t(o,".",i,"=",u,";")}else if($(u)){var h=a[i];t(s,".",T[i],"(",u,");",u.map((function(e,t){return h+"["+t+"]="+e})).join(";"),";")}else t(s,".",T[i],"(",u,");",o,".",i,"=",u,";")}}))}function U(e,t){y&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function G(e,t,n,r,i){var a,o,s,c=e.shared,u=e.stats,l=c.current,h=c.timer,f=n.profile;function p(){return"undefined"===typeof performance?"Date.now()":"performance.now()"}function m(e){e(a=t.def(),"=",p(),";"),"string"===typeof i?e(u,".count+=",i,";"):e(u,".count++;"),d&&(r?e(o=t.def(),"=",h,".getNumPendingQueries();"):e(h,".beginQuery(",u,");"))}function v(e){e(u,".cpuTime+=",p(),"-",a,";"),d&&(r?e(h,".pushScopeStats(",o,",",h,".getNumPendingQueries(),",u,");"):e(h,".endQuery();"))}function g(e){var n=t.def(l,".profile");t(l,".profile=",e,";"),t.exit(l,".profile=",n,";")}if(f){if(at(f))return void(f.enable?(m(t),v(t.exit),g("true")):g("false"));g(s=f.append(e,t))}else s=t.def(l,".profile");var y=e.block();m(y),t("if(",s,"){",y,"}");var x=e.block();v(x),t.exit("if(",s,"){",x,"}")}function j(e,t,n,r,i){var a=e.shared;r.forEach((function(r){var o,s=r.name,c=n.attributes[s];if(c){if(!i(c))return;o=c.append(e,t)}else{if(!i(ct))return;var u=e.scopeAttrib(s);w.optional((function(){e.assert(t,u+".state","missing attribute "+s)})),o={},Object.keys(new v).forEach((function(e){o[e]=t.def(u,".",e)}))}!function(n,r,i){var o=a.gl,s=t.def(n,".location"),c=t.def(a.attributes,"[",s,"]"),u=i.state,l=i.buffer,h=[i.x,i.y,i.z,i.w],f=["buffer","normalized","offset","stride"];function p(){t("if(!",c,".buffer){",o,".enableVertexAttribArray(",s,");}");var n,a=i.type;if(n=i.size?t.def(i.size,"||",r):r,t("if(",c,".type!==",a,"||",c,".size!==",n,"||",f.map((function(e){return c+"."+e+"!=="+i[e]})).join("||"),"){",o,".bindBuffer(",34962,",",l,".buffer);",o,".vertexAttribPointer(",[s,n,a,i.normalized,i.stride,i.offset],");",c,".type=",a,";",c,".size=",n,";",f.map((function(e){return c+"."+e+"="+i[e]+";"})).join(""),"}"),y){var u=i.divisor;t("if(",c,".divisor!==",u,"){",e.instancing,".vertexAttribDivisorANGLE(",[s,u],");",c,".divisor=",u,";}")}}function d(){t("if(",c,".buffer){",o,".disableVertexAttribArray(",s,");",c,".buffer=null;","}if(",ze.map((function(e,t){return c+"."+e+"!=="+h[t]})).join("||"),"){",o,".vertexAttrib4f(",s,",",h,");",ze.map((function(e,t){return c+"."+e+"="+h[t]+";"})).join(""),"}")}1===u?p():2===u?d():(t("if(",u,"===",1,"){"),p(),t("}else{"),d(),t("}"))}(e.link(r),function(e){switch(e){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}(r.info.type),o)}))}function V(e,t,r,i,a){for(var o,s=e.shared,c=s.gl,u=0;u<i.length;++u){var l,h=i[u],f=h.name,p=h.info.type,d=r.uniforms[f],m=e.link(h)+".location";if(d){if(!a(d))continue;if(at(d)){var v=d.value;if(w.command(null!==v&&"undefined"!==typeof v,'missing uniform "'+f+'"',e.commandStr),35678===p||35680===p){w.command("function"===typeof v&&(35678===p&&("texture2d"===v._reglType||"framebuffer"===v._reglType)||35680===p&&("textureCube"===v._reglType||"framebufferCube"===v._reglType)),"invalid texture for uniform "+f,e.commandStr);var g=e.link(v._texture||v.color[0]._texture);t(c,".uniform1i(",m,",",g+".bind());"),t.exit(g,".unbind();")}else if(35674===p||35675===p||35676===p){w.optional((function(){w.command($(v),"invalid matrix for uniform "+f,e.commandStr),w.command(35674===p&&4===v.length||35675===p&&9===v.length||35676===p&&16===v.length,"invalid length for matrix uniform "+f,e.commandStr)}));var y=e.global.def("new Float32Array(["+Array.prototype.slice.call(v)+"])"),x=2;35675===p?x=3:35676===p&&(x=4),t(c,".uniformMatrix",x,"fv(",m,",false,",y,");")}else{switch(p){case 5126:w.commandType(v,"number","uniform "+f,e.commandStr),o="1f";break;case 35664:w.command($(v)&&2===v.length,"uniform "+f,e.commandStr),o="2f";break;case 35665:w.command($(v)&&3===v.length,"uniform "+f,e.commandStr),o="3f";break;case 35666:w.command($(v)&&4===v.length,"uniform "+f,e.commandStr),o="4f";break;case 35670:w.commandType(v,"boolean","uniform "+f,e.commandStr),o="1i";break;case 5124:w.commandType(v,"number","uniform "+f,e.commandStr),o="1i";break;case 35671:case 35667:w.command($(v)&&2===v.length,"uniform "+f,e.commandStr),o="2i";break;case 35672:case 35668:w.command($(v)&&3===v.length,"uniform "+f,e.commandStr),o="3i";break;case 35673:case 35669:w.command($(v)&&4===v.length,"uniform "+f,e.commandStr),o="4i"}t(c,".uniform",o,"(",m,",",$(v)?Array.prototype.slice.call(v):v,");")}continue}l=d.append(e,t)}else{if(!a(ct))continue;l=t.def(s.uniforms,"[",n.id(f),"]")}35678===p?(w(!Array.isArray(l),"must specify a scalar prop for textures"),t("if(",l,"&&",l,'._reglType==="framebuffer"){',l,"=",l,".color[0];","}")):35680===p&&(w(!Array.isArray(l),"must specify a scalar prop for cube maps"),t("if(",l,"&&",l,'._reglType==="framebufferCube"){',l,"=",l,".color[0];","}")),w.optional((function(){function n(n,r){e.assert(t,n,'bad data or missing for uniform "'+f+'".  '+r)}function r(e){w(!Array.isArray(l),"must not specify an array type for uniform"),n("typeof "+l+'==="'+e+'"',"invalid type, expected "+e)}function i(t,r){Array.isArray(l)?w(l.length===t,"must have length "+t):n(s.isArrayLike+"("+l+")&&"+l+".length==="+t,"invalid vector, should have length "+t,e.commandStr)}function a(t){w(!Array.isArray(l),"must not specify a value type"),n("typeof "+l+'==="function"&&'+l+'._reglType==="texture'+(3553===t?"2d":"Cube")+'"',"invalid texture type",e.commandStr)}switch(p){case 5124:r("number");break;case 35667:i(2);break;case 35668:i(3);break;case 35669:i(4);break;case 5126:r("number");break;case 35664:i(2);break;case 35665:i(3);break;case 35666:i(4);break;case 35670:r("boolean");break;case 35671:i(2);break;case 35672:i(3);break;case 35673:case 35674:i(4);break;case 35675:i(9);break;case 35676:i(16);break;case 35678:a(3553);break;case 35680:a(34067)}}));var b=1;switch(p){case 35678:case 35680:var _=t.def(l,"._texture");t(c,".uniform1i(",m,",",_,".bind());"),t.exit(_,".unbind();");continue;case 5124:case 35670:o="1i";break;case 35667:case 35671:o="2i",b=2;break;case 35668:case 35672:o="3i",b=3;break;case 35669:case 35673:o="4i",b=4;break;case 5126:o="1f";break;case 35664:o="2f",b=2;break;case 35665:o="3f",b=3;break;case 35666:o="4f",b=4;break;case 35674:o="Matrix2fv";break;case 35675:o="Matrix3fv";break;case 35676:o="Matrix4fv"}if(t(c,".uniform",o,"(",m,","),"M"===o.charAt(0)){var M=Math.pow(p-35674+2,2),E=e.global.def("new Float32Array(",M,")");Array.isArray(l)?t("false,(",O(M,(function(e){return E+"["+e+"]="+l[e]})),",",E,")"):t("false,(Array.isArray(",l,")||",l," instanceof Float32Array)?",l,":(",O(M,(function(e){return E+"["+e+"]="+l+"["+e+"]"})),",",E,")")}else b>1?t(O(b,(function(e){return Array.isArray(l)?l[e]:l+"["+e+"]"}))):(w(!Array.isArray(l),"uniform value must not be an array"),t(l));t(");")}}function W(e,t,n,r){var i=e.shared,a=i.gl,o=i.draw,s=r.draw,c=function(){var i,c=s.elements,u=t;return c?((c.contextDep&&r.contextDynamic||c.propDep)&&(u=n),i=c.append(e,u)):i=u.def(o,".",He),i&&u("if("+i+")"+a+".bindBuffer(34963,"+i+".buffer.buffer);"),i}();function u(i){var a=s[i];return a?a.contextDep&&r.contextDynamic||a.propDep?a.append(e,n):a.append(e,t):t.def(o,".",i)}var l,h,f=u(Ge),p=u(Ve),d=function(){var i,a=s.count,c=t;return a?((a.contextDep&&r.contextDynamic||a.propDep)&&(c=n),i=a.append(e,c),w.optional((function(){a.MISSING&&e.assert(t,"false","missing vertex count"),a.DYNAMIC&&e.assert(c,i+">=0","missing vertex count")}))):(i=c.def(o,".",je),w.optional((function(){e.assert(c,i+">=0","missing vertex count")}))),i}();if("number"===typeof d){if(0===d)return}else n("if(",d,"){"),n.exit("}");y&&(l=u(We),h=e.instancing);var m=c+".type",v=s.elements&&at(s.elements);function g(){function e(){n(h,".drawElementsInstancedANGLE(",[f,d,m,p+"<<(("+m+"-5121)>>1)",l],");")}function t(){n(h,".drawArraysInstancedANGLE(",[f,p,d,l],");")}c?v?e():(n("if(",c,"){"),e(),n("}else{"),t(),n("}")):t()}function x(){function e(){n(a+".drawElements("+[f,d,m,p+"<<(("+m+"-5121)>>1)"]+");")}function t(){n(a+".drawArrays("+[f,p,d]+");")}c?v?e():(n("if(",c,"){"),e(),n("}else{"),t(),n("}")):t()}y&&("number"!==typeof l||l>=0)?"string"===typeof l?(n("if(",l,">0){"),g(),n("}else if(",l,"<0){"),x(),n("}")):g():x()}function q(e,t,n,r,i){var a=I(),o=a.proc("body",i);return w.optional((function(){a.commandStr=t.commandStr,a.command=a.link(t.commandStr)})),y&&(a.instancing=o.def(a.shared.extensions,".angle_instanced_arrays")),e(a,o,n,r),a.compile().body}function Y(e,t,n,r){U(e,t),n.useVAO?n.drawVAO?t(e.shared.vao,".setVAO(",n.drawVAO.append(e,t),");"):t(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(t(e.shared.vao,".setVAO(null);"),j(e,t,n,r.attributes,(function(){return!0}))),V(e,t,n,r.uniforms,(function(){return!0})),W(e,t,t,n)}function X(e,t,n,r){function i(){return!0}e.batchId="a1",U(e,t),j(e,t,n,r.attributes,i),V(e,t,n,r.uniforms,i),W(e,t,t,n)}function J(e,t,n,r){U(e,t);var i=n.contextDep,a=t.def(),o=t.def();e.shared.props=o,e.batchId=a;var s=e.scope(),c=e.scope();function u(e){return e.contextDep&&i||e.propDep}function l(e){return!u(e)}if(t(s.entry,"for(",a,"=0;",a,"<","a1",";++",a,"){",o,"=","a0","[",a,"];",c,"}",s.exit),n.needsContext&&z(e,c,n.context),n.needsFramebuffer&&k(e,c,n.framebuffer),B(e,c,n.state,u),n.profile&&u(n.profile)&&G(e,c,n,!1,!0),r)n.useVAO?n.drawVAO?u(n.drawVAO)?c(e.shared.vao,".setVAO(",n.drawVAO.append(e,c),");"):s(e.shared.vao,".setVAO(",n.drawVAO.append(e,s),");"):s(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(s(e.shared.vao,".setVAO(null);"),j(e,s,n,r.attributes,l),j(e,c,n,r.attributes,u)),V(e,s,n,r.uniforms,l),V(e,c,n,r.uniforms,u),W(e,s,c,n);else{var h=e.global.def("{}"),f=n.shader.progVar.append(e,c),p=c.def(f,".id"),d=c.def(h,"[",p,"]");c(e.shared.gl,".useProgram(",f,".program);","if(!",d,"){",d,"=",h,"[",p,"]=",e.link((function(t){return q(X,e,n,t,2)})),"(",f,");}",d,".call(this,a0[",a,"],",a,");")}}function Q(e,t,n){var r=t.static[n];if(r&&function(e){if("object"===typeof e&&!$(e)){for(var t=Object.keys(e),n=0;n<t.length;++n)if(S.isDynamic(e[t[n]]))return!0;return!1}}(r)){var i=e.global,a=Object.keys(r),o=!1,s=!1,c=!1,u=e.global.def("{}");a.forEach((function(t){var n=r[t];if(S.isDynamic(n)){"function"===typeof n&&(n=r[t]=S.unbox(n));var a=st(n,null);o=o||a.thisDep,c=c||a.propDep,s=s||a.contextDep}else{switch(i(u,".",t,"="),typeof n){case"number":i(n);break;case"string":i('"',n,'"');break;case"object":Array.isArray(n)&&i("[",n.join(),"]");break;default:i(e.link(n))}i(";")}})),t.dynamic[n]=new S.DynamicVariable(4,{thisDep:o,contextDep:s,propDep:c,ref:u,append:function(e,t){a.forEach((function(n){var i=r[n];if(S.isDynamic(i)){var a=e.invoke(t,i);t(u,".",n,"=",a,";")}}))}}),delete t.static[n]}}return{next:_,current:b,procs:function(){var e=I(),t=e.proc("poll"),n=e.proc("refresh"),a=e.block();t(a),n(a);var o,s=e.shared,c=s.gl,u=s.next,l=s.current;a(l,".dirty=false;"),k(e,t),k(e,n,null,!0),y&&(o=e.link(y)),r.oes_vertex_array_object&&n(e.link(r.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var h=0;h<i.maxAttributes;++h){var f=n.def(s.attributes,"[",h,"]"),p=e.cond(f,".buffer");p.then(c,".enableVertexAttribArray(",h,");",c,".bindBuffer(",34962,",",f,".buffer.buffer);",c,".vertexAttribPointer(",h,",",f,".size,",f,".type,",f,".normalized,",f,".stride,",f,".offset);").else(c,".disableVertexAttribArray(",h,");",c,".vertexAttrib4f(",h,",",f,".x,",f,".y,",f,".z,",f,".w);",f,".buffer=null;"),n(p),y&&n(o,".vertexAttribDivisorANGLE(",h,",",f,".divisor);")}return n(e.shared.vao,".currentVAO=null;",e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"),Object.keys(E).forEach((function(r){var i=E[r],o=a.def(u,".",r),s=e.block();s("if(",o,"){",c,".enable(",i,")}else{",c,".disable(",i,")}",l,".",r,"=",o,";"),n(s),t("if(",o,"!==",l,".",r,"){",s,"}")})),Object.keys(T).forEach((function(r){var i,o,s=T[r],h=b[r],f=e.block();if(f(c,".",s,"("),$(h)){var p=h.length;i=e.global.def(u,".",r),o=e.global.def(l,".",r),f(O(p,(function(e){return i+"["+e+"]"})),");",O(p,(function(e){return o+"["+e+"]="+i+"["+e+"];"})).join("")),t("if(",O(p,(function(e){return i+"["+e+"]!=="+o+"["+e+"]"})).join("||"),"){",f,"}")}else i=a.def(u,".",r),o=a.def(l,".",r),f(i,");",l,".",r,"=",i,";"),t("if(",i,"!==",o,"){",f,"}");n(f)})),e.compile()}(),compile:function(e,r,i,a,o){var s=I();s.stats=s.link(o),Object.keys(r.static).forEach((function(e){Q(s,r,e)})),Ze.forEach((function(t){Q(s,e,t)}));var c=N(e,r,i,a,s);return function(e,t){var n=e.proc("draw",1);U(e,n),z(e,n,t.context),k(e,n,t.framebuffer),F(e,n,t),B(e,n,t.state),G(e,n,t,!1,!0);var r=t.shader.progVar.append(e,n);if(n(e.shared.gl,".useProgram(",r,".program);"),t.shader.program)Y(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var i=e.global.def("{}"),a=n.def(r,".id"),o=n.def(i,"[",a,"]");n(e.cond(o).then(o,".call(this,a0);").else(o,"=",i,"[",a,"]=",e.link((function(n){return q(Y,e,t,n,1)})),"(",r,");",o,".call(this,a0);"))}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;")}(s,c),function(e,t){var r=e.proc("scope",3);e.batchId="a2";var i=e.shared,a=i.current;function o(n){var a=t.shader[n];a&&r.set(i.shader,"."+n,a.append(e,r))}z(e,r,t.context),t.framebuffer&&t.framebuffer.append(e,r),rt(Object.keys(t.state)).forEach((function(n){var a=t.state[n].append(e,r);$(a)?a.forEach((function(t,i){r.set(e.next[n],"["+i+"]",t)})):r.set(i.next,"."+n,a)})),G(e,r,t,!0,!0),[He,Ve,je,We,Ge].forEach((function(n){var a=t.draw[n];a&&r.set(i.draw,"."+n,""+a.append(e,r))})),Object.keys(t.uniforms).forEach((function(a){var o=t.uniforms[a].append(e,r);Array.isArray(o)&&(o="["+o.join()+"]"),r.set(i.uniforms,"["+n.id(a)+"]",o)})),Object.keys(t.attributes).forEach((function(n){var i=t.attributes[n].append(e,r),a=e.scopeAttrib(n);Object.keys(new v).forEach((function(e){r.set(a,"."+e,i[e])}))})),t.scopeVAO&&r.set(i.vao,".targetVAO",t.scopeVAO.append(e,r)),o(Be),o(Ue),Object.keys(t.state).length>0&&(r(a,".dirty=true;"),r.exit(a,".dirty=true;")),r("a1(",e.shared.context,",a0,",e.batchId,");")}(s,c),function(e,t){var n=e.proc("batch",2);e.batchId="0",U(e,n);var r=!1,i=!0;Object.keys(t.context).forEach((function(e){r=r||t.context[e].propDep})),r||(z(e,n,t.context),i=!1);var a=t.framebuffer,o=!1;function s(e){return e.contextDep&&r||e.propDep}a?(a.propDep?r=o=!0:a.contextDep&&r&&(o=!0),o||k(e,n,a)):k(e,n,null),t.state.viewport&&t.state.viewport.propDep&&(r=!0),F(e,n,t),B(e,n,t.state,(function(e){return!s(e)})),t.profile&&s(t.profile)||G(e,n,t,!1,"a1"),t.contextDep=r,t.needsContext=i,t.needsFramebuffer=o;var c=t.shader.progVar;if(c.contextDep&&r||c.propDep)J(e,n,t,null);else{var u=c.append(e,n);if(n(e.shared.gl,".useProgram(",u,".program);"),t.shader.program)J(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var l=e.global.def("{}"),h=n.def(u,".id"),f=n.def(l,"[",h,"]");n(e.cond(f).then(f,".call(this,a0,a1);").else(f,"=",l,"[",h,"]=",e.link((function(n){return q(J,e,t,n,2)})),"(",u,");",f,".call(this,a0,a1);"))}}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;")}(s,c),t(s.compile(),{destroy:function(){c.shader.program.destroy()}})}}}var lt=function(e,t){if(!t.ext_disjoint_timer_query)return null;var n=[];function r(e){n.push(e)}var i=[];function a(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var o=[];function s(e){o.push(e)}var c=[];function u(e,t,n){var r=o.pop()||new a;r.startQueryIndex=e,r.endQueryIndex=t,r.sum=0,r.stats=n,c.push(r)}var l=[],h=[];return{beginQuery:function(e){var r=n.pop()||t.ext_disjoint_timer_query.createQueryEXT();t.ext_disjoint_timer_query.beginQueryEXT(35007,r),i.push(r),u(i.length-1,i.length,e)},endQuery:function(){t.ext_disjoint_timer_query.endQueryEXT(35007)},pushScopeStats:u,update:function(){var e,n,a=i.length;if(0!==a){h.length=Math.max(h.length,a+1),l.length=Math.max(l.length,a+1),l[0]=0,h[0]=0;var o=0;for(e=0,n=0;n<i.length;++n){var u=i[n];t.ext_disjoint_timer_query.getQueryObjectEXT(u,34919)?(o+=t.ext_disjoint_timer_query.getQueryObjectEXT(u,34918),r(u)):i[e++]=u,l[n+1]=o,h[n+1]=e}for(i.length=e,e=0,n=0;n<c.length;++n){var f=c[n],p=f.startQueryIndex,d=f.endQueryIndex;f.sum+=l[d]-l[p];var m=h[p],v=h[d];v===m?(f.stats.gpuTime+=f.sum/1e6,s(f)):(f.startQueryIndex=m,f.endQueryIndex=v,c[e++]=f)}c.length=e}},getNumPendingQueries:function(){return i.length},clear:function(){n.push.apply(n,i);for(var e=0;e<n.length;e++)t.ext_disjoint_timer_query.deleteQueryEXT(n[e]);i.length=0,n.length=0},restore:function(){i.length=0,n.length=0}}};function ht(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}return function(n){var r=C(n);if(!r)return null;var i=r.gl,a=i.getContextAttributes(),o=i.isContextLost(),s=function(e,t){var n={};function r(t){w.type(t,"string","extension name must be string");var r,i=t.toLowerCase();try{r=n[i]=e.getExtension(i)}catch(a){}return!!r}for(var i=0;i<t.extensions.length;++i){var a=t.extensions[i];if(!r(a))return t.onDestroy(),t.onDone('"'+a+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return t.optionalExtensions.forEach(r),{extensions:n,restore:function(){Object.keys(n).forEach((function(e){if(n[e]&&!r(e))throw new Error("(regl): error restoring extension "+e)}))}}}(i,r);if(!s)return null;var c=function(){var e={"":0},t=[""];return{id:function(n){var r=e[n];return r||(r=e[n]=t.length,t.push(n),r)},str:function(e){return t[e]}}}(),u={vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},l=s.extensions,h=lt(0,l),f=L(),p=i.drawingBufferWidth,d=i.drawingBufferHeight,m={tick:0,time:0,viewportWidth:p,viewportHeight:d,framebufferWidth:p,framebufferHeight:d,drawingBufferWidth:p,drawingBufferHeight:d,pixelRatio:r.pixelRatio},v=function(e,t){var n=1;t.ext_texture_filter_anisotropic&&(n=e.getParameter(34047));var r=1,i=1;t.webgl_draw_buffers&&(r=e.getParameter(34852),i=e.getParameter(36063));var a=!!t.oes_texture_float;if(a){var o=e.createTexture();e.bindTexture(3553,o),e.texImage2D(3553,0,6408,1,1,0,6408,5126,null);var s=e.createFramebuffer();if(e.bindFramebuffer(36160,s),e.framebufferTexture2D(36160,36064,3553,o,0),e.bindTexture(3553,null),36053!==e.checkFramebufferStatus(36160))a=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(16384);var c=N.allocType(5126,4);e.readPixels(0,0,1,1,6408,5126,c),e.getError()?a=!1:(e.deleteFramebuffer(s),e.deleteTexture(o),a=1===c[0]),N.freeType(c)}}var u=!0;if("undefined"===typeof navigator||!(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))){var l=e.createTexture(),h=N.allocType(5121,36);e.activeTexture(33984),e.bindTexture(34067,l),e.texImage2D(34069,0,6408,3,3,0,6408,5121,h),N.freeType(h),e.bindTexture(34067,null),e.deleteTexture(l),u=!e.getError()}return{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(t).filter((function(e){return!!t[e]})),maxAnisotropic:n,maxDrawbuffers:r,maxColorAttachments:i,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938),readFloat:a,npotTextureCube:u}}(i,l),g=function(t,n,r,i){var a=0,o={};function s(e){this.id=a++,this.buffer=t.createBuffer(),this.type=e,this.usage=35044,this.byteLength=0,this.dimension=1,this.dtype=5121,this.persistentData=null,r.profile&&(this.stats={size:0})}s.prototype.bind=function(){t.bindBuffer(this.type,this.buffer)},s.prototype.destroy=function(){h(this)};var c=[];function u(e,n,r){e.byteLength=n.byteLength,t.bufferData(e.type,n,r)}function l(t,n,r,i,a,o){var s,c;if(t.usage=r,Array.isArray(n)){if(t.dtype=i||5126,n.length>0)if(Array.isArray(n[0])){s=V(n);for(var l=1,h=1;h<s.length;++h)l*=s[h];t.dimension=l,u(t,c=j(n,s,t.dtype),r),o?t.persistentData=c:N.freeType(c)}else if("number"===typeof n[0]){t.dimension=a;var f=N.allocType(t.dtype,n.length);Y(f,n),u(t,f,r),o?t.persistentData=f:N.freeType(f)}else e(n[0])?(t.dimension=n[0].length,t.dtype=i||q(n[0])||5126,u(t,c=j(n,[n.length,n[0].length],t.dtype),r),o?t.persistentData=c:N.freeType(c)):w.raise("invalid buffer data")}else if(e(n))t.dtype=i||q(n),t.dimension=a,u(t,n,r),o&&(t.persistentData=new Uint8Array(new Uint8Array(n.buffer)));else if(z(n)){s=n.shape;var p=n.stride,d=n.offset,m=0,v=0,g=0,y=0;1===s.length?(m=s[0],v=1,g=p[0],y=0):2===s.length?(m=s[0],v=s[1],g=p[0],y=p[1]):w.raise("invalid shape"),t.dtype=i||q(n.data)||5126,t.dimension=v;var x=N.allocType(t.dtype,m*v);X(x,n.data,m,v,g,y,d),u(t,x,r),o?t.persistentData=x:N.freeType(x)}else n instanceof ArrayBuffer?(t.dtype=5121,t.dimension=a,u(t,n,r),o&&(t.persistentData=new Uint8Array(new Uint8Array(n)))):w.raise("invalid buffer data")}function h(e){n.bufferCount--,i(e);var r=e.buffer;w(r,"buffer must not be deleted already"),t.deleteBuffer(r),e.buffer=null,delete o[e.id]}return r.profile&&(n.getTotalBufferSize=function(){var e=0;return Object.keys(o).forEach((function(t){e+=o[t].stats.size})),e}),{create:function(i,a,c,u){n.bufferCount++;var f=new s(a);function p(n){var i=35044,a=null,o=0,s=0,c=1;return Array.isArray(n)||e(n)||z(n)||n instanceof ArrayBuffer?a=n:"number"===typeof n?o=0|n:n&&(w.type(n,"object","buffer arguments must be an object, a number or an array"),"data"in n&&(w(null===a||Array.isArray(a)||e(a)||z(a),"invalid data for buffer"),a=n.data),"usage"in n&&(w.parameter(n.usage,G,"invalid buffer usage"),i=G[n.usage]),"type"in n&&(w.parameter(n.type,H,"invalid buffer type"),s=H[n.type]),"dimension"in n&&(w.type(n.dimension,"number","invalid dimension"),c=0|n.dimension),"length"in n&&(w.nni(o,"buffer length must be a nonnegative integer"),o=0|n.length)),f.bind(),a?l(f,a,i,s,c,u):(o&&t.bufferData(f.type,o,i),f.dtype=s||5121,f.usage=i,f.dimension=c,f.byteLength=o),r.profile&&(f.stats.size=f.byteLength*W[f.dtype]),p}function d(e,n){w(n+e.byteLength<=f.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+e.byteLength+" starting from offset "+n+" to a buffer of size "+f.byteLength),t.bufferSubData(f.type,n,e)}return o[f.id]=f,c||p(i),p._reglType="buffer",p._buffer=f,p.subdata=function(t,n){var r,i=0|(n||0);if(f.bind(),e(t)||t instanceof ArrayBuffer)d(t,i);else if(Array.isArray(t)){if(t.length>0)if("number"===typeof t[0]){var a=N.allocType(f.dtype,t.length);Y(a,t),d(a,i),N.freeType(a)}else if(Array.isArray(t[0])||e(t[0])){r=V(t);var o=j(t,r,f.dtype);d(o,i),N.freeType(o)}else w.raise("invalid buffer data")}else if(z(t)){r=t.shape;var s=t.stride,c=0,u=0,l=0,h=0;1===r.length?(c=r[0],u=1,l=s[0],h=0):2===r.length?(c=r[0],u=r[1],l=s[0],h=s[1]):w.raise("invalid shape");var m=Array.isArray(t.data)?f.dtype:q(t.data),v=N.allocType(m,c*u);X(v,t.data,c,u,l,h,t.offset),d(v,i),N.freeType(v)}else w.raise("invalid data for buffer subdata");return p},r.profile&&(p.stats=f.stats),p.destroy=function(){h(f)},p},createStream:function(e,t){var n=c.pop();return n||(n=new s(e)),n.bind(),l(n,t,35040,0,1,!1),n},destroyStream:function(e){c.push(e)},clear:function(){k(o).forEach(h),c.forEach(h)},getBuffer:function(e){return e&&e._buffer instanceof s?e._buffer:null},restore:function(){k(o).forEach((function(e){e.buffer=t.createBuffer(),t.bindBuffer(e.type,e.buffer),t.bufferData(e.type,e.persistentData||e.byteLength,e.usage)}))},_initBuffer:l}}(i,u,r,(function(e){return y.destroyBuffer(e)})),y=function(t,n,r,i,a){for(var o=r.maxAttributes,s=new Array(o),c=0;c<o;++c)s[c]=new Oe;var u=0,l={},h={Record:Oe,scope:{},state:s,currentVAO:null,targetVAO:null,restore:f()?function(){f()&&k(l).forEach((function(e){e.refresh()}))}:function(){},createVAO:function(t){var r=new d;function s(t){w(Array.isArray(t),"arguments to vertex array constructor must be an array"),w(t.length<o,"too many attributes"),w(t.length>0,"must specify at least one attribute");var i={},c=r.attributes;c.length=t.length;for(var u=0;u<t.length;++u){var l,h=t[u],f=c[u]=new Oe,p=h.data||h;Array.isArray(p)||e(p)||z(p)?(r.buffers[u]&&(l=r.buffers[u],e(p)&&l._buffer.byteLength>=p.byteLength?l.subdata(p):(l.destroy(),r.buffers[u]=null)),r.buffers[u]||(l=r.buffers[u]=a.create(h,34962,!1,!0)),f.buffer=a.getBuffer(l),f.size=0|f.buffer.dimension,f.normalized=!1,f.type=f.buffer.dtype,f.offset=0,f.stride=0,f.divisor=0,f.state=1,i[u]=1):a.getBuffer(h)?(f.buffer=a.getBuffer(h),f.size=0|f.buffer.dimension,f.normalized=!1,f.type=f.buffer.dtype,f.offset=0,f.stride=0,f.divisor=0,f.state=1):a.getBuffer(h.buffer)?(f.buffer=a.getBuffer(h.buffer),f.size=0|(+h.size||f.buffer.dimension),f.normalized=!!h.normalized||!1,"type"in h?(w.parameter(h.type,H,"invalid buffer type"),f.type=H[h.type]):f.type=f.buffer.dtype,f.offset=0|(h.offset||0),f.stride=0|(h.stride||0),f.divisor=0|(h.divisor||0),f.state=1,w(f.size>=1&&f.size<=4,"size must be between 1 and 4"),w(f.offset>=0,"invalid offset"),w(f.stride>=0&&f.stride<=255,"stride must be between 0 and 255"),w(f.divisor>=0,"divisor must be positive"),w(!f.divisor||!!n.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in h?(w(u>0,"first attribute must not be a constant"),f.x=+h.x||0,f.y=+h.y||0,f.z=+h.z||0,f.w=+h.w||0,f.state=2):w(!1,"invalid attribute spec for location "+u)}for(var d=0;d<r.buffers.length;++d)!i[d]&&r.buffers[d]&&(r.buffers[d].destroy(),r.buffers[d]=null);return r.refresh(),s}return i.vaoCount+=1,s.destroy=function(){for(var e=0;e<r.buffers.length;++e)r.buffers[e]&&r.buffers[e].destroy();r.buffers.length=0,r.destroy()},s._vao=r,s._reglType="vao",s(t)},getVAO:function(e){return"function"===typeof e&&e._vao?e._vao:null},destroyBuffer:function(e){for(var n=0;n<s.length;++n){var r=s[n];r.buffer===e&&(t.disableVertexAttribArray(n),r.buffer=null)}},setVAO:f()?function(e){if(e!==h.currentVAO){var t=f();e?t.bindVertexArrayOES(e.vao):t.bindVertexArrayOES(null),h.currentVAO=e}}:function(e){if(e!==h.currentVAO){if(e)e.bindAttrs();else for(var n=p(),r=0;r<s.length;++r){var i=s[r];i.buffer?(t.enableVertexAttribArray(r),t.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offfset),n&&i.divisor&&n.vertexAttribDivisorANGLE(r,i.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}h.currentVAO=e}},clear:f()?function(){k(l).forEach((function(e){e.destroy()}))}:function(){}};function f(){return n.oes_vertex_array_object}function p(){return n.angle_instanced_arrays}function d(){this.id=++u,this.attributes=[];var e=f();this.vao=e?e.createVertexArrayOES():null,l[this.id]=this,this.buffers=[]}return d.prototype.bindAttrs=function(){for(var e=p(),n=this.attributes,r=0;r<n.length;++r){var i=n[r];i.buffer?(t.enableVertexAttribArray(r),t.bindBuffer(34962,i.buffer.buffer),t.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offset),e&&i.divisor&&e.vertexAttribDivisorANGLE(r,i.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}for(var a=n.length;a<o;++a)t.disableVertexAttribArray(a)},d.prototype.refresh=function(){var e=f();e&&(e.bindVertexArrayOES(this.vao),this.bindAttrs(),h.currentVAO=this)},d.prototype.destroy=function(){if(this.vao){var e=f();this===h.currentVAO&&(h.currentVAO=null,e.bindVertexArrayOES(null)),e.deleteVertexArrayOES(this.vao),this.vao=null}l[this.id]&&(delete l[this.id],i.vaoCount-=1)},h}(i,l,v,u,g),x=function(t,n,r,i){var a={},o=0,s={uint8:5121,uint16:5123};function c(e){this.id=o++,a[this.id]=this,this.buffer=e,this.primType=4,this.vertCount=0,this.type=0}n.oes_element_index_uint&&(s.uint32=5125),c.prototype.bind=function(){this.buffer.bind()};var u=[];function l(i,a,o,s,c,u,l){var h;if(i.buffer.bind(),a){var f=l;l||e(a)&&(!z(a)||e(a.data))||(f=n.oes_element_index_uint?5125:5123),r._initBuffer(i.buffer,a,o,f,3)}else t.bufferData(34963,u,o),i.buffer.dtype=h||5121,i.buffer.usage=o,i.buffer.dimension=3,i.buffer.byteLength=u;if(h=l,!l){switch(i.buffer.dtype){case 5121:case 5120:h=5121;break;case 5123:case 5122:h=5123;break;case 5125:case 5124:h=5125;break;default:w.raise("unsupported type for element array")}i.buffer.dtype=h}i.type=h,w(5125!==h||!!n.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var p=c;p<0&&(p=i.buffer.byteLength,5123===h?p>>=1:5125===h&&(p>>=2)),i.vertCount=p;var d=s;if(s<0){d=4;var m=i.buffer.dimension;1===m&&(d=0),2===m&&(d=1),3===m&&(d=4)}i.primType=d}function h(e){i.elementsCount--,w(null!==e.buffer,"must not double destroy elements"),delete a[e.id],e.buffer.destroy(),e.buffer=null}return{create:function(t,n){var a=r.create(null,34963,!0),o=new c(a._buffer);function u(t){if(t)if("number"===typeof t)a(t),o.primType=4,o.vertCount=0|t,o.type=5121;else{var n=null,r=35044,i=-1,c=-1,h=0,f=0;Array.isArray(t)||e(t)||z(t)?n=t:(w.type(t,"object","invalid arguments for elements"),"data"in t&&(n=t.data,w(Array.isArray(n)||e(n)||z(n),"invalid data for element buffer")),"usage"in t&&(w.parameter(t.usage,G,"invalid element buffer usage"),r=G[t.usage]),"primitive"in t&&(w.parameter(t.primitive,Z,"invalid element buffer primitive"),i=Z[t.primitive]),"count"in t&&(w("number"===typeof t.count&&t.count>=0,"invalid vertex count for elements"),c=0|t.count),"type"in t&&(w.parameter(t.type,s,"invalid buffer type"),f=s[t.type]),"length"in t?h=0|t.length:(h=c,5123===f||5122===f?h*=2:5125!==f&&5124!==f||(h*=4))),l(o,n,r,i,c,h,f)}else a(),o.primType=4,o.vertCount=0,o.type=5121;return u}return i.elementsCount++,u(t),u._reglType="elements",u._elements=o,u.subdata=function(e,t){return a.subdata(e,t),u},u.destroy=function(){h(o)},u},createStream:function(e){var t=u.pop();return t||(t=new c(r.create(null,34963,!0,!1)._buffer)),l(t,e,35040,-1,-1,0,0),t},destroyStream:function(e){u.push(e)},getElements:function(e){return"function"===typeof e&&e._elements instanceof c?e._elements:null},clear:function(){k(a).forEach(h)}}}(i,l,g,u),b=function(e,n,r,i){var a={},o={};function s(e,t,n,r){this.name=e,this.id=t,this.location=n,this.info=r}function c(e,t){for(var n=0;n<e.length;++n)if(e[n].id===t.id)return void(e[n].location=t.location);e.push(t)}function u(t,r,i){var s=35632===t?a:o,c=s[r];if(!c){var u=n.str(r);c=e.createShader(t),e.shaderSource(c,u),e.compileShader(c),w.shaderError(e,c,u,t,i),s[r]=c}return c}var l={},h=[],f=0;function p(e,t){this.id=f++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,i.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function d(t,r,a){var o,l,h=u(35632,t.fragId),f=u(35633,t.vertId),p=t.program=e.createProgram();if(e.attachShader(p,h),e.attachShader(p,f),a)for(o=0;o<a.length;++o){var d=a[o];e.bindAttribLocation(p,d[0],d[1])}e.linkProgram(p),w.linkError(e,p,n.str(t.fragId),n.str(t.vertId),r);var m=e.getProgramParameter(p,35718);i.profile&&(t.stats.uniformsCount=m);var v=t.uniforms;for(o=0;o<m;++o)if(l=e.getActiveUniform(p,o))if(l.size>1)for(var g=0;g<l.size;++g){var y=l.name.replace("[0]","["+g+"]");c(v,new s(y,n.id(y),e.getUniformLocation(p,y),l))}else c(v,new s(l.name,n.id(l.name),e.getUniformLocation(p,l.name),l));var x=e.getProgramParameter(p,35721);i.profile&&(t.stats.attributesCount=x);var b=t.attributes;for(o=0;o<x;++o)(l=e.getActiveAttrib(p,o))&&c(b,new s(l.name,n.id(l.name),e.getAttribLocation(p,l.name),l))}return i.profile&&(r.getMaxUniformsCount=function(){var e=0;return h.forEach((function(t){t.stats.uniformsCount>e&&(e=t.stats.uniformsCount)})),e},r.getMaxAttributesCount=function(){var e=0;return h.forEach((function(t){t.stats.attributesCount>e&&(e=t.stats.attributesCount)})),e}),{clear:function(){var t=e.deleteShader.bind(e);k(a).forEach(t),a={},k(o).forEach(t),o={},h.forEach((function(t){e.deleteProgram(t.program)})),h.length=0,l={},r.shaderCount=0},program:function(n,i,s,c){w.command(n>=0,"missing vertex shader",s),w.command(i>=0,"missing fragment shader",s);var u=l[i];u||(u=l[i]={});var f=u[n];if(f&&(f.refCount++,!c))return f;var m=new p(i,n);return r.shaderCount++,d(m,s,c),f||(u[n]=m),h.push(m),t(m,{destroy:function(){if(m.refCount--,m.refCount<=0){e.deleteProgram(m.program);var t=h.indexOf(m);h.splice(t,1),r.shaderCount--}u[m.vertId].refCount<=0&&(e.deleteShader(o[m.vertId]),delete o[m.vertId],delete l[m.fragId][m.vertId]),Object.keys(l[m.fragId]).length||(e.deleteShader(a[m.fragId]),delete a[m.fragId],delete l[m.fragId])}})},restore:function(){a={},o={};for(var e=0;e<h.length;++e)d(h[e],null,h[e].attributes.map((function(e){return[e.location,e.name]})))},shader:u,frag:-1,vert:-1}}(i,c,u,r),_=Ee(i,l,v,(function(){T.procs.poll()}),m,u,r),M=function(e,t,n,r,i){var a={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};t.ext_srgb&&(a.srgba=35907),t.ext_color_buffer_half_float&&(a.rgba16f=34842,a.rgb16f=34843),t.webgl_color_buffer_float&&(a.rgba32f=34836);var o=[];Object.keys(a).forEach((function(e){var t=a[e];o[t]=e}));var s=0,c={};function u(e){this.id=s++,this.refCount=1,this.renderbuffer=e,this.format=32854,this.width=0,this.height=0,i.profile&&(this.stats={size:0})}function l(t){var n=t.renderbuffer;w(n,"must not double destroy renderbuffer"),e.bindRenderbuffer(36161,null),e.deleteRenderbuffer(n),t.renderbuffer=null,t.refCount=0,delete c[t.id],r.renderbufferCount--}return u.prototype.decRef=function(){--this.refCount<=0&&l(this)},i.profile&&(r.getTotalRenderbufferSize=function(){var e=0;return Object.keys(c).forEach((function(t){e+=c[t].stats.size})),e}),{create:function(t,s){var l=new u(e.createRenderbuffer());function h(t,r){var s=0,c=0,u=32854;if("object"===typeof t&&t){var f=t;if("shape"in f){var p=f.shape;w(Array.isArray(p)&&p.length>=2,"invalid renderbuffer shape"),s=0|p[0],c=0|p[1]}else"radius"in f&&(s=c=0|f.radius),"width"in f&&(s=0|f.width),"height"in f&&(c=0|f.height);"format"in f&&(w.parameter(f.format,a,"invalid renderbuffer format"),u=a[f.format])}else"number"===typeof t?(s=0|t,c="number"===typeof r?0|r:s):t?w.raise("invalid arguments to renderbuffer constructor"):s=c=1;if(w(s>0&&c>0&&s<=n.maxRenderbufferSize&&c<=n.maxRenderbufferSize,"invalid renderbuffer size"),s!==l.width||c!==l.height||u!==l.format)return h.width=l.width=s,h.height=l.height=c,l.format=u,e.bindRenderbuffer(36161,l.renderbuffer),e.renderbufferStorage(36161,u,s,c),w(0===e.getError(),"invalid render buffer format"),i.profile&&(l.stats.size=Se(l.format,l.width,l.height)),h.format=o[l.format],h}return c[l.id]=l,r.renderbufferCount++,h(t,s),h.resize=function(t,r){var a=0|t,o=0|r||a;return a===l.width&&o===l.height||(w(a>0&&o>0&&a<=n.maxRenderbufferSize&&o<=n.maxRenderbufferSize,"invalid renderbuffer size"),h.width=l.width=a,h.height=l.height=o,e.bindRenderbuffer(36161,l.renderbuffer),e.renderbufferStorage(36161,l.format,a,o),w(0===e.getError(),"invalid render buffer format"),i.profile&&(l.stats.size=Se(l.format,l.width,l.height))),h},h._reglType="renderbuffer",h._renderbuffer=l,i.profile&&(h.stats=l.stats),h.destroy=function(){l.decRef()},h},clear:function(){k(c).forEach(l)},restore:function(){k(c).forEach((function(t){t.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,t.renderbuffer),e.renderbufferStorage(36161,t.format,t.width,t.height)})),e.bindRenderbuffer(36161,null)}}}(i,l,v,u,r),E=function(e,n,r,i,a,o){var s={cur:null,next:null,dirty:!1,setFBO:null},c=["rgba"],u=["rgba4","rgb565","rgb5 a1"];n.ext_srgb&&u.push("srgba"),n.ext_color_buffer_half_float&&u.push("rgba16f","rgb16f"),n.webgl_color_buffer_float&&u.push("rgba32f");var l=["uint8"];function h(e,t,n){this.target=e,this.texture=t,this.renderbuffer=n;var r=0,i=0;t?(r=t.width,i=t.height):n&&(r=n.width,i=n.height),this.width=r,this.height=i}function f(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function p(e,t,n){if(e)if(e.texture){var r=e.texture._texture,i=Math.max(1,r.width),a=Math.max(1,r.height);w(i===t&&a===n,"inconsistent width/height for supplied texture"),r.refCount+=1}else{var o=e.renderbuffer._renderbuffer;w(o.width===t&&o.height===n,"inconsistent width/height for renderbuffer"),o.refCount+=1}}function d(t,n){n&&(n.texture?e.framebufferTexture2D(36160,t,n.target,n.texture._texture.texture,0):e.framebufferRenderbuffer(36160,t,36161,n.renderbuffer._renderbuffer.renderbuffer))}function m(e){var t=3553,n=null,r=null,i=e;"object"===typeof e&&(i=e.data,"target"in e&&(t=0|e.target)),w.type(i,"function","invalid attachment data");var a=i._reglType;return"texture2d"===a?(n=i,w(3553===t)):"textureCube"===a?(n=i,w(t>=34069&&t<34075,"invalid cube map target")):"renderbuffer"===a?(r=i,t=36161):w.raise("invalid regl object for attachment"),new h(t,n,r)}function v(e,t,n,r,o){if(n){var s=i.create2D({width:e,height:t,format:r,type:o});return s._texture.refCount=0,new h(3553,s,null)}var c=a.create({width:e,height:t,format:r});return c._renderbuffer.refCount=0,new h(36161,null,c)}function g(e){return e&&(e.texture||e.renderbuffer)}function y(e,t,n){e&&(e.texture?e.texture.resize(t,n):e.renderbuffer&&e.renderbuffer.resize(t,n),e.width=t,e.height=n)}n.oes_texture_half_float&&l.push("half float","float16"),n.oes_texture_float&&l.push("float","float32");var x=0,b={};function _(){this.id=x++,b[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function M(e){e.colorAttachments.forEach(f),f(e.depthAttachment),f(e.stencilAttachment),f(e.depthStencilAttachment)}function E(t){var n=t.framebuffer;w(n,"must not double destroy framebuffer"),e.deleteFramebuffer(n),t.framebuffer=null,o.framebufferCount--,delete b[t.id]}function T(t){var n;e.bindFramebuffer(36160,t.framebuffer);var i=t.colorAttachments;for(n=0;n<i.length;++n)d(36064+n,i[n]);for(n=i.length;n<r.maxColorAttachments;++n)e.framebufferTexture2D(36160,36064+n,3553,null,0);e.framebufferTexture2D(36160,33306,3553,null,0),e.framebufferTexture2D(36160,36096,3553,null,0),e.framebufferTexture2D(36160,36128,3553,null,0),d(36096,t.depthAttachment),d(36128,t.stencilAttachment),d(33306,t.depthStencilAttachment);var a=e.checkFramebufferStatus(36160);e.isContextLost()||36053===a||w.raise("framebuffer configuration not supported, status = "+Ce[a]),e.bindFramebuffer(36160,s.next?s.next.framebuffer:null),s.cur=s.next,e.getError()}function S(e,i){var a=new _;function h(e,t){var i;w(s.next!==a,"can not update framebuffer which is currently in use");var o=0,f=0,d=!0,y=!0,x=null,b=!0,_="rgba",E="uint8",S=1,A=null,L=null,R=null,P=!1;if("number"===typeof e)o=0|e,f=0|t||o;else if(e){w.type(e,"object","invalid arguments for framebuffer");var C=e;if("shape"in C){var O=C.shape;w(Array.isArray(O)&&O.length>=2,"invalid shape for framebuffer"),o=O[0],f=O[1]}else"radius"in C&&(o=f=C.radius),"width"in C&&(o=C.width),"height"in C&&(f=C.height);("color"in C||"colors"in C)&&(x=C.color||C.colors,Array.isArray(x)&&w(1===x.length||n.webgl_draw_buffers,"multiple render targets not supported")),x||("colorCount"in C&&(S=0|C.colorCount,w(S>0,"invalid color buffer count")),"colorTexture"in C&&(b=!!C.colorTexture,_="rgba4"),"colorType"in C&&(E=C.colorType,b?(w(n.oes_texture_float||!("float"===E||"float32"===E),"you must enable OES_texture_float in order to use floating point framebuffer objects"),w(n.oes_texture_half_float||!("half float"===E||"float16"===E),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===E||"float16"===E?(w(n.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),_="rgba16f"):"float"!==E&&"float32"!==E||(w(n.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),_="rgba32f"),w.oneOf(E,l,"invalid color type")),"colorFormat"in C&&(_=C.colorFormat,c.indexOf(_)>=0?b=!0:u.indexOf(_)>=0?b=!1:b?w.oneOf(C.colorFormat,c,"invalid color format for texture"):w.oneOf(C.colorFormat,u,"invalid color format for renderbuffer"))),("depthTexture"in C||"depthStencilTexture"in C)&&(P=!(!C.depthTexture&&!C.depthStencilTexture),w(!P||n.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in C&&("boolean"===typeof C.depth?d=C.depth:(A=C.depth,y=!1)),"stencil"in C&&("boolean"===typeof C.stencil?y=C.stencil:(L=C.stencil,d=!1)),"depthStencil"in C&&("boolean"===typeof C.depthStencil?d=y=C.depthStencil:(R=C.depthStencil,d=!1,y=!1))}else o=f=1;var D=null,I=null,N=null,z=null;if(Array.isArray(x))D=x.map(m);else if(x)D=[m(x)];else for(D=new Array(S),i=0;i<S;++i)D[i]=v(o,f,b,_,E);w(n.webgl_draw_buffers||D.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),w(D.length<=r.maxColorAttachments,"too many color attachments, not supported"),o=o||D[0].width,f=f||D[0].height,A?I=m(A):d&&!y&&(I=v(o,f,P,"depth","uint32")),L?N=m(L):y&&!d&&(N=v(o,f,!1,"stencil","uint8")),R?z=m(R):!A&&!L&&y&&d&&(z=v(o,f,P,"depth stencil","depth stencil")),w(!!A+!!L+!!R<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var k=null;for(i=0;i<D.length;++i)if(p(D[i],o,f),w(!D[i]||D[i].texture&&Ae.indexOf(D[i].texture._texture.format)>=0||D[i].renderbuffer&&Pe.indexOf(D[i].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+i+" is invalid"),D[i]&&D[i].texture){var F=Le[D[i].texture._texture.format]*Re[D[i].texture._texture.type];null===k?k=F:w(k===F,"all color attachments much have the same number of bits per pixel.")}return p(I,o,f),w(!I||I.texture&&6402===I.texture._texture.format||I.renderbuffer&&33189===I.renderbuffer._renderbuffer.format,"invalid depth attachment for framebuffer object"),p(N,o,f),w(!N||N.renderbuffer&&36168===N.renderbuffer._renderbuffer.format,"invalid stencil attachment for framebuffer object"),p(z,o,f),w(!z||z.texture&&34041===z.texture._texture.format||z.renderbuffer&&34041===z.renderbuffer._renderbuffer.format,"invalid depth-stencil attachment for framebuffer object"),M(a),a.width=o,a.height=f,a.colorAttachments=D,a.depthAttachment=I,a.stencilAttachment=N,a.depthStencilAttachment=z,h.color=D.map(g),h.depth=g(I),h.stencil=g(N),h.depthStencil=g(z),h.width=a.width,h.height=a.height,T(a),h}return o.framebufferCount++,h(e,i),t(h,{resize:function(e,t){w(s.next!==a,"can not resize a framebuffer which is currently in use");var n=Math.max(0|e,1),r=Math.max(0|t||n,1);if(n===a.width&&r===a.height)return h;for(var i=a.colorAttachments,o=0;o<i.length;++o)y(i[o],n,r);return y(a.depthAttachment,n,r),y(a.stencilAttachment,n,r),y(a.depthStencilAttachment,n,r),a.width=h.width=n,a.height=h.height=r,T(a),h},_reglType:"framebuffer",_framebuffer:a,destroy:function(){E(a),M(a)},use:function(e){s.setFBO({framebuffer:h},e)}})}return t(s,{getFramebuffer:function(e){if("function"===typeof e&&"framebuffer"===e._reglType){var t=e._framebuffer;if(t instanceof _)return t}return null},create:S,createCube:function(e){var a=Array(6);function o(e){var r;w(a.indexOf(s.next)<0,"can not update framebuffer which is currently in use");var u,h={color:null},f=0,p=null,d="rgba",m="uint8",v=1;if("number"===typeof e)f=0|e;else if(e){w.type(e,"object","invalid arguments for framebuffer");var g=e;if("shape"in g){var y=g.shape;w(Array.isArray(y)&&y.length>=2,"invalid shape for framebuffer"),w(y[0]===y[1],"cube framebuffer must be square"),f=y[0]}else"radius"in g&&(f=0|g.radius),"width"in g?(f=0|g.width,"height"in g&&w(g.height===f,"must be square")):"height"in g&&(f=0|g.height);("color"in g||"colors"in g)&&(p=g.color||g.colors,Array.isArray(p)&&w(1===p.length||n.webgl_draw_buffers,"multiple render targets not supported")),p||("colorCount"in g&&(v=0|g.colorCount,w(v>0,"invalid color buffer count")),"colorType"in g&&(w.oneOf(g.colorType,l,"invalid color type"),m=g.colorType),"colorFormat"in g&&(d=g.colorFormat,w.oneOf(g.colorFormat,c,"invalid color format for texture"))),"depth"in g&&(h.depth=g.depth),"stencil"in g&&(h.stencil=g.stencil),"depthStencil"in g&&(h.depthStencil=g.depthStencil)}else f=1;if(p)if(Array.isArray(p))for(u=[],r=0;r<p.length;++r)u[r]=p[r];else u=[p];else{u=Array(v);var x={radius:f,format:d,type:m};for(r=0;r<v;++r)u[r]=i.createCube(x)}for(h.color=Array(u.length),r=0;r<u.length;++r){var b=u[r];w("function"===typeof b&&"textureCube"===b._reglType,"invalid cube map"),f=f||b.width,w(b.width===f&&b.height===f,"invalid cube map shape"),h.color[r]={target:34069,data:u[r]}}for(r=0;r<6;++r){for(var _=0;_<u.length;++_)h.color[_].target=34069+r;r>0&&(h.depth=a[0].depth,h.stencil=a[0].stencil,h.depthStencil=a[0].depthStencil),a[r]?a[r](h):a[r]=S(h)}return t(o,{width:f,height:f,color:u})}return o(e),t(o,{faces:a,resize:function(e){var t,n=0|e;if(w(n>0&&n<=r.maxCubeMapSize,"invalid radius for cube fbo"),n===o.width)return o;var i=o.color;for(t=0;t<i.length;++t)i[t].resize(n);for(t=0;t<6;++t)a[t].resize(n);return o.width=o.height=n,o},_reglType:"framebufferCube",destroy:function(){a.forEach((function(e){e.destroy()}))}})},clear:function(){k(b).forEach(E)},restore:function(){s.cur=null,s.next=null,s.dirty=!0,k(b).forEach((function(t){t.framebuffer=e.createFramebuffer(),T(t)}))}})}(i,l,v,_,M,u),T=ut(i,c,l,v,g,x,0,E,{},y,b,{elements:null,primitive:4,count:-1,offset:0,instances:-1},m,h,r),R=De(i,E,T.procs.poll,m,a,l,v),P=T.next,O=i.canvas,D=[],I=[],F=[],B=[r.onDestroy],U=null;function J(){if(0===D.length)return h&&h.update(),void(U=null);U=A.next(J),oe();for(var e=D.length-1;e>=0;--e){var t=D[e];t&&t(m,null,0)}i.flush(),h&&h.update()}function Q(){!U&&D.length>0&&(U=A.next(J))}function K(){U&&(A.cancel(J),U=null)}function $(e){e.preventDefault(),o=!0,K(),I.forEach((function(e){e()}))}function ee(e){i.getError(),o=!1,s.restore(),b.restore(),g.restore(),_.restore(),M.restore(),E.restore(),y.restore(),h&&h.restore(),T.procs.refresh(),Q(),F.forEach((function(e){e()}))}function te(e){function n(e,t){var n={},r={};return Object.keys(e).forEach((function(i){var a=e[i];if(S.isDynamic(a))r[i]=S.unbox(a,i);else{if(t&&Array.isArray(a))for(var o=0;o<a.length;++o)if(S.isDynamic(a[o]))return void(r[i]=S.unbox(a,i));n[i]=a}})),{dynamic:r,static:n}}w(!!e,"invalid args to regl({...})"),w.type(e,"object","invalid args to regl({...})");var r=n(e.context||{},!0),i=n(e.uniforms||{},!0),a=n(e.attributes||{},!1),s=n(function(e){var n=t({},e);function r(e){if(e in n){var t=n[e];delete n[e],Object.keys(t).forEach((function(r){n[e+"."+r]=t[r]}))}}return delete n.uniforms,delete n.attributes,delete n.context,delete n.vao,"stencil"in n&&n.stencil.op&&(n.stencil.opBack=n.stencil.opFront=n.stencil.op,delete n.stencil.op),r("blend"),r("depth"),r("cull"),r("stencil"),r("polygonOffset"),r("scissor"),r("sample"),"vao"in e&&(n.vao=e.vao),n}(e),!1),c={gpuTime:0,cpuTime:0,count:0},u=T.compile(s,a,i,r,c),l=u.draw,h=u.batch,f=u.scope,p=[];return t((function(e,t){var n;if(o&&w.raise("context lost"),"function"===typeof e)return f.call(this,null,e,0);if("function"===typeof t)if("number"===typeof e)for(n=0;n<e;++n)f.call(this,null,t,n);else{if(!Array.isArray(e))return f.call(this,e,t,0);for(n=0;n<e.length;++n)f.call(this,e[n],t,n)}else if("number"===typeof e){if(e>0)return h.call(this,function(e){for(;p.length<e;)p.push(null);return p}(0|e),0|e)}else{if(!Array.isArray(e))return l.call(this,e);if(e.length)return h.call(this,e,e.length)}}),{stats:c,destroy:function(){u.destroy()}})}O&&(O.addEventListener("webglcontextlost",$,!1),O.addEventListener("webglcontextrestored",ee,!1));var ne=E.setFBO=te({framebuffer:S.define.call(null,1,"framebuffer")});function re(e,t){var n=0;T.procs.poll();var r=t.color;r&&(i.clearColor(+r[0]||0,+r[1]||0,+r[2]||0,+r[3]||0),n|=16384),"depth"in t&&(i.clearDepth(+t.depth),n|=256),"stencil"in t&&(i.clearStencil(0|t.stencil),n|=1024),w(!!n,"called regl.clear with no buffer specified"),i.clear(n)}function ie(e){return w.type(e,"function","regl.frame() callback must be a function"),D.push(e),Q(),{cancel:function(){var t=ht(D,e);w(t>=0,"cannot cancel a frame twice"),D[t]=function e(){var t=ht(D,e);D[t]=D[D.length-1],D.length-=1,D.length<=0&&K()}}}}function ae(){var e=P.viewport,t=P.scissor_box;e[0]=e[1]=t[0]=t[1]=0,m.viewportWidth=m.framebufferWidth=m.drawingBufferWidth=e[2]=t[2]=i.drawingBufferWidth,m.viewportHeight=m.framebufferHeight=m.drawingBufferHeight=e[3]=t[3]=i.drawingBufferHeight}function oe(){m.tick+=1,m.time=ce(),ae(),T.procs.poll()}function se(){_.refresh(),ae(),T.procs.refresh(),h&&h.update()}function ce(){return(L()-f)/1e3}se();var ue=t(te,{clear:function(e){if(w("object"===typeof e&&e,"regl.clear() takes an object as input"),"framebuffer"in e)if(e.framebuffer&&"framebufferCube"===e.framebuffer_reglType)for(var n=0;n<6;++n)ne(t({framebuffer:e.framebuffer.faces[n]},e),re);else ne(e,re);else re(0,e)},prop:S.define.bind(null,1),context:S.define.bind(null,2),this:S.define.bind(null,3),draw:te({}),buffer:function(e){return g.create(e,34962,!1,!1)},elements:function(e){return x.create(e,!1)},texture:_.create2D,cube:_.createCube,renderbuffer:M.create,framebuffer:E.create,framebufferCube:E.createCube,vao:y.createVAO,attributes:a,frame:ie,on:function(e,t){var n;switch(w.type(t,"function","listener callback must be a function"),e){case"frame":return ie(t);case"lost":n=I;break;case"restore":n=F;break;case"destroy":n=B;break;default:w.raise("invalid event, must be one of frame,lost,restore,destroy")}return n.push(t),{cancel:function(){for(var e=0;e<n.length;++e)if(n[e]===t)return n[e]=n[n.length-1],void n.pop()}}},limits:v,hasExtension:function(e){return v.extensions.indexOf(e.toLowerCase())>=0},read:R,destroy:function(){D.length=0,K(),O&&(O.removeEventListener("webglcontextlost",$),O.removeEventListener("webglcontextrestored",ee)),b.clear(),E.clear(),M.clear(),_.clear(),x.clear(),g.clear(),y.clear(),h&&h.clear(),B.forEach((function(e){e()}))},_gl:i,_refresh:se,poll:function(){oe(),h&&h.update()},now:ce,stats:u});return r.onDone(null,ue),ue}}()},function(e,t){e.exports=function(e){e="undefined"!==typeof e?e:1,Array.isArray(e)||(e=[e,e]);var t=[[-e[0],-e[1],0],[e[0],-e[1],0],[e[0],e[1],0],[-e[0],e[1],0]],n=[0,0,-1],r=[n.slice(),n.slice(),n.slice(),n.slice()];return{positions:t,cells:[[0,1,2],[2,3,0]],uvs:[[0,0],[1,0],[1,1],[0,1]],normals:r}}},function(e,t,n){var r=n(52);e.exports=function(e){var t,n,i,a;if(t=/^((?:rgb|hs[lv]|cmyk|xyz|lab)a?)\s*\(([^\)]*)\)/.exec(e)){var o=t[1],s="cmyk"===(c=o.replace(/a$/,""))?4:3;n=r[c],i=t[2].replace(/^\s+|\s+$/g,"").split(/\s*,\s*/).map((function(e,t){return/%$/.test(e)&&t===s?parseFloat(e)/100:(/%$/.test(e),parseFloat(e))})),o===c&&i.push(1),a=void 0===i[s]?1:i[s],i=i.slice(0,s),n[c]=function(){return i}}else if(/^#[A-Fa-f0-9]+$/.test(e)){var c;s=(c=e.replace(/^#/,"")).length;n=r.rgb,i=(i=c.split(3===s?/(.)/:/(..)/)).filter(Boolean).map((function(e){return 3===s?parseInt(e+e,16):parseInt(e,16)})),a=1,n.rgb=function(){return i},i[0]||(i[0]=0),i[1]||(i[1]=0),i[2]||(i[2]=0)}else(n=r.keyword).keyword=function(){return e},i=e,a=1;var u={rgb:void 0,hsl:void 0,hsv:void 0,cmyk:void 0,keyword:void 0,hex:void 0};try{u.rgb=n.rgb(i)}catch(l){}try{u.hsl=n.hsl(i)}catch(l){}try{u.hsv=n.hsv(i)}catch(l){}try{u.cmyk=n.cmyk(i)}catch(l){}try{u.keyword=n.keyword(i)}catch(l){}return u.rgb&&(u.hex="#"+u.rgb.map((function(e){var t=e.toString(16);return 1===t.length?"0"+t:t})).join("")),u.rgb&&(u.rgba=u.rgb.concat(a)),u.hsl&&(u.hsla=u.hsl.concat(a)),u.hsv&&(u.hsva=u.hsv.concat(a)),u.cmyk&&(u.cmyka=u.cmyk.concat(a)),u}},function(e,t,n){var r=n(53),i=function(){return new u};for(var a in r){i[a+"Raw"]=function(e){return function(t){return"number"==typeof t&&(t=Array.prototype.slice.call(arguments)),r[e](t)}}(a);var o=/(\w+)2(\w+)/.exec(a),s=o[1],c=o[2];(i[s]=i[s]||{})[c]=i[a]=function(e){return function(t){"number"==typeof t&&(t=Array.prototype.slice.call(arguments));var n=r[e](t);if("string"==typeof n||void 0===n)return n;for(var i=0;i<n.length;i++)n[i]=Math.round(n[i]);return n}}(a)}var u=function(){this.convs={}};u.prototype.routeSpace=function(e,t){var n=t[0];return void 0===n?this.getValues(e):("number"==typeof n&&(n=Array.prototype.slice.call(t)),this.setValues(e,n))},u.prototype.setValues=function(e,t){return this.space=e,this.convs={},this.convs[e]=t,this},u.prototype.getValues=function(e){var t=this.convs[e];if(!t){var n=this.space,r=this.convs[n];t=i[n][e](r),this.convs[e]=t}return t},["rgb","hsl","hsv","cmyk","keyword"].forEach((function(e){u.prototype[e]=function(t){return this.routeSpace(e,arguments)}})),e.exports=i},function(e,t){function n(e){var t,n,r=e[0]/255,i=e[1]/255,a=e[2]/255,o=Math.min(r,i,a),s=Math.max(r,i,a),c=s-o;return s==o?t=0:r==s?t=(i-a)/c:i==s?t=2+(a-r)/c:a==s&&(t=4+(r-i)/c),(t=Math.min(60*t,360))<0&&(t+=360),n=(o+s)/2,[t,100*(s==o?0:n<=.5?c/(s+o):c/(2-s-o)),100*n]}function i(e){var t,n,r=e[0],i=e[1],a=e[2],o=Math.min(r,i,a),s=Math.max(r,i,a),c=s-o;return n=0==s?0:c/s*1e3/10,s==o?t=0:r==s?t=(i-a)/c:i==s?t=2+(a-r)/c:a==s&&(t=4+(r-i)/c),(t=Math.min(60*t,360))<0&&(t+=360),[t,n,s/255*1e3/10]}function a(e){var t=e[0],r=e[1],i=e[2];return[n(e)[0],100*(1/255*Math.min(t,Math.min(r,i))),100*(i=1-1/255*Math.max(t,Math.max(r,i)))]}function o(e){var t,n=e[0]/255,r=e[1]/255,i=e[2]/255;return[100*((1-n-(t=Math.min(1-n,1-r,1-i)))/(1-t)||0),100*((1-r-t)/(1-t)||0),100*((1-i-t)/(1-t)||0),100*t]}function s(e){return E[JSON.stringify(e)]}function c(e){var t=e[0]/255,n=e[1]/255,r=e[2]/255;return[100*(.4124*(t=t>.04045?Math.pow((t+.055)/1.055,2.4):t/12.92)+.3576*(n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92)+.1805*(r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92)),100*(.2126*t+.7152*n+.0722*r),100*(.0193*t+.1192*n+.9505*r)]}function u(e){var t=c(e),n=t[0],r=t[1],i=t[2];return r/=100,i/=108.883,n=(n/=95.047)>.008856?Math.pow(n,1/3):7.787*n+16/116,[116*(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116)-16,500*(n-r),200*(r-(i=i>.008856?Math.pow(i,1/3):7.787*i+16/116))]}function l(e){var t,n,r,i,a,o=e[0]/360,s=e[1]/100,c=e[2]/100;if(0==s)return[a=255*c,a,a];t=2*c-(n=c<.5?c*(1+s):c+s-c*s),i=[0,0,0];for(var u=0;u<3;u++)(r=o+1/3*-(u-1))<0&&r++,r>1&&r--,a=6*r<1?t+6*(n-t)*r:2*r<1?n:3*r<2?t+(n-t)*(2/3-r)*6:t,i[u]=255*a;return i}function h(e){var t=e[0]/60,n=e[1]/100,r=e[2]/100,i=Math.floor(t)%6,a=t-Math.floor(t),o=255*r*(1-n),s=255*r*(1-n*a),c=255*r*(1-n*(1-a));r*=255;switch(i){case 0:return[r,c,o];case 1:return[s,r,o];case 2:return[o,r,c];case 3:return[o,s,r];case 4:return[c,o,r];case 5:return[r,o,s]}}function f(e){var t,n,i,a,o=e[0]/360,s=e[1]/100,c=e[2]/100,u=s+c;switch(u>1&&(s/=u,c/=u),i=6*o-(t=Math.floor(6*o)),0!=(1&t)&&(i=1-i),a=s+i*((n=1-c)-s),t){default:case 6:case 0:r=n,g=a,b=s;break;case 1:r=a,g=n,b=s;break;case 2:r=s,g=n,b=a;break;case 3:r=s,g=a,b=n;break;case 4:r=a,g=s,b=n;break;case 5:r=n,g=s,b=a}return[255*r,255*g,255*b]}function p(e){var t=e[0]/100,n=e[1]/100,r=e[2]/100,i=e[3]/100;return[255*(1-Math.min(1,t*(1-i)+i)),255*(1-Math.min(1,n*(1-i)+i)),255*(1-Math.min(1,r*(1-i)+i))]}function d(e){var t,n,r,i=e[0]/100,a=e[1]/100,o=e[2]/100;return n=-.9689*i+1.8758*a+.0415*o,r=.0557*i+-.204*a+1.057*o,t=(t=3.2406*i+-1.5372*a+-.4986*o)>.0031308?1.055*Math.pow(t,1/2.4)-.055:t*=12.92,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:n*=12.92,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:r*=12.92,[255*(t=Math.min(Math.max(0,t),1)),255*(n=Math.min(Math.max(0,n),1)),255*(r=Math.min(Math.max(0,r),1))]}function m(e){var t=e[0],n=e[1],r=e[2];return n/=100,r/=108.883,t=(t/=95.047)>.008856?Math.pow(t,1/3):7.787*t+16/116,[116*(n=n>.008856?Math.pow(n,1/3):7.787*n+16/116)-16,500*(t-n),200*(n-(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116))]}function v(e){var t,n,r,i,a=e[0],o=e[1],s=e[2];return a<=8?i=(n=100*a/903.3)/100*7.787+16/116:(n=100*Math.pow((a+16)/116,3),i=Math.pow(n/100,1/3)),[t=t/95.047<=.008856?t=95.047*(o/500+i-16/116)/7.787:95.047*Math.pow(o/500+i,3),n,r=r/108.883<=.008859?r=108.883*(i-s/200-16/116)/7.787:108.883*Math.pow(i-s/200,3)]}function y(e){var t,n=e[0],r=e[1],i=e[2];return(t=360*Math.atan2(i,r)/2/Math.PI)<0&&(t+=360),[n,Math.sqrt(r*r+i*i),t]}function x(e){return d(v(e))}function w(e){var t,n=e[0],r=e[1];return t=e[2]/360*2*Math.PI,[n,r*Math.cos(t),r*Math.sin(t)]}function _(e){return M[e]}e.exports={rgb2hsl:n,rgb2hsv:i,rgb2hwb:a,rgb2cmyk:o,rgb2keyword:s,rgb2xyz:c,rgb2lab:u,rgb2lch:function(e){return y(u(e))},hsl2rgb:l,hsl2hsv:function(e){var t=e[0],n=e[1]/100,r=e[2]/100;if(0===r)return[0,0,0];return[t,100*(2*(n*=(r*=2)<=1?r:2-r)/(r+n)),100*((r+n)/2)]},hsl2hwb:function(e){return a(l(e))},hsl2cmyk:function(e){return o(l(e))},hsl2keyword:function(e){return s(l(e))},hsv2rgb:h,hsv2hsl:function(e){var t,n,r=e[0],i=e[1]/100,a=e[2]/100;return t=i*a,[r,100*(t=(t/=(n=(2-i)*a)<=1?n:2-n)||0),100*(n/=2)]},hsv2hwb:function(e){return a(h(e))},hsv2cmyk:function(e){return o(h(e))},hsv2keyword:function(e){return s(h(e))},hwb2rgb:f,hwb2hsl:function(e){return n(f(e))},hwb2hsv:function(e){return i(f(e))},hwb2cmyk:function(e){return o(f(e))},hwb2keyword:function(e){return s(f(e))},cmyk2rgb:p,cmyk2hsl:function(e){return n(p(e))},cmyk2hsv:function(e){return i(p(e))},cmyk2hwb:function(e){return a(p(e))},cmyk2keyword:function(e){return s(p(e))},keyword2rgb:_,keyword2hsl:function(e){return n(_(e))},keyword2hsv:function(e){return i(_(e))},keyword2hwb:function(e){return a(_(e))},keyword2cmyk:function(e){return o(_(e))},keyword2lab:function(e){return u(_(e))},keyword2xyz:function(e){return c(_(e))},xyz2rgb:d,xyz2lab:m,xyz2lch:function(e){return y(m(e))},lab2xyz:v,lab2rgb:x,lab2lch:y,lch2lab:w,lch2xyz:function(e){return v(w(e))},lch2rgb:function(e){return x(w(e))}};var M={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},E={};for(var T in M)E[JSON.stringify(M[T])]=T},function(e,t,n){var r=n(55),i=n(9),a=n(58),o=n(10),s=n(11),c=n(12);e.exports.parse=r.parse,e.exports.style=r.style,e.exports.names=i,e.exports.relativeLuminance=function(t){var n=e.exports.parse(t);return n?a(n.rgb):null},e.exports.contrastRatio=function(t,n){var r=e.exports.relativeLuminance(t),i=e.exports.relativeLuminance(n);return null==r||null==i?null:(Math.max(r,i)+.05)/(Math.min(r,i)+.05)},e.exports.offsetHSL=function(t,n,r,i){var a=e.exports.parse(t);return a?(a.hsla[0]+=n||0,a.hsla[1]=Math.max(0,Math.min(100,a.hsla[1]+(r||0))),a.hsla[2]=Math.max(0,Math.min(100,a.hsla[2]+(i||0))),e.exports.parse({hsla:a.hsla})):null},e.exports.blend=function(t,n,r){var i=e.exports.parse(t),a=e.exports.parse(n);if(null==i||null==a)return null;var o=i.rgba,s=a.rgba,c=(r="number"===typeof r&&isFinite(r)?r:1)*s[3];if(c>=1)return a;for(var u=0;u<3;u++)s[u]=s[u]*c+o[u]*(o[3]*(1-c));return s[3]=Math.max(0,Math.min(1,c+o[3]*(1-c))),e.exports.parse(s)},e.exports.hexToRGBA=s,e.exports.RGBAToHex=c,e.exports.RGBAToHSLA=o.RGBAToHSLA,e.exports.HSLAToRGBA=o.HSLAToRGBA},function(e,t,n){var r=n(9),i=n(10),a=n(11),o=n(12),s=n(2);function c(e){if("string"!==typeof e)throw new TypeError("Color parsing must be performed on a string parameter");var t,n,c;if((e=e.toLowerCase())in r?e=r[e]:"transparent"===e&&(e="#00000000"),/^#[a-f0-9]+$/.test(e))t=a(e),c=o(t),n=i.RGBAToHSLA(t);else{var u=/^((?:rgb|hsl)a?)\s*\(([^)]*)\)/.exec(e);if(!u)return null;var l=u[1].replace(/a$/,""),h=u[2].replace(/^\s+|\s+$/g,"").split(/\s*,\s*/).map((function(e,t){return t<=2?Math.round(parseFloat(e)||0):("number"===typeof(e=parseFloat(e))&&isFinite(e)||(e=1),e)}));"undefined"!==typeof h[3]&&isFinite(h[3])||(h[3]=1),"rgb"===l?(n=i.RGBAToHSLA(h),t=h):"hsl"===l&&(t=i.HSLAToRGBA(h),h[0]=s(h[0],0,360),n=h),c=o(t)}return t||c||n?{hex:c,alpha:t[3],rgb:t.slice(0,3),rgba:t,hsl:n.slice(0,3),hsla:n}:null}function u(e,t,n,r){return e=Math.max(0,Math.min(255,Math.round(e))),t=Math.max(0,Math.min(255,Math.round(t))),n=Math.max(0,Math.min(255,Math.round(n))),1!==r&&isFinite(r)&&"undefined"!==typeof r?"rgba("+[e,t,n,r=Math.max(0,Math.min(1,r))].join(", ")+")":"rgb("+[e,t,n].join(", ")+")"}function l(e,t,n,r){return e=s(e,0,360),e=Math.max(0,Math.min(360,Math.round(e))),t=Math.max(0,Math.min(100,Math.round(t))),n=Math.max(0,Math.min(100,Math.round(n))),1!==r&&isFinite(r)&&"undefined"!==typeof r?"hsla("+[e,t,n,r=Math.max(0,Math.min(1,r))].join(", ")+")":"hsl("+[e,t,n].join(", ")+")"}e.exports.parse=function(e){if("string"===typeof e)return c(e);var t;if(Array.isArray(e)&&e.length>=3)return c(u(e[0],e[1],e[2],e[3]));if(e&&"object"===typeof e&&(e.hex?t=e.hex:e.rgba?t=u(e.rgba[0],e.rgba[1],e.rgba[2],e.rgba[3]):e.hsla?t=l(e.hsla[0],e.hsla[1],e.hsla[2],e.hsla[3]):e.rgb?t=u(e.rgb[0],e.rgb[1],e.rgb[2]):e.hsl&&(t=l(e.hsl[0],e.hsl[1],e.hsl[2])),t))return c(t);return null},e.exports.style=function(t){var n=e.exports.parse(t);if(n){var r=n.rgba;return u(r[0],r[1],r[2],r[3])}return null}},function(e,t){e.exports=function(e){var t,n,r,i,a,o=e[0],s=e[1],c=e[2];if(0===s)return[a=c,a,a];n=c<.5?c*(1+s):c+s-c*s;t=2*c-n,i=[0,0,0];for(var u=0;u<3;u++)(r=o+1/3*-(u-1))<0&&r++,r>1&&r--,a=6*r<1?t+6*(n-t)*r:2*r<1?n:3*r<2?t+(n-t)*(2/3-r)*6:t,i[u]=a;return i}},function(e,t){e.exports=function(e){var t,n,r,i=e[0],a=e[1],o=e[2],s=Math.min(i,a,o),c=Math.max(i,a,o),u=c-s;c===s?t=0:i===c?t=(a-o)/u:a===c?t=2+(o-i)/u:o===c&&(t=4+(i-a)/u);(t=Math.min(60*t,360))<0&&(t+=360);r=(s+c)/2,n=c===s?0:r<=.5?u/(c+s):u/(2-c-s);return[t/360,n,r]}},function(e,t){function n(e){return Math.pow((e+.055)/1.055,2.4)}e.exports=function(e){var t=e[0]/255,r=e[1]/255,i=e[2]/255,a=t<=.03928?t*(1/12.92):n(t),o=r<=.03928?r*(1/12.92):n(r),s=i<=.03928?i*(1/12.92):n(i);return.2126*a+.7152*o+.0722*s}},function(e,t){THREE.OrbitControls=function(e,t){void 0===t&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:THREE.MOUSE.ROTATE,MIDDLE:THREE.MOUSE.DOLLY,RIGHT:THREE.MOUSE.PAN},this.touches={ONE:THREE.TOUCH.ROTATE,TWO:THREE.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return u.phi},this.getAzimuthalAngle=function(){return u.theta},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(r),n.update(),s=o.NONE},this.update=function(){var t=new THREE.Vector3,i=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),a=i.clone().inverse(),d=new THREE.Vector3,m=new THREE.Quaternion;return function(){var e=n.object.position;return t.copy(e).sub(n.target),t.applyQuaternion(i),u.setFromVector3(t),n.autoRotate&&s===o.NONE&&E(2*Math.PI/60/60*n.autoRotateSpeed),n.enableDamping?(u.theta+=l.theta*n.dampingFactor,u.phi+=l.phi*n.dampingFactor):(u.theta+=l.theta,u.phi+=l.phi),u.theta=Math.max(n.minAzimuthAngle,Math.min(n.maxAzimuthAngle,u.theta)),u.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,u.phi)),u.makeSafe(),u.radius*=h,u.radius=Math.max(n.minDistance,Math.min(n.maxDistance,u.radius)),!0===n.enableDamping?n.target.addScaledVector(f,n.dampingFactor):n.target.add(f),t.setFromSpherical(u),t.applyQuaternion(a),e.copy(n.target).add(t),n.object.lookAt(n.target),!0===n.enableDamping?(l.theta*=1-n.dampingFactor,l.phi*=1-n.dampingFactor,f.multiplyScalar(1-n.dampingFactor)):(l.set(0,0,0),f.set(0,0,0)),h=1,!!(p||d.distanceToSquared(n.object.position)>c||8*(1-m.dot(n.object.quaternion))>c)&&(n.dispatchEvent(r),d.copy(n.object.position),m.copy(n.object.quaternion),p=!1,!0)}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",Y,!1),n.domElement.removeEventListener("mousedown",B,!1),n.domElement.removeEventListener("wheel",G,!1),n.domElement.removeEventListener("touchstart",V,!1),n.domElement.removeEventListener("touchend",q,!1),n.domElement.removeEventListener("touchmove",W,!1),document.removeEventListener("mousemove",U,!1),document.removeEventListener("mouseup",H,!1),n.domElement.removeEventListener("keydown",j,!1)};var n=this,r={type:"change"},i={type:"start"},a={type:"end"},o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},s=o.NONE,c=1e-6,u=new THREE.Spherical,l=new THREE.Spherical,h=1,f=new THREE.Vector3,p=!1,d=new THREE.Vector2,m=new THREE.Vector2,v=new THREE.Vector2,g=new THREE.Vector2,y=new THREE.Vector2,x=new THREE.Vector2,b=new THREE.Vector2,w=new THREE.Vector2,_=new THREE.Vector2;function M(){return Math.pow(.95,n.zoomSpeed)}function E(e){l.theta-=e}function T(e){l.phi-=e}var S=function(){var e=new THREE.Vector3;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),f.add(e)}}(),A=function(){var e=new THREE.Vector3;return function(t,r){!0===n.screenSpacePanning?e.setFromMatrixColumn(r,1):(e.setFromMatrixColumn(r,0),e.crossVectors(n.object.up,e)),e.multiplyScalar(t),f.add(e)}}(),L=function(){var e=new THREE.Vector3;return function(t,r){var i=n.domElement;if(n.object.isPerspectiveCamera){var a=n.object.position;e.copy(a).sub(n.target);var o=e.length();o*=Math.tan(n.object.fov/2*Math.PI/180),S(2*t*o/i.clientHeight,n.object.matrix),A(2*r*o/i.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(S(t*(n.object.right-n.object.left)/n.object.zoom/i.clientWidth,n.object.matrix),A(r*(n.object.top-n.object.bottom)/n.object.zoom/i.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function R(e){n.object.isPerspectiveCamera?h/=e:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*e)),n.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function P(e){n.object.isPerspectiveCamera?h*=e:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/e)),n.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function C(e){d.set(e.clientX,e.clientY)}function O(e){g.set(e.clientX,e.clientY)}function D(e){if(1==e.touches.length)d.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);d.set(t,n)}}function I(e){if(1==e.touches.length)g.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);g.set(t,n)}}function N(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,r=Math.sqrt(t*t+n*n);b.set(0,r)}function z(e){if(1==e.touches.length)m.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);m.set(t,r)}v.subVectors(m,d).multiplyScalar(n.rotateSpeed);var i=n.domElement;E(2*Math.PI*v.x/i.clientHeight),T(2*Math.PI*v.y/i.clientHeight),d.copy(m)}function k(e){if(1==e.touches.length)y.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),r=.5*(e.touches[0].pageY+e.touches[1].pageY);y.set(t,r)}x.subVectors(y,g).multiplyScalar(n.panSpeed),L(x.x,x.y),g.copy(y)}function F(e){var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,i=Math.sqrt(t*t+r*r);w.set(0,i),_.set(0,Math.pow(w.y/b.y,n.zoomSpeed)),R(_.y),b.copy(w)}function B(e){if(!1!==n.enabled){var t;switch(e.preventDefault(),n.domElement.focus?n.domElement.focus():window.focus(),e.button){case 0:t=n.mouseButtons.LEFT;break;case 1:t=n.mouseButtons.MIDDLE;break;case 2:t=n.mouseButtons.RIGHT;break;default:t=-1}switch(t){case THREE.MOUSE.DOLLY:if(!1===n.enableZoom)return;!function(e){b.set(e.clientX,e.clientY)}(e),s=o.DOLLY;break;case THREE.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enablePan)return;O(e),s=o.PAN}else{if(!1===n.enableRotate)return;C(e),s=o.ROTATE}break;case THREE.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===n.enableRotate)return;C(e),s=o.ROTATE}else{if(!1===n.enablePan)return;O(e),s=o.PAN}break;default:s=o.NONE}s!==o.NONE&&(document.addEventListener("mousemove",U,!1),document.addEventListener("mouseup",H,!1),n.dispatchEvent(i))}}function U(e){if(!1!==n.enabled)switch(e.preventDefault(),s){case o.ROTATE:if(!1===n.enableRotate)return;!function(e){m.set(e.clientX,e.clientY),v.subVectors(m,d).multiplyScalar(n.rotateSpeed);var t=n.domElement;E(2*Math.PI*v.x/t.clientHeight),T(2*Math.PI*v.y/t.clientHeight),d.copy(m),n.update()}(e);break;case o.DOLLY:if(!1===n.enableZoom)return;!function(e){w.set(e.clientX,e.clientY),_.subVectors(w,b),_.y>0?R(M()):_.y<0&&P(M()),b.copy(w),n.update()}(e);break;case o.PAN:if(!1===n.enablePan)return;!function(e){y.set(e.clientX,e.clientY),x.subVectors(y,g).multiplyScalar(n.panSpeed),L(x.x,x.y),g.copy(y),n.update()}(e)}}function H(e){!1!==n.enabled&&(document.removeEventListener("mousemove",U,!1),document.removeEventListener("mouseup",H,!1),n.dispatchEvent(a),s=o.NONE)}function G(e){!1===n.enabled||!1===n.enableZoom||s!==o.NONE&&s!==o.ROTATE||(e.preventDefault(),e.stopPropagation(),n.dispatchEvent(i),function(e){e.deltaY<0?P(M()):e.deltaY>0&&R(M()),n.update()}(e),n.dispatchEvent(a))}function j(e){!1!==n.enabled&&!1!==n.enableKeys&&!1!==n.enablePan&&function(e){var t=!1;switch(e.keyCode){case n.keys.UP:L(0,n.keyPanSpeed),t=!0;break;case n.keys.BOTTOM:L(0,-n.keyPanSpeed),t=!0;break;case n.keys.LEFT:L(n.keyPanSpeed,0),t=!0;break;case n.keys.RIGHT:L(-n.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),n.update())}(e)}function V(e){if(!1!==n.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(n.touches.ONE){case THREE.TOUCH.ROTATE:if(!1===n.enableRotate)return;D(e),s=o.TOUCH_ROTATE;break;case THREE.TOUCH.PAN:if(!1===n.enablePan)return;I(e),s=o.TOUCH_PAN;break;default:s=o.NONE}break;case 2:switch(n.touches.TWO){case THREE.TOUCH.DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){n.enableZoom&&N(e),n.enablePan&&I(e)}(e),s=o.TOUCH_DOLLY_PAN;break;case THREE.TOUCH.DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(e){n.enableZoom&&N(e),n.enableRotate&&D(e)}(e),s=o.TOUCH_DOLLY_ROTATE;break;default:s=o.NONE}break;default:s=o.NONE}s!==o.NONE&&n.dispatchEvent(i)}}function W(e){if(!1!==n.enabled)switch(e.preventDefault(),e.stopPropagation(),s){case o.TOUCH_ROTATE:if(!1===n.enableRotate)return;z(e),n.update();break;case o.TOUCH_PAN:if(!1===n.enablePan)return;k(e),n.update();break;case o.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){n.enableZoom&&F(e),n.enablePan&&k(e)}(e),n.update();break;case o.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(e){n.enableZoom&&F(e),n.enableRotate&&z(e)}(e),n.update();break;default:s=o.NONE}}function q(e){!1!==n.enabled&&(n.dispatchEvent(a),s=o.NONE)}function Y(e){!1!==n.enabled&&e.preventDefault()}n.domElement.addEventListener("contextmenu",Y,!1),n.domElement.addEventListener("mousedown",B,!1),n.domElement.addEventListener("wheel",G,!1),n.domElement.addEventListener("touchstart",V,!1),n.domElement.addEventListener("touchend",q,!1),n.domElement.addEventListener("touchmove",W,!1),n.domElement.addEventListener("keydown",j,!1),-1===n.domElement.tabIndex&&(n.domElement.tabIndex=0),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,THREE.MapControls=function(e,t){THREE.OrbitControls.call(this,e,t),this.mouseButtons.LEFT=THREE.MOUSE.PAN,this.mouseButtons.RIGHT=THREE.MOUSE.ROTATE,this.touches.ONE=THREE.TOUCH.PAN,this.touches.TWO=THREE.TOUCH.DOLLY_ROTATE},THREE.MapControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.MapControls.prototype.constructor=THREE.MapControls},function(e,t,n){"use strict";n.r(t);var r=Math.PI,i=2*r,a=i-1e-6;function o(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function s(){return new o}o.prototype=s.prototype={constructor:o,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,r){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+r)},bezierCurveTo:function(e,t,n,r,i,a){this._+="C"+ +e+","+ +t+","+ +n+","+ +r+","+(this._x1=+i)+","+(this._y1=+a)},arcTo:function(e,t,n,i,a){e=+e,t=+t,n=+n,i=+i,a=+a;var o=this._x1,s=this._y1,c=n-e,u=i-t,l=o-e,h=s-t,f=l*l+h*h;if(a<0)throw new Error("negative radius: "+a);if(null===this._x1)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(f>1e-6)if(Math.abs(h*c-u*l)>1e-6&&a){var p=n-o,d=i-s,m=c*c+u*u,v=p*p+d*d,g=Math.sqrt(m),y=Math.sqrt(f),x=a*Math.tan((r-Math.acos((m+f-v)/(2*g*y)))/2),b=x/y,w=x/g;Math.abs(b-1)>1e-6&&(this._+="L"+(e+b*l)+","+(t+b*h)),this._+="A"+a+","+a+",0,0,"+ +(h*p>l*d)+","+(this._x1=e+w*c)+","+(this._y1=t+w*u)}else this._+="L"+(this._x1=e)+","+(this._y1=t);else;},arc:function(e,t,n,o,s,c){e=+e,t=+t,c=!!c;var u=(n=+n)*Math.cos(o),l=n*Math.sin(o),h=e+u,f=t+l,p=1^c,d=c?o-s:s-o;if(n<0)throw new Error("negative radius: "+n);null===this._x1?this._+="M"+h+","+f:(Math.abs(this._x1-h)>1e-6||Math.abs(this._y1-f)>1e-6)&&(this._+="L"+h+","+f),n&&(d<0&&(d=d%i+i),d>a?this._+="A"+n+","+n+",0,1,"+p+","+(e-u)+","+(t-l)+"A"+n+","+n+",0,1,"+p+","+(this._x1=h)+","+(this._y1=f):d>1e-6&&(this._+="A"+n+","+n+",0,"+ +(d>=r)+","+p+","+(this._x1=e+n*Math.cos(s))+","+(this._y1=t+n*Math.sin(s))))},rect:function(e,t,n,r){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +r+"h"+-n+"Z"},toString:function(){return this._}};var c=s;n.d(t,"path",(function(){return c}))}]);